<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>AlcapDAQ: Midas Dual Buffer Memory Functions (dm_xxx)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Midas Dual Buffer Memory Functions (dm_xxx)<br/>
<small>
[<a class="el" href="group__midasincludecode.html">The midas.h &amp; midas.c</a>]</small>
</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDMEM__AREA.html">DMEM_AREA</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDMEM__BUFFER.html">DMEM_BUFFER</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#gab81b65f274d9966737804aba75cf4dce">DM_FLUSH</a>&nbsp;&nbsp;&nbsp;10</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#ga5549407af1c9eec127624ce87fc81320">DM_SEND</a>&nbsp;&nbsp;&nbsp;11</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#gaaad4b2930bb564eee3c5e5f1ced95456">DM_KILL</a>&nbsp;&nbsp;&nbsp;12</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#gacc67a28dec9dd3edb0a445e7b4cf2480">DM_TIMEOUT</a>&nbsp;&nbsp;&nbsp;13</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#ga86b0174e3164d4f50e7d308451ff0970">DM_ACTIVE_NULL</a>&nbsp;&nbsp;&nbsp;14</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#ga02e53ea5c7c89ab3625d507bcd5a1073">dm_buffer_create</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> user_max_event_size)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#ga235a5153d1c73e6a67aaaa2f5431c633">dm_buffer_release</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">INLINE <a class="el" href="structDMEM__AREA.html">DMEM_AREA</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#gaedaa2065d8d33e0b384cc3c8ef1f32d1">dm_area_switch</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">INLINE <a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#gaf21340520e044c12b0786f49558a64d9">dm_area_full</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">INLINE <a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#ga8caac1eaf0e5500e838cdfe7494ea08e">dm_active_full</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#ga664e27b1a0b5d15dbaf49764abffd260">dm_buffer_time_get</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structEVENT__HEADER.html">EVENT_HEADER</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#ga06921503a7c6c7ea686c96a2e45914e6">dm_pointer_get</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#gad45d95e154cca568b717b8b11357c389">dm_pointer_increment</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> buffer_handle, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> event_size)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">INLINE <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a> (<a class="el" href="structDMEM__AREA.html">DMEM_AREA</a> *larea)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#gaaa86552c480e07ce19187bd55c1d4efc">dm_area_send</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#ga03576c1be56e282da205aba73fe58cd1">dm_task</a> (void *pointer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#ga2f8a909e5efc00630c85816a722d643d">dm_area_flush</a> (void)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structDMEM__BUFFER.html">DMEM_BUFFER</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dmfunctionc.html#ga2782b51e3126596ce3008dd84cf121c9">dm_user_max_event_size</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>dox dox </p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ga86b0174e3164d4f50e7d308451ff0970"></a><!-- doxytag: member="midas.c::DM_ACTIVE_NULL" ref="ga86b0174e3164d4f50e7d308451ff0970" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DM_ACTIVE_NULL&nbsp;&nbsp;&nbsp;14</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l17043">17043</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<a class="anchor" id="gab81b65f274d9966737804aba75cf4dce"></a><!-- doxytag: member="midas.c::DM_FLUSH" ref="gab81b65f274d9966737804aba75cf4dce" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DM_FLUSH&nbsp;&nbsp;&nbsp;10</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox </p>

<p>Definition at line <a class="el" href="midas_8c_source.html#l17039">17039</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l17649">dm_area_flush()</a>, and <a class="el" href="midas_8c_source.html#l17529">dm_task()</a>.</p>

</div>
</div>
<a class="anchor" id="gaaad4b2930bb564eee3c5e5f1ced95456"></a><!-- doxytag: member="midas.c::DM_KILL" ref="gaaad4b2930bb564eee3c5e5f1ced95456" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DM_KILL&nbsp;&nbsp;&nbsp;12</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l17041">17041</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l17174">dm_buffer_release()</a>, and <a class="el" href="midas_8c_source.html#l17529">dm_task()</a>.</p>

</div>
</div>
<a class="anchor" id="ga5549407af1c9eec127624ce87fc81320"></a><!-- doxytag: member="midas.c::DM_SEND" ref="ga5549407af1c9eec127624ce87fc81320" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DM_SEND&nbsp;&nbsp;&nbsp;11</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l17040">17040</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l17465">dm_area_send()</a>, and <a class="el" href="midas_8c_source.html#l17529">dm_task()</a>.</p>

</div>
</div>
<a class="anchor" id="gacc67a28dec9dd3edb0a445e7b4cf2480"></a><!-- doxytag: member="midas.c::DM_TIMEOUT" ref="gacc67a28dec9dd3edb0a445e7b4cf2480" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DM_TIMEOUT&nbsp;&nbsp;&nbsp;13</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l17042">17042</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga8caac1eaf0e5500e838cdfe7494ea08e"></a><!-- doxytag: member="midas.c::dm_active_full" ref="ga8caac1eaf0e5500e838cdfe7494ea08e" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INLINE <a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> dm_active_full </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l17268">17268</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l17050">DMEM_AREA::full</a>, <a class="el" href="midas_8c_source.html#l17055">DMEM_BUFFER::pa</a>, <a class="el" href="midas_8c_source.html#l17049">DMEM_AREA::pb</a>, <a class="el" href="midas_8h_source.html#l00615">PTYPE</a>, <a class="el" href="midas_8c_source.html#l17047">DMEM_AREA::pw</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l17314">dm_pointer_get()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l17270"></a>17270          : <a class="code" href="group__dmfunctionc.html#ga8caac1eaf0e5500e838cdfe7494ea08e">dm_active_full</a>
<a name="l17271"></a>17271 
<a name="l17272"></a>17272   Purpose: Test <span class="keywordflow">if</span> there is sufficient space <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> either <span class="keyword">event</span> <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l17273"></a>17273            <span class="keywordflow">for</span> another <span class="keyword">event</span>.
<a name="l17274"></a>17274   Input:
<a name="l17275"></a>17275     none
<a name="l17276"></a>17276   Output:
<a name="l17277"></a>17277     none
<a name="l17278"></a>17278   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l17279"></a>17279     <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>         <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> <span class="keywordflow">if</span> not enough space <span class="keywordflow">for</span> another <span class="keyword">event</span>
<a name="l17280"></a>17280 \********************************************************************/
<a name="l17281"></a>17281 {
<a name="l17282"></a>17282    <span class="comment">/* catch both full areas, waiting for transfer */</span>
<a name="l17283"></a>17283    <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a> == NULL)
<a name="l17284"></a>17284       <span class="keywordflow">return</span> <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l17285"></a>17285    <span class="comment">/* Check the space in the active buffer only</span>
<a name="l17286"></a>17286 <span class="comment">      as I don&apos;t switch buffer here */</span>
<a name="l17287"></a>17287    <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a>-&gt;<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a>)
<a name="l17288"></a>17288       <span class="keywordflow">return</span> <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l17289"></a>17289    <span class="keywordflow">return</span> (((<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a>-&gt;<a class="code" href="structDMEM__AREA.html#a8570204de5e012c18083265879b99167">pb</a> - (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a>-&gt;<a class="code" href="structDMEM__AREA.html#a67fc056e1bf7d0448f78f83073b5f659">pw</a>) &lt; (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>)
<a name="l17290"></a>17290            (<a class="code" href="group__dmfunctionc.html#ga2782b51e3126596ce3008dd84cf121c9">dm_user_max_event_size</a> + <span class="keyword">sizeof</span>(<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a>) + <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>)));
<a name="l17291"></a>17291 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga2f8a909e5efc00630c85816a722d643d"></a><!-- doxytag: member="midas.c::dm_area_flush" ref="ga2f8a909e5efc00630c85816a722d643d" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> dm_area_flush </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l17649">17649</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l17059">DMEM_BUFFER::action</a>, <a class="el" href="midas_8c_source.html#l17056">DMEM_BUFFER::area1</a>, <a class="el" href="midas_8c_source.html#l17057">DMEM_BUFFER::area2</a>, <a class="el" href="midas_8h_source.html#l00956">CM_SUCCESS</a>, <a class="el" href="midas_8c_source.html#l17413">dm_buffer_send()</a>, <a class="el" href="midas_8c_source.html#l17039">DM_FLUSH</a>, <a class="el" href="midas_8c_source.html#l17060">DMEM_BUFFER::last_active</a>, <a class="el" href="midas_8c_source.html#l17062">DMEM_BUFFER::sem_flush</a>, <a class="el" href="midas_8c_source.html#l17061">DMEM_BUFFER::sem_send</a>, <a class="el" href="midas_8c_source.html#l17051">DMEM_AREA::serial</a>, <a class="el" href="system_8c_source.html#l02265">ss_millitime()</a>, <a class="el" href="system_8c_source.html#l02091">ss_mutex_release()</a>, <a class="el" href="system_8c_source.html#l01980">ss_mutex_wait_for()</a>, and <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>.</p>

<p>Referenced by <a class="el" href="crate3_2crate_8cpp_source.html#l00435">frontend_loop()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l01446">scheduler()</a>, and <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l01003">send_event()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l17651"></a>17651          : <a class="code" href="group__msystemincludecode.html#ga5f455cbb7d25f4d6e2c4c76f763b5fb3">dm_area_flush</a>
<a name="l17652"></a>17652 
<a name="l17653"></a>17653   Purpose: Flush all the events <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> the areas.
<a name="l17654"></a>17654            Used <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> mfe <span class="keywordflow">for</span> BOR events, periodic events <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a>
<a name="l17655"></a>17655            <span class="keywordflow">if</span> rate to low <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> <a class="code" href="mucap__compress_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> <a class="code" href="examples_2macro_2midas__macro_8h.html#a02e262edea13d80cc3715d742f2080f8">loop</a> once a second. The standard
<a name="l17656"></a>17656            <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> transfer should be done/triggered <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> <a class="code" href="group__msystemincludecode.html#ga257baee3d02babfe8c86cff24963cdef">dm_area_send</a> (sync/async)
<a name="l17657"></a>17657            <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> <a class="code" href="group__msystemincludecode.html#ga166e1796a9a96ae0652665475bd6cfb7">dm_pointer_get</a>().
<a name="l17658"></a>17658   Input:
<a name="l17659"></a>17659     none
<a name="l17660"></a>17660   Output:
<a name="l17661"></a>17661     none
<a name="l17662"></a>17662   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l17663"></a>17663     <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>       Successful completion
<a name="l17664"></a>17664     <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a> error
<a name="l17665"></a>17665 \********************************************************************/
<a name="l17666"></a>17666 {
<a name="l17667"></a>17667    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l17668"></a>17668 <span class="preprocessor">#ifdef DM_DUAL_THREAD</span>
<a name="l17669"></a>17669 <span class="preprocessor"></span>   <span class="comment">/* request FULL flush */</span>
<a name="l17670"></a>17670    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a021faf69971b9ced3abaa3fee97ff729">action</a> = <a class="code" href="group__dmfunctionc.html#gab81b65f274d9966737804aba75cf4dce">DM_FLUSH</a>;
<a name="l17671"></a>17671    <a class="code" href="group__msystemincludecode.html#gae9746bf50ec478e587bb9d981f8eb9da">ss_mutex_release</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a613817d5524536ea66a1e220426f5c44">sem_send</a>);
<a name="l17672"></a>17672 <span class="preprocessor">#ifdef OS_WINNT</span>
<a name="l17673"></a>17673 <span class="preprocessor"></span>   <span class="comment">/* necessary for true MUTEX (NT) get semaphore back */</span>
<a name="l17674"></a>17674    <a class="code" href="group__msystemincludecode.html#gad3c6b30fd77b7be3d4d3d6db5f106b45">ss_mutex_wait_for</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a613817d5524536ea66a1e220426f5c44">sem_send</a>, 0);
<a name="l17675"></a>17675 <span class="preprocessor">#endif</span>
<a name="l17676"></a>17676 <span class="preprocessor"></span>
<a name="l17677"></a>17677    <span class="comment">/* important to wait for completion before continue with timeout</span>
<a name="l17678"></a>17678 <span class="comment">      timeout specified milliseconds */</span>
<a name="l17679"></a>17679    status = <a class="code" href="group__msystemincludecode.html#gad3c6b30fd77b7be3d4d3d6db5f106b45">ss_mutex_wait_for</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#ab97ceaa38026b0b8188438a0849d48bf">sem_flush</a>, 10000);
<a name="l17680"></a>17680 <span class="preprocessor">#ifdef DM_DEBUG</span>
<a name="l17681"></a>17681 <span class="preprocessor"></span>   printf(<span class="stringliteral">&quot;dm_area_flush after waiting %i\n&quot;</span>, status);
<a name="l17682"></a>17682 <span class="preprocessor">#endif</span>
<a name="l17683"></a>17683 <span class="preprocessor"></span><span class="preprocessor">#ifdef OS_WINNT</span>
<a name="l17684"></a>17684 <span class="preprocessor"></span>   <a class="code" href="group__msystemincludecode.html#gae9746bf50ec478e587bb9d981f8eb9da">ss_mutex_release</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#ab97ceaa38026b0b8188438a0849d48bf">sem_flush</a>);      <span class="comment">/* give it back now */</span>
<a name="l17685"></a>17685 <span class="preprocessor">#endif</span>
<a name="l17686"></a>17686 <span class="preprocessor"></span>
<a name="l17687"></a>17687    <span class="keywordflow">return</span> status;
<a name="l17688"></a>17688 <span class="preprocessor">#else</span>
<a name="l17689"></a>17689 <span class="preprocessor"></span>   <span class="comment">/* full flush done here */</span>
<a name="l17690"></a>17690    <span class="comment">/* select in order both area independently of being full or not */</span>
<a name="l17691"></a>17691    <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a> &lt;= <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a>) {
<a name="l17692"></a>17692       status = <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>(&amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>);
<a name="l17693"></a>17693       <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l17694"></a>17694          <span class="keywordflow">return</span> status;
<a name="l17695"></a>17695       status = <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>(&amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>);
<a name="l17696"></a>17696       <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l17697"></a>17697          <span class="keywordflow">return</span> status;
<a name="l17698"></a>17698    } <span class="keywordflow">else</span> {
<a name="l17699"></a>17699       status = <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>(&amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>);
<a name="l17700"></a>17700       <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l17701"></a>17701          <span class="keywordflow">return</span> status;
<a name="l17702"></a>17702       status = <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>(&amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>);
<a name="l17703"></a>17703       <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l17704"></a>17704          <span class="keywordflow">return</span> status;
<a name="l17705"></a>17705    }
<a name="l17706"></a>17706    <span class="comment">/* reset serial counter */</span>
<a name="l17707"></a>17707    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a> = <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a> = 0;
<a name="l17708"></a>17708    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a335d75335509633cdce0eb2cecd42527">last_active</a> = <a class="code" href="group__msectionh.html#gaeb8fc912d50c2360588c50782b9c916d">ss_millitime</a>();
<a name="l17709"></a>17709    <span class="keywordflow">return</span> <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>;
<a name="l17710"></a>17710 <span class="preprocessor">#endif</span>
<a name="l17711"></a>17711 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaf21340520e044c12b0786f49558a64d9"></a><!-- doxytag: member="midas.c::dm_area_full" ref="gaf21340520e044c12b0786f49558a64d9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INLINE <a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> dm_area_full </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l17249">17249</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l17056">DMEM_BUFFER::area1</a>, <a class="el" href="midas_8c_source.html#l17057">DMEM_BUFFER::area2</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="midas_8c_source.html#l17050">DMEM_AREA::full</a>, <a class="el" href="midas_8c_source.html#l17055">DMEM_BUFFER::pa</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l17529">dm_task()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l17251"></a>17251          : <a class="code" href="group__msystemincludecode.html#ga51fc41cad927868b3349cfbd0a580b6a">dm_area_full</a>
<a name="l17252"></a>17252 
<a name="l17253"></a>17253   Purpose: Test <span class="keywordflow">if</span> both area are full <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> order to block interrupt
<a name="l17254"></a>17254   Input:
<a name="l17255"></a>17255     none
<a name="l17256"></a>17256   Output:
<a name="l17257"></a>17257     none
<a name="l17258"></a>17258   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l17259"></a>17259     <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>         <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> <span class="keywordflow">if</span> not enough space <span class="keywordflow">for</span> another <span class="keyword">event</span>
<a name="l17260"></a>17260 \********************************************************************/
<a name="l17261"></a>17261 {
<a name="l17262"></a>17262    <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a> == NULL || (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a> &amp;&amp; <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a>))
<a name="l17263"></a>17263       <span class="keywordflow">return</span> <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l17264"></a>17264    <span class="keywordflow">return</span> <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l17265"></a>17265 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaaa86552c480e07ce19187bd55c1d4efc"></a><!-- doxytag: member="midas.c::dm_area_send" ref="gaaa86552c480e07ce19187bd55c1d4efc" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> dm_area_send </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l17465">17465</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l17059">DMEM_BUFFER::action</a>, <a class="el" href="midas_8c_source.html#l17056">DMEM_BUFFER::area1</a>, <a class="el" href="midas_8c_source.html#l17057">DMEM_BUFFER::area2</a>, <a class="el" href="midas_8h_source.html#l00956">CM_SUCCESS</a>, <a class="el" href="midas_8c_source.html#l17413">dm_buffer_send()</a>, <a class="el" href="midas_8c_source.html#l17040">DM_SEND</a>, <a class="el" href="midas_8c_source.html#l17050">DMEM_AREA::full</a>, <a class="el" href="midas_8c_source.html#l17055">DMEM_BUFFER::pa</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8c_source.html#l17061">DMEM_BUFFER::sem_send</a>, <a class="el" href="midas_8c_source.html#l17051">DMEM_AREA::serial</a>, <a class="el" href="system_8c_source.html#l02091">ss_mutex_release()</a>, <a class="el" href="system_8c_source.html#l01980">ss_mutex_wait_for()</a>, <a class="el" href="midas_8h_source.html#l01040">SS_NO_MUTEX</a>, and <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l17314">dm_pointer_get()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l17467"></a>17467          : <a class="code" href="group__msystemincludecode.html#ga257baee3d02babfe8c86cff24963cdef">dm_area_send</a>
<a name="l17468"></a>17468 
<a name="l17469"></a>17469   Purpose: Empty the FULL area only <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> proper <span class="keyword">event</span> order
<a name="l17470"></a>17470            Meant to be use either <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> mfe.c <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a94c9987508c91ae4827cc231f43b577e">scheduler</a> on every <span class="keyword">event</span>
<a name="l17471"></a>17471 
<a name="l17472"></a>17472   Dual memory scheme:
<a name="l17473"></a>17473    DM_DUAL_THREAD : Trigger sem_send
<a name="l17474"></a>17474    !DM_DUAL_THREAD: empty full <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> order, <span class="keywordflow">return</span> active to area1
<a name="l17475"></a>17475                     <span class="keywordflow">if</span> <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a> is NULL (were both full) <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> now both are empty
<a name="l17476"></a>17476 
<a name="l17477"></a>17477   Input:
<a name="l17478"></a>17478     none
<a name="l17479"></a>17479   Output:
<a name="l17480"></a>17480     none
<a name="l17481"></a>17481   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l17482"></a>17482     <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>                Successful completion
<a name="l17483"></a>17483     <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>             <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a> error
<a name="l17484"></a>17484 \********************************************************************/
<a name="l17485"></a>17485 {
<a name="l17486"></a>17486 <span class="preprocessor">#ifdef DM_DUAL_THREAD</span>
<a name="l17487"></a>17487 <span class="preprocessor"></span>   <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l17488"></a>17488 
<a name="l17489"></a>17489    <span class="comment">/* force a DM_SEND if possible. Don&apos;t wait for completion */</span>
<a name="l17490"></a>17490    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a021faf69971b9ced3abaa3fee97ff729">action</a> = <a class="code" href="group__dmfunctionc.html#ga5549407af1c9eec127624ce87fc81320">DM_SEND</a>;
<a name="l17491"></a>17491    <a class="code" href="group__msystemincludecode.html#gae9746bf50ec478e587bb9d981f8eb9da">ss_mutex_release</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a613817d5524536ea66a1e220426f5c44">sem_send</a>);
<a name="l17492"></a>17492 <span class="preprocessor">#ifdef OS_WINNT</span>
<a name="l17493"></a>17493 <span class="preprocessor"></span>   <span class="comment">/* necessary for true MUTEX (NT) */</span>
<a name="l17494"></a>17494    status = <a class="code" href="group__msystemincludecode.html#gad3c6b30fd77b7be3d4d3d6db5f106b45">ss_mutex_wait_for</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a613817d5524536ea66a1e220426f5c44">sem_send</a>, 1);
<a name="l17495"></a>17495    <span class="keywordflow">if</span> (status == <a class="code" href="group__err24.html#ga12b0dd329283f2b865476ce4d3e1fcb3">SS_NO_MUTEX</a>) {
<a name="l17496"></a>17496       printf(<span class="stringliteral">&quot; timeout while waiting for sem_send\n&quot;</span>);
<a name="l17497"></a>17497       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l17498"></a>17498    }
<a name="l17499"></a>17499 <span class="preprocessor">#endif</span>
<a name="l17500"></a>17500 <span class="preprocessor"></span>
<a name="l17501"></a>17501    <span class="keywordflow">return</span> <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>;
<a name="l17502"></a>17502 <span class="preprocessor">#else</span>
<a name="l17503"></a>17503 <span class="preprocessor"></span>   <span class="comment">/* ---------- NOT IN DUAL THREAD ----------- */</span>
<a name="l17504"></a>17504    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> status = 0;
<a name="l17505"></a>17505 
<a name="l17506"></a>17506    <span class="comment">/* if no DUAL thread everything is local then */</span>
<a name="l17507"></a>17507    <span class="comment">/* select the full area */</span>
<a name="l17508"></a>17508    <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a> &amp;&amp; <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a>)
<a name="l17509"></a>17509       <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a> &lt;= <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a>)
<a name="l17510"></a>17510          status = <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>(&amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>);
<a name="l17511"></a>17511       <span class="keywordflow">else</span>
<a name="l17512"></a>17512          status = <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>(&amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>);
<a name="l17513"></a>17513    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a>)
<a name="l17514"></a>17514       status = <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>(&amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>);
<a name="l17515"></a>17515    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a>)
<a name="l17516"></a>17516       status = <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>(&amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>);
<a name="l17517"></a>17517    <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l17518"></a>17518       <span class="keywordflow">return</span> status;            <span class="comment">/* catch transfer error too */</span>
<a name="l17519"></a>17519 
<a name="l17520"></a>17520    <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a> == NULL) {
<a name="l17521"></a>17521       printf(<span class="stringliteral">&quot; sync send dm.pa:%p full 1%li 2%li\n&quot;</span>, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a>, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a>, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a>);
<a name="l17522"></a>17522       <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a> = &amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>;
<a name="l17523"></a>17523    }
<a name="l17524"></a>17524    <span class="keywordflow">return</span> <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>;
<a name="l17525"></a>17525 <span class="preprocessor">#endif</span>
<a name="l17526"></a>17526 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaedaa2065d8d33e0b384cc3c8ef1f32d1"></a><!-- doxytag: member="midas.c::dm_area_switch" ref="gaedaa2065d8d33e0b384cc3c8ef1f32d1" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INLINE <a class="el" href="structDMEM__AREA.html">DMEM_AREA</a>* dm_area_switch </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l17214">17214</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l17056">DMEM_BUFFER::area1</a>, <a class="el" href="midas_8c_source.html#l17057">DMEM_BUFFER::area2</a>, <a class="el" href="midas_8c_source.html#l17050">DMEM_AREA::full</a>, and <a class="el" href="midas_8c_source.html#l17051">DMEM_AREA::serial</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l17314">dm_pointer_get()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l17216"></a>17216          : <a class="code" href="group__dmfunctionc.html#gaedaa2065d8d33e0b384cc3c8ef1f32d1">dm_area_switch</a>
<a name="l17217"></a>17217 
<a name="l17218"></a>17218   Purpose: <span class="keyword">set</span> active area to the other empty area <a class="code" href="examples_2macro_2midas__macro_8h.html#a339a611d7f9dc3a59c359f0da7beaf3c">or</a> NULL <span class="keywordflow">if</span> both
<a name="l17219"></a>17219            area are full. May have to check the <a class="code" href="minife_8c.html#a9c566f7d2ca91bd19145b0568c0c66aa">serial</a> consistancy...
<a name="l17220"></a>17220   Input:
<a name="l17221"></a>17221     none
<a name="l17222"></a>17222   Output:
<a name="l17223"></a>17223     none
<a name="l17224"></a>17224   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l17225"></a>17225     <a class="code" href="structDMEM__AREA.html">DMEM_AREA</a> *            Pointer to active area <a class="code" href="examples_2macro_2midas__macro_8h.html#a339a611d7f9dc3a59c359f0da7beaf3c">or</a> both full
<a name="l17226"></a>17226 \********************************************************************/
<a name="l17227"></a>17227 {
<a name="l17228"></a>17228    <span class="keyword">volatile</span> <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> full1, full2;
<a name="l17229"></a>17229 
<a name="l17230"></a>17230    full1 = <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a>;
<a name="l17231"></a>17231    full2 = <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a>;
<a name="l17232"></a>17232 
<a name="l17233"></a>17233    <span class="keywordflow">if</span> (!full1 &amp;&amp; !full2) {
<a name="l17234"></a>17234       <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a> &lt;= <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a>)
<a name="l17235"></a>17235          <span class="keywordflow">return</span> (&amp;(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>));
<a name="l17236"></a>17236       <span class="keywordflow">else</span>
<a name="l17237"></a>17237          <span class="keywordflow">return</span> (&amp;(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>));
<a name="l17238"></a>17238    }
<a name="l17239"></a>17239 
<a name="l17240"></a>17240    <span class="keywordflow">if</span> (!full1) {
<a name="l17241"></a>17241       <span class="keywordflow">return</span> (&amp;(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>));
<a name="l17242"></a>17242    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!full2) {
<a name="l17243"></a>17243       <span class="keywordflow">return</span> (&amp;(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>));
<a name="l17244"></a>17244    }
<a name="l17245"></a>17245    <span class="keywordflow">return</span> (NULL);
<a name="l17246"></a>17246 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga02e53ea5c7c89ab3625d507bcd5a1073"></a><!-- doxytag: member="midas.c::dm_buffer_create" ref="ga02e53ea5c7c89ab3625d507bcd5a1073" args="(INT size, INT user_max_event_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> dm_buffer_create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>user_max_event_size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox Setup a dual memory buffer. Has to be called initially before any other dm_xxx function </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>Size in bytes </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>user_max_event_size</em>&nbsp;</td><td>max event size </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>CM_SUCCESS, BM_NO_MEMORY, BM_MEMSIZE_MISMATCH </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l17079">17079</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l00831">_send_sock</a>, <a class="el" href="midas_8c_source.html#l17056">DMEM_BUFFER::area1</a>, <a class="el" href="midas_8c_source.html#l17057">DMEM_BUFFER::area2</a>, <a class="el" href="midas_8h_source.html#l00988">BM_MEMSIZE_MISMATCH</a>, <a class="el" href="midas_8h_source.html#l00979">BM_NO_MEMORY</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l00956">CM_SUCCESS</a>, <a class="el" href="midas_8c_source.html#l17529">dm_task()</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="midas_8c_source.html#l17050">DMEM_AREA::full</a>, <a class="el" href="midas_8c_source.html#l17060">DMEM_BUFFER::last_active</a>, <a class="el" href="midas_8h_source.html#l01753">M_MALLOC</a>, <a class="el" href="midas_8h_source.html#l00677">MAX_EVENT_SIZE</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="msystem_8h_source.html#l00640">VX_TASK_SPAWN::name</a>, <a class="el" href="midas_8c_source.html#l17055">DMEM_BUFFER::pa</a>, <a class="el" href="midas_8c_source.html#l17049">DMEM_AREA::pb</a>, <a class="el" href="midas_8c_source.html#l17048">DMEM_AREA::pe</a>, <a class="el" href="msystem_8h_source.html#l00641">VX_TASK_SPAWN::priority</a>, <a class="el" href="midas_8c_source.html#l17046">DMEM_AREA::pt</a>, <a class="el" href="midas_8c_source.html#l17047">DMEM_AREA::pw</a>, <a class="el" href="midas_8c_source.html#l10272">rpc_get_event_sock()</a>, <a class="el" href="midas_8c_source.html#l17062">DMEM_BUFFER::sem_flush</a>, <a class="el" href="midas_8c_source.html#l17061">DMEM_BUFFER::sem_send</a>, <a class="el" href="midas_8c_source.html#l17058">DMEM_BUFFER::serial</a>, <a class="el" href="midas_8c_source.html#l17051">DMEM_AREA::serial</a>, <a class="el" href="midas_8h_source.html#l01034">SS_CREATED</a>, <a class="el" href="system_8c_source.html#l02265">ss_millitime()</a>, <a class="el" href="system_8c_source.html#l01818">ss_mutex_create()</a>, <a class="el" href="system_8c_source.html#l01980">ss_mutex_wait_for()</a>, <a class="el" href="midas_8h_source.html#l01033">SS_SUCCESS</a>, <a class="el" href="system_8c_source.html#l01705">ss_thread_create()</a>, <a class="el" href="msystem_8h_source.html#l00643">VX_TASK_SPAWN::stackSize</a>, and <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>.</p>

<p>Referenced by <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l02042">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l17080"></a>17080 {
<a name="l17081"></a>17081 
<a name="l17082"></a>17082    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a> = (<span class="keywordtype">char</span> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l17083"></a>17083    <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a> == NULL)
<a name="l17084"></a>17084       <span class="keywordflow">return</span> (<a class="code" href="group__err22.html#ga5425d2a3621de60926128a3cbaa501cc">BM_NO_MEMORY</a>);
<a name="l17085"></a>17085    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a> = (<span class="keywordtype">char</span> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l17086"></a>17086    <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a> == NULL)
<a name="l17087"></a>17087       <span class="keywordflow">return</span> (<a class="code" href="group__err22.html#ga5425d2a3621de60926128a3cbaa501cc">BM_NO_MEMORY</a>);
<a name="l17088"></a>17088 
<a name="l17089"></a>17089    <span class="comment">/* check user event size against the system MAX_EVENT_SIZE */</span>
<a name="l17090"></a>17090    <span class="keywordflow">if</span> (user_max_event_size &gt; <a class="code" href="group__midasincludecode.html#ga05d5acc365e3342523d84bc4540adc09">MAX_EVENT_SIZE</a>) {
<a name="l17091"></a>17091       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;dm_buffer_create&quot;</span>, <span class="stringliteral">&quot;user max event size too large&quot;</span>);
<a name="l17092"></a>17092       <span class="keywordflow">return</span> <a class="code" href="group__err22.html#ga2d978469667eb3d51ea7cc48a5070a72">BM_MEMSIZE_MISMATCH</a>;
<a name="l17093"></a>17093    }
<a name="l17094"></a>17094    <a class="code" href="group__dmfunctionc.html#ga2782b51e3126596ce3008dd84cf121c9">dm_user_max_event_size</a> = user_max_event_size;
<a name="l17095"></a>17095 
<a name="l17096"></a>17096    memset(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a>, 0, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l17097"></a>17097    memset(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a>, 0, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l17098"></a>17098 
<a name="l17099"></a>17099    <span class="comment">/* initialize pointers */</span>
<a name="l17100"></a>17100    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#a8570204de5e012c18083265879b99167">pb</a> = <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a> + <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> - 1024;
<a name="l17101"></a>17101    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#a67fc056e1bf7d0448f78f83073b5f659">pw</a> = <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#add1c92e3a0d8c5fa6a640625f460b247">pe</a> = <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a>;
<a name="l17102"></a>17102    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#a8570204de5e012c18083265879b99167">pb</a> = <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a> + <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> - 1024;
<a name="l17103"></a>17103    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#a67fc056e1bf7d0448f78f83073b5f659">pw</a> = <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#add1c92e3a0d8c5fa6a640625f460b247">pe</a> = <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a>;
<a name="l17104"></a>17104 
<a name="l17105"></a>17105   <span class="comment">/*-PAA-*/</span>
<a name="l17106"></a>17106 <span class="preprocessor">#ifdef DM_DEBUG</span>
<a name="l17107"></a>17107 <span class="preprocessor"></span>   printf(<span class="stringliteral">&quot; in dm_buffer_create ---------------------------------\n&quot;</span>);
<a name="l17108"></a>17108    printf(<span class="stringliteral">&quot; %i %p %p %p %p\n&quot;</span>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a>, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#a67fc056e1bf7d0448f78f83073b5f659">pw</a>, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#add1c92e3a0d8c5fa6a640625f460b247">pe</a>, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#a8570204de5e012c18083265879b99167">pb</a>);
<a name="l17109"></a>17109    printf(<span class="stringliteral">&quot; %i %p %p %p %p\n&quot;</span>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a>, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#a67fc056e1bf7d0448f78f83073b5f659">pw</a>, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#add1c92e3a0d8c5fa6a640625f460b247">pe</a>, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#a8570204de5e012c18083265879b99167">pb</a>);
<a name="l17110"></a>17110 <span class="preprocessor">#endif</span>
<a name="l17111"></a>17111 <span class="preprocessor"></span>
<a name="l17112"></a>17112    <span class="comment">/* activate first area */</span>
<a name="l17113"></a>17113    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a> = &amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>;
<a name="l17114"></a>17114 
<a name="l17115"></a>17115    <span class="comment">/* Default not full */</span>
<a name="l17116"></a>17116    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a> = <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a> = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l17117"></a>17117 
<a name="l17118"></a>17118    <span class="comment">/* Reset serial buffer number with proper starting sequence */</span>
<a name="l17119"></a>17119    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a> = <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a> = 0;
<a name="l17120"></a>17120    <span class="comment">/* ensure proper serial on next increment */</span>
<a name="l17121"></a>17121    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#ab93cfa2c2227b62e57da5d681a9bfb0b">serial</a> = 1;
<a name="l17122"></a>17122 
<a name="l17123"></a>17123    <span class="comment">/* set active buffer time stamp */</span>
<a name="l17124"></a>17124    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a335d75335509633cdce0eb2cecd42527">last_active</a> = <a class="code" href="group__msectionh.html#gaeb8fc912d50c2360588c50782b9c916d">ss_millitime</a>();
<a name="l17125"></a>17125 
<a name="l17126"></a>17126    <span class="comment">/* get socket for event sending */</span>
<a name="l17127"></a>17127    <a class="code" href="group__midasincludecode.html#ga9a0004d9fa35de7910301011606b5f0f">_send_sock</a> = <a class="code" href="group__msystemincludecode.html#ga799933a102e7261213fbc56b0f95a705">rpc_get_event_sock</a>();
<a name="l17128"></a>17128 
<a name="l17129"></a>17129 <span class="preprocessor">#ifdef DM_DUAL_THREAD</span>
<a name="l17130"></a>17130 <span class="preprocessor"></span>   {
<a name="l17131"></a>17131       <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l17132"></a>17132       <a class="code" href="structVX__TASK__SPAWN.html">VX_TASK_SPAWN</a> starg;
<a name="l17133"></a>17133 
<a name="l17134"></a>17134       <span class="comment">/* create semaphore */</span>
<a name="l17135"></a>17135       status = <a class="code" href="group__msystemincludecode.html#ga518ac9986c25e4f472f7d731a98ca2f3">ss_mutex_create</a>(<span class="stringliteral">&quot;send&quot;</span>, &amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a613817d5524536ea66a1e220426f5c44">sem_send</a>);
<a name="l17136"></a>17136       <span class="keywordflow">if</span> (status != <a class="code" href="group__err24.html#ga7440cf35b00082fb16e8584ada5b50e0">SS_CREATED</a> &amp;&amp; status != <a class="code" href="group__err24.html#ga0abac6c68d7a79ce83d1a25b2c800321">SS_SUCCESS</a>) {
<a name="l17137"></a>17137          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;dm_buffer_create&quot;</span>, <span class="stringliteral">&quot;error in ss_mutex_create send&quot;</span>);
<a name="l17138"></a>17138          <span class="keywordflow">return</span> status;
<a name="l17139"></a>17139       }
<a name="l17140"></a>17140       status = <a class="code" href="group__msystemincludecode.html#ga518ac9986c25e4f472f7d731a98ca2f3">ss_mutex_create</a>(<span class="stringliteral">&quot;flush&quot;</span>, &amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#ab97ceaa38026b0b8188438a0849d48bf">sem_flush</a>);
<a name="l17141"></a>17141       <span class="keywordflow">if</span> (status != <a class="code" href="group__err24.html#ga7440cf35b00082fb16e8584ada5b50e0">SS_CREATED</a> &amp;&amp; status != <a class="code" href="group__err24.html#ga0abac6c68d7a79ce83d1a25b2c800321">SS_SUCCESS</a>) {
<a name="l17142"></a>17142          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;dm_buffer_create&quot;</span>, <span class="stringliteral">&quot;error in ss_mutex_create flush&quot;</span>);
<a name="l17143"></a>17143          <span class="keywordflow">return</span> status;
<a name="l17144"></a>17144       }
<a name="l17145"></a>17145       <span class="comment">/* spawn dm_task */</span>
<a name="l17146"></a>17146       memset(&amp;starg, 0, <span class="keyword">sizeof</span>(<a class="code" href="structVX__TASK__SPAWN.html">VX_TASK_SPAWN</a>));
<a name="l17147"></a>17147 
<a name="l17148"></a>17148 <span class="preprocessor">#ifdef OS_VXWORKS</span>
<a name="l17149"></a>17149 <span class="preprocessor"></span>      <span class="comment">/* Fill up the necessary arguments */</span>
<a name="l17150"></a>17150       strcpy(starg.<a class="code" href="structVX__TASK__SPAWN.html#ad109065a4cd65716d8628ecc4471bd92">name</a>, <span class="stringliteral">&quot;areaSend&quot;</span>);
<a name="l17151"></a>17151       starg.<a class="code" href="structVX__TASK__SPAWN.html#a7d870646213aac56a1fea2f098d8daff">priority</a> = 120;
<a name="l17152"></a>17152       starg.<a class="code" href="structVX__TASK__SPAWN.html#a84d304d81b505ac730e6e1d9dced9216">stackSize</a> = 20000;
<a name="l17153"></a>17153 <span class="preprocessor">#endif</span>
<a name="l17154"></a>17154 <span class="preprocessor"></span>
<a name="l17155"></a>17155       <span class="keywordflow">if</span> ((status = <a class="code" href="group__msystemincludecode.html#gaf5d1e0d2746962f668cd410d4be463ef">ss_thread_create</a>(<a class="code" href="group__msystemincludecode.html#ga79d27b9638dbf46e71ac68740fb74dce">dm_task</a>, (<span class="keywordtype">void</span> *) &amp;starg))
<a name="l17156"></a>17156           != <a class="code" href="group__err24.html#ga0abac6c68d7a79ce83d1a25b2c800321">SS_SUCCESS</a>) {
<a name="l17157"></a>17157          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;dm_buffer_create&quot;</span>, <span class="stringliteral">&quot;error in ss_thread_create&quot;</span>);
<a name="l17158"></a>17158          <span class="keywordflow">return</span> status;
<a name="l17159"></a>17159       }
<a name="l17160"></a>17160 <span class="preprocessor">#ifdef OS_WINNT</span>
<a name="l17161"></a>17161 <span class="preprocessor"></span>      <span class="comment">/* necessary for true MUTEX (NT) */</span>
<a name="l17162"></a>17162       <a class="code" href="group__msystemincludecode.html#gad3c6b30fd77b7be3d4d3d6db5f106b45">ss_mutex_wait_for</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a613817d5524536ea66a1e220426f5c44">sem_send</a>, 0);
<a name="l17163"></a>17163 <span class="preprocessor">#endif</span>
<a name="l17164"></a>17164 <span class="preprocessor"></span>   }
<a name="l17165"></a>17165 <span class="preprocessor">#endif                          </span><span class="comment">/* DM_DUAL_THREAD */</span>
<a name="l17166"></a>17166 
<a name="l17167"></a>17167    <span class="keywordflow">return</span> <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>;
<a name="l17168"></a>17168 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga235a5153d1c73e6a67aaaa2f5431c633"></a><!-- doxytag: member="midas.c::dm_buffer_release" ref="ga235a5153d1c73e6a67aaaa2f5431c633" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> dm_buffer_release </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox </p>

<p>Definition at line <a class="el" href="midas_8c_source.html#l17174">17174</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l17059">DMEM_BUFFER::action</a>, <a class="el" href="midas_8c_source.html#l17056">DMEM_BUFFER::area1</a>, <a class="el" href="midas_8c_source.html#l17057">DMEM_BUFFER::area2</a>, <a class="el" href="midas_8h_source.html#l00956">CM_SUCCESS</a>, <a class="el" href="midas_8c_source.html#l17041">DM_KILL</a>, <a class="el" href="midas_8c_source.html#l17050">DMEM_AREA::full</a>, <a class="el" href="midas_8c_source.html#l17046">DMEM_AREA::pt</a>, <a class="el" href="midas_8c_source.html#l17062">DMEM_BUFFER::sem_flush</a>, <a class="el" href="midas_8c_source.html#l17061">DMEM_BUFFER::sem_send</a>, <a class="el" href="midas_8c_source.html#l17051">DMEM_AREA::serial</a>, <a class="el" href="midas_8c_source.html#l17058">DMEM_BUFFER::serial</a>, <a class="el" href="system_8c_source.html#l02177">ss_mutex_delete()</a>, <a class="el" href="system_8c_source.html#l02091">ss_mutex_release()</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l02042">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l17176"></a>17176          : <a class="code" href="group__msystemincludecode.html#ga5dfc452236b65b087dc387905dadab1d">dm_buffer_release</a>
<a name="l17177"></a>17177 
<a name="l17178"></a>17178   Purpose: Release dual memory buffers
<a name="l17179"></a>17179   Input:
<a name="l17180"></a>17180     none
<a name="l17181"></a>17181   Output:
<a name="l17182"></a>17182     none
<a name="l17183"></a>17183   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l17184"></a>17184     <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>              Successful completion
<a name="l17185"></a>17185 \********************************************************************/
<a name="l17186"></a>17186 {
<a name="l17187"></a>17187    <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a>) {
<a name="l17188"></a>17188       free(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a>);
<a name="l17189"></a>17189       <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a> = NULL;
<a name="l17190"></a>17190    }
<a name="l17191"></a>17191    <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a>) {
<a name="l17192"></a>17192       free(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a>);
<a name="l17193"></a>17193       <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a> = NULL;
<a name="l17194"></a>17194    }
<a name="l17195"></a>17195    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#ab93cfa2c2227b62e57da5d681a9bfb0b">serial</a> = 0;
<a name="l17196"></a>17196    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a> = <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a> = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l17197"></a>17197    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a> = <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a> = 0;
<a name="l17198"></a>17198 
<a name="l17199"></a>17199 <span class="preprocessor">#ifdef DM_DUAL_THREAD</span>
<a name="l17200"></a>17200 <span class="preprocessor"></span>   <span class="comment">/* kill spawned dm_task */</span>
<a name="l17201"></a>17201    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a021faf69971b9ced3abaa3fee97ff729">action</a> = <a class="code" href="group__dmfunctionc.html#gaaad4b2930bb564eee3c5e5f1ced95456">DM_KILL</a>;
<a name="l17202"></a>17202    <a class="code" href="group__msystemincludecode.html#gae9746bf50ec478e587bb9d981f8eb9da">ss_mutex_release</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a613817d5524536ea66a1e220426f5c44">sem_send</a>);
<a name="l17203"></a>17203    <a class="code" href="group__msystemincludecode.html#gae9746bf50ec478e587bb9d981f8eb9da">ss_mutex_release</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#ab97ceaa38026b0b8188438a0849d48bf">sem_flush</a>);
<a name="l17204"></a>17204 
<a name="l17205"></a>17205    <span class="comment">/* release semaphore */</span>
<a name="l17206"></a>17206    <a class="code" href="group__msystemincludecode.html#gac373a10e886ccbfd012b7f5d848d8595">ss_mutex_delete</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a613817d5524536ea66a1e220426f5c44">sem_send</a>, 0);
<a name="l17207"></a>17207    <a class="code" href="group__msystemincludecode.html#gac373a10e886ccbfd012b7f5d848d8595">ss_mutex_delete</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#ab97ceaa38026b0b8188438a0849d48bf">sem_flush</a>, 0);
<a name="l17208"></a>17208 <span class="preprocessor">#endif</span>
<a name="l17209"></a>17209 <span class="preprocessor"></span>
<a name="l17210"></a>17210    <span class="keywordflow">return</span> <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>;
<a name="l17211"></a>17211 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gae8dcf8cbb9f23e671a94d52cfc6c7a38"></a><!-- doxytag: member="midas.c::dm_buffer_send" ref="gae8dcf8cbb9f23e671a94d52cfc6c7a38" args="(DMEM_AREA *larea)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INLINE <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> dm_buffer_send </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structDMEM__AREA.html">DMEM_AREA</a> *&nbsp;</td>
          <td class="paramname"> <em>larea</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l17413">17413</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l00831">_send_sock</a>, <a class="el" href="midas_8h_source.html#l00756">ASYNC</a>, <a class="el" href="midas_8c_source.html#l06412">bm_flush_cache()</a>, <a class="el" href="midas_8h_source.html#l00956">CM_SUCCESS</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="midas_8c_source.html#l17050">DMEM_AREA::full</a>, <a class="el" href="midas_8c_source.html#l17055">DMEM_BUFFER::pa</a>, <a class="el" href="midas_8c_source.html#l17048">DMEM_AREA::pe</a>, <a class="el" href="midas_8c_source.html#l17046">DMEM_AREA::pt</a>, <a class="el" href="midas_8h_source.html#l00615">PTYPE</a>, <a class="el" href="midas_8c_source.html#l17047">DMEM_AREA::pw</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, and <a class="el" href="system_8c_source.html#l03606">send_tcp()</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l17649">dm_area_flush()</a>, <a class="el" href="midas_8c_source.html#l17465">dm_area_send()</a>, and <a class="el" href="midas_8c_source.html#l17529">dm_task()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l17415"></a>17415          : <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>
<a name="l17416"></a>17416 
<a name="l17417"></a>17417   Purpose: Ship <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> to the <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> fact!
<a name="l17418"></a>17418            Basically the same <span class="keywordflow">do</span> <a class="code" href="examples_2macro_2midas__macro_8h.html#a02e262edea13d80cc3715d742f2080f8">loop</a> is done <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> the <a class="code" href="group__msystemincludecode.html#gae657f73f38c098645aab383053478d59">send_tcp</a>.
<a name="l17419"></a>17419            but <a class="code" href="group__rpcfunctionc.html#ga20e63d0a316b30ec4fbd8766dd04c52d">_opt_tcp_size</a> preveal <span class="keywordflow">if</span> &lt;= <a class="code" href="group__midasincludecode.html#ga31190e25ed33be085ff0af476af2c029">NET_TCP_SIZE</a>.
<a name="l17420"></a>17420            Introduced <span class="keywordflow">for</span> bringing tcp option to <a class="code" href="structcallback__addr.html#ac148a716312be01ce57e4ca396bb5cff">user</a> code.
<a name="l17421"></a>17421   Input:
<a name="l17422"></a>17422     <a class="code" href="structDMEM__AREA.html">DMEM_AREA</a> * larea   The area to work with.
<a name="l17423"></a>17423   Output:
<a name="l17424"></a>17424     none
<a name="l17425"></a>17425   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l17426"></a>17426     <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>       Successful completion
<a name="l17427"></a>17427     <a class="code" href="group__dmfunctionc.html#ga86b0174e3164d4f50e7d308451ff0970">DM_ACTIVE_NULL</a>   Both area were/are full
<a name="l17428"></a>17428     <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a> error
<a name="l17429"></a>17429 \********************************************************************/
<a name="l17430"></a>17430 {
<a name="l17431"></a>17431    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> tot_size, nwrite;
<a name="l17432"></a>17432    <span class="keywordtype">char</span> *lpt;
<a name="l17433"></a>17433 
<a name="l17434"></a>17434    <span class="comment">/* if not connected remotely, use bm_send_event */</span>
<a name="l17435"></a>17435    <span class="keywordflow">if</span> (<a class="code" href="group__midasincludecode.html#ga9a0004d9fa35de7910301011606b5f0f">_send_sock</a> == 0)
<a name="l17436"></a>17436       <span class="keywordflow">return</span> <a class="code" href="group__msectionh.html#ga0116bb8954b16dfdc5d355f7c01127ad">bm_flush_cache</a>(*((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a>-&gt;<a class="code" href="structDMEM__AREA.html#a67fc056e1bf7d0448f78f83073b5f659">pw</a>), <a class="code" href="group__mdefineh.html#gad28b60868b6548c43e7a18f30c9b2022">ASYNC</a>);
<a name="l17437"></a>17437 
<a name="l17438"></a>17438    <span class="comment">/* alias */</span>
<a name="l17439"></a>17439    lpt = larea-&gt;<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a>;
<a name="l17440"></a>17440 
<a name="l17441"></a>17441    <span class="comment">/* Get overall buffer size */</span>
<a name="l17442"></a>17442    tot_size = (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) larea-&gt;<a class="code" href="structDMEM__AREA.html#add1c92e3a0d8c5fa6a640625f460b247">pe</a> - (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) lpt;
<a name="l17443"></a>17443 
<a name="l17444"></a>17444    <span class="comment">/* shortcut for speed */</span>
<a name="l17445"></a>17445    <span class="keywordflow">if</span> (tot_size == 0)
<a name="l17446"></a>17446       <span class="keywordflow">return</span> <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>;
<a name="l17447"></a>17447 
<a name="l17448"></a>17448 <span class="preprocessor">#ifdef DM_DEBUG</span>
<a name="l17449"></a>17449 <span class="preprocessor"></span>   printf(<span class="stringliteral">&quot;lpt:%p size:%i &quot;</span>, lpt, tot_size);
<a name="l17450"></a>17450 <span class="preprocessor">#endif</span>
<a name="l17451"></a>17451 <span class="preprocessor"></span>   nwrite = <a class="code" href="group__msystemincludecode.html#gae657f73f38c098645aab383053478d59">send_tcp</a>(<a class="code" href="group__midasincludecode.html#ga9a0004d9fa35de7910301011606b5f0f">_send_sock</a>, lpt, tot_size, 0);
<a name="l17452"></a>17452 <span class="preprocessor">#ifdef DM_DEBUG</span>
<a name="l17453"></a>17453 <span class="preprocessor"></span>   printf(<span class="stringliteral">&quot;nwrite:%i  errno:%i\n&quot;</span>, nwrite, errno);
<a name="l17454"></a>17454 <span class="preprocessor">#endif</span>
<a name="l17455"></a>17455 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (nwrite &lt; 0)
<a name="l17456"></a>17456       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l17457"></a>17457 
<a name="l17458"></a>17458    <span class="comment">/* reset area */</span>
<a name="l17459"></a>17459    larea-&gt;<a class="code" href="structDMEM__AREA.html#a67fc056e1bf7d0448f78f83073b5f659">pw</a> = larea-&gt;<a class="code" href="structDMEM__AREA.html#add1c92e3a0d8c5fa6a640625f460b247">pe</a> = larea-&gt;<a class="code" href="structDMEM__AREA.html#a2ffb4196b2383d2f99072ae22c69a9f0">pt</a>;
<a name="l17460"></a>17460    larea-&gt;<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a> = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l17461"></a>17461    <span class="keywordflow">return</span> <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>;
<a name="l17462"></a>17462 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga664e27b1a0b5d15dbaf49764abffd260"></a><!-- doxytag: member="midas.c::dm_buffer_time_get" ref="ga664e27b1a0b5d15dbaf49764abffd260" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> dm_buffer_time_get </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l17294">17294</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l17060">DMEM_BUFFER::last_active</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l17296"></a>17296          : <a class="code" href="group__msystemincludecode.html#gae3d321037f5479698fb81a91757faa24">dm_buffer_time_get</a>
<a name="l17297"></a>17297 
<a name="l17298"></a>17298   Purpose: <span class="keywordflow">return</span> the <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a> from the <a class="code" href="MFastSlowCorrelator_8cpp.html#a3579fbbede9d99d8d4aafc118b3abed3">last</a> <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> <span class="keywordflow">switch</span>.
<a name="l17299"></a>17299 
<a name="l17300"></a>17300   Input:
<a name="l17301"></a>17301     none
<a name="l17302"></a>17302   Output:
<a name="l17303"></a>17303     none
<a name="l17304"></a>17304   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l17305"></a>17305     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>        <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a> stamp
<a name="l17306"></a>17306 
<a name="l17307"></a>17307 \********************************************************************/
<a name="l17308"></a>17308 {
<a name="l17309"></a>17309    <span class="keywordflow">return</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a335d75335509633cdce0eb2cecd42527">last_active</a>);
<a name="l17310"></a>17310 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga06921503a7c6c7ea686c96a2e45914e6"></a><!-- doxytag: member="midas.c::dm_pointer_get" ref="ga06921503a7c6c7ea686c96a2e45914e6" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structEVENT__HEADER.html">EVENT_HEADER</a>* dm_pointer_get </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l17314">17314</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l17056">DMEM_BUFFER::area1</a>, <a class="el" href="midas_8c_source.html#l17057">DMEM_BUFFER::area2</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8c_source.html#l17268">dm_active_full()</a>, <a class="el" href="midas_8c_source.html#l17465">dm_area_send()</a>, <a class="el" href="midas_8c_source.html#l17214">dm_area_switch()</a>, <a class="el" href="midas_8c_source.html#l17050">DMEM_AREA::full</a>, <a class="el" href="midas_8c_source.html#l17060">DMEM_BUFFER::last_active</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8c_source.html#l17055">DMEM_BUFFER::pa</a>, <a class="el" href="midas_8c_source.html#l17047">DMEM_AREA::pw</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8c_source.html#l17058">DMEM_BUFFER::serial</a>, <a class="el" href="midas_8c_source.html#l17051">DMEM_AREA::serial</a>, <a class="el" href="system_8c_source.html#l02265">ss_millitime()</a>, <a class="el" href="system_8c_source.html#l02491">ss_sleep()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="getHist_8cpp_source.html#l00057">timeout</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l01263">interrupt_routine()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l01446">scheduler()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l01003">send_event()</a>, and <a class="el" href="ybos_8c_source.html#l00856">yb_file_fragment()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l17316"></a>17316          : <a class="code" href="group__msystemincludecode.html#ga166e1796a9a96ae0652665475bd6cfb7">dm_pointer_get</a>
<a name="l17317"></a>17317 
<a name="l17318"></a>17318   Purpose: Get pointer to next free location <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> <span class="keyword">event</span> <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>.
<a name="l17319"></a>17319            after 10sec tries, it times <a class="code" href="scs__600_8c.html#a4e01158f01f9ad810066c89cf7267087">out</a> <span class="keywordflow">return</span> NULL indicating a
<a name="l17320"></a>17320            serious problem, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>.e. abort.
<a name="l17321"></a>17321   REMARK : Cannot be called twice <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> a raw due to +<span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>)
<a name="l17322"></a>17322   Input:
<a name="l17323"></a>17323     none
<a name="l17324"></a>17324   Output:
<a name="l17325"></a>17325     DM_BUFFER * <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>    local valid <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a> to work on
<a name="l17326"></a>17326   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l17327"></a>17327     <a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *    Pointer to free location
<a name="l17328"></a>17328     NULL              cannot after several attempt <span class="keyword">get</span> free space =&gt; abort
<a name="l17329"></a>17329 \********************************************************************/
<a name="l17330"></a>17330 {
<a name="l17331"></a>17331    <span class="keywordtype">int</span> <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l17332"></a>17332 
<a name="l17333"></a>17333    <span class="comment">/* Is there still space in the active area ? */</span>
<a name="l17334"></a>17334    <span class="keywordflow">if</span> (!<a class="code" href="group__dmfunctionc.html#ga8caac1eaf0e5500e838cdfe7494ea08e">dm_active_full</a>())
<a name="l17335"></a>17335       <span class="keywordflow">return</span> (<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *) (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a>-&gt;<a class="code" href="structDMEM__AREA.html#a67fc056e1bf7d0448f78f83073b5f659">pw</a> + <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>));
<a name="l17336"></a>17336 
<a name="l17337"></a>17337    <span class="comment">/* no more space =&gt; switch area */</span>
<a name="l17338"></a>17338 
<a name="l17339"></a>17339    <span class="comment">/* Tag current area with global dm.serial for order consistency */</span>
<a name="l17340"></a>17340    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a>-&gt;<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a> = <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#ab93cfa2c2227b62e57da5d681a9bfb0b">serial</a>++;
<a name="l17341"></a>17341 
<a name="l17342"></a>17342    <span class="comment">/* set active buffer time stamp */</span>
<a name="l17343"></a>17343    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a335d75335509633cdce0eb2cecd42527">last_active</a> = <a class="code" href="group__msectionh.html#gaeb8fc912d50c2360588c50782b9c916d">ss_millitime</a>();
<a name="l17344"></a>17344 
<a name="l17345"></a>17345    <span class="comment">/* mark current area full */</span>
<a name="l17346"></a>17346    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a>-&gt;<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a> = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l17347"></a>17347 
<a name="l17348"></a>17348    <span class="comment">/* Trigger/do data transfer (Now/don&apos;t wait) */</span>
<a name="l17349"></a>17349    <span class="keywordflow">if</span> ((status = <a class="code" href="group__msystemincludecode.html#ga257baee3d02babfe8c86cff24963cdef">dm_area_send</a>()) == <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>) {
<a name="l17350"></a>17350       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;dm_pointer_get()&quot;</span>, <span class="stringliteral">&quot;Net error or timeout %i&quot;</span>, status);
<a name="l17351"></a>17351       <span class="keywordflow">return</span> NULL;
<a name="l17352"></a>17352    }
<a name="l17353"></a>17353 
<a name="l17354"></a>17354    <span class="comment">/* wait switch completion (max 10 sec) */</span>
<a name="l17355"></a>17355    timeout = <a class="code" href="group__msectionh.html#gaeb8fc912d50c2360588c50782b9c916d">ss_millitime</a>();    <span class="comment">/* with timeout */</span>
<a name="l17356"></a>17356    <span class="keywordflow">while</span> ((<a class="code" href="group__msectionh.html#gaeb8fc912d50c2360588c50782b9c916d">ss_millitime</a>() - timeout) &lt; 10000) {
<a name="l17357"></a>17357       <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a> = <a class="code" href="group__dmfunctionc.html#gaedaa2065d8d33e0b384cc3c8ef1f32d1">dm_area_switch</a>();
<a name="l17358"></a>17358       <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a> != NULL)
<a name="l17359"></a>17359          <span class="keywordflow">return</span> (<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *) (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a>-&gt;<a class="code" href="structDMEM__AREA.html#a67fc056e1bf7d0448f78f83073b5f659">pw</a> + <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>));
<a name="l17360"></a>17360       <a class="code" href="group__msectionh.html#gaaec652d8878ceb5ef38ad1ba2cbf7dec">ss_sleep</a>(200);
<a name="l17361"></a>17361 <span class="preprocessor">#ifdef DM_DEBUG</span>
<a name="l17362"></a>17362 <span class="preprocessor"></span>      printf(<span class="stringliteral">&quot; waiting for space ... %i  dm_buffer  %i %i %i %i %i \n&quot;</span>,
<a name="l17363"></a>17363              <a class="code" href="group__msectionh.html#gaeb8fc912d50c2360588c50782b9c916d">ss_millitime</a>() - timeout, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a>, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a>, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a>,
<a name="l17364"></a>17364              <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a>, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#ab93cfa2c2227b62e57da5d681a9bfb0b">serial</a>);
<a name="l17365"></a>17365 <span class="preprocessor">#endif</span>
<a name="l17366"></a>17366 <span class="preprocessor"></span>   }
<a name="l17367"></a>17367 
<a name="l17368"></a>17368    <span class="comment">/* Time running out abort */</span>
<a name="l17369"></a>17369    <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;dm_pointer_get&quot;</span>, <span class="stringliteral">&quot;Timeout due to buffer full&quot;</span>);
<a name="l17370"></a>17370    <span class="keywordflow">return</span> NULL;
<a name="l17371"></a>17371 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gad45d95e154cca568b717b8b11357c389"></a><!-- doxytag: member="midas.c::dm_pointer_increment" ref="gad45d95e154cca568b717b8b11357c389" args="(INT buffer_handle, INT event_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dm_pointer_increment </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>buffer_handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>event_size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l17375">17375</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l00831">_send_sock</a>, <a class="el" href="midas_8h_source.html#l00904">ALIGN8</a>, <a class="el" href="midas_8c_source.html#l06057">bm_send_event()</a>, <a class="el" href="midas_8h_source.html#l00956">CM_SUCCESS</a>, <a class="el" href="midas_8c_source.html#l17055">DMEM_BUFFER::pa</a>, <a class="el" href="midas_8c_source.html#l17048">DMEM_AREA::pe</a>, <a class="el" href="midas_8c_source.html#l17047">DMEM_AREA::pw</a>, and <a class="el" href="midas_8h_source.html#l00755">SYNC</a>.</p>

<p>Referenced by <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l01263">interrupt_routine()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l01446">scheduler()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l01003">send_event()</a>, and <a class="el" href="ybos_8c_source.html#l00856">yb_file_fragment()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l17377"></a>17377          : <a class="code" href="group__msystemincludecode.html#gaf86511000a179574ea04744ccf04c452">dm_pointer_increment</a>
<a name="l17378"></a>17378 
<a name="l17379"></a>17379   Purpose: Increment <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a> pointer of <span class="keyword">event</span> <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> after an <span class="keyword">event</span>
<a name="l17380"></a>17380            has been copied into the <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> (at an <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a> previously
<a name="l17381"></a>17381            obtained via <a class="code" href="group__msystemincludecode.html#ga166e1796a9a96ae0652665475bd6cfb7">dm_pointer_get</a>)
<a name="l17382"></a>17382   Input:
<a name="l17383"></a>17383     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> buffer_handle         Buffer <a class="code" href="v1724__module_8c.html#a0e640374bff58e788b18fbed8f89fe11">handle</a> <span class="keyword">event</span> should be sent to
<a name="l17384"></a>17384     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> event_size            Event <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> bytes including header
<a name="l17385"></a>17385   Output:
<a name="l17386"></a>17386     none
<a name="l17387"></a>17387   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l17388"></a>17388     <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>                Successful completion
<a name="l17389"></a>17389     <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>                    from <a class="code" href="group__msectionh.html#ga5ebc713e2f1e7f0b6d257f072221321f">bm_send_event</a> <span class="keywordflow">for</span> local connection
<a name="l17390"></a>17390 \********************************************************************/
<a name="l17391"></a>17391 {
<a name="l17392"></a>17392    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> aligned_event_size;
<a name="l17393"></a>17393 
<a name="l17394"></a>17394    <span class="comment">/* if not connected remotely, use bm_send_event */</span>
<a name="l17395"></a>17395    <span class="keywordflow">if</span> (<a class="code" href="group__midasincludecode.html#ga9a0004d9fa35de7910301011606b5f0f">_send_sock</a> == 0) {
<a name="l17396"></a>17396       *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a>-&gt;<a class="code" href="structDMEM__AREA.html#a67fc056e1bf7d0448f78f83073b5f659">pw</a>) = buffer_handle;
<a name="l17397"></a>17397       <span class="keywordflow">return</span> <a class="code" href="group__msectionh.html#ga5ebc713e2f1e7f0b6d257f072221321f">bm_send_event</a>(buffer_handle, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a>-&gt;<a class="code" href="structDMEM__AREA.html#a67fc056e1bf7d0448f78f83073b5f659">pw</a> + <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>), event_size, <a class="code" href="group__mdefineh.html#ga9ac82e856c7683e23553431e5224d5f4">SYNC</a>);
<a name="l17398"></a>17398    }
<a name="l17399"></a>17399    aligned_event_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(event_size);
<a name="l17400"></a>17400 
<a name="l17401"></a>17401    *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a>-&gt;<a class="code" href="structDMEM__AREA.html#a67fc056e1bf7d0448f78f83073b5f659">pw</a>) = buffer_handle;
<a name="l17402"></a>17402 
<a name="l17403"></a>17403    <span class="comment">/* adjust write pointer */</span>
<a name="l17404"></a>17404    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a>-&gt;<a class="code" href="structDMEM__AREA.html#a67fc056e1bf7d0448f78f83073b5f659">pw</a> += <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) + aligned_event_size;
<a name="l17405"></a>17405 
<a name="l17406"></a>17406    <span class="comment">/* adjust end pointer */</span>
<a name="l17407"></a>17407    <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a>-&gt;<a class="code" href="structDMEM__AREA.html#add1c92e3a0d8c5fa6a640625f460b247">pe</a> = <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a>-&gt;<a class="code" href="structDMEM__AREA.html#a67fc056e1bf7d0448f78f83073b5f659">pw</a>;
<a name="l17408"></a>17408 
<a name="l17409"></a>17409    <span class="keywordflow">return</span> <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>;
<a name="l17410"></a>17410 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga03576c1be56e282da205aba73fe58cd1"></a><!-- doxytag: member="midas.c::dm_task" ref="ga03576c1be56e282da205aba73fe58cd1" args="(void *pointer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> dm_task </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>pointer</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l17529">17529</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l17059">DMEM_BUFFER::action</a>, <a class="el" href="midas_8c_source.html#l17056">DMEM_BUFFER::area1</a>, <a class="el" href="midas_8c_source.html#l17057">DMEM_BUFFER::area2</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l00956">CM_SUCCESS</a>, <a class="el" href="midas_8c_source.html#l17249">dm_area_full()</a>, <a class="el" href="midas_8c_source.html#l17413">dm_buffer_send()</a>, <a class="el" href="midas_8c_source.html#l17039">DM_FLUSH</a>, <a class="el" href="midas_8c_source.html#l17041">DM_KILL</a>, <a class="el" href="midas_8c_source.html#l17040">DM_SEND</a>, <a class="el" href="midas_8c_source.html#l17050">DMEM_AREA::full</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8c_source.html#l17055">DMEM_BUFFER::pa</a>, <a class="el" href="midas_8c_source.html#l17062">DMEM_BUFFER::sem_flush</a>, <a class="el" href="midas_8c_source.html#l17061">DMEM_BUFFER::sem_send</a>, <a class="el" href="midas_8c_source.html#l17058">DMEM_BUFFER::serial</a>, <a class="el" href="midas_8c_source.html#l17051">DMEM_AREA::serial</a>, <a class="el" href="system_8c_source.html#l02265">ss_millitime()</a>, <a class="el" href="system_8c_source.html#l02091">ss_mutex_release()</a>, <a class="el" href="system_8c_source.html#l01980">ss_mutex_wait_for()</a>, <a class="el" href="system_8c_source.html#l02491">ss_sleep()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, and <a class="el" href="getHist_8cpp_source.html#l00057">timeout</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l17079">dm_buffer_create()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l17531"></a>17531          : <a class="code" href="group__msystemincludecode.html#ga79d27b9638dbf46e71ac68740fb74dce">dm_task</a>
<a name="l17532"></a>17532 
<a name="l17533"></a>17533   Purpose: async <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a> events doing a <span class="keywordtype">double</span> purpose:
<a name="l17534"></a>17534   a) <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a> full <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> <span class="keywordflow">if</span> <a class="code" href="patch__mevb_8cpp.html#a408216eef095a35ba3963fc6f4f4d7a8">found</a> (<a class="code" href="group__dmfunctionc.html#ga5549407af1c9eec127624ce87fc81320">DM_SEND</a>) <span class="keyword">set</span> <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> <a class="code" href="group__dmfunctionc.html#ga8caac1eaf0e5500e838cdfe7494ea08e">dm_active_full</a>
<a name="l17535"></a>17535   b) <a class="code" href="embedded_2mscb_8h.html#a0a9e9396972b76c5947592479860020d">flush</a> full areas (<a class="code" href="group__dmfunctionc.html#gab81b65f274d9966737804aba75cf4dce">DM_FLUSH</a>) <span class="keyword">set</span> <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> <a class="code" href="group__msystemincludecode.html#ga5f455cbb7d25f4d6e2c4c76f763b5fb3">dm_area_flush</a>
<a name="l17536"></a>17536   Input:
<a name="l17537"></a>17537   none
<a name="l17538"></a>17538   Output:
<a name="l17539"></a>17539   none
<a name="l17540"></a>17540   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l17541"></a>17541   none
<a name="l17542"></a>17542   \********************************************************************/
<a name="l17543"></a>17543 {
<a name="l17544"></a>17544 <span class="preprocessor">#ifdef DM_DUAL_THREAD</span>
<a name="l17545"></a>17545 <span class="preprocessor"></span>   <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>;
<a name="l17546"></a>17546 
<a name="l17547"></a>17547    printf(<span class="stringliteral">&quot;Semaphores initialization ... in areaSend &quot;</span>);
<a name="l17548"></a>17548    <span class="comment">/* Check or Wait for semaphore to be setup */</span>
<a name="l17549"></a>17549    timeout = <a class="code" href="group__msectionh.html#gaeb8fc912d50c2360588c50782b9c916d">ss_millitime</a>();
<a name="l17550"></a>17550    <span class="keywordflow">while</span> ((<a class="code" href="group__msectionh.html#gaeb8fc912d50c2360588c50782b9c916d">ss_millitime</a>() - timeout &lt; 3000) &amp;&amp; (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a613817d5524536ea66a1e220426f5c44">sem_send</a> == 0))
<a name="l17551"></a>17551       <a class="code" href="group__msectionh.html#gaaec652d8878ceb5ef38ad1ba2cbf7dec">ss_sleep</a>(200);
<a name="l17552"></a>17552    <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a613817d5524536ea66a1e220426f5c44">sem_send</a> == 0)
<a name="l17553"></a>17553       <span class="keywordflow">goto</span> kill;
<a name="l17554"></a>17554 
<a name="l17555"></a>17555 <span class="preprocessor">#ifdef OS_WINNT</span>
<a name="l17556"></a>17556 <span class="preprocessor"></span>   <span class="comment">/* necessary for true MUTEX (NT) get semaphore */</span>
<a name="l17557"></a>17557    <a class="code" href="group__msystemincludecode.html#gad3c6b30fd77b7be3d4d3d6db5f106b45">ss_mutex_wait_for</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#ab97ceaa38026b0b8188438a0849d48bf">sem_flush</a>, 0);
<a name="l17558"></a>17558 <span class="preprocessor">#endif</span>
<a name="l17559"></a>17559 <span class="preprocessor"></span>
<a name="l17560"></a>17560    <span class="comment">/* Main FOREVER LOOP */</span>
<a name="l17561"></a>17561    printf(<span class="stringliteral">&quot;task areaSend ready...\n&quot;</span>);
<a name="l17562"></a>17562    <span class="keywordflow">while</span> (1) {
<a name="l17563"></a>17563       <span class="keywordflow">if</span> (!<a class="code" href="group__msystemincludecode.html#ga51fc41cad927868b3349cfbd0a580b6a">dm_area_full</a>()) {
<a name="l17564"></a>17564          <span class="comment">/* wait semaphore here ........ 0 == forever */</span>
<a name="l17565"></a>17565          <a class="code" href="group__msystemincludecode.html#gad3c6b30fd77b7be3d4d3d6db5f106b45">ss_mutex_wait_for</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a613817d5524536ea66a1e220426f5c44">sem_send</a>, 0);
<a name="l17566"></a>17566 <span class="preprocessor">#ifdef OS_WINNT</span>
<a name="l17567"></a>17567 <span class="preprocessor"></span>         <span class="comment">/* necessary for true MUTEX (NT) give semaphore */</span>
<a name="l17568"></a>17568          <a class="code" href="group__msystemincludecode.html#gae9746bf50ec478e587bb9d981f8eb9da">ss_mutex_release</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a613817d5524536ea66a1e220426f5c44">sem_send</a>);
<a name="l17569"></a>17569 <span class="preprocessor">#endif</span>
<a name="l17570"></a>17570 <span class="preprocessor"></span>      }
<a name="l17571"></a>17571       <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a021faf69971b9ced3abaa3fee97ff729">action</a> == <a class="code" href="group__dmfunctionc.html#ga5549407af1c9eec127624ce87fc81320">DM_SEND</a>) {
<a name="l17572"></a>17572 <span class="preprocessor">#ifdef DM_DEBUG</span>
<a name="l17573"></a>17573 <span class="preprocessor"></span>         printf(<span class="stringliteral">&quot;Send %i %i &quot;</span>, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a>, <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a>);
<a name="l17574"></a>17574 <span class="preprocessor">#endif</span>
<a name="l17575"></a>17575 <span class="preprocessor"></span>         <span class="comment">/* DM_SEND : Empty the oldest buffer only. */</span>
<a name="l17576"></a>17576          <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a> &amp;&amp; <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a>) {
<a name="l17577"></a>17577             <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a> &lt;= <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a>)
<a name="l17578"></a>17578                status = <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>(&amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>);
<a name="l17579"></a>17579             <span class="keywordflow">else</span>
<a name="l17580"></a>17580                status = <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>(&amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>);
<a name="l17581"></a>17581          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a>)
<a name="l17582"></a>17582             status = <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>(&amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>);
<a name="l17583"></a>17583          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aef412cf7996a502110f02c5606daf080">full</a>)
<a name="l17584"></a>17584             status = <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>(&amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>);
<a name="l17585"></a>17585 
<a name="l17586"></a>17586          <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>) {
<a name="l17587"></a>17587             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;dm_task&quot;</span>, <span class="stringliteral">&quot;network error %i&quot;</span>, status);
<a name="l17588"></a>17588             <span class="keywordflow">goto</span> kill;
<a name="l17589"></a>17589          }
<a name="l17590"></a>17590       } <span class="comment">/* if DM_SEND */</span>
<a name="l17591"></a>17591       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a021faf69971b9ced3abaa3fee97ff729">action</a> == <a class="code" href="group__dmfunctionc.html#gab81b65f274d9966737804aba75cf4dce">DM_FLUSH</a>) {
<a name="l17592"></a>17592          <span class="comment">/* DM_FLUSH: User is waiting for completion (i.e. No more incomming</span>
<a name="l17593"></a>17593 <span class="comment">            events) Empty both area in order independently of being full or not */</span>
<a name="l17594"></a>17594          <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a> &lt;= <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a>) {
<a name="l17595"></a>17595             status = <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>(&amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>);
<a name="l17596"></a>17596             <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l17597"></a>17597                <span class="keywordflow">goto</span> error;
<a name="l17598"></a>17598             status = <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>(&amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>);
<a name="l17599"></a>17599             <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l17600"></a>17600                <span class="keywordflow">goto</span> error;
<a name="l17601"></a>17601          } <span class="keywordflow">else</span> {
<a name="l17602"></a>17602             status = <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>(&amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>);
<a name="l17603"></a>17603             <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l17604"></a>17604                <span class="keywordflow">goto</span> error;
<a name="l17605"></a>17605             status = <a class="code" href="group__dmfunctionc.html#gae8dcf8cbb9f23e671a94d52cfc6c7a38">dm_buffer_send</a>(&amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>);
<a name="l17606"></a>17606             <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l17607"></a>17607                <span class="keywordflow">goto</span> error;
<a name="l17608"></a>17608          }
<a name="l17609"></a>17609          <span class="comment">/* reset counter */</span>
<a name="l17610"></a>17610          <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a> = 0;
<a name="l17611"></a>17611          <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a091931c35c57ce1e2ac6bddc2bfaa4ec">area2</a>.<a class="code" href="structDMEM__AREA.html#aa8a9f84ab74666d14e2431d29a592c11">serial</a> = <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#ab93cfa2c2227b62e57da5d681a9bfb0b">serial</a> = 1;
<a name="l17612"></a>17612 <span class="preprocessor">#ifdef DM_DEBUG</span>
<a name="l17613"></a>17613 <span class="preprocessor"></span>         printf(<span class="stringliteral">&quot;dm.action: Flushing ...\n&quot;</span>);
<a name="l17614"></a>17614 <span class="preprocessor">#endif</span>
<a name="l17615"></a>17615 <span class="preprocessor"></span>         <span class="comment">/* reset area to #1 */</span>
<a name="l17616"></a>17616          <a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a83e5597197f5c0f26fb812d96178cbad">pa</a> = &amp;<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#af32b880aa4cf33993cbec0098d102cdc">area1</a>;
<a name="l17617"></a>17617 
<a name="l17618"></a>17618          <span class="comment">/* release user */</span>
<a name="l17619"></a>17619          <a class="code" href="group__msystemincludecode.html#gae9746bf50ec478e587bb9d981f8eb9da">ss_mutex_release</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#ab97ceaa38026b0b8188438a0849d48bf">sem_flush</a>);
<a name="l17620"></a>17620 <span class="preprocessor">#ifdef OS_WINNT</span>
<a name="l17621"></a>17621 <span class="preprocessor"></span>         <span class="comment">/* necessary for true MUTEX (NT) get semaphore back */</span>
<a name="l17622"></a>17622          <a class="code" href="group__msystemincludecode.html#gad3c6b30fd77b7be3d4d3d6db5f106b45">ss_mutex_wait_for</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#ab97ceaa38026b0b8188438a0849d48bf">sem_flush</a>, 0);
<a name="l17623"></a>17623 <span class="preprocessor">#endif</span>
<a name="l17624"></a>17624 <span class="preprocessor"></span>      }
<a name="l17625"></a>17625       <span class="comment">/* if FLUSH */</span>
<a name="l17626"></a>17626       <span class="keywordflow">if</span> (<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#a021faf69971b9ced3abaa3fee97ff729">action</a> == <a class="code" href="group__dmfunctionc.html#gaaad4b2930bb564eee3c5e5f1ced95456">DM_KILL</a>)
<a name="l17627"></a>17627          <span class="keywordflow">goto</span> kill;
<a name="l17628"></a>17628 
<a name="l17629"></a>17629    }                            <span class="comment">/* FOREVER (go back wainting for semaphore) */</span>
<a name="l17630"></a>17630 
<a name="l17631"></a>17631    <span class="comment">/* kill spawn now */</span>
<a name="l17632"></a>17632  error:
<a name="l17633"></a>17633    <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;dm_area_flush&quot;</span>, <span class="stringliteral">&quot;aSync Net error&quot;</span>);
<a name="l17634"></a>17634  kill:
<a name="l17635"></a>17635    <a class="code" href="group__msystemincludecode.html#gae9746bf50ec478e587bb9d981f8eb9da">ss_mutex_release</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#ab97ceaa38026b0b8188438a0849d48bf">sem_flush</a>);
<a name="l17636"></a>17636 <span class="preprocessor">#ifdef OS_WINNT</span>
<a name="l17637"></a>17637 <span class="preprocessor"></span>   <a class="code" href="group__msystemincludecode.html#gad3c6b30fd77b7be3d4d3d6db5f106b45">ss_mutex_wait_for</a>(<a class="code" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a>.<a class="code" href="structDMEM__BUFFER.html#ab97ceaa38026b0b8188438a0849d48bf">sem_flush</a>, 1);
<a name="l17638"></a>17638 <span class="preprocessor">#endif</span>
<a name="l17639"></a>17639 <span class="preprocessor"></span>   <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;areaSend&quot;</span>, <span class="stringliteral">&quot;task areaSend exiting now&quot;</span>);
<a name="l17640"></a>17640    exit;
<a name="l17641"></a>17641    <span class="keywordflow">return</span> 1;
<a name="l17642"></a>17642 <span class="preprocessor">#else</span>
<a name="l17643"></a>17643 <span class="preprocessor"></span>   printf(<span class="stringliteral">&quot;DM_DUAL_THREAD not defined\n&quot;</span>);
<a name="l17644"></a>17644    <span class="keywordflow">return</span> 0;
<a name="l17645"></a>17645 <span class="preprocessor">#endif</span>
<a name="l17646"></a>17646 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="gae70acaeeaae1443234dd5c4039a01d28"></a><!-- doxytag: member="midas.c::dm" ref="gae70acaeeaae1443234dd5c4039a01d28" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structDMEM__BUFFER.html">DMEM_BUFFER</a> <a class="el" href="group__dmfunctionc.html#gae70acaeeaae1443234dd5c4039a01d28">dm</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l17065">17065</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga2782b51e3126596ce3008dd84cf121c9"></a><!-- doxytag: member="midas.c::dm_user_max_event_size" ref="ga2782b51e3126596ce3008dd84cf121c9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="group__dmfunctionc.html#ga2782b51e3126596ce3008dd84cf121c9">dm_user_max_event_size</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l17066">17066</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 6 Jun 2014 for AlcapDAQ by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
