<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>AlcapDAQ: midas/utils/mlxspeaker.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>midas/utils/mlxspeaker.c File Reference</h1><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="midas_8h_source.html">midas.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="msystem_8h_source.html">msystem.h</a>&quot;</code><br/>

<p><a href="mlxspeaker_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mlxspeaker_8c.html#a5e61b352781bf76f845bf11562a17188">SPEECH_PROGRAM</a>&nbsp;&nbsp;&nbsp;&quot;festival --tts -&quot;</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mlxspeaker_8c.html#a0023e3559fd7dc0e06cd1e70ea8bf751">sigpipehandler</a> (int sig)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mlxspeaker_8c.html#a6da54cc7447797381dd9d13bff0a041b">siginthandler</a> (int sig)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mlxspeaker_8c.html#a505c1ebb853e0e7eb803c9d6a1fc5d78">receive_message</a> (<a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="el" href="minife_8c.html#ae7ddc6297773b75bea52d05c7a3ff5e5">hBuf</a>, <a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> id, <a class="el" href="structEVENT__HEADER.html">EVENT_HEADER</a> *header, void *message)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mlxspeaker_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static FILE *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a> = NULL</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mlxspeaker_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a> = FALSE</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mlxspeaker_8c.html#a1f7c516c18b476908510a60b87b068c1">mtUserStr</a> [128]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mlxspeaker_8c.html#a4b6430e263f4fccf8ab69ee82779cc8b">mtTalkStr</a> [128]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mlxspeaker_8c.html#aeffb35c8be86018a7f366b81bebf25ba">shutupTime</a> = 10</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a5e61b352781bf76f845bf11562a17188"></a><!-- doxytag: member="mlxspeaker.c::SPEECH_PROGRAM" ref="a5e61b352781bf76f845bf11562a17188" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SPEECH_PROGRAM&nbsp;&nbsp;&nbsp;&quot;festival --tts -&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mlxspeaker_8c_source.html#l00059">59</a> of file <a class="el" href="mlxspeaker_8c_source.html">mlxspeaker.c</a>.</p>

<p>Referenced by <a class="el" href="mlxspeaker_8c_source.html#l00143">main()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a0ddf1224851353fc92bfbff6f499fa97"></a><!-- doxytag: member="mlxspeaker.c::main" ref="a0ddf1224851353fc92bfbff6f499fa97" args="(int argc, char *argv[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>argv</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mlxspeaker_8c_source.html#l00143">143</a> of file <a class="el" href="mlxspeaker_8c_source.html">mlxspeaker.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02327">cm_connect_experiment()</a>, <a class="el" href="midas_8c_source.html#l02768">cm_disconnect_experiment()</a>, <a class="el" href="patch__mevb_8cpp.html#aa598123f60ccd5496f2421c7bf2fabbf">cm_get_environment()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8c_source.html#l01477">cm_msg_register()</a>, <a class="el" href="midas_8h_source.html#l00956">CM_SUCCESS</a>, <a class="el" href="midas_8c_source.html#l04166">cm_yield()</a>, <a class="el" href="mana_8cpp_source.html#l00665">daemon</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00333">debug</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mlxspeaker_8c_source.html#l00061">fp</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00327">host_name</a>, <a class="el" href="midas_8h_source.html#l00682">HOST_NAME_LENGTH</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="mlxspeaker_8c_source.html#l00063">mtTalkStr</a>, <a class="el" href="mlxspeaker_8c_source.html#l00063">mtUserStr</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="fal_8c_source.html#l04107">receive_message()</a>, <a class="el" href="midas_8h_source.html#l01075">RPC_SHUTDOWN</a>, <a class="el" href="mlxspeaker_8c_source.html#l00064">shutupTime</a>, <a class="el" href="mlxspeaker_8c_source.html#l00075">siginthandler()</a>, <a class="el" href="mlxspeaker_8c_source.html#l00067">sigpipehandler()</a>, <a class="el" href="mlxspeaker_8c_source.html#l00059">SPEECH_PROGRAM</a>, <a class="el" href="midas_8h_source.html#l01047">SS_ABORT</a>, <a class="el" href="system_8c_source.html#l01466">ss_daemon_init()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, and <a class="el" href="odb__check_8cc_source.html#l00011">usage()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00144"></a>00144 {
<a name="l00145"></a>00145    <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> <a class="code" href="mana_8cpp.html#a96203468e98720f55cbede5bb1f8cffe">daemon</a> = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00146"></a>00146    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l00147"></a>00147    <span class="keywordtype">char</span> <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>[<a class="code" href="group__midasincludecode.html#ga2010c9ed4ef21c3171de778157b9c494">HOST_NAME_LENGTH</a>];
<a name="l00148"></a>00148    <span class="keywordtype">char</span> <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>];
<a name="l00149"></a>00149    <span class="keywordtype">char</span> *speech_program = <a class="code" href="mlxspeaker_8c.html#a5e61b352781bf76f845bf11562a17188">SPEECH_PROGRAM</a>;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151    <span class="comment">/* get default from environment */</span>
<a name="l00152"></a>00152    <a class="code" href="patch__mevb_8cpp.html#aa598123f60ccd5496f2421c7bf2fabbf">cm_get_environment</a>(host_name, <span class="keyword">sizeof</span>(host_name), exp_name, <span class="keyword">sizeof</span>(exp_name));
<a name="l00153"></a>00153 
<a name="l00154"></a>00154    <span class="comment">/* parse command line parameters */</span>
<a name="l00155"></a>00155    <span class="keywordflow">for</span> (i = 1; i &lt; argc; i++) {
<a name="l00156"></a>00156       <span class="keywordflow">if</span> (argv[i][0] == <span class="charliteral">&apos;-&apos;</span> &amp;&amp; argv[i][1] == <span class="charliteral">&apos;d&apos;</span>)
<a name="l00157"></a>00157          <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a> = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00158"></a>00158       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argv[i][0] == <span class="charliteral">&apos;-&apos;</span> &amp;&amp; argv[i][1] == <span class="charliteral">&apos;D&apos;</span>)
<a name="l00159"></a>00159          daemon = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00160"></a>00160       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argv[i][0] == <span class="charliteral">&apos;-&apos;</span>) {
<a name="l00161"></a>00161          <span class="keywordflow">if</span> (i + 1 &gt;= argc || argv[i + 1][0] == <span class="charliteral">&apos;-&apos;</span>)
<a name="l00162"></a>00162             <span class="keywordflow">goto</span> <a class="code" href="odb__check_8cc.html#a2ef30c42cbc289d899a8be5d2d8f77d0">usage</a>;
<a name="l00163"></a>00163          <span class="keywordflow">if</span> (argv[i][1] == <span class="charliteral">&apos;e&apos;</span>)
<a name="l00164"></a>00164             strcpy(exp_name, argv[++i]);
<a name="l00165"></a>00165          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argv[i][1] == <span class="charliteral">&apos;h&apos;</span>)
<a name="l00166"></a>00166             strcpy(host_name, argv[++i]);
<a name="l00167"></a>00167          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argv[i][1] == <span class="charliteral">&apos;c&apos;</span>)
<a name="l00168"></a>00168             speech_program = argv[++i];
<a name="l00169"></a>00169          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argv[i][1] == <span class="charliteral">&apos;t&apos;</span>)
<a name="l00170"></a>00170             strcpy(<a class="code" href="mlxspeaker_8c.html#a4b6430e263f4fccf8ab69ee82779cc8b">mtTalkStr</a>, argv[++i]);
<a name="l00171"></a>00171          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argv[i][1] == <span class="charliteral">&apos;u&apos;</span>)
<a name="l00172"></a>00172             strcpy(<a class="code" href="mlxspeaker_8c.html#a1f7c516c18b476908510a60b87b068c1">mtUserStr</a>, argv[++i]);
<a name="l00173"></a>00173          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argv[i][1] == <span class="charliteral">&apos;s&apos;</span>)
<a name="l00174"></a>00174             <a class="code" href="mlxspeaker_8c.html#aeffb35c8be86018a7f366b81bebf25ba">shutupTime</a> = atoi(argv[++i]);
<a name="l00175"></a>00175          <span class="keywordflow">else</span> {
<a name="l00176"></a>00176           <a class="code" href="odb__check_8cc.html#a2ef30c42cbc289d899a8be5d2d8f77d0">usage</a>:
<a name="l00177"></a>00177             printf
<a name="l00178"></a>00178                 (<span class="stringliteral">&quot;usage: mlxspeaker [-h Hostname] [-e Experiment] [-c command] [-D] daemon\n&quot;</span>);
<a name="l00179"></a>00179             printf(<span class="stringliteral">&quot;                  [-t mt_talk] Specify the mt_talk alert command\n&quot;</span>);
<a name="l00180"></a>00180             printf(<span class="stringliteral">&quot;                  [-u mt_user] Specify the mt_user alert command\n&quot;</span>);
<a name="l00181"></a>00181             printf
<a name="l00182"></a>00182                 (<span class="stringliteral">&quot;                  [-s shut up time] Specify the min time interval between alert [s]\n&quot;</span>);
<a name="l00183"></a>00183             printf
<a name="l00184"></a>00184                 (<span class="stringliteral">&quot;                  The -t &amp; -u switch require a command equivalent to:\n&quot;</span>);
<a name="l00185"></a>00185             printf(<span class="stringliteral">&quot;                  &apos;-t play --volume=0.3 file.wav&apos;\n&quot;</span>);
<a name="l00186"></a>00186             printf
<a name="l00187"></a>00187                 (<span class="stringliteral">&quot;                  [-c command] Used to start the speech synthesizer,\n&quot;</span>);
<a name="l00188"></a>00188             printf
<a name="l00189"></a>00189                 (<span class="stringliteral">&quot;                              which should read text from it&apos;s standard input.\n&quot;</span>);
<a name="l00190"></a>00190             printf
<a name="l00191"></a>00191                 (<span class="stringliteral">&quot;                              eg: mlxspeaker -c &apos;festival --tts -&apos;\n\n&quot;</span>);
<a name="l00192"></a>00192             <span class="keywordflow">return</span> 0;
<a name="l00193"></a>00193          }
<a name="l00194"></a>00194       }
<a name="l00195"></a>00195    }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197    <span class="keywordflow">if</span> (daemon) {
<a name="l00198"></a>00198       printf(<span class="stringliteral">&quot;Becoming a daemon...\n&quot;</span>);
<a name="l00199"></a>00199       <a class="code" href="group__msystemincludecode.html#ga957613d29ce8b6e66f075ace4f32c1e1">ss_daemon_init</a>(<a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00200"></a>00200    }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202    <span class="comment">/* now connect to server */</span>
<a name="l00203"></a>00203    status = <a class="code" href="group__msectionh.html#gae12b15703f10f41044e599520e665f5a">cm_connect_experiment</a>(host_name, exp_name, <span class="stringliteral">&quot;Speaker&quot;</span>, NULL);
<a name="l00204"></a>00204    <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l00205"></a>00205       <span class="keywordflow">return</span> 1;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207    <a class="code" href="group__msectionh.html#ga73f40964dfd745537f41ce13fbcc2fa4">cm_msg_register</a>(<a class="code" href="fal_8c.html#a168945a222012d1d908c78a41e7022c2">receive_message</a>);
<a name="l00208"></a>00208 
<a name="l00209"></a>00209    <span class="comment">/* Handle SIGPIPE signals generated from errors on the pipe */</span>
<a name="l00210"></a>00210    signal(SIGPIPE, <a class="code" href="mlxspeaker_8c.html#a0023e3559fd7dc0e06cd1e70ea8bf751">sigpipehandler</a>);
<a name="l00211"></a>00211    signal(SIGINT, <a class="code" href="mlxspeaker_8c.html#a6da54cc7447797381dd9d13bff0a041b">siginthandler</a>);
<a name="l00212"></a>00212    <span class="keywordflow">if</span> (NULL == (<a class="code" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a> = popen(speech_program, <span class="stringliteral">&quot;w&quot;</span>))) {
<a name="l00213"></a>00213       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;Speaker&quot;</span>, <span class="stringliteral">&quot;Unable to start \&quot;%s\&quot;: %s\n&quot;</span>,
<a name="l00214"></a>00214              speech_program, strerror(errno));
<a name="l00215"></a>00215       <a class="code" href="group__msectionh.html#ga9792ed24b1150464250ac794067c9196">cm_disconnect_experiment</a>();
<a name="l00216"></a>00216       exit(2);
<a name="l00217"></a>00217    }
<a name="l00218"></a>00218 
<a name="l00219"></a>00219    printf(<span class="stringliteral">&quot;Midas Message Speaker connected to %s.\n&quot;</span>,
<a name="l00220"></a>00220           host_name[0] ? host_name : <span class="stringliteral">&quot;local host&quot;</span>);
<a name="l00221"></a>00221 
<a name="l00222"></a>00222    <span class="keywordflow">do</span> {
<a name="l00223"></a>00223       status = <a class="code" href="group__msectionh.html#gae234f64a7143ed2be1019e53613a6e85">cm_yield</a>(1000);
<a name="l00224"></a>00224    } <span class="keywordflow">while</span> (status != <a class="code" href="group__err25.html#ga0406ee07e8c5afbf8e46cb0eed698bcd">RPC_SHUTDOWN</a> &amp;&amp; status != <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a>);
<a name="l00225"></a>00225 
<a name="l00226"></a>00226    pclose(<a class="code" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>);
<a name="l00227"></a>00227 
<a name="l00228"></a>00228    <a class="code" href="group__msectionh.html#ga9792ed24b1150464250ac794067c9196">cm_disconnect_experiment</a>();
<a name="l00229"></a>00229    <span class="keywordflow">return</span> 1;
<a name="l00230"></a>00230 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a505c1ebb853e0e7eb803c9d6a1fc5d78"></a><!-- doxytag: member="mlxspeaker.c::receive_message" ref="a505c1ebb853e0e7eb803c9d6a1fc5d78" args="(HNDLE hBuf, HNDLE id, EVENT_HEADER *header, void *message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void receive_message </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a>&nbsp;</td>
          <td class="paramname"> <em>hBuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a>&nbsp;</td>
          <td class="paramname"> <em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structEVENT__HEADER.html">EVENT_HEADER</a> *&nbsp;</td>
          <td class="paramname"> <em>header</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>message</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mlxspeaker_8c_source.html#l00085">85</a> of file <a class="el" href="mlxspeaker_8c_source.html">mlxspeaker.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02768">cm_disconnect_experiment()</a>, <a class="el" href="midas_8h_source.html#l01195">EVENT_HEADER::data_size</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00333">debug</a>, <a class="el" href="midas_8h_source.html#l01191">EVENT_HEADER::event_id</a>, <a class="el" href="mlxspeaker_8c_source.html#l00061">fp</a>, <a class="el" href="midas_8h_source.html#l00929">MT_TALK</a>, <a class="el" href="midas_8h_source.html#l00927">MT_USER</a>, <a class="el" href="mlxspeaker_8c_source.html#l00063">mtTalkStr</a>, <a class="el" href="mlxspeaker_8c_source.html#l00063">mtUserStr</a>, <a class="el" href="midas_8h_source.html#l01193">EVENT_HEADER::serial_number</a>, <a class="el" href="mlxspeaker_8c_source.html#l00064">shutupTime</a>, <a class="el" href="system_8c_source.html#l02491">ss_sleep()</a>, <a class="el" href="group__msystemincludecode.html#ga7a14ecba483c2767fe699633d0bc677e">ss_system()</a>, <a class="el" href="system_8c_source.html#l02332">ss_time()</a>, and <a class="el" href="midas_8h_source.html#l01192">EVENT_HEADER::trigger_mask</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00086"></a>00086 {
<a name="l00087"></a>00087    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], *pc, *sp;
<a name="l00088"></a>00088    <span class="keyword">static</span> <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> last_beep = 0;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090    <span class="comment">/* print message */</span>
<a name="l00091"></a>00091    printf(<span class="stringliteral">&quot;%s\n&quot;</span>, (<span class="keywordtype">char</span> *) (<a class="code" href="examples_2macro_2midas__macro_8h.html#a408ca6b6abc64f4b82ea76d9a70dcacc">message</a>));
<a name="l00092"></a>00092 
<a name="l00093"></a>00093    <span class="keywordflow">if</span> (<a class="code" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a> == NULL) {
<a name="l00094"></a>00094       fputs(<span class="stringliteral">&quot;Speech synthesizer not enabled - terminating\n&quot;</span>, stderr);
<a name="l00095"></a>00095       <a class="code" href="group__msectionh.html#ga9792ed24b1150464250ac794067c9196">cm_disconnect_experiment</a>();
<a name="l00096"></a>00096       exit(2);
<a name="l00097"></a>00097    }
<a name="l00098"></a>00098 
<a name="l00099"></a>00099    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>) {
<a name="l00100"></a>00100       printf(<span class="stringliteral">&quot;evID:%hx Mask:%hx Serial:%li Size:%ld\n&quot;</span>, header-&gt;<a class="code" href="structEVENT__HEADER.html#a107bbb0fbe21582dc0f0e78f60b997b3">event_id</a>,
<a name="l00101"></a>00101              header-&gt;<a class="code" href="group__midasincludecode.html#ga9b4b94f41521f5c188655b7bb0f1ec1b">trigger_mask</a>, header-&gt;<a class="code" href="group__midasincludecode.html#ga5ed07c075ebce619a8fa47e96f188440">serial_number</a>, header-&gt;<a class="code" href="group__midasincludecode.html#ga194220c29419e01ef4cab6d3dd8daedb">data_size</a>);
<a name="l00102"></a>00102       pc = strchr((<span class="keywordtype">char</span> *) (<a class="code" href="examples_2macro_2midas__macro_8h.html#a408ca6b6abc64f4b82ea76d9a70dcacc">message</a>), <span class="charliteral">&apos;]&apos;</span>) + 2;
<a name="l00103"></a>00103    }
<a name="l00104"></a>00104 
<a name="l00105"></a>00105    <span class="comment">/* skip none talking message */</span>
<a name="l00106"></a>00106    <span class="keywordflow">if</span> (header-&gt;<a class="code" href="group__midasincludecode.html#ga9b4b94f41521f5c188655b7bb0f1ec1b">trigger_mask</a> == <a class="code" href="group__mdefineh.html#ga7d9c4230376d6527c7c8cd810eeb3e86">MT_TALK</a> || header-&gt;<a class="code" href="group__midasincludecode.html#ga9b4b94f41521f5c188655b7bb0f1ec1b">trigger_mask</a> == <a class="code" href="group__mdefineh.html#ga8e13ab6bdea106f548ecb162bdcd41a9">MT_USER</a>) {
<a name="l00107"></a>00107       pc = strchr((<span class="keywordtype">char</span> *) (<a class="code" href="examples_2macro_2midas__macro_8h.html#a408ca6b6abc64f4b82ea76d9a70dcacc">message</a>), <span class="charliteral">&apos;]&apos;</span>) + 2;
<a name="l00108"></a>00108       sp = pc + strlen(pc) - 1;
<a name="l00109"></a>00109       <span class="keywordflow">while</span> (*sp == <span class="charliteral">&apos; &apos;</span> || *sp == <span class="charliteral">&apos;\t&apos;</span>)
<a name="l00110"></a>00110          sp--;
<a name="l00111"></a>00111       *(++sp) = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00112"></a>00112       <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>) {
<a name="l00113"></a>00113          printf(<span class="stringliteral">&quot;&lt;%s&gt;&quot;</span>, pc);
<a name="l00114"></a>00114          printf(<span class="stringliteral">&quot; sending msg to festival\n&quot;</span>);
<a name="l00115"></a>00115       }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117       <span class="comment">/* Send beep first */</span>
<a name="l00118"></a>00118       <span class="comment">// &quot;play --volume=0.3 /etc/mt_talk.wav&quot;</span>
<a name="l00119"></a>00119       <span class="keywordflow">if</span> ((<a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>() - last_beep) &gt; <a class="code" href="mlxspeaker_8c.html#aeffb35c8be86018a7f366b81bebf25ba">shutupTime</a>) {
<a name="l00120"></a>00120          <span class="keywordflow">switch</span> (header-&gt;<a class="code" href="group__midasincludecode.html#ga9b4b94f41521f5c188655b7bb0f1ec1b">trigger_mask</a>) {
<a name="l00121"></a>00121          <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga7d9c4230376d6527c7c8cd810eeb3e86">MT_TALK</a>:
<a name="l00122"></a>00122             <span class="keywordflow">if</span> (<a class="code" href="mlxspeaker_8c.html#a4b6430e263f4fccf8ab69ee82779cc8b">mtTalkStr</a>[0])
<a name="l00123"></a>00123                sprintf(str, <a class="code" href="mlxspeaker_8c.html#a4b6430e263f4fccf8ab69ee82779cc8b">mtTalkStr</a>);
<a name="l00124"></a>00124             <span class="keywordflow">break</span>;
<a name="l00125"></a>00125          <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga8e13ab6bdea106f548ecb162bdcd41a9">MT_USER</a>:
<a name="l00126"></a>00126             <span class="keywordflow">if</span> (<a class="code" href="mlxspeaker_8c.html#a1f7c516c18b476908510a60b87b068c1">mtUserStr</a>[0])
<a name="l00127"></a>00127                sprintf(str, <a class="code" href="mlxspeaker_8c.html#a1f7c516c18b476908510a60b87b068c1">mtUserStr</a>);
<a name="l00128"></a>00128             <span class="keywordflow">break</span>;
<a name="l00129"></a>00129          }
<a name="l00130"></a>00130          <a class="code" href="group__msystemincludecode.html#ga7a14ecba483c2767fe699633d0bc677e">ss_system</a>(str);
<a name="l00131"></a>00131          last_beep = <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>();
<a name="l00132"></a>00132          <a class="code" href="group__msectionh.html#gaaec652d8878ceb5ef38ad1ba2cbf7dec">ss_sleep</a>(200);
<a name="l00133"></a>00133       }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135       fprintf(<a class="code" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>, <span class="stringliteral">&quot;%s.\n.\n&quot;</span>, pc);
<a name="l00136"></a>00136       fflush(<a class="code" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>);
<a name="l00137"></a>00137    }
<a name="l00138"></a>00138 
<a name="l00139"></a>00139    <span class="keywordflow">return</span>;
<a name="l00140"></a>00140 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6da54cc7447797381dd9d13bff0a041b"></a><!-- doxytag: member="mlxspeaker.c::siginthandler" ref="a6da54cc7447797381dd9d13bff0a041b" args="(int sig)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void siginthandler </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sig</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mlxspeaker_8c_source.html#l00075">75</a> of file <a class="el" href="mlxspeaker_8c_source.html">mlxspeaker.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02768">cm_disconnect_experiment()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="mlxspeaker_8c_source.html#l00061">fp</a>, and <a class="el" href="lrs1821_8h_source.html#l00221">MINFO</a>.</p>

<p>Referenced by <a class="el" href="mlxspeaker_8c_source.html#l00143">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00076"></a>00076 {
<a name="l00077"></a>00077    <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#a6e27d8876a43afce3ee4dd16527cbb9e">MINFO</a>, <span class="stringliteral">&quot;Speaker&quot;</span>, <span class="stringliteral">&quot;Speaker interrupted&quot;</span>);
<a name="l00078"></a>00078    <a class="code" href="group__msectionh.html#ga9792ed24b1150464250ac794067c9196">cm_disconnect_experiment</a>();
<a name="l00079"></a>00079    pclose(<a class="code" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>);
<a name="l00080"></a>00080    exit(0);
<a name="l00081"></a>00081 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0023e3559fd7dc0e06cd1e70ea8bf751"></a><!-- doxytag: member="mlxspeaker.c::sigpipehandler" ref="a0023e3559fd7dc0e06cd1e70ea8bf751" args="(int sig)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sigpipehandler </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sig</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mlxspeaker_8c_source.html#l00067">67</a> of file <a class="el" href="mlxspeaker_8c_source.html">mlxspeaker.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02768">cm_disconnect_experiment()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="mlxspeaker_8c_source.html#l00061">fp</a>, and <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>.</p>

<p>Referenced by <a class="el" href="mlxspeaker_8c_source.html#l00143">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00068"></a>00068 {
<a name="l00069"></a>00069    <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;Speaker&quot;</span>, <span class="stringliteral">&quot;No speech synthesizer attached&quot;</span>);
<a name="l00070"></a>00070    <a class="code" href="group__msectionh.html#ga9792ed24b1150464250ac794067c9196">cm_disconnect_experiment</a>();
<a name="l00071"></a>00071    pclose(<a class="code" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>);
<a name="l00072"></a>00072    exit(2);
<a name="l00073"></a>00073 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a81f0a890e023743f1b88d0cb7d4f74db"></a><!-- doxytag: member="mlxspeaker.c::debug" ref="a81f0a890e023743f1b88d0cb7d4f74db" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> <a class="el" href="mspeaker_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a> = FALSE</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mlxspeaker_8c_source.html#l00062">62</a> of file <a class="el" href="mlxspeaker_8c_source.html">mlxspeaker.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa065f30aa9f5f9a42132c82c787ee70b"></a><!-- doxytag: member="mlxspeaker.c::fp" ref="aa065f30aa9f5f9a42132c82c787ee70b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FILE* <a class="el" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a> = NULL<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mlxspeaker_8c_source.html#l00061">61</a> of file <a class="el" href="mlxspeaker_8c_source.html">mlxspeaker.c</a>.</p>

<p>Referenced by <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00453">epics_ca_connection_handler()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00567">epics_ca_event_handler()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00421">epics_ca_exception_handler()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l01837">epics_ca_exit()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l02384">epics_ca_get()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l02812">epics_ca_get_demand()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00777">epics_ca_init()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l01936">epics_ca_set()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00013">main()</a>, <a class="el" href="mlxspeaker_8c_source.html#l00085">receive_message()</a>, <a class="el" href="mlxspeaker_8c_source.html#l00075">siginthandler()</a>, and <a class="el" href="mlxspeaker_8c_source.html#l00067">sigpipehandler()</a>.</p>

</div>
</div>
<a class="anchor" id="a4b6430e263f4fccf8ab69ee82779cc8b"></a><!-- doxytag: member="mlxspeaker.c::mtTalkStr" ref="a4b6430e263f4fccf8ab69ee82779cc8b" args="[128]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="mspeaker_8c.html#a4b6430e263f4fccf8ab69ee82779cc8b">mtTalkStr</a>[128]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mlxspeaker_8c_source.html#l00063">63</a> of file <a class="el" href="mlxspeaker_8c_source.html">mlxspeaker.c</a>.</p>

<p>Referenced by <a class="el" href="mlxspeaker_8c_source.html#l00143">main()</a>, and <a class="el" href="mlxspeaker_8c_source.html#l00085">receive_message()</a>.</p>

</div>
</div>
<a class="anchor" id="a1f7c516c18b476908510a60b87b068c1"></a><!-- doxytag: member="mlxspeaker.c::mtUserStr" ref="a1f7c516c18b476908510a60b87b068c1" args="[128]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="mspeaker_8c.html#a1f7c516c18b476908510a60b87b068c1">mtUserStr</a>[128]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mlxspeaker_8c_source.html#l00063">63</a> of file <a class="el" href="mlxspeaker_8c_source.html">mlxspeaker.c</a>.</p>

<p>Referenced by <a class="el" href="mlxspeaker_8c_source.html#l00143">main()</a>, and <a class="el" href="mlxspeaker_8c_source.html#l00085">receive_message()</a>.</p>

</div>
</div>
<a class="anchor" id="aeffb35c8be86018a7f366b81bebf25ba"></a><!-- doxytag: member="mlxspeaker.c::shutupTime" ref="aeffb35c8be86018a7f366b81bebf25ba" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="mspeaker_8c.html#aeffb35c8be86018a7f366b81bebf25ba">shutupTime</a> = 10</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mlxspeaker_8c_source.html#l00064">64</a> of file <a class="el" href="mlxspeaker_8c_source.html">mlxspeaker.c</a>.</p>

<p>Referenced by <a class="el" href="mlxspeaker_8c_source.html#l00143">main()</a>, and <a class="el" href="mlxspeaker_8c_source.html#l00085">receive_message()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 6 Jun 2014 for AlcapDAQ by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
