<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>AlcapDAQ: CAEN/CAENUpgrader-1.4.1/CAENBridgeUpgrade/src/CFASegment.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>CAEN/CAENUpgrader-1.4.1/CAENBridgeUpgrade/src/CFASegment.c File Reference</h1><code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="cvUpgrade_2include_2CFASegment_8h_source.html">CFASegment.h</a>&quot;</code><br/>

<p><a href="CAENBridgeUpgrade_2src_2CFASegment_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="cvUpgrade_2include_2CFASegment_8h.html#aafdf88beb07b294651158bcae73246ed">CFASegmentPtr</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="CAENBridgeUpgrade_2src_2CFASegment_8c.html#af88d28234c6bb2b3a5d39672cf1ff02f">newSegment</a> (FILE *fin, int *<a class="el" href="MMuSCTimeDifferences_8cpp.html#a3579fbbede9d99d8d4aafc118b3abed3">last</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="CAENBridgeUpgrade_2src_2CFASegment_8c.html#aad8f25df0c0068878a32f42410f5a66a">deleteSegment</a> (<a class="el" href="cvUpgrade_2include_2CFASegment_8h.html#aafdf88beb07b294651158bcae73246ed">CFASegmentPtr</a> segm)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="CAENBridgeUpgrade_2src_2CFASegment_8c.html#a7d76102a08d07184ce4c7e67f2079551">getSegmentType</a> (<a class="el" href="cvUpgrade_2include_2CFASegment_8h.html#aafdf88beb07b294651158bcae73246ed">CFASegmentPtr</a> segm)</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aad8f25df0c0068878a32f42410f5a66a"></a><!-- doxytag: member="CFASegment.c::deleteSegment" ref="aad8f25df0c0068878a32f42410f5a66a" args="(CFASegmentPtr segm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void deleteSegment </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cvUpgrade_2include_2CFASegment_8h.html#aafdf88beb07b294651158bcae73246ed">CFASegmentPtr</a>&nbsp;</td>
          <td class="paramname"> <em>segm</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CAENBridgeUpgrade_2src_2CFASegment_8c_source.html#l00063">63</a> of file <a class="el" href="CAENBridgeUpgrade_2src_2CFASegment_8c_source.html">CFASegment.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00063"></a>00063                                        {
<a name="l00064"></a>00064         <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l00065"></a>00065         <span class="keywordflow">if</span> (<a class="code" href="CAENBridgeUpgrade_2inc_2CFASegment_8h.html#a7d76102a08d07184ce4c7e67f2079551">getSegmentType</a>(segm) == <a class="code" href="CAENBridgeUpgrade_2inc_2CFASegment_8h.html#a104cb8c42cdd3b4ed9e3bf90d788ff33ad2e1cc830200c3f6e5cc468e8d639008">CFA_SEGMENT_TYPE_1</a>) {
<a name="l00066"></a>00066                 <a class="code" href="structCFASegmentType1__t.html">CFASegmentType1</a>* t1s = <a class="code" href="CAENBridgeUpgrade_2inc_2CFASegment_8h.html#ad7c4fdb8eb5e667c602458d9a6035ccb">toType1</a>(segm);
<a name="l00067"></a>00067                 <span class="keywordflow">for</span> (i=0; i&lt;t1s-&gt;<a class="code" href="structCFASegmentType1__t.html#a93ea49ca2eb74cdd7a0d7a738589d98c">numModels</a>; i++)
<a name="l00068"></a>00068                         free(t1s-&gt;<a class="code" href="structCFASegmentType1__t.html#a4f73f199c1449b17b34772cdd1f37417">models</a>[i]);
<a name="l00069"></a>00069                 free(t1s-&gt;<a class="code" href="structCFASegmentType1__t.html#a4f73f199c1449b17b34772cdd1f37417">models</a>);
<a name="l00070"></a>00070         } <span class="keywordflow">else</span> {
<a name="l00071"></a>00071                 <a class="code" href="structCFASegmentType2__t.html">CFASegmentType2</a>* t2s = <a class="code" href="CAENBridgeUpgrade_2inc_2CFASegment_8h.html#aee923f1349cfae3bb1d51f92c1ee2483">toType2</a>(segm);
<a name="l00072"></a>00072                 <span class="keywordflow">for</span> (i=0; i&lt;t2s-&gt;<a class="code" href="structCFASegmentType2__t.html#a4e3b80e2765a8451e4ec63ecd595aa1b">numModels</a>; i++)
<a name="l00073"></a>00073                         free(t2s-&gt;<a class="code" href="structCFASegmentType2__t.html#a642b293af552e07a1f61dc066caa9e28">models</a>[i]);
<a name="l00074"></a>00074                 free(t2s-&gt;<a class="code" href="structCFASegmentType2__t.html#a642b293af552e07a1f61dc066caa9e28">models</a>);
<a name="l00075"></a>00075         }
<a name="l00076"></a>00076         free(segm);
<a name="l00077"></a>00077 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7d76102a08d07184ce4c7e67f2079551"></a><!-- doxytag: member="CFASegment.c::getSegmentType" ref="a7d76102a08d07184ce4c7e67f2079551" args="(CFASegmentPtr segm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int getSegmentType </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="cvUpgrade_2include_2CFASegment_8h.html#aafdf88beb07b294651158bcae73246ed">CFASegmentPtr</a>&nbsp;</td>
          <td class="paramname"> <em>segm</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CAENBridgeUpgrade_2src_2CFASegment_8c_source.html#l00079">79</a> of file <a class="el" href="CAENBridgeUpgrade_2src_2CFASegment_8c_source.html">CFASegment.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00079"></a>00079                                        {
<a name="l00080"></a>00080         <span class="keywordflow">return</span> <a class="code" href="CAENBridgeUpgrade_2inc_2CFASegment_8h.html#abdfd2811d026dfecd8d5bc46429becb7">toStub</a>(segm)-&gt;segmentTypeId &gt; <a class="code" href="CAENBridgeUpgrade_2inc_2CFASegment_8h.html#a21bdcb350725d07b6feac458123482be">TYPE_2_HEADER_VERSIONS</a> ? 1 : 2;
<a name="l00081"></a>00081 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af88d28234c6bb2b3a5d39672cf1ff02f"></a><!-- doxytag: member="CFASegment.c::newSegment" ref="af88d28234c6bb2b3a5d39672cf1ff02f" args="(FILE *fin, int *last)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="cvUpgrade_2include_2CFASegment_8h.html#aafdf88beb07b294651158bcae73246ed">CFASegmentPtr</a> newSegment </td>
          <td>(</td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>fin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>last</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="CAENBridgeUpgrade_2src_2CFASegment_8c_source.html#l00008">8</a> of file <a class="el" href="CAENBridgeUpgrade_2src_2CFASegment_8c_source.html">CFASegment.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00008"></a>00008                                                {
<a name="l00009"></a>00009         <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> stubSize = <span class="keyword">sizeof</span>(<a class="code" href="structCFASegmentStub__t.html">CFASegmentStub</a>);
<a name="l00010"></a>00010         <a class="code" href="CAENBridgeUpgrade_2inc_2CFASegment_8h.html#aafdf88beb07b294651158bcae73246ed">CFASegmentPtr</a> segm;
<a name="l00011"></a>00011         <a class="code" href="structCFASegmentStub__t.html">CFASegmentStub</a>* stub = malloc(stubSize);
<a name="l00012"></a>00012         fread(stub, 1, <span class="keyword">sizeof</span>(<a class="code" href="structCFASegmentStub__t.html">CFASegmentStub</a>), fin);
<a name="l00013"></a>00013 
<a name="l00014"></a>00014         <span class="keywordflow">if</span> (stub-&gt;<a class="code" href="structCFASegmentStub__t.html#a0f9e6ea70921c06709304d3bcbbdd31f">shebang</a> != <a class="code" href="CAENBridgeUpgrade_2inc_2CFASegment_8h.html#a23a07a9e18f821aeb696aa84870f6cd6">CFA_SHEBANG</a>) {
<a name="l00015"></a>00015                 free(stub);
<a name="l00016"></a>00016                 <span class="keywordflow">return</span> NULL;
<a name="l00017"></a>00017         }
<a name="l00018"></a>00018 
<a name="l00019"></a>00019         stub = realloc(stub, stub-&gt;<a class="code" href="structCFASegmentStub__t.html#abe87d4bb7473e57e60b14bf8e8ff6880">headerSizeBytes</a> + stub-&gt;<a class="code" href="structCFASegmentStub__t.html#ab4fd8285afdf32e861ca81f1b336115f">fwSizeBytes</a>);
<a name="l00020"></a>00020         fread((<span class="keywordtype">char</span>*)stub + stubSize, 1, stub-&gt;<a class="code" href="structCFASegmentStub__t.html#abe87d4bb7473e57e60b14bf8e8ff6880">headerSizeBytes</a> + stub-&gt;<a class="code" href="structCFASegmentStub__t.html#ab4fd8285afdf32e861ca81f1b336115f">fwSizeBytes</a> - stubSize, fin);
<a name="l00021"></a>00021         <span class="keywordflow">if</span> (<a class="code" href="CAENBridgeUpgrade_2inc_2CFASegment_8h.html#a7d76102a08d07184ce4c7e67f2079551">getSegmentType</a>(stub) == <a class="code" href="CAENBridgeUpgrade_2inc_2CFASegment_8h.html#a104cb8c42cdd3b4ed9e3bf90d788ff33ad2e1cc830200c3f6e5cc468e8d639008">CFA_SEGMENT_TYPE_1</a>) {
<a name="l00022"></a>00022                 <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, jump = 0;
<a name="l00023"></a>00023                 <a class="code" href="structCFASegmentType1__t.html">CFASegmentType1</a>* t1s = malloc(<span class="keyword">sizeof</span>(<a class="code" href="structCFASegmentType1__t.html">CFASegmentType1</a>));
<a name="l00024"></a>00024                 memcpy(t1s, stub, <span class="keyword">sizeof</span>(<a class="code" href="structCFASegmentType1__t.html">CFASegmentType1</a>));
<a name="l00025"></a>00025 
<a name="l00026"></a>00026                 t1s-&gt;<a class="code" href="structCFASegmentType1__t.html#a4f73f199c1449b17b34772cdd1f37417">models</a> = calloc(t1s-&gt;<a class="code" href="structCFASegmentType1__t.html#a93ea49ca2eb74cdd7a0d7a738589d98c">numModels</a>, <span class="keyword">sizeof</span>(<a class="code" href="structCFAModelType1__t.html">CFAModelType1</a>*));
<a name="l00027"></a>00027                 <span class="keywordflow">for</span> (i=0; i &lt; t1s-&gt;<a class="code" href="structCFASegmentType1__t.html#a93ea49ca2eb74cdd7a0d7a738589d98c">numModels</a>; i++) {
<a name="l00028"></a>00028                         <a class="code" href="structCFAModelType1__t.html">CFAModelType1</a>* first = (<a class="code" href="structCFAModelType1__t.html">CFAModelType1</a>*)((<span class="keywordtype">char</span>*)stub+stubSize+<a class="code" href="CAENBridgeUpgrade_2inc_2CFASegment_8h.html#a220570ceb7db0a65331bf1f46180f9b5">CFA_SEGMENT_T1_FAMILY_FIELDS_SIZE</a>);
<a name="l00029"></a>00029                         <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> = ((<a class="code" href="structCFAModelType1__t.html">CFAModelType1</a>*)((<span class="keywordtype">char</span>*)first + jump))-&gt;numChecks * 8 + 8;
<a name="l00030"></a>00030                         t1s-&gt;<a class="code" href="structCFASegmentType1__t.html#a4f73f199c1449b17b34772cdd1f37417">models</a>[i] = malloc(size);
<a name="l00031"></a>00031                         memcpy(t1s-&gt;<a class="code" href="structCFASegmentType1__t.html#a4f73f199c1449b17b34772cdd1f37417">models</a>[i], (<span class="keywordtype">char</span>*)first + jump, size);
<a name="l00032"></a>00032                         jump += size;
<a name="l00033"></a>00033                 }
<a name="l00034"></a>00034                 t1s-&gt;<a class="code" href="structCFASegmentType1__t.html#acaa9a8c3c6f2d5e592190ac462a507d8">fwData</a> = malloc(t1s-&gt;<a class="code" href="structCFASegmentType1__t.html#af9f0d69afda3cb4d97723f643f59dad5">fwSizeBytes</a>);
<a name="l00035"></a>00035                 memcpy(t1s-&gt;<a class="code" href="structCFASegmentType1__t.html#acaa9a8c3c6f2d5e592190ac462a507d8">fwData</a>, (<span class="keywordtype">char</span>*)stub+stub-&gt;<a class="code" href="structCFASegmentStub__t.html#abe87d4bb7473e57e60b14bf8e8ff6880">headerSizeBytes</a>, t1s-&gt;<a class="code" href="structCFASegmentType1__t.html#af9f0d69afda3cb4d97723f643f59dad5">fwSizeBytes</a>);
<a name="l00036"></a>00036                 segm = t1s;
<a name="l00037"></a>00037         } <span class="keywordflow">else</span> {
<a name="l00038"></a>00038                 <span class="keywordtype">int</span> i, jump = 0;
<a name="l00039"></a>00039                 <a class="code" href="structCFASegmentType2__t.html">CFASegmentType2</a>* t2s = malloc(<span class="keyword">sizeof</span>(<a class="code" href="structCFASegmentType2__t.html">CFASegmentType2</a>));
<a name="l00040"></a>00040                 memcpy(t2s, stub, <span class="keyword">sizeof</span>(<a class="code" href="structCFASegmentType2__t.html">CFASegmentType2</a>));
<a name="l00041"></a>00041 
<a name="l00042"></a>00042                 t2s-&gt;<a class="code" href="structCFASegmentType2__t.html#a642b293af552e07a1f61dc066caa9e28">models</a> = calloc(t2s-&gt;<a class="code" href="structCFASegmentType2__t.html#a4e3b80e2765a8451e4ec63ecd595aa1b">numModels</a>, <span class="keyword">sizeof</span>(<a class="code" href="structCFAModelType2__t.html">CFAModelType2</a>*));
<a name="l00043"></a>00043                 <span class="keywordflow">for</span> (i=0; i &lt; t2s-&gt;<a class="code" href="structCFASegmentType2__t.html#a4e3b80e2765a8451e4ec63ecd595aa1b">numModels</a>; i++) {
<a name="l00044"></a>00044                         <a class="code" href="structCFAModelType2__t.html">CFAModelType2</a>* first = (<a class="code" href="structCFAModelType2__t.html">CFAModelType2</a>*)((<span class="keywordtype">char</span>*)stub+stubSize);
<a name="l00045"></a>00045                         <span class="keywordtype">int</span> size = 4;
<a name="l00046"></a>00046                         t2s-&gt;<a class="code" href="structCFASegmentType2__t.html#a642b293af552e07a1f61dc066caa9e28">models</a>[i] = malloc(size);
<a name="l00047"></a>00047                         memcpy(t2s-&gt;<a class="code" href="structCFASegmentType2__t.html#a642b293af552e07a1f61dc066caa9e28">models</a>[i], (<span class="keywordtype">char</span>*)first + jump, size);
<a name="l00048"></a>00048                         jump += size;
<a name="l00049"></a>00049                 }
<a name="l00050"></a>00050                 t2s-&gt;<a class="code" href="structCFASegmentType2__t.html#a490ffcfa82d897102d8ca2af68a83cb0">fwData</a> = malloc(t2s-&gt;<a class="code" href="structCFASegmentType2__t.html#aab2e0582122256c42da004c87d50fb11">fwSizeBytes</a>);
<a name="l00051"></a>00051                 memcpy(t2s-&gt;<a class="code" href="structCFASegmentType2__t.html#a490ffcfa82d897102d8ca2af68a83cb0">fwData</a>, (<span class="keywordtype">char</span>*)stub+stub-&gt;<a class="code" href="structCFASegmentStub__t.html#abe87d4bb7473e57e60b14bf8e8ff6880">headerSizeBytes</a>, t2s-&gt;<a class="code" href="structCFASegmentType2__t.html#aab2e0582122256c42da004c87d50fb11">fwSizeBytes</a>);
<a name="l00052"></a>00052                 segm = t2s;
<a name="l00053"></a>00053         }
<a name="l00054"></a>00054 
<a name="l00055"></a>00055         <span class="keywordflow">if</span> (<a class="code" href="MFastSlowCorrelator_8cpp.html#a3579fbbede9d99d8d4aafc118b3abed3">last</a> != NULL) *<a class="code" href="MFastSlowCorrelator_8cpp.html#a3579fbbede9d99d8d4aafc118b3abed3">last</a> = stub-&gt;<a class="code" href="structCFASegmentStub__t.html#a19dc43d4f85db4f55808c11b60d3e7af">lastHeader</a>;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057         free(stub);
<a name="l00058"></a>00058 
<a name="l00059"></a>00059         <span class="keywordflow">return</span> segm;
<a name="l00060"></a>00060 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 6 Jun 2014 for AlcapDAQ by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
