<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>AlcapDAQ: midas/src/mhttpd.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>midas/src/mhttpd.c File Reference</h1><code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;assert.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="midas_8h_source.html">midas.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="msystem_8h_source.html">msystem.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="mgd_8h_source.html">mgd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="strlcpy_8h_source.html">strlcpy.h</a>&quot;</code><br/>

<p><a href="mhttpd_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a593d451015ade21d031d33c32d55afff">DEFAULT_REFRESH</a>&nbsp;&nbsp;&nbsp;60</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#aac223400fe4767d970ea758a4ab0c6be">CONNECT_TIME</a>&nbsp;&nbsp;&nbsp;3600*24</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a14692e25de0bb96f53774bcc08c39480">WEB_BUFFER_SIZE</a>&nbsp;&nbsp;&nbsp;10000000</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a36d20ba74425036fd66f863bb89adeda">MAX_GROUPS</a>&nbsp;&nbsp;&nbsp;32</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a5732be69f55a5dbbfa3df82d31314cb1">MAX_PARAM</a>&nbsp;&nbsp;&nbsp;100</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a7109febe139a7277e20652049ec9a1e1">VALUE_SIZE</a>&nbsp;&nbsp;&nbsp;256</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a8c2db22aa4cb56dced490e456bb9a91b">PARAM_LENGTH</a>&nbsp;&nbsp;&nbsp;256</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#afb6f36d91ffbf947cfa3f1114ca79764">TEXT_SIZE</a>&nbsp;&nbsp;&nbsp;50000</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>&nbsp;&nbsp;&nbsp;2.302585094</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a07267dcd6834194cfed517197ab1e2ad">LOG2</a>&nbsp;&nbsp;&nbsp;0.301029996</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a5a6825d23f0ed9ea6166b890404c0526">LOG5</a>&nbsp;&nbsp;&nbsp;0.698970005</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a5c707deff4e68c7283f2ed73665e0c77">MAX_VARS</a>&nbsp;&nbsp;&nbsp;10</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#af3853f14404bead7ea2dbfa3683b6f1b">show_hist_page</a> (char *path, char *<a class="el" href="mlogger_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, int *<a class="el" href="mlogger_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a>, int refresh)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a0c625fe56e336fc4d14a579b876b9fa8">rsputs</a> (const char *<a class="el" href="scs__310__ql355p_8c.html#a11ea5cf64ae27c357c5bd2f2eaaddf7f">str</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a3fc73195d7773ac70a09f5afb5588d5a">rsputs2</a> (const char *<a class="el" href="scs__310__ql355p_8c.html#a11ea5cf64ae27c357c5bd2f2eaaddf7f">str</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a> (const char *format,...)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a5c7f0ac1136d675f0150d443df5912ac">initparam</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a2956fb85032748af9fb7f544a4fb6c93">setparam</a> (char *<a class="el" href="mana__orig_8c.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>, char *<a class="el" href="odbhist_8c.html#a401da9cc2f96d4efd127de7463b69208">value</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a4372f772dfe8227a1033c1cf0baceb2b">getparam</a> (char *<a class="el" href="mana__orig_8c.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a4879491abfc24dbd22963a8b33f3f6ac">isparam</a> (char *<a class="el" href="mana__orig_8c.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#ad0587659617510bc64b05992882d7d9e">unsetparam</a> (char *<a class="el" href="mana__orig_8c.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a314e523b7d95b4a434216200167e5e0a">urlDecode</a> (char *<a class="el" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a477e33c685ba6ebcb9d429fb057c2760">urlEncode</a> (char *ps)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#aee05745e04f1ab703653cbc9fa9db30b">print_message</a> (const char *message)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a168945a222012d1d908c78a41e7022c2">receive_message</a> (<a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="el" href="minife_8c.html#ae7ddc6297773b75bea52d05c7a3ff5e5">hBuf</a>, <a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> id, <a class="el" href="structEVENT__HEADER.html">EVENT_HEADER</a> *pheader, void *message)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a42871a3e3778313e1f63deac5a41765b">sendmail</a> (char *smtp_host, char *from, char *to, char *subject, char *text)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a> (char *path)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a53eda54404f0531285b06ef8c48bbf9b">redirect2</a> (char *path)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#ad8887c77d8b39e96ce32b579f1f8b17b">search_callback</a> (<a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, <a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>, <a class="el" href="structKEY.html">KEY</a> *<a class="el" href="mzdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> level, void *info)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a754bb75919b1e2a9e934218bce65c472">show_help_page</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#ae5fb6c731656613ead122d173a8ef7a8">show_header</a> (<a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, char *<a class="el" href="plot__max_8c.html#ab683205367791ff60928e417b096d210">title</a>, char *method, char *path, int colspan, int refresh)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a> (char *error)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a877b1f25fb961fe82f80882e5500d5f5">exec_script</a> (<a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> hkey)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a3db9b2c2ff96ccddfa05fc7587e3d3c7">show_status_page</a> (int refresh, char *cookie_wpwd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#ae0a76abf95fa8e8bbc8cfa721c2e9e3e">show_messages_page</a> (int refresh, int n_message)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#af374dce40baae97a533a83a0626c23dc">strencode</a> (char *text)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a7497f3d4247306f2eabccaf53748ca43">strencode2</a> (char *b, char *text)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#ac66e5e8150fdd60c55a68d566f2f6228">strencode3</a> (char *text)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a20b81ae6551aa9bd26ecd6057d3442ab">show_elog_new</a> (char *path, <a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> bedit, char *odb_att)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a1ec76c094a5ba43c43a698f0f7d6b6e5">show_elog_query</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a40f54436b506f13b7935d4125538de5f">show_elog_delete</a> (char *path)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#aa7c5a2983f221f65fb6415ab1fadce70">show_elog_submit_query</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> last_n)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#abe470e8b895f261f77a887fb45b67b1b">show_rawfile</a> (char *path)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#af66885df3b396f0b6193e07753159c2d">show_form_query</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a58b44d117968b2a7b75adb40f95ea5bf">gen_odb_attachment</a> (char *path, char *b)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a7da098af5efaf5b7e9f01e8d8a3d019a">submit_elog</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a79eec108616ceddc04c6dcb076387aea">submit_form</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a6e9bc2cc0beb7aaf1d47824927dab3ff">show_elog_page</a> (char *path)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a085b231653bb8eb34d8b17f5a77f8f9c">is_editable</a> (char *eq_name, char *<a class="el" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a600f971ed8a8bda53571f0c1dc027cf7">show_sc_page</a> (char *path, int refresh)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a041225e513adf2156dc7a18de1d315b9">find_odb_tag</a> (char *<a class="el" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>, char *path, <a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> *edit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a799152cab54c105194a1c2bae2f8be0d">show_custom_page</a> (char *path)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a45884f36341a7c919978b7b5bb20a707">show_cnaf_page</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a3b0a144daa9f2395fbba48e847a4e6d6">show_experiment_page</a> (char exp_list[MAX_EXPERIMENT][NAME_LENGTH])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#ada74df02203a2fd3f1ca5b1f8f5d6152">show_password_page</a> (char *password, char *experiment)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a> (char *password, char *redir, char *experiment)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#abd8300ac3ea05f7225a591cbb6255fd0">show_start_page</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a457c736466c7c7ddd14880114a4838e4">show_odb_page</a> (char *enc_path, char *dec_path)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a9ff6a4fe23af7c7a7a09b39837d2cae1">show_set_page</a> (char *enc_path, char *dec_path, char *group, int <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, char *<a class="el" href="odbhist_8c.html#a401da9cc2f96d4efd127de7463b69208">value</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a428671e131872ee405c8b4d799ee1ffe">show_find_page</a> (char *enc_path, char *<a class="el" href="odbhist_8c.html#a401da9cc2f96d4efd127de7463b69208">value</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a87a3ec0b2c08a90fcd315682c7535d65">show_create_page</a> (char *enc_path, char *dec_path, char *<a class="el" href="odbhist_8c.html#a401da9cc2f96d4efd127de7463b69208">value</a>, int <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, int <a class="el" href="ybos_8c.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#ae0eb46ef9cdaf5808d30ed86801578ae">show_delete_page</a> (char *enc_path, char *dec_path, char *<a class="el" href="odbhist_8c.html#a401da9cc2f96d4efd127de7463b69208">value</a>, int <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a678e9238f0cdc3868dfdc4270f353dc1">show_alarm_page</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a52835fe4a232ad6286c9734a7283ec47">show_programs_page</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a9e638d1c512b1e5cfad4ff5908bc92bd">show_config_page</a> (int refresh)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a14e760bd59a14702edf8a7fdd2469dfc">haxis</a> (<a class="el" href="structgdImageStruct.html">gdImagePtr</a> im, <a class="el" href="structgdFont.html">gdFont</a> *font, int col, int gcol, int x1, int y1, int <a class="el" href="TOnlineFrame_8h.html#a2474a5474cbff19523a51eb1de01cda4">width</a>, int minor, int major, int text, int label, int grid, double xmin, double xmax)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a9602d6d6719f5884ac3a8433c6b65daf">sec_to_label</a> (char *result, int sec, int base, int force_date)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a777d92b7262b97dd454477828f8df20a">taxis</a> (<a class="el" href="structgdImageStruct.html">gdImagePtr</a> im, <a class="el" href="structgdFont.html">gdFont</a> *font, int col, int gcol, int x1, int y1, int <a class="el" href="TOnlineFrame_8h.html#a2474a5474cbff19523a51eb1de01cda4">width</a>, int xr, int minor, int major, int text, int label, int grid, double xmin, double xmax)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a64e35192402b30fb1908344ff3bc5376">vaxis</a> (<a class="el" href="structgdImageStruct.html">gdImagePtr</a> im, <a class="el" href="structgdFont.html">gdFont</a> *font, int col, int gcol, int x1, int y1, int <a class="el" href="TOnlineFrame_8h.html#a2474a5474cbff19523a51eb1de01cda4">width</a>, int minor, int major, int text, int label, int grid, double ymin, double ymax, <a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> logaxis)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a0f7449df3cdf1d111e5c926dc798180b">time_to_sec</a> (char *<a class="el" href="scs__310__ql355p_8c.html#a11ea5cf64ae27c357c5bd2f2eaaddf7f">str</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a9506713463026c887f8d19f1c6a5ea20">generate_hist_graph</a> (char *path, char *<a class="el" href="mlogger_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, int *<a class="el" href="mlogger_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a>, int <a class="el" href="TOnlineFrame_8h.html#a2474a5474cbff19523a51eb1de01cda4">width</a>, int <a class="el" href="TOnlineFrame_8h.html#ad12fc34ce789bce6c8a05d8a17138534">height</a>, int scale, int toffset, int <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, int labels)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a3b49c186437b81cc90e327008cf6293d">show_query_page</a> (char *path)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a5295c3eb3d85123c2f79dcdebf08a3a3">show_hist_config_page</a> (char *path)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#aa3da171cf30e675712502fc31255ba5a">get_password</a> (char *password)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a80b8d04dd00609fbbfd7a0bf3ce3b344">interprete</a> (char *cookie_pwd, char *cookie_wpwd, char *path, int refresh)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#aaddf7ad60b9dae7dc77b918cf2a8f237">decode_get</a> (char *<a class="el" href="scs__310__ql355p_8c.html#a2fcb7c4c10b2f35fc53f00938f78dcc1">string</a>, char *cookie_pwd, char *cookie_wpwd, int refresh)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#adc4d5a162cde09d0bf6521469eca7dd3">decode_post</a> (char *header, char *<a class="el" href="scs__310__ql355p_8c.html#a2fcb7c4c10b2f35fc53f00938f78dcc1">string</a>, char *boundary, int <a class="el" href="TPCW_8h.html#a9f59b34b1f25fe00023291b678246bcc">length</a>, char *cookie_pwd, char *cookie_wpwd, int refresh)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a5ace87cacf3af691fcc4e3c0fcee2457">ctrlc_handler</a> (int sig)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a2d0768b06b700bb79b874bd19ba4ec6f">server_loop</a> (int <a class="el" href="mana__orig_8c.html#a96203468e98720f55cbede5bb1f8cffe">daemon</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a> [WEB_BUFFER_SIZE]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a518fedf43db3f1313f9c88b2009380b5">return_length</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#af30d16605d5c80183cd199983a653081">host_name</a> [256]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a2f66ab590c0bf6aa5385f2c964eef5fe">exp_name</a> [32]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#abc82b64a25110404c4a845a5e969b348">connected</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a62893d3a883339864af5371490807e54">no_disconnect</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#aa9edbe9dd2977e5cc56138a3a05f7a98">tcp_port</a> = 80</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a8d769c1a97fec55473c5f591221dea4c">_param</a> [MAX_PARAM][PARAM_LENGTH]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#abcd78d8c212e69ce3b664c10cfabf5f6">_value</a> [MAX_PARAM][VALUE_SIZE]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a81d95c442aeb0cc03e6fb077222a9a2b">_text</a> [TEXT_SIZE]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a4d08376c0479b1115d6c07cf263459af">_attachment_buffer</a> [3]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a42dc7c4c704ca581c25ba7582da7e05e">_attachment_size</a> [3]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct in_addr&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#ae4c6d44dc33d45aceef3c6b589414715">remote_addr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a22283e600d5dd8c6c363cccd5adc2529">_sock</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a9c91f81733a48f1fbc887b013ee0de14">elog_mode</a> = FALSE</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#ad023bbf13e60f8caee82c26f70e0f0a5">verbose</a> = FALSE</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a204c9ddc30d18e95a386f1e6734e66f4">type_list</a> [20][NAME_LENGTH]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a63288067ecc0045da645c023c6867ecc">system_list</a> [20][NAME_LENGTH]</td></tr>
<tr><td class="memItemLeft" >struct {</td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;char&nbsp;&nbsp;&nbsp;<a class="el" href="mhttpd_8c.html#acbbdcdfacfc8c43d7d6ba5412ea70365">ext</a> [32]</td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;char&nbsp;&nbsp;&nbsp;<a class="el" href="mhttpd_8c.html#a9acf1fefc6ac2287c48bfac44b8f3b81">type</a> [32]</td></tr>
<tr><td class="memItemLeft" valign="top">}&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#ab9ec7b8b41990fd9f8dc4d6167c0dc4c">filetype</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#acdef68f81e8b732531ba7f1de9d73fc5">message_buffer</a> [256] = &quot;&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#aacdbc1e91899f516cd3947ea81b373ac">_abort</a> = FALSE</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mhttpd_8c.html#a203be81bafae956e5d4d101154c3528e">net_buffer</a> [WEB_BUFFER_SIZE]</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="aac223400fe4767d970ea758a4ab0c6be"></a><!-- doxytag: member="mhttpd.c::CONNECT_TIME" ref="aac223400fe4767d970ea758a4ab0c6be" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CONNECT_TIME&nbsp;&nbsp;&nbsp;3600*24</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00865">865</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09964">server_loop()</a>.</p>

</div>
</div>
<a class="anchor" id="a593d451015ade21d031d33c32d55afff"></a><!-- doxytag: member="mhttpd.c::DEFAULT_REFRESH" ref="a593d451015ade21d031d33c32d55afff" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_REFRESH&nbsp;&nbsp;&nbsp;60</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00862">862</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09964">server_loop()</a>.</p>

</div>
</div>
<a class="anchor" id="a0b731aa35652c377dc6f58cd42969440"></a><!-- doxytag: member="mhttpd.c::LN10" ref="a0b731aa35652c377dc6f58cd42969440" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LN10&nbsp;&nbsp;&nbsp;2.302585094</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l06806">6806</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l07289">generate_hist_graph()</a>, <a class="el" href="mhttpd_8c_source.html#l06810">haxis()</a>, and <a class="el" href="mhttpd_8c_source.html#l07082">vaxis()</a>.</p>

</div>
</div>
<a class="anchor" id="a07267dcd6834194cfed517197ab1e2ad"></a><!-- doxytag: member="mhttpd.c::LOG2" ref="a07267dcd6834194cfed517197ab1e2ad" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOG2&nbsp;&nbsp;&nbsp;0.301029996</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l06807">6807</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l06810">haxis()</a>, and <a class="el" href="mhttpd_8c_source.html#l07082">vaxis()</a>.</p>

</div>
</div>
<a class="anchor" id="a5a6825d23f0ed9ea6166b890404c0526"></a><!-- doxytag: member="mhttpd.c::LOG5" ref="a5a6825d23f0ed9ea6166b890404c0526" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOG5&nbsp;&nbsp;&nbsp;0.698970005</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l06808">6808</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l06810">haxis()</a>, and <a class="el" href="mhttpd_8c_source.html#l07082">vaxis()</a>.</p>

</div>
</div>
<a class="anchor" id="a36d20ba74425036fd66f863bb89adeda"></a><!-- doxytag: member="mhttpd.c::MAX_GROUPS" ref="a36d20ba74425036fd66f863bb89adeda" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_GROUPS&nbsp;&nbsp;&nbsp;32</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00878">878</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l04659">show_sc_page()</a>.</p>

</div>
</div>
<a class="anchor" id="a5732be69f55a5dbbfa3df82d31314cb1"></a><!-- doxytag: member="mhttpd.c::MAX_PARAM" ref="a5732be69f55a5dbbfa3df82d31314cb1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_PARAM&nbsp;&nbsp;&nbsp;100</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00879">879</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l01072">getparam()</a>, <a class="el" href="mhttpd_8c_source.html#l01089">isparam()</a>, <a class="el" href="mhttpd_8c_source.html#l01042">setparam()</a>, and <a class="el" href="mhttpd_8c_source.html#l01103">unsetparam()</a>.</p>

</div>
</div>
<a class="anchor" id="a5c707deff4e68c7283f2ed73665e0c77"></a><!-- doxytag: member="mhttpd.c::MAX_VARS" ref="a5c707deff4e68c7283f2ed73665e0c77" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_VARS&nbsp;&nbsp;&nbsp;10</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l07287">7287</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l07289">generate_hist_graph()</a>.</p>

</div>
</div>
<a class="anchor" id="a8c2db22aa4cb56dced490e456bb9a91b"></a><!-- doxytag: member="mhttpd.c::PARAM_LENGTH" ref="a8c2db22aa4cb56dced490e456bb9a91b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PARAM_LENGTH&nbsp;&nbsp;&nbsp;256</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00881">881</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

</div>
</div>
<a class="anchor" id="afb6f36d91ffbf947cfa3f1114ca79764"></a><!-- doxytag: member="mhttpd.c::TEXT_SIZE" ref="afb6f36d91ffbf947cfa3f1114ca79764" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TEXT_SIZE&nbsp;&nbsp;&nbsp;50000</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00882">882</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>, <a class="el" href="mhttpd_8c_source.html#l01203">sendmail()</a>, <a class="el" href="mhttpd_8c_source.html#l01042">setparam()</a>, <a class="el" href="mhttpd_8c_source.html#l05192">show_custom_page()</a>, <a class="el" href="mhttpd_8c_source.html#l05737">show_odb_page()</a>, and <a class="el" href="mhttpd_8c_source.html#l05983">show_set_page()</a>.</p>

</div>
</div>
<a class="anchor" id="a7109febe139a7277e20652049ec9a1e1"></a><!-- doxytag: member="mhttpd.c::VALUE_SIZE" ref="a7109febe139a7277e20652049ec9a1e1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VALUE_SIZE&nbsp;&nbsp;&nbsp;256</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00880">880</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l01042">setparam()</a>.</p>

</div>
</div>
<a class="anchor" id="a14692e25de0bb96f53774bcc08c39480"></a><!-- doxytag: member="mhttpd.c::WEB_BUFFER_SIZE" ref="a14692e25de0bb96f53774bcc08c39480" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WEB_BUFFER_SIZE&nbsp;&nbsp;&nbsp;10000000</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00868">868</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a9052568c642211164edb866e3193e120"></a><!-- doxytag: member="mhttpd.c::check_web_password" ref="a9052568c642211164edb866e3193e120" args="(char *password, char *redir, char *experiment)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> check_web_password </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>password</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>redir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>experiment</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l05587">5587</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05588"></a>05588 {
<a name="l05589"></a>05589    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey;
<a name="l05590"></a>05590    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l05591"></a>05591    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l05592"></a>05592 
<a name="l05593"></a>05593    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l05594"></a>05594 
<a name="l05595"></a>05595    <span class="comment">/* check for password */</span>
<a name="l05596"></a>05596    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Security/Web Password&quot;</span>, &amp;hkey);
<a name="l05597"></a>05597    <span class="keywordflow">if</span> (hkey) {
<a name="l05598"></a>05598       size = <span class="keyword">sizeof</span>(str);
<a name="l05599"></a>05599       <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l05600"></a>05600       <span class="keywordflow">if</span> (strcmp(password, str) == 0)
<a name="l05601"></a>05601          <span class="keywordflow">return</span> <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l05602"></a>05602 
<a name="l05603"></a>05603       <span class="comment">/* show web password page */</span>
<a name="l05604"></a>05604       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l05605"></a>05605       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l05606"></a>05606       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l05607"></a>05607 
<a name="l05608"></a>05608       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Enter password&lt;/title&gt;&lt;/head&gt;&lt;body&gt;\n\n&quot;</span>);
<a name="l05609"></a>05609 
<a name="l05610"></a>05610       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;form method=\&quot;GET\&quot; action=\&quot;/\&quot;&gt;\n\n&quot;</span>);
<a name="l05611"></a>05611 
<a name="l05612"></a>05612       <span class="comment">/* define hidden fields for current experiment and destination */</span>
<a name="l05613"></a>05613       <span class="keywordflow">if</span> (experiment[0])
<a name="l05614"></a>05614          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=exp value=\&quot;%s\&quot;&gt;\n&quot;</span>, experiment);
<a name="l05615"></a>05615       <span class="keywordflow">if</span> (redir[0])
<a name="l05616"></a>05616          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=redir value=\&quot;%s\&quot;&gt;\n&quot;</span>, redir);
<a name="l05617"></a>05617 
<a name="l05618"></a>05618       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;table border=1 cellpadding=5&gt;&quot;</span>);
<a name="l05619"></a>05619 
<a name="l05620"></a>05620       <span class="keywordflow">if</span> (password[0])
<a name="l05621"></a>05621          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#FF0000&gt;Wrong password!&lt;/tr&gt;\n&quot;</span>);
<a name="l05622"></a>05622 
<a name="l05623"></a>05623       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05624"></a>05624           (<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#A0A0FF&gt;Please enter password to obtain write access&lt;/tr&gt;\n&quot;</span>);
<a name="l05625"></a>05625       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=center&gt;&lt;input type=password name=wpwd&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l05626"></a>05626       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=center&gt;&lt;input type=submit value=Submit&gt;&lt;/tr&gt;&quot;</span>);
<a name="l05627"></a>05627 
<a name="l05628"></a>05628       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>);
<a name="l05629"></a>05629 
<a name="l05630"></a>05630       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l05631"></a>05631 
<a name="l05632"></a>05632       <span class="keywordflow">return</span> <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l05633"></a>05633    } <span class="keywordflow">else</span>
<a name="l05634"></a>05634       <span class="keywordflow">return</span> <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l05635"></a>05635 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5ace87cacf3af691fcc4e3c0fcee2457"></a><!-- doxytag: member="mhttpd.c::ctrlc_handler" ref="a5ace87cacf3af691fcc4e3c0fcee2457" args="(int sig)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ctrlc_handler </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sig</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l09955">9955</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mhttpd_8c_source.html#l09953">_abort</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09964">server_loop()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09956"></a>09956 {
<a name="l09957"></a>09957    <a class="code" href="mhttpd_8c.html#aacdbc1e91899f516cd3947ea81b373ac">_abort</a> = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l09958"></a>09958 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaddf7ad60b9dae7dc77b918cf2a8f237"></a><!-- doxytag: member="mhttpd.c::decode_get" ref="aaddf7ad60b9dae7dc77b918cf2a8f237" args="(char *string, char *cookie_pwd, char *cookie_wpwd, int refresh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void decode_get </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>cookie_pwd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>cookie_wpwd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>refresh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l09800">9800</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mhttpd_8c_source.html#l01035">initparam()</a>, <a class="el" href="mscbmain_8c_source.html#l00704">interprete()</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="mhttpd_8c_source.html#l01042">setparam()</a>, and <a class="el" href="mhttpd_8c_source.html#l01119">urlDecode()</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09964">server_loop()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09801"></a>09801 {
<a name="l09802"></a>09802    <span class="keywordtype">char</span> path[256];
<a name="l09803"></a>09803    <span class="keywordtype">char</span> *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>, *pitem;
<a name="l09804"></a>09804 
<a name="l09805"></a>09805    <a class="code" href="mhttpd_8c.html#a5c7f0ac1136d675f0150d443df5912ac">initparam</a>();
<a name="l09806"></a>09806 
<a name="l09807"></a>09807    strncpy(path, <span class="keywordtype">string</span> + 1, <span class="keyword">sizeof</span>(path));     <span class="comment">/* strip leading &apos;/&apos; */</span>
<a name="l09808"></a>09808    path[255] = 0;
<a name="l09809"></a>09809    <span class="keywordflow">if</span> (strchr(path, <span class="charliteral">&apos;?&apos;</span>))
<a name="l09810"></a>09810       *strchr(path, <span class="charliteral">&apos;?&apos;</span>) = 0;
<a name="l09811"></a>09811    <a class="code" href="mhttpd_8c.html#a2956fb85032748af9fb7f544a4fb6c93">setparam</a>(<span class="stringliteral">&quot;path&quot;</span>, path);
<a name="l09812"></a>09812 
<a name="l09813"></a>09813    <span class="keywordflow">if</span> (strchr(<span class="keywordtype">string</span>, <span class="charliteral">&apos;?&apos;</span>)) {
<a name="l09814"></a>09814       p = strchr(<span class="keywordtype">string</span>, <span class="charliteral">&apos;?&apos;</span>) + 1;
<a name="l09815"></a>09815 
<a name="l09816"></a>09816       <span class="comment">/* cut trailing &quot;/&quot; from netscape */</span>
<a name="l09817"></a>09817       <span class="keywordflow">if</span> (p[strlen(p) - 1] == <span class="charliteral">&apos;/&apos;</span>)
<a name="l09818"></a>09818          p[strlen(p) - 1] = 0;
<a name="l09819"></a>09819 
<a name="l09820"></a>09820       p = strtok(p, <span class="stringliteral">&quot;&amp;&quot;</span>);
<a name="l09821"></a>09821       <span class="keywordflow">while</span> (p != NULL) {
<a name="l09822"></a>09822          pitem = p;
<a name="l09823"></a>09823          p = strchr(p, <span class="charliteral">&apos;=&apos;</span>);
<a name="l09824"></a>09824          <span class="keywordflow">if</span> (p != NULL) {
<a name="l09825"></a>09825             *p++ = 0;
<a name="l09826"></a>09826             <a class="code" href="mhttpd_8c.html#a314e523b7d95b4a434216200167e5e0a">urlDecode</a>(pitem);
<a name="l09827"></a>09827             <a class="code" href="mhttpd_8c.html#a314e523b7d95b4a434216200167e5e0a">urlDecode</a>(p);
<a name="l09828"></a>09828 
<a name="l09829"></a>09829             <a class="code" href="mhttpd_8c.html#a2956fb85032748af9fb7f544a4fb6c93">setparam</a>(pitem, p);
<a name="l09830"></a>09830 
<a name="l09831"></a>09831             p = strtok(NULL, <span class="stringliteral">&quot;&amp;&quot;</span>);
<a name="l09832"></a>09832          }
<a name="l09833"></a>09833       }
<a name="l09834"></a>09834    }
<a name="l09835"></a>09835 
<a name="l09836"></a>09836    <a class="code" href="mscbmain_8c.html#a2331a26017e5f759388bb66d56bf065b">interprete</a>(cookie_pwd, cookie_wpwd, path, refresh);
<a name="l09837"></a>09837 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adc4d5a162cde09d0bf6521469eca7dd3"></a><!-- doxytag: member="mhttpd.c::decode_post" ref="adc4d5a162cde09d0bf6521469eca7dd3" args="(char *header, char *string, char *boundary, int length, char *cookie_pwd, char *cookie_wpwd, int refresh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void decode_post </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>header</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>boundary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>cookie_pwd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>cookie_wpwd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>refresh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l09841">9841</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mhttpd_8c_source.html#l00887">_attachment_buffer</a>, <a class="el" href="mhttpd_8c_source.html#l00888">_attachment_size</a>, <a class="el" href="odbhist_8c_source.html#l00059">file_name</a>, <a class="el" href="mhttpd_8c_source.html#l01035">initparam()</a>, <a class="el" href="mscbmain_8c_source.html#l00704">interprete()</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="mhttpd_8c_source.html#l01042">setparam()</a>, <a class="el" href="mscb_8c_source.html#l00414">strlcpy()</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09964">server_loop()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09843"></a>09843 {
<a name="l09844"></a>09844    <span class="keywordtype">char</span> *pinit, *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>, *pitem, *ptmp, <a class="code" href="odbhist_8c.html#a4da1fcf44864d811e793f03bf36e6e17">file_name</a>[256], <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], path[256];
<a name="l09845"></a>09845    <span class="keywordtype">int</span> <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>;
<a name="l09846"></a>09846 
<a name="l09847"></a>09847    <a class="code" href="mhttpd_8c.html#a5c7f0ac1136d675f0150d443df5912ac">initparam</a>();
<a name="l09848"></a>09848 
<a name="l09849"></a>09849    <a class="code" href="mscb_8c.html#a4637af6f79bac4043e1064f0837d0ddc">strlcpy</a>(path, header + 1, <span class="keyword">sizeof</span>(path));     <span class="comment">/* strip leading &apos;/&apos; */</span>
<a name="l09850"></a>09850    path[255] = 0;
<a name="l09851"></a>09851    <span class="keywordflow">if</span> (strchr(path, <span class="charliteral">&apos;?&apos;</span>))
<a name="l09852"></a>09852       *strchr(path, <span class="charliteral">&apos;?&apos;</span>) = 0;
<a name="l09853"></a>09853    <span class="keywordflow">if</span> (strchr(path, <span class="charliteral">&apos; &apos;</span>))
<a name="l09854"></a>09854       *strchr(path, <span class="charliteral">&apos; &apos;</span>) = 0;
<a name="l09855"></a>09855    <a class="code" href="mhttpd_8c.html#a2956fb85032748af9fb7f544a4fb6c93">setparam</a>(<span class="stringliteral">&quot;path&quot;</span>, path);
<a name="l09856"></a>09856 
<a name="l09857"></a>09857    <a class="code" href="mhttpd_8c.html#a42dc7c4c704ca581c25ba7582da7e05e">_attachment_size</a>[0] = <a class="code" href="mhttpd_8c.html#a42dc7c4c704ca581c25ba7582da7e05e">_attachment_size</a>[1] = <a class="code" href="mhttpd_8c.html#a42dc7c4c704ca581c25ba7582da7e05e">_attachment_size</a>[2] = 0;
<a name="l09858"></a>09858    pinit = <a class="code" href="scs__310__ql355p_8c.html#a2fcb7c4c10b2f35fc53f00938f78dcc1">string</a>;
<a name="l09859"></a>09859 
<a name="l09860"></a>09860    <span class="comment">/* return if no boundary defined */</span>
<a name="l09861"></a>09861    <span class="keywordflow">if</span> (!boundary[0])
<a name="l09862"></a>09862       <span class="keywordflow">return</span>;
<a name="l09863"></a>09863 
<a name="l09864"></a>09864    <span class="keywordflow">if</span> (strstr(<span class="keywordtype">string</span>, boundary))
<a name="l09865"></a>09865       <span class="keywordtype">string</span> = strstr(<span class="keywordtype">string</span>, boundary) + strlen(boundary);
<a name="l09866"></a>09866 
<a name="l09867"></a>09867    <span class="keywordflow">do</span> {
<a name="l09868"></a>09868       <span class="keywordflow">if</span> (strstr(<span class="keywordtype">string</span>, <span class="stringliteral">&quot;name=&quot;</span>)) {
<a name="l09869"></a>09869          pitem = strstr(<span class="keywordtype">string</span>, <span class="stringliteral">&quot;name=&quot;</span>) + 5;
<a name="l09870"></a>09870          <span class="keywordflow">if</span> (*pitem == <span class="charliteral">&apos;\&quot;&apos;</span>)
<a name="l09871"></a>09871             pitem++;
<a name="l09872"></a>09872 
<a name="l09873"></a>09873          <span class="keywordflow">if</span> (strncmp(pitem, <span class="stringliteral">&quot;attfile&quot;</span>, 7) == 0) {
<a name="l09874"></a>09874             n = pitem[7] - <span class="charliteral">&apos;1&apos;</span>;
<a name="l09875"></a>09875 
<a name="l09876"></a>09876             <span class="comment">/* evaluate file attachment */</span>
<a name="l09877"></a>09877             <span class="keywordflow">if</span> (strstr(pitem, <span class="stringliteral">&quot;filename=&quot;</span>)) {
<a name="l09878"></a>09878                p = strstr(pitem, <span class="stringliteral">&quot;filename=&quot;</span>) + 9;
<a name="l09879"></a>09879                <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;\&quot;&apos;</span>)
<a name="l09880"></a>09880                   p++;
<a name="l09881"></a>09881                <span class="keywordflow">if</span> (strstr(p, <span class="stringliteral">&quot;\r\n\r\n&quot;</span>))
<a name="l09882"></a>09882                   <span class="keywordtype">string</span> = strstr(p, <span class="stringliteral">&quot;\r\n\r\n&quot;</span>) + 4;
<a name="l09883"></a>09883                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strstr(p, <span class="stringliteral">&quot;\r\r\n\r\r\n&quot;</span>))
<a name="l09884"></a>09884                   <span class="keywordtype">string</span> = strstr(p, <span class="stringliteral">&quot;\r\r\n\r\r\n&quot;</span>) + 6;
<a name="l09885"></a>09885                <span class="keywordflow">if</span> (strchr(p, <span class="charliteral">&apos;\&quot;&apos;</span>))
<a name="l09886"></a>09886                   *strchr(p, <span class="charliteral">&apos;\&quot;&apos;</span>) = 0;
<a name="l09887"></a>09887 
<a name="l09888"></a>09888                <span class="comment">/* set attachment filename */</span>
<a name="l09889"></a>09889                <a class="code" href="mscb_8c.html#a4637af6f79bac4043e1064f0837d0ddc">strlcpy</a>(file_name, p, <span class="keyword">sizeof</span>(file_name));
<a name="l09890"></a>09890                sprintf(str, <span class="stringliteral">&quot;attachment%d&quot;</span>, n);
<a name="l09891"></a>09891                <a class="code" href="mhttpd_8c.html#a2956fb85032748af9fb7f544a4fb6c93">setparam</a>(str, file_name);
<a name="l09892"></a>09892             } <span class="keywordflow">else</span>
<a name="l09893"></a>09893                file_name[0] = 0;
<a name="l09894"></a>09894 
<a name="l09895"></a>09895             <span class="comment">/* find next boundary */</span>
<a name="l09896"></a>09896             ptmp = <a class="code" href="scs__310__ql355p_8c.html#a2fcb7c4c10b2f35fc53f00938f78dcc1">string</a>;
<a name="l09897"></a>09897             <span class="keywordflow">do</span> {
<a name="l09898"></a>09898                <span class="keywordflow">while</span> (*ptmp != <span class="charliteral">&apos;-&apos;</span>)
<a name="l09899"></a>09899                   ptmp++;
<a name="l09900"></a>09900 
<a name="l09901"></a>09901                <span class="keywordflow">if</span> ((p = strstr(ptmp, boundary)) != NULL) {
<a name="l09902"></a>09902                   <span class="keywordflow">while</span> (*p == <span class="charliteral">&apos;-&apos;</span>)
<a name="l09903"></a>09903                      p--;
<a name="l09904"></a>09904                   <span class="keywordflow">if</span> (*p == 10)
<a name="l09905"></a>09905                      p--;
<a name="l09906"></a>09906                   <span class="keywordflow">if</span> (*p == 13)
<a name="l09907"></a>09907                      p--;
<a name="l09908"></a>09908                   p++;
<a name="l09909"></a>09909                   <span class="keywordflow">break</span>;
<a name="l09910"></a>09910                } <span class="keywordflow">else</span>
<a name="l09911"></a>09911                   ptmp += strlen(ptmp);
<a name="l09912"></a>09912 
<a name="l09913"></a>09913             } <span class="keywordflow">while</span> (<a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l09914"></a>09914 
<a name="l09915"></a>09915             <span class="comment">/* save pointer to file */</span>
<a name="l09916"></a>09916             <span class="keywordflow">if</span> (file_name[0]) {
<a name="l09917"></a>09917                <a class="code" href="mhttpd_8c.html#a4d08376c0479b1115d6c07cf263459af">_attachment_buffer</a>[n] = <a class="code" href="scs__310__ql355p_8c.html#a2fcb7c4c10b2f35fc53f00938f78dcc1">string</a>;
<a name="l09918"></a>09918                <a class="code" href="mhttpd_8c.html#a42dc7c4c704ca581c25ba7582da7e05e">_attachment_size</a>[n] = (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) p - (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <a class="code" href="scs__310__ql355p_8c.html#a2fcb7c4c10b2f35fc53f00938f78dcc1">string</a>;
<a name="l09919"></a>09919             }
<a name="l09920"></a>09920 
<a name="l09921"></a>09921             <span class="keywordtype">string</span> = strstr(p, boundary) + strlen(boundary);
<a name="l09922"></a>09922          } <span class="keywordflow">else</span> {
<a name="l09923"></a>09923             p = pitem;
<a name="l09924"></a>09924             <span class="keywordflow">if</span> (strstr(p, <span class="stringliteral">&quot;\r\n\r\n&quot;</span>))
<a name="l09925"></a>09925                p = strstr(p, <span class="stringliteral">&quot;\r\n\r\n&quot;</span>) + 4;
<a name="l09926"></a>09926             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strstr(p, <span class="stringliteral">&quot;\r\r\n\r\r\n&quot;</span>))
<a name="l09927"></a>09927                p = strstr(p, <span class="stringliteral">&quot;\r\r\n\r\r\n&quot;</span>) + 6;
<a name="l09928"></a>09928 
<a name="l09929"></a>09929             <span class="keywordflow">if</span> (strchr(pitem, <span class="charliteral">&apos;\&quot;&apos;</span>))
<a name="l09930"></a>09930                *strchr(pitem, <span class="charliteral">&apos;\&quot;&apos;</span>) = 0;
<a name="l09931"></a>09931 
<a name="l09932"></a>09932             <span class="keywordflow">if</span> (strstr(p, boundary)) {
<a name="l09933"></a>09933                <span class="keywordtype">string</span> = strstr(p, boundary) + strlen(boundary);
<a name="l09934"></a>09934                *strstr(p, boundary) = 0;
<a name="l09935"></a>09935                ptmp = p + (strlen(p) - 1);
<a name="l09936"></a>09936                <span class="keywordflow">while</span> (*ptmp == <span class="charliteral">&apos;-&apos;</span> || *ptmp == <span class="charliteral">&apos;\n&apos;</span> || *ptmp == <span class="charliteral">&apos;\r&apos;</span>)
<a name="l09937"></a>09937                   *ptmp-- = 0;
<a name="l09938"></a>09938             }
<a name="l09939"></a>09939             <a class="code" href="mhttpd_8c.html#a2956fb85032748af9fb7f544a4fb6c93">setparam</a>(pitem, p);
<a name="l09940"></a>09940          }
<a name="l09941"></a>09941 
<a name="l09942"></a>09942          <span class="keywordflow">while</span> (*<span class="keywordtype">string</span> == <span class="charliteral">&apos;-&apos;</span> || *<span class="keywordtype">string</span> == <span class="charliteral">&apos;\n&apos;</span> || *<span class="keywordtype">string</span> == <span class="charliteral">&apos;\r&apos;</span>)
<a name="l09943"></a>09943             <span class="keywordtype">string</span>++;
<a name="l09944"></a>09944       }
<a name="l09945"></a>09945 
<a name="l09946"></a>09946    } <span class="keywordflow">while</span> ((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <span class="keywordtype">string</span> - (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) pinit &lt; <a class="code" href="FDCR_8h.html#a9f59b34b1f25fe00023291b678246bcc">length</a>);
<a name="l09947"></a>09947 
<a name="l09948"></a>09948    <a class="code" href="mscbmain_8c.html#a2331a26017e5f759388bb66d56bf065b">interprete</a>(cookie_pwd, cookie_wpwd, path, refresh);
<a name="l09949"></a>09949 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a877b1f25fb961fe82f80882e5500d5f5"></a><!-- doxytag: member="mhttpd.c::exec_script" ref="a877b1f25fb961fe82f80882e5500d5f5" args="(HNDLE hkey)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void exec_script </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a>&nbsp;</td>
          <td class="paramname"> <em>hkey</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01570">1570</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="lrs1821_8c_source.html#l00038">data</a>, <a class="el" href="odb_8c_source.html#l03390">db_enum_key()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l06308">db_sprintf()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="midas_8h_source.html#l01320">KEY::item_size</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="group__msystemincludecode.html#ga7a14ecba483c2767fe699633d0bc677e">ss_system()</a>, <a class="el" href="midas_8h_source.html#l00749">TID_KEY</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, and <a class="el" href="midas_8h_source.html#l01315">KEY::type</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01573"></a>01573          : <a class="code" href="mhttpd_8c.html#a877b1f25fb961fe82f80882e5500d5f5">exec_script</a>
<a name="l01574"></a>01574 
<a name="l01575"></a>01575   Purpose: Execute script from /Script tree
<a name="l01576"></a>01576 
<a name="l01577"></a>01577   <a class="code" href="mhttpd_8c.html#a877b1f25fb961fe82f80882e5500d5f5">exec_script</a> is <a class="code" href="crate3_2rpc__master_8cpp.html#ac19b89f25c9dfa8d24866a5c108d6477">enabled</a> <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> the tree /Script
<a name="l01578"></a>01578   The /Script <span class="keyword">struct </span>is composed of <a class="code" href="namespacemodules.html#a12afb64f27b8a4e356d665de83e78ad3">list</a> of keys
<a name="l01579"></a>01579   from which the <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a> of the <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a> is the <a class="code" href="scs__600_8c.html#a6ea1898102a5c5f504dda3fd21271a4f">button</a> <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>
<a name="l01580"></a>01580   <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> the sub-structure is a record as follow:
<a name="l01581"></a>01581 
<a name="l01582"></a>01582   /Script/&lt;button_name&gt; = &lt;script command&gt; (TID_STRING)
<a name="l01583"></a>01583 
<a name="l01584"></a>01584   The &quot;Script command&quot;, containing possible arguements,
<a name="l01585"></a>01585   is directly executed.
<a name="l01586"></a>01586 
<a name="l01587"></a>01587   /Script/&lt;button_name&gt;/&lt;script command&gt;
<a name="l01588"></a>01588                         &lt;soft link1&gt;|&lt;arg1&gt;
<a name="l01589"></a>01589                         &lt;soft link2&gt;|&lt;arg2&gt;
<a name="l01590"></a>01590                            ...
<a name="l01591"></a>01591 
<a name="l01592"></a>01592   The arguments <a class="code" href="patch__mevb_8cpp.html#acf1ade676fe2e98c5ee44131e9f23abb">for</a> the script are derived from the
<a name="l01593"></a>01593   subtree below &lt;button_name&gt;, where &lt;button_name&gt; must be
<a name="l01594"></a>01594   <a class="code" href="group__mdefineh.html#ga15ae151ae0b7588b3327bd8451d9bcb8">TID_KEY</a>. The subtree may then contain arguments <a class="code" href="examples_2macro_2midas__macro_8h.html#a339a611d7f9dc3a59c359f0da7beaf3c">or</a> links
<a name="l01595"></a>01595   to other values <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> the ODB, like <a class="code" href="odbhist_8c.html#a369e3b30815f09142abc86f462a501ff">run</a> number etc.
<a name="l01596"></a>01596 
<a name="l01597"></a>01597 \********************************************************************/
<a name="l01598"></a>01598 {
<a name="l01599"></a>01599    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l01600"></a>01600    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l01601"></a>01601    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hsubkey;
<a name="l01602"></a>01602    <span class="keywordtype">char</span> command[256];
<a name="l01603"></a>01603    <span class="keywordtype">char</span> <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>[1000], <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l01604"></a>01604 
<a name="l01605"></a>01605    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;<a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, NULL);
<a name="l01606"></a>01606    <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(<a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey, &amp;<a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>);
<a name="l01607"></a>01607    command[0] = 0;
<a name="l01608"></a>01608 
<a name="l01609"></a>01609    <span class="keywordflow">if</span> (<a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>) {
<a name="l01610"></a>01610       <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> = <span class="keyword">sizeof</span>(command);
<a name="l01611"></a>01611       <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(<a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey, command, &amp;<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l01612"></a>01612    } <span class="keywordflow">else</span>
<a name="l01613"></a>01613       <span class="keywordflow">for</span> (<a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a> = 0;; <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>++) {
<a name="l01614"></a>01614          <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(<a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, &amp;hsubkey);
<a name="l01615"></a>01615          <span class="keywordflow">if</span> (!hsubkey)
<a name="l01616"></a>01616             <span class="keywordflow">break</span>;
<a name="l01617"></a>01617          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(<a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hsubkey, &amp;<a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>);
<a name="l01618"></a>01618 
<a name="l01619"></a>01619          <span class="keywordflow">if</span> (<a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> != <a class="code" href="group__mdefineh.html#ga15ae151ae0b7588b3327bd8451d9bcb8">TID_KEY</a>) {
<a name="l01620"></a>01620             <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> = <span class="keyword">sizeof</span>(<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>);
<a name="l01621"></a>01621             <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(<a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hsubkey, <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, &amp;<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l01622"></a>01622             <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(<a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>, <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l01623"></a>01623 
<a name="l01624"></a>01624             <span class="keywordflow">if</span> (<a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a> &gt; 0)
<a name="l01625"></a>01625                strcat(command, <span class="stringliteral">&quot; &quot;</span>);
<a name="l01626"></a>01626 
<a name="l01627"></a>01627             strcat(command, <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>);
<a name="l01628"></a>01628          }
<a name="l01629"></a>01629       }
<a name="l01630"></a>01630 
<a name="l01631"></a>01631    <span class="comment">/* printf(&quot;exec_script: %s\n&quot;, command); */</span>
<a name="l01632"></a>01632 
<a name="l01633"></a>01633    <span class="keywordflow">if</span> (command[0])
<a name="l01634"></a>01634       <a class="code" href="group__msystemincludecode.html#ga7a14ecba483c2767fe699633d0bc677e">ss_system</a>(command);
<a name="l01635"></a>01635 
<a name="l01636"></a>01636    <span class="keywordflow">return</span>;
<a name="l01637"></a>01637 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a041225e513adf2156dc7a18de1d315b9"></a><!-- doxytag: member="mhttpd.c::find_odb_tag" ref="a041225e513adf2156dc7a18de1d315b9" args="(char *p, char *path, BOOL *edit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* find_odb_tag </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> *&nbsp;</td>
          <td class="paramname"> <em>edit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l05122">5122</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l05192">show_custom_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05123"></a>05123 {
<a name="l05124"></a>05124    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], *ps;
<a name="l05125"></a>05125 
<a name="l05126"></a>05126    *edit = 0;
<a name="l05127"></a>05127    <span class="keywordflow">do</span> {
<a name="l05128"></a>05128       <span class="keywordflow">while</span> (*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> &amp;&amp; *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> != <span class="charliteral">&apos;&lt;&apos;</span>)
<a name="l05129"></a>05129          <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>++;
<a name="l05130"></a>05130 
<a name="l05131"></a>05131       <span class="comment">/* return if end of string reached */</span>
<a name="l05132"></a>05132       <span class="keywordflow">if</span> (!*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>)
<a name="l05133"></a>05133          <span class="keywordflow">return</span> NULL;
<a name="l05134"></a>05134 
<a name="l05135"></a>05135       <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>++;
<a name="l05136"></a>05136       <span class="keywordflow">while</span> (*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> &amp;&amp; ((*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> == <span class="charliteral">&apos; &apos;</span>) || iscntrl(*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>)))
<a name="l05137"></a>05137          <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>++;
<a name="l05138"></a>05138 
<a name="l05139"></a>05139       strncpy(str, <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>, 4);
<a name="l05140"></a>05140       str[4] = 0;
<a name="l05141"></a>05141 
<a name="l05142"></a>05142       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, <span class="stringliteral">&quot;odb &quot;</span>)) {
<a name="l05143"></a>05143          ps = <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> - 1;
<a name="l05144"></a>05144          <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> += 4;
<a name="l05145"></a>05145          <span class="keywordflow">while</span> (*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> &amp;&amp; ((*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> == <span class="charliteral">&apos; &apos;</span>) || iscntrl(*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>)))
<a name="l05146"></a>05146             <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>++;
<a name="l05147"></a>05147 
<a name="l05148"></a>05148          <span class="keywordflow">do</span> {
<a name="l05149"></a>05149             strncpy(str, <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>, 4);
<a name="l05150"></a>05150             str[4] = 0;
<a name="l05151"></a>05151             <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, <span class="stringliteral">&quot;src=&quot;</span>)) {
<a name="l05152"></a>05152                <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> += 4;
<a name="l05153"></a>05153                <span class="keywordflow">if</span> (*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> == <span class="charliteral">&apos;\&quot;&apos;</span>) {
<a name="l05154"></a>05154                   <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>++;
<a name="l05155"></a>05155                   <span class="keywordflow">while</span> (*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> &amp;&amp; *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> != <span class="charliteral">&apos;\&quot;&apos;</span>)
<a name="l05156"></a>05156                      *path++ = *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>++;
<a name="l05157"></a>05157                   *path = 0;
<a name="l05158"></a>05158                } <span class="keywordflow">else</span> {
<a name="l05159"></a>05159                   <span class="keywordflow">while</span> (*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> &amp;&amp; *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> != <span class="charliteral">&apos; &apos;</span> &amp;&amp; *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> != <span class="charliteral">&apos;&gt;&apos;</span>)
<a name="l05160"></a>05160                      *path++ = *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>++;
<a name="l05161"></a>05161                   *path = 0;
<a name="l05162"></a>05162                }
<a name="l05163"></a>05163                <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>++;
<a name="l05164"></a>05164             } <span class="keywordflow">else</span> {
<a name="l05165"></a>05165                strncpy(str, <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>, 5);
<a name="l05166"></a>05166                str[5] = 0;
<a name="l05167"></a>05167                <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, <span class="stringliteral">&quot;edit=&quot;</span>)) {
<a name="l05168"></a>05168                   <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> += 5;
<a name="l05169"></a>05169                   *edit = atoi(<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>);
<a name="l05170"></a>05170                   <span class="keywordflow">while</span> (*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> &amp;&amp; *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> != <span class="charliteral">&apos; &apos;</span> &amp;&amp; *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> != <span class="charliteral">&apos;&gt;&apos;</span>)
<a name="l05171"></a>05171                      <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>++;
<a name="l05172"></a>05172                }
<a name="l05173"></a>05173             }
<a name="l05174"></a>05174 
<a name="l05175"></a>05175             <span class="keywordflow">while</span> (*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> &amp;&amp; ((*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> == <span class="charliteral">&apos; &apos;</span>) || iscntrl(*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>)))
<a name="l05176"></a>05176                <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>++;
<a name="l05177"></a>05177 
<a name="l05178"></a>05178          } <span class="keywordflow">while</span> (*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> != <span class="charliteral">&apos;&gt;&apos;</span>);
<a name="l05179"></a>05179 
<a name="l05180"></a>05180          <span class="keywordflow">return</span> ps;
<a name="l05181"></a>05181       }
<a name="l05182"></a>05182 
<a name="l05183"></a>05183       <span class="keywordflow">while</span> (*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> &amp;&amp; *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> != <span class="charliteral">&apos;&gt;&apos;</span>)
<a name="l05184"></a>05184          <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>++;
<a name="l05185"></a>05185 
<a name="l05186"></a>05186    } <span class="keywordflow">while</span> (1);
<a name="l05187"></a>05187 
<a name="l05188"></a>05188 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a58b44d117968b2a7b75adb40f95ea5bf"></a><!-- doxytag: member="mhttpd.c::gen_odb_attachment" ref="a58b44d117968b2a7b75adb40f95ea5bf" args="(char *path, char *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void gen_odb_attachment </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l03707">3707</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="lrs1821_8c_source.html#l00038">data</a>, <a class="el" href="odb_8c_source.html#l03390">db_enum_key()</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l04376">db_get_data_index()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="odb_8c_source.html#l06308">db_sprintf()</a>, <a class="el" href="odb_8c_source.html#l06363">db_sprintfh()</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="midas_8h_source.html#l01320">KEY::item_size</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="midas_8h_source.html#l01316">KEY::num_values</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="mhttpd_8c_source.html#l02450">strencode2()</a>, <a class="el" href="midas_8h_source.html#l00749">TID_KEY</a>, <a class="el" href="midas_8h_source.html#l00750">TID_LINK</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, and <a class="el" href="midas_8h_source.html#l01315">KEY::type</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l03805">submit_elog()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03708"></a>03708 {
<a name="l03709"></a>03709    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkeyroot, hkey;
<a name="l03710"></a>03710    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l03711"></a>03711    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l03712"></a>03712    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], data_str[256], hex_str[256];
<a name="l03713"></a>03713    <span class="keywordtype">char</span> <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>[10000];
<a name="l03714"></a>03714    time_t now;
<a name="l03715"></a>03715 
<a name="l03716"></a>03716    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l03717"></a>03717    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, path, &amp;hkeyroot);
<a name="l03718"></a>03718 
<a name="l03719"></a>03719    <span class="comment">/* title row */</span>
<a name="l03720"></a>03720    size = <span class="keyword">sizeof</span>(str);
<a name="l03721"></a>03721    str[0] = 0;
<a name="l03722"></a>03722    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Name&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l03723"></a>03723    <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l03724"></a>03724 
<a name="l03725"></a>03725    sprintf(b, <span class="stringliteral">&quot;&lt;table border=3 cellpadding=1&gt;\n&quot;</span>);
<a name="l03726"></a>03726    sprintf(b + strlen(b), <span class="stringliteral">&quot;&lt;tr&gt;&lt;th colspan=2 bgcolor=#A0A0FF&gt;%s&lt;/tr&gt;\n&quot;</span>, ctime(&amp;now));
<a name="l03727"></a>03727    sprintf(b + strlen(b), <span class="stringliteral">&quot;&lt;tr&gt;&lt;th colspan=2 bgcolor=#FFA0A0&gt;%s&lt;/tr&gt;\n&quot;</span>, path);
<a name="l03728"></a>03728 
<a name="l03729"></a>03729    <span class="comment">/* enumerate subkeys */</span>
<a name="l03730"></a>03730    <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l03731"></a>03731       <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyroot, i, &amp;hkey);
<a name="l03732"></a>03732       <span class="keywordflow">if</span> (!hkey)
<a name="l03733"></a>03733          <span class="keywordflow">break</span>;
<a name="l03734"></a>03734       <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l03735"></a>03735 
<a name="l03736"></a>03736       <span class="comment">/* resolve links */</span>
<a name="l03737"></a>03737       <span class="keywordflow">if</span> (key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#gaa63f41f547c7f46f828aaf35073807ea">TID_LINK</a>) {
<a name="l03738"></a>03738          <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkeyroot, i, &amp;hkey);
<a name="l03739"></a>03739          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l03740"></a>03740       }
<a name="l03741"></a>03741 
<a name="l03742"></a>03742       <span class="keywordflow">if</span> (key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#ga15ae151ae0b7588b3327bd8451d9bcb8">TID_KEY</a>) {
<a name="l03743"></a>03743          <span class="comment">/* for keys, don&apos;t display data value */</span>
<a name="l03744"></a>03744          sprintf(b + strlen(b), <span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#FFD000&gt;%s&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l03745"></a>03745                  key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l03746"></a>03746       } <span class="keywordflow">else</span> {
<a name="l03747"></a>03747          <span class="comment">/* display single value */</span>
<a name="l03748"></a>03748          <span class="keywordflow">if</span> (key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a> == 1) {
<a name="l03749"></a>03749             size = <span class="keyword">sizeof</span>(data);
<a name="l03750"></a>03750             <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, data, &amp;size, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l03751"></a>03751             <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(data_str, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l03752"></a>03752             <a class="code" href="group__msectionh.html#gacf595105fe1399620f51c3af5bfb54b4">db_sprintfh</a>(hex_str, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l03753"></a>03753 
<a name="l03754"></a>03754             <span class="keywordflow">if</span> (data_str[0] == 0 || <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(data_str, <span class="stringliteral">&quot;&lt;NULL&gt;&quot;</span>)) {
<a name="l03755"></a>03755                strcpy(data_str, <span class="stringliteral">&quot;(empty)&quot;</span>);
<a name="l03756"></a>03756                hex_str[0] = 0;
<a name="l03757"></a>03757             }
<a name="l03758"></a>03758 
<a name="l03759"></a>03759             <span class="keywordflow">if</span> (strcmp(data_str, hex_str) != 0 &amp;&amp; hex_str[0])
<a name="l03760"></a>03760                sprintf(b + strlen(b),
<a name="l03761"></a>03761                        <span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;%s&lt;/td&gt;&lt;td bgcolor=#FFFFFF&gt;%s (%s)&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l03762"></a>03762                        key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, data_str, hex_str);
<a name="l03763"></a>03763             <span class="keywordflow">else</span> {
<a name="l03764"></a>03764                sprintf(b + strlen(b),
<a name="l03765"></a>03765                        <span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;%s&lt;/td&gt;&lt;td bgcolor=#FFFFFF&gt;&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l03766"></a>03766                <a class="code" href="mhttpd_8c.html#a7497f3d4247306f2eabccaf53748ca43">strencode2</a>(b + strlen(b), data_str);
<a name="l03767"></a>03767                sprintf(b + strlen(b), <span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l03768"></a>03768             }
<a name="l03769"></a>03769          } <span class="keywordflow">else</span> {
<a name="l03770"></a>03770             <span class="comment">/* display first value */</span>
<a name="l03771"></a>03771             sprintf(b + strlen(b), <span class="stringliteral">&quot;&lt;tr&gt;&lt;td  bgcolor=#FFFF00 rowspan=%d&gt;%s&lt;/td&gt;\n&quot;</span>,
<a name="l03772"></a>03772                     key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l03773"></a>03773 
<a name="l03774"></a>03774             <span class="keywordflow">for</span> (j = 0; j &lt; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; j++) {
<a name="l03775"></a>03775                size = <span class="keyword">sizeof</span>(data);
<a name="l03776"></a>03776                <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hkey, data, &amp;size, j, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l03777"></a>03777                <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(data_str, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l03778"></a>03778                <a class="code" href="group__msectionh.html#gacf595105fe1399620f51c3af5bfb54b4">db_sprintfh</a>(hex_str, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l03779"></a>03779 
<a name="l03780"></a>03780                <span class="keywordflow">if</span> (data_str[0] == 0 || <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(data_str, <span class="stringliteral">&quot;&lt;NULL&gt;&quot;</span>)) {
<a name="l03781"></a>03781                   strcpy(data_str, <span class="stringliteral">&quot;(empty)&quot;</span>);
<a name="l03782"></a>03782                   hex_str[0] = 0;
<a name="l03783"></a>03783                }
<a name="l03784"></a>03784 
<a name="l03785"></a>03785                <span class="keywordflow">if</span> (j &gt; 0)
<a name="l03786"></a>03786                   sprintf(b + strlen(b), <span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>);
<a name="l03787"></a>03787 
<a name="l03788"></a>03788                <span class="keywordflow">if</span> (strcmp(data_str, hex_str) != 0 &amp;&amp; hex_str[0])
<a name="l03789"></a>03789                   sprintf(b + strlen(b),
<a name="l03790"></a>03790                           <span class="stringliteral">&quot;&lt;td bgcolor=#FFFFFF&gt;[%d] %s (%s)&lt;br&gt;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>, j, data_str,
<a name="l03791"></a>03791                           hex_str);
<a name="l03792"></a>03792                <span class="keywordflow">else</span>
<a name="l03793"></a>03793                   sprintf(b + strlen(b), <span class="stringliteral">&quot;&lt;td bgcolor=#FFFFFF&gt;[%d] %s&lt;br&gt;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>, j,
<a name="l03794"></a>03794                           data_str);
<a name="l03795"></a>03795             }
<a name="l03796"></a>03796          }
<a name="l03797"></a>03797       }
<a name="l03798"></a>03798    }
<a name="l03799"></a>03799 
<a name="l03800"></a>03800    sprintf(b + strlen(b), <span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>);
<a name="l03801"></a>03801 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9506713463026c887f8d19f1c6a5ea20"></a><!-- doxytag: member="mhttpd.c::generate_hist_graph" ref="a9506713463026c887f8d19f1c6a5ea20" args="(char *path, char *buffer, int *buffer_size, int width, int height, int scale, int toffset, int index, int labels)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void generate_hist_graph </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>buffer_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>height</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>toffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>labels</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l07289">7289</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="mgd_8h_source.html#l00051">gdGifBufferStruct::data</a>, <a class="el" href="odb_8c_source.html#l02160">db_delete_key()</a>, <a class="el" href="odb_8c_source.html#l03390">db_enum_key()</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04376">db_get_data_index()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l02907">db_get_path()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00248">event_id</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="scs__310__ql355p_8c_source.html#l00055">flag</a>, <a class="el" href="mgd_8c_source.html#l00425">gdFontGiant</a>, <a class="el" href="mgd_8c_source.html#l00424">gdFontMediumBold</a>, <a class="el" href="mgd_8c_source.html#l00426">gdFontSmall</a>, <a class="el" href="mgd_8c_source.html#l00508">gdImageColorAllocate()</a>, <a class="el" href="mgd_8c_source.html#l00538">gdImageColorTransparent()</a>, <a class="el" href="mgd_8c_source.html#l00433">gdImageCreate()</a>, <a class="el" href="mgd_8c_source.html#l00743">gdImageDashedLine()</a>, <a class="el" href="mgd_8c_source.html#l00455">gdImageDestroy()</a>, <a class="el" href="mgd_8c_source.html#l02476">gdImageFilledPolygon()</a>, <a class="el" href="mgd_8c_source.html#l02312">gdImageFilledRectangle()</a>, <a class="el" href="mgd_8c_source.html#l01123">gdImageGif()</a>, <a class="el" href="mgd_8c_source.html#l02624">gdImageInterlace()</a>, <a class="el" href="mgd_8c_source.html#l00643">gdImageLine()</a>, <a class="el" href="mgd_8c_source.html#l02304">gdImageRectangle()</a>, <a class="el" href="mgd_8c_source.html#l00882">gdImageString()</a>, <a class="el" href="mgd_8c_source.html#l00893">gdImageStringUp()</a>, <a class="el" href="mgd_8h_source.html#l00062">gdFont::h</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="midas_8c_source.html#l13985">hs_get_event_id()</a>, <a class="el" href="midas_8c_source.html#l14339">hs_read()</a>, <a class="el" href="midas_8c_source.html#l13244">hs_set_path()</a>, <a class="el" href="midas_8h_source.html#l01092">HS_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l01095">HS_TRUNCATED</a>, <a class="el" href="midas_8h_source.html#l01098">HS_UNDEFINED_VAR</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="odbhist_8c_source.html#l00058">k</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="FDCR_8h_source.html#l00008">length</a>, <a class="el" href="mhttpd_8c_source.html#l06806">LN10</a>, <a class="el" href="midas_8h_source.html#l01755">M_FREE</a>, <a class="el" href="midas_8h_source.html#l01753">M_MALLOC</a>, <a class="el" href="mhttpd_8c_source.html#l07287">MAX_VARS</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="midas_8h_source.html#l01316">KEY::num_values</a>, <a class="el" href="mgd_8c_source.html#l01505">offset</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="mhttpd_8c_source.html#l00870">return_buffer</a>, <a class="el" href="mhttpd_8c_source.html#l00872">return_length</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00323">run_number</a>, <a class="el" href="mgd_8h_source.html#l00052">gdGifBufferStruct::size</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="system_8c_source.html#l02332">ss_time()</a>, <a class="el" href="midas_8h_source.html#l00714">STATE_RUNNING</a>, <a class="el" href="midas_8h_source.html#l00712">STATE_STOPPED</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="mhttpd_8c_source.html#l06961">taxis()</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, <a class="el" href="midas_8h_source.html#l00735">TID_BYTE</a>, <a class="el" href="midas_8h_source.html#l00737">TID_CHAR</a>, <a class="el" href="midas_8h_source.html#l00744">TID_DOUBLE</a>, <a class="el" href="midas_8h_source.html#l00740">TID_DWORD</a>, <a class="el" href="midas_8h_source.html#l00743">TID_FLOAT</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="midas_8h_source.html#l00736">TID_SBYTE</a>, <a class="el" href="midas_8h_source.html#l00739">TID_SHORT</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="midas_8h_source.html#l00738">TID_WORD</a>, <a class="el" href="mhttpd_8c_source.html#l07262">time_to_sec()</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, <a class="el" href="mfe_8c_source.html#l00339">tsize</a>, <a class="el" href="mana_8cpp_source.html#l00675">type</a>, <a class="el" href="lcd__menu_8c_source.html#l00044">var_index</a>, <a class="el" href="odbhist_8c_source.html#l00059">var_name</a>, <a class="el" href="mhttpd_8c_source.html#l07082">vaxis()</a>, <a class="el" href="mgd_8h_source.html#l00061">gdFont::w</a>, <a class="el" href="mgd_8h_source.html#l00118">gdPoint::x</a>, and <a class="el" href="mgd_8h_source.html#l00118">gdPoint::y</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l08606">show_hist_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07292"></a>07292 {
<a name="l07293"></a>07293    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey, hkeypanel, hkeyeq, hkeydvar, hkeyvars, hkeyroot, hkeynames;
<a name="l07294"></a>07294    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l07295"></a>07295    <a class="code" href="structgdImageStruct.html">gdImagePtr</a> im;
<a name="l07296"></a>07296    <a class="code" href="structgdGifBufferStruct.html">gdGifBuffer</a> gb;
<a name="l07297"></a>07297    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, <a class="code" href="odbhist_8c.html#a43fa990200c3ddd47c35f151bd4d66bf">k</a>, l, n_vars, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, row, x_marker;
<a name="l07298"></a>07298    <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> bsize, <a class="code" href="mfe_8c.html#aa1506b3a082cd269e4e733382ba0df79">tsize</a>, n_marker, *state, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a16695ea2bfd19f294afe066d6007ab36">run_number</a>;
<a name="l07299"></a>07299    <span class="keywordtype">int</span> <a class="code" href="FDCR_8h.html#a9f59b34b1f25fe00023291b678246bcc">length</a>, aoffset;
<a name="l07300"></a>07300    <span class="keywordtype">int</span> <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a>, x1, y1, x2, y2, xs, xs_old, ys, xold, yold, xmaxm;
<a name="l07301"></a>07301    <span class="keywordtype">int</span> white, black, grey, ltgrey, red, green, blue, curve_col[<a class="code" href="mhttpd_8c.html#a5c707deff4e68c7283f2ed73665e0c77">MAX_VARS</a>], state_col[3];
<a name="l07302"></a>07302    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], panel[<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>], *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>, odbpath[256];
<a name="l07303"></a>07303    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="lcd__menu_8c.html#a13b219e0dd828c9f136b7bb99d8afc34">var_index</a>[<a class="code" href="mhttpd_8c.html#a5c707deff4e68c7283f2ed73665e0c77">MAX_VARS</a>];
<a name="l07304"></a>07304    <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>, <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>;
<a name="l07305"></a>07305    <span class="keywordtype">char</span> event_name[<a class="code" href="mhttpd_8c.html#a5c707deff4e68c7283f2ed73665e0c77">MAX_VARS</a>][<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>];
<a name="l07306"></a>07306    <span class="keywordtype">char</span> tag_name[<a class="code" href="mhttpd_8c.html#a5c707deff4e68c7283f2ed73665e0c77">MAX_VARS</a>][64], <a class="code" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a>[<a class="code" href="mhttpd_8c.html#a5c707deff4e68c7283f2ed73665e0c77">MAX_VARS</a>][<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>], varname[64],
<a name="l07307"></a>07307        key_name[256];
<a name="l07308"></a>07308    <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> n_point[<a class="code" href="mhttpd_8c.html#a5c707deff4e68c7283f2ed73665e0c77">MAX_VARS</a>];
<a name="l07309"></a>07309    <span class="keywordtype">int</span> x[<a class="code" href="mhttpd_8c.html#a5c707deff4e68c7283f2ed73665e0c77">MAX_VARS</a>][1000];
<a name="l07310"></a>07310    <span class="keywordtype">float</span> y[<a class="code" href="mhttpd_8c.html#a5c707deff4e68c7283f2ed73665e0c77">MAX_VARS</a>][1000];
<a name="l07311"></a>07311    <span class="keywordtype">float</span> factor[<a class="code" href="mhttpd_8c.html#a5c707deff4e68c7283f2ed73665e0c77">MAX_VARS</a>], <a class="code" href="mgd_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a>[<a class="code" href="mhttpd_8c.html#a5c707deff4e68c7283f2ed73665e0c77">MAX_VARS</a>];
<a name="l07312"></a>07312    <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> logaxis, runmarker;
<a name="l07313"></a>07313    <span class="keywordtype">float</span> xmin, xmax, ymin, ymax;
<a name="l07314"></a>07314    <a class="code" href="structgdPoint.html">gdPoint</a> poly[3];
<a name="l07315"></a>07315    <span class="keywordtype">float</span> upper_limit[<a class="code" href="mhttpd_8c.html#a5c707deff4e68c7283f2ed73665e0c77">MAX_VARS</a>], lower_limit[<a class="code" href="mhttpd_8c.html#a5c707deff4e68c7283f2ed73665e0c77">MAX_VARS</a>];
<a name="l07316"></a>07316    <span class="keywordtype">double</span> yb1, yb2, yf1, yf2, ybase;
<a name="l07317"></a>07317 
<a name="l07318"></a>07318    <span class="keyword">static</span> <span class="keywordtype">char</span> *ybuffer;
<a name="l07319"></a>07319    <span class="keyword">static</span> <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> *tbuffer;
<a name="l07320"></a>07320    <span class="keyword">static</span> <span class="keywordtype">int</span> hbuffer_size = 0;
<a name="l07321"></a>07321 
<a name="l07322"></a>07322    <span class="keywordflow">if</span> (hbuffer_size == 0) {
<a name="l07323"></a>07323       hbuffer_size = 1000 * <span class="keyword">sizeof</span>(<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>);
<a name="l07324"></a>07324       tbuffer = malloc(hbuffer_size);
<a name="l07325"></a>07325       ybuffer = malloc(hbuffer_size);
<a name="l07326"></a>07326    }
<a name="l07327"></a>07327 
<a name="l07328"></a>07328    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l07329"></a>07329 
<a name="l07330"></a>07330    <span class="comment">/* generate test image */</span>
<a name="l07331"></a>07331    im = <a class="code" href="mgd_8h.html#a0cc7fc360192c63bbb962600b86abaa1">gdImageCreate</a>(<a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a>, <a class="code" href="mainWindow_8cpp.html#ad12fc34ce789bce6c8a05d8a17138534">height</a>);
<a name="l07332"></a>07332 
<a name="l07333"></a>07333    <span class="comment">/* First color allocated is background. */</span>
<a name="l07334"></a>07334    grey = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 192, 192, 192);
<a name="l07335"></a>07335    ltgrey = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 208, 208, 208);
<a name="l07336"></a>07336    white = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 255, 255, 255);
<a name="l07337"></a>07337    black = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 0, 0, 0);
<a name="l07338"></a>07338    red = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 255, 0, 0);
<a name="l07339"></a>07339    green = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 0, 255, 0);
<a name="l07340"></a>07340    blue = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 0, 0, 255);
<a name="l07341"></a>07341 
<a name="l07342"></a>07342    curve_col[0] = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 0, 0, 255);
<a name="l07343"></a>07343    curve_col[1] = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 0, 192, 0);
<a name="l07344"></a>07344    curve_col[2] = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 255, 0, 0);
<a name="l07345"></a>07345    curve_col[3] = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 0, 192, 192);
<a name="l07346"></a>07346    curve_col[4] = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 255, 0, 255);
<a name="l07347"></a>07347    curve_col[5] = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 192, 192, 0);
<a name="l07348"></a>07348    curve_col[6] = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 128, 128, 128);
<a name="l07349"></a>07349    curve_col[7] = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 128, 255, 128);
<a name="l07350"></a>07350    curve_col[8] = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 255, 128, 128);
<a name="l07351"></a>07351    curve_col[9] = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 128, 128, 255);
<a name="l07352"></a>07352 
<a name="l07353"></a>07353    state_col[0] = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 255, 0, 0);
<a name="l07354"></a>07354    state_col[1] = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 255, 255, 0);
<a name="l07355"></a>07355    state_col[2] = <a class="code" href="mgd_8h.html#acb787efb2cef0bfd6802540b56c3c8f8">gdImageColorAllocate</a>(im, 0, 255, 0);
<a name="l07356"></a>07356 
<a name="l07357"></a>07357    <span class="comment">/* Set transparent color. */</span>
<a name="l07358"></a>07358    <a class="code" href="mgd_8h.html#af35c79ca7eb1de5bac15c40d2046ce89">gdImageColorTransparent</a>(im, grey);
<a name="l07359"></a>07359 
<a name="l07360"></a>07360    <span class="comment">/* Title */</span>
<a name="l07361"></a>07361    strcpy(panel, path);
<a name="l07362"></a>07362    <span class="keywordflow">if</span> (strstr(panel, <span class="stringliteral">&quot;.gif&quot;</span>))
<a name="l07363"></a>07363       *strstr(panel, <span class="stringliteral">&quot;.gif&quot;</span>) = 0;
<a name="l07364"></a>07364    <a class="code" href="mgd_8h.html#a04908d388ee58943527604c035eb1aeb">gdImageString</a>(im, <a class="code" href="mgd_8h.html#a85cefa0dedac99f080ed516a27d78cdc">gdFontGiant</a>, <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> / 2 - (strlen(panel) * <a class="code" href="mgd_8h.html#a85cefa0dedac99f080ed516a27d78cdc">gdFontGiant</a>-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a>) / 2, 2,
<a name="l07365"></a>07365                  panel, black);
<a name="l07366"></a>07366 
<a name="l07367"></a>07367    <span class="comment">/* set history path */</span>
<a name="l07368"></a>07368    status = <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Data dir&quot;</span>, &amp;hkey);
<a name="l07369"></a>07369    <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l07370"></a>07370       sprintf(str, <span class="stringliteral">&quot;No data directory defined in ODB&quot;</span>);
<a name="l07371"></a>07371       <a class="code" href="mgd_8h.html#a04908d388ee58943527604c035eb1aeb">gdImageString</a>(im, <a class="code" href="mgd_8h.html#a85cefa0dedac99f080ed516a27d78cdc">gdFontGiant</a>, <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> / 2 - (strlen(str) * <a class="code" href="mgd_8h.html#a85cefa0dedac99f080ed516a27d78cdc">gdFontGiant</a>-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a>) / 2,
<a name="l07372"></a>07372                     <a class="code" href="mainWindow_8cpp.html#ad12fc34ce789bce6c8a05d8a17138534">height</a> / 2, str, red);
<a name="l07373"></a>07373       <span class="keywordflow">goto</span> error;
<a name="l07374"></a>07374    }
<a name="l07375"></a>07375 
<a name="l07376"></a>07376    <span class="comment">/* check dedicated history path */</span>
<a name="l07377"></a>07377    size = <span class="keyword">sizeof</span>(str);
<a name="l07378"></a>07378    memset(str, 0, size);
<a name="l07379"></a>07379 
<a name="l07380"></a>07380    status = <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/History dir&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l07381"></a>07381    <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l07382"></a>07382       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Data dir&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l07383"></a>07383    <a class="code" href="group__msectionh.html#gac14a8c94ad64cfa991efae443a21c17d">hs_set_path</a>(str);
<a name="l07384"></a>07384 
<a name="l07385"></a>07385    <span class="comment">/* check panel name in ODB */</span>
<a name="l07386"></a>07386    sprintf(str, <span class="stringliteral">&quot;/History/Display/%s&quot;</span>, panel);
<a name="l07387"></a>07387    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkeypanel);
<a name="l07388"></a>07388    <span class="keywordflow">if</span> (!hkey) {
<a name="l07389"></a>07389       sprintf(str, <span class="stringliteral">&quot;Cannot find /History/Display/%s in ODB&quot;</span>, panel);
<a name="l07390"></a>07390       <a class="code" href="mgd_8h.html#a04908d388ee58943527604c035eb1aeb">gdImageString</a>(im, <a class="code" href="mgd_8h.html#a85cefa0dedac99f080ed516a27d78cdc">gdFontGiant</a>, <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> / 2 - (strlen(str) * <a class="code" href="mgd_8h.html#a85cefa0dedac99f080ed516a27d78cdc">gdFontGiant</a>-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a>) / 2,
<a name="l07391"></a>07391                     <a class="code" href="mainWindow_8cpp.html#ad12fc34ce789bce6c8a05d8a17138534">height</a> / 2, str, red);
<a name="l07392"></a>07392       <span class="keywordflow">goto</span> error;
<a name="l07393"></a>07393    }
<a name="l07394"></a>07394 
<a name="l07395"></a>07395    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hkeypanel, <span class="stringliteral">&quot;Variables&quot;</span>, &amp;hkeydvar);
<a name="l07396"></a>07396    <span class="keywordflow">if</span> (!hkeydvar) {
<a name="l07397"></a>07397       sprintf(str, <span class="stringliteral">&quot;Cannot find /History/Display/%s/Variables in ODB&quot;</span>, panel);
<a name="l07398"></a>07398       <a class="code" href="mgd_8h.html#a04908d388ee58943527604c035eb1aeb">gdImageString</a>(im, <a class="code" href="mgd_8h.html#a85cefa0dedac99f080ed516a27d78cdc">gdFontGiant</a>, <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> / 2 - (strlen(str) * <a class="code" href="mgd_8h.html#a85cefa0dedac99f080ed516a27d78cdc">gdFontGiant</a>-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a>) / 2,
<a name="l07399"></a>07399                     <a class="code" href="mainWindow_8cpp.html#ad12fc34ce789bce6c8a05d8a17138534">height</a> / 2, str, red);
<a name="l07400"></a>07400       <span class="keywordflow">goto</span> error;
<a name="l07401"></a>07401    }
<a name="l07402"></a>07402 
<a name="l07403"></a>07403    <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkeydvar, &amp;key);
<a name="l07404"></a>07404    n_vars = key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>;
<a name="l07405"></a>07405 
<a name="l07406"></a>07406    <span class="keywordflow">if</span> (n_vars &gt; <a class="code" href="mhttpd_8c.html#a5c707deff4e68c7283f2ed73665e0c77">MAX_VARS</a>) {
<a name="l07407"></a>07407       sprintf(str, <span class="stringliteral">&quot;Too many variables in panel %s&quot;</span>, panel);
<a name="l07408"></a>07408       <a class="code" href="mgd_8h.html#a04908d388ee58943527604c035eb1aeb">gdImageString</a>(im, <a class="code" href="mgd_8h.html#a85cefa0dedac99f080ed516a27d78cdc">gdFontGiant</a>, <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> / 2 - (strlen(str) * <a class="code" href="mgd_8h.html#a85cefa0dedac99f080ed516a27d78cdc">gdFontGiant</a>-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a>) / 2,
<a name="l07409"></a>07409                     <a class="code" href="mainWindow_8cpp.html#ad12fc34ce789bce6c8a05d8a17138534">height</a> / 2, str, red);
<a name="l07410"></a>07410       <span class="keywordflow">goto</span> error;
<a name="l07411"></a>07411    }
<a name="l07412"></a>07412 
<a name="l07413"></a>07413    ymin = ymax = 0;
<a name="l07414"></a>07414    logaxis = runmarker = 0;
<a name="l07415"></a>07415 
<a name="l07416"></a>07416    <span class="keywordflow">for</span> (i = 0; i &lt; n_vars; i++) {
<a name="l07417"></a>07417       <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> != -1 &amp;&amp; <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> != i)
<a name="l07418"></a>07418          <span class="keywordflow">continue</span>;
<a name="l07419"></a>07419 
<a name="l07420"></a>07420       size = <span class="keyword">sizeof</span>(str);
<a name="l07421"></a>07421       <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hkeydvar, str, &amp;size, i, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l07422"></a>07422       strcpy(tag_name[i], str);
<a name="l07423"></a>07423 
<a name="l07424"></a>07424       <span class="comment">/* split varname in event, variable and index */</span>
<a name="l07425"></a>07425       <span class="keywordflow">if</span> (strchr(tag_name[i], <span class="charliteral">&apos;:&apos;</span>)) {
<a name="l07426"></a>07426          strcpy(event_name[i], tag_name[i]);
<a name="l07427"></a>07427          *strchr(event_name[i], <span class="charliteral">&apos;:&apos;</span>) = 0;
<a name="l07428"></a>07428          strcpy(var_name[i], strchr(tag_name[i], <span class="charliteral">&apos;:&apos;</span>) + 1);
<a name="l07429"></a>07429          var_index[i] = 0;
<a name="l07430"></a>07430          <span class="keywordflow">if</span> (strchr(var_name[i], <span class="charliteral">&apos;[&apos;</span>)) {
<a name="l07431"></a>07431             var_index[i] = atoi(strchr(var_name[i], <span class="charliteral">&apos;[&apos;</span>) + 1);
<a name="l07432"></a>07432             *strchr(var_name[i], <span class="charliteral">&apos;[&apos;</span>) = 0;
<a name="l07433"></a>07433          }
<a name="l07434"></a>07434       } <span class="keywordflow">else</span> {
<a name="l07435"></a>07435          sprintf(str, <span class="stringliteral">&quot;Tag \&quot;%s\&quot; has wrong format in panel %s&quot;</span>, tag_name[i], panel);
<a name="l07436"></a>07436          <a class="code" href="mgd_8h.html#a04908d388ee58943527604c035eb1aeb">gdImageString</a>(im, <a class="code" href="mgd_8h.html#a85cefa0dedac99f080ed516a27d78cdc">gdFontGiant</a>, <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> / 2 - (strlen(str) * <a class="code" href="mgd_8h.html#a85cefa0dedac99f080ed516a27d78cdc">gdFontGiant</a>-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a>) / 2,
<a name="l07437"></a>07437                        <a class="code" href="mainWindow_8cpp.html#ad12fc34ce789bce6c8a05d8a17138534">height</a> / 2, str, red);
<a name="l07438"></a>07438          <span class="keywordflow">goto</span> error;
<a name="l07439"></a>07439       }
<a name="l07440"></a>07440 
<a name="l07441"></a>07441       <span class="comment">/* search event_id */</span>
<a name="l07442"></a>07442       status = <a class="code" href="group__msectionh.html#ga613cde23ebe2d173ed146cc679a05260">hs_get_event_id</a>(0, event_name[i], &amp;event_id);
<a name="l07443"></a>07443 
<a name="l07444"></a>07444       <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>) {
<a name="l07445"></a>07445          sprintf(str, <span class="stringliteral">&quot;Event \&quot;%s\&quot; from panel \&quot;%s\&quot; not found in history&quot;</span>,
<a name="l07446"></a>07446                  event_name[i], panel);
<a name="l07447"></a>07447          <a class="code" href="mgd_8h.html#a04908d388ee58943527604c035eb1aeb">gdImageString</a>(im, <a class="code" href="mgd_8h.html#a85cefa0dedac99f080ed516a27d78cdc">gdFontGiant</a>, <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> / 2 - (strlen(str) * <a class="code" href="mgd_8h.html#a85cefa0dedac99f080ed516a27d78cdc">gdFontGiant</a>-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a>) / 2,
<a name="l07448"></a>07448                        <a class="code" href="mainWindow_8cpp.html#ad12fc34ce789bce6c8a05d8a17138534">height</a> / 2, str, red);
<a name="l07449"></a>07449          <span class="keywordflow">goto</span> error;
<a name="l07450"></a>07450       }
<a name="l07451"></a>07451 
<a name="l07452"></a>07452       <span class="comment">/* get timescale */</span>
<a name="l07453"></a>07453       <span class="keywordflow">if</span> (scale == 0) {
<a name="l07454"></a>07454          strcpy(str, <span class="stringliteral">&quot;1h&quot;</span>);
<a name="l07455"></a>07455          size = <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>;
<a name="l07456"></a>07456          status = <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkeypanel, <span class="stringliteral">&quot;Timescale&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l07457"></a>07457          <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l07458"></a>07458             <span class="comment">/* delete old integer key */</span>
<a name="l07459"></a>07459             <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hkeypanel, <span class="stringliteral">&quot;Timescale&quot;</span>, &amp;hkey);
<a name="l07460"></a>07460             <span class="keywordflow">if</span> (hkey)
<a name="l07461"></a>07461                <a class="code" href="group__msectionh.html#ga91277a012e0bfddbc32885da450409e0">db_delete_key</a>(hDB, hkey, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l07462"></a>07462 
<a name="l07463"></a>07463             strcpy(str, <span class="stringliteral">&quot;1h&quot;</span>);
<a name="l07464"></a>07464             size = <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>;
<a name="l07465"></a>07465             status =
<a name="l07466"></a>07466                 <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkeypanel, <span class="stringliteral">&quot;Timescale&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l07467"></a>07467          }
<a name="l07468"></a>07468 
<a name="l07469"></a>07469          scale = <a class="code" href="mhttpd_8c.html#a0f7449df3cdf1d111e5c926dc798180b">time_to_sec</a>(str);
<a name="l07470"></a>07470       }
<a name="l07471"></a>07471 
<a name="l07472"></a>07472       <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="mhttpd_8c.html#a5c707deff4e68c7283f2ed73665e0c77">MAX_VARS</a>; j++) {
<a name="l07473"></a>07473          factor[j] = 1;
<a name="l07474"></a>07474          offset[j] = 0;
<a name="l07475"></a>07475       }
<a name="l07476"></a>07476 
<a name="l07477"></a>07477       <span class="comment">/* get factors */</span>
<a name="l07478"></a>07478       size = <span class="keyword">sizeof</span>(float) * n_vars;
<a name="l07479"></a>07479       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkeypanel, <span class="stringliteral">&quot;Factor&quot;</span>, factor, &amp;size, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l07480"></a>07480 
<a name="l07481"></a>07481       <span class="comment">/* get offsets */</span>
<a name="l07482"></a>07482       size = <span class="keyword">sizeof</span>(float) * n_vars;
<a name="l07483"></a>07483       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkeypanel, <span class="stringliteral">&quot;Offset&quot;</span>, offset, &amp;size, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l07484"></a>07484 
<a name="l07485"></a>07485       <span class="comment">/* get axis type */</span>
<a name="l07486"></a>07486       size = <span class="keyword">sizeof</span>(logaxis);
<a name="l07487"></a>07487       logaxis = 0;
<a name="l07488"></a>07488       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkeypanel, <span class="stringliteral">&quot;Log axis&quot;</span>, &amp;logaxis, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l07489"></a>07489 
<a name="l07490"></a>07490       <span class="comment">/* get runmarker flag */</span>
<a name="l07491"></a>07491       size = <span class="keyword">sizeof</span>(runmarker);
<a name="l07492"></a>07492       runmarker = 1;
<a name="l07493"></a>07493       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkeypanel, <span class="stringliteral">&quot;Show run markers&quot;</span>, &amp;runmarker, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l07494"></a>07494 
<a name="l07495"></a>07495       <span class="comment">/* make ODB path from tag name */</span>
<a name="l07496"></a>07496       odbpath[0] = 0;
<a name="l07497"></a>07497       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Equipment&quot;</span>, &amp;hkeyroot);
<a name="l07498"></a>07498       <span class="keywordflow">if</span> (hkeyroot) {
<a name="l07499"></a>07499          <span class="keywordflow">for</span> (j = 0;; j++) {
<a name="l07500"></a>07500             <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkeyroot, j, &amp;hkeyeq);
<a name="l07501"></a>07501 
<a name="l07502"></a>07502             <span class="keywordflow">if</span> (!hkeyeq)
<a name="l07503"></a>07503                <span class="keywordflow">break</span>;
<a name="l07504"></a>07504 
<a name="l07505"></a>07505             <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkeyeq, &amp;key);
<a name="l07506"></a>07506             <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, event_name[i])) {
<a name="l07507"></a>07507                <span class="comment">/* check if variable is individual key under variabels/ */</span>
<a name="l07508"></a>07508                sprintf(str, <span class="stringliteral">&quot;Variables/%s&quot;</span>, var_name[i]);
<a name="l07509"></a>07509                <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hkeyeq, str, &amp;hkey);
<a name="l07510"></a>07510                <span class="keywordflow">if</span> (hkey) {
<a name="l07511"></a>07511                   sprintf(odbpath, <span class="stringliteral">&quot;/Equipment/%s/Variables/%s&quot;</span>, event_name[i],
<a name="l07512"></a>07512                           var_name[i]);
<a name="l07513"></a>07513                   <span class="keywordflow">break</span>;
<a name="l07514"></a>07514                }
<a name="l07515"></a>07515 
<a name="l07516"></a>07516                <span class="comment">/* check if variable is in setttins/names array */</span>
<a name="l07517"></a>07517                <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hkeyeq, <span class="stringliteral">&quot;Settings/Names&quot;</span>, &amp;hkeynames);
<a name="l07518"></a>07518                <span class="keywordflow">if</span> (hkeynames) {
<a name="l07519"></a>07519                   <span class="comment">/* extract variable name and Variables/&lt;key&gt; */</span>
<a name="l07520"></a>07520                   strcpy(str, var_name[i]);
<a name="l07521"></a>07521                   p = str + strlen(str) - 1;
<a name="l07522"></a>07522                   <span class="keywordflow">while</span> (p &gt; str &amp;&amp; *p != <span class="charliteral">&apos; &apos;</span>)
<a name="l07523"></a>07523                      p--;
<a name="l07524"></a>07524                   strcpy(key_name, p + 1);
<a name="l07525"></a>07525                   *p = 0;
<a name="l07526"></a>07526                   strcpy(varname, str);
<a name="l07527"></a>07527 
<a name="l07528"></a>07528                   <span class="comment">/* find key in single name array */</span>
<a name="l07529"></a>07529                   <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkeynames, &amp;key);
<a name="l07530"></a>07530                   <span class="keywordflow">for</span> (k = 0; k &lt; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; k++) {
<a name="l07531"></a>07531                      size = <span class="keyword">sizeof</span>(str);
<a name="l07532"></a>07532                      <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hkeynames, str, &amp;size, k, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l07533"></a>07533                      <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, varname)) {
<a name="l07534"></a>07534                         sprintf(odbpath, <span class="stringliteral">&quot;/Equipment/%s/Variables/%s[%d]&quot;</span>, event_name[i],
<a name="l07535"></a>07535                                 key_name, k);
<a name="l07536"></a>07536                         <span class="keywordflow">break</span>;
<a name="l07537"></a>07537                      }
<a name="l07538"></a>07538                   }
<a name="l07539"></a>07539                } <span class="keywordflow">else</span> {
<a name="l07540"></a>07540                   <span class="comment">/* go through /variables/&lt;name&gt; entries */</span>
<a name="l07541"></a>07541                   <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hkeyeq, <span class="stringliteral">&quot;Variables&quot;</span>, &amp;hkeyvars);
<a name="l07542"></a>07542                   <span class="keywordflow">if</span> (hkeyvars) {
<a name="l07543"></a>07543                      <span class="keywordflow">for</span> (k = 0;; k++) {
<a name="l07544"></a>07544                         <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkeyvars, k, &amp;hkey);
<a name="l07545"></a>07545 
<a name="l07546"></a>07546                         <span class="keywordflow">if</span> (!hkey)
<a name="l07547"></a>07547                            <span class="keywordflow">break</span>;
<a name="l07548"></a>07548 
<a name="l07549"></a>07549                         <span class="comment">/* find &quot;settins/names &lt;key&gt;&quot; for this key */</span>
<a name="l07550"></a>07550                         <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l07551"></a>07551 
<a name="l07552"></a>07552                         <span class="comment">/* find key in key_name array */</span>
<a name="l07553"></a>07553                         strcpy(key_name, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l07554"></a>07554                         sprintf(str, <span class="stringliteral">&quot;Settings/Names %s&quot;</span>, key_name);
<a name="l07555"></a>07555 
<a name="l07556"></a>07556                         <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hkeyeq, str, &amp;hkeynames);
<a name="l07557"></a>07557                         <span class="keywordflow">if</span> (hkeynames) {
<a name="l07558"></a>07558                            <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkeynames, &amp;key);
<a name="l07559"></a>07559                            <span class="keywordflow">for</span> (l = 0; l &lt; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; l++) {
<a name="l07560"></a>07560                               size = <span class="keyword">sizeof</span>(str);
<a name="l07561"></a>07561                               <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hkeynames, str, &amp;size, l,
<a name="l07562"></a>07562                                                 <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l07563"></a>07563                               <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, var_name[i])) {
<a name="l07564"></a>07564                                  sprintf(odbpath, <span class="stringliteral">&quot;/Equipment/%s/Variables/%s[%d]&quot;</span>,
<a name="l07565"></a>07565                                          event_name[i], key_name, l);
<a name="l07566"></a>07566                                  <span class="keywordflow">break</span>;
<a name="l07567"></a>07567                               }
<a name="l07568"></a>07568                            }
<a name="l07569"></a>07569                         }
<a name="l07570"></a>07570                      }
<a name="l07571"></a>07571                   }
<a name="l07572"></a>07572                }
<a name="l07573"></a>07573 
<a name="l07574"></a>07574                <span class="keywordflow">break</span>;
<a name="l07575"></a>07575             }
<a name="l07576"></a>07576          }
<a name="l07577"></a>07577 
<a name="l07578"></a>07578          <span class="keywordflow">if</span> (!hkeyeq) {
<a name="l07579"></a>07579             <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/History/Links&quot;</span>, &amp;hkeyroot);
<a name="l07580"></a>07580             <span class="keywordflow">if</span> (hkeyroot) {
<a name="l07581"></a>07581                <span class="keywordflow">for</span> (j = 0;; j++) {
<a name="l07582"></a>07582                   <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyroot, j, &amp;hkey);
<a name="l07583"></a>07583 
<a name="l07584"></a>07584                   <span class="keywordflow">if</span> (!hkey)
<a name="l07585"></a>07585                      <span class="keywordflow">break</span>;
<a name="l07586"></a>07586 
<a name="l07587"></a>07587                   <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l07588"></a>07588                   <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, event_name[i])) {
<a name="l07589"></a>07589                      <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkeyroot, j, &amp;hkey);
<a name="l07590"></a>07590                      <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hkey, var_name[i], &amp;hkey);
<a name="l07591"></a>07591                      <span class="keywordflow">if</span> (hkey) {
<a name="l07592"></a>07592                         <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l07593"></a>07593                         <a class="code" href="group__msectionh.html#ga37afa96e19d9d40a6eb213229e0e77a3">db_get_path</a>(hDB, hkey, odbpath, <span class="keyword">sizeof</span>(odbpath));
<a name="l07594"></a>07594                         <span class="keywordflow">if</span> (key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a> &gt; 1)
<a name="l07595"></a>07595                            sprintf(odbpath + strlen(odbpath), <span class="stringliteral">&quot;[%d]&quot;</span>, var_index[i]);
<a name="l07596"></a>07596                         <span class="keywordflow">break</span>;
<a name="l07597"></a>07597                      }
<a name="l07598"></a>07598                   }
<a name="l07599"></a>07599                }
<a name="l07600"></a>07600             }
<a name="l07601"></a>07601          }
<a name="l07602"></a>07602       }
<a name="l07603"></a>07603 
<a name="l07604"></a>07604       <span class="comment">/* search alarm limits */</span>
<a name="l07605"></a>07605       upper_limit[i] = lower_limit[i] = -12345;
<a name="l07606"></a>07606       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Alarms/Alarms&quot;</span>, &amp;hkeyroot);
<a name="l07607"></a>07607       <span class="keywordflow">if</span> (odbpath[0] &amp;&amp; hkeyroot) {
<a name="l07608"></a>07608          <span class="keywordflow">for</span> (j = 0;; j++) {
<a name="l07609"></a>07609             <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkeyroot, j, &amp;hkey);
<a name="l07610"></a>07610 
<a name="l07611"></a>07611             <span class="keywordflow">if</span> (!hkey)
<a name="l07612"></a>07612                <span class="keywordflow">break</span>;
<a name="l07613"></a>07613 
<a name="l07614"></a>07614             size = <span class="keyword">sizeof</span>(str);
<a name="l07615"></a>07615             <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkey, <span class="stringliteral">&quot;Condition&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l07616"></a>07616 
<a name="l07617"></a>07617             <span class="keywordflow">if</span> (strstr(str, odbpath)) {
<a name="l07618"></a>07618                <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;&lt;&apos;</span>)) {
<a name="l07619"></a>07619                   p = strchr(str, <span class="charliteral">&apos;&lt;&apos;</span>) + 1;
<a name="l07620"></a>07620                   <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;=&apos;</span>)
<a name="l07621"></a>07621                      p++;
<a name="l07622"></a>07622                   lower_limit[i] = (float) (factor[i] * atof(p) + offset[i]);
<a name="l07623"></a>07623                }
<a name="l07624"></a>07624                <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;&gt;&apos;</span>)) {
<a name="l07625"></a>07625                   p = strchr(str, <span class="charliteral">&apos;&gt;&apos;</span>) + 1;
<a name="l07626"></a>07626                   <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;=&apos;</span>)
<a name="l07627"></a>07627                      p++;
<a name="l07628"></a>07628                   upper_limit[i] = (float) (factor[i] * atof(p) + offset[i]);
<a name="l07629"></a>07629                }
<a name="l07630"></a>07630             }
<a name="l07631"></a>07631          }
<a name="l07632"></a>07632       }
<a name="l07633"></a>07633 
<a name="l07634"></a>07634       <span class="keywordflow">do</span> {
<a name="l07635"></a>07635          bsize = tsize = hbuffer_size;
<a name="l07636"></a>07636          memset(ybuffer, 0, bsize);
<a name="l07637"></a>07637          status =
<a name="l07638"></a>07638              <a class="code" href="group__msectionh.html#ga1413cb517aa08a142a2028b0455fa924">hs_read</a>(event_id, <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>() - scale + toffset, <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>() + toffset,
<a name="l07639"></a>07639                      scale / 1000, var_name[i], var_index[i], tbuffer, &amp;tsize, ybuffer,
<a name="l07640"></a>07640                      &amp;bsize, &amp;type, &amp;n_point[i]);
<a name="l07641"></a>07641 
<a name="l07642"></a>07642          <span class="keywordflow">if</span> (status == <a class="code" href="group__err26.html#ga8b8cfc047a951f9afe9f833484d7e814">HS_TRUNCATED</a>) {
<a name="l07643"></a>07643             hbuffer_size *= 2;
<a name="l07644"></a>07644             tbuffer = realloc(tbuffer, hbuffer_size);
<a name="l07645"></a>07645             assert(tbuffer);
<a name="l07646"></a>07646             ybuffer = realloc(ybuffer, hbuffer_size);
<a name="l07647"></a>07647             assert(ybuffer);
<a name="l07648"></a>07648          }
<a name="l07649"></a>07649 
<a name="l07650"></a>07650       } <span class="keywordflow">while</span> (status == <a class="code" href="group__err26.html#ga8b8cfc047a951f9afe9f833484d7e814">HS_TRUNCATED</a>);
<a name="l07651"></a>07651 
<a name="l07652"></a>07652       <span class="keywordflow">if</span> (status == <a class="code" href="group__err26.html#ga1b25c77e3145468cf83f8e88bf1e0804">HS_UNDEFINED_VAR</a>) {
<a name="l07653"></a>07653          sprintf(str, <span class="stringliteral">&quot;Variable \&quot;%s\&quot; not found in history&quot;</span>, var_name[i]);
<a name="l07654"></a>07654          <a class="code" href="mgd_8h.html#a04908d388ee58943527604c035eb1aeb">gdImageString</a>(im, <a class="code" href="mgd_8h.html#a85cefa0dedac99f080ed516a27d78cdc">gdFontGiant</a>, <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> / 2 - (strlen(str) * <a class="code" href="mgd_8h.html#a85cefa0dedac99f080ed516a27d78cdc">gdFontGiant</a>-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a>) / 2,
<a name="l07655"></a>07655                        <a class="code" href="mainWindow_8cpp.html#ad12fc34ce789bce6c8a05d8a17138534">height</a> / 2, str, red);
<a name="l07656"></a>07656          <span class="keywordflow">goto</span> error;
<a name="l07657"></a>07657       }
<a name="l07658"></a>07658 
<a name="l07659"></a>07659       <span class="keywordflow">for</span> (j = 0; j &lt; (int) n_point[i]; j++) {
<a name="l07660"></a>07660          x[i][j] = tbuffer[j] - <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>();
<a name="l07661"></a>07661 
<a name="l07662"></a>07662          <span class="comment">/* convert data to float */</span>
<a name="l07663"></a>07663          <span class="keywordflow">switch</span> (type) {
<a name="l07664"></a>07664          <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga7499d3aa0ca98d255f5147494ab4f572">TID_BYTE</a>:
<a name="l07665"></a>07665             y[i][j] = (float) *(((<a class="code" href="group__mcstdinclude.html#ga4ae1dab0fb4b072a66584546209e7d58">BYTE</a> *) ybuffer) + j);
<a name="l07666"></a>07666             <span class="keywordflow">break</span>;
<a name="l07667"></a>07667          <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga150e3437f490b1e7c0e11046a9ead174">TID_SBYTE</a>:
<a name="l07668"></a>07668             y[i][j] = (float) *(((<span class="keywordtype">char</span> *) ybuffer) + j);
<a name="l07669"></a>07669             <span class="keywordflow">break</span>;
<a name="l07670"></a>07670          <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#gad4af77af5f2910e73596592030e37ab7">TID_CHAR</a>:
<a name="l07671"></a>07671             y[i][j] = (float) *(((<span class="keywordtype">char</span> *) ybuffer) + j);
<a name="l07672"></a>07672             <span class="keywordflow">break</span>;
<a name="l07673"></a>07673          <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga681cbe2c114c62cecccb882544d2debb">TID_WORD</a>:
<a name="l07674"></a>07674             y[i][j] = (float) *(((<a class="code" href="unionWORD.html">WORD</a> *) ybuffer) + j);
<a name="l07675"></a>07675             <span class="keywordflow">break</span>;
<a name="l07676"></a>07676          <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga4281dafac4285eae3e3c9be0a1d93c5a">TID_SHORT</a>:
<a name="l07677"></a>07677             y[i][j] = (float) *(((<span class="keywordtype">short</span> *) ybuffer) + j);
<a name="l07678"></a>07678             <span class="keywordflow">break</span>;
<a name="l07679"></a>07679          <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a>:
<a name="l07680"></a>07680             y[i][j] = (float) *(((<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> *) ybuffer) + j);
<a name="l07681"></a>07681             <span class="keywordflow">break</span>;
<a name="l07682"></a>07682          <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>:
<a name="l07683"></a>07683             y[i][j] = (float) *(((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) ybuffer) + j);
<a name="l07684"></a>07684             <span class="keywordflow">break</span>;
<a name="l07685"></a>07685          <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>:
<a name="l07686"></a>07686             y[i][j] = (float) *(((<a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> *) ybuffer) + j);
<a name="l07687"></a>07687             <span class="keywordflow">break</span>;
<a name="l07688"></a>07688          <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>:
<a name="l07689"></a>07689             y[i][j] = (float) *(((<span class="keywordtype">float</span> *) ybuffer) + j);
<a name="l07690"></a>07690             <span class="keywordflow">break</span>;
<a name="l07691"></a>07691          <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga13378fa303cf601b4b491866a6688362">TID_DOUBLE</a>:
<a name="l07692"></a>07692             y[i][j] = (float) *(((<span class="keywordtype">double</span> *) ybuffer) + j);
<a name="l07693"></a>07693             <span class="keywordflow">break</span>;
<a name="l07694"></a>07694          }
<a name="l07695"></a>07695 
<a name="l07696"></a>07696          <span class="comment">/* avoid overflow */</span>
<a name="l07697"></a>07697          <span class="keywordflow">if</span> (y[i][j] &gt; 1E30)
<a name="l07698"></a>07698             y[i][j] = 1E30f;
<a name="l07699"></a>07699 
<a name="l07700"></a>07700          <span class="comment">/* apply factor and offset */</span>
<a name="l07701"></a>07701          y[i][j] = y[i][j] * factor[i] + offset[i];
<a name="l07702"></a>07702 
<a name="l07703"></a>07703          <span class="comment">/* calculate ymin and ymax */</span>
<a name="l07704"></a>07704          <span class="keywordflow">if</span> ((i == 0 || <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> != -1) &amp;&amp; j == 0)
<a name="l07705"></a>07705             ymin = ymax = y[i][0];
<a name="l07706"></a>07706          <span class="keywordflow">else</span> {
<a name="l07707"></a>07707             <span class="keywordflow">if</span> (y[i][j] &gt; ymax)
<a name="l07708"></a>07708                ymax = y[i][j];
<a name="l07709"></a>07709             <span class="keywordflow">if</span> (y[i][j] &lt; ymin)
<a name="l07710"></a>07710                ymin = y[i][j];
<a name="l07711"></a>07711          }
<a name="l07712"></a>07712       }
<a name="l07713"></a>07713    }
<a name="l07714"></a>07714 
<a name="l07715"></a>07715    <span class="comment">/* check if ylow = 0 */</span>
<a name="l07716"></a>07716    <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> == -1) {
<a name="l07717"></a>07717       flag = 0;
<a name="l07718"></a>07718       size = <span class="keyword">sizeof</span>(flag);
<a name="l07719"></a>07719       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkeypanel, <span class="stringliteral">&quot;Zero ylow&quot;</span>, &amp;flag, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l07720"></a>07720       <span class="keywordflow">if</span> (flag &amp;&amp; ymin &gt; 0)
<a name="l07721"></a>07721          ymin = 0;
<a name="l07722"></a>07722    }
<a name="l07723"></a>07723 
<a name="l07724"></a>07724    <span class="comment">/* if min and max too close together, switch to linear axis */</span>
<a name="l07725"></a>07725    <span class="keywordflow">if</span> (logaxis &amp;&amp; ymin &gt; 0 &amp;&amp; ymax &gt; 0) {
<a name="l07726"></a>07726       yb1 = pow(10, floor(log(ymin) / <a class="code" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>));
<a name="l07727"></a>07727       yf1 = floor(ymin / yb1);
<a name="l07728"></a>07728       yb2 = pow(10, floor(log(ymax) / <a class="code" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>));
<a name="l07729"></a>07729       yf2 = floor(ymax / yb2);
<a name="l07730"></a>07730 
<a name="l07731"></a>07731       <span class="keywordflow">if</span> (yb1 == yb2 &amp;&amp; yf1 == yf2)
<a name="l07732"></a>07732          logaxis = 0;
<a name="l07733"></a>07733       <span class="keywordflow">else</span> {
<a name="l07734"></a>07734          <span class="comment">/* round down and up ymin and ymax */</span>
<a name="l07735"></a>07735          ybase = pow(10, floor(log(ymin) / <a class="code" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>));
<a name="l07736"></a>07736          ymin = (float) (floor(ymin / ybase) * ybase);
<a name="l07737"></a>07737          ybase = pow(10, floor(log(ymax) / <a class="code" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>));
<a name="l07738"></a>07738          ymax = (float) ((floor(ymax / ybase) + 1) * ybase);
<a name="l07739"></a>07739       }
<a name="l07740"></a>07740    }
<a name="l07741"></a>07741 
<a name="l07742"></a>07742    <span class="comment">/* avoid negative limits for log axis */</span>
<a name="l07743"></a>07743    <span class="keywordflow">if</span> (logaxis) {
<a name="l07744"></a>07744       <span class="keywordflow">if</span> (ymax &lt;= 0)
<a name="l07745"></a>07745          ymax = 1;
<a name="l07746"></a>07746       <span class="keywordflow">if</span> (ymin &lt;= 0)
<a name="l07747"></a>07747          ymin = 1E-12f;
<a name="l07748"></a>07748    }
<a name="l07749"></a>07749 
<a name="l07750"></a>07750    <span class="comment">/* increase limits by 5% */</span>
<a name="l07751"></a>07751    <span class="keywordflow">if</span> (ymin == 0 &amp;&amp; ymax == 0) {
<a name="l07752"></a>07752       ymin = -1;
<a name="l07753"></a>07753       ymax = 1;
<a name="l07754"></a>07754    } <span class="keywordflow">else</span> {
<a name="l07755"></a>07755       <span class="keywordflow">if</span> (!logaxis) {
<a name="l07756"></a>07756          ymax += (ymax - ymin) / 20.f;
<a name="l07757"></a>07757 
<a name="l07758"></a>07758          <span class="keywordflow">if</span> (ymin != 0)
<a name="l07759"></a>07759             ymin -= (ymax - ymin) / 20.f;
<a name="l07760"></a>07760       }
<a name="l07761"></a>07761    }
<a name="l07762"></a>07762 
<a name="l07763"></a>07763    <span class="comment">/* avoid ymin == ymax */</span>
<a name="l07764"></a>07764    <span class="keywordflow">if</span> (ymax == ymin) {
<a name="l07765"></a>07765       <span class="keywordflow">if</span> (logaxis) {
<a name="l07766"></a>07766          ymax *= 2;
<a name="l07767"></a>07767          ymin /= 2;
<a name="l07768"></a>07768       } <span class="keywordflow">else</span> {
<a name="l07769"></a>07769          ymax += 1;
<a name="l07770"></a>07770          ymin -= 1;
<a name="l07771"></a>07771       }
<a name="l07772"></a>07772    }
<a name="l07773"></a>07773 
<a name="l07774"></a>07774    <span class="comment">/* calculate X limits */</span>
<a name="l07775"></a>07775    xmin = (float) (-scale / 3600.0 + toffset / 3600.0);
<a name="l07776"></a>07776    xmax = (float) (toffset / 3600.0);
<a name="l07777"></a>07777 
<a name="l07778"></a>07778    <span class="comment">/* caluclate required space for Y-axis */</span>
<a name="l07779"></a>07779    aoffset =
<a name="l07780"></a>07780        <a class="code" href="mhttpd_8c.html#a64e35192402b30fb1908344ff3bc5376">vaxis</a>(im, <a class="code" href="mgd_8h.html#ae4c76073859021a790e1fd37c07a1356">gdFontSmall</a>, black, ltgrey, 0, 0, <a class="code" href="mainWindow_8cpp.html#ad12fc34ce789bce6c8a05d8a17138534">height</a>, -3, -5, -7, -8, 0, ymin, ymax,
<a name="l07781"></a>07781              logaxis);
<a name="l07782"></a>07782    aoffset += 2;
<a name="l07783"></a>07783 
<a name="l07784"></a>07784    x1 = aoffset;
<a name="l07785"></a>07785    y1 = <a class="code" href="mainWindow_8cpp.html#ad12fc34ce789bce6c8a05d8a17138534">height</a> - 20;
<a name="l07786"></a>07786    x2 = <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> - 20;
<a name="l07787"></a>07787    y2 = 20;
<a name="l07788"></a>07788 
<a name="l07789"></a>07789    <a class="code" href="mgd_8h.html#a1e534e750e1b336b8961a62ebec88511">gdImageFilledRectangle</a>(im, x1, y2, x2, y1, white);
<a name="l07790"></a>07790 
<a name="l07791"></a>07791    <span class="comment">/* draw axis frame */</span>
<a name="l07792"></a>07792    <a class="code" href="mhttpd_8c.html#a777d92b7262b97dd454477828f8df20a">taxis</a>(im, <a class="code" href="mgd_8h.html#ae4c76073859021a790e1fd37c07a1356">gdFontSmall</a>, black, ltgrey, x1, y1, x2 - x1, <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a>, 3, 5, 9, 10, 0,
<a name="l07793"></a>07793          <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>() - scale + toffset, <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>() + toffset);
<a name="l07794"></a>07794 
<a name="l07795"></a>07795    <span class="comment">/* use following line for a X-axis in seconds instead of a time axis */</span>
<a name="l07796"></a>07796    <span class="comment">//haxis(im, gdFontSmall, black, ltgrey, x1, y1, x2-x1, 3, 5, 9, 10, 0, xmin,  xmax);</span>
<a name="l07797"></a>07797    <a class="code" href="mhttpd_8c.html#a64e35192402b30fb1908344ff3bc5376">vaxis</a>(im, <a class="code" href="mgd_8h.html#ae4c76073859021a790e1fd37c07a1356">gdFontSmall</a>, black, ltgrey, x1, y1, y1 - y2, -3, -5, -7, -8, x2 - x1, ymin,
<a name="l07798"></a>07798          ymax, logaxis);
<a name="l07799"></a>07799    <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, x1, y2, x2, y2, black);
<a name="l07800"></a>07800    <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, x2, y2, x2, y1, black);
<a name="l07801"></a>07801 
<a name="l07802"></a>07802    xs = ys = xold = yold = 0;
<a name="l07803"></a>07803 
<a name="l07804"></a>07804    <span class="comment">/* write run markes if selected */</span>
<a name="l07805"></a>07805    <span class="keywordflow">if</span> (runmarker) {
<a name="l07806"></a>07806       bsize = <span class="keyword">sizeof</span>(ybuffer);
<a name="l07807"></a>07807       tsize = <span class="keyword">sizeof</span>(tbuffer);
<a name="l07808"></a>07808 
<a name="l07809"></a>07809       <span class="comment">/* read run state */</span>
<a name="l07810"></a>07810 
<a name="l07811"></a>07811       status = <a class="code" href="group__msectionh.html#ga1413cb517aa08a142a2028b0455fa924">hs_read</a>(0, <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>() - scale + toffset, <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>() + toffset, 0,
<a name="l07812"></a>07812                        <span class="stringliteral">&quot;State&quot;</span>, 0, tbuffer, &amp;tsize, ybuffer, &amp;bsize, &amp;type, &amp;n_marker);
<a name="l07813"></a>07813 
<a name="l07814"></a>07814       state = NULL;
<a name="l07815"></a>07815       <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga1b25c77e3145468cf83f8e88bf1e0804">HS_UNDEFINED_VAR</a>) {
<a name="l07816"></a>07816          state = <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(<span class="keyword">sizeof</span>(<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>) * n_marker);
<a name="l07817"></a>07817          <span class="keywordflow">for</span> (j = 0; j &lt; (int) n_marker; j++)
<a name="l07818"></a>07818             state[j] = *((<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> *) ybuffer + j);
<a name="l07819"></a>07819       }
<a name="l07820"></a>07820 
<a name="l07821"></a>07821       bsize = <span class="keyword">sizeof</span>(ybuffer);
<a name="l07822"></a>07822       tsize = <span class="keyword">sizeof</span>(tbuffer);
<a name="l07823"></a>07823 
<a name="l07824"></a>07824       <span class="comment">/* read run number */</span>
<a name="l07825"></a>07825 
<a name="l07826"></a>07826       status = <a class="code" href="group__msectionh.html#ga1413cb517aa08a142a2028b0455fa924">hs_read</a>(0, <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>() - scale + toffset, <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>() + toffset, 0,
<a name="l07827"></a>07827                        <span class="stringliteral">&quot;Run number&quot;</span>, 0, tbuffer, &amp;tsize, ybuffer, &amp;bsize,
<a name="l07828"></a>07828                        &amp;type, &amp;n_marker);
<a name="l07829"></a>07829 
<a name="l07830"></a>07830       <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga1b25c77e3145468cf83f8e88bf1e0804">HS_UNDEFINED_VAR</a>) {
<a name="l07831"></a>07831          xs_old = -1;
<a name="l07832"></a>07832          xmaxm = x1;
<a name="l07833"></a>07833          <span class="keywordflow">for</span> (j = 0; j &lt; (int) n_marker; j++) {
<a name="l07834"></a>07834             x_marker = tbuffer[j] - <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>();
<a name="l07835"></a>07835             xs = (int) ((x_marker / 3600.0 - xmin) / (xmax - xmin) * (x2 - x1) + x1 +
<a name="l07836"></a>07836                         0.5);
<a name="l07837"></a>07837 
<a name="l07838"></a>07838             run_number = *((<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> *) ybuffer + j);
<a name="l07839"></a>07839 
<a name="l07840"></a>07840             <span class="keywordflow">if</span> (xs &lt;= xs_old)
<a name="l07841"></a>07841                xs = xs_old + 1;
<a name="l07842"></a>07842             xs_old = xs;
<a name="l07843"></a>07843 
<a name="l07844"></a>07844             <a class="code" href="mgd_8h.html#ab32b95634e858c952905557f32d20481">gdImageDashedLine</a>(im, xs, y1, xs, y2, state_col[state[j] - 1]);
<a name="l07845"></a>07845 
<a name="l07846"></a>07846             sprintf(str, <span class="stringliteral">&quot;%ld&quot;</span>, run_number);
<a name="l07847"></a>07847 
<a name="l07848"></a>07848             <span class="keywordflow">if</span> (state[j] == <a class="code" href="group__mdefineh.html#gac4c0304c569818c811515e24523c3150">STATE_RUNNING</a>) {
<a name="l07849"></a>07849                <span class="keywordflow">if</span> (xs &gt; xmaxm) {
<a name="l07850"></a>07850                   <a class="code" href="mgd_8h.html#a70808c967cac06eb9043cef2d336482b">gdImageStringUp</a>(im, <a class="code" href="mgd_8h.html#ae4c76073859021a790e1fd37c07a1356">gdFontSmall</a>, xs + 0,
<a name="l07851"></a>07851                                   y2 + 2 + <a class="code" href="mgd_8h.html#ae4c76073859021a790e1fd37c07a1356">gdFontSmall</a>-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a> * strlen(str), str, black);
<a name="l07852"></a>07852                   xmaxm = xs - 2 + <a class="code" href="mgd_8h.html#ae4c76073859021a790e1fd37c07a1356">gdFontSmall</a>-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a>;
<a name="l07853"></a>07853                }
<a name="l07854"></a>07854             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state[j] == <a class="code" href="group__mdefineh.html#ga6a8dac64367bd381245f2eb09a7fe919">STATE_STOPPED</a>) {
<a name="l07855"></a>07855                <span class="keywordflow">if</span> (xs + 2 - <a class="code" href="mgd_8h.html#ae4c76073859021a790e1fd37c07a1356">gdFontSmall</a>-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> &gt; xmaxm) {
<a name="l07856"></a>07856                   <a class="code" href="mgd_8h.html#a70808c967cac06eb9043cef2d336482b">gdImageStringUp</a>(im, <a class="code" href="mgd_8h.html#ae4c76073859021a790e1fd37c07a1356">gdFontSmall</a>, xs + 2 - <a class="code" href="mgd_8h.html#ae4c76073859021a790e1fd37c07a1356">gdFontSmall</a>-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a>,
<a name="l07857"></a>07857                                   y2 + 2 + <a class="code" href="mgd_8h.html#ae4c76073859021a790e1fd37c07a1356">gdFontSmall</a>-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a> * strlen(str), str, black);
<a name="l07858"></a>07858                   xmaxm = xs - 1;
<a name="l07859"></a>07859                }
<a name="l07860"></a>07860             }
<a name="l07861"></a>07861          }
<a name="l07862"></a>07862       }
<a name="l07863"></a>07863 
<a name="l07864"></a>07864       <span class="keywordflow">if</span> (state)
<a name="l07865"></a>07865          <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(state);
<a name="l07866"></a>07866    }
<a name="l07867"></a>07867 
<a name="l07868"></a>07868    <span class="keywordflow">for</span> (i = 0; i &lt; n_vars; i++) {
<a name="l07869"></a>07869       <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> != -1 &amp;&amp; <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> != i)
<a name="l07870"></a>07870          <span class="keywordflow">continue</span>;
<a name="l07871"></a>07871 
<a name="l07872"></a>07872       <span class="comment">/* draw alarm limits */</span>
<a name="l07873"></a>07873       <span class="keywordflow">if</span> (lower_limit[i] != -12345) {
<a name="l07874"></a>07874          <span class="keywordflow">if</span> (logaxis) {
<a name="l07875"></a>07875             <span class="keywordflow">if</span> (lower_limit[i] &lt;= 0)
<a name="l07876"></a>07876                ys = y1;
<a name="l07877"></a>07877             <span class="keywordflow">else</span>
<a name="l07878"></a>07878                ys = (int) (y1 -
<a name="l07879"></a>07879                            (log(lower_limit[i]) - log(ymin)) / (log(ymax) -
<a name="l07880"></a>07880                                                                 log(ymin)) * (y1 - y2) +
<a name="l07881"></a>07881                            0.5);
<a name="l07882"></a>07882          } <span class="keywordflow">else</span>
<a name="l07883"></a>07883             ys = (int) (y1 - (lower_limit[i] - ymin) / (ymax - ymin) * (y1 - y2) + 0.5);
<a name="l07884"></a>07884 
<a name="l07885"></a>07885          <a class="code" href="mgd_8h.html#ab32b95634e858c952905557f32d20481">gdImageDashedLine</a>(im, x1, ys, x2, ys, curve_col[i]);
<a name="l07886"></a>07886 
<a name="l07887"></a>07887          poly[0].<a class="code" href="structgdPoint.html#a35475f53658ff9ca16a76d4611d94dd5">x</a> = x1;
<a name="l07888"></a>07888          poly[0].<a class="code" href="structgdPoint.html#ade4fb16e8b71fcde2657b0a40450f293">y</a> = ys;
<a name="l07889"></a>07889          poly[1].<a class="code" href="structgdPoint.html#a35475f53658ff9ca16a76d4611d94dd5">x</a> = x1 + 5;
<a name="l07890"></a>07890          poly[1].<a class="code" href="structgdPoint.html#ade4fb16e8b71fcde2657b0a40450f293">y</a> = ys;
<a name="l07891"></a>07891          poly[2].<a class="code" href="structgdPoint.html#a35475f53658ff9ca16a76d4611d94dd5">x</a> = x1;
<a name="l07892"></a>07892          poly[2].<a class="code" href="structgdPoint.html#ade4fb16e8b71fcde2657b0a40450f293">y</a> = ys - 5;
<a name="l07893"></a>07893 
<a name="l07894"></a>07894          <a class="code" href="mgd_8h.html#a07960244fc3522d791b07aff1cafe6fa">gdImageFilledPolygon</a>(im, poly, 3, curve_col[i]);
<a name="l07895"></a>07895       }
<a name="l07896"></a>07896       <span class="keywordflow">if</span> (upper_limit[i] != -12345) {
<a name="l07897"></a>07897          <span class="keywordflow">if</span> (logaxis) {
<a name="l07898"></a>07898             <span class="keywordflow">if</span> (upper_limit[i] &lt;= 0)
<a name="l07899"></a>07899                ys = y1;
<a name="l07900"></a>07900             <span class="keywordflow">else</span>
<a name="l07901"></a>07901                ys = (int) (y1 -
<a name="l07902"></a>07902                            (log(upper_limit[i]) - log(ymin)) / (log(ymax) -
<a name="l07903"></a>07903                                                                 log(ymin)) * (y1 - y2) +
<a name="l07904"></a>07904                            0.5);
<a name="l07905"></a>07905          } <span class="keywordflow">else</span>
<a name="l07906"></a>07906             ys = (int) (y1 - (upper_limit[i] - ymin) / (ymax - ymin) * (y1 - y2) + 0.5);
<a name="l07907"></a>07907 
<a name="l07908"></a>07908          <a class="code" href="mgd_8h.html#ab32b95634e858c952905557f32d20481">gdImageDashedLine</a>(im, x1, ys, x2, ys, curve_col[i]);
<a name="l07909"></a>07909 
<a name="l07910"></a>07910          poly[0].<a class="code" href="structgdPoint.html#a35475f53658ff9ca16a76d4611d94dd5">x</a> = x1;
<a name="l07911"></a>07911          poly[0].<a class="code" href="structgdPoint.html#ade4fb16e8b71fcde2657b0a40450f293">y</a> = ys;
<a name="l07912"></a>07912          poly[1].<a class="code" href="structgdPoint.html#a35475f53658ff9ca16a76d4611d94dd5">x</a> = x1 + 5;
<a name="l07913"></a>07913          poly[1].<a class="code" href="structgdPoint.html#ade4fb16e8b71fcde2657b0a40450f293">y</a> = ys;
<a name="l07914"></a>07914          poly[2].<a class="code" href="structgdPoint.html#a35475f53658ff9ca16a76d4611d94dd5">x</a> = x1;
<a name="l07915"></a>07915          poly[2].<a class="code" href="structgdPoint.html#ade4fb16e8b71fcde2657b0a40450f293">y</a> = ys + 5;
<a name="l07916"></a>07916 
<a name="l07917"></a>07917          <a class="code" href="mgd_8h.html#a07960244fc3522d791b07aff1cafe6fa">gdImageFilledPolygon</a>(im, poly, 3, curve_col[i]);
<a name="l07918"></a>07918       }
<a name="l07919"></a>07919 
<a name="l07920"></a>07920       <span class="keywordflow">for</span> (j = 0; j &lt; (int) n_point[i]; j++) {
<a name="l07921"></a>07921          xs = (int) ((x[i][j] / 3600.0 - xmin) / (xmax - xmin) * (x2 - x1) + x1 + 0.5);
<a name="l07922"></a>07922 
<a name="l07923"></a>07923          <span class="keywordflow">if</span> (logaxis) {
<a name="l07924"></a>07924             <span class="keywordflow">if</span> (y[i][j] &lt;= 0)
<a name="l07925"></a>07925                ys = y1;
<a name="l07926"></a>07926             <span class="keywordflow">else</span>
<a name="l07927"></a>07927                ys = (int) (y1 -
<a name="l07928"></a>07928                            (log(y[i][j]) - log(ymin)) / (log(ymax) - log(ymin)) * (y1 -
<a name="l07929"></a>07929                                                                                    y2) +
<a name="l07930"></a>07930                            0.5);
<a name="l07931"></a>07931          } <span class="keywordflow">else</span>
<a name="l07932"></a>07932             ys = (int) (y1 - (y[i][j] - ymin) / (ymax - ymin) * (y1 - y2) + 0.5);
<a name="l07933"></a>07933 
<a name="l07934"></a>07934          <span class="keywordflow">if</span> (j &gt; 0)
<a name="l07935"></a>07935             <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, xold, yold, xs, ys, curve_col[i]);
<a name="l07936"></a>07936          xold = xs;
<a name="l07937"></a>07937          yold = ys;
<a name="l07938"></a>07938       }
<a name="l07939"></a>07939 
<a name="l07940"></a>07940       <span class="keywordflow">if</span> (n_point[i] &gt; 0) {
<a name="l07941"></a>07941          poly[0].<a class="code" href="structgdPoint.html#a35475f53658ff9ca16a76d4611d94dd5">x</a> = xs;
<a name="l07942"></a>07942          poly[0].<a class="code" href="structgdPoint.html#ade4fb16e8b71fcde2657b0a40450f293">y</a> = ys;
<a name="l07943"></a>07943          poly[1].<a class="code" href="structgdPoint.html#a35475f53658ff9ca16a76d4611d94dd5">x</a> = xs + 12;
<a name="l07944"></a>07944          poly[1].<a class="code" href="structgdPoint.html#ade4fb16e8b71fcde2657b0a40450f293">y</a> = ys - 6;
<a name="l07945"></a>07945          poly[2].<a class="code" href="structgdPoint.html#a35475f53658ff9ca16a76d4611d94dd5">x</a> = xs + 12;
<a name="l07946"></a>07946          poly[2].<a class="code" href="structgdPoint.html#ade4fb16e8b71fcde2657b0a40450f293">y</a> = ys + 6;
<a name="l07947"></a>07947 
<a name="l07948"></a>07948          <a class="code" href="mgd_8h.html#a07960244fc3522d791b07aff1cafe6fa">gdImageFilledPolygon</a>(im, poly, 3, curve_col[i]);
<a name="l07949"></a>07949       }
<a name="l07950"></a>07950    }
<a name="l07951"></a>07951 
<a name="l07952"></a>07952    <span class="keywordflow">if</span> (labels) {
<a name="l07953"></a>07953       <span class="keywordflow">for</span> (i = 0; i &lt; n_vars; i++) {
<a name="l07954"></a>07954          <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> != -1 &amp;&amp; <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> != i)
<a name="l07955"></a>07955             <span class="keywordflow">continue</span>;
<a name="l07956"></a>07956 
<a name="l07957"></a>07957          <span class="keywordflow">if</span> (factor[i] != 1) {
<a name="l07958"></a>07958             <span class="keywordflow">if</span> (offset[i] == 0)
<a name="l07959"></a>07959                sprintf(str, <span class="stringliteral">&quot;%s * %1.2lG&quot;</span>, strchr(tag_name[i], <span class="charliteral">&apos;:&apos;</span>) + 1, factor[i]);
<a name="l07960"></a>07960             <span class="keywordflow">else</span>
<a name="l07961"></a>07961                sprintf(str, <span class="stringliteral">&quot;%s * %1.2lG %c %1.5lG&quot;</span>, strchr(tag_name[i], <span class="charliteral">&apos;:&apos;</span>) + 1,
<a name="l07962"></a>07962                        factor[i], offset[i] &lt; 0 ? <span class="charliteral">&apos;-&apos;</span> : <span class="charliteral">&apos;+&apos;</span>, fabs(offset[i]));
<a name="l07963"></a>07963          } <span class="keywordflow">else</span> {
<a name="l07964"></a>07964             <span class="keywordflow">if</span> (offset[i] == 0)
<a name="l07965"></a>07965                sprintf(str, <span class="stringliteral">&quot;%s&quot;</span>, strchr(tag_name[i], <span class="charliteral">&apos;:&apos;</span>) + 1);
<a name="l07966"></a>07966             <span class="keywordflow">else</span>
<a name="l07967"></a>07967                sprintf(str, <span class="stringliteral">&quot;%s %c %1.5lG&quot;</span>, strchr(tag_name[i], <span class="charliteral">&apos;:&apos;</span>) + 1,
<a name="l07968"></a>07968                        offset[i] &lt; 0 ? <span class="charliteral">&apos;-&apos;</span> : <span class="charliteral">&apos;+&apos;</span>, fabs(offset[i]));
<a name="l07969"></a>07969          }
<a name="l07970"></a>07970 
<a name="l07971"></a>07971          row = <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> == -1 ? i : 0;
<a name="l07972"></a>07972 
<a name="l07973"></a>07973          <a class="code" href="mgd_8h.html#a1e534e750e1b336b8961a62ebec88511">gdImageFilledRectangle</a>(im,
<a name="l07974"></a>07974                                 x1 + 10,
<a name="l07975"></a>07975                                 y2 + 10 + row * (<a class="code" href="mgd_8h.html#a590369e28727c7b3c3fbb8694cf4b5ef">gdFontMediumBold</a>-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> + 10),
<a name="l07976"></a>07976                                 x1 + 10 + strlen(str) * <a class="code" href="mgd_8h.html#a590369e28727c7b3c3fbb8694cf4b5ef">gdFontMediumBold</a>-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a> + 10,
<a name="l07977"></a>07977                                 y2 + 10 + row * (<a class="code" href="mgd_8h.html#a590369e28727c7b3c3fbb8694cf4b5ef">gdFontMediumBold</a>-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> + 10) +
<a name="l07978"></a>07978                                 <a class="code" href="mgd_8h.html#a590369e28727c7b3c3fbb8694cf4b5ef">gdFontMediumBold</a>-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> + 2 + 2, white);
<a name="l07979"></a>07979          <a class="code" href="mgd_8h.html#a084f5a75d82c7ae9126fb0846051802e">gdImageRectangle</a>(im, x1 + 10, y2 + 10 + row * (<a class="code" href="mgd_8h.html#a590369e28727c7b3c3fbb8694cf4b5ef">gdFontMediumBold</a>-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> + 10),
<a name="l07980"></a>07980                           x1 + 10 + strlen(str) * <a class="code" href="mgd_8h.html#a590369e28727c7b3c3fbb8694cf4b5ef">gdFontMediumBold</a>-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a> + 10,
<a name="l07981"></a>07981                           y2 + 10 + row * (<a class="code" href="mgd_8h.html#a590369e28727c7b3c3fbb8694cf4b5ef">gdFontMediumBold</a>-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> + 10) +
<a name="l07982"></a>07982                           <a class="code" href="mgd_8h.html#a590369e28727c7b3c3fbb8694cf4b5ef">gdFontMediumBold</a>-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> + 2 + 2, curve_col[i]);
<a name="l07983"></a>07983 
<a name="l07984"></a>07984          <a class="code" href="mgd_8h.html#a04908d388ee58943527604c035eb1aeb">gdImageString</a>(im, <a class="code" href="mgd_8h.html#a590369e28727c7b3c3fbb8694cf4b5ef">gdFontMediumBold</a>,
<a name="l07985"></a>07985                        x1 + 10 + 5,
<a name="l07986"></a>07986                        y2 + 10 + 2 + row * (<a class="code" href="mgd_8h.html#a590369e28727c7b3c3fbb8694cf4b5ef">gdFontMediumBold</a>-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> + 10), str, curve_col[i]);
<a name="l07987"></a>07987       }
<a name="l07988"></a>07988    }
<a name="l07989"></a>07989 
<a name="l07990"></a>07990    <a class="code" href="mgd_8h.html#a084f5a75d82c7ae9126fb0846051802e">gdImageRectangle</a>(im, x1, y2, x2, y1, black);
<a name="l07991"></a>07991 
<a name="l07992"></a>07992  error:
<a name="l07993"></a>07993 
<a name="l07994"></a>07994    <span class="comment">/* generate GIF */</span>
<a name="l07995"></a>07995    <a class="code" href="mgd_8h.html#add8614ba5396e04c6afa90f3464a44c9">gdImageInterlace</a>(im, 1);
<a name="l07996"></a>07996    <a class="code" href="mgd_8h.html#aacece33b907aff03cdce530a16f8f9e8">gdImageGif</a>(im, &amp;gb);
<a name="l07997"></a>07997    <a class="code" href="mgd_8h.html#a58cde54a8d38b33074fc0fb853e10233">gdImageDestroy</a>(im);
<a name="l07998"></a>07998    length = gb.<a class="code" href="structgdGifBufferStruct.html#a6855861e6cf8e24bc53477066a1e116a">size</a>;
<a name="l07999"></a>07999 
<a name="l08000"></a>08000    <span class="keywordflow">if</span> (<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> == NULL) {
<a name="l08001"></a>08001       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l08002"></a>08002       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l08003"></a>08003 
<a name="l08004"></a>08004       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: image/gif\r\n&quot;</span>);
<a name="l08005"></a>08005       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Length: %d\r\n&quot;</span>, length);
<a name="l08006"></a>08006       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Pragma: no-cache\r\n&quot;</span>);
<a name="l08007"></a>08007       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Expires: Fri, 01-Jan-1983 00:00:00 GMT\r\n\r\n&quot;</span>);
<a name="l08008"></a>08008 
<a name="l08009"></a>08009       <span class="keywordflow">if</span> (length &gt; (<span class="keywordtype">int</span>) (<span class="keyword">sizeof</span>(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>) - strlen(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>))) {
<a name="l08010"></a>08010          printf(<span class="stringliteral">&quot;return buffer too small\n&quot;</span>);
<a name="l08011"></a>08011          <span class="keywordflow">return</span>;
<a name="l08012"></a>08012       }
<a name="l08013"></a>08013 
<a name="l08014"></a>08014       <a class="code" href="mhttpd_8c.html#a518fedf43db3f1313f9c88b2009380b5">return_length</a> = strlen(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>) + length;
<a name="l08015"></a>08015       memcpy(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a> + strlen(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>), gb.<a class="code" href="structgdGifBufferStruct.html#a3f5e06175e842094dcf27c9f535ed4b8">data</a>, length);
<a name="l08016"></a>08016    } <span class="keywordflow">else</span> {
<a name="l08017"></a>08017       <span class="keywordflow">if</span> (length &gt; *<a class="code" href="fal_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a>) {
<a name="l08018"></a>08018          printf(<span class="stringliteral">&quot;return buffer too small\n&quot;</span>);
<a name="l08019"></a>08019          <span class="keywordflow">return</span>;
<a name="l08020"></a>08020       }
<a name="l08021"></a>08021 
<a name="l08022"></a>08022       memcpy(<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, gb.<a class="code" href="structgdGifBufferStruct.html#a3f5e06175e842094dcf27c9f535ed4b8">data</a>, length);
<a name="l08023"></a>08023       *<a class="code" href="fal_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a> = length;
<a name="l08024"></a>08024    }
<a name="l08025"></a>08025 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa3da171cf30e675712502fc31255ba5a"></a><!-- doxytag: member="mhttpd.c::get_password" ref="aa3da171cf30e675712502fc31255ba5a" args="(char *password)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void get_password </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>password</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l09130">9130</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09131"></a>09131 {
<a name="l09132"></a>09132    <span class="keyword">static</span> <span class="keywordtype">char</span> last_password[32];
<a name="l09133"></a>09133 
<a name="l09134"></a>09134    <span class="keywordflow">if</span> (strncmp(password, <span class="stringliteral">&quot;set=&quot;</span>, 4) == 0)
<a name="l09135"></a>09135       strcpy(last_password, password + 4);
<a name="l09136"></a>09136    <span class="keywordflow">else</span>
<a name="l09137"></a>09137       strcpy(password, last_password);
<a name="l09138"></a>09138 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4372f772dfe8227a1033c1cf0baceb2b"></a><!-- doxytag: member="mhttpd.c::getparam" ref="a4372f772dfe8227a1033c1cf0baceb2b" args="(char *param)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* getparam </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>param</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01072">1072</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="experiment_2template_8c_source.html#l00070">_param</a>, <a class="el" href="mhttpd_8c_source.html#l00886">_text</a>, <a class="el" href="mhttpd_8c_source.html#l00885">_value</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, and <a class="el" href="mhttpd_8c_source.html#l00879">MAX_PARAM</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01073"></a>01073 {
<a name="l01074"></a>01074    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l01075"></a>01075 
<a name="l01076"></a>01076    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>, <span class="stringliteral">&quot;text&quot;</span>))
<a name="l01077"></a>01077       <span class="keywordflow">return</span> <a class="code" href="mhttpd_8c.html#a81d95c442aeb0cc03e6fb077222a9a2b">_text</a>;
<a name="l01078"></a>01078 
<a name="l01079"></a>01079    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="mhttpd_8c.html#a5732be69f55a5dbbfa3df82d31314cb1">MAX_PARAM</a> &amp;&amp; <a class="code" href="experiment_2template_8c.html#afb3a768ad8339a2cefa693559a115d80">_param</a>[i][0]; i++)
<a name="l01080"></a>01080       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>, _param[i]))
<a name="l01081"></a>01081          <span class="keywordflow">break</span>;
<a name="l01082"></a>01082 
<a name="l01083"></a>01083    <span class="keywordflow">if</span> (i &lt; <a class="code" href="mhttpd_8c.html#a5732be69f55a5dbbfa3df82d31314cb1">MAX_PARAM</a>)
<a name="l01084"></a>01084       <span class="keywordflow">return</span> <a class="code" href="mhttpd_8c.html#abcd78d8c212e69ce3b664c10cfabf5f6">_value</a>[i];
<a name="l01085"></a>01085 
<a name="l01086"></a>01086    <span class="keywordflow">return</span> NULL;
<a name="l01087"></a>01087 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a14e760bd59a14702edf8a7fdd2469dfc"></a><!-- doxytag: member="mhttpd.c::haxis" ref="a14e760bd59a14702edf8a7fdd2469dfc" args="(gdImagePtr im, gdFont *font, int col, int gcol, int x1, int y1, int width, int minor, int major, int text, int label, int grid, double xmin, double xmax)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void haxis </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgdImageStruct.html">gdImagePtr</a>&nbsp;</td>
          <td class="paramname"> <em>im</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structgdFont.html">gdFont</a> *&nbsp;</td>
          <td class="paramname"> <em>font</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>col</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>gcol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>x1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>y1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>minor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>major</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>text</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>xmin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>xmax</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l06810">6810</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mgd_8c_source.html#l00643">gdImageLine()</a>, <a class="el" href="mgd_8c_source.html#l00882">gdImageString()</a>, <a class="el" href="mgd_8h_source.html#l00062">gdFont::h</a>, <a class="el" href="mhttpd_8c_source.html#l06806">LN10</a>, <a class="el" href="mhttpd_8c_source.html#l06807">LOG2</a>, <a class="el" href="mhttpd_8c_source.html#l06808">LOG5</a>, <a class="el" href="Mql_8h_source.html#l00011">MAX</a>, and <a class="el" href="mgd_8h_source.html#l00061">gdFont::w</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06813"></a>06813 {
<a name="l06814"></a>06814    <span class="keywordtype">double</span> dx, int_dx, frac_dx, x_act, label_dx, major_dx, x_screen, maxwidth;
<a name="l06815"></a>06815    <span class="keywordtype">int</span> tick_base, major_base, label_base, n_sig1, n_sig2, xs;
<a name="l06816"></a>06816    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[80];
<a name="l06817"></a>06817    <span class="keywordtype">double</span> base[] = { 1, 2, 5, 10, 20, 50, 100, 200, 500, 1000 };
<a name="l06818"></a>06818 
<a name="l06819"></a>06819    <span class="keywordflow">if</span> (xmax &lt;= xmin || <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> &lt;= 0)
<a name="l06820"></a>06820       <span class="keywordflow">return</span>;
<a name="l06821"></a>06821 
<a name="l06822"></a>06822    <span class="comment">/* use 5 as min tick distance */</span>
<a name="l06823"></a>06823    dx = (xmax - xmin) / (<span class="keywordtype">double</span>) (<a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> / 5);
<a name="l06824"></a>06824 
<a name="l06825"></a>06825    frac_dx = modf(log(dx) / <a class="code" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>, &amp;int_dx);
<a name="l06826"></a>06826    <span class="keywordflow">if</span> (frac_dx &lt; 0) {
<a name="l06827"></a>06827       frac_dx += 1;
<a name="l06828"></a>06828       int_dx -= 1;
<a name="l06829"></a>06829    }
<a name="l06830"></a>06830 
<a name="l06831"></a>06831    tick_base = frac_dx &lt; <a class="code" href="mhttpd_8c.html#a07267dcd6834194cfed517197ab1e2ad">LOG2</a> ? 1 : frac_dx &lt; <a class="code" href="mhttpd_8c.html#a5a6825d23f0ed9ea6166b890404c0526">LOG5</a> ? 2 : 3;
<a name="l06832"></a>06832    major_base = label_base = tick_base + 1;
<a name="l06833"></a>06833 
<a name="l06834"></a>06834    <span class="comment">/* rounding up of dx, label_dx */</span>
<a name="l06835"></a>06835    dx = pow(10, int_dx) * base[tick_base];
<a name="l06836"></a>06836    major_dx = pow(10, int_dx) * base[major_base];
<a name="l06837"></a>06837    label_dx = major_dx;
<a name="l06838"></a>06838 
<a name="l06839"></a>06839    <span class="comment">/* number of significant digits */</span>
<a name="l06840"></a>06840    <span class="keywordflow">if</span> (xmin == 0)
<a name="l06841"></a>06841       n_sig1 = 0;
<a name="l06842"></a>06842    <span class="keywordflow">else</span>
<a name="l06843"></a>06843       n_sig1 = (int) floor(log(fabs(xmin)) / <a class="code" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>) -
<a name="l06844"></a>06844           (<span class="keywordtype">int</span>) floor(log(fabs(label_dx)) / <a class="code" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>) + 1;
<a name="l06845"></a>06845 
<a name="l06846"></a>06846    <span class="keywordflow">if</span> (xmax == 0)
<a name="l06847"></a>06847       n_sig2 = 0;
<a name="l06848"></a>06848    <span class="keywordflow">else</span>
<a name="l06849"></a>06849       n_sig2 = (int) floor(log(fabs(xmax)) / <a class="code" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>) -
<a name="l06850"></a>06850           (<span class="keywordtype">int</span>) floor(log(fabs(label_dx)) / <a class="code" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>) + 1;
<a name="l06851"></a>06851 
<a name="l06852"></a>06852    n_sig1 = <a class="code" href="Mql_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(n_sig1, n_sig2);
<a name="l06853"></a>06853    n_sig1 = <a class="code" href="Mql_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(n_sig1, 4);
<a name="l06854"></a>06854 
<a name="l06855"></a>06855    <span class="comment">/* determination of maximal width of labels */</span>
<a name="l06856"></a>06856    sprintf(str, <span class="stringliteral">&quot;%1.*lG&quot;</span>, n_sig1, floor(xmin / dx) * dx);
<a name="l06857"></a>06857    maxwidth = font-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> / 2 * strlen(str);
<a name="l06858"></a>06858    sprintf(str, <span class="stringliteral">&quot;%1.*lG&quot;</span>, n_sig1, floor(xmax / dx) * dx);
<a name="l06859"></a>06859    maxwidth = <a class="code" href="Mql_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(maxwidth, font-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> / 2 * strlen(str));
<a name="l06860"></a>06860    sprintf(str, <span class="stringliteral">&quot;%1.*lG&quot;</span>, n_sig1, floor(xmax / dx) * dx + label_dx);
<a name="l06861"></a>06861    maxwidth = <a class="code" href="Mql_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(maxwidth, font-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> / 2 * strlen(str));
<a name="l06862"></a>06862 
<a name="l06863"></a>06863    <span class="comment">/* increasing label_dx, if labels would overlap */</span>
<a name="l06864"></a>06864    <span class="keywordflow">while</span> (maxwidth &gt; 0.7 * label_dx / (xmax - xmin) * <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a>) {
<a name="l06865"></a>06865       label_base++;
<a name="l06866"></a>06866       label_dx = pow(10, int_dx) * base[label_base];
<a name="l06867"></a>06867       <span class="keywordflow">if</span> (label_base % 3 == 2 &amp;&amp; major_base % 3 == 1) {
<a name="l06868"></a>06868          major_base++;
<a name="l06869"></a>06869          major_dx = pow(10, int_dx) * base[major_base];
<a name="l06870"></a>06870       }
<a name="l06871"></a>06871    }
<a name="l06872"></a>06872 
<a name="l06873"></a>06873    x_act = floor(xmin / dx) * dx;
<a name="l06874"></a>06874 
<a name="l06875"></a>06875    <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, x1, y1, x1 + width, y1, col);
<a name="l06876"></a>06876 
<a name="l06877"></a>06877    <span class="keywordflow">do</span> {
<a name="l06878"></a>06878       x_screen = (x_act - xmin) / (xmax - xmin) * width + x1;
<a name="l06879"></a>06879       xs = (int) (x_screen + 0.5);
<a name="l06880"></a>06880 
<a name="l06881"></a>06881       <span class="keywordflow">if</span> (x_screen &gt; x1 + width + 0.001)
<a name="l06882"></a>06882          <span class="keywordflow">break</span>;
<a name="l06883"></a>06883 
<a name="l06884"></a>06884       <span class="keywordflow">if</span> (x_screen &gt;= x1) {
<a name="l06885"></a>06885          <span class="keywordflow">if</span> (fabs(floor(x_act / major_dx + 0.5) - x_act / major_dx) &lt;
<a name="l06886"></a>06886              dx / major_dx / 10.0) {
<a name="l06887"></a>06887 
<a name="l06888"></a>06888             <span class="keywordflow">if</span> (fabs(floor(x_act / label_dx + 0.5) - x_act / label_dx) &lt;
<a name="l06889"></a>06889                 dx / label_dx / 10.0) {
<a name="l06890"></a>06890           <span class="comment">/**** label tick mark ****/</span>
<a name="l06891"></a>06891                <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, xs, y1, xs, y1 + text, col);
<a name="l06892"></a>06892 
<a name="l06893"></a>06893           <span class="comment">/**** grid line ***/</span>
<a name="l06894"></a>06894                <span class="keywordflow">if</span> (grid != 0 &amp;&amp; xs &gt; x1 &amp;&amp; xs &lt; x1 + width)
<a name="l06895"></a>06895                   <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, xs, y1, xs, y1 + grid, col);
<a name="l06896"></a>06896 
<a name="l06897"></a>06897           <span class="comment">/**** label ****/</span>
<a name="l06898"></a>06898                <span class="keywordflow">if</span> (label != 0) {
<a name="l06899"></a>06899                   sprintf(str, <span class="stringliteral">&quot;%1.*lG&quot;</span>, n_sig1, x_act);
<a name="l06900"></a>06900                   <a class="code" href="mgd_8h.html#a04908d388ee58943527604c035eb1aeb">gdImageString</a>(im, font, (<span class="keywordtype">int</span>) xs - font-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a> * strlen(str) / 2,
<a name="l06901"></a>06901                                 y1 + label, str, col);
<a name="l06902"></a>06902                }
<a name="l06903"></a>06903             } <span class="keywordflow">else</span> {
<a name="l06904"></a>06904           <span class="comment">/**** major tick mark ****/</span>
<a name="l06905"></a>06905                <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, xs, y1, xs, y1 + major, col);
<a name="l06906"></a>06906 
<a name="l06907"></a>06907           <span class="comment">/**** grid line ****/</span>
<a name="l06908"></a>06908                <span class="keywordflow">if</span> (grid != 0 &amp;&amp; xs &gt; x1 &amp;&amp; xs &lt; x1 + width)
<a name="l06909"></a>06909                   <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, xs, y1 - 1, xs, y1 + grid, gcol);
<a name="l06910"></a>06910             }
<a name="l06911"></a>06911 
<a name="l06912"></a>06912          } <span class="keywordflow">else</span>
<a name="l06913"></a>06913         <span class="comment">/**** minor tick mark ****/</span>
<a name="l06914"></a>06914             <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, xs, y1, xs, y1 + minor, col);
<a name="l06915"></a>06915 
<a name="l06916"></a>06916       }
<a name="l06917"></a>06917 
<a name="l06918"></a>06918       x_act += dx;
<a name="l06919"></a>06919 
<a name="l06920"></a>06920       <span class="comment">/* supress 1.23E-17 ... */</span>
<a name="l06921"></a>06921       <span class="keywordflow">if</span> (fabs(x_act) &lt; dx / 100)
<a name="l06922"></a>06922          x_act = 0;
<a name="l06923"></a>06923 
<a name="l06924"></a>06924    } <span class="keywordflow">while</span> (1);
<a name="l06925"></a>06925 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5c7f0ac1136d675f0150d443df5912ac"></a><!-- doxytag: member="mhttpd.c::initparam" ref="a5c7f0ac1136d675f0150d443df5912ac" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initparam </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01035">1035</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="experiment_2template_8c_source.html#l00070">_param</a>, <a class="el" href="mhttpd_8c_source.html#l00886">_text</a>, and <a class="el" href="mhttpd_8c_source.html#l00885">_value</a>.</p>

<p>Referenced by <a class="el" href="webpaw_8c_source.html#l01259">decode()</a>, <a class="el" href="mhttpd_8c_source.html#l09800">decode_get()</a>, and <a class="el" href="mhttpd_8c_source.html#l09841">decode_post()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01036"></a>01036 {
<a name="l01037"></a>01037    memset(<a class="code" href="experiment_2template_8c.html#afb3a768ad8339a2cefa693559a115d80">_param</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="experiment_2template_8c.html#afb3a768ad8339a2cefa693559a115d80">_param</a>));
<a name="l01038"></a>01038    memset(<a class="code" href="mhttpd_8c.html#abcd78d8c212e69ce3b664c10cfabf5f6">_value</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="mhttpd_8c.html#abcd78d8c212e69ce3b664c10cfabf5f6">_value</a>));
<a name="l01039"></a>01039    <a class="code" href="mhttpd_8c.html#a81d95c442aeb0cc03e6fb077222a9a2b">_text</a>[0] = 0;
<a name="l01040"></a>01040 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a80b8d04dd00609fbbfd7a0bf3ce3b344"></a><!-- doxytag: member="mhttpd.c::interprete" ref="a80b8d04dd00609fbbfd7a0bf3ce3b344" args="(char *cookie_pwd, char *cookie_wpwd, char *path, int refresh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void interprete </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>cookie_pwd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>cookie_wpwd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>refresh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l09142">9142</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l16313">al_reset_alarm()</a>, <a class="el" href="mhttpd_8c_source.html#l05587">check_web_password()</a>, <a class="el" href="midas_8c_source.html#l02688">cm_connect_client()</a>, <a class="el" href="midas_8c_source.html#l02327">cm_connect_experiment()</a>, <a class="el" href="midas_8h_source.html#l00965">CM_DEFERRED_TRANSITION</a>, <a class="el" href="midas_8c_source.html#l02754">cm_disconnect_client()</a>, <a class="el" href="midas_8c_source.html#l02768">cm_disconnect_experiment()</a>, <a class="el" href="midas_8c_source.html#l05069">cm_exist()</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="midas_8c_source.html#l02546">cm_list_experiments()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8c_source.html#l01477">cm_msg_register()</a>, <a class="el" href="midas_8c_source.html#l01507">cm_msg_retrieve()</a>, <a class="el" href="midas_8c_source.html#l01032">cm_set_msg_print()</a>, <a class="el" href="midas_8h_source.html#l00956">CM_SUCCESS</a>, <a class="el" href="midas_8c_source.html#l03579">cm_transition()</a>, <a class="el" href="midas_8h_source.html#l00963">CM_WRONG_PASSWORD</a>, <a class="el" href="mhttpd_8c_source.html#l00875">connected</a>, <a class="el" href="lrs1821_8c_source.html#l00038">data</a>, <a class="el" href="odb_8c_source.html#l03390">db_enum_key()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="odb_8c_source.html#l04727">db_set_data_index()</a>, <a class="el" href="odb_8c_source.html#l06435">db_sscanf()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="mhttpd_8c_source.html#l00891">elog_mode</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00248">event_id</a>, <a class="el" href="mhttpd_8c_source.html#l01570">exec_script()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mhttpd_8c_source.html#l09130">get_password()</a>, <a class="el" href="mana_8cpp_source.html#l00800">getparam()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="midas_8h_source.html#l01320">KEY::item_size</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="midas_8h_source.html#l00687">MAX_EXPERIMENT</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l00931">MT_ALL</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="midas_8h_source.html#l01316">KEY::num_values</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="fal_8c_source.html#l04089">print_message()</a>, <a class="el" href="fal_8c_source.html#l04107">receive_message()</a>, <a class="el" href="mhttpd_8c_source.html#l01356">redirect()</a>, <a class="el" href="mhttpd_8c_source.html#l01372">redirect2()</a>, <a class="el" href="midas_8c_source.html#l09519">rpc_client_call()</a>, <a class="el" href="mrpc_8h_source.html#l00199">RPC_MANUAL_TRIG</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00322">run_state</a>, <a class="el" href="mhttpd_8c_source.html#l06375">show_alarm_page()</a>, <a class="el" href="mhttpd_8c_source.html#l05301">show_cnaf_page()</a>, <a class="el" href="mhttpd_8c_source.html#l06777">show_config_page()</a>, <a class="el" href="mhttpd_8c_source.html#l06182">show_create_page()</a>, <a class="el" href="mhttpd_8c_source.html#l05192">show_custom_page()</a>, <a class="el" href="mhttpd_8c_source.html#l06297">show_delete_page()</a>, <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>, <a class="el" href="mhttpd_8c_source.html#l01557">show_error()</a>, <a class="el" href="mhttpd_8c_source.html#l05528">show_experiment_page()</a>, <a class="el" href="mhttpd_8c_source.html#l06130">show_find_page()</a>, <a class="el" href="mhttpd_8c_source.html#l01472">show_help_page()</a>, <a class="el" href="mhttpd_8c_source.html#l08606">show_hist_page()</a>, <a class="el" href="mhttpd_8c_source.html#l02323">show_messages_page()</a>, <a class="el" href="mhttpd_8c_source.html#l05737">show_odb_page()</a>, <a class="el" href="mhttpd_8c_source.html#l05557">show_password_page()</a>, <a class="el" href="mhttpd_8c_source.html#l06598">show_programs_page()</a>, <a class="el" href="mhttpd_8c_source.html#l04659">show_sc_page()</a>, <a class="el" href="mhttpd_8c_source.html#l05983">show_set_page()</a>, <a class="el" href="mhttpd_8c_source.html#l05639">show_start_page()</a>, <a class="el" href="mhttpd_8c_source.html#l01641">show_status_page()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="system_8c_source.html#l05917">ss_crypt()</a>, <a class="el" href="midas_8h_source.html#l00713">STATE_PAUSED</a>, <a class="el" href="midas_8h_source.html#l00714">STATE_RUNNING</a>, <a class="el" href="midas_8h_source.html#l00712">STATE_STOPPED</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="mscb_8c_source.html#l00414">strlcpy()</a>, <a class="el" href="midas_8h_source.html#l00755">SYNC</a>, <a class="el" href="mhttpd_8c_source.html#l00882">TEXT_SIZE</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="midas_8h_source.html#l00749">TID_KEY</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="midas_8h_source.html#l00738">TID_WORD</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, <a class="el" href="midas_8h_source.html#l00793">TR_PAUSE</a>, <a class="el" href="midas_8h_source.html#l00794">TR_RESUME</a>, <a class="el" href="midas_8h_source.html#l00791">TR_START</a>, <a class="el" href="midas_8h_source.html#l00792">TR_STOP</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, <a class="el" href="midas_8h_source.html#l01315">KEY::type</a>, <a class="el" href="mhttpd_8c_source.html#l01119">urlDecode()</a>, <a class="el" href="mhttpd_8c_source.html#l01153">urlEncode()</a>, and <a class="el" href="ADCS_8h_source.html#l00004">value</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09145"></a>09145          : <a class="code" href="mscbmain_8c.html#a2331a26017e5f759388bb66d56bf065b">interprete</a>
<a name="l09146"></a>09146 
<a name="l09147"></a>09147   Purpose: Interprete parametersand generate HTML <a class="code" href="scs__210_8c.html#a859e9f68c1c035565d6729c59fd894ae">output</a> from odb.
<a name="l09148"></a>09148 
<a name="l09149"></a>09149   Input:
<a name="l09150"></a>09150     <span class="keywordtype">char</span> *cookie_pwd        Cookie containing encrypted password
<a name="l09151"></a>09151     <span class="keywordtype">char</span> *path              ODB path <span class="stringliteral">&quot;/dir/subdir/key&quot;</span>
<a name="l09152"></a>09152 
<a name="l09153"></a>09153   &lt;implicit&gt;
<a name="l09154"></a>09154     <a class="code" href="experiment_2template_8c.html#afb3a768ad8339a2cefa693559a115d80">_param</a>/<a class="code" href="mhttpd_8c.html#abcd78d8c212e69ce3b664c10cfabf5f6">_value</a> array accessible via <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>()
<a name="l09155"></a>09155 
<a name="l09156"></a>09156 \********************************************************************/
<a name="l09157"></a>09157 {
<a name="l09158"></a>09158    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="crate3_2crate_8cpp.html#a796101401a6f991d4bc11e0059c664a7">run_state</a>, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>;
<a name="l09159"></a>09159    <a class="code" href="unionWORD.html">WORD</a> <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>;
<a name="l09160"></a>09160    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> hkey, hsubkey, <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hconn;
<a name="l09161"></a>09161    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l09162"></a>09162    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>;
<a name="l09163"></a>09163    <span class="keywordtype">char</span> enc_path[256], dec_path[256], eq_name[<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>], fe_name[<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>];
<a name="l09164"></a>09164    <span class="keywordtype">char</span> <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>[<a class="code" href="mhttpd_8c.html#afb6f36d91ffbf947cfa3f1114ca79764">TEXT_SIZE</a>];
<a name="l09165"></a>09165    <span class="keywordtype">char</span> *experiment, *password, *wpassword, *command, *<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, *group;
<a name="l09166"></a>09166    <span class="keywordtype">char</span> exp_list[<a class="code" href="group__midasincludecode.html#ga96dcd778f7870d9d3a834f63f7e8506e">MAX_EXPERIMENT</a>][<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>];
<a name="l09167"></a>09167    time_t now;
<a name="l09168"></a>09168    <span class="keyword">struct </span>tm *gmt;
<a name="l09169"></a>09169 
<a name="l09170"></a>09170    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(path, <span class="stringliteral">&quot;favicon.ico&quot;</span>))
<a name="l09171"></a>09171       <span class="keywordflow">return</span>;
<a name="l09172"></a>09172 
<a name="l09173"></a>09173    <span class="comment">/* encode path for further usage */</span>
<a name="l09174"></a>09174    <a class="code" href="mscb_8c.html#a4637af6f79bac4043e1064f0837d0ddc">strlcpy</a>(dec_path, path, <span class="keyword">sizeof</span>(dec_path));
<a name="l09175"></a>09175    <a class="code" href="mhttpd_8c.html#a314e523b7d95b4a434216200167e5e0a">urlDecode</a>(dec_path);
<a name="l09176"></a>09176    <span class="comment">// ##urlDecode(dec_path); /* necessary for %2520 -&gt; %20 -&gt; &apos; &apos; */</span>
<a name="l09177"></a>09177    strcpy(enc_path, dec_path);
<a name="l09178"></a>09178    <a class="code" href="mhttpd_8c.html#a477e33c685ba6ebcb9d429fb057c2760">urlEncode</a>(enc_path);
<a name="l09179"></a>09179 
<a name="l09180"></a>09180    experiment = <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;exp&quot;</span>);
<a name="l09181"></a>09181    password = <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;pwd&quot;</span>);
<a name="l09182"></a>09182    wpassword = <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;wpwd&quot;</span>);
<a name="l09183"></a>09183    command = <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>);
<a name="l09184"></a>09184    value = <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;value&quot;</span>);
<a name="l09185"></a>09185    group = <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;group&quot;</span>);
<a name="l09186"></a>09186    index = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;index&quot;</span>));
<a name="l09187"></a>09187 
<a name="l09188"></a>09188    <span class="comment">/*---- experiment connect ----------------------------------------*/</span>
<a name="l09189"></a>09189 
<a name="l09190"></a>09190    <span class="comment">/* disconnect from previous experiment if current is different */</span>
<a name="l09191"></a>09191    <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#abc82b64a25110404c4a845a5e969b348">connected</a> &amp;&amp; !<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, experiment)) {
<a name="l09192"></a>09192       <span class="comment">/* check if only one experiment defined */</span>
<a name="l09193"></a>09193       <a class="code" href="group__msectionh.html#gace6d197774d342eb67267b692c583abc">cm_list_experiments</a>(<span class="stringliteral">&quot;&quot;</span>, exp_list);
<a name="l09194"></a>09194       <span class="keywordflow">if</span> (exp_list[1][0]) {
<a name="l09195"></a>09195          <a class="code" href="group__msectionh.html#ga9792ed24b1150464250ac794067c9196">cm_disconnect_experiment</a>();
<a name="l09196"></a>09196          <a class="code" href="mhttpd_8c.html#abc82b64a25110404c4a845a5e969b348">connected</a> = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l09197"></a>09197       }
<a name="l09198"></a>09198    }
<a name="l09199"></a>09199 
<a name="l09200"></a>09200    <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#abc82b64a25110404c4a845a5e969b348">connected</a>) {
<a name="l09201"></a>09201       <span class="comment">/* connect to experiment */</span>
<a name="l09202"></a>09202       <span class="keywordflow">if</span> (experiment[0] == 0) {
<a name="l09203"></a>09203          <a class="code" href="group__msectionh.html#gace6d197774d342eb67267b692c583abc">cm_list_experiments</a>(<span class="stringliteral">&quot;&quot;</span>, exp_list);
<a name="l09204"></a>09204          <span class="keywordflow">if</span> (exp_list[1][0]) {
<a name="l09205"></a>09205             <span class="comment">/* present list of experiments to choose from */</span>
<a name="l09206"></a>09206             <a class="code" href="mhttpd_8c.html#a3b0a144daa9f2395fbba48e847a4e6d6">show_experiment_page</a>(exp_list);
<a name="l09207"></a>09207             <span class="keywordflow">return</span>;
<a name="l09208"></a>09208          }
<a name="l09209"></a>09209       }
<a name="l09210"></a>09210 
<a name="l09211"></a>09211       <span class="keywordflow">if</span> (password)
<a name="l09212"></a>09212          sprintf(str, <span class="stringliteral">&quot;set=%s&quot;</span>, password);
<a name="l09213"></a>09213       <span class="keywordflow">else</span>
<a name="l09214"></a>09214          sprintf(str, <span class="stringliteral">&quot;set=&quot;</span>);
<a name="l09215"></a>09215 
<a name="l09216"></a>09216       <a class="code" href="mhttpd_8c.html#aa3da171cf30e675712502fc31255ba5a">get_password</a>(str);
<a name="l09217"></a>09217       status = <a class="code" href="group__msectionh.html#gae12b15703f10f41044e599520e665f5a">cm_connect_experiment</a>(<span class="stringliteral">&quot;&quot;</span>, experiment, <span class="stringliteral">&quot;mhttpd&quot;</span>, <a class="code" href="mhttpd_8c.html#aa3da171cf30e675712502fc31255ba5a">get_password</a>);
<a name="l09218"></a>09218       <span class="keywordflow">if</span> (status == <a class="code" href="group__err21.html#ga9a26da1c28eadf3f46a335b41520ecd8">CM_WRONG_PASSWORD</a>) {
<a name="l09219"></a>09219          <a class="code" href="mhttpd_8c.html#ada74df02203a2fd3f1ca5b1f8f5d6152">show_password_page</a>(password, experiment);
<a name="l09220"></a>09220          <span class="keywordflow">return</span>;
<a name="l09221"></a>09221       }
<a name="l09222"></a>09222 
<a name="l09223"></a>09223       <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>) {
<a name="l09224"></a>09224          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;H1&gt;Experiment \&quot;%s\&quot; not defined on this host&lt;/H1&gt;&quot;</span>, experiment);
<a name="l09225"></a>09225          <span class="keywordflow">return</span>;
<a name="l09226"></a>09226       }
<a name="l09227"></a>09227 
<a name="l09228"></a>09228       <span class="comment">/* remember experiment */</span>
<a name="l09229"></a>09229       strcpy(<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, experiment);
<a name="l09230"></a>09230       <a class="code" href="mhttpd_8c.html#abc82b64a25110404c4a845a5e969b348">connected</a> = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l09231"></a>09231 
<a name="l09232"></a>09232       <span class="comment">/* place a request for system messages */</span>
<a name="l09233"></a>09233       <a class="code" href="group__msectionh.html#ga73f40964dfd745537f41ce13fbcc2fa4">cm_msg_register</a>(<a class="code" href="fal_8c.html#a168945a222012d1d908c78a41e7022c2">receive_message</a>);
<a name="l09234"></a>09234 
<a name="l09235"></a>09235       <span class="comment">/* redirect message display, turn on message logging */</span>
<a name="l09236"></a>09236       <a class="code" href="group__msectionh.html#gaf4589061aab20d351d901b6d2ccc0cc0">cm_set_msg_print</a>(<a class="code" href="group__mdefineh.html#ga3378bf6f53a24392145df33c8acc9c0c">MT_ALL</a>, <a class="code" href="group__mdefineh.html#ga3378bf6f53a24392145df33c8acc9c0c">MT_ALL</a>, <a class="code" href="fal_8c.html#a48fa208044b7e1373af57d1b24393693">print_message</a>);
<a name="l09237"></a>09237 
<a name="l09238"></a>09238       <span class="comment">/* retrieve last message */</span>
<a name="l09239"></a>09239       size = 1000;
<a name="l09240"></a>09240       <a class="code" href="group__msectionh.html#ga53139935a652b7f225ff2e83d9abd204">cm_msg_retrieve</a>(1, data, &amp;size);
<a name="l09241"></a>09241 
<a name="l09242"></a>09242       <a class="code" href="fal_8c.html#a168945a222012d1d908c78a41e7022c2">receive_message</a>(0, 0, NULL, data+25);
<a name="l09243"></a>09243    }
<a name="l09244"></a>09244 
<a name="l09245"></a>09245    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l09246"></a>09246 
<a name="l09247"></a>09247    <span class="comment">/* check for password */</span>
<a name="l09248"></a>09248    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Security/Password&quot;</span>, &amp;hkey);
<a name="l09249"></a>09249    <span class="keywordflow">if</span> (!password[0] &amp;&amp; hkey) {
<a name="l09250"></a>09250       size = <span class="keyword">sizeof</span>(str);
<a name="l09251"></a>09251       <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l09252"></a>09252 
<a name="l09253"></a>09253       <span class="comment">/* check for excemption */</span>
<a name="l09254"></a>09254       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Security/Allowed programs/mhttpd&quot;</span>, &amp;hkey);
<a name="l09255"></a>09255       <span class="keywordflow">if</span> (hkey == 0 &amp;&amp; strcmp(cookie_pwd, str) != 0) {
<a name="l09256"></a>09256          <a class="code" href="mhttpd_8c.html#ada74df02203a2fd3f1ca5b1f8f5d6152">show_password_page</a>(<span class="stringliteral">&quot;&quot;</span>, experiment);
<a name="l09257"></a>09257          <span class="keywordflow">return</span>;
<a name="l09258"></a>09258       }
<a name="l09259"></a>09259    }
<a name="l09260"></a>09260 
<a name="l09261"></a>09261    <span class="comment">/* get run state */</span>
<a name="l09262"></a>09262    run_state = <a class="code" href="group__mdefineh.html#ga6a8dac64367bd381245f2eb09a7fe919">STATE_STOPPED</a>;
<a name="l09263"></a>09263    size = <span class="keyword">sizeof</span>(run_state);
<a name="l09264"></a>09264    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Runinfo/State&quot;</span>, &amp;run_state, &amp;size, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l09265"></a>09265 
<a name="l09266"></a>09266    <span class="comment">/*---- redirect with cookie if password given --------------------*/</span>
<a name="l09267"></a>09267 
<a name="l09268"></a>09268    <span class="keywordflow">if</span> (password[0]) {
<a name="l09269"></a>09269       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 302 Found\r\n&quot;</span>);
<a name="l09270"></a>09270       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l09271"></a>09271 
<a name="l09272"></a>09272       <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l09273"></a>09273       now += 3600 * 24;
<a name="l09274"></a>09274       gmt = gmtime(&amp;now);
<a name="l09275"></a>09275       strftime(str, <span class="keyword">sizeof</span>(str), <span class="stringliteral">&quot;%A, %d-%b-%Y %H:00:00 GMT&quot;</span>, gmt);
<a name="l09276"></a>09276 
<a name="l09277"></a>09277       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Set-Cookie: midas_pwd=%s; path=/; expires=%s\r\n&quot;</span>,
<a name="l09278"></a>09278                <a class="code" href="group__msectionh.html#gacf622579553952337acaf1d4a2588cdf">ss_crypt</a>(password, <span class="stringliteral">&quot;mi&quot;</span>), str);
<a name="l09279"></a>09279 
<a name="l09280"></a>09280       <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l09281"></a>09281          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Location: /?exp=%s\n\n&lt;html&gt;redir&lt;/html&gt;\r\n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l09282"></a>09282       <span class="keywordflow">else</span>
<a name="l09283"></a>09283          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Location: /\n\n&lt;html&gt;redir&lt;/html&gt;\r\n&quot;</span>);
<a name="l09284"></a>09284       <span class="keywordflow">return</span>;
<a name="l09285"></a>09285    }
<a name="l09286"></a>09286 
<a name="l09287"></a>09287    <span class="keywordflow">if</span> (wpassword[0]) {
<a name="l09288"></a>09288       <span class="comment">/* check if password correct */</span>
<a name="l09289"></a>09289       <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(<a class="code" href="group__msectionh.html#gacf622579553952337acaf1d4a2588cdf">ss_crypt</a>(wpassword, <span class="stringliteral">&quot;mi&quot;</span>), <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;redir&quot;</span>), experiment))
<a name="l09290"></a>09290          <span class="keywordflow">return</span>;
<a name="l09291"></a>09291 
<a name="l09292"></a>09292       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 302 Found\r\n&quot;</span>);
<a name="l09293"></a>09293       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l09294"></a>09294 
<a name="l09295"></a>09295       <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l09296"></a>09296       now += 3600 * 24;
<a name="l09297"></a>09297       gmt = gmtime(&amp;now);
<a name="l09298"></a>09298       strftime(str, <span class="keyword">sizeof</span>(str), <span class="stringliteral">&quot;%A, %d-%b-%Y %H:%M:%S GMT&quot;</span>, gmt);
<a name="l09299"></a>09299 
<a name="l09300"></a>09300       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Set-Cookie: midas_wpwd=%s; path=/; expires=%s\r\n&quot;</span>,
<a name="l09301"></a>09301                <a class="code" href="group__msectionh.html#gacf622579553952337acaf1d4a2588cdf">ss_crypt</a>(wpassword, <span class="stringliteral">&quot;mi&quot;</span>), str);
<a name="l09302"></a>09302 
<a name="l09303"></a>09303       sprintf(str, <span class="stringliteral">&quot;/%s&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;redir&quot;</span>));
<a name="l09304"></a>09304       <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0]) {
<a name="l09305"></a>09305          <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;?&apos;</span>))
<a name="l09306"></a>09306             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Location: %s&amp;exp=%s\n\n&lt;html&gt;redir&lt;/html&gt;\r\n&quot;</span>, str, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l09307"></a>09307          <span class="keywordflow">else</span>
<a name="l09308"></a>09308             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Location: %s?exp=%s\n\n&lt;html&gt;redir&lt;/html&gt;\r\n&quot;</span>, str, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l09309"></a>09309       } <span class="keywordflow">else</span>
<a name="l09310"></a>09310          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Location: %s\n\n&lt;html&gt;redir&lt;/html&gt;\r\n&quot;</span>, str);
<a name="l09311"></a>09311       <span class="keywordflow">return</span>;
<a name="l09312"></a>09312    }
<a name="l09313"></a>09313 
<a name="l09314"></a>09314   <span class="comment">/*---- redirect if ODB command -----------------------------------*/</span>
<a name="l09315"></a>09315 
<a name="l09316"></a>09316    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;ODB&quot;</span>)) {
<a name="l09317"></a>09317       <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;root&quot;</span>);
<a name="l09318"></a>09318       <span class="keywordflow">return</span>;
<a name="l09319"></a>09319    }
<a name="l09320"></a>09320 
<a name="l09321"></a>09321   <span class="comment">/*---- redirect if SC command ------------------------------------*/</span>
<a name="l09322"></a>09322 
<a name="l09323"></a>09323    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;SC&quot;</span>)) {
<a name="l09324"></a>09324       <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;SC/&quot;</span>);
<a name="l09325"></a>09325       <span class="keywordflow">return</span>;
<a name="l09326"></a>09326    }
<a name="l09327"></a>09327 
<a name="l09328"></a>09328   <span class="comment">/*---- redirect if status command --------------------------------*/</span>
<a name="l09329"></a>09329 
<a name="l09330"></a>09330    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;status&quot;</span>)) {
<a name="l09331"></a>09331       <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;&quot;</span>);
<a name="l09332"></a>09332       <span class="keywordflow">return</span>;
<a name="l09333"></a>09333    }
<a name="l09334"></a>09334 
<a name="l09335"></a>09335   <span class="comment">/*---- script command --------------------------------------------*/</span>
<a name="l09336"></a>09336 
<a name="l09337"></a>09337    <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;script&quot;</span>) &amp;&amp; *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;script&quot;</span>)) {
<a name="l09338"></a>09338       sprintf(str, <span class="stringliteral">&quot;%s?script=%s&quot;</span>, path, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;script&quot;</span>));
<a name="l09339"></a>09339       <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, str, experiment))
<a name="l09340"></a>09340          <span class="keywordflow">return</span>;
<a name="l09341"></a>09341 
<a name="l09342"></a>09342       sprintf(str, <span class="stringliteral">&quot;/Script/%s&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;script&quot;</span>));
<a name="l09343"></a>09343 
<a name="l09344"></a>09344       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkey);
<a name="l09345"></a>09345 
<a name="l09346"></a>09346       <span class="keywordflow">if</span> (hkey) {
<a name="l09347"></a>09347          <span class="comment">/* for NT: close reply socket before starting subprocess */</span>
<a name="l09348"></a>09348          <a class="code" href="mhttpd_8c.html#a53eda54404f0531285b06ef8c48bbf9b">redirect2</a>(<span class="stringliteral">&quot;&quot;</span>);
<a name="l09349"></a>09349          <a class="code" href="mhttpd_8c.html#a877b1f25fb961fe82f80882e5500d5f5">exec_script</a>(hkey);
<a name="l09350"></a>09350       } <span class="keywordflow">else</span>
<a name="l09351"></a>09351          <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;&quot;</span>);
<a name="l09352"></a>09352 
<a name="l09353"></a>09353       <span class="keywordflow">return</span>;
<a name="l09354"></a>09354    }
<a name="l09355"></a>09355 
<a name="l09356"></a>09356   <span class="comment">/*---- alarms command --------------------------------------------*/</span>
<a name="l09357"></a>09357 
<a name="l09358"></a>09358    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;alarms&quot;</span>)) {
<a name="l09359"></a>09359       <a class="code" href="mhttpd_8c.html#a678e9238f0cdc3868dfdc4270f353dc1">show_alarm_page</a>();
<a name="l09360"></a>09360       <span class="keywordflow">return</span>;
<a name="l09361"></a>09361    }
<a name="l09362"></a>09362 
<a name="l09363"></a>09363   <span class="comment">/*---- history command -------------------------------------------*/</span>
<a name="l09364"></a>09364 
<a name="l09365"></a>09365    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;history&quot;</span>)) {
<a name="l09366"></a>09366       <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;HS/&quot;</span>);
<a name="l09367"></a>09367       <span class="keywordflow">return</span>;
<a name="l09368"></a>09368    }
<a name="l09369"></a>09369 
<a name="l09370"></a>09370    <span class="keywordflow">if</span> (strncmp(path, <span class="stringliteral">&quot;HS/&quot;</span>, 3) == 0) {
<a name="l09371"></a>09371       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;config&quot;</span>)) {
<a name="l09372"></a>09372          sprintf(str, <span class="stringliteral">&quot;%s?cmd=%s&quot;</span>, path, command);
<a name="l09373"></a>09373          <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, str, experiment))
<a name="l09374"></a>09374             <span class="keywordflow">return</span>;
<a name="l09375"></a>09375       }
<a name="l09376"></a>09376 
<a name="l09377"></a>09377       <a class="code" href="mhttpd_8c.html#af3853f14404bead7ea2dbfa3683b6f1b">show_hist_page</a>(dec_path + 3, NULL, NULL, refresh);
<a name="l09378"></a>09378       <span class="keywordflow">return</span>;
<a name="l09379"></a>09379    }
<a name="l09380"></a>09380 
<a name="l09381"></a>09381   <span class="comment">/*---- help command ----------------------------------------------*/</span>
<a name="l09382"></a>09382 
<a name="l09383"></a>09383    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;help&quot;</span>)) {
<a name="l09384"></a>09384       <a class="code" href="mhttpd_8c.html#a754bb75919b1e2a9e934218bce65c472">show_help_page</a>();
<a name="l09385"></a>09385       <span class="keywordflow">return</span>;
<a name="l09386"></a>09386    }
<a name="l09387"></a>09387 
<a name="l09388"></a>09388   <span class="comment">/*---- pause run -------------------------------------------*/</span>
<a name="l09389"></a>09389 
<a name="l09390"></a>09390    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;pause&quot;</span>)) {
<a name="l09391"></a>09391       <span class="keywordflow">if</span> (run_state != <a class="code" href="group__mdefineh.html#gac4c0304c569818c811515e24523c3150">STATE_RUNNING</a>) {
<a name="l09392"></a>09392          <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(<span class="stringliteral">&quot;Run is not running&quot;</span>);
<a name="l09393"></a>09393          <span class="keywordflow">return</span>;
<a name="l09394"></a>09394       }
<a name="l09395"></a>09395 
<a name="l09396"></a>09396       <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, <span class="stringliteral">&quot;?cmd=pause&quot;</span>, experiment))
<a name="l09397"></a>09397          <span class="keywordflow">return</span>;
<a name="l09398"></a>09398 
<a name="l09399"></a>09399       status = <a class="code" href="group__msectionh.html#ga98ba67d921647dab7eb4f00e5dea7ba0">cm_transition</a>(<a class="code" href="group__mdefineh.html#ga11713399cfb35e58b8fae045836c0d88">TR_PAUSE</a>, 0, str, <span class="keyword">sizeof</span>(str), <a class="code" href="group__mdefineh.html#ga9ac82e856c7683e23553431e5224d5f4">SYNC</a>, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l09400"></a>09400       <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a> &amp;&amp; status != <a class="code" href="group__err21.html#ga56216c4157257715878749974191b697">CM_DEFERRED_TRANSITION</a>)
<a name="l09401"></a>09401          <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(str);
<a name="l09402"></a>09402       <span class="keywordflow">else</span>
<a name="l09403"></a>09403          <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;&quot;</span>);
<a name="l09404"></a>09404 
<a name="l09405"></a>09405       <span class="keywordflow">return</span>;
<a name="l09406"></a>09406    }
<a name="l09407"></a>09407 
<a name="l09408"></a>09408   <span class="comment">/*---- resume run ------------------------------------------*/</span>
<a name="l09409"></a>09409 
<a name="l09410"></a>09410    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;resume&quot;</span>)) {
<a name="l09411"></a>09411       <span class="keywordflow">if</span> (run_state != <a class="code" href="group__mdefineh.html#gab08c47284371c683ba80d6b3244400f1">STATE_PAUSED</a>) {
<a name="l09412"></a>09412          <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(<span class="stringliteral">&quot;Run is not paused&quot;</span>);
<a name="l09413"></a>09413          <span class="keywordflow">return</span>;
<a name="l09414"></a>09414       }
<a name="l09415"></a>09415 
<a name="l09416"></a>09416       <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, <span class="stringliteral">&quot;?cmd=resume&quot;</span>, experiment))
<a name="l09417"></a>09417          <span class="keywordflow">return</span>;
<a name="l09418"></a>09418 
<a name="l09419"></a>09419       status = <a class="code" href="group__msectionh.html#ga98ba67d921647dab7eb4f00e5dea7ba0">cm_transition</a>(<a class="code" href="group__mdefineh.html#ga0b69b728877f100fe6ff76e667ff8831">TR_RESUME</a>, 0, str, <span class="keyword">sizeof</span>(str), <a class="code" href="group__mdefineh.html#ga9ac82e856c7683e23553431e5224d5f4">SYNC</a>, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l09420"></a>09420       <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a> &amp;&amp; status != <a class="code" href="group__err21.html#ga56216c4157257715878749974191b697">CM_DEFERRED_TRANSITION</a>)
<a name="l09421"></a>09421          <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(str);
<a name="l09422"></a>09422       <span class="keywordflow">else</span>
<a name="l09423"></a>09423          <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;&quot;</span>);
<a name="l09424"></a>09424 
<a name="l09425"></a>09425       <span class="keywordflow">return</span>;
<a name="l09426"></a>09426    }
<a name="l09427"></a>09427 
<a name="l09428"></a>09428   <span class="comment">/*---- start dialog --------------------------------------------*/</span>
<a name="l09429"></a>09429 
<a name="l09430"></a>09430    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;start&quot;</span>)) {
<a name="l09431"></a>09431       <span class="keywordflow">if</span> (run_state == <a class="code" href="group__mdefineh.html#gac4c0304c569818c811515e24523c3150">STATE_RUNNING</a>) {
<a name="l09432"></a>09432          <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(<span class="stringliteral">&quot;Run is already started&quot;</span>);
<a name="l09433"></a>09433          <span class="keywordflow">return</span>;
<a name="l09434"></a>09434       }
<a name="l09435"></a>09435 
<a name="l09436"></a>09436       <span class="keywordflow">if</span> (value[0] == 0) {
<a name="l09437"></a>09437          <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, <span class="stringliteral">&quot;?cmd=start&quot;</span>, experiment))
<a name="l09438"></a>09438             <span class="keywordflow">return</span>;
<a name="l09439"></a>09439          <a class="code" href="mhttpd_8c.html#abd8300ac3ea05f7225a591cbb6255fd0">show_start_page</a>();
<a name="l09440"></a>09440       } <span class="keywordflow">else</span> {
<a name="l09441"></a>09441          <span class="comment">/* set run parameters */</span>
<a name="l09442"></a>09442          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Edit on start&quot;</span>, &amp;hkey);
<a name="l09443"></a>09443          <span class="keywordflow">if</span> (hkey) {
<a name="l09444"></a>09444             <span class="keywordflow">for</span> (i = 0, n = 0;; i++) {
<a name="l09445"></a>09445                <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkey, i, &amp;hsubkey);
<a name="l09446"></a>09446 
<a name="l09447"></a>09447                <span class="keywordflow">if</span> (!hsubkey)
<a name="l09448"></a>09448                   <span class="keywordflow">break</span>;
<a name="l09449"></a>09449 
<a name="l09450"></a>09450                <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hsubkey, &amp;key);
<a name="l09451"></a>09451 
<a name="l09452"></a>09452                <span class="keywordflow">for</span> (j = 0; j &lt; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; j++) {
<a name="l09453"></a>09453                   size = key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>;
<a name="l09454"></a>09454                   sprintf(str, <span class="stringliteral">&quot;x%d&quot;</span>, n++);
<a name="l09455"></a>09455                   <a class="code" href="group__msectionh.html#ga7b3d26e7b258c093ad999bf1286bb871">db_sscanf</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str), data, &amp;size, j, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l09456"></a>09456                   <a class="code" href="group__msectionh.html#ga18f5e7743545b06fca4f3d5ce9889034">db_set_data_index</a>(hDB, hsubkey, data, size + 1, j, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l09457"></a>09457                }
<a name="l09458"></a>09458             }
<a name="l09459"></a>09459          }
<a name="l09460"></a>09460 
<a name="l09461"></a>09461          i = atoi(value);
<a name="l09462"></a>09462          <span class="keywordflow">if</span> (i &lt;= 0) {
<a name="l09463"></a>09463             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;interprete&quot;</span>, <span class="stringliteral">&quot;Start run: invalid run number %d&quot;</span>, i);
<a name="l09464"></a>09464             sprintf(str, <span class="stringliteral">&quot;Invalid run number %d&quot;</span>, i);
<a name="l09465"></a>09465             <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(str);
<a name="l09466"></a>09466             <span class="keywordflow">return</span>;
<a name="l09467"></a>09467          }
<a name="l09468"></a>09468 
<a name="l09469"></a>09469          status = <a class="code" href="group__msectionh.html#ga98ba67d921647dab7eb4f00e5dea7ba0">cm_transition</a>(<a class="code" href="group__mdefineh.html#ga2abbc514b87837cc235da54a4cf59e09">TR_START</a>, i, str, <span class="keyword">sizeof</span>(str), <a class="code" href="group__mdefineh.html#ga9ac82e856c7683e23553431e5224d5f4">SYNC</a>, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l09470"></a>09470          <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a> &amp;&amp; status != <a class="code" href="group__err21.html#ga56216c4157257715878749974191b697">CM_DEFERRED_TRANSITION</a>)
<a name="l09471"></a>09471             <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(str);
<a name="l09472"></a>09472          <span class="keywordflow">else</span>
<a name="l09473"></a>09473             <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;&quot;</span>);
<a name="l09474"></a>09474       }
<a name="l09475"></a>09475       <span class="keywordflow">return</span>;
<a name="l09476"></a>09476    }
<a name="l09477"></a>09477 
<a name="l09478"></a>09478   <span class="comment">/*---- stop run --------------------------------------------*/</span>
<a name="l09479"></a>09479 
<a name="l09480"></a>09480    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;stop&quot;</span>)) {
<a name="l09481"></a>09481       <span class="keywordflow">if</span> (run_state != <a class="code" href="group__mdefineh.html#gac4c0304c569818c811515e24523c3150">STATE_RUNNING</a>) {
<a name="l09482"></a>09482          <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(<span class="stringliteral">&quot;Run is not running&quot;</span>);
<a name="l09483"></a>09483          <span class="keywordflow">return</span>;
<a name="l09484"></a>09484       }
<a name="l09485"></a>09485 
<a name="l09486"></a>09486       <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, <span class="stringliteral">&quot;?cmd=stop&quot;</span>, experiment))
<a name="l09487"></a>09487          <span class="keywordflow">return</span>;
<a name="l09488"></a>09488 
<a name="l09489"></a>09489       status = <a class="code" href="group__msectionh.html#ga98ba67d921647dab7eb4f00e5dea7ba0">cm_transition</a>(<a class="code" href="group__mdefineh.html#gadd7d0605113ff6e1b4e705d31332a1a0">TR_STOP</a>, 0, str, <span class="keyword">sizeof</span>(str), <a class="code" href="group__mdefineh.html#ga9ac82e856c7683e23553431e5224d5f4">SYNC</a>, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l09490"></a>09490       <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a> &amp;&amp; status != <a class="code" href="group__err21.html#ga56216c4157257715878749974191b697">CM_DEFERRED_TRANSITION</a>)
<a name="l09491"></a>09491          <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(str);
<a name="l09492"></a>09492       <span class="keywordflow">else</span>
<a name="l09493"></a>09493          <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;&quot;</span>);
<a name="l09494"></a>09494 
<a name="l09495"></a>09495       <span class="keywordflow">return</span>;
<a name="l09496"></a>09496    }
<a name="l09497"></a>09497 
<a name="l09498"></a>09498   <span class="comment">/*---- trigger equipment readout ---------------------------*/</span>
<a name="l09499"></a>09499 
<a name="l09500"></a>09500    <span class="keywordflow">if</span> (strncmp(command, <span class="stringliteral">&quot;Trigger&quot;</span>, 7) == 0) {
<a name="l09501"></a>09501       sprintf(str, <span class="stringliteral">&quot;?cmd=%s&quot;</span>, command);
<a name="l09502"></a>09502       <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, str, experiment))
<a name="l09503"></a>09503          <span class="keywordflow">return</span>;
<a name="l09504"></a>09504 
<a name="l09505"></a>09505       <span class="comment">/* extract equipment name */</span>
<a name="l09506"></a>09506       strcpy(eq_name, command + 8);
<a name="l09507"></a>09507       <span class="keywordflow">if</span> (strchr(eq_name, <span class="charliteral">&apos; &apos;</span>))
<a name="l09508"></a>09508          *strchr(eq_name, <span class="charliteral">&apos; &apos;</span>) = 0;
<a name="l09509"></a>09509 
<a name="l09510"></a>09510       <span class="comment">/* get frontend name */</span>
<a name="l09511"></a>09511       sprintf(str, <span class="stringliteral">&quot;/Equipment/%s/Common/Frontend name&quot;</span>, eq_name);
<a name="l09512"></a>09512       size = <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>;
<a name="l09513"></a>09513       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, str, fe_name, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l09514"></a>09514 
<a name="l09515"></a>09515       <span class="comment">/* and ID */</span>
<a name="l09516"></a>09516       sprintf(str, <span class="stringliteral">&quot;/Equipment/%s/Common/Event ID&quot;</span>, eq_name);
<a name="l09517"></a>09517       size = <span class="keyword">sizeof</span>(event_id);
<a name="l09518"></a>09518       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, str, &amp;event_id, &amp;size, <a class="code" href="group__mdefineh.html#ga681cbe2c114c62cecccb882544d2debb">TID_WORD</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l09519"></a>09519 
<a name="l09520"></a>09520       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#gafe2e23ec2e5c20fbc65ee238bd6cd48e">cm_exist</a>(fe_name, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>) {
<a name="l09521"></a>09521          sprintf(str, <span class="stringliteral">&quot;Frontend \&quot;%s\&quot; not running!&quot;</span>, fe_name);
<a name="l09522"></a>09522          <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(str);
<a name="l09523"></a>09523       } <span class="keywordflow">else</span> {
<a name="l09524"></a>09524          status = <a class="code" href="group__msectionh.html#ga563f51d392f150ea598ecad25a89f6b5">cm_connect_client</a>(fe_name, &amp;hconn);
<a name="l09525"></a>09525          <span class="keywordflow">if</span> (status != <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>) {
<a name="l09526"></a>09526             sprintf(str, <span class="stringliteral">&quot;Cannot connect to frontend \&quot;%s\&quot; !&quot;</span>, fe_name);
<a name="l09527"></a>09527             <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(str);
<a name="l09528"></a>09528          } <span class="keywordflow">else</span> {
<a name="l09529"></a>09529             status = <a class="code" href="group__msectionh.html#ga6ade8c4e3d08c41fbeb3a98fe2808778">rpc_client_call</a>(hconn, <a class="code" href="group__mrpcdefineh.html#gaf820c7d84c71a1469983d23ebec18a8f">RPC_MANUAL_TRIG</a>, event_id);
<a name="l09530"></a>09530             <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l09531"></a>09531                <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(<span class="stringliteral">&quot;Error triggering event&quot;</span>);
<a name="l09532"></a>09532             <span class="keywordflow">else</span>
<a name="l09533"></a>09533                <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;&quot;</span>);
<a name="l09534"></a>09534 
<a name="l09535"></a>09535             <a class="code" href="group__msectionh.html#ga4b4ec97cd2d878875c8c472e708e47d1">cm_disconnect_client</a>(hconn, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l09536"></a>09536          }
<a name="l09537"></a>09537       }
<a name="l09538"></a>09538 
<a name="l09539"></a>09539       <span class="keywordflow">return</span>;
<a name="l09540"></a>09540    }
<a name="l09541"></a>09541 
<a name="l09542"></a>09542   <span class="comment">/*---- cancel command --------------------------------------------*/</span>
<a name="l09543"></a>09543 
<a name="l09544"></a>09544    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;cancel&quot;</span>)) {
<a name="l09545"></a>09545       <span class="comment">/* strip variable name from path */</span>
<a name="l09546"></a>09546       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, dec_path, &amp;hkey);
<a name="l09547"></a>09547       <span class="keywordflow">if</span> (hkey) {
<a name="l09548"></a>09548          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l09549"></a>09549 
<a name="l09550"></a>09550          <span class="keywordflow">if</span> (key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> != <a class="code" href="group__mdefineh.html#ga15ae151ae0b7588b3327bd8451d9bcb8">TID_KEY</a>) {
<a name="l09551"></a>09551             p = enc_path + strlen(enc_path) - 1;
<a name="l09552"></a>09552             <span class="keywordflow">while</span> (*p &amp;&amp; *p != <span class="charliteral">&apos;/&apos;</span>)
<a name="l09553"></a>09553                *p-- = 0;
<a name="l09554"></a>09554             <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;/&apos;</span>)
<a name="l09555"></a>09555                *p = 0;
<a name="l09556"></a>09556          }
<a name="l09557"></a>09557       }
<a name="l09558"></a>09558 
<a name="l09559"></a>09559       <span class="keywordflow">if</span> (group[0]) {
<a name="l09560"></a>09560          <span class="comment">/* extract equipment name */</span>
<a name="l09561"></a>09561          eq_name[0] = 0;
<a name="l09562"></a>09562          <span class="keywordflow">if</span> (strncmp(enc_path, <span class="stringliteral">&quot;Equipment/&quot;</span>, 10) == 0) {
<a name="l09563"></a>09563             strcpy(eq_name, enc_path + 10);
<a name="l09564"></a>09564             <span class="keywordflow">if</span> (strchr(eq_name, <span class="charliteral">&apos;/&apos;</span>))
<a name="l09565"></a>09565                *strchr(eq_name, <span class="charliteral">&apos;/&apos;</span>) = 0;
<a name="l09566"></a>09566          }
<a name="l09567"></a>09567 
<a name="l09568"></a>09568          <span class="comment">/* back to SC display */</span>
<a name="l09569"></a>09569          sprintf(str, <span class="stringliteral">&quot;SC/%s/%s&quot;</span>, eq_name, group);
<a name="l09570"></a>09570          <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(str);
<a name="l09571"></a>09571       } <span class="keywordflow">else</span>
<a name="l09572"></a>09572          <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(enc_path);
<a name="l09573"></a>09573 
<a name="l09574"></a>09574       <span class="keywordflow">return</span>;
<a name="l09575"></a>09575    }
<a name="l09576"></a>09576 
<a name="l09577"></a>09577   <span class="comment">/*---- set command -----------------------------------------------*/</span>
<a name="l09578"></a>09578 
<a name="l09579"></a>09579    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;set&quot;</span>) &amp;&amp;
<a name="l09580"></a>09580        strncmp(path, <span class="stringliteral">&quot;SC/&quot;</span>, 3) != 0 &amp;&amp; strncmp(path, <span class="stringliteral">&quot;CS/&quot;</span>, 3) != 0) {
<a name="l09581"></a>09581       sprintf(str, <span class="stringliteral">&quot;%s?cmd=set&quot;</span>, enc_path);
<a name="l09582"></a>09582       <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, str, experiment))
<a name="l09583"></a>09583          <span class="keywordflow">return</span>;
<a name="l09584"></a>09584 
<a name="l09585"></a>09585       <a class="code" href="mhttpd_8c.html#a9ff6a4fe23af7c7a7a09b39837d2cae1">show_set_page</a>(enc_path, dec_path, group, index, value);
<a name="l09586"></a>09586       <span class="keywordflow">return</span>;
<a name="l09587"></a>09587    }
<a name="l09588"></a>09588 
<a name="l09589"></a>09589   <span class="comment">/*---- find command ----------------------------------------------*/</span>
<a name="l09590"></a>09590 
<a name="l09591"></a>09591    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;find&quot;</span>)) {
<a name="l09592"></a>09592       <a class="code" href="mhttpd_8c.html#a428671e131872ee405c8b4d799ee1ffe">show_find_page</a>(enc_path, value);
<a name="l09593"></a>09593       <span class="keywordflow">return</span>;
<a name="l09594"></a>09594    }
<a name="l09595"></a>09595 
<a name="l09596"></a>09596   <span class="comment">/*---- create command --------------------------------------------*/</span>
<a name="l09597"></a>09597 
<a name="l09598"></a>09598    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;create&quot;</span>)) {
<a name="l09599"></a>09599       sprintf(str, <span class="stringliteral">&quot;%s?cmd=create&quot;</span>, enc_path);
<a name="l09600"></a>09600       <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, str, experiment))
<a name="l09601"></a>09601          <span class="keywordflow">return</span>;
<a name="l09602"></a>09602 
<a name="l09603"></a>09603       <a class="code" href="mhttpd_8c.html#a87a3ec0b2c08a90fcd315682c7535d65">show_create_page</a>(enc_path, dec_path, value, index, atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;type&quot;</span>)));
<a name="l09604"></a>09604       <span class="keywordflow">return</span>;
<a name="l09605"></a>09605    }
<a name="l09606"></a>09606 
<a name="l09607"></a>09607   <span class="comment">/*---- CAMAC CNAF command ----------------------------------------*/</span>
<a name="l09608"></a>09608 
<a name="l09609"></a>09609    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;CNAF&quot;</span>) || strncmp(path, <span class="stringliteral">&quot;CNAF&quot;</span>, 4) == 0) {
<a name="l09610"></a>09610       <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, <span class="stringliteral">&quot;?cmd=CNAF&quot;</span>, experiment))
<a name="l09611"></a>09611          <span class="keywordflow">return</span>;
<a name="l09612"></a>09612 
<a name="l09613"></a>09613       <a class="code" href="mhttpd_8c.html#a45884f36341a7c919978b7b5bb20a707">show_cnaf_page</a>();
<a name="l09614"></a>09614       <span class="keywordflow">return</span>;
<a name="l09615"></a>09615    }
<a name="l09616"></a>09616 
<a name="l09617"></a>09617   <span class="comment">/*---- alarms command --------------------------------------------*/</span>
<a name="l09618"></a>09618 
<a name="l09619"></a>09619    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;reset all alarms&quot;</span>)) {
<a name="l09620"></a>09620       <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, <span class="stringliteral">&quot;?cmd=reset%20all%20alarms&quot;</span>, experiment))
<a name="l09621"></a>09621          <span class="keywordflow">return</span>;
<a name="l09622"></a>09622 
<a name="l09623"></a>09623       <a class="code" href="group__msectionh.html#ga906bbe1c84d87510755d6bf71e933edc">al_reset_alarm</a>(NULL);
<a name="l09624"></a>09624       <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;?cmd=alarms&quot;</span>);
<a name="l09625"></a>09625       <span class="keywordflow">return</span>;
<a name="l09626"></a>09626    }
<a name="l09627"></a>09627 
<a name="l09628"></a>09628    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;reset&quot;</span>)) {
<a name="l09629"></a>09629       <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, <span class="stringliteral">&quot;?cmd=reset%20all%20alarms&quot;</span>, experiment))
<a name="l09630"></a>09630          <span class="keywordflow">return</span>;
<a name="l09631"></a>09631 
<a name="l09632"></a>09632       <a class="code" href="group__msectionh.html#ga906bbe1c84d87510755d6bf71e933edc">al_reset_alarm</a>(dec_path);
<a name="l09633"></a>09633       <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;?cmd=alarms&quot;</span>);
<a name="l09634"></a>09634       <span class="keywordflow">return</span>;
<a name="l09635"></a>09635    }
<a name="l09636"></a>09636 
<a name="l09637"></a>09637    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;Alarms on/off&quot;</span>)) {
<a name="l09638"></a>09638       <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;Alarms/Alarm system active?cmd=set&quot;</span>);
<a name="l09639"></a>09639       <span class="keywordflow">return</span>;
<a name="l09640"></a>09640    }
<a name="l09641"></a>09641 
<a name="l09642"></a>09642   <span class="comment">/*---- programs command ------------------------------------------*/</span>
<a name="l09643"></a>09643 
<a name="l09644"></a>09644    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;programs&quot;</span>)) {
<a name="l09645"></a>09645       str[0] = 0;
<a name="l09646"></a>09646       <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;Start&quot;</span>))
<a name="l09647"></a>09647          sprintf(str, <span class="stringliteral">&quot;?cmd=programs&amp;Start=%s&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;Start&quot;</span>));
<a name="l09648"></a>09648       <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;Stop&quot;</span>))
<a name="l09649"></a>09649          sprintf(str, <span class="stringliteral">&quot;?cmd=programs&amp;Stop=%s&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;Stop&quot;</span>));
<a name="l09650"></a>09650 
<a name="l09651"></a>09651       <span class="keywordflow">if</span> (str[0])
<a name="l09652"></a>09652          <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, str, experiment))
<a name="l09653"></a>09653             <span class="keywordflow">return</span>;
<a name="l09654"></a>09654 
<a name="l09655"></a>09655       <a class="code" href="mhttpd_8c.html#a52835fe4a232ad6286c9734a7283ec47">show_programs_page</a>();
<a name="l09656"></a>09656       <span class="keywordflow">return</span>;
<a name="l09657"></a>09657    }
<a name="l09658"></a>09658 
<a name="l09659"></a>09659   <span class="comment">/*---- config command --------------------------------------------*/</span>
<a name="l09660"></a>09660 
<a name="l09661"></a>09661    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;config&quot;</span>)) {
<a name="l09662"></a>09662       <a class="code" href="mhttpd_8c.html#a9e638d1c512b1e5cfad4ff5908bc92bd">show_config_page</a>(refresh);
<a name="l09663"></a>09663       <span class="keywordflow">return</span>;
<a name="l09664"></a>09664    }
<a name="l09665"></a>09665 
<a name="l09666"></a>09666   <span class="comment">/*---- Messages command ------------------------------------------*/</span>
<a name="l09667"></a>09667 
<a name="l09668"></a>09668    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;messages&quot;</span>)) {
<a name="l09669"></a>09669       <a class="code" href="mhttpd_8c.html#ae0a76abf95fa8e8bbc8cfa721c2e9e3e">show_messages_page</a>(refresh, 20);
<a name="l09670"></a>09670       <span class="keywordflow">return</span>;
<a name="l09671"></a>09671    }
<a name="l09672"></a>09672 
<a name="l09673"></a>09673    <span class="keywordflow">if</span> (strncmp(command, <span class="stringliteral">&quot;More&quot;</span>, 4) == 0 &amp;&amp; strncmp(path, <span class="stringliteral">&quot;EL/&quot;</span>, 3) != 0) {
<a name="l09674"></a>09674       i = atoi(command + 4);
<a name="l09675"></a>09675       <span class="keywordflow">if</span> (i == 0)
<a name="l09676"></a>09676          i = 100;
<a name="l09677"></a>09677       <a class="code" href="mhttpd_8c.html#ae0a76abf95fa8e8bbc8cfa721c2e9e3e">show_messages_page</a>(0, i);
<a name="l09678"></a>09678       <span class="keywordflow">return</span>;
<a name="l09679"></a>09679    }
<a name="l09680"></a>09680 
<a name="l09681"></a>09681   <span class="comment">/*---- ELog command ----------------------------------------------*/</span>
<a name="l09682"></a>09682 
<a name="l09683"></a>09683    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;elog&quot;</span>)) {
<a name="l09684"></a>09684       <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;EL/&quot;</span>);
<a name="l09685"></a>09685       <span class="keywordflow">return</span>;
<a name="l09686"></a>09686    }
<a name="l09687"></a>09687 
<a name="l09688"></a>09688    <span class="keywordflow">if</span> (strncmp(path, <span class="stringliteral">&quot;EL/&quot;</span>, 3) == 0) {
<a name="l09689"></a>09689       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;new&quot;</span>) ||
<a name="l09690"></a>09690           <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;edit&quot;</span>) || <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;reply&quot;</span>)) {
<a name="l09691"></a>09691          sprintf(str, <span class="stringliteral">&quot;%s?cmd=%s&quot;</span>, path, command);
<a name="l09692"></a>09692          <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, str, experiment))
<a name="l09693"></a>09693             <span class="keywordflow">return</span>;
<a name="l09694"></a>09694       }
<a name="l09695"></a>09695 
<a name="l09696"></a>09696       <a class="code" href="mhttpd_8c.html#a6e9bc2cc0beb7aaf1d47824927dab3ff">show_elog_page</a>(dec_path + 3);
<a name="l09697"></a>09697       <span class="keywordflow">return</span>;
<a name="l09698"></a>09698    }
<a name="l09699"></a>09699 
<a name="l09700"></a>09700    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;Create ELog from this page&quot;</span>)) {
<a name="l09701"></a>09701       <a class="code" href="mhttpd_8c.html#a6e9bc2cc0beb7aaf1d47824927dab3ff">show_elog_page</a>(dec_path);
<a name="l09702"></a>09702       <span class="keywordflow">return</span>;
<a name="l09703"></a>09703    }
<a name="l09704"></a>09704 
<a name="l09705"></a>09705   <span class="comment">/*---- accept command --------------------------------------------*/</span>
<a name="l09706"></a>09706 
<a name="l09707"></a>09707    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;accept&quot;</span>)) {
<a name="l09708"></a>09708       refresh = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;refr&quot;</span>));
<a name="l09709"></a>09709 
<a name="l09710"></a>09710       <span class="comment">/* redirect with cookie */</span>
<a name="l09711"></a>09711       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 302 Found\r\n&quot;</span>);
<a name="l09712"></a>09712       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l09713"></a>09713       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n&quot;</span>);
<a name="l09714"></a>09714 
<a name="l09715"></a>09715       <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l09716"></a>09716       now += 3600 * 24 * 365;
<a name="l09717"></a>09717       gmt = gmtime(&amp;now);
<a name="l09718"></a>09718       strftime(str, <span class="keyword">sizeof</span>(str), <span class="stringliteral">&quot;%A, %d-%b-%Y %H:00:00 GMT&quot;</span>, gmt);
<a name="l09719"></a>09719 
<a name="l09720"></a>09720       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Set-Cookie: midas_refr=%d; path=/; expires=%s\r\n&quot;</span>, refresh, str);
<a name="l09721"></a>09721 
<a name="l09722"></a>09722       <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l09723"></a>09723          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Location: /?exp=%s\r\n\r\n&lt;html&gt;redir&lt;/html&gt;\r\n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l09724"></a>09724       <span class="keywordflow">else</span>
<a name="l09725"></a>09725          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Location: /\r\n\r\n&lt;html&gt;redir&lt;/html&gt;\r\n&quot;</span>);
<a name="l09726"></a>09726 
<a name="l09727"></a>09727       <span class="keywordflow">return</span>;
<a name="l09728"></a>09728    }
<a name="l09729"></a>09729 
<a name="l09730"></a>09730   <span class="comment">/*---- delete command --------------------------------------------*/</span>
<a name="l09731"></a>09731 
<a name="l09732"></a>09732    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;delete&quot;</span>)) {
<a name="l09733"></a>09733       sprintf(str, <span class="stringliteral">&quot;%s?cmd=delete&quot;</span>, enc_path);
<a name="l09734"></a>09734       <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, str, experiment))
<a name="l09735"></a>09735          <span class="keywordflow">return</span>;
<a name="l09736"></a>09736 
<a name="l09737"></a>09737       <a class="code" href="mhttpd_8c.html#ae0eb46ef9cdaf5808d30ed86801578ae">show_delete_page</a>(enc_path, dec_path, value, index);
<a name="l09738"></a>09738       <span class="keywordflow">return</span>;
<a name="l09739"></a>09739    }
<a name="l09740"></a>09740 
<a name="l09741"></a>09741   <span class="comment">/*---- slow control display --------------------------------------*/</span>
<a name="l09742"></a>09742 
<a name="l09743"></a>09743    <span class="keywordflow">if</span> (strncmp(path, <span class="stringliteral">&quot;SC/&quot;</span>, 3) == 0) {
<a name="l09744"></a>09744       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;edit&quot;</span>)) {
<a name="l09745"></a>09745          sprintf(str, <span class="stringliteral">&quot;%s?cmd=Edit&amp;index=%d&quot;</span>, path, index);
<a name="l09746"></a>09746          <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, str, experiment))
<a name="l09747"></a>09747             <span class="keywordflow">return</span>;
<a name="l09748"></a>09748       }
<a name="l09749"></a>09749 
<a name="l09750"></a>09750       <a class="code" href="mhttpd_8c.html#a600f971ed8a8bda53571f0c1dc027cf7">show_sc_page</a>(dec_path + 3, refresh);
<a name="l09751"></a>09751       <span class="keywordflow">return</span>;
<a name="l09752"></a>09752    }
<a name="l09753"></a>09753 
<a name="l09754"></a>09754   <span class="comment">/*---- custom page -----------------------------------------------*/</span>
<a name="l09755"></a>09755 
<a name="l09756"></a>09756    <span class="keywordflow">if</span> (strncmp(path, <span class="stringliteral">&quot;CS/&quot;</span>, 3) == 0) {
<a name="l09757"></a>09757       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;edit&quot;</span>)) {
<a name="l09758"></a>09758          sprintf(str, <span class="stringliteral">&quot;%s?cmd=Edit&amp;index=%d&quot;</span>, path, index);
<a name="l09759"></a>09759          <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, str, experiment))
<a name="l09760"></a>09760             <span class="keywordflow">return</span>;
<a name="l09761"></a>09761       }
<a name="l09762"></a>09762 
<a name="l09763"></a>09763       <a class="code" href="mhttpd_8c.html#a799152cab54c105194a1c2bae2f8be0d">show_custom_page</a>(dec_path + 3);
<a name="l09764"></a>09764       <span class="keywordflow">return</span>;
<a name="l09765"></a>09765    }
<a name="l09766"></a>09766 
<a name="l09767"></a>09767    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Custom/Status&quot;</span>, &amp;hkey) == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a> &amp;&amp; path[0] == 0) {
<a name="l09768"></a>09768       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;edit&quot;</span>)) {
<a name="l09769"></a>09769          sprintf(str, <span class="stringliteral">&quot;%s?cmd=Edit&amp;index=%d&quot;</span>, path, index);
<a name="l09770"></a>09770          <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9052568c642211164edb866e3193e120">check_web_password</a>(cookie_wpwd, str, experiment))
<a name="l09771"></a>09771             <span class="keywordflow">return</span>;
<a name="l09772"></a>09772       }
<a name="l09773"></a>09773 
<a name="l09774"></a>09774       <a class="code" href="mhttpd_8c.html#a799152cab54c105194a1c2bae2f8be0d">show_custom_page</a>(<span class="stringliteral">&quot;Status&quot;</span>);
<a name="l09775"></a>09775       <span class="keywordflow">return</span>;
<a name="l09776"></a>09776    }
<a name="l09777"></a>09777 
<a name="l09778"></a>09778   <span class="comment">/*---- show status -----------------------------------------------*/</span>
<a name="l09779"></a>09779 
<a name="l09780"></a>09780    <span class="keywordflow">if</span> (path[0] == 0) {
<a name="l09781"></a>09781       <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#a9c91f81733a48f1fbc887b013ee0de14">elog_mode</a>) {
<a name="l09782"></a>09782          <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;EL/&quot;</span>);
<a name="l09783"></a>09783          <span class="keywordflow">return</span>;
<a name="l09784"></a>09784       }
<a name="l09785"></a>09785 
<a name="l09786"></a>09786       <a class="code" href="mhttpd_8c.html#a3db9b2c2ff96ccddfa05fc7587e3d3c7">show_status_page</a>(refresh, cookie_wpwd);
<a name="l09787"></a>09787       <span class="keywordflow">return</span>;
<a name="l09788"></a>09788    }
<a name="l09789"></a>09789 
<a name="l09790"></a>09790   <span class="comment">/*---- show ODB --------------------------------------------------*/</span>
<a name="l09791"></a>09791 
<a name="l09792"></a>09792    <span class="keywordflow">if</span> (path[0]) {
<a name="l09793"></a>09793       <a class="code" href="mhttpd_8c.html#a457c736466c7c7ddd14880114a4838e4">show_odb_page</a>(enc_path, dec_path);
<a name="l09794"></a>09794       <span class="keywordflow">return</span>;
<a name="l09795"></a>09795    }
<a name="l09796"></a>09796 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a085b231653bb8eb34d8b17f5a77f8f9c"></a><!-- doxytag: member="mhttpd.c::is_editable" ref="a085b231653bb8eb34d8b17f5a77f8f9c" args="(char *eq_name, char *var_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> is_editable </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>eq_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>var_name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l04632">4632</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04376">db_get_data_index()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="midas_8h_source.html#l01316">KEY::num_values</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l04659">show_sc_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04633"></a>04633 {
<a name="l04634"></a>04634    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey;
<a name="l04635"></a>04635    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l04636"></a>04636    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l04637"></a>04637    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l04638"></a>04638 
<a name="l04639"></a>04639    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l04640"></a>04640    sprintf(str, <span class="stringliteral">&quot;/Equipment/%s/Settings/Editable&quot;</span>, eq_name);
<a name="l04641"></a>04641    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkey);
<a name="l04642"></a>04642 
<a name="l04643"></a>04643    <span class="comment">/* if no editable entry found, use default */</span>
<a name="l04644"></a>04644    <span class="keywordflow">if</span> (!hkey) {
<a name="l04645"></a>04645       <span class="keywordflow">return</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a>, <span class="stringliteral">&quot;Demand&quot;</span>) ||
<a name="l04646"></a>04646               <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a>, <span class="stringliteral">&quot;Output&quot;</span>) || strncmp(<a class="code" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a>, <span class="stringliteral">&quot;D_&quot;</span>, 2) == 0);
<a name="l04647"></a>04647    }
<a name="l04648"></a>04648 
<a name="l04649"></a>04649    <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l04650"></a>04650    <span class="keywordflow">for</span> (i = 0; i &lt; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; i++) {
<a name="l04651"></a>04651       size = <span class="keyword">sizeof</span>(str);
<a name="l04652"></a>04652       <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hkey, str, &amp;size, i, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l04653"></a>04653       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a>, str))
<a name="l04654"></a>04654          <span class="keywordflow">return</span> <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l04655"></a>04655    }
<a name="l04656"></a>04656    <span class="keywordflow">return</span> <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l04657"></a>04657 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4879491abfc24dbd22963a8b33f3f6ac"></a><!-- doxytag: member="mhttpd.c::isparam" ref="a4879491abfc24dbd22963a8b33f3f6ac" args="(char *param)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> isparam </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>param</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01089">1089</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="experiment_2template_8c_source.html#l00070">_param</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mhttpd_8c_source.html#l00879">MAX_PARAM</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l08606">show_hist_page()</a>, and <a class="el" href="mhttpd_8c_source.html#l05983">show_set_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01090"></a>01090 {
<a name="l01091"></a>01091    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l01092"></a>01092 
<a name="l01093"></a>01093    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="mhttpd_8c.html#a5732be69f55a5dbbfa3df82d31314cb1">MAX_PARAM</a> &amp;&amp; <a class="code" href="experiment_2template_8c.html#afb3a768ad8339a2cefa693559a115d80">_param</a>[i][0]; i++)
<a name="l01094"></a>01094       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>, _param[i]))
<a name="l01095"></a>01095          <span class="keywordflow">break</span>;
<a name="l01096"></a>01096 
<a name="l01097"></a>01097    <span class="keywordflow">if</span> (i &lt; <a class="code" href="mhttpd_8c.html#a5732be69f55a5dbbfa3df82d31314cb1">MAX_PARAM</a> &amp;&amp; _param[i][0])
<a name="l01098"></a>01098       <span class="keywordflow">return</span> <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01099"></a>01099 
<a name="l01100"></a>01100    <span class="keywordflow">return</span> <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01101"></a>01101 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0ddf1224851353fc92bfbff6f499fa97"></a><!-- doxytag: member="mhttpd.c::main" ref="a0ddf1224851353fc92bfbff6f499fa97" args="(int argc, char *argv[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>argv</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l10293">10293</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mana_8cpp_source.html#l00665">daemon</a>, <a class="el" href="mhttpd_8c_source.html#l00891">elog_mode</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mhttpd_8c_source.html#l00875">no_disconnect</a>, <a class="el" href="mhttpd_8c_source.html#l09964">server_loop()</a>, <a class="el" href="mhttpd_8c_source.html#l00876">tcp_port</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, <a class="el" href="odb__check_8cc_source.html#l00011">usage()</a>, and <a class="el" href="overall_8cpp_source.html#l00021">verbose</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10294"></a>10294 {
<a name="l10295"></a>10295    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l10296"></a>10296    <span class="keywordtype">int</span> <a class="code" href="mana_8cpp.html#a96203468e98720f55cbede5bb1f8cffe">daemon</a> = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l10297"></a>10297 
<a name="l10298"></a>10298    setbuf(stdout, NULL);
<a name="l10299"></a>10299    setbuf(stderr, NULL);
<a name="l10300"></a>10300 <span class="preprocessor">#ifdef SIGPIPE</span>
<a name="l10301"></a>10301 <span class="preprocessor"></span>  <span class="comment">/* avoid getting killed by &quot;Broken pipe&quot; signals */</span>
<a name="l10302"></a>10302   signal(SIGPIPE,SIG_IGN);
<a name="l10303"></a>10303 <span class="preprocessor">#endif</span>
<a name="l10304"></a>10304 <span class="preprocessor"></span>
<a name="l10305"></a>10305    <span class="comment">/* parse command line parameters */</span>
<a name="l10306"></a>10306    <a class="code" href="mhttpd_8c.html#a62893d3a883339864af5371490807e54">no_disconnect</a> = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l10307"></a>10307    <span class="keywordflow">for</span> (i = 1; i &lt; argc; i++) {
<a name="l10308"></a>10308       <span class="keywordflow">if</span> (argv[i][0] == <span class="charliteral">&apos;-&apos;</span> &amp;&amp; argv[i][1] == <span class="charliteral">&apos;D&apos;</span>)
<a name="l10309"></a>10309          daemon = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l10310"></a>10310       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argv[i][0] == <span class="charliteral">&apos;-&apos;</span> &amp;&amp; argv[i][1] == <span class="charliteral">&apos;d&apos;</span>)
<a name="l10311"></a>10311          <a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l10312"></a>10312       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argv[i][0] == <span class="charliteral">&apos;-&apos;</span> &amp;&amp; argv[i][1] == <span class="charliteral">&apos;E&apos;</span>)
<a name="l10313"></a>10313          <a class="code" href="mhttpd_8c.html#a9c91f81733a48f1fbc887b013ee0de14">elog_mode</a> = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l10314"></a>10314       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argv[i][0] == <span class="charliteral">&apos;-&apos;</span> &amp;&amp; argv[i][1] == <span class="charliteral">&apos;c&apos;</span>)
<a name="l10315"></a>10315          <a class="code" href="mhttpd_8c.html#a62893d3a883339864af5371490807e54">no_disconnect</a> = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l10316"></a>10316       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argv[i][0] == <span class="charliteral">&apos;-&apos;</span>) {
<a name="l10317"></a>10317          <span class="keywordflow">if</span> (i + 1 &gt;= argc || argv[i + 1][0] == <span class="charliteral">&apos;-&apos;</span>)
<a name="l10318"></a>10318             <span class="keywordflow">goto</span> <a class="code" href="odb__check_8cc.html#a2ef30c42cbc289d899a8be5d2d8f77d0">usage</a>;
<a name="l10319"></a>10319          <span class="keywordflow">if</span> (argv[i][1] == <span class="charliteral">&apos;p&apos;</span>)
<a name="l10320"></a>10320             <a class="code" href="mhttpd_8c.html#aa9edbe9dd2977e5cc56138a3a05f7a98">tcp_port</a> = atoi(argv[++i]);
<a name="l10321"></a>10321          <span class="keywordflow">else</span> {
<a name="l10322"></a>10322           <a class="code" href="odb__check_8cc.html#a2ef30c42cbc289d899a8be5d2d8f77d0">usage</a>:
<a name="l10323"></a>10323             printf(<span class="stringliteral">&quot;usage: %s [-p port] [-d] [-D] [-c]\n\n&quot;</span>, argv[0]);
<a name="l10324"></a>10324             printf(<span class="stringliteral">&quot;       -d display HTTP communication\n&quot;</span>);
<a name="l10325"></a>10325             printf(<span class="stringliteral">&quot;       -D become a daemon\n&quot;</span>);
<a name="l10326"></a>10326             printf(<span class="stringliteral">&quot;       -E only display ELog system\n&quot;</span>);
<a name="l10327"></a>10327             printf(<span class="stringliteral">&quot;       -c don&apos;t disconnect from experiment\n&quot;</span>);
<a name="l10328"></a>10328             <span class="keywordflow">return</span> 0;
<a name="l10329"></a>10329          }
<a name="l10330"></a>10330       }
<a name="l10331"></a>10331    }
<a name="l10332"></a>10332 
<a name="l10333"></a>10333    <a class="code" href="mhttpd_8c.html#a2d0768b06b700bb79b874bd19ba4ec6f">server_loop</a>(daemon);
<a name="l10334"></a>10334 
<a name="l10335"></a>10335    <span class="keywordflow">return</span> 0;
<a name="l10336"></a>10336 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aee05745e04f1ab703653cbc9fa9db30b"></a><!-- doxytag: member="mhttpd.c::print_message" ref="aee05745e04f1ab703653cbc9fa9db30b" args="(const char *message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> print_message </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>message</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01179">1179</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mhttpd_8c_source.html#l01177">message_buffer</a>, and <a class="el" href="bit3__mvme_2mvmestd_8h_source.html#l00045">SUCCESS</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01180"></a>01180 {
<a name="l01181"></a>01181    strcpy(<a class="code" href="mhttpd_8c.html#acdef68f81e8b732531ba7f1de9d73fc5">message_buffer</a>, <a class="code" href="examples_2macro_2midas__macro_8h.html#a408ca6b6abc64f4b82ea76d9a70dcacc">message</a>);
<a name="l01182"></a>01182    <span class="keywordflow">return</span> <a class="code" href="group__mvmestdinclude.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>;
<a name="l01183"></a>01183 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a168945a222012d1d908c78a41e7022c2"></a><!-- doxytag: member="mhttpd.c::receive_message" ref="a168945a222012d1d908c78a41e7022c2" args="(HNDLE hBuf, HNDLE id, EVENT_HEADER *pheader, void *message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void receive_message </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a>&nbsp;</td>
          <td class="paramname"> <em>hBuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a>&nbsp;</td>
          <td class="paramname"> <em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structEVENT__HEADER.html">EVENT_HEADER</a> *&nbsp;</td>
          <td class="paramname"> <em>pheader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>message</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01185">1185</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="fal_8c_source.html#l04089">print_message()</a>, <a class="el" href="mscb_8c_source.html#l00445">strlcat()</a>, and <a class="el" href="CAET_8h_source.html#l00002">time</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01186"></a>01186 {
<a name="l01187"></a>01187    time_t tm;
<a name="l01188"></a>01188    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[80], line[256];
<a name="l01189"></a>01189 
<a name="l01190"></a>01190    <span class="comment">/* prepare time */</span>
<a name="l01191"></a>01191    <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;tm);
<a name="l01192"></a>01192    strcpy(str, ctime(&amp;tm));
<a name="l01193"></a>01193    str[19] = 0;
<a name="l01194"></a>01194 
<a name="l01195"></a>01195    <span class="comment">/* print message text which comes after event header */</span>
<a name="l01196"></a>01196    strcpy(line, str + 11);
<a name="l01197"></a>01197    <a class="code" href="mscb_8c.html#a08a3fda60543c77e368c74b10f3d9799">strlcat</a>(line, (<span class="keywordtype">char</span> *) <a class="code" href="examples_2macro_2midas__macro_8h.html#a408ca6b6abc64f4b82ea76d9a70dcacc">message</a>, <span class="keyword">sizeof</span>(line));
<a name="l01198"></a>01198    <a class="code" href="fal_8c.html#a48fa208044b7e1373af57d1b24393693">print_message</a>(line);
<a name="l01199"></a>01199 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aae1a5afad4cf44ffc56fe0a1b82a3d93"></a><!-- doxytag: member="mhttpd.c::redirect" ref="aae1a5afad4cf44ffc56fe0a1b82a3d93" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void redirect </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01356">1356</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, and <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>, <a class="el" href="mhttpd_8c_source.html#l01372">redirect2()</a>, <a class="el" href="mhttpd_8c_source.html#l06182">show_create_page()</a>, <a class="el" href="mhttpd_8c_source.html#l06297">show_delete_page()</a>, <a class="el" href="mhttpd_8c_source.html#l02941">show_elog_delete()</a>, <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>, <a class="el" href="mhttpd_8c_source.html#l08158">show_hist_config_page()</a>, <a class="el" href="mhttpd_8c_source.html#l08606">show_hist_page()</a>, <a class="el" href="mhttpd_8c_source.html#l06598">show_programs_page()</a>, <a class="el" href="mhttpd_8c_source.html#l08029">show_query_page()</a>, <a class="el" href="mhttpd_8c_source.html#l04659">show_sc_page()</a>, and <a class="el" href="mhttpd_8c_source.html#l05983">show_set_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01357"></a>01357 {
<a name="l01358"></a>01358    <span class="comment">/* redirect */</span>
<a name="l01359"></a>01359    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 302 Found\r\n&quot;</span>);
<a name="l01360"></a>01360    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l01361"></a>01361    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n&quot;</span>);
<a name="l01362"></a>01362 
<a name="l01363"></a>01363    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0]) {
<a name="l01364"></a>01364       <span class="keywordflow">if</span> (strchr(path, <span class="charliteral">&apos;?&apos;</span>))
<a name="l01365"></a>01365          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Location: /%s&amp;exp=%s\n\n&lt;html&gt;redir&lt;/html&gt;\r\n&quot;</span>, path, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l01366"></a>01366       <span class="keywordflow">else</span>
<a name="l01367"></a>01367          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Location: /%s?exp=%s\n\n&lt;html&gt;redir&lt;/html&gt;\r\n&quot;</span>, path, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l01368"></a>01368    } <span class="keywordflow">else</span>
<a name="l01369"></a>01369       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Location: /%s\r\n\r\n&lt;html&gt;redir&lt;/html&gt;\r\n&quot;</span>, path);
<a name="l01370"></a>01370 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a53eda54404f0531285b06ef8c48bbf9b"></a><!-- doxytag: member="mhttpd.c::redirect2" ref="a53eda54404f0531285b06ef8c48bbf9b" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void redirect2 </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01372">1372</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mhttpd_8c_source.html#l00890">_sock</a>, <a class="el" href="melog_8c_source.html#l00085">closesocket</a>, <a class="el" href="mhttpd_8c_source.html#l01356">redirect()</a>, <a class="el" href="mhttpd_8c_source.html#l00870">return_buffer</a>, <a class="el" href="mhttpd_8c_source.html#l00872">return_length</a>, and <a class="el" href="system_8c_source.html#l03606">send_tcp()</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>, and <a class="el" href="mhttpd_8c_source.html#l06598">show_programs_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01373"></a>01373 {
<a name="l01374"></a>01374    <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(path);
<a name="l01375"></a>01375    <a class="code" href="group__msystemincludecode.html#gae657f73f38c098645aab383053478d59">send_tcp</a>(<a class="code" href="mhttpd_8c.html#a22283e600d5dd8c6c363cccd5adc2529">_sock</a>, <a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>, strlen(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>) + 1, 0);
<a name="l01376"></a>01376    <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="mhttpd_8c.html#a22283e600d5dd8c6c363cccd5adc2529">_sock</a>);
<a name="l01377"></a>01377    <a class="code" href="mhttpd_8c.html#a518fedf43db3f1313f9c88b2009380b5">return_length</a> = -1;
<a name="l01378"></a>01378 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af3273cdaacb7a8ea6ad26e4dc8389f42"></a><!-- doxytag: member="mhttpd.c::rsprintf" ref="af3273cdaacb7a8ea6ad26e4dc8389f42" args="(const char *format,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rsprintf </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01014">1014</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mhttpd_8c_source.html#l00870">return_buffer</a>, and <a class="el" href="mhttpd_8c_source.html#l00871">strlen_retbuf</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l05587">check_web_password()</a>, <a class="el" href="webpaw_8c_source.html#l00765">display_kumac()</a>, <a class="el" href="mhttpd_8c_source.html#l07289">generate_hist_graph()</a>, <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>, <a class="el" href="mhttpd_8c_source.html#l01356">redirect()</a>, <a class="el" href="mhttpd_8c_source.html#l01382">search_callback()</a>, <a class="el" href="webpaw_8c_source.html#l01382">server_loop()</a>, <a class="el" href="mhttpd_8c_source.html#l06375">show_alarm_page()</a>, <a class="el" href="mhttpd_8c_source.html#l05301">show_cnaf_page()</a>, <a class="el" href="mhttpd_8c_source.html#l06777">show_config_page()</a>, <a class="el" href="mhttpd_8c_source.html#l06182">show_create_page()</a>, <a class="el" href="mhttpd_8c_source.html#l05192">show_custom_page()</a>, <a class="el" href="mhttpd_8c_source.html#l06297">show_delete_page()</a>, <a class="el" href="mhttpd_8c_source.html#l02941">show_elog_delete()</a>, <a class="el" href="mhttpd_8c_source.html#l02506">show_elog_new()</a>, <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>, <a class="el" href="mhttpd_8c_source.html#l02771">show_elog_query()</a>, <a class="el" href="mhttpd_8c_source.html#l03003">show_elog_submit_query()</a>, <a class="el" href="mhttpd_8c_source.html#l01557">show_error()</a>, <a class="el" href="mhttpd_8c_source.html#l05528">show_experiment_page()</a>, <a class="el" href="mhttpd_8c_source.html#l06130">show_find_page()</a>, <a class="el" href="mhttpd_8c_source.html#l03588">show_form_query()</a>, <a class="el" href="mhttpd_8c_source.html#l01502">show_header()</a>, <a class="el" href="mhttpd_8c_source.html#l01472">show_help_page()</a>, <a class="el" href="mhttpd_8c_source.html#l08158">show_hist_config_page()</a>, <a class="el" href="mhttpd_8c_source.html#l08606">show_hist_page()</a>, <a class="el" href="mhttpd_8c_source.html#l02323">show_messages_page()</a>, <a class="el" href="mhttpd_8c_source.html#l05737">show_odb_page()</a>, <a class="el" href="mhttpd_8c_source.html#l05557">show_password_page()</a>, <a class="el" href="mhttpd_8c_source.html#l06598">show_programs_page()</a>, <a class="el" href="mhttpd_8c_source.html#l08029">show_query_page()</a>, <a class="el" href="mhttpd_8c_source.html#l03449">show_rawfile()</a>, <a class="el" href="mhttpd_8c_source.html#l04659">show_sc_page()</a>, <a class="el" href="mhttpd_8c_source.html#l05983">show_set_page()</a>, <a class="el" href="mhttpd_8c_source.html#l05639">show_start_page()</a>, <a class="el" href="mhttpd_8c_source.html#l01641">show_status_page()</a>, <a class="el" href="mhttpd_8c_source.html#l02421">strencode()</a>, <a class="el" href="mhttpd_8c_source.html#l02480">strencode3()</a>, <a class="el" href="mhttpd_8c_source.html#l03805">submit_elog()</a>, and <a class="el" href="mhttpd_8c_source.html#l04034">submit_form()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01015"></a>01015 {
<a name="l01016"></a>01016    va_list argptr;
<a name="l01017"></a>01017    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[10000];
<a name="l01018"></a>01018 
<a name="l01019"></a>01019    va_start(argptr, <a class="code" href="webpaw_8c.html#a6113855b8e5965f1e91ee407b4026ab7">format</a>);
<a name="l01020"></a>01020    vsprintf(str, (<span class="keywordtype">char</span> *) <a class="code" href="webpaw_8c.html#a6113855b8e5965f1e91ee407b4026ab7">format</a>, argptr);
<a name="l01021"></a>01021    va_end(argptr);
<a name="l01022"></a>01022 
<a name="l01023"></a>01023    <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a> + strlen(str) &gt; <span class="keyword">sizeof</span>(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>))
<a name="l01024"></a>01024       strcpy(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>, <span class="stringliteral">&quot;&lt;H1&gt;Error: return buffer too small&lt;/H1&gt;&quot;</span>);
<a name="l01025"></a>01025    <span class="keywordflow">else</span>
<a name="l01026"></a>01026       strcpy(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a> + <a class="code" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a>, str);
<a name="l01027"></a>01027 
<a name="l01028"></a>01028    <a class="code" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a> += strlen(str);
<a name="l01029"></a>01029 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0c625fe56e336fc4d14a579b876b9fa8"></a><!-- doxytag: member="mhttpd.c::rsputs" ref="a0c625fe56e336fc4d14a579b876b9fa8" args="(const char *str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rsputs </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>str</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00959">959</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mhttpd_8c_source.html#l00870">return_buffer</a>, and <a class="el" href="mhttpd_8c_source.html#l00871">strlen_retbuf</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l05192">show_custom_page()</a>, <a class="el" href="mhttpd_8c_source.html#l02506">show_elog_new()</a>, <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>, <a class="el" href="mhttpd_8c_source.html#l03003">show_elog_submit_query()</a>, <a class="el" href="mhttpd_8c_source.html#l03449">show_rawfile()</a>, and <a class="el" href="mhttpd_8c_source.html#l05983">show_set_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00960"></a>00960 {
<a name="l00961"></a>00961    <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a> + strlen(<a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>) &gt; <span class="keyword">sizeof</span>(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>)) {
<a name="l00962"></a>00962       strcpy(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>, <span class="stringliteral">&quot;&lt;H1&gt;Error: return buffer too small&lt;/H1&gt;&quot;</span>);
<a name="l00963"></a>00963       <a class="code" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a> = strlen(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>);
<a name="l00964"></a>00964    } <span class="keywordflow">else</span> {
<a name="l00965"></a>00965       strcpy(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a> + <a class="code" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a>, <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>);
<a name="l00966"></a>00966       <a class="code" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a> += strlen(<a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>);
<a name="l00967"></a>00967    }
<a name="l00968"></a>00968 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3fc73195d7773ac70a09f5afb5588d5a"></a><!-- doxytag: member="mhttpd.c::rsputs2" ref="a3fc73195d7773ac70a09f5afb5588d5a" args="(const char *str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rsputs2 </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>str</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00972">972</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="odbhist_8c_source.html#l00058">k</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="mhttpd_8c_source.html#l00870">return_buffer</a>, and <a class="el" href="mhttpd_8c_source.html#l00871">strlen_retbuf</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>, and <a class="el" href="mhttpd_8c_source.html#l03003">show_elog_submit_query()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00973"></a>00973 {
<a name="l00974"></a>00974    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, <a class="code" href="odbhist_8c.html#a43fa990200c3ddd47c35f151bd4d66bf">k</a>;
<a name="l00975"></a>00975    <span class="keywordtype">char</span> *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>, link[256];
<a name="l00976"></a>00976 
<a name="l00977"></a>00977    <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a> + strlen(<a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>) &gt; <span class="keyword">sizeof</span>(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>)) {
<a name="l00978"></a>00978       strcpy(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>, <span class="stringliteral">&quot;&lt;H1&gt;Error: return buffer too small&lt;/H1&gt;&quot;</span>);
<a name="l00979"></a>00979       <a class="code" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a> = strlen(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>);
<a name="l00980"></a>00980    } <span class="keywordflow">else</span> {
<a name="l00981"></a>00981       j = <a class="code" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a>;
<a name="l00982"></a>00982       <span class="keywordflow">for</span> (i = 0; i &lt; (int) strlen(<a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>); i++) {
<a name="l00983"></a>00983          <span class="keywordflow">if</span> (strncmp(<a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a> + i, <span class="stringliteral">&quot;http://&quot;</span>, 7) == 0) {
<a name="l00984"></a>00984             p = (<span class="keywordtype">char</span> *) (<a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a> + i + 7);
<a name="l00985"></a>00985             i += 7;
<a name="l00986"></a>00986             <span class="keywordflow">for</span> (k = 0; *p &amp;&amp; *p != <span class="charliteral">&apos; &apos;</span> &amp;&amp; *p != <span class="charliteral">&apos;\n&apos;</span>; k++, i++)
<a name="l00987"></a>00987                link[k] = *p++;
<a name="l00988"></a>00988             link[k] = 0;
<a name="l00989"></a>00989 
<a name="l00990"></a>00990             sprintf(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a> + j, <span class="stringliteral">&quot;&lt;a href=\&quot;http://%s\&quot;&gt;http://%s&lt;/a&gt;&quot;</span>, link, link);
<a name="l00991"></a>00991             j += strlen(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a> + j);
<a name="l00992"></a>00992          } <span class="keywordflow">else</span>
<a name="l00993"></a>00993             <span class="keywordflow">switch</span> (<a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[i]) {
<a name="l00994"></a>00994             <span class="keywordflow">case</span> <span class="charliteral">&apos;&lt;&apos;</span>:
<a name="l00995"></a>00995                strcat(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>, <span class="stringliteral">&quot;&amp;lt;&quot;</span>);
<a name="l00996"></a>00996                j += 4;
<a name="l00997"></a>00997                <span class="keywordflow">break</span>;
<a name="l00998"></a>00998             <span class="keywordflow">case</span> <span class="charliteral">&apos;&gt;&apos;</span>:
<a name="l00999"></a>00999                strcat(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>, <span class="stringliteral">&quot;&amp;gt;&quot;</span>);
<a name="l01000"></a>01000                j += 4;
<a name="l01001"></a>01001                <span class="keywordflow">break</span>;
<a name="l01002"></a>01002             <span class="keywordflow">default</span>:
<a name="l01003"></a>01003                <a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>[j++] = <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[i];
<a name="l01004"></a>01004             }
<a name="l01005"></a>01005       }
<a name="l01006"></a>01006 
<a name="l01007"></a>01007       <a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>[j] = 0;
<a name="l01008"></a>01008       <a class="code" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a> = j;
<a name="l01009"></a>01009    }
<a name="l01010"></a>01010 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad8887c77d8b39e96ce32b579f1f8b17b"></a><!-- doxytag: member="mhttpd.c::search_callback" ref="ad8887c77d8b39e96ce32b579f1f8b17b" args="(HNDLE hDB, HNDLE hKey, KEY *key, INT level, void *info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> search_callback </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a>&nbsp;</td>
          <td class="paramname"> <em>hDB</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a>&nbsp;</td>
          <td class="paramname"> <em>hKey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structKEY.html">KEY</a> *&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>info</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01382">1382</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="lrs1821_8c_source.html#l00038">data</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l02907">db_get_path()</a>, <a class="el" href="midas_8h_source.html#l01018">DB_NO_ACCESS</a>, <a class="el" href="odb_8c_source.html#l06308">db_sprintf()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="midas_8h_source.html#l01320">KEY::item_size</a>, <a class="el" href="midas_8h_source.html#l00686">MAX_ODB_PATH</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="midas_8h_source.html#l01316">KEY::num_values</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="bit3__mvme_2mvmestd_8h_source.html#l00045">SUCCESS</a>, <a class="el" href="midas_8h_source.html#l00749">TID_KEY</a>, <a class="el" href="midas_8h_source.html#l00750">TID_LINK</a>, <a class="el" href="midas_8h_source.html#l01315">KEY::type</a>, and <a class="el" href="mhttpd_8c_source.html#l01153">urlEncode()</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l06130">show_find_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01383"></a>01383 {
<a name="l01384"></a>01384    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l01385"></a>01385    <span class="keywordtype">char</span> *search_name, *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>;
<a name="l01386"></a>01386    <span class="keyword">static</span> <span class="keywordtype">char</span> data_str[<a class="code" href="group__midasincludecode.html#ga78b086c08dd57c930e2997a71a3ae5ee">MAX_ODB_PATH</a>];
<a name="l01387"></a>01387    <span class="keyword">static</span> <span class="keywordtype">char</span> str1[<a class="code" href="group__midasincludecode.html#ga78b086c08dd57c930e2997a71a3ae5ee">MAX_ODB_PATH</a>], str2[<a class="code" href="group__midasincludecode.html#ga78b086c08dd57c930e2997a71a3ae5ee">MAX_ODB_PATH</a>], ref[<a class="code" href="group__midasincludecode.html#ga78b086c08dd57c930e2997a71a3ae5ee">MAX_ODB_PATH</a>];
<a name="l01388"></a>01388    <span class="keywordtype">char</span> path[<a class="code" href="group__midasincludecode.html#ga78b086c08dd57c930e2997a71a3ae5ee">MAX_ODB_PATH</a>], <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>[10000];
<a name="l01389"></a>01389 
<a name="l01390"></a>01390    search_name = (<span class="keywordtype">char</span> *) info;
<a name="l01391"></a>01391 
<a name="l01392"></a>01392    <span class="comment">/* convert strings to uppercase */</span>
<a name="l01393"></a>01393    <span class="keywordflow">for</span> (i = 0; key-&gt;<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>[i]; i++)
<a name="l01394"></a>01394       str1[i] = toupper(key-&gt;<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>[i]);
<a name="l01395"></a>01395    str1[i] = 0;
<a name="l01396"></a>01396    <span class="keywordflow">for</span> (i = 0; key-&gt;<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>[i]; i++)
<a name="l01397"></a>01397       str2[i] = toupper(search_name[i]);
<a name="l01398"></a>01398    str2[i] = 0;
<a name="l01399"></a>01399 
<a name="l01400"></a>01400    <span class="keywordflow">if</span> (strstr(str1, str2) != NULL) {
<a name="l01401"></a>01401       <a class="code" href="group__msectionh.html#ga37afa96e19d9d40a6eb213229e0e77a3">db_get_path</a>(<a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, <a class="code" href="mevb_8cpp.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>, str1, <a class="code" href="group__midasincludecode.html#ga78b086c08dd57c930e2997a71a3ae5ee">MAX_ODB_PATH</a>);
<a name="l01402"></a>01402       strcpy(path, str1 + 1);   <span class="comment">/* strip leading &apos;/&apos; */</span>
<a name="l01403"></a>01403       strcpy(str1, path);
<a name="l01404"></a>01404       <a class="code" href="mhttpd_8c.html#a477e33c685ba6ebcb9d429fb057c2760">urlEncode</a>(str1);
<a name="l01405"></a>01405 
<a name="l01406"></a>01406       <span class="keywordflow">if</span> (key-&gt;<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#ga15ae151ae0b7588b3327bd8451d9bcb8">TID_KEY</a> || key-&gt;<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#gaa63f41f547c7f46f828aaf35073807ea">TID_LINK</a>) {
<a name="l01407"></a>01407          <span class="comment">/* for keys, don&apos;t display data value */</span>
<a name="l01408"></a>01408          <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l01409"></a>01409             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFD000&gt;&lt;a href=\&quot;/?exp=%s&amp;path=%s\&quot;&gt;%s&lt;/a&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l01410"></a>01410                      <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, str1, path);
<a name="l01411"></a>01411          <span class="keywordflow">else</span>
<a name="l01412"></a>01412             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFD000&gt;&lt;a href=\&quot;/%s\&quot;&gt;%s&lt;/a&gt;&lt;/tr&gt;\n&quot;</span>, str1, path);
<a name="l01413"></a>01413       } <span class="keywordflow">else</span> {
<a name="l01414"></a>01414          <span class="comment">/* strip variable name from path */</span>
<a name="l01415"></a>01415          p = path + strlen(path) - 1;
<a name="l01416"></a>01416          <span class="keywordflow">while</span> (*p &amp;&amp; *p != <span class="charliteral">&apos;/&apos;</span>)
<a name="l01417"></a>01417             *p-- = 0;
<a name="l01418"></a>01418          <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;/&apos;</span>)
<a name="l01419"></a>01419             *p = 0;
<a name="l01420"></a>01420 
<a name="l01421"></a>01421          <span class="comment">/* display single value */</span>
<a name="l01422"></a>01422          <span class="keywordflow">if</span> (key-&gt;<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a> == 1) {
<a name="l01423"></a>01423             size = <span class="keyword">sizeof</span>(data);
<a name="l01424"></a>01424             status = <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(<a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, <a class="code" href="mevb_8cpp.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>, data, &amp;size, key-&gt;<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l01425"></a>01425             <span class="keywordflow">if</span> (status == <a class="code" href="group__err23.html#ga467b0af34b1011481919088b6af86b95">DB_NO_ACCESS</a>)
<a name="l01426"></a>01426                strcpy(data_str, <span class="stringliteral">&quot;&lt;no read access&gt;&quot;</span>);
<a name="l01427"></a>01427             <span class="keywordflow">else</span>
<a name="l01428"></a>01428                <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(data_str, data, key-&gt;<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, key-&gt;<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l01429"></a>01429 
<a name="l01430"></a>01430             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l01431"></a>01431                sprintf(ref, <span class="stringliteral">&quot;/%s?cmd=Set&amp;exp=%s&quot;</span>, str1, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l01432"></a>01432             <span class="keywordflow">else</span>
<a name="l01433"></a>01433                sprintf(ref, <span class="stringliteral">&quot;/%s?cmd=Set&quot;</span>, str1);
<a name="l01434"></a>01434 
<a name="l01435"></a>01435             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;&quot;</span>);
<a name="l01436"></a>01436 
<a name="l01437"></a>01437             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l01438"></a>01438                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/%s?exp=%s\&quot;&gt;%s&lt;/a&gt;/%s&quot;</span>, path, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, path,
<a name="l01439"></a>01439                         key-&gt;<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l01440"></a>01440             <span class="keywordflow">else</span>
<a name="l01441"></a>01441                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/%s\&quot;&gt;%s&lt;/a&gt;/%s&quot;</span>, path, path, key-&gt;<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l01442"></a>01442 
<a name="l01443"></a>01443             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td&gt;&lt;a href=\&quot;%s\&quot;&gt;%s&lt;/a&gt;&lt;/tr&gt;\n&quot;</span>, ref, data_str);
<a name="l01444"></a>01444          } <span class="keywordflow">else</span> {
<a name="l01445"></a>01445             <span class="comment">/* display first value */</span>
<a name="l01446"></a>01446             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td rowspan=%d bgcolor=#FFFF00&gt;%s\n&quot;</span>, key-&gt;<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>, path);
<a name="l01447"></a>01447 
<a name="l01448"></a>01448             <span class="keywordflow">for</span> (i = 0; i &lt; key-&gt;<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; i++) {
<a name="l01449"></a>01449                size = <span class="keyword">sizeof</span>(data);
<a name="l01450"></a>01450                <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(<a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, <a class="code" href="mevb_8cpp.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>, data, &amp;size, key-&gt;<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l01451"></a>01451                <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(data_str, data, key-&gt;<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, i, key-&gt;<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l01452"></a>01452 
<a name="l01453"></a>01453                <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l01454"></a>01454                   sprintf(ref, <span class="stringliteral">&quot;/%s?cmd=Set&amp;index=%d&amp;exp=%s&quot;</span>, str1, i, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l01455"></a>01455                <span class="keywordflow">else</span>
<a name="l01456"></a>01456                   sprintf(ref, <span class="stringliteral">&quot;/%s?cmd=Set&amp;index=%d&quot;</span>, str1, i);
<a name="l01457"></a>01457 
<a name="l01458"></a>01458                <span class="keywordflow">if</span> (i &gt; 0)
<a name="l01459"></a>01459                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>);
<a name="l01460"></a>01460 
<a name="l01461"></a>01461                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td&gt;&lt;a href=\&quot;%s\&quot;&gt;[%d] %s&lt;/a&gt;&lt;/tr&gt;\n&quot;</span>, ref, i, data_str);
<a name="l01462"></a>01462             }
<a name="l01463"></a>01463          }
<a name="l01464"></a>01464       }
<a name="l01465"></a>01465    }
<a name="l01466"></a>01466 
<a name="l01467"></a>01467    <span class="keywordflow">return</span> <a class="code" href="group__mvmestdinclude.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>;
<a name="l01468"></a>01468 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9602d6d6719f5884ac3a8433c6b65daf"></a><!-- doxytag: member="mhttpd.c::sec_to_label" ref="a9602d6d6719f5884ac3a8433c6b65daf" args="(char *result, int sec, int base, int force_date)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sec_to_label </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>result</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>force_date</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l06929">6929</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mhttpd_8c_source.html#l00894">mname</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l06961">taxis()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06930"></a>06930 {
<a name="l06931"></a>06931    <span class="keywordtype">char</span> mon[80];
<a name="l06932"></a>06932    <span class="keyword">struct </span>tm *tms;
<a name="l06933"></a>06933 
<a name="l06934"></a>06934    tms = localtime((time_t *) &amp; sec);
<a name="l06935"></a>06935    strcpy(mon, <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[tms-&gt;tm_mon]);
<a name="l06936"></a>06936    mon[3] = 0;
<a name="l06937"></a>06937 
<a name="l06938"></a>06938    <span class="keywordflow">if</span> (force_date) {
<a name="l06939"></a>06939       <span class="keywordflow">if</span> (base &lt; 600)
<a name="l06940"></a>06940          sprintf(result, <span class="stringliteral">&quot;%02d %s %02d %02d:%02d:%02d&quot;</span>,
<a name="l06941"></a>06941                  tms-&gt;tm_mday, mon, tms-&gt;tm_year % 100,
<a name="l06942"></a>06942                  tms-&gt;tm_hour, tms-&gt;tm_min, tms-&gt;tm_sec);
<a name="l06943"></a>06943       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (base &lt; 3600 * 24)
<a name="l06944"></a>06944          sprintf(result, <span class="stringliteral">&quot;%02d %s %02d %02d:%02d&quot;</span>,
<a name="l06945"></a>06945                  tms-&gt;tm_mday, mon, tms-&gt;tm_year % 100, tms-&gt;tm_hour, tms-&gt;tm_min);
<a name="l06946"></a>06946       <span class="keywordflow">else</span>
<a name="l06947"></a>06947          sprintf(result, <span class="stringliteral">&quot;%02d %s %02d&quot;</span>, tms-&gt;tm_mday, mon, tms-&gt;tm_year % 100);
<a name="l06948"></a>06948    } <span class="keywordflow">else</span> {
<a name="l06949"></a>06949       <span class="keywordflow">if</span> (base &lt; 600)
<a name="l06950"></a>06950          sprintf(result, <span class="stringliteral">&quot;%02d:%02d:%02d&quot;</span>, tms-&gt;tm_hour, tms-&gt;tm_min, tms-&gt;tm_sec);
<a name="l06951"></a>06951       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (base &lt; 3600 * 3)
<a name="l06952"></a>06952          sprintf(result, <span class="stringliteral">&quot;%02d:%02d&quot;</span>, tms-&gt;tm_hour, tms-&gt;tm_min);
<a name="l06953"></a>06953       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (base &lt; 3600 * 24)
<a name="l06954"></a>06954          sprintf(result, <span class="stringliteral">&quot;%02d %s %02d %02d:%02d&quot;</span>,
<a name="l06955"></a>06955                  tms-&gt;tm_mday, mon, tms-&gt;tm_year % 100, tms-&gt;tm_hour, tms-&gt;tm_min);
<a name="l06956"></a>06956       <span class="keywordflow">else</span>
<a name="l06957"></a>06957          sprintf(result, <span class="stringliteral">&quot;%02d %s %02d&quot;</span>, tms-&gt;tm_mday, mon, tms-&gt;tm_year % 100);
<a name="l06958"></a>06958    }
<a name="l06959"></a>06959 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a42871a3e3778313e1f63deac5a41765b"></a><!-- doxytag: member="mhttpd.c::sendmail" ref="a42871a3e3778313e1f63deac5a41765b" args="(char *smtp_host, char *from, char *to, char *subject, char *text)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> sendmail </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>smtp_host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>to</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>subject</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>text</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01203">1203</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="generic_8c_source.html#l00091">abs</a>, <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="melog_8c_source.html#l00085">closesocket</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00327">host_name</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="midas_8h_source.html#l00506">MIDAS_VERSION</a>, <a class="el" href="mgd_8c_source.html#l01505">offset</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="system_8c_source.html#l03660">recv_string()</a>, <a class="el" href="scs__310_8c_source.html#l00266">send()</a>, <a class="el" href="mscb_8c_source.html#l00445">strlcat()</a>, <a class="el" href="mscb_8c_source.html#l00414">strlcpy()</a>, <a class="el" href="mhttpd_8c_source.html#l00882">TEXT_SIZE</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, and <a class="el" href="overall_8cpp_source.html#l00021">verbose</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01204"></a>01204 {
<a name="l01205"></a>01205    <span class="keyword">struct </span>sockaddr_in bind_addr;
<a name="l01206"></a>01206    <span class="keyword">struct </span>hostent *phe;
<a name="l01207"></a>01207    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, s, strsize, <a class="code" href="mgd_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a>;
<a name="l01208"></a>01208    <span class="keywordtype">char</span> *<a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>, *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>, <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[256];
<a name="l01209"></a>01209    time_t now;
<a name="l01210"></a>01210    <span class="keyword">struct </span>tm *ts;
<a name="l01211"></a>01211 
<a name="l01212"></a>01212    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01213"></a>01213       printf(<span class="stringliteral">&quot;\n\nEmail from %s to %s, SMTP host %s:\n&quot;</span>, from, to, smtp_host);
<a name="l01214"></a>01214 
<a name="l01215"></a>01215    <span class="comment">/* create a new socket for connecting to remote server */</span>
<a name="l01216"></a>01216    s = socket(AF_INET, SOCK_STREAM, 0);
<a name="l01217"></a>01217    <span class="keywordflow">if</span> (s == -1)
<a name="l01218"></a>01218       <span class="keywordflow">return</span> -1;
<a name="l01219"></a>01219 
<a name="l01220"></a>01220    <span class="comment">/* connect to remote node port 25 */</span>
<a name="l01221"></a>01221    memset(&amp;bind_addr, 0, <span class="keyword">sizeof</span>(bind_addr));
<a name="l01222"></a>01222    bind_addr.sin_family = AF_INET;
<a name="l01223"></a>01223    bind_addr.sin_port = htons((<span class="keywordtype">short</span>) 25);
<a name="l01224"></a>01224 
<a name="l01225"></a>01225    phe = gethostbyname(smtp_host);
<a name="l01226"></a>01226    <span class="keywordflow">if</span> (phe == NULL)
<a name="l01227"></a>01227       <span class="keywordflow">return</span> -1;
<a name="l01228"></a>01228    memcpy((<span class="keywordtype">char</span> *) &amp;(bind_addr.sin_addr), phe-&gt;h_addr, phe-&gt;h_length);
<a name="l01229"></a>01229 
<a name="l01230"></a>01230    <span class="keywordflow">if</span> (connect(s, (<span class="keywordtype">void</span> *) &amp;bind_addr, <span class="keyword">sizeof</span>(bind_addr)) &lt; 0) {
<a name="l01231"></a>01231       <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(s);
<a name="l01232"></a>01232       <span class="keywordflow">return</span> -1;
<a name="l01233"></a>01233    }
<a name="l01234"></a>01234 
<a name="l01235"></a>01235    strsize = <a class="code" href="mhttpd_8c.html#afb6f36d91ffbf947cfa3f1114ca79764">TEXT_SIZE</a> + 1000;
<a name="l01236"></a>01236    str = malloc(strsize);
<a name="l01237"></a>01237 
<a name="l01238"></a>01238    <a class="code" href="group__msystemincludecode.html#gaf9411818011b3b2bbc02a1db8340c77a">recv_string</a>(s, str, strsize, 3000);
<a name="l01239"></a>01239    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01240"></a>01240       puts(str);
<a name="l01241"></a>01241 
<a name="l01242"></a>01242    <span class="comment">/* drain server messages */</span>
<a name="l01243"></a>01243    <span class="keywordflow">do</span> {
<a name="l01244"></a>01244       str[0] = 0;
<a name="l01245"></a>01245       <a class="code" href="group__msystemincludecode.html#gaf9411818011b3b2bbc02a1db8340c77a">recv_string</a>(s, str, strsize, 300);
<a name="l01246"></a>01246       <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01247"></a>01247          puts(str);
<a name="l01248"></a>01248    } <span class="keywordflow">while</span> (str[0]);
<a name="l01249"></a>01249 
<a name="l01250"></a>01250    sprintf(str, <span class="stringliteral">&quot;HELO %s\r\n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>);
<a name="l01251"></a>01251    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(s, str, strlen(str), 0);
<a name="l01252"></a>01252    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01253"></a>01253       puts(str);
<a name="l01254"></a>01254    <a class="code" href="group__msystemincludecode.html#gaf9411818011b3b2bbc02a1db8340c77a">recv_string</a>(s, str, strsize, 3000);
<a name="l01255"></a>01255    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01256"></a>01256       puts(str);
<a name="l01257"></a>01257 
<a name="l01258"></a>01258    <span class="keywordflow">if</span> (strchr(from, <span class="charliteral">&apos;&lt;&apos;</span>)) {
<a name="l01259"></a>01259       <a class="code" href="mscb_8c.html#a4637af6f79bac4043e1064f0837d0ddc">strlcpy</a>(buf, strchr(from, <span class="charliteral">&apos;&lt;&apos;</span>)+1, <span class="keyword">sizeof</span>(buf));
<a name="l01260"></a>01260       <span class="keywordflow">if</span> (strchr(buf, <span class="charliteral">&apos;&gt;&apos;</span>))
<a name="l01261"></a>01261          *strchr(buf, <span class="charliteral">&apos;&gt;&apos;</span>) = 0;
<a name="l01262"></a>01262    } <span class="keywordflow">else</span>
<a name="l01263"></a>01263       <a class="code" href="mscb_8c.html#a4637af6f79bac4043e1064f0837d0ddc">strlcpy</a>(buf, from, <span class="keyword">sizeof</span>(buf));
<a name="l01264"></a>01264 
<a name="l01265"></a>01265    sprintf(str, <span class="stringliteral">&quot;MAIL FROM: %s\n&quot;</span>, buf);
<a name="l01266"></a>01266    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(s, str, strlen(str), 0);
<a name="l01267"></a>01267    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01268"></a>01268       puts(str);
<a name="l01269"></a>01269    <a class="code" href="group__msystemincludecode.html#gaf9411818011b3b2bbc02a1db8340c77a">recv_string</a>(s, str, strsize, 3000);
<a name="l01270"></a>01270    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01271"></a>01271       puts(str);
<a name="l01272"></a>01272 
<a name="l01273"></a>01273    sprintf(str, <span class="stringliteral">&quot;RCPT TO: &lt;%s&gt;\r\n&quot;</span>, to);
<a name="l01274"></a>01274    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(s, str, strlen(str), 0);
<a name="l01275"></a>01275    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01276"></a>01276       puts(str);
<a name="l01277"></a>01277    <a class="code" href="group__msystemincludecode.html#gaf9411818011b3b2bbc02a1db8340c77a">recv_string</a>(s, str, strsize, 3000);
<a name="l01278"></a>01278    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01279"></a>01279       puts(str);
<a name="l01280"></a>01280 
<a name="l01281"></a>01281    sprintf(str, <span class="stringliteral">&quot;DATA\r\n&quot;</span>);
<a name="l01282"></a>01282    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(s, str, strlen(str), 0);
<a name="l01283"></a>01283    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01284"></a>01284       puts(str);
<a name="l01285"></a>01285    <a class="code" href="group__msystemincludecode.html#gaf9411818011b3b2bbc02a1db8340c77a">recv_string</a>(s, str, strsize, 3000);
<a name="l01286"></a>01286    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01287"></a>01287       puts(str);
<a name="l01288"></a>01288 
<a name="l01289"></a>01289    sprintf(str, <span class="stringliteral">&quot;To: %s\r\nFrom: %s\r\nSubject: %s\r\n&quot;</span>, to, from, subject);
<a name="l01290"></a>01290    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(s, str, strlen(str), 0);
<a name="l01291"></a>01291    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01292"></a>01292       puts(str);
<a name="l01293"></a>01293 
<a name="l01294"></a>01294    sprintf(str, <span class="stringliteral">&quot;X-Mailer: mhttpd, midas version %s\r\n&quot;</span>, <a class="code" href="group__midasincludecode.html#ga8486b1a99e82fc5138d53b01bdcf405e">MIDAS_VERSION</a>);
<a name="l01295"></a>01295    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(s, str, strlen(str), 0);
<a name="l01296"></a>01296    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01297"></a>01297       puts(str);
<a name="l01298"></a>01298 
<a name="l01299"></a>01299    <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l01300"></a>01300    ts = localtime(&amp;now);
<a name="l01301"></a>01301    strftime(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%a, %d %b %Y %H:%M:%S&quot;</span>, ts);
<a name="l01302"></a>01302    offset = (-(int) timezone);
<a name="l01303"></a>01303    <span class="keywordflow">if</span> (ts-&gt;tm_isdst)
<a name="l01304"></a>01304       offset += 3600;
<a name="l01305"></a>01305    sprintf(str, <span class="stringliteral">&quot;Date: %s %+03d%02d\r\n&quot;</span>, buf, (<span class="keywordtype">int</span>) (offset / 3600),
<a name="l01306"></a>01306             (<span class="keywordtype">int</span>) ((<a class="code" href="generic_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>((<span class="keywordtype">int</span>) offset) / 60) % 60));
<a name="l01307"></a>01307    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(s, str, strlen(str), 0);
<a name="l01308"></a>01308    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01309"></a>01309       puts(str);
<a name="l01310"></a>01310 
<a name="l01311"></a>01311    sprintf(str, <span class="stringliteral">&quot;Content-Type: TEXT/PLAIN; charset=US-ASCII\r\n\r\n&quot;</span>);
<a name="l01312"></a>01312    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(s, str, strlen(str), 0);
<a name="l01313"></a>01313    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01314"></a>01314       puts(str);
<a name="l01315"></a>01315 
<a name="l01316"></a>01316    <span class="comment">/* analyze text for &quot;.&quot; at beginning of line */</span>
<a name="l01317"></a>01317    p = text;
<a name="l01318"></a>01318    str[0] = 0;
<a name="l01319"></a>01319    <span class="keywordflow">while</span> (strstr(p, <span class="stringliteral">&quot;\r\n.\r\n&quot;</span>)) {
<a name="l01320"></a>01320       i = (int) strstr(p, <span class="stringliteral">&quot;\r\n.\r\n&quot;</span>) - (int) p + 1;
<a name="l01321"></a>01321       <a class="code" href="mscb_8c.html#a08a3fda60543c77e368c74b10f3d9799">strlcat</a>(str, p, i);
<a name="l01322"></a>01322       p += i + 4;
<a name="l01323"></a>01323       <a class="code" href="mscb_8c.html#a08a3fda60543c77e368c74b10f3d9799">strlcat</a>(str, <span class="stringliteral">&quot;\r\n..\r\n&quot;</span>, strsize);
<a name="l01324"></a>01324    }
<a name="l01325"></a>01325    <a class="code" href="mscb_8c.html#a08a3fda60543c77e368c74b10f3d9799">strlcat</a>(str, p, strsize);
<a name="l01326"></a>01326    <a class="code" href="mscb_8c.html#a08a3fda60543c77e368c74b10f3d9799">strlcat</a>(str, <span class="stringliteral">&quot;\r\n&quot;</span>, strsize);
<a name="l01327"></a>01327    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(s, str, strlen(str), 0);
<a name="l01328"></a>01328    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01329"></a>01329       puts(str);
<a name="l01330"></a>01330 
<a name="l01331"></a>01331    <span class="comment">/* send &quot;.&lt;CR&gt;&quot; to signal end of message */</span>
<a name="l01332"></a>01332    sprintf(str, <span class="stringliteral">&quot;.\r\n&quot;</span>);
<a name="l01333"></a>01333    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(s, str, strlen(str), 0);
<a name="l01334"></a>01334    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01335"></a>01335       puts(str);
<a name="l01336"></a>01336    <a class="code" href="group__msystemincludecode.html#gaf9411818011b3b2bbc02a1db8340c77a">recv_string</a>(s, str, strsize, 3000);
<a name="l01337"></a>01337    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01338"></a>01338       puts(str);
<a name="l01339"></a>01339 
<a name="l01340"></a>01340    sprintf(str, <span class="stringliteral">&quot;QUIT\n&quot;</span>);
<a name="l01341"></a>01341    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(s, str, strlen(str), 0);
<a name="l01342"></a>01342    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01343"></a>01343       puts(str);
<a name="l01344"></a>01344    <a class="code" href="group__msystemincludecode.html#gaf9411818011b3b2bbc02a1db8340c77a">recv_string</a>(s, str, strsize, 3000);
<a name="l01345"></a>01345    <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l01346"></a>01346       puts(str);
<a name="l01347"></a>01347 
<a name="l01348"></a>01348    <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(s);
<a name="l01349"></a>01349    free(str);
<a name="l01350"></a>01350 
<a name="l01351"></a>01351    <span class="keywordflow">return</span> 1;
<a name="l01352"></a>01352 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2d0768b06b700bb79b874bd19ba4ec6f"></a><!-- doxytag: member="mhttpd.c::server_loop" ref="a2d0768b06b700bb79b874bd19ba4ec6f" args="(int daemon)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void server_loop </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>daemon</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l09964">9964</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mhttpd_8c_source.html#l09953">_abort</a>, <a class="el" href="mhttpd_8c_source.html#l00890">_sock</a>, <a class="el" href="melog_8c_source.html#l00085">closesocket</a>, <a class="el" href="midas_8c_source.html#l02768">cm_disconnect_experiment()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8c_source.html#l04166">cm_yield()</a>, <a class="el" href="mhttpd_8c_source.html#l00865">CONNECT_TIME</a>, <a class="el" href="mhttpd_8c_source.html#l00875">connected</a>, <a class="el" href="mhttpd_8c_source.html#l09955">ctrlc_handler()</a>, <a class="el" href="mhttpd_8c_source.html#l09800">decode_get()</a>, <a class="el" href="mhttpd_8c_source.html#l09841">decode_post()</a>, <a class="el" href="mhttpd_8c_source.html#l00862">DEFAULT_REFRESH</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="msystem_8h_source.html#l00336">FD_SETSIZE</a>, <a class="el" href="scs__310__ql355p_8c_source.html#l00055">flag</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00327">host_name</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mevb_8cpp_source.html#l00090">last_time</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="rpc_8c_source.html#l00293">net_buffer</a>, <a class="el" href="mhttpd_8c_source.html#l00875">no_disconnect</a>, <a class="el" href="mhttpd_8c_source.html#l00889">remote_addr</a>, <a class="el" href="mhttpd_8c_source.html#l00870">return_buffer</a>, <a class="el" href="mhttpd_8c_source.html#l00872">return_length</a>, <a class="el" href="midas_8h_source.html#l01075">RPC_SHUTDOWN</a>, <a class="el" href="scs__310_8c_source.html#l00266">send()</a>, <a class="el" href="system_8c_source.html#l03606">send_tcp()</a>, <a class="el" href="mhttpd_8c_source.html#l01557">show_error()</a>, <a class="el" href="system_8c_source.html#l02866">ss_ctrlc_handler()</a>, <a class="el" href="system_8c_source.html#l01466">ss_daemon_init()</a>, <a class="el" href="system_8c_source.html#l02332">ss_time()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="mhttpd_8c_source.html#l00871">strlen_retbuf</a>, <a class="el" href="mhttpd_8c_source.html#l00876">tcp_port</a>, and <a class="el" href="overall_8cpp_source.html#l00021">verbose</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l10293">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09965"></a>09965 {
<a name="l09966"></a>09966    <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, refresh, n_error;
<a name="l09967"></a>09967    <span class="keyword">struct </span>sockaddr_in bind_addr, acc_addr;
<a name="l09968"></a>09968    <span class="keywordtype">char</span> cookie_pwd[256], cookie_wpwd[256], boundary[256];
<a name="l09969"></a>09969    <span class="keywordtype">int</span> lsock, len, <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a>, content_length, header_length;
<a name="l09970"></a>09970    <span class="keyword">struct </span>hostent *phe;
<a name="l09971"></a>09971    fd_set readfds;
<a name="l09972"></a>09972    <span class="keyword">struct </span>timeval <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>;
<a name="l09973"></a>09973    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mevb_8cpp.html#a5fecce64b1b883ada4ac0bc410fb3304">last_time</a> = 0;
<a name="l09974"></a>09974 <span class="comment">/*</span>
<a name="l09975"></a>09975 <span class="comment">struct linger        ling;</span>
<a name="l09976"></a>09976 <span class="comment">*/</span>
<a name="l09977"></a>09977 
<a name="l09978"></a>09978    <span class="comment">/* establish Ctrl-C handler */</span>
<a name="l09979"></a>09979    <a class="code" href="group__msectionh.html#gadee9625d56a73edbbf43595cde457e42">ss_ctrlc_handler</a>(<a class="code" href="mhttpd_8c.html#a5ace87cacf3af691fcc4e3c0fcee2457">ctrlc_handler</a>);
<a name="l09980"></a>09980 
<a name="l09981"></a>09981 <span class="preprocessor">#ifdef OS_WINNT</span>
<a name="l09982"></a>09982 <span class="preprocessor"></span>   {
<a name="l09983"></a>09983       WSADATA WSAData;
<a name="l09984"></a>09984 
<a name="l09985"></a>09985       <span class="comment">/* Start windows sockets */</span>
<a name="l09986"></a>09986       <span class="keywordflow">if</span> (WSAStartup(MAKEWORD(1, 1), &amp;WSAData) != 0)
<a name="l09987"></a>09987          <span class="keywordflow">return</span>;
<a name="l09988"></a>09988    }
<a name="l09989"></a>09989 <span class="preprocessor">#endif</span>
<a name="l09990"></a>09990 <span class="preprocessor"></span>
<a name="l09991"></a>09991    <span class="comment">/* create a new socket */</span>
<a name="l09992"></a>09992    lsock = socket(AF_INET, SOCK_STREAM, 0);
<a name="l09993"></a>09993 
<a name="l09994"></a>09994    <span class="keywordflow">if</span> (lsock == -1) {
<a name="l09995"></a>09995       printf(<span class="stringliteral">&quot;Cannot create socket\n&quot;</span>);
<a name="l09996"></a>09996       <span class="keywordflow">return</span>;
<a name="l09997"></a>09997    }
<a name="l09998"></a>09998 
<a name="l09999"></a>09999    <span class="comment">/* bind local node name and port to socket */</span>
<a name="l10000"></a>10000    memset(&amp;bind_addr, 0, <span class="keyword">sizeof</span>(bind_addr));
<a name="l10001"></a>10001    bind_addr.sin_family = AF_INET;
<a name="l10002"></a>10002    bind_addr.sin_addr.s_addr = htonl(INADDR_ANY);
<a name="l10003"></a>10003    bind_addr.sin_port = htons((<span class="keywordtype">short</span>) <a class="code" href="mhttpd_8c.html#aa9edbe9dd2977e5cc56138a3a05f7a98">tcp_port</a>);
<a name="l10004"></a>10004 
<a name="l10005"></a>10005    <span class="comment">/* try reusing address */</span>
<a name="l10006"></a>10006    flag = 1;
<a name="l10007"></a>10007    setsockopt(lsock, SOL_SOCKET, SO_REUSEADDR, (<span class="keywordtype">char</span> *) &amp;flag, <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>));
<a name="l10008"></a>10008    status = bind(lsock, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, <span class="keyword">sizeof</span>(bind_addr));
<a name="l10009"></a>10009 
<a name="l10010"></a>10010    <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l10011"></a>10011       printf
<a name="l10012"></a>10012           (<span class="stringliteral">&quot;Cannot bind to port %d.\nPlease try later or use the \&quot;-p\&quot; flag to specify a different port\n&quot;</span>,
<a name="l10013"></a>10013            <a class="code" href="mhttpd_8c.html#aa9edbe9dd2977e5cc56138a3a05f7a98">tcp_port</a>);
<a name="l10014"></a>10014       <span class="keywordflow">return</span>;
<a name="l10015"></a>10015    }
<a name="l10016"></a>10016 
<a name="l10017"></a>10017    <span class="comment">/* get host name for mail notification */</span>
<a name="l10018"></a>10018    gethostname(<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>, <span class="keyword">sizeof</span>(<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>));
<a name="l10019"></a>10019 
<a name="l10020"></a>10020    phe = gethostbyname(<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>);
<a name="l10021"></a>10021    <span class="keywordflow">if</span> (phe != NULL)
<a name="l10022"></a>10022       phe = gethostbyaddr(phe-&gt;h_addr, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), AF_INET);
<a name="l10023"></a>10023 
<a name="l10024"></a>10024    <span class="comment">/* if domain name is not in host name, hope to get it from phe */</span>
<a name="l10025"></a>10025    <span class="keywordflow">if</span> (strchr(<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>, <span class="charliteral">&apos;.&apos;</span>) == NULL)
<a name="l10026"></a>10026       strcpy(<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>, phe-&gt;h_name);
<a name="l10027"></a>10027 
<a name="l10028"></a>10028 <span class="preprocessor">#ifdef OS_UNIX</span>
<a name="l10029"></a>10029 <span class="preprocessor"></span>   <span class="comment">/* give up root privilege */</span>
<a name="l10030"></a>10030    setuid(getuid());
<a name="l10031"></a>10031    setgid(getgid());
<a name="l10032"></a>10032 <span class="preprocessor">#endif</span>
<a name="l10033"></a>10033 <span class="preprocessor"></span>
<a name="l10034"></a>10034    <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#a96203468e98720f55cbede5bb1f8cffe">daemon</a>) {
<a name="l10035"></a>10035       printf(<span class="stringliteral">&quot;Becoming a daemon...\n&quot;</span>);
<a name="l10036"></a>10036       <a class="code" href="group__msystemincludecode.html#ga957613d29ce8b6e66f075ace4f32c1e1">ss_daemon_init</a>(<a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l10037"></a>10037    }
<a name="l10038"></a>10038 
<a name="l10039"></a>10039    <span class="comment">/* listen for connection */</span>
<a name="l10040"></a>10040    status = listen(lsock, SOMAXCONN);
<a name="l10041"></a>10041    <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l10042"></a>10042       printf(<span class="stringliteral">&quot;Cannot listen\n&quot;</span>);
<a name="l10043"></a>10043       <span class="keywordflow">return</span>;
<a name="l10044"></a>10044    }
<a name="l10045"></a>10045 
<a name="l10046"></a>10046    printf(<span class="stringliteral">&quot;Server listening...\n&quot;</span>);
<a name="l10047"></a>10047    <span class="keywordflow">do</span> {
<a name="l10048"></a>10048       FD_ZERO(&amp;readfds);
<a name="l10049"></a>10049       FD_SET(lsock, &amp;readfds);
<a name="l10050"></a>10050 
<a name="l10051"></a>10051       <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>.tv_sec = 0;
<a name="l10052"></a>10052       <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>.tv_usec = 100000;
<a name="l10053"></a>10053 
<a name="l10054"></a>10054 <span class="preprocessor">#ifdef OS_UNIX</span>
<a name="l10055"></a>10055 <span class="preprocessor"></span>      <span class="keywordflow">do</span> {
<a name="l10056"></a>10056          status = select(<a class="code" href="group__msystemincludecode.html#ga86c5dbf5a99358e288f573d6a1e0873f">FD_SETSIZE</a>, (<span class="keywordtype">void</span> *) &amp;readfds, NULL, NULL, (<span class="keywordtype">void</span> *) &amp;<a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>);
<a name="l10057"></a>10057          <span class="comment">/* if an alarm signal was cought, restart with reduced timeout */</span>
<a name="l10058"></a>10058       } <span class="keywordflow">while</span> (status == -1 &amp;&amp; errno == EINTR);
<a name="l10059"></a>10059 <span class="preprocessor">#else</span>
<a name="l10060"></a>10060 <span class="preprocessor"></span>      status = select(<a class="code" href="group__msystemincludecode.html#ga86c5dbf5a99358e288f573d6a1e0873f">FD_SETSIZE</a>, (<span class="keywordtype">void</span> *) &amp;readfds, NULL, NULL, (<span class="keywordtype">void</span> *) &amp;<a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>);
<a name="l10061"></a>10061 <span class="preprocessor">#endif</span>
<a name="l10062"></a>10062 <span class="preprocessor"></span>
<a name="l10063"></a>10063       <span class="keywordflow">if</span> (FD_ISSET(lsock, &amp;readfds)) {
<a name="l10064"></a>10064          len = <span class="keyword">sizeof</span>(acc_addr);
<a name="l10065"></a>10065          <a class="code" href="mhttpd_8c.html#a22283e600d5dd8c6c363cccd5adc2529">_sock</a> = accept(lsock, (<span class="keyword">struct</span> sockaddr *) &amp;acc_addr, &amp;len);
<a name="l10066"></a>10066 
<a name="l10067"></a>10067          last_time = (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>();
<a name="l10068"></a>10068 
<a name="l10069"></a>10069          <span class="comment">/* turn on lingering (borrowed from NCSA httpd code) */</span>
<a name="l10070"></a>10070 
<a name="l10071"></a>10071          <span class="comment">/* outcommented, gave occasional hangups on Linux</span>
<a name="l10072"></a>10072 <span class="comment">            ling.l_onoff = 1;</span>
<a name="l10073"></a>10073 <span class="comment">            ling.l_linger = 6;</span>
<a name="l10074"></a>10074 <span class="comment">            setsockopt(_sock, SOL_SOCKET, SO_LINGER, (char *) &amp;ling, sizeof(ling));</span>
<a name="l10075"></a>10075 <span class="comment">          */</span>
<a name="l10076"></a>10076 
<a name="l10077"></a>10077          <span class="comment">/* save remote host address */</span>
<a name="l10078"></a>10078          memcpy(&amp;<a class="code" href="mhttpd_8c.html#ae4c6d44dc33d45aceef3c6b589414715">remote_addr</a>, &amp;(acc_addr.sin_addr), <span class="keyword">sizeof</span>(<a class="code" href="mhttpd_8c.html#ae4c6d44dc33d45aceef3c6b589414715">remote_addr</a>));
<a name="l10079"></a>10079 
<a name="l10080"></a>10080          memset(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>));
<a name="l10081"></a>10081          len = 0;
<a name="l10082"></a>10082          header_length = 0;
<a name="l10083"></a>10083          content_length = 0;
<a name="l10084"></a>10084          n_error = 0;
<a name="l10085"></a>10085          <span class="keywordflow">do</span> {
<a name="l10086"></a>10086             FD_ZERO(&amp;readfds);
<a name="l10087"></a>10087             FD_SET(<a class="code" href="mhttpd_8c.html#a22283e600d5dd8c6c363cccd5adc2529">_sock</a>, &amp;readfds);
<a name="l10088"></a>10088 
<a name="l10089"></a>10089             <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>.tv_sec = 6;
<a name="l10090"></a>10090             <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>.tv_usec = 0;
<a name="l10091"></a>10091 
<a name="l10092"></a>10092 <span class="preprocessor">#ifdef OS_UNIX</span>
<a name="l10093"></a>10093 <span class="preprocessor"></span>            <span class="keywordflow">do</span> {
<a name="l10094"></a>10094                status =
<a name="l10095"></a>10095                    select(<a class="code" href="group__msystemincludecode.html#ga86c5dbf5a99358e288f573d6a1e0873f">FD_SETSIZE</a>, (<span class="keywordtype">void</span> *) &amp;readfds, NULL, NULL, (<span class="keywordtype">void</span> *) &amp;<a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>);
<a name="l10096"></a>10096                <span class="comment">/* if an alarm signal was cought, restart with reduced timeout */</span>
<a name="l10097"></a>10097             } <span class="keywordflow">while</span> (status == -1 &amp;&amp; errno == EINTR);
<a name="l10098"></a>10098 <span class="preprocessor">#else</span>
<a name="l10099"></a>10099 <span class="preprocessor"></span>            status = select(<a class="code" href="group__msystemincludecode.html#ga86c5dbf5a99358e288f573d6a1e0873f">FD_SETSIZE</a>, (<span class="keywordtype">void</span> *) &amp;readfds, NULL, NULL, (<span class="keywordtype">void</span> *) &amp;<a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>);
<a name="l10100"></a>10100 <span class="preprocessor">#endif</span>
<a name="l10101"></a>10101 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (FD_ISSET(<a class="code" href="mhttpd_8c.html#a22283e600d5dd8c6c363cccd5adc2529">_sock</a>, &amp;readfds))
<a name="l10102"></a>10102                i = recv(<a class="code" href="mhttpd_8c.html#a22283e600d5dd8c6c363cccd5adc2529">_sock</a>, <a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a> + len, <span class="keyword">sizeof</span>(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>) - len, 0);
<a name="l10103"></a>10103             <span class="keywordflow">else</span>
<a name="l10104"></a>10104                <span class="keywordflow">goto</span> error;
<a name="l10105"></a>10105 
<a name="l10106"></a>10106             <span class="comment">/* abort if connection got broken */</span>
<a name="l10107"></a>10107             <span class="keywordflow">if</span> (i &lt; 0)
<a name="l10108"></a>10108                <span class="keywordflow">goto</span> error;
<a name="l10109"></a>10109 
<a name="l10110"></a>10110             <span class="keywordflow">if</span> (i &gt; 0)
<a name="l10111"></a>10111                len += i;
<a name="l10112"></a>10112 
<a name="l10113"></a>10113             <span class="comment">/* check if net_buffer too small */</span>
<a name="l10114"></a>10114             <span class="keywordflow">if</span> (len &gt;= <span class="keyword">sizeof</span>(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>)) {
<a name="l10115"></a>10115                <span class="comment">/* drain incoming remaining data */</span>
<a name="l10116"></a>10116                <span class="keywordflow">do</span> {
<a name="l10117"></a>10117                   FD_ZERO(&amp;readfds);
<a name="l10118"></a>10118                   FD_SET(<a class="code" href="mhttpd_8c.html#a22283e600d5dd8c6c363cccd5adc2529">_sock</a>, &amp;readfds);
<a name="l10119"></a>10119 
<a name="l10120"></a>10120                   <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>.tv_sec = 2;
<a name="l10121"></a>10121                   <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>.tv_usec = 0;
<a name="l10122"></a>10122 
<a name="l10123"></a>10123                   status =
<a name="l10124"></a>10124                       select(<a class="code" href="group__msystemincludecode.html#ga86c5dbf5a99358e288f573d6a1e0873f">FD_SETSIZE</a>, (<span class="keywordtype">void</span> *) &amp;readfds, NULL, NULL,
<a name="l10125"></a>10125                              (<span class="keywordtype">void</span> *) &amp;<a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>);
<a name="l10126"></a>10126 
<a name="l10127"></a>10127                   <span class="keywordflow">if</span> (FD_ISSET(<a class="code" href="mhttpd_8c.html#a22283e600d5dd8c6c363cccd5adc2529">_sock</a>, &amp;readfds))
<a name="l10128"></a>10128                      i = recv(<a class="code" href="mhttpd_8c.html#a22283e600d5dd8c6c363cccd5adc2529">_sock</a>, <a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="keyword">sizeof</span>(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>), 0);
<a name="l10129"></a>10129                   <span class="keywordflow">else</span>
<a name="l10130"></a>10130                      <span class="keywordflow">break</span>;
<a name="l10131"></a>10131                } <span class="keywordflow">while</span> (i);
<a name="l10132"></a>10132 
<a name="l10133"></a>10133                memset(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>));
<a name="l10134"></a>10134                <a class="code" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a> = 0;
<a name="l10135"></a>10135                <a class="code" href="mhttpd_8c.html#a518fedf43db3f1313f9c88b2009380b5">return_length</a> = 0;
<a name="l10136"></a>10136 
<a name="l10137"></a>10137                <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>
<a name="l10138"></a>10138                    (<span class="stringliteral">&quot;Submitted attachment too large, please increase WEB_BUFFER_SIZE in mhttpd.c and recompile&quot;</span>);
<a name="l10139"></a>10139                <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(<a class="code" href="mhttpd_8c.html#a22283e600d5dd8c6c363cccd5adc2529">_sock</a>, <a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>, <a class="code" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a> + 1, 0);
<a name="l10140"></a>10140                <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) {
<a name="l10141"></a>10141                   printf(<span class="stringliteral">&quot;==== Return ================================\n&quot;</span>);
<a name="l10142"></a>10142                   puts(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>);
<a name="l10143"></a>10143                   printf(<span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l10144"></a>10144                }
<a name="l10145"></a>10145                <span class="keywordflow">goto</span> error;
<a name="l10146"></a>10146             }
<a name="l10147"></a>10147 
<a name="l10148"></a>10148             <span class="keywordflow">if</span> (i == 0) {
<a name="l10149"></a>10149                n_error++;
<a name="l10150"></a>10150                <span class="keywordflow">if</span> (n_error == 100)
<a name="l10151"></a>10151                   <span class="keywordflow">goto</span> error;
<a name="l10152"></a>10152             }
<a name="l10153"></a>10153 
<a name="l10154"></a>10154             <span class="comment">/* finish when empty line received */</span>
<a name="l10155"></a>10155             <span class="keywordflow">if</span> (strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;GET&quot;</span>) != NULL &amp;&amp; strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;POST&quot;</span>) == NULL) {
<a name="l10156"></a>10156                <span class="keywordflow">if</span> (len &gt; 4 &amp;&amp; strcmp(&amp;<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>[len - 4], <span class="stringliteral">&quot;\r\n\r\n&quot;</span>) == 0)
<a name="l10157"></a>10157                   <span class="keywordflow">break</span>;
<a name="l10158"></a>10158                <span class="keywordflow">if</span> (len &gt; 6 &amp;&amp; strcmp(&amp;<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>[len - 6], <span class="stringliteral">&quot;\r\r\n\r\r\n&quot;</span>) == 0)
<a name="l10159"></a>10159                   <span class="keywordflow">break</span>;
<a name="l10160"></a>10160             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;POST&quot;</span>) != NULL) {
<a name="l10161"></a>10161                <span class="keywordflow">if</span> (header_length == 0) {
<a name="l10162"></a>10162                   <span class="comment">/* extract header and content length */</span>
<a name="l10163"></a>10163                   <span class="keywordflow">if</span> (strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;Content-Length:&quot;</span>))
<a name="l10164"></a>10164                      content_length = atoi(strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;Content-Length:&quot;</span>) + 15);
<a name="l10165"></a>10165                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;Content-length:&quot;</span>))
<a name="l10166"></a>10166                      content_length = atoi(strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;Content-length:&quot;</span>) + 15);
<a name="l10167"></a>10167 
<a name="l10168"></a>10168                   boundary[0] = 0;
<a name="l10169"></a>10169                   <span class="keywordflow">if</span> (strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;boundary=&quot;</span>)) {
<a name="l10170"></a>10170                      strncpy(boundary, strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;boundary=&quot;</span>) + 9,
<a name="l10171"></a>10171                              <span class="keyword">sizeof</span>(boundary));
<a name="l10172"></a>10172                      <span class="keywordflow">if</span> (strchr(boundary, <span class="charliteral">&apos;\r&apos;</span>))
<a name="l10173"></a>10173                         *strchr(boundary, <span class="charliteral">&apos;\r&apos;</span>) = 0;
<a name="l10174"></a>10174                   }
<a name="l10175"></a>10175 
<a name="l10176"></a>10176                   <span class="keywordflow">if</span> (strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;\r\n\r\n&quot;</span>))
<a name="l10177"></a>10177                      header_length =
<a name="l10178"></a>10178                          (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;\r\n\r\n&quot;</span>) - (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a> + 4;
<a name="l10179"></a>10179 
<a name="l10180"></a>10180                   <span class="keywordflow">if</span> (strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;\r\r\n\r\r\n&quot;</span>))
<a name="l10181"></a>10181                      header_length =
<a name="l10182"></a>10182                          (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;\r\r\n\r\r\n&quot;</span>) - (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a> + 6;
<a name="l10183"></a>10183 
<a name="l10184"></a>10184                   <span class="keywordflow">if</span> (header_length)
<a name="l10185"></a>10185                      <a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>[header_length - 1] = 0;
<a name="l10186"></a>10186                }
<a name="l10187"></a>10187 
<a name="l10188"></a>10188                <span class="keywordflow">if</span> (header_length &gt; 0 &amp;&amp; len &gt;= header_length + content_length)
<a name="l10189"></a>10189                   <span class="keywordflow">break</span>;
<a name="l10190"></a>10190             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;OPTIONS&quot;</span>) != NULL)
<a name="l10191"></a>10191                <span class="keywordflow">goto</span> error;
<a name="l10192"></a>10192             <span class="keywordflow">else</span> {
<a name="l10193"></a>10193                printf(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>);
<a name="l10194"></a>10194                <span class="keywordflow">goto</span> error;
<a name="l10195"></a>10195             }
<a name="l10196"></a>10196 
<a name="l10197"></a>10197          } <span class="keywordflow">while</span> (1);
<a name="l10198"></a>10198 
<a name="l10199"></a>10199          <span class="keywordflow">if</span> (!strchr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="charliteral">&apos;\r&apos;</span>))
<a name="l10200"></a>10200             <span class="keywordflow">goto</span> error;
<a name="l10201"></a>10201 
<a name="l10202"></a>10202          <span class="comment">/* extract cookies */</span>
<a name="l10203"></a>10203          cookie_pwd[0] = 0;
<a name="l10204"></a>10204          cookie_wpwd[0] = 0;
<a name="l10205"></a>10205          <span class="keywordflow">if</span> (strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;midas_pwd=&quot;</span>) != NULL) {
<a name="l10206"></a>10206             strcpy(cookie_pwd, strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;midas_pwd=&quot;</span>) + 10);
<a name="l10207"></a>10207             cookie_pwd[strcspn(cookie_pwd, <span class="stringliteral">&quot; ;\r\n&quot;</span>)] = 0;
<a name="l10208"></a>10208          }
<a name="l10209"></a>10209          <span class="keywordflow">if</span> (strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;midas_wpwd=&quot;</span>) != NULL) {
<a name="l10210"></a>10210             strcpy(cookie_wpwd, strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;midas_wpwd=&quot;</span>) + 11);
<a name="l10211"></a>10211             cookie_wpwd[strcspn(cookie_wpwd, <span class="stringliteral">&quot; ;\r\n&quot;</span>)] = 0;
<a name="l10212"></a>10212          }
<a name="l10213"></a>10213 
<a name="l10214"></a>10214          refresh = 0;
<a name="l10215"></a>10215          <span class="keywordflow">if</span> (strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;midas_refr=&quot;</span>) != NULL)
<a name="l10216"></a>10216             refresh = atoi(strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;midas_refr=&quot;</span>) + 11);
<a name="l10217"></a>10217          <span class="keywordflow">else</span>
<a name="l10218"></a>10218             refresh = <a class="code" href="mhttpd_8c.html#a593d451015ade21d031d33c32d55afff">DEFAULT_REFRESH</a>;
<a name="l10219"></a>10219 
<a name="l10220"></a>10220          memset(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>));
<a name="l10221"></a>10221          <a class="code" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a> = 0;
<a name="l10222"></a>10222 
<a name="l10223"></a>10223          <span class="keywordflow">if</span> (strncmp(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;GET&quot;</span>, 3) != 0 &amp;&amp; strncmp(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;POST&quot;</span>, 4) != 0)
<a name="l10224"></a>10224             <span class="keywordflow">goto</span> error;
<a name="l10225"></a>10225 
<a name="l10226"></a>10226          <a class="code" href="mhttpd_8c.html#a518fedf43db3f1313f9c88b2009380b5">return_length</a> = 0;
<a name="l10227"></a>10227 
<a name="l10228"></a>10228          <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>)
<a name="l10229"></a>10229             printf(<span class="stringliteral">&quot;\n%s\n&quot;</span>, <a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>);
<a name="l10230"></a>10230 
<a name="l10231"></a>10231          <span class="keywordflow">if</span> (strncmp(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;GET&quot;</span>, 3) == 0) {
<a name="l10232"></a>10232             <span class="comment">/* extract path and commands */</span>
<a name="l10233"></a>10233             *strchr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="charliteral">&apos;\r&apos;</span>) = 0;
<a name="l10234"></a>10234 
<a name="l10235"></a>10235             <span class="keywordflow">if</span> (!strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;HTTP&quot;</span>))
<a name="l10236"></a>10236                <span class="keywordflow">goto</span> error;
<a name="l10237"></a>10237             *(strstr(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>, <span class="stringliteral">&quot;HTTP&quot;</span>) - 1) = 0;
<a name="l10238"></a>10238 
<a name="l10239"></a>10239             <span class="comment">/* decode command and return answer */</span>
<a name="l10240"></a>10240             <a class="code" href="mhttpd_8c.html#aaddf7ad60b9dae7dc77b918cf2a8f237">decode_get</a>(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a> + 4, cookie_pwd, cookie_wpwd, refresh);
<a name="l10241"></a>10241          } <span class="keywordflow">else</span> {
<a name="l10242"></a>10242             <a class="code" href="mhttpd_8c.html#adc4d5a162cde09d0bf6521469eca7dd3">decode_post</a>(<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a> + 5, <a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a> + header_length, boundary,
<a name="l10243"></a>10243                         content_length, cookie_pwd, cookie_wpwd, refresh);
<a name="l10244"></a>10244          }
<a name="l10245"></a>10245 
<a name="l10246"></a>10246          <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#a518fedf43db3f1313f9c88b2009380b5">return_length</a> != -1) {
<a name="l10247"></a>10247             <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#a518fedf43db3f1313f9c88b2009380b5">return_length</a> == 0)
<a name="l10248"></a>10248                <a class="code" href="mhttpd_8c.html#a518fedf43db3f1313f9c88b2009380b5">return_length</a> = strlen(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>) + 1;
<a name="l10249"></a>10249 
<a name="l10250"></a>10250             <span class="keywordflow">if</span> (<a class="code" href="overall_8cpp.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) {
<a name="l10251"></a>10251                printf(<span class="stringliteral">&quot;==== Return ================================\n&quot;</span>);
<a name="l10252"></a>10252                puts(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>);
<a name="l10253"></a>10253                printf(<span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l10254"></a>10254             }
<a name="l10255"></a>10255 
<a name="l10256"></a>10256             i = <a class="code" href="group__msystemincludecode.html#gae657f73f38c098645aab383053478d59">send_tcp</a>(<a class="code" href="mhttpd_8c.html#a22283e600d5dd8c6c363cccd5adc2529">_sock</a>, <a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>, <a class="code" href="mhttpd_8c.html#a518fedf43db3f1313f9c88b2009380b5">return_length</a>, 0);
<a name="l10257"></a>10257             <span class="keywordflow">if</span> (i != <a class="code" href="mhttpd_8c.html#a518fedf43db3f1313f9c88b2009380b5">return_length</a>)
<a name="l10258"></a>10258                <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;server_loope&quot;</span>, <span class="stringliteral">&quot;Only sent back %d out of %d bytes&quot;</span>, i,
<a name="l10259"></a>10259                       <a class="code" href="mhttpd_8c.html#a518fedf43db3f1313f9c88b2009380b5">return_length</a>);
<a name="l10260"></a>10260 
<a name="l10261"></a>10261           error:
<a name="l10262"></a>10262 
<a name="l10263"></a>10263             <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="mhttpd_8c.html#a22283e600d5dd8c6c363cccd5adc2529">_sock</a>);
<a name="l10264"></a>10264          }
<a name="l10265"></a>10265       }
<a name="l10266"></a>10266 
<a name="l10267"></a>10267       <span class="comment">/* re-establish ctrl-c handler */</span>
<a name="l10268"></a>10268       <a class="code" href="group__msectionh.html#gadee9625d56a73edbbf43595cde457e42">ss_ctrlc_handler</a>(<a class="code" href="mhttpd_8c.html#a5ace87cacf3af691fcc4e3c0fcee2457">ctrlc_handler</a>);
<a name="l10269"></a>10269 
<a name="l10270"></a>10270       <span class="comment">/* check if disconnect from experiment */</span>
<a name="l10271"></a>10271       <span class="keywordflow">if</span> ((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>() - last_time &gt; <a class="code" href="mhttpd_8c.html#aac223400fe4767d970ea758a4ab0c6be">CONNECT_TIME</a> &amp;&amp; <a class="code" href="mhttpd_8c.html#abc82b64a25110404c4a845a5e969b348">connected</a> &amp;&amp; !<a class="code" href="mhttpd_8c.html#a62893d3a883339864af5371490807e54">no_disconnect</a>) {
<a name="l10272"></a>10272          <a class="code" href="group__msectionh.html#ga9792ed24b1150464250ac794067c9196">cm_disconnect_experiment</a>();
<a name="l10273"></a>10273          <a class="code" href="mhttpd_8c.html#abc82b64a25110404c4a845a5e969b348">connected</a> = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l10274"></a>10274       }
<a name="l10275"></a>10275 
<a name="l10276"></a>10276       <span class="comment">/* check for shutdown message */</span>
<a name="l10277"></a>10277       <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#abc82b64a25110404c4a845a5e969b348">connected</a>) {
<a name="l10278"></a>10278          status = <a class="code" href="group__msectionh.html#gae234f64a7143ed2be1019e53613a6e85">cm_yield</a>(0);
<a name="l10279"></a>10279          <span class="keywordflow">if</span> (status == <a class="code" href="group__err25.html#ga0406ee07e8c5afbf8e46cb0eed698bcd">RPC_SHUTDOWN</a>) {
<a name="l10280"></a>10280             <a class="code" href="group__msectionh.html#ga9792ed24b1150464250ac794067c9196">cm_disconnect_experiment</a>();
<a name="l10281"></a>10281             <a class="code" href="mhttpd_8c.html#abc82b64a25110404c4a845a5e969b348">connected</a> = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l10282"></a>10282          }
<a name="l10283"></a>10283       }
<a name="l10284"></a>10284 
<a name="l10285"></a>10285    } <span class="keywordflow">while</span> (!<a class="code" href="mhttpd_8c.html#aacdbc1e91899f516cd3947ea81b373ac">_abort</a>);
<a name="l10286"></a>10286 
<a name="l10287"></a>10287    <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#abc82b64a25110404c4a845a5e969b348">connected</a>)
<a name="l10288"></a>10288       <a class="code" href="group__msectionh.html#ga9792ed24b1150464250ac794067c9196">cm_disconnect_experiment</a>();
<a name="l10289"></a>10289 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2956fb85032748af9fb7f544a4fb6c93"></a><!-- doxytag: member="mhttpd.c::setparam" ref="a2956fb85032748af9fb7f544a4fb6c93" args="(char *param, char *value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setparam </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01042">1042</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="experiment_2template_8c_source.html#l00070">_param</a>, <a class="el" href="mhttpd_8c_source.html#l00886">_text</a>, <a class="el" href="mhttpd_8c_source.html#l00885">_value</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mhttpd_8c_source.html#l00879">MAX_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00414">strlcpy()</a>, <a class="el" href="mhttpd_8c_source.html#l00882">TEXT_SIZE</a>, and <a class="el" href="mhttpd_8c_source.html#l00880">VALUE_SIZE</a>.</p>

<p>Referenced by <a class="el" href="webpaw_8c_source.html#l01259">decode()</a>, <a class="el" href="mhttpd_8c_source.html#l09800">decode_get()</a>, <a class="el" href="mhttpd_8c_source.html#l09841">decode_post()</a>, <a class="el" href="mhttpd_8c_source.html#l03805">submit_elog()</a>, and <a class="el" href="mhttpd_8c_source.html#l04034">submit_form()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01043"></a>01043 {
<a name="l01044"></a>01044    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l01045"></a>01045 
<a name="l01046"></a>01046    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>, <span class="stringliteral">&quot;text&quot;</span>)) {
<a name="l01047"></a>01047       <span class="keywordflow">if</span> (strlen(<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>) &gt;= <a class="code" href="mhttpd_8c.html#afb6f36d91ffbf947cfa3f1114ca79764">TEXT_SIZE</a>)
<a name="l01048"></a>01048          printf(<span class="stringliteral">&quot;Error: parameter value too big\n&quot;</span>);
<a name="l01049"></a>01049 
<a name="l01050"></a>01050       <a class="code" href="mscb_8c.html#a4637af6f79bac4043e1064f0837d0ddc">strlcpy</a>(<a class="code" href="mhttpd_8c.html#a81d95c442aeb0cc03e6fb077222a9a2b">_text</a>, <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <a class="code" href="mhttpd_8c.html#afb6f36d91ffbf947cfa3f1114ca79764">TEXT_SIZE</a>);
<a name="l01051"></a>01051       <a class="code" href="mhttpd_8c.html#a81d95c442aeb0cc03e6fb077222a9a2b">_text</a>[<a class="code" href="mhttpd_8c.html#afb6f36d91ffbf947cfa3f1114ca79764">TEXT_SIZE</a> - 1] = 0;
<a name="l01052"></a>01052       <span class="keywordflow">return</span>;
<a name="l01053"></a>01053    }
<a name="l01054"></a>01054 
<a name="l01055"></a>01055    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="mhttpd_8c.html#a5732be69f55a5dbbfa3df82d31314cb1">MAX_PARAM</a>; i++)
<a name="l01056"></a>01056       <span class="keywordflow">if</span> (<a class="code" href="experiment_2template_8c.html#afb3a768ad8339a2cefa693559a115d80">_param</a>[i][0] == 0)
<a name="l01057"></a>01057          <span class="keywordflow">break</span>;
<a name="l01058"></a>01058 
<a name="l01059"></a>01059    <span class="keywordflow">if</span> (i &lt; MAX_PARAM) {
<a name="l01060"></a>01060       strcpy(<a class="code" href="experiment_2template_8c.html#afb3a768ad8339a2cefa693559a115d80">_param</a>[i], <a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>);
<a name="l01061"></a>01061 
<a name="l01062"></a>01062       <span class="keywordflow">if</span> (strlen(<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>) &gt;= <a class="code" href="mhttpd_8c.html#a7109febe139a7277e20652049ec9a1e1">VALUE_SIZE</a>)
<a name="l01063"></a>01063          printf(<span class="stringliteral">&quot;Error: parameter value too big\n&quot;</span>);
<a name="l01064"></a>01064 
<a name="l01065"></a>01065       <a class="code" href="mscb_8c.html#a4637af6f79bac4043e1064f0837d0ddc">strlcpy</a>(<a class="code" href="mhttpd_8c.html#abcd78d8c212e69ce3b664c10cfabf5f6">_value</a>[i], <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <a class="code" href="mhttpd_8c.html#a7109febe139a7277e20652049ec9a1e1">VALUE_SIZE</a>);
<a name="l01066"></a>01066       <a class="code" href="mhttpd_8c.html#abcd78d8c212e69ce3b664c10cfabf5f6">_value</a>[i][<a class="code" href="mhttpd_8c.html#a7109febe139a7277e20652049ec9a1e1">VALUE_SIZE</a> - 1] = 0;
<a name="l01067"></a>01067    } <span class="keywordflow">else</span> {
<a name="l01068"></a>01068       printf(<span class="stringliteral">&quot;Error: parameter array too small\n&quot;</span>);
<a name="l01069"></a>01069    }
<a name="l01070"></a>01070 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a678e9238f0cdc3868dfdc4270f353dc1"></a><!-- doxytag: member="mhttpd.c::show_alarm_page" ref="a678e9238f0cdc3868dfdc4270f353dc1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_alarm_page </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l06375">6375</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l15975">al_evaluate_condition()</a>, <a class="el" href="midas_8h_source.html#l01647">AT_EVALUATED</a>, <a class="el" href="midas_8h_source.html#l01645">AT_INTERNAL</a>, <a class="el" href="midas_8h_source.html#l01649">AT_LAST</a>, <a class="el" href="midas_8h_source.html#l01648">AT_PERIODIC</a>, <a class="el" href="midas_8h_source.html#l01646">AT_PROGRAM</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="odb_8c_source.html#l03128">db_set_value()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="mscbutil_8c_source.html#l00654">interval</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="MFastSlowCorrelator_8cpp_source.html#l00063">last</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="system_8c_source.html#l02332">ss_time()</a>, <a class="el" href="mhttpd_8c_source.html#l02421">strencode()</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, <a class="el" href="midas_8h_source.html#l00740">TID_DWORD</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, <a class="el" href="mana_8cpp_source.html#l00675">type</a>, and <a class="el" href="ADCS_8h_source.html#l00004">value</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06376"></a>06376 {
<a name="l06377"></a>06377    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, triggered, <a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, ai;
<a name="l06378"></a>06378    <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> active;
<a name="l06379"></a>06379    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkeyroot, hkey;
<a name="l06380"></a>06380    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l06381"></a>06381    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], ref[256], condition[256], <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>[256];
<a name="l06382"></a>06382    time_t now, <a class="code" href="MFastSlowCorrelator_8cpp.html#a3579fbbede9d99d8d4aafc118b3abed3">last</a>, <a class="code" href="mscbutil_8c.html#ad856acfe9ce335571b00a73df5e23e6b">interval</a>;
<a name="l06383"></a>06383    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> al_list[] = { <a class="code" href="group__malarmh.html#gabd367ea3feeb6b3fe27aaf45e9a067f6">AT_EVALUATED</a>, <a class="code" href="group__malarmh.html#ga258ba8c74f1f017cc80ef51fa82e3e13">AT_PROGRAM</a>, <a class="code" href="group__malarmh.html#ga0aecd2654d62ebd6b3d8d57ef8ccf2d9">AT_INTERNAL</a>, <a class="code" href="group__malarmh.html#ga40d5f5ba688496ddaa6f12e9a9b9f956">AT_PERIODIC</a> };
<a name="l06384"></a>06384 
<a name="l06385"></a>06385    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l06386"></a>06386 
<a name="l06387"></a>06387    <span class="comment">/* header */</span>
<a name="l06388"></a>06388    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l06389"></a>06389    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l06390"></a>06390    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l06391"></a>06391 
<a name="l06392"></a>06392    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;\n&quot;</span>);
<a name="l06393"></a>06393    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;title&gt;Alarms&lt;/title&gt;&lt;/head&gt;\n&quot;</span>);
<a name="l06394"></a>06394    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;body&gt;\n&quot;</span>);
<a name="l06395"></a>06395 
<a name="l06396"></a>06396    <span class="comment">/* title row */</span>
<a name="l06397"></a>06397    size = <span class="keyword">sizeof</span>(str);
<a name="l06398"></a>06398    str[0] = 0;
<a name="l06399"></a>06399    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Name&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06400"></a>06400    <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l06401"></a>06401 
<a name="l06402"></a>06402    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;form method=\&quot;GET\&quot; action=\&quot;/\&quot;&gt;\n&quot;</span>);
<a name="l06403"></a>06403 
<a name="l06404"></a>06404    <span class="comment">/* define hidden field for experiment */</span>
<a name="l06405"></a>06405    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l06406"></a>06406       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=exp value=\&quot;%s\&quot;&gt;\n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l06407"></a>06407 
<a name="l06408"></a>06408    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;table border=3 cellpadding=2&gt;\n&quot;</span>);
<a name="l06409"></a>06409    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th colspan=4 bgcolor=#A0A0FF&gt;MIDAS experiment \&quot;%s\&quot;&quot;</span>, str);
<a name="l06410"></a>06410    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th colspan=3 bgcolor=#A0A0FF&gt;%s&lt;/tr&gt;\n&quot;</span>, ctime(&amp;now));
<a name="l06411"></a>06411 
<a name="l06412"></a>06412   <span class="comment">/*---- menu buttons ----*/</span>
<a name="l06413"></a>06413 
<a name="l06414"></a>06414    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;\n&quot;</span>);
<a name="l06415"></a>06415    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=7 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l06416"></a>06416 
<a name="l06417"></a>06417    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;Reset all alarms\&quot;&gt;\n&quot;</span>);
<a name="l06418"></a>06418    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;Alarms on/off\&quot;&gt;\n&quot;</span>);
<a name="l06419"></a>06419    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Status&gt;\n&quot;</span>);
<a name="l06420"></a>06420 
<a name="l06421"></a>06421    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;&lt;/form&gt;\n\n&quot;</span>);
<a name="l06422"></a>06422 
<a name="l06423"></a>06423   <span class="comment">/*---- global flag ----*/</span>
<a name="l06424"></a>06424 
<a name="l06425"></a>06425    active = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l06426"></a>06426    size = <span class="keyword">sizeof</span>(active);
<a name="l06427"></a>06427    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Alarms/Alarm System active&quot;</span>, &amp;active, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06428"></a>06428    <span class="keywordflow">if</span> (!active) {
<a name="l06429"></a>06429       <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l06430"></a>06430          sprintf(ref, <span class="stringliteral">&quot;/Alarms/Alarm System active?cmd=set&amp;exp=%s&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l06431"></a>06431       <span class="keywordflow">else</span>
<a name="l06432"></a>06432          sprintf(ref, <span class="stringliteral">&quot;/Alarms/Alarm System active?cmd=set&quot;</span>);
<a name="l06433"></a>06433       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l06434"></a>06434           (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=center colspan=7 bgcolor=#FFC0C0&gt;&lt;a href=\&quot;%s\&quot;&gt;&lt;h1&gt;Alarm system disabled&lt;/h1&gt;&lt;/a&gt;&lt;/tr&gt;&quot;</span>,
<a name="l06435"></a>06435            ref);
<a name="l06436"></a>06436    }
<a name="l06437"></a>06437 
<a name="l06438"></a>06438   <span class="comment">/*---- alarms ----*/</span>
<a name="l06439"></a>06439 
<a name="l06440"></a>06440    <span class="keywordflow">for</span> (ai = 0; ai &lt; <a class="code" href="group__malarmh.html#ga5f102004d1642b0878502f7a6a05fdfa">AT_LAST</a>; ai++) {
<a name="l06441"></a>06441       index = al_list[ai];
<a name="l06442"></a>06442 
<a name="l06443"></a>06443       <span class="keywordflow">if</span> (index == <a class="code" href="group__malarmh.html#gabd367ea3feeb6b3fe27aaf45e9a067f6">AT_EVALUATED</a>) {
<a name="l06444"></a>06444          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l06445"></a>06445              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;th align=center colspan=7 bgcolor=#C0C0C0&gt;Evaluated alarms&lt;/tr&gt;\n&quot;</span>);
<a name="l06446"></a>06446          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l06447"></a>06447              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;th&gt;Alarm&lt;th&gt;State&lt;th&gt;First triggered&lt;th&gt;Class&lt;th&gt;Condition&lt;th&gt;Current value&lt;th&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l06448"></a>06448       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index == <a class="code" href="group__malarmh.html#ga258ba8c74f1f017cc80ef51fa82e3e13">AT_PROGRAM</a>) {
<a name="l06449"></a>06449          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th align=center colspan=7 bgcolor=#C0C0C0&gt;Program alarms&lt;/tr&gt;\n&quot;</span>);
<a name="l06450"></a>06450          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l06451"></a>06451              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;th&gt;Alarm&lt;th&gt;State&lt;th&gt;First triggered&lt;th&gt;Class&lt;th colspan=2&gt;Condition&lt;th&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l06452"></a>06452       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index == <a class="code" href="group__malarmh.html#ga0aecd2654d62ebd6b3d8d57ef8ccf2d9">AT_INTERNAL</a>) {
<a name="l06453"></a>06453          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l06454"></a>06454              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;th align=center colspan=7 bgcolor=#C0C0C0&gt;Internal alarms&lt;/tr&gt;\n&quot;</span>);
<a name="l06455"></a>06455          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l06456"></a>06456              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;th&gt;Alarm&lt;th&gt;State&lt;th&gt;First triggered&lt;th&gt;Class&lt;th colspan=2&gt;Condition/Message&lt;th&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l06457"></a>06457       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index == <a class="code" href="group__malarmh.html#ga40d5f5ba688496ddaa6f12e9a9b9f956">AT_PERIODIC</a>) {
<a name="l06458"></a>06458          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l06459"></a>06459              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;th align=center colspan=7 bgcolor=#C0C0C0&gt;Periodic alarms&lt;/tr&gt;\n&quot;</span>);
<a name="l06460"></a>06460          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l06461"></a>06461              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;th&gt;Alarm&lt;th&gt;State&lt;th&gt;First triggered&lt;th&gt;Class&lt;th colspan=2&gt;Time/Message&lt;th&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l06462"></a>06462       }
<a name="l06463"></a>06463 
<a name="l06464"></a>06464       <span class="comment">/* go through all alarms */</span>
<a name="l06465"></a>06465       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Alarms/Alarms&quot;</span>, &amp;hkeyroot);
<a name="l06466"></a>06466       <span class="keywordflow">if</span> (hkeyroot) {
<a name="l06467"></a>06467          <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l06468"></a>06468             <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyroot, i, &amp;hkey);
<a name="l06469"></a>06469 
<a name="l06470"></a>06470             <span class="keywordflow">if</span> (!hkey)
<a name="l06471"></a>06471                <span class="keywordflow">break</span>;
<a name="l06472"></a>06472 
<a name="l06473"></a>06473             <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l06474"></a>06474 
<a name="l06475"></a>06475             <span class="comment">/* type */</span>
<a name="l06476"></a>06476             size = <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>);
<a name="l06477"></a>06477             <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkey, <span class="stringliteral">&quot;Type&quot;</span>, &amp;type, &amp;size, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06478"></a>06478             <span class="keywordflow">if</span> (type != index)
<a name="l06479"></a>06479                <span class="keywordflow">continue</span>;
<a name="l06480"></a>06480 
<a name="l06481"></a>06481             <span class="comment">/* start form for each alarm to make &quot;reset&quot; button work */</span>
<a name="l06482"></a>06482             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l06483"></a>06483                sprintf(ref, <span class="stringliteral">&quot;/%s?exp=%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l06484"></a>06484             <span class="keywordflow">else</span>
<a name="l06485"></a>06485                sprintf(ref, <span class="stringliteral">&quot;/%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l06486"></a>06486 
<a name="l06487"></a>06487             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;form method=\&quot;GET\&quot; action=\&quot;%s\&quot;&gt;\n&quot;</span>, ref);
<a name="l06488"></a>06488 
<a name="l06489"></a>06489             <span class="comment">/* alarm name */</span>
<a name="l06490"></a>06490             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l06491"></a>06491                sprintf(ref, <span class="stringliteral">&quot;/Alarms/Alarms/%s?exp=%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l06492"></a>06492             <span class="keywordflow">else</span>
<a name="l06493"></a>06493                sprintf(ref, <span class="stringliteral">&quot;/Alarms/Alarms/%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l06494"></a>06494 
<a name="l06495"></a>06495             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#C0C0FF&gt;&lt;a href=\&quot;%s\&quot;&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/a&gt;&quot;</span>, ref,
<a name="l06496"></a>06496                      key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l06497"></a>06497 
<a name="l06498"></a>06498             <span class="comment">/* state */</span>
<a name="l06499"></a>06499             size = <span class="keyword">sizeof</span>(<a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>);
<a name="l06500"></a>06500             <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkey, <span class="stringliteral">&quot;Active&quot;</span>, &amp;active, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06501"></a>06501             size = <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>);
<a name="l06502"></a>06502             <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkey, <span class="stringliteral">&quot;Triggered&quot;</span>, &amp;triggered, &amp;size, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06503"></a>06503             <span class="keywordflow">if</span> (!active)
<a name="l06504"></a>06504                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#FFFF00 align=center&gt;Disabled&quot;</span>);
<a name="l06505"></a>06505             <span class="keywordflow">else</span> {
<a name="l06506"></a>06506                <span class="keywordflow">if</span> (!triggered)
<a name="l06507"></a>06507                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#00FF00 align=center&gt;OK&quot;</span>);
<a name="l06508"></a>06508                <span class="keywordflow">else</span>
<a name="l06509"></a>06509                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#FF0000 align=center&gt;Triggered&quot;</span>);
<a name="l06510"></a>06510             }
<a name="l06511"></a>06511 
<a name="l06512"></a>06512             <span class="comment">/* time */</span>
<a name="l06513"></a>06513             size = <span class="keyword">sizeof</span>(str);
<a name="l06514"></a>06514             <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkey, <span class="stringliteral">&quot;Time triggered first&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06515"></a>06515             <span class="keywordflow">if</span> (!triggered)
<a name="l06516"></a>06516                strcpy(str, <span class="stringliteral">&quot;-&quot;</span>);
<a name="l06517"></a>06517             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;%s&quot;</span>, str);
<a name="l06518"></a>06518 
<a name="l06519"></a>06519             <span class="comment">/* class */</span>
<a name="l06520"></a>06520             size = <span class="keyword">sizeof</span>(str);
<a name="l06521"></a>06521             <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkey, <span class="stringliteral">&quot;Alarm Class&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06522"></a>06522 
<a name="l06523"></a>06523             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l06524"></a>06524                sprintf(ref, <span class="stringliteral">&quot;/Alarms/Classes/%s?exp=%s&quot;</span>, str, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l06525"></a>06525             <span class="keywordflow">else</span>
<a name="l06526"></a>06526                sprintf(ref, <span class="stringliteral">&quot;/Alarms/Classes/%s&quot;</span>, str);
<a name="l06527"></a>06527             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;&lt;a href=\&quot;%s\&quot;&gt;%s&lt;/a&gt;&quot;</span>, ref, str);
<a name="l06528"></a>06528 
<a name="l06529"></a>06529             <span class="comment">/* condition */</span>
<a name="l06530"></a>06530             size = <span class="keyword">sizeof</span>(condition);
<a name="l06531"></a>06531             <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkey, <span class="stringliteral">&quot;Condition&quot;</span>, condition, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06532"></a>06532 
<a name="l06533"></a>06533             <span class="keywordflow">if</span> (index == <a class="code" href="group__malarmh.html#gabd367ea3feeb6b3fe27aaf45e9a067f6">AT_EVALUATED</a>) {
<a name="l06534"></a>06534                <span class="comment">/* print condition */</span>
<a name="l06535"></a>06535                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td&gt;&quot;</span>);
<a name="l06536"></a>06536                <a class="code" href="mhttpd_8c.html#af374dce40baae97a533a83a0626c23dc">strencode</a>(condition);
<a name="l06537"></a>06537 
<a name="l06538"></a>06538                <span class="comment">/* retrieve value */</span>
<a name="l06539"></a>06539                <a class="code" href="group__msectionh.html#ga6ea930a4a4dbf55d034b598ee3f1d5a8">al_evaluate_condition</a>(condition, value);
<a name="l06540"></a>06540                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center bgcolor=#C0C0FF&gt;%s&quot;</span>, value);
<a name="l06541"></a>06541             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index == <a class="code" href="group__malarmh.html#ga258ba8c74f1f017cc80ef51fa82e3e13">AT_PROGRAM</a>) {
<a name="l06542"></a>06542                <span class="comment">/* print condition */</span>
<a name="l06543"></a>06543                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=2&gt;&quot;</span>);
<a name="l06544"></a>06544                <a class="code" href="mhttpd_8c.html#af374dce40baae97a533a83a0626c23dc">strencode</a>(condition);
<a name="l06545"></a>06545             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index == <a class="code" href="group__malarmh.html#ga0aecd2654d62ebd6b3d8d57ef8ccf2d9">AT_INTERNAL</a>) {
<a name="l06546"></a>06546                size = <span class="keyword">sizeof</span>(str);
<a name="l06547"></a>06547                <span class="keywordflow">if</span> (triggered)
<a name="l06548"></a>06548                   <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkey, <span class="stringliteral">&quot;Alarm message&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06549"></a>06549                <span class="keywordflow">else</span>
<a name="l06550"></a>06550                   <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkey, <span class="stringliteral">&quot;Condition&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06551"></a>06551 
<a name="l06552"></a>06552                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=2&gt;%s&quot;</span>, str);
<a name="l06553"></a>06553             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index == <a class="code" href="group__malarmh.html#ga40d5f5ba688496ddaa6f12e9a9b9f956">AT_PERIODIC</a>) {
<a name="l06554"></a>06554                size = <span class="keyword">sizeof</span>(str);
<a name="l06555"></a>06555                <span class="keywordflow">if</span> (triggered)
<a name="l06556"></a>06556                   <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkey, <span class="stringliteral">&quot;Alarm message&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06557"></a>06557                <span class="keywordflow">else</span> {
<a name="l06558"></a>06558                   size = <span class="keyword">sizeof</span>(last);
<a name="l06559"></a>06559                   <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkey, <span class="stringliteral">&quot;Checked last&quot;</span>, &amp;last, &amp;size, <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06560"></a>06560                   <span class="keywordflow">if</span> (last == 0) {
<a name="l06561"></a>06561                      last = <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>();
<a name="l06562"></a>06562                      <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, hkey, <span class="stringliteral">&quot;Checked last&quot;</span>, &amp;last, size, 1, <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a>);
<a name="l06563"></a>06563                   }
<a name="l06564"></a>06564 
<a name="l06565"></a>06565                   size = <span class="keyword">sizeof</span>(interval);
<a name="l06566"></a>06566                   <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkey, <span class="stringliteral">&quot;Check interval&quot;</span>, &amp;interval, &amp;size, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>,
<a name="l06567"></a>06567                                <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06568"></a>06568                   last += interval;
<a name="l06569"></a>06569                   strcpy(value, ctime(&amp;last));
<a name="l06570"></a>06570                   value[16] = 0;
<a name="l06571"></a>06571 
<a name="l06572"></a>06572                   sprintf(str, <span class="stringliteral">&quot;Alarm triggers at %s&quot;</span>, value);
<a name="l06573"></a>06573                }
<a name="l06574"></a>06574 
<a name="l06575"></a>06575                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=2&gt;%s&quot;</span>, str);
<a name="l06576"></a>06576             }
<a name="l06577"></a>06577 
<a name="l06578"></a>06578             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td&gt;\n&quot;</span>);
<a name="l06579"></a>06579             <span class="keywordflow">if</span> (triggered) {
<a name="l06580"></a>06580                <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l06581"></a>06581                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=exp value=\&quot;%s\&quot;&gt;\n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l06582"></a>06582                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;Reset\&quot;&gt;\n&quot;</span>);
<a name="l06583"></a>06583             } <span class="keywordflow">else</span>
<a name="l06584"></a>06584                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;</span>);
<a name="l06585"></a>06585 
<a name="l06586"></a>06586             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l06587"></a>06587             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/form&gt;\n&quot;</span>);
<a name="l06588"></a>06588          }
<a name="l06589"></a>06589       }
<a name="l06590"></a>06590    }
<a name="l06591"></a>06591 
<a name="l06592"></a>06592    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>);
<a name="l06593"></a>06593    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l06594"></a>06594 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a45884f36341a7c919978b7b5bb20a707"></a><!-- doxytag: member="mhttpd.c::show_cnaf_page" ref="a45884f36341a7c919978b7b5bb20a707" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_cnaf_page </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l05301">5301</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="patch__mevb_8cpp_source.html#l00003">c</a>, <a class="el" href="midas_8c_source.html#l02688">cm_connect_client()</a>, <a class="el" href="midas_8c_source.html#l02754">cm_disconnect_client()</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="jorway73a_8c_source.html#l00628">cmd</a>, <a class="el" href="midas_8h_source.html#l00873">CNAF</a>, <a class="el" href="midas_8h_source.html#l00878">CNAF_CRATE_CLEAR</a>, <a class="el" href="midas_8h_source.html#l00879">CNAF_CRATE_ZINIT</a>, <a class="el" href="midas_8h_source.html#l00877">CNAF_INHIBIT_CLEAR</a>, <a class="el" href="midas_8h_source.html#l00876">CNAF_INHIBIT_SET</a>, <a class="el" href="system_8c_source.html#l00966">d</a>, <a class="el" href="odb_8c_source.html#l03390">db_enum_key()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="midas_8h_source.html#l01016">DB_NO_MORE_SUBKEYS</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mana_8cpp_source.html#l00800">getparam()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="midas_8c_source.html#l09519">rpc_client_call()</a>, <a class="el" href="mrpc_8h_source.html#l00196">RPC_CNAF16</a>, <a class="el" href="mrpc_8h_source.html#l00197">RPC_CNAF24</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="system_8c_source.html#l02491">ss_sleep()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="bit3__mvme_2mvmestd_8h_source.html#l00045">SUCCESS</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05302"></a>05302 {
<a name="l05303"></a>05303    <span class="keywordtype">char</span> *<a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a>, <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], *pd;
<a name="l05304"></a>05304    <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#adce6024c3a1b29c5fcede88815f9b152">c</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, a, f, <a class="code" href="system_8c.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>, q, x, r, ia, id, w;
<a name="l05305"></a>05305    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l05306"></a>05306    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hrootkey, hsubkey, hkey;
<a name="l05307"></a>05307 
<a name="l05308"></a>05308    <span class="keyword">static</span> <span class="keywordtype">char</span> client_name[<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>];
<a name="l05309"></a>05309    <span class="keyword">static</span> <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> hconn = 0;
<a name="l05310"></a>05310 
<a name="l05311"></a>05311    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l05312"></a>05312 
<a name="l05313"></a>05313    <span class="comment">/* find FCNA server if not specified */</span>
<a name="l05314"></a>05314    <span class="keywordflow">if</span> (hconn == 0) {
<a name="l05315"></a>05315       <span class="comment">/* find client which exports FCNA function */</span>
<a name="l05316"></a>05316       status = <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;System/Clients&quot;</span>, &amp;hrootkey);
<a name="l05317"></a>05317       <span class="keywordflow">if</span> (status == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l05318"></a>05318          <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l05319"></a>05319             status = <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hrootkey, i, &amp;hsubkey);
<a name="l05320"></a>05320             <span class="keywordflow">if</span> (status == <a class="code" href="group__err23.html#gaf2249d36fd8ffb254cd33a3bbc899638">DB_NO_MORE_SUBKEYS</a>)
<a name="l05321"></a>05321                <span class="keywordflow">break</span>;
<a name="l05322"></a>05322 
<a name="l05323"></a>05323             sprintf(str, <span class="stringliteral">&quot;RPC/%d&quot;</span>, <a class="code" href="group__mrpcdefineh.html#ga04139d1c129e9a87093587d16d8ac5a4">RPC_CNAF16</a>);
<a name="l05324"></a>05324             status = <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hsubkey, str, &amp;hkey);
<a name="l05325"></a>05325             <span class="keywordflow">if</span> (status == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l05326"></a>05326                size = <span class="keyword">sizeof</span>(client_name);
<a name="l05327"></a>05327                <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hsubkey, <span class="stringliteral">&quot;Name&quot;</span>, client_name, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l05328"></a>05328                <span class="keywordflow">break</span>;
<a name="l05329"></a>05329             }
<a name="l05330"></a>05330          }
<a name="l05331"></a>05331       }
<a name="l05332"></a>05332 
<a name="l05333"></a>05333       <span class="keywordflow">if</span> (client_name[0]) {
<a name="l05334"></a>05334          status = <a class="code" href="group__msectionh.html#ga563f51d392f150ea598ecad25a89f6b5">cm_connect_client</a>(client_name, &amp;hconn);
<a name="l05335"></a>05335          <span class="keywordflow">if</span> (status != <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>)
<a name="l05336"></a>05336             hconn = 0;
<a name="l05337"></a>05337       }
<a name="l05338"></a>05338    }
<a name="l05339"></a>05339 
<a name="l05340"></a>05340    <span class="comment">/* header */</span>
<a name="l05341"></a>05341    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l05342"></a>05342    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l05343"></a>05343    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l05344"></a>05344 
<a name="l05345"></a>05345    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;MIDAS CAMAC interface&lt;/title&gt;&lt;/head&gt;\n&quot;</span>);
<a name="l05346"></a>05346    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;body&gt;&lt;form method=\&quot;GET\&quot; action=\&quot;/CNAF\&quot;&gt;\n\n&quot;</span>);
<a name="l05347"></a>05347 
<a name="l05348"></a>05348    <span class="comment">/* title row */</span>
<a name="l05349"></a>05349 
<a name="l05350"></a>05350    size = <span class="keyword">sizeof</span>(str);
<a name="l05351"></a>05351    str[0] = 0;
<a name="l05352"></a>05352    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Name&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l05353"></a>05353 
<a name="l05354"></a>05354    <span class="comment">/* define hidden field for experiment */</span>
<a name="l05355"></a>05355    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l05356"></a>05356       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=exp value=\&quot;%s\&quot;&gt;\n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l05357"></a>05357 
<a name="l05358"></a>05358    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;table border=3 cellpadding=1&gt;\n&quot;</span>);
<a name="l05359"></a>05359    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th colspan=3 bgcolor=#A0A0FF&gt;MIDAS experiment \&quot;%s\&quot;&quot;</span>, str);
<a name="l05360"></a>05360 
<a name="l05361"></a>05361    <span class="keywordflow">if</span> (client_name[0] == 0)
<a name="l05362"></a>05362       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th colspan=3 bgcolor=#FF0000&gt;No CAMAC server running&lt;/tr&gt;\n&quot;</span>);
<a name="l05363"></a>05363    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hconn == 0)
<a name="l05364"></a>05364       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th colspan=3 bgcolor=#FF0000&gt;Cannot connect to %s&lt;/tr&gt;\n&quot;</span>, client_name);
<a name="l05365"></a>05365    <span class="keywordflow">else</span>
<a name="l05366"></a>05366       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th colspan=3 bgcolor=#A0A0FF&gt;CAMAC server: %s&lt;/tr&gt;\n&quot;</span>, client_name);
<a name="l05367"></a>05367 
<a name="l05368"></a>05368    <span class="comment">/* default values */</span>
<a name="l05369"></a>05369    c = n = 1;
<a name="l05370"></a>05370    a = f = d = q = x = 0;
<a name="l05371"></a>05371    r = 1;
<a name="l05372"></a>05372    ia = <span class="keywordtype">id</span> = w = 0;
<a name="l05373"></a>05373 
<a name="l05374"></a>05374   <span class="comment">/*---- menu buttons ----*/</span>
<a name="l05375"></a>05375 
<a name="l05376"></a>05376    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=3 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l05377"></a>05377    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Execute&gt;\n&quot;</span>);
<a name="l05378"></a>05378 
<a name="l05379"></a>05379    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=3 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l05380"></a>05380    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=ODB&gt;\n&quot;</span>);
<a name="l05381"></a>05381    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Status&gt;\n&quot;</span>);
<a name="l05382"></a>05382    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Help&gt;\n&quot;</span>);
<a name="l05383"></a>05383    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n\n&quot;</span>);
<a name="l05384"></a>05384 
<a name="l05385"></a>05385    <span class="comment">/* header */</span>
<a name="l05386"></a>05386    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#FFFF00&gt;N&quot;</span>);
<a name="l05387"></a>05387    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th bgcolor=#FF8000&gt;A&quot;</span>);
<a name="l05388"></a>05388    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th bgcolor=#00FF00&gt;F&quot;</span>);
<a name="l05389"></a>05389    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th colspan=3 bgcolor=#8080FF&gt;Data&quot;</span>);
<a name="l05390"></a>05390 
<a name="l05391"></a>05391    <span class="comment">/* execute commands */</span>
<a name="l05392"></a>05392    size = <span class="keyword">sizeof</span>(d);
<a name="l05393"></a>05393 
<a name="l05394"></a>05394    cmd = <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>);
<a name="l05395"></a>05395    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(cmd, <span class="stringliteral">&quot;C cycle&quot;</span>)) {
<a name="l05396"></a>05396       <a class="code" href="group__msectionh.html#ga6ade8c4e3d08c41fbeb3a98fe2808778">rpc_client_call</a>(hconn, <a class="code" href="group__mrpcdefineh.html#ga04139d1c129e9a87093587d16d8ac5a4">RPC_CNAF16</a>, <a class="code" href="group__midasincludecode.html#gab5458177175ac7c1d62f96395e4b2f8f">CNAF_CRATE_CLEAR</a>, 0, 0, 0, 0, 0, &amp;d, &amp;size, &amp;x,
<a name="l05397"></a>05397                       &amp;q);
<a name="l05398"></a>05398 
<a name="l05399"></a>05399       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6 bgcolor=#00FF00&gt;C cycle executed sucessfully&lt;/tr&gt;\n&quot;</span>);
<a name="l05400"></a>05400    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(cmd, <span class="stringliteral">&quot;Z cycle&quot;</span>)) {
<a name="l05401"></a>05401       <a class="code" href="group__msectionh.html#ga6ade8c4e3d08c41fbeb3a98fe2808778">rpc_client_call</a>(hconn, <a class="code" href="group__mrpcdefineh.html#ga04139d1c129e9a87093587d16d8ac5a4">RPC_CNAF16</a>, <a class="code" href="group__midasincludecode.html#ga8ca71a69fac55838bc9bcc020f9edacf">CNAF_CRATE_ZINIT</a>, 0, 0, 0, 0, 0, &amp;d, &amp;size, &amp;x,
<a name="l05402"></a>05402                       &amp;q);
<a name="l05403"></a>05403 
<a name="l05404"></a>05404       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6 bgcolor=#00FF00&gt;Z cycle executed sucessfully&lt;/tr&gt;\n&quot;</span>);
<a name="l05405"></a>05405    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(cmd, <span class="stringliteral">&quot;Clear inhibit&quot;</span>)) {
<a name="l05406"></a>05406       <a class="code" href="group__msectionh.html#ga6ade8c4e3d08c41fbeb3a98fe2808778">rpc_client_call</a>(hconn, <a class="code" href="group__mrpcdefineh.html#ga04139d1c129e9a87093587d16d8ac5a4">RPC_CNAF16</a>, <a class="code" href="group__midasincludecode.html#gafe3467b124db26b5b10caf7f1633baed">CNAF_INHIBIT_CLEAR</a>, 0, 0, 0, 0, 0, &amp;d, &amp;size, &amp;x,
<a name="l05407"></a>05407                       &amp;q);
<a name="l05408"></a>05408 
<a name="l05409"></a>05409       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05410"></a>05410           (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6 bgcolor=#00FF00&gt;Clear inhibit executed sucessfully&lt;/tr&gt;\n&quot;</span>);
<a name="l05411"></a>05411    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(cmd, <span class="stringliteral">&quot;Set inhibit&quot;</span>)) {
<a name="l05412"></a>05412       <a class="code" href="group__msectionh.html#ga6ade8c4e3d08c41fbeb3a98fe2808778">rpc_client_call</a>(hconn, <a class="code" href="group__mrpcdefineh.html#ga04139d1c129e9a87093587d16d8ac5a4">RPC_CNAF16</a>, <a class="code" href="group__midasincludecode.html#ga5034a4dfe61df0821dd0841bae13033a">CNAF_INHIBIT_SET</a>, 0, 0, 0, 0, 0, &amp;d, &amp;size, &amp;x,
<a name="l05413"></a>05413                       &amp;q);
<a name="l05414"></a>05414 
<a name="l05415"></a>05415       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05416"></a>05416           (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6 bgcolor=#00FF00&gt;Set inhibit executed sucessfully&lt;/tr&gt;\n&quot;</span>);
<a name="l05417"></a>05417    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(cmd, <span class="stringliteral">&quot;Execute&quot;</span>)) {
<a name="l05418"></a>05418       c = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;C&quot;</span>));
<a name="l05419"></a>05419       n = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;N&quot;</span>));
<a name="l05420"></a>05420       a = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;A&quot;</span>));
<a name="l05421"></a>05421       f = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;F&quot;</span>));
<a name="l05422"></a>05422       r = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;R&quot;</span>));
<a name="l05423"></a>05423       w = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;W&quot;</span>));
<a name="l05424"></a>05424       <span class="keywordtype">id</span> = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;ID&quot;</span>));
<a name="l05425"></a>05425       ia = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;IA&quot;</span>));
<a name="l05426"></a>05426 
<a name="l05427"></a>05427       pd = <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;D&quot;</span>);
<a name="l05428"></a>05428       <span class="keywordflow">if</span> (strncmp(pd, <span class="stringliteral">&quot;0x&quot;</span>, 2) == 0)
<a name="l05429"></a>05429          sscanf(pd + 2, <span class="stringliteral">&quot;%x&quot;</span>, &amp;d);
<a name="l05430"></a>05430       <span class="keywordflow">else</span>
<a name="l05431"></a>05431          d = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;D&quot;</span>));
<a name="l05432"></a>05432 
<a name="l05433"></a>05433       <span class="comment">/* limit repeat range */</span>
<a name="l05434"></a>05434       <span class="keywordflow">if</span> (r == 0)
<a name="l05435"></a>05435          r = 1;
<a name="l05436"></a>05436       <span class="keywordflow">if</span> (r &gt; 100)
<a name="l05437"></a>05437          r = 100;
<a name="l05438"></a>05438       <span class="keywordflow">if</span> (w &gt; 1000)
<a name="l05439"></a>05439          w = 1000;
<a name="l05440"></a>05440 
<a name="l05441"></a>05441       <span class="keywordflow">for</span> (i = 0; i &lt; r; i++) {
<a name="l05442"></a>05442          status = <a class="code" href="group__mvmestdinclude.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>;
<a name="l05443"></a>05443 
<a name="l05444"></a>05444          <span class="keywordflow">if</span> (hconn) {
<a name="l05445"></a>05445             size = <span class="keyword">sizeof</span>(d);
<a name="l05446"></a>05446             status =
<a name="l05447"></a>05447                 <a class="code" href="group__msectionh.html#ga6ade8c4e3d08c41fbeb3a98fe2808778">rpc_client_call</a>(hconn, <a class="code" href="group__mrpcdefineh.html#gaf48c6e230ebd543627002769684a3240">RPC_CNAF24</a>, <a class="code" href="group__midasincludecode.html#gaabc611f59210401f11ea4247291c4468">CNAF</a>, 0, c, n, a, f, &amp;d, &amp;size, &amp;x,
<a name="l05448"></a>05448                                 &amp;q);
<a name="l05449"></a>05449 
<a name="l05450"></a>05450             <span class="keywordflow">if</span> (status == <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>) {
<a name="l05451"></a>05451                <span class="comment">/* try to reconnect */</span>
<a name="l05452"></a>05452                <a class="code" href="group__msectionh.html#ga4b4ec97cd2d878875c8c472e708e47d1">cm_disconnect_client</a>(hconn, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l05453"></a>05453                status = <a class="code" href="group__msectionh.html#ga563f51d392f150ea598ecad25a89f6b5">cm_connect_client</a>(client_name, &amp;hconn);
<a name="l05454"></a>05454                <span class="keywordflow">if</span> (status != <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>) {
<a name="l05455"></a>05455                   hconn = 0;
<a name="l05456"></a>05456                   client_name[0] = 0;
<a name="l05457"></a>05457                }
<a name="l05458"></a>05458 
<a name="l05459"></a>05459                <span class="keywordflow">if</span> (hconn)
<a name="l05460"></a>05460                   status =
<a name="l05461"></a>05461                       <a class="code" href="group__msectionh.html#ga6ade8c4e3d08c41fbeb3a98fe2808778">rpc_client_call</a>(hconn, <a class="code" href="group__mrpcdefineh.html#gaf48c6e230ebd543627002769684a3240">RPC_CNAF24</a>, <a class="code" href="group__midasincludecode.html#gaabc611f59210401f11ea4247291c4468">CNAF</a>, 0, c, n, a, f, &amp;d, &amp;size,
<a name="l05462"></a>05462                                       &amp;x, &amp;q);
<a name="l05463"></a>05463             }
<a name="l05464"></a>05464          }
<a name="l05465"></a>05465 
<a name="l05466"></a>05466          <span class="keywordflow">if</span> (status != <a class="code" href="group__mvmestdinclude.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>) {
<a name="l05467"></a>05467             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05468"></a>05468                 (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6 bgcolor=#FF0000&gt;Error executing function, code = %d&lt;/tr&gt;&quot;</span>,
<a name="l05469"></a>05469                  status);
<a name="l05470"></a>05470          } <span class="keywordflow">else</span> {
<a name="l05471"></a>05471             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr align=center&gt;&lt;td bgcolor=#FFFF00&gt;%d&quot;</span>, n);
<a name="l05472"></a>05472             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#FF8000&gt;%d&quot;</span>, a);
<a name="l05473"></a>05473             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#00FF00&gt;%d&quot;</span>, f);
<a name="l05474"></a>05474             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=3 bgcolor=#8080FF&gt;%d / 0x%04X  Q%d X%d&quot;</span>, d, d, q, x);
<a name="l05475"></a>05475          }
<a name="l05476"></a>05476 
<a name="l05477"></a>05477          d += id;
<a name="l05478"></a>05478          a += ia;
<a name="l05479"></a>05479 
<a name="l05480"></a>05480          <span class="keywordflow">if</span> (w &gt; 0)
<a name="l05481"></a>05481             <a class="code" href="group__msectionh.html#gaaec652d8878ceb5ef38ad1ba2cbf7dec">ss_sleep</a>(w);
<a name="l05482"></a>05482       }
<a name="l05483"></a>05483    }
<a name="l05484"></a>05484 
<a name="l05485"></a>05485    <span class="comment">/* input fields */</span>
<a name="l05486"></a>05486    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05487"></a>05487        (<span class="stringliteral">&quot;&lt;tr align=center&gt;&lt;td bgcolor=#FFFF00&gt;&lt;input type=text size=3 name=N value=%d&gt;\n&quot;</span>,
<a name="l05488"></a>05488         n);
<a name="l05489"></a>05489    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#FF8000&gt;&lt;input type=text size=3 name=A value=%d&gt;\n&quot;</span>, a);
<a name="l05490"></a>05490    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#00FF00&gt;&lt;input type=text size=3 name=F value=%d&gt;\n&quot;</span>, f);
<a name="l05491"></a>05491    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05492"></a>05492        (<span class="stringliteral">&quot;&lt;td bgcolor=#8080FF colspan=3&gt;&lt;input type=text size=8 name=D value=%d&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l05493"></a>05493         d);
<a name="l05494"></a>05494 
<a name="l05495"></a>05495    <span class="comment">/* control fields */</span>
<a name="l05496"></a>05496    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#FF8080&gt;Repeat&quot;</span>);
<a name="l05497"></a>05497    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#FF8080&gt;&lt;input type=text size=3 name=R value=%d&gt;\n&quot;</span>, r);
<a name="l05498"></a>05498 
<a name="l05499"></a>05499    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05500"></a>05500        (<span class="stringliteral">&quot;&lt;td align=center colspan=3 bgcolor=#FF0000&gt;&lt;input type=submit name=cmd value=\&quot;C cycle\&quot;&gt;\n&quot;</span>);
<a name="l05501"></a>05501    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;Z cycle\&quot;&gt;\n&quot;</span>);
<a name="l05502"></a>05502 
<a name="l05503"></a>05503    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#FF8080&gt;Repeat delay [ms]&quot;</span>);
<a name="l05504"></a>05504    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#FF8080&gt;&lt;input type=text size=3 name=W value=%d&gt;\n&quot;</span>, w);
<a name="l05505"></a>05505 
<a name="l05506"></a>05506    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05507"></a>05507        (<span class="stringliteral">&quot;&lt;td align=center colspan=3 bgcolor=#FF0000&gt;&lt;input type=submit name=cmd value=\&quot;Set inhibit\&quot;&gt;\n&quot;</span>);
<a name="l05508"></a>05508    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;Clear inhibit\&quot;&gt;\n&quot;</span>);
<a name="l05509"></a>05509 
<a name="l05510"></a>05510    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#FF8080&gt;Data increment&quot;</span>);
<a name="l05511"></a>05511    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#FF8080&gt;&lt;input type=text size=3 name=ID value=%d&gt;\n&quot;</span>, <span class="keywordtype">id</span>);
<a name="l05512"></a>05512 
<a name="l05513"></a>05513    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05514"></a>05514        (<span class="stringliteral">&quot;&lt;td colspan=3 align=center bgcolor=#FFFF80&gt;Branch &lt;input type=text size=3 name=B value=0&gt;\n&quot;</span>);
<a name="l05515"></a>05515 
<a name="l05516"></a>05516    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#FF8080&gt;A increment&quot;</span>);
<a name="l05517"></a>05517    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#FF8080&gt;&lt;input type=text size=3 name=IA value=%d&gt;\n&quot;</span>, ia);
<a name="l05518"></a>05518 
<a name="l05519"></a>05519    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05520"></a>05520        (<span class="stringliteral">&quot;&lt;td colspan=3 align=center bgcolor=#FFFF80&gt;Crate &lt;input type=text size=3 name=C value=%d&gt;\n&quot;</span>,
<a name="l05521"></a>05521         c);
<a name="l05522"></a>05522 
<a name="l05523"></a>05523    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;&lt;/body&gt;\r\n&quot;</span>);
<a name="l05524"></a>05524 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9e638d1c512b1e5cfad4ff5908bc92bd"></a><!-- doxytag: member="mhttpd.c::show_config_page" ref="a9e638d1c512b1e5cfad4ff5908bc92bd" args="(int refresh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_config_page </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>refresh</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l06777">6777</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, and <a class="el" href="mhttpd_8c_source.html#l01502">show_header()</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06778"></a>06778 {
<a name="l06779"></a>06779    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[80];
<a name="l06780"></a>06780    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>;
<a name="l06781"></a>06781 
<a name="l06782"></a>06782    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l06783"></a>06783 
<a name="l06784"></a>06784    <a class="code" href="mhttpd_8c.html#ae5fb6c731656613ead122d173a8ef7a8">show_header</a>(hDB, <span class="stringliteral">&quot;Configure&quot;</span>, <span class="stringliteral">&quot;GET&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 1, 0);
<a name="l06785"></a>06785 
<a name="l06786"></a>06786    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#A0A0FF colspan=2&gt;Configure&lt;/tr&gt;\n&quot;</span>);
<a name="l06787"></a>06787 
<a name="l06788"></a>06788    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;Update period\n&quot;</span>);
<a name="l06789"></a>06789 
<a name="l06790"></a>06790    sprintf(str, <span class="stringliteral">&quot;5&quot;</span>);
<a name="l06791"></a>06791    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td&gt;&lt;input type=text size=5 maxlength=5 name=refr value=%d&gt;\n&quot;</span>, refresh);
<a name="l06792"></a>06792    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l06793"></a>06793 
<a name="l06794"></a>06794    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=center colspan=2&gt;\n&quot;</span>);
<a name="l06795"></a>06795    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Accept&gt;\n&quot;</span>);
<a name="l06796"></a>06796    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Cancel&gt;\n&quot;</span>);
<a name="l06797"></a>06797    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=cmd value=Accept&gt;\n&quot;</span>);
<a name="l06798"></a>06798    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l06799"></a>06799    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>);
<a name="l06800"></a>06800 
<a name="l06801"></a>06801    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l06802"></a>06802 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a87a3ec0b2c08a90fcd315682c7535d65"></a><!-- doxytag: member="mhttpd.c::show_create_page" ref="a87a3ec0b2c08a90fcd315682c7535d65" args="(char *enc_path, char *dec_path, char *value, int index, int type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_create_page </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>enc_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dec_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>type</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l06182">6182</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="lrs1821_8c_source.html#l00038">data</a>, <a class="el" href="odb_8c_source.html#l01721">db_create_key()</a>, <a class="el" href="odb_8c_source.html#l01960">db_create_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l04503">db_set_data()</a>, <a class="el" href="odb_8c_source.html#l04727">db_set_data_index()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="midas_8h_source.html#l01320">KEY::item_size</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="mhttpd_8c_source.html#l01356">redirect()</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l01502">show_header()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="midas_8h_source.html#l00750">TID_LINK</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, and <a class="el" href="midas_8h_source.html#l01315">KEY::type</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06183"></a>06183 {
<a name="l06184"></a>06184    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], link[256], *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>;
<a name="l06185"></a>06185    <span class="keywordtype">char</span> <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>[10000];
<a name="l06186"></a>06186    <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l06187"></a>06187    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey;
<a name="l06188"></a>06188    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l06189"></a>06189 
<a name="l06190"></a>06190    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l06191"></a>06191 
<a name="l06192"></a>06192    <span class="keywordflow">if</span> (<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>[0] == 0) {
<a name="l06193"></a>06193       <span class="comment">/* without value, show create dialog */</span>
<a name="l06194"></a>06194 
<a name="l06195"></a>06195       <a class="code" href="mhttpd_8c.html#ae5fb6c731656613ead122d173a8ef7a8">show_header</a>(hDB, <span class="stringliteral">&quot;Create ODB entry&quot;</span>, <span class="stringliteral">&quot;GET&quot;</span>, enc_path, 1, 0);
<a name="l06196"></a>06196 
<a name="l06197"></a>06197       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#A0A0FF colspan=2&gt;Create ODB entry&lt;/tr&gt;\n&quot;</span>);
<a name="l06198"></a>06198 
<a name="l06199"></a>06199       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;Type&quot;</span>);
<a name="l06200"></a>06200       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td&gt;&lt;select type=text size=1 name=type&gt;\n&quot;</span>);
<a name="l06201"></a>06201 
<a name="l06202"></a>06202       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=7&gt; Integer (32-bit)\n&quot;</span>);
<a name="l06203"></a>06203       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=9&gt; Float (4 Bytes)\n&quot;</span>);
<a name="l06204"></a>06204       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=12&gt; String\n&quot;</span>);
<a name="l06205"></a>06205       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=15&gt; Subdirectory\n&quot;</span>);
<a name="l06206"></a>06206 
<a name="l06207"></a>06207       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=1&gt; Byte\n&quot;</span>);
<a name="l06208"></a>06208       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=2&gt; Signed byte\n&quot;</span>);
<a name="l06209"></a>06209       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=3&gt; Character (8-bit)\n&quot;</span>);
<a name="l06210"></a>06210       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=4&gt; Word (16-bit)\n&quot;</span>);
<a name="l06211"></a>06211       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=5&gt; Short integer(16-bit)\n&quot;</span>);
<a name="l06212"></a>06212       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=6&gt; Double Word (32-bit)\n&quot;</span>);
<a name="l06213"></a>06213       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=8&gt; Boolean\n&quot;</span>);
<a name="l06214"></a>06214       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=10&gt; Double float(8 Bytes)\n&quot;</span>);
<a name="l06215"></a>06215       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=16&gt; Symbolic link\n&quot;</span>);
<a name="l06216"></a>06216 
<a name="l06217"></a>06217       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l06218"></a>06218 
<a name="l06219"></a>06219       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;Name&quot;</span>);
<a name="l06220"></a>06220       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td&gt;&lt;input type=text size=20 maxlength=80 name=value&gt;\n&quot;</span>);
<a name="l06221"></a>06221       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>);
<a name="l06222"></a>06222 
<a name="l06223"></a>06223       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;Array size&quot;</span>);
<a name="l06224"></a>06224       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td&gt;&lt;input type=text size=20 maxlength=80 name=index value=1&gt;\n&quot;</span>);
<a name="l06225"></a>06225       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>);
<a name="l06226"></a>06226 
<a name="l06227"></a>06227       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=center colspan=2&gt;&quot;</span>);
<a name="l06228"></a>06228       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Create&gt;&quot;</span>);
<a name="l06229"></a>06229       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Cancel&gt;&quot;</span>);
<a name="l06230"></a>06230       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>);
<a name="l06231"></a>06231       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>);
<a name="l06232"></a>06232 
<a name="l06233"></a>06233       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l06234"></a>06234    } <span class="keywordflow">else</span> {
<a name="l06235"></a>06235       <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> == <a class="code" href="group__mdefineh.html#gaa63f41f547c7f46f828aaf35073807ea">TID_LINK</a>) {
<a name="l06236"></a>06236          <span class="comment">/* check if destination exists */</span>
<a name="l06237"></a>06237          status = <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, &amp;hkey);
<a name="l06238"></a>06238          <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l06239"></a>06239             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;h1&gt;Error: Link destination \&quot;%s\&quot; does not exist!&lt;/h1&gt;&quot;</span>, <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l06240"></a>06240             <span class="keywordflow">return</span>;
<a name="l06241"></a>06241          }
<a name="l06242"></a>06242 
<a name="l06243"></a>06243          <span class="comment">/* extract key name from destination */</span>
<a name="l06244"></a>06244          strcpy(str, <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l06245"></a>06245          p = str + strlen(str) - 1;
<a name="l06246"></a>06246          <span class="keywordflow">while</span> (*p &amp;&amp; *p != <span class="charliteral">&apos;/&apos;</span>)
<a name="l06247"></a>06247             p--;
<a name="l06248"></a>06248          p++;
<a name="l06249"></a>06249 
<a name="l06250"></a>06250          <span class="comment">/* use it as link name */</span>
<a name="l06251"></a>06251          strcpy(link, p);
<a name="l06252"></a>06252 
<a name="l06253"></a>06253          strcpy(str, dec_path);
<a name="l06254"></a>06254          <span class="keywordflow">if</span> (str[strlen(str) - 1] != <span class="charliteral">&apos;/&apos;</span>)
<a name="l06255"></a>06255             strcat(str, <span class="stringliteral">&quot;/&quot;</span>);
<a name="l06256"></a>06256          strcat(str, link);
<a name="l06257"></a>06257 
<a name="l06258"></a>06258 
<a name="l06259"></a>06259          status = <a class="code" href="group__msectionh.html#gac6e142751750225721f5d11753ef931b">db_create_link</a>(hDB, 0, str, <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l06260"></a>06260          <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l06261"></a>06261             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;h1&gt;Cannot create key %s&lt;/h1&gt;\n&quot;</span>, str);
<a name="l06262"></a>06262             <span class="keywordflow">return</span>;
<a name="l06263"></a>06263          }
<a name="l06264"></a>06264 
<a name="l06265"></a>06265       } <span class="keywordflow">else</span> {
<a name="l06266"></a>06266          strcpy(str, dec_path);
<a name="l06267"></a>06267          <span class="keywordflow">if</span> (str[strlen(str) - 1] != <span class="charliteral">&apos;/&apos;</span>)
<a name="l06268"></a>06268             strcat(str, <span class="stringliteral">&quot;/&quot;</span>);
<a name="l06269"></a>06269          strcat(str, <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l06270"></a>06270 
<a name="l06271"></a>06271          status = <a class="code" href="group__msectionh.html#ga1441e5b7ca1923cf8611f920cf2c31b4">db_create_key</a>(hDB, 0, str, <a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>);
<a name="l06272"></a>06272          <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l06273"></a>06273             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;h1&gt;Cannot create key %s&lt;/h1&gt;\n&quot;</span>, str);
<a name="l06274"></a>06274             <span class="keywordflow">return</span>;
<a name="l06275"></a>06275          }
<a name="l06276"></a>06276 
<a name="l06277"></a>06277          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkey);
<a name="l06278"></a>06278          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l06279"></a>06279          memset(data, 0, <span class="keyword">sizeof</span>(data));
<a name="l06280"></a>06280          <span class="keywordflow">if</span> (key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a> || key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#gaa63f41f547c7f46f828aaf35073807ea">TID_LINK</a>)
<a name="l06281"></a>06281             key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a> = <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>;
<a name="l06282"></a>06282 
<a name="l06283"></a>06283          <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> &gt; 1)
<a name="l06284"></a>06284             <a class="code" href="group__msectionh.html#ga18f5e7743545b06fca4f3d5ce9889034">db_set_data_index</a>(hDB, hkey, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> - 1, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l06285"></a>06285          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a> || key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#gaa63f41f547c7f46f828aaf35073807ea">TID_LINK</a>)
<a name="l06286"></a>06286             <a class="code" href="group__msectionh.html#ga6b98aa5ac9036c49023c0cc9353922d4">db_set_data</a>(hDB, hkey, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 1, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l06287"></a>06287       }
<a name="l06288"></a>06288 
<a name="l06289"></a>06289       <span class="comment">/* redirect */</span>
<a name="l06290"></a>06290       <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(enc_path);
<a name="l06291"></a>06291       <span class="keywordflow">return</span>;
<a name="l06292"></a>06292    }
<a name="l06293"></a>06293 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a799152cab54c105194a1c2bae2f8be0d"></a><!-- doxytag: member="mhttpd.c::show_custom_page" ref="a799152cab54c105194a1c2bae2f8be0d" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_custom_page </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l05192">5192</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="lrs1821_8c_source.html#l00038">data</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l04376">db_get_data_index()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l04727">db_set_data_index()</a>, <a class="el" href="odb_8c_source.html#l06308">db_sprintf()</a>, <a class="el" href="odb_8c_source.html#l06435">db_sscanf()</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="mhttpd_8c_source.html#l05122">find_odb_tag()</a>, <a class="el" href="mana_8cpp_source.html#l00800">getparam()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="midas_8h_source.html#l01320">KEY::item_size</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l00959">rsputs()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="mhttpd_8c_source.html#l00882">TEXT_SIZE</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, and <a class="el" href="midas_8h_source.html#l01315">KEY::type</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05193"></a>05193 {
<a name="l05194"></a>05194    <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, i_edit, i_set, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, n_var;
<a name="l05195"></a>05195    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[<a class="code" href="mhttpd_8c.html#afb6f36d91ffbf947cfa3f1114ca79764">TEXT_SIZE</a>], <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>[<a class="code" href="mhttpd_8c.html#afb6f36d91ffbf947cfa3f1114ca79764">TEXT_SIZE</a>], ctext[<a class="code" href="mhttpd_8c.html#afb6f36d91ffbf947cfa3f1114ca79764">TEXT_SIZE</a>], keypath[256], *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>, *ps;
<a name="l05196"></a>05196    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey;
<a name="l05197"></a>05197    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l05198"></a>05198    <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> bedit;
<a name="l05199"></a>05199 
<a name="l05200"></a>05200    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l05201"></a>05201 
<a name="l05202"></a>05202    <span class="comment">/* check if variable to edit */</span>
<a name="l05203"></a>05203    i_edit = -1;
<a name="l05204"></a>05204    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>), <span class="stringliteral">&quot;Edit&quot;</span>))
<a name="l05205"></a>05205       i_edit = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;index&quot;</span>));
<a name="l05206"></a>05206 
<a name="l05207"></a>05207    <span class="comment">/* check if variable to set */</span>
<a name="l05208"></a>05208    i_set = -1;
<a name="l05209"></a>05209    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>), <span class="stringliteral">&quot;Set&quot;</span>))
<a name="l05210"></a>05210       i_set = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;index&quot;</span>));
<a name="l05211"></a>05211 
<a name="l05212"></a>05212    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l05213"></a>05213    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l05214"></a>05214    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l05215"></a>05215 
<a name="l05216"></a>05216    sprintf(str, <span class="stringliteral">&quot;/Custom/%s&quot;</span>, path);
<a name="l05217"></a>05217 
<a name="l05218"></a>05218    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkey);
<a name="l05219"></a>05219    <span class="keywordflow">if</span> (hkey) {
<a name="l05220"></a>05220       n_var = 0;
<a name="l05221"></a>05221       size = <span class="keyword">sizeof</span>(ctext);
<a name="l05222"></a>05222       <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, ctext, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l05223"></a>05223 
<a name="l05224"></a>05224       <span class="comment">/* interprete text, replace &lt;odb&gt; tags with ODB values */</span>
<a name="l05225"></a>05225       p = ps = ctext;
<a name="l05226"></a>05226       <span class="keywordflow">do</span> {
<a name="l05227"></a>05227          p = <a class="code" href="mhttpd_8c.html#a041225e513adf2156dc7a18de1d315b9">find_odb_tag</a>(ps, keypath, &amp;bedit);
<a name="l05228"></a>05228          <span class="keywordflow">if</span> (p != NULL)
<a name="l05229"></a>05229             *p = 0;
<a name="l05230"></a>05230          <a class="code" href="mhttpd_8c.html#a0c625fe56e336fc4d14a579b876b9fa8">rsputs</a>(ps);
<a name="l05231"></a>05231 
<a name="l05232"></a>05232          <span class="keywordflow">if</span> (p == NULL)
<a name="l05233"></a>05233             <span class="keywordflow">break</span>;
<a name="l05234"></a>05234          ps = strchr(p + 1, <span class="charliteral">&apos;&gt;&apos;</span>) + 1;
<a name="l05235"></a>05235 
<a name="l05236"></a>05236          <span class="comment">/* check if path contains index */</span>
<a name="l05237"></a>05237          index = 0;
<a name="l05238"></a>05238 
<a name="l05239"></a>05239          <span class="keywordflow">if</span> (strchr(keypath, <span class="charliteral">&apos;[&apos;</span>) &amp;&amp; strchr(keypath, <span class="charliteral">&apos;]&apos;</span>)) {
<a name="l05240"></a>05240             <span class="keywordflow">for</span> (p = strchr(keypath, <span class="charliteral">&apos;[&apos;</span>) + 1; *p &amp;&amp; *p != <span class="charliteral">&apos;]&apos;</span>; p++)
<a name="l05241"></a>05241                <span class="keywordflow">if</span> (!isdigit(*p))
<a name="l05242"></a>05242                   <span class="keywordflow">break</span>;
<a name="l05243"></a>05243 
<a name="l05244"></a>05244             <span class="keywordflow">if</span> (*p &amp;&amp; *p == <span class="charliteral">&apos;]&apos;</span>) {
<a name="l05245"></a>05245                index = atoi(strchr(keypath, <span class="charliteral">&apos;[&apos;</span>) + 1);
<a name="l05246"></a>05246                *strchr(keypath, <span class="charliteral">&apos;[&apos;</span>) = 0;
<a name="l05247"></a>05247             }
<a name="l05248"></a>05248          }
<a name="l05249"></a>05249 
<a name="l05250"></a>05250          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, keypath, &amp;hkey);
<a name="l05251"></a>05251          <span class="keywordflow">if</span> (!hkey)
<a name="l05252"></a>05252             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;b&gt;Key \&quot;%s\&quot; not found in ODB&lt;/b&gt;\n&quot;</span>, keypath);
<a name="l05253"></a>05253          <span class="keywordflow">else</span> {
<a name="l05254"></a>05254             <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l05255"></a>05255             size = <span class="keyword">sizeof</span>(data);
<a name="l05256"></a>05256             <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hkey, data, &amp;size, index, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05257"></a>05257             <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(str, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05258"></a>05258 
<a name="l05259"></a>05259             <span class="keywordflow">if</span> (bedit) {
<a name="l05260"></a>05260                <span class="keywordflow">if</span> (n_var == i_set) {
<a name="l05261"></a>05261                   <span class="comment">/* set value */</span>
<a name="l05262"></a>05262                   strcpy(str, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;value&quot;</span>));
<a name="l05263"></a>05263                   <a class="code" href="group__msectionh.html#ga7b3d26e7b258c093ad999bf1286bb871">db_sscanf</a>(str, data, &amp;size, 0, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05264"></a>05264                   <a class="code" href="group__msectionh.html#ga18f5e7743545b06fca4f3d5ce9889034">db_set_data_index</a>(hDB, hkey, data, size, index, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05265"></a>05265 
<a name="l05266"></a>05266                   <span class="comment">/* read back value */</span>
<a name="l05267"></a>05267                   size = <span class="keyword">sizeof</span>(data);
<a name="l05268"></a>05268                   <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hkey, data, &amp;size, index, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05269"></a>05269                   <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(str, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05270"></a>05270                }
<a name="l05271"></a>05271 
<a name="l05272"></a>05272                <span class="keywordflow">if</span> (n_var == i_edit) {
<a name="l05273"></a>05273                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05274"></a>05274                       (<span class="stringliteral">&quot;&lt;input type=text size=10 maxlength=80 name=value value=\&quot;%s\&quot;&gt;\n&quot;</span>,
<a name="l05275"></a>05275                        str);
<a name="l05276"></a>05276                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit size=20 name=cmd value=Set&gt;\n&quot;</span>);
<a name="l05277"></a>05277                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=index value=%d&gt;\n&quot;</span>, n_var);
<a name="l05278"></a>05278                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=cmd value=Set&gt;\n&quot;</span>);
<a name="l05279"></a>05279                   n_var++;
<a name="l05280"></a>05280                } <span class="keywordflow">else</span> {
<a name="l05281"></a>05281                   <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l05282"></a>05282                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/CS/%s?exp=%s&amp;cmd=Edit&amp;index=%d\&quot;&gt;&quot;</span>, path,
<a name="l05283"></a>05283                               <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, n_var++);
<a name="l05284"></a>05284                   <span class="keywordflow">else</span>
<a name="l05285"></a>05285                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/CS/%s?cmd=Edit&amp;index=%d\&quot;&gt;&quot;</span>, path, n_var++);
<a name="l05286"></a>05286 
<a name="l05287"></a>05287                   <a class="code" href="mhttpd_8c.html#a0c625fe56e336fc4d14a579b876b9fa8">rsputs</a>(str);
<a name="l05288"></a>05288                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/a&gt;&quot;</span>);
<a name="l05289"></a>05289                }
<a name="l05290"></a>05290             } <span class="keywordflow">else</span>
<a name="l05291"></a>05291                <a class="code" href="mhttpd_8c.html#a0c625fe56e336fc4d14a579b876b9fa8">rsputs</a>(str);
<a name="l05292"></a>05292          }
<a name="l05293"></a>05293 
<a name="l05294"></a>05294 
<a name="l05295"></a>05295       } <span class="keywordflow">while</span> (p != NULL);
<a name="l05296"></a>05296    }
<a name="l05297"></a>05297 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae0eb46ef9cdaf5808d30ed86801578ae"></a><!-- doxytag: member="mhttpd.c::show_delete_page" ref="ae0eb46ef9cdaf5808d30ed86801578ae" args="(char *enc_path, char *dec_path, char *value, int index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_delete_page </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>enc_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dec_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l06297">6297</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="odb_8c_source.html#l02160">db_delete_key()</a>, <a class="el" href="odb_8c_source.html#l03390">db_enum_key()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l02489">db_find_link()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="mhttpd_8c_source.html#l01356">redirect()</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l01502">show_header()</a>, and <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06298"></a>06298 {
<a name="l06299"></a>06299    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l06300"></a>06300    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l06301"></a>06301    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkeyroot, hkey;
<a name="l06302"></a>06302    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l06303"></a>06303 
<a name="l06304"></a>06304    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l06305"></a>06305 
<a name="l06306"></a>06306    <span class="keywordflow">if</span> (<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>[0] == 0) {
<a name="l06307"></a>06307       <span class="comment">/* without value, show delete dialog */</span>
<a name="l06308"></a>06308 
<a name="l06309"></a>06309       <a class="code" href="mhttpd_8c.html#ae5fb6c731656613ead122d173a8ef7a8">show_header</a>(hDB, <span class="stringliteral">&quot;Delete ODB entry&quot;</span>, <span class="stringliteral">&quot;GET&quot;</span>, enc_path, 1, 0);
<a name="l06310"></a>06310 
<a name="l06311"></a>06311       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#A0A0FF colspan=2&gt;Delete ODB entry&lt;/tr&gt;\n&quot;</span>);
<a name="l06312"></a>06312 
<a name="l06313"></a>06313       <span class="comment">/* find key via from */</span>
<a name="l06314"></a>06314       status = <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, dec_path, &amp;hkeyroot);
<a name="l06315"></a>06315       <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l06316"></a>06316          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Error: cannot find key %s&lt;P&gt;\n&quot;</span>, dec_path);
<a name="l06317"></a>06317          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l06318"></a>06318          <span class="keywordflow">return</span>;
<a name="l06319"></a>06319       }
<a name="l06320"></a>06320 
<a name="l06321"></a>06321       <span class="comment">/* count keys */</span>
<a name="l06322"></a>06322       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l06323"></a>06323          <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkeyroot, i, &amp;hkey);
<a name="l06324"></a>06324          <span class="keywordflow">if</span> (!hkey)
<a name="l06325"></a>06325             <span class="keywordflow">break</span>;
<a name="l06326"></a>06326       }
<a name="l06327"></a>06327 
<a name="l06328"></a>06328       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=center colspan=2&gt;&lt;select type=text size=%d name=value&gt;\n&quot;</span>,
<a name="l06329"></a>06329                i);
<a name="l06330"></a>06330 
<a name="l06331"></a>06331       <span class="comment">/* enumerate subkeys */</span>
<a name="l06332"></a>06332       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l06333"></a>06333          <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkeyroot, i, &amp;hkey);
<a name="l06334"></a>06334          <span class="keywordflow">if</span> (!hkey)
<a name="l06335"></a>06335             <span class="keywordflow">break</span>;
<a name="l06336"></a>06336          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l06337"></a>06337          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option&gt; %s\n&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l06338"></a>06338       }
<a name="l06339"></a>06339 
<a name="l06340"></a>06340       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l06341"></a>06341 
<a name="l06342"></a>06342       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=center colspan=2&gt;&quot;</span>);
<a name="l06343"></a>06343       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Delete&gt;&quot;</span>);
<a name="l06344"></a>06344       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Cancel&gt;&quot;</span>);
<a name="l06345"></a>06345       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>);
<a name="l06346"></a>06346       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>);
<a name="l06347"></a>06347 
<a name="l06348"></a>06348       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l06349"></a>06349    } <span class="keywordflow">else</span> {
<a name="l06350"></a>06350       strcpy(str, dec_path);
<a name="l06351"></a>06351       <span class="keywordflow">if</span> (str[strlen(str) - 1] != <span class="charliteral">&apos;/&apos;</span>)
<a name="l06352"></a>06352          strcat(str, <span class="stringliteral">&quot;/&quot;</span>);
<a name="l06353"></a>06353       strcat(str, <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l06354"></a>06354 
<a name="l06355"></a>06355       status = <a class="code" href="group__msectionh.html#ga59083dc8be945d488b2d0708c3d922d6">db_find_link</a>(hDB, 0, str, &amp;hkey);
<a name="l06356"></a>06356       <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l06357"></a>06357          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;h1&gt;Cannot find key %s&lt;/h1&gt;\n&quot;</span>, str);
<a name="l06358"></a>06358          <span class="keywordflow">return</span>;
<a name="l06359"></a>06359       }
<a name="l06360"></a>06360 
<a name="l06361"></a>06361       status = <a class="code" href="group__msectionh.html#ga91277a012e0bfddbc32885da450409e0">db_delete_key</a>(hDB, hkey, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l06362"></a>06362       <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l06363"></a>06363          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;h1&gt;Cannot delete key %s&lt;/h1&gt;\n&quot;</span>, str);
<a name="l06364"></a>06364          <span class="keywordflow">return</span>;
<a name="l06365"></a>06365       }
<a name="l06366"></a>06366 
<a name="l06367"></a>06367       <span class="comment">/* redirect */</span>
<a name="l06368"></a>06368       <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(enc_path);
<a name="l06369"></a>06369       <span class="keywordflow">return</span>;
<a name="l06370"></a>06370    }
<a name="l06371"></a>06371 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a40f54436b506f13b7935d4125538de5f"></a><!-- doxytag: member="mhttpd.c::show_elog_delete" ref="a40f54436b506f13b7935d4125538de5f" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_elog_delete </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l02941">2941</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="midas_8c_source.html#l15854">el_delete_message()</a>, <a class="el" href="midas_8h_source.html#l01110">EL_SUCCESS</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mana_8cpp_source.html#l00800">getparam()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mhttpd_8c_source.html#l01356">redirect()</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l01502">show_header()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02942"></a>02942 {
<a name="l02943"></a>02943    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>;
<a name="l02944"></a>02944    <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l02945"></a>02945    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l02946"></a>02946    <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> allow_delete;
<a name="l02947"></a>02947 
<a name="l02948"></a>02948    <span class="comment">/* get flag for allowing delete */</span>
<a name="l02949"></a>02949    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l02950"></a>02950    allow_delete = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02951"></a>02951    size = <span class="keyword">sizeof</span>(<a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>);
<a name="l02952"></a>02952    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Allow delete&quot;</span>, &amp;allow_delete, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02953"></a>02953 
<a name="l02954"></a>02954    <span class="comment">/* redirect if confirm = NO */</span>
<a name="l02955"></a>02955    <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;confirm&quot;</span>) &amp;&amp; *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;confirm&quot;</span>) &amp;&amp;
<a name="l02956"></a>02956        strcmp(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;confirm&quot;</span>), <span class="stringliteral">&quot;No&quot;</span>) == 0) {
<a name="l02957"></a>02957       sprintf(str, <span class="stringliteral">&quot;EL/%s&quot;</span>, path);
<a name="l02958"></a>02958       <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(str);
<a name="l02959"></a>02959       <span class="keywordflow">return</span>;
<a name="l02960"></a>02960    }
<a name="l02961"></a>02961 
<a name="l02962"></a>02962    <span class="comment">/* header */</span>
<a name="l02963"></a>02963    sprintf(str, <span class="stringliteral">&quot;EL/%s&quot;</span>, path);
<a name="l02964"></a>02964    <a class="code" href="mhttpd_8c.html#ae5fb6c731656613ead122d173a8ef7a8">show_header</a>(hDB, <span class="stringliteral">&quot;Delete ELog entry&quot;</span>, <span class="stringliteral">&quot;GET&quot;</span>, str, 1, 0);
<a name="l02965"></a>02965 
<a name="l02966"></a>02966    <span class="keywordflow">if</span> (!allow_delete) {
<a name="l02967"></a>02967       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02968"></a>02968           (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#FF8080 align=center&gt;&lt;h1&gt;Message deletion disabled in ODB&lt;/h1&gt;\n&quot;</span>);
<a name="l02969"></a>02969    } <span class="keywordflow">else</span> {
<a name="l02970"></a>02970       <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;confirm&quot;</span>) &amp;&amp; *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;confirm&quot;</span>)) {
<a name="l02971"></a>02971          <span class="keywordflow">if</span> (strcmp(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;confirm&quot;</span>), <span class="stringliteral">&quot;Yes&quot;</span>) == 0) {
<a name="l02972"></a>02972             <span class="comment">/* delete message */</span>
<a name="l02973"></a>02973             status = <a class="code" href="group__msectionh.html#gaee2371b60bdd7a430fefee415d5d4a3e">el_delete_message</a>(path);
<a name="l02974"></a>02974             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#80FF80 align=center&gt;&quot;</span>);
<a name="l02975"></a>02975             <span class="keywordflow">if</span> (status == <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a>)
<a name="l02976"></a>02976                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;b&gt;Message successfully deleted&lt;/b&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l02977"></a>02977             <span class="keywordflow">else</span>
<a name="l02978"></a>02978                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;b&gt;Error deleting message: status = %d&lt;/b&gt;&lt;/tr&gt;\n&quot;</span>, status);
<a name="l02979"></a>02979 
<a name="l02980"></a>02980             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=cmd value=last&gt;\n&quot;</span>);
<a name="l02981"></a>02981             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02982"></a>02982                 (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 align=center&gt;&lt;input type=submit value=\&quot;Goto last message\&quot;&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l02983"></a>02983          }
<a name="l02984"></a>02984       } <span class="keywordflow">else</span> {
<a name="l02985"></a>02985          <span class="comment">/* define hidden field for command */</span>
<a name="l02986"></a>02986          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=cmd value=delete&gt;\n&quot;</span>);
<a name="l02987"></a>02987 
<a name="l02988"></a>02988          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#FF8080 align=center&gt;&quot;</span>);
<a name="l02989"></a>02989          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;b&gt;Are you sure to delete this message?&lt;/b&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l02990"></a>02990 
<a name="l02991"></a>02991          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=center&gt;&lt;input type=submit name=confirm value=Yes&gt;\n&quot;</span>);
<a name="l02992"></a>02992          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;&lt;input type=submit name=confirm value=No&gt;\n&quot;</span>);
<a name="l02993"></a>02993          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n\n&quot;</span>);
<a name="l02994"></a>02994       }
<a name="l02995"></a>02995    }
<a name="l02996"></a>02996 
<a name="l02997"></a>02997    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>);
<a name="l02998"></a>02998    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l02999"></a>02999 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a20b81ae6551aa9bd26ecd6057d3442ab"></a><!-- doxytag: member="mhttpd.c::show_elog_new" ref="a20b81ae6551aa9bd26ecd6057d3442ab" args="(char *path, BOOL bedit, char *odb_att)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_elog_new </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td>
          <td class="paramname"> <em>bedit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>odb_att</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l02506">2506</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="odb_8c_source.html#l03128">db_set_value()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="midas_8c_source.html#l15633">el_retrieve()</a>, <a class="el" href="mhttpd_8c_source.html#l00891">elog_mode</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l00959">rsputs()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00323">run_number</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="bit3__mvme_2mvmestd_8h_source.html#l00045">SUCCESS</a>, <a class="el" href="mhttpd_8c_source.html#l00924">system_list</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, <a class="el" href="mana_8cpp_source.html#l00675">type</a>, and <a class="el" href="mhttpd_8c_source.html#l00909">type_list</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>, and <a class="el" href="mhttpd_8c_source.html#l08606">show_hist_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02507"></a>02507 {
<a name="l02508"></a>02508    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a16695ea2bfd19f294afe066d6007ab36">run_number</a>, wrap, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l02509"></a>02509    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], ref[256], *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>;
<a name="l02510"></a>02510    <span class="keywordtype">char</span> date[80], author[80], <a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>[80], system[80], subject[256], text[10000],
<a name="l02511"></a>02511        orig_tag[80], reply_tag[80], att1[256], att2[256], att3[256], encoding[80];
<a name="l02512"></a>02512    time_t now;
<a name="l02513"></a>02513    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey, hsubkey;
<a name="l02514"></a>02514    <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> display_run_number;
<a name="l02515"></a>02515    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l02516"></a>02516 
<a name="l02517"></a>02517    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l02518"></a>02518    display_run_number = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02519"></a>02519    size = <span class="keyword">sizeof</span>(<a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>);
<a name="l02520"></a>02520    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Display run number&quot;</span>, &amp;display_run_number, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>,
<a name="l02521"></a>02521                 <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02522"></a>02522 
<a name="l02523"></a>02523    <span class="comment">/* get message for reply */</span>
<a name="l02524"></a>02524    type[0] = system[0] = 0;
<a name="l02525"></a>02525    att1[0] = att2[0] = att3[0] = 0;
<a name="l02526"></a>02526    subject[0] = 0;
<a name="l02527"></a>02527    run_number = 0;
<a name="l02528"></a>02528 
<a name="l02529"></a>02529    <span class="keywordflow">if</span> (path) {
<a name="l02530"></a>02530       strcpy(str, path);
<a name="l02531"></a>02531       size = <span class="keyword">sizeof</span>(text);
<a name="l02532"></a>02532       <a class="code" href="group__msectionh.html#ga203cfa8e2d036e5e56a2fdd9d17eb09d">el_retrieve</a>(str, date, &amp;run_number, author, type, system, subject,
<a name="l02533"></a>02533                   text, &amp;size, orig_tag, reply_tag, att1, att2, att3, encoding);
<a name="l02534"></a>02534    }
<a name="l02535"></a>02535 
<a name="l02536"></a>02536    <span class="keywordflow">if</span> (run_number &lt; 0) {
<a name="l02537"></a>02537       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;show_elog_new&quot;</span>, <span class="stringliteral">&quot;aborting on attempt to use invalid run number %d&quot;</span>,
<a name="l02538"></a>02538              run_number);
<a name="l02539"></a>02539       abort();
<a name="l02540"></a>02540    }
<a name="l02541"></a>02541 
<a name="l02542"></a>02542    <span class="comment">/* header */</span>
<a name="l02543"></a>02543    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l02544"></a>02544    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l02545"></a>02545    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l02546"></a>02546 
<a name="l02547"></a>02547    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;MIDAS ELog&lt;/title&gt;&lt;/head&gt;\n&quot;</span>);
<a name="l02548"></a>02548    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02549"></a>02549        (<span class="stringliteral">&quot;&lt;body&gt;&lt;form method=\&quot;POST\&quot; action=\&quot;/EL/\&quot; enctype=\&quot;multipart/form-data\&quot;&gt;\n&quot;</span>);
<a name="l02550"></a>02550 
<a name="l02551"></a>02551    <span class="comment">/* define hidden field for experiment */</span>
<a name="l02552"></a>02552    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l02553"></a>02553       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=exp value=\&quot;%s\&quot;&gt;\n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l02554"></a>02554 
<a name="l02555"></a>02555    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;table border=3 cellpadding=5&gt;\n&quot;</span>);
<a name="l02556"></a>02556 
<a name="l02557"></a>02557   <span class="comment">/*---- title row ----*/</span>
<a name="l02558"></a>02558 
<a name="l02559"></a>02559    size = <span class="keyword">sizeof</span>(str);
<a name="l02560"></a>02560    str[0] = 0;
<a name="l02561"></a>02561    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Name&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02562"></a>02562 
<a name="l02563"></a>02563    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#A0A0FF&gt;MIDAS Electronic Logbook&quot;</span>);
<a name="l02564"></a>02564    <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#a9c91f81733a48f1fbc887b013ee0de14">elog_mode</a>)
<a name="l02565"></a>02565       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th bgcolor=#A0A0FF&gt;Logbook \&quot;%s\&quot;&lt;/tr&gt;\n&quot;</span>, str);
<a name="l02566"></a>02566    <span class="keywordflow">else</span>
<a name="l02567"></a>02567       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th bgcolor=#A0A0FF&gt;Experiment \&quot;%s\&quot;&lt;/tr&gt;\n&quot;</span>, str);
<a name="l02568"></a>02568 
<a name="l02569"></a>02569   <span class="comment">/*---- menu buttons ----*/</span>
<a name="l02570"></a>02570 
<a name="l02571"></a>02571    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l02572"></a>02572 
<a name="l02573"></a>02573    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Submit&gt;\n&quot;</span>);
<a name="l02574"></a>02574    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n\n&quot;</span>);
<a name="l02575"></a>02575 
<a name="l02576"></a>02576   <span class="comment">/*---- entry form ----*/</span>
<a name="l02577"></a>02577 
<a name="l02578"></a>02578    <span class="keywordflow">if</span> (display_run_number) {
<a name="l02579"></a>02579       <span class="keywordflow">if</span> (bedit) {
<a name="l02580"></a>02580          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;Entry date: %s&lt;br&gt;&quot;</span>, date);
<a name="l02581"></a>02581          <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l02582"></a>02582          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Revision date: %s&quot;</span>, ctime(&amp;now));
<a name="l02583"></a>02583       } <span class="keywordflow">else</span> {
<a name="l02584"></a>02584          <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l02585"></a>02585          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;Entry date: %s&quot;</span>, ctime(&amp;now));
<a name="l02586"></a>02586       }
<a name="l02587"></a>02587 
<a name="l02588"></a>02588       <span class="keywordflow">if</span> (!bedit) {
<a name="l02589"></a>02589          run_number = 0;
<a name="l02590"></a>02590          size = <span class="keyword">sizeof</span>(run_number);
<a name="l02591"></a>02591          status =
<a name="l02592"></a>02592              <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Runinfo/Run number&quot;</span>, &amp;run_number, &amp;size, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>,
<a name="l02593"></a>02593                           <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02594"></a>02594          assert(status == <a class="code" href="group__mvmestdinclude.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>);
<a name="l02595"></a>02595       }
<a name="l02596"></a>02596 
<a name="l02597"></a>02597       <span class="keywordflow">if</span> (run_number &lt; 0) {
<a name="l02598"></a>02598          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;show_elog_new&quot;</span>,
<a name="l02599"></a>02599                 <span class="stringliteral">&quot;aborting on attempt to use invalid run number %d&quot;</span>, run_number);
<a name="l02600"></a>02600          abort();
<a name="l02601"></a>02601       }
<a name="l02602"></a>02602 
<a name="l02603"></a>02603       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#FFFF00&gt;Run number: &quot;</span>);
<a name="l02604"></a>02604       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=\&quot;text\&quot; size=10 maxlength=10 name=\&quot;run\&quot; value=\&quot;%d\&quot;&lt;/tr&gt;&quot;</span>,
<a name="l02605"></a>02605                run_number);
<a name="l02606"></a>02606    } <span class="keywordflow">else</span> {
<a name="l02607"></a>02607       <span class="keywordflow">if</span> (bedit) {
<a name="l02608"></a>02608          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#FFFF00&gt;Entry date: %s&lt;br&gt;&quot;</span>, date);
<a name="l02609"></a>02609          <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l02610"></a>02610          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Revision date: %s&quot;</span>, ctime(&amp;now));
<a name="l02611"></a>02611       } <span class="keywordflow">else</span> {
<a name="l02612"></a>02612          <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l02613"></a>02613          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#FFFF00&gt;Entry date: %s&quot;</span>, ctime(&amp;now));
<a name="l02614"></a>02614       }
<a name="l02615"></a>02615    }
<a name="l02616"></a>02616 
<a name="l02617"></a>02617    <span class="keywordflow">if</span> (bedit) {
<a name="l02618"></a>02618       strcpy(str, author);
<a name="l02619"></a>02619       <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;@&apos;</span>))
<a name="l02620"></a>02620          *strchr(str, <span class="charliteral">&apos;@&apos;</span>) = 0;
<a name="l02621"></a>02621    } <span class="keywordflow">else</span>
<a name="l02622"></a>02622       str[0] = 0;
<a name="l02623"></a>02623 
<a name="l02624"></a>02624    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02625"></a>02625        (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFA0A0&gt;Author: &lt;input type=\&quot;text\&quot; size=\&quot;15\&quot; maxlength=\&quot;80\&quot; name=\&quot;Author\&quot; value=\&quot;%s\&quot;&gt;\n&quot;</span>,
<a name="l02626"></a>02626         str);
<a name="l02627"></a>02627 
<a name="l02628"></a>02628    <span class="comment">/* get type list from ODB */</span>
<a name="l02629"></a>02629    size = 20 * <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>;
<a name="l02630"></a>02630    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Types&quot;</span>, &amp;hkey) != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l02631"></a>02631       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Types&quot;</span>, <a class="code" href="mhttpd_8c.html#a204c9ddc30d18e95a386f1e6734e66f4">type_list</a>, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a> * 20, 20, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l02632"></a>02632    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Types&quot;</span>, &amp;hkey);
<a name="l02633"></a>02633    <span class="keywordflow">if</span> (hkey)
<a name="l02634"></a>02634       <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, <a class="code" href="mhttpd_8c.html#a204c9ddc30d18e95a386f1e6734e66f4">type_list</a>, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l02635"></a>02635 
<a name="l02636"></a>02636    <span class="comment">/* add types from forms */</span>
<a name="l02637"></a>02637    <span class="keywordflow">for</span> (j = 0; j &lt; 20 &amp;&amp; <a class="code" href="mhttpd_8c.html#a204c9ddc30d18e95a386f1e6734e66f4">type_list</a>[j][0]; j++);
<a name="l02638"></a>02638    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Forms&quot;</span>, &amp;hkey);
<a name="l02639"></a>02639    <span class="keywordflow">if</span> (hkey)
<a name="l02640"></a>02640       <span class="keywordflow">for</span> (i = 0; j &lt; 20; i++) {
<a name="l02641"></a>02641          <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkey, i, &amp;hsubkey);
<a name="l02642"></a>02642          <span class="keywordflow">if</span> (!hsubkey)
<a name="l02643"></a>02643             <span class="keywordflow">break</span>;
<a name="l02644"></a>02644 
<a name="l02645"></a>02645          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hsubkey, &amp;key);
<a name="l02646"></a>02646          strncpy(type_list[j++], key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>);
<a name="l02647"></a>02647       }
<a name="l02648"></a>02648 
<a name="l02649"></a>02649    <span class="comment">/* get system list from ODB */</span>
<a name="l02650"></a>02650    size = 20 * <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>;
<a name="l02651"></a>02651    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Systems&quot;</span>, &amp;hkey) != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l02652"></a>02652       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Systems&quot;</span>, <a class="code" href="mhttpd_8c.html#a63288067ecc0045da645c023c6867ecc">system_list</a>, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a> * 20, 20,
<a name="l02653"></a>02653                    <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l02654"></a>02654    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Systems&quot;</span>, &amp;hkey);
<a name="l02655"></a>02655    <span class="keywordflow">if</span> (hkey)
<a name="l02656"></a>02656       <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, <a class="code" href="mhttpd_8c.html#a63288067ecc0045da645c023c6867ecc">system_list</a>, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l02657"></a>02657 
<a name="l02658"></a>02658    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l02659"></a>02659       sprintf(ref, <span class="stringliteral">&quot;/ELog/?exp=%s&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l02660"></a>02660    <span class="keywordflow">else</span>
<a name="l02661"></a>02661       sprintf(ref, <span class="stringliteral">&quot;/ELog/&quot;</span>);
<a name="l02662"></a>02662 
<a name="l02663"></a>02663    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02664"></a>02664        (<span class="stringliteral">&quot;&lt;td bgcolor=#FFA0A0&gt;&lt;a href=\&quot;%s\&quot; target=\&quot;_blank\&quot;&gt;Type:&lt;/a&gt; &lt;select name=\&quot;type\&quot;&gt;\n&quot;</span>,
<a name="l02665"></a>02665         ref);
<a name="l02666"></a>02666    <span class="keywordflow">for</span> (i = 0; i &lt; 20 &amp;&amp; type_list[i][0]; i++)
<a name="l02667"></a>02667       <span class="keywordflow">if</span> ((path &amp;&amp; !bedit &amp;&amp; <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(type_list[i], <span class="stringliteral">&quot;reply&quot;</span>)) ||
<a name="l02668"></a>02668           (bedit &amp;&amp; <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(type_list[i], type)))
<a name="l02669"></a>02669          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, type_list[i], type_list[i]);
<a name="l02670"></a>02670       <span class="keywordflow">else</span>
<a name="l02671"></a>02671          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, type_list[i], type_list[i]);
<a name="l02672"></a>02672    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l02673"></a>02673 
<a name="l02674"></a>02674    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02675"></a>02675        (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#A0FFA0&gt;&lt;a href=\&quot;%s\&quot; target=\&quot;_blank\&quot;&gt;  System:&lt;/a&gt; &lt;select name=\&quot;system\&quot;&gt;\n&quot;</span>,
<a name="l02676"></a>02676         ref);
<a name="l02677"></a>02677    <span class="keywordflow">for</span> (i = 0; i &lt; 20 &amp;&amp; <a class="code" href="mhttpd_8c.html#a63288067ecc0045da645c023c6867ecc">system_list</a>[i][0]; i++)
<a name="l02678"></a>02678       <span class="keywordflow">if</span> (path &amp;&amp; <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(system_list[i], system))
<a name="l02679"></a>02679          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, system_list[i], system_list[i]);
<a name="l02680"></a>02680       <span class="keywordflow">else</span>
<a name="l02681"></a>02681          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, system_list[i], system_list[i]);
<a name="l02682"></a>02682    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;\n&quot;</span>);
<a name="l02683"></a>02683 
<a name="l02684"></a>02684    str[0] = 0;
<a name="l02685"></a>02685    <span class="keywordflow">if</span> (path &amp;&amp; !bedit)
<a name="l02686"></a>02686       sprintf(str, <span class="stringliteral">&quot;Re: %s&quot;</span>, subject);
<a name="l02687"></a>02687    <span class="keywordflow">else</span>
<a name="l02688"></a>02688       sprintf(str, <span class="stringliteral">&quot;%s&quot;</span>, subject);
<a name="l02689"></a>02689    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02690"></a>02690        (<span class="stringliteral">&quot;&lt;td bgcolor=#A0FFA0&gt;Subject: &lt;input type=text size=20 maxlength=\&quot;80\&quot; name=Subject value=\&quot;%s\&quot;&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l02691"></a>02691         str);
<a name="l02692"></a>02692 
<a name="l02693"></a>02693    <span class="keywordflow">if</span> (path) {
<a name="l02694"></a>02694       <span class="comment">/* hidden text for original message */</span>
<a name="l02695"></a>02695       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=orig value=\&quot;%s\&quot;&gt;\n&quot;</span>, path);
<a name="l02696"></a>02696 
<a name="l02697"></a>02697       <span class="keywordflow">if</span> (bedit)
<a name="l02698"></a>02698          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=edit value=1&gt;\n&quot;</span>);
<a name="l02699"></a>02699    }
<a name="l02700"></a>02700 
<a name="l02701"></a>02701    <span class="comment">/* increased wrapping for replys (leave space for &apos;&gt; &apos; */</span>
<a name="l02702"></a>02702    wrap = (path &amp;&amp; !bedit) ? 78 : 76;
<a name="l02703"></a>02703 
<a name="l02704"></a>02704    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2&gt;Text:&lt;br&gt;\n&quot;</span>);
<a name="l02705"></a>02705    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;textarea rows=10 cols=%d wrap=hard name=Text&gt;&quot;</span>, wrap);
<a name="l02706"></a>02706 
<a name="l02707"></a>02707    <span class="keywordflow">if</span> (path) {
<a name="l02708"></a>02708       <span class="keywordflow">if</span> (bedit) {
<a name="l02709"></a>02709          <a class="code" href="mhttpd_8c.html#a0c625fe56e336fc4d14a579b876b9fa8">rsputs</a>(text);
<a name="l02710"></a>02710       } <span class="keywordflow">else</span> {
<a name="l02711"></a>02711          p = text;
<a name="l02712"></a>02712          <span class="keywordflow">do</span> {
<a name="l02713"></a>02713             <span class="keywordflow">if</span> (strchr(p, <span class="charliteral">&apos;\r&apos;</span>)) {
<a name="l02714"></a>02714                *strchr(p, <span class="charliteral">&apos;\r&apos;</span>) = 0;
<a name="l02715"></a>02715                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&gt; %s\n&quot;</span>, p);
<a name="l02716"></a>02716                p += strlen(p) + 1;
<a name="l02717"></a>02717                <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;\n&apos;</span>)
<a name="l02718"></a>02718                   p++;
<a name="l02719"></a>02719             } <span class="keywordflow">else</span> {
<a name="l02720"></a>02720                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&gt; %s\n\n&quot;</span>, p);
<a name="l02721"></a>02721                <span class="keywordflow">break</span>;
<a name="l02722"></a>02722             }
<a name="l02723"></a>02723 
<a name="l02724"></a>02724          } <span class="keywordflow">while</span> (<a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02725"></a>02725       }
<a name="l02726"></a>02726    }
<a name="l02727"></a>02727 
<a name="l02728"></a>02728    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/textarea&gt;&lt;br&gt;\n&quot;</span>);
<a name="l02729"></a>02729 
<a name="l02730"></a>02730    <span class="comment">/* HTML check box */</span>
<a name="l02731"></a>02731    <span class="keywordflow">if</span> (bedit &amp;&amp; encoding[0] == <span class="charliteral">&apos;H&apos;</span>)
<a name="l02732"></a>02732       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02733"></a>02733           (<span class="stringliteral">&quot;&lt;input type=checkbox checked name=html value=1&gt;Submit as HTML text&lt;/tr&gt;\n&quot;</span>);
<a name="l02734"></a>02734    <span class="keywordflow">else</span>
<a name="l02735"></a>02735       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=checkbox name=html value=1&gt;Submit as HTML text&lt;/tr&gt;\n&quot;</span>);
<a name="l02736"></a>02736 
<a name="l02737"></a>02737    <span class="keywordflow">if</span> (bedit &amp;&amp; att1[0])
<a name="l02738"></a>02738       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02739"></a>02739           (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 align=center bgcolor=#8080FF&gt;If no attachment are resubmitted, the original ones are kept&lt;/tr&gt;\n&quot;</span>);
<a name="l02740"></a>02740 
<a name="l02741"></a>02741    <span class="comment">/* attachment */</span>
<a name="l02742"></a>02742    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02743"></a>02743        (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 align=center&gt;Enter attachment filename(s) or ODB tree(s), use \&quot;\\\&quot; as an ODB directory separator:&lt;/tr&gt;&quot;</span>);
<a name="l02744"></a>02744 
<a name="l02745"></a>02745    <span class="keywordflow">if</span> (odb_att) {
<a name="l02746"></a>02746       str[0] = 0;
<a name="l02747"></a>02747       <span class="keywordflow">if</span> (odb_att[0] != <span class="charliteral">&apos;\\&apos;</span> &amp;&amp; odb_att[0] != <span class="charliteral">&apos;/&apos;</span>)
<a name="l02748"></a>02748          strcpy(str, <span class="stringliteral">&quot;\\&quot;</span>);
<a name="l02749"></a>02749       strcat(str, odb_att);
<a name="l02750"></a>02750       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02751"></a>02751           (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2&gt;Attachment1: &lt;input type=hidden name=attachment0 value=\&quot;%s\&quot;&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l02752"></a>02752            str, str);
<a name="l02753"></a>02753    } <span class="keywordflow">else</span>
<a name="l02754"></a>02754       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02755"></a>02755           (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2&gt;Attachment1: &lt;input type=\&quot;file\&quot; size=\&quot;60\&quot; maxlength=\&quot;256\&quot; name=\&quot;attfile1\&quot; value=\&quot;%s\&quot; accept=\&quot;filetype/*\&quot;&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l02756"></a>02756            att1);
<a name="l02757"></a>02757 
<a name="l02758"></a>02758    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02759"></a>02759        (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2&gt;Attachment2: &lt;input type=\&quot;file\&quot; size=\&quot;60\&quot; maxlength=\&quot;256\&quot; name=\&quot;attfile2\&quot; value=\&quot;%s\&quot; accept=\&quot;filetype/*\&quot;&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l02760"></a>02760         att2);
<a name="l02761"></a>02761    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02762"></a>02762        (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2&gt;Attachment3: &lt;input type=\&quot;file\&quot; size=\&quot;60\&quot; maxlength=\&quot;256\&quot; name=\&quot;attfile3\&quot; value=\&quot;%s\&quot; accept=\&quot;filetype/*\&quot;&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l02763"></a>02763         att3);
<a name="l02764"></a>02764 
<a name="l02765"></a>02765    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>);
<a name="l02766"></a>02766    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l02767"></a>02767 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6e9bc2cc0beb7aaf1d47824927dab3ff"></a><!-- doxytag: member="mhttpd.c::show_elog_page" ref="a6e9bc2cc0beb7aaf1d47824927dab3ff" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_elog_page </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l04103">4103</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="odb_8c_source.html#l01721">db_create_key()</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04376">db_get_data_index()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="odb_8c_source.html#l04503">db_set_data()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l00639">DIR_SEPARATOR</a>, <a class="el" href="midas_8h_source.html#l00640">DIR_SEPARATOR_STR</a>, <a class="el" href="midas_8h_source.html#l01111">EL_FILE_ERROR</a>, <a class="el" href="midas_8c_source.html#l15633">el_retrieve()</a>, <a class="el" href="midas_8c_source.html#l15379">el_search_message()</a>, <a class="el" href="midas_8h_source.html#l01110">EL_SUCCESS</a>, <a class="el" href="mhttpd_8c_source.html#l00891">elog_mode</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="mhttpd_8c_source.html#l00935">ext</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="odbhist_8c_source.html#l00059">file_name</a>, <a class="el" href="mhttpd_8c.html#ab9ec7b8b41990fd9f8dc4d6167c0dc4c">filetype</a>, <a class="el" href="mana_8cpp_source.html#l00800">getparam()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="FDCR_8h_source.html#l00008">length</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="midas_8h_source.html#l01316">KEY::num_values</a>, <a class="el" href="msystem_8h_source.html#l00351">O_BINARY</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00256">read</a>, <a class="el" href="mhttpd_8c_source.html#l01356">redirect()</a>, <a class="el" href="mhttpd_8c_source.html#l00870">return_buffer</a>, <a class="el" href="mhttpd_8c_source.html#l00872">return_length</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l00959">rsputs()</a>, <a class="el" href="mhttpd_8c_source.html#l00972">rsputs2()</a>, <a class="el" href="odbhist_8c_source.html#l00057">run</a>, <a class="el" href="mhttpd_8c_source.html#l02941">show_elog_delete()</a>, <a class="el" href="mhttpd_8c_source.html#l02506">show_elog_new()</a>, <a class="el" href="mhttpd_8c_source.html#l02771">show_elog_query()</a>, <a class="el" href="mhttpd_8c_source.html#l03003">show_elog_submit_query()</a>, <a class="el" href="mhttpd_8c_source.html#l03588">show_form_query()</a>, <a class="el" href="mhttpd_8c_source.html#l03449">show_rawfile()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="mhttpd_8c_source.html#l03805">submit_elog()</a>, <a class="el" href="mhttpd_8c_source.html#l04034">submit_form()</a>, <a class="el" href="msystem_8h_source.html#l00369">TELL</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04104"></a>04104 {
<a name="l04105"></a>04105    <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a369e3b30815f09142abc86f462a501ff">run</a>, msg_status, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, fh, <a class="code" href="FDCR_8h.html#a9f59b34b1f25fe00023291b678246bcc">length</a>, first_message, last_message, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>;
<a name="l04106"></a>04106    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], orig_path[256], command[80], ref[256], <a class="code" href="odbhist_8c.html#a4da1fcf44864d811e793f03bf36e6e17">file_name</a>[256];
<a name="l04107"></a>04107    <span class="keywordtype">char</span> date[80], author[80], <a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>[80], system[80], subject[256], text[10000],
<a name="l04108"></a>04108        orig_tag[80], reply_tag[80], attachment[3][256], encoding[80], att[256];
<a name="l04109"></a>04109    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey, hkeyroot, hkeybutton;
<a name="l04110"></a>04110    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l04111"></a>04111    FILE *f;
<a name="l04112"></a>04112    <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> display_run_number, allow_delete;
<a name="l04113"></a>04113    <span class="keywordtype">char</span> def_button[][<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>] = { <span class="stringliteral">&quot;8h&quot;</span>, <span class="stringliteral">&quot;24h&quot;</span>, <span class="stringliteral">&quot;7d&quot;</span> };
<a name="l04114"></a>04114 
<a name="l04115"></a>04115    <span class="comment">/* get flag for displaying run number and allow delete */</span>
<a name="l04116"></a>04116    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l04117"></a>04117    display_run_number = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l04118"></a>04118    allow_delete = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l04119"></a>04119    size = <span class="keyword">sizeof</span>(<a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>);
<a name="l04120"></a>04120    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Display run number&quot;</span>, &amp;display_run_number, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>,
<a name="l04121"></a>04121                 <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l04122"></a>04122    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Allow delete&quot;</span>, &amp;allow_delete, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l04123"></a>04123 
<a name="l04124"></a>04124    <span class="comment">/*---- interprete commands ---------------------------------------*/</span>
<a name="l04125"></a>04125 
<a name="l04126"></a>04126    strcpy(command, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>));
<a name="l04127"></a>04127 
<a name="l04128"></a>04128    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;form&quot;</span>)) {
<a name="l04129"></a>04129       <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;type&quot;</span>)) {
<a name="l04130"></a>04130          sprintf(str, <span class="stringliteral">&quot;EL/?form=%s&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;form&quot;</span>));
<a name="l04131"></a>04131          <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(str);
<a name="l04132"></a>04132          <span class="keywordflow">return</span>;
<a name="l04133"></a>04133       }
<a name="l04134"></a>04134       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;submit&quot;</span>))
<a name="l04135"></a>04135          <a class="code" href="mhttpd_8c.html#a79eec108616ceddc04c6dcb076387aea">submit_form</a>();
<a name="l04136"></a>04136       <span class="keywordflow">else</span>
<a name="l04137"></a>04137          <a class="code" href="mhttpd_8c.html#af66885df3b396f0b6193e07753159c2d">show_form_query</a>();
<a name="l04138"></a>04138       <span class="keywordflow">return</span>;
<a name="l04139"></a>04139    }
<a name="l04140"></a>04140 
<a name="l04141"></a>04141    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;new&quot;</span>)) {
<a name="l04142"></a>04142       <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;file&quot;</span>))
<a name="l04143"></a>04143          <a class="code" href="mhttpd_8c.html#a20b81ae6551aa9bd26ecd6057d3442ab">show_elog_new</a>(NULL, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;file&quot;</span>));
<a name="l04144"></a>04144       <span class="keywordflow">else</span>
<a name="l04145"></a>04145          <a class="code" href="mhttpd_8c.html#a20b81ae6551aa9bd26ecd6057d3442ab">show_elog_new</a>(NULL, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, NULL);
<a name="l04146"></a>04146       <span class="keywordflow">return</span>;
<a name="l04147"></a>04147    }
<a name="l04148"></a>04148 
<a name="l04149"></a>04149    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;Create ELog from this page&quot;</span>)) {
<a name="l04150"></a>04150       strcpy(str, path);
<a name="l04151"></a>04151       <span class="keywordflow">while</span> (strchr(path, <span class="charliteral">&apos;/&apos;</span>))
<a name="l04152"></a>04152          *strchr(path, <span class="charliteral">&apos;/&apos;</span>) = <span class="charliteral">&apos;\\&apos;</span>;
<a name="l04153"></a>04153 
<a name="l04154"></a>04154       <a class="code" href="mhttpd_8c.html#a20b81ae6551aa9bd26ecd6057d3442ab">show_elog_new</a>(NULL, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, path);
<a name="l04155"></a>04155       <span class="keywordflow">return</span>;
<a name="l04156"></a>04156    }
<a name="l04157"></a>04157 
<a name="l04158"></a>04158    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;edit&quot;</span>)) {
<a name="l04159"></a>04159       <a class="code" href="mhttpd_8c.html#a20b81ae6551aa9bd26ecd6057d3442ab">show_elog_new</a>(path, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, NULL);
<a name="l04160"></a>04160       <span class="keywordflow">return</span>;
<a name="l04161"></a>04161    }
<a name="l04162"></a>04162 
<a name="l04163"></a>04163    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;reply&quot;</span>)) {
<a name="l04164"></a>04164       <a class="code" href="mhttpd_8c.html#a20b81ae6551aa9bd26ecd6057d3442ab">show_elog_new</a>(path, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, NULL);
<a name="l04165"></a>04165       <span class="keywordflow">return</span>;
<a name="l04166"></a>04166    }
<a name="l04167"></a>04167 
<a name="l04168"></a>04168    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;submit&quot;</span>)) {
<a name="l04169"></a>04169       <a class="code" href="mhttpd_8c.html#a7da098af5efaf5b7e9f01e8d8a3d019a">submit_elog</a>();
<a name="l04170"></a>04170       <span class="keywordflow">return</span>;
<a name="l04171"></a>04171    }
<a name="l04172"></a>04172 
<a name="l04173"></a>04173    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;query&quot;</span>)) {
<a name="l04174"></a>04174       <a class="code" href="mhttpd_8c.html#a1ec76c094a5ba43c43a698f0f7d6b6e5">show_elog_query</a>();
<a name="l04175"></a>04175       <span class="keywordflow">return</span>;
<a name="l04176"></a>04176    }
<a name="l04177"></a>04177 
<a name="l04178"></a>04178    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;submit query&quot;</span>)) {
<a name="l04179"></a>04179       <a class="code" href="mhttpd_8c.html#aa7c5a2983f221f65fb6415ab1fadce70">show_elog_submit_query</a>(0);
<a name="l04180"></a>04180       <span class="keywordflow">return</span>;
<a name="l04181"></a>04181    }
<a name="l04182"></a>04182 
<a name="l04183"></a>04183    <span class="keywordflow">if</span> (strncmp(command, <span class="stringliteral">&quot;Last &quot;</span>, 5) == 0) {
<a name="l04184"></a>04184       <span class="keywordflow">if</span> (command[strlen(command) - 1] == <span class="charliteral">&apos;h&apos;</span>)
<a name="l04185"></a>04185          sprintf(str, <span class="stringliteral">&quot;EL/last%d&quot;</span>, atoi(command + 5));
<a name="l04186"></a>04186       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command[strlen(command) - 1] == <span class="charliteral">&apos;d&apos;</span>)
<a name="l04187"></a>04187          sprintf(str, <span class="stringliteral">&quot;EL/last%d&quot;</span>, atoi(command + 5) * 24);
<a name="l04188"></a>04188 
<a name="l04189"></a>04189       <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(str);
<a name="l04190"></a>04190       <span class="keywordflow">return</span>;
<a name="l04191"></a>04191    }
<a name="l04192"></a>04192 
<a name="l04193"></a>04193    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;delete&quot;</span>)) {
<a name="l04194"></a>04194       <a class="code" href="mhttpd_8c.html#a40f54436b506f13b7935d4125538de5f">show_elog_delete</a>(path);
<a name="l04195"></a>04195       <span class="keywordflow">return</span>;
<a name="l04196"></a>04196    }
<a name="l04197"></a>04197 
<a name="l04198"></a>04198    <span class="keywordflow">if</span> (strncmp(path, <span class="stringliteral">&quot;last&quot;</span>, 4) == 0) {
<a name="l04199"></a>04199       <a class="code" href="mhttpd_8c.html#aa7c5a2983f221f65fb6415ab1fadce70">show_elog_submit_query</a>(atoi(path + 4));
<a name="l04200"></a>04200       <span class="keywordflow">return</span>;
<a name="l04201"></a>04201    }
<a name="l04202"></a>04202 
<a name="l04203"></a>04203    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;runlog&quot;</span>)) {
<a name="l04204"></a>04204       sprintf(str, <span class="stringliteral">&quot;EL/runlog.txt&quot;</span>);
<a name="l04205"></a>04205       <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(str);
<a name="l04206"></a>04206       <span class="keywordflow">return</span>;
<a name="l04207"></a>04207    }
<a name="l04208"></a>04208 
<a name="l04209"></a>04209   <span class="comment">/*---- check if file requested -----------------------------------*/</span>
<a name="l04210"></a>04210 
<a name="l04211"></a>04211    <span class="keywordflow">if</span> (strlen(path) &gt; 13 &amp;&amp; path[6] == <span class="charliteral">&apos;_&apos;</span> &amp;&amp; path[13] == <span class="charliteral">&apos;_&apos;</span>) {
<a name="l04212"></a>04212       <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l04213"></a>04213       file_name[0] = 0;
<a name="l04214"></a>04214       <span class="keywordflow">if</span> (hDB &gt; 0) {
<a name="l04215"></a>04215          size = <span class="keyword">sizeof</span>(file_name);
<a name="l04216"></a>04216          memset(file_name, 0, size);
<a name="l04217"></a>04217 
<a name="l04218"></a>04218          status =
<a name="l04219"></a>04219              <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Elog dir&quot;</span>, file_name, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>,
<a name="l04220"></a>04220                           <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l04221"></a>04221          <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l04222"></a>04222             <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Data dir&quot;</span>, file_name, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l04223"></a>04223 
<a name="l04224"></a>04224          <span class="keywordflow">if</span> (file_name[0] != 0)
<a name="l04225"></a>04225             <span class="keywordflow">if</span> (file_name[strlen(file_name) - 1] != <a class="code" href="group__midasincludecode.html#ga0920890c442b665b0c6609fa796e9047">DIR_SEPARATOR</a>)
<a name="l04226"></a>04226                strcat(file_name, <a class="code" href="group__midasincludecode.html#ga23e72ca2d8456a971c13441bdfc4586f">DIR_SEPARATOR_STR</a>);
<a name="l04227"></a>04227       }
<a name="l04228"></a>04228       strcat(file_name, path);
<a name="l04229"></a>04229 
<a name="l04230"></a>04230       fh = open(file_name, O_RDONLY | <a class="code" href="group__msystemincludecode.html#ga36fa9b2e726512bc17a7a6d3e39002be">O_BINARY</a>);
<a name="l04231"></a>04231       <span class="keywordflow">if</span> (fh &gt; 0) {
<a name="l04232"></a>04232          lseek(fh, 0, SEEK_END);
<a name="l04233"></a>04233          length = <a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fh);
<a name="l04234"></a>04234          lseek(fh, 0, SEEK_SET);
<a name="l04235"></a>04235 
<a name="l04236"></a>04236          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l04237"></a>04237          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l04238"></a>04238          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Accept-Ranges: bytes\r\n&quot;</span>);
<a name="l04239"></a>04239 
<a name="l04240"></a>04240          <span class="comment">/* return proper header for file type */</span>
<a name="l04241"></a>04241          <span class="keywordflow">for</span> (i = 0; i &lt; (int) strlen(path); i++)
<a name="l04242"></a>04242             str[i] = toupper(path[i]);
<a name="l04243"></a>04243          str[i] = 0;
<a name="l04244"></a>04244 
<a name="l04245"></a>04245          <span class="keywordflow">for</span> (i = 0; <a class="code" href="mhttpd_8c.html#ab9ec7b8b41990fd9f8dc4d6167c0dc4c">filetype</a>[i].ext[0]; i++)
<a name="l04246"></a>04246             <span class="keywordflow">if</span> (strstr(str, <a class="code" href="mhttpd_8c.html#ab9ec7b8b41990fd9f8dc4d6167c0dc4c">filetype</a>[i].<a class="code" href="mhttpd_8c.html#acbbdcdfacfc8c43d7d6ba5412ea70365">ext</a>))
<a name="l04247"></a>04247                <span class="keywordflow">break</span>;
<a name="l04248"></a>04248 
<a name="l04249"></a>04249          <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#ab9ec7b8b41990fd9f8dc4d6167c0dc4c">filetype</a>[i].ext[0])
<a name="l04250"></a>04250             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: %s\r\n&quot;</span>, <a class="code" href="mhttpd_8c.html#ab9ec7b8b41990fd9f8dc4d6167c0dc4c">filetype</a>[i].type);
<a name="l04251"></a>04251          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;.&apos;</span>) == NULL)
<a name="l04252"></a>04252             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/plain\r\n&quot;</span>);
<a name="l04253"></a>04253          <span class="keywordflow">else</span>
<a name="l04254"></a>04254             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: application/octet-stream\r\n&quot;</span>);
<a name="l04255"></a>04255 
<a name="l04256"></a>04256          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Length: %d\r\n\r\n&quot;</span>, length);
<a name="l04257"></a>04257 
<a name="l04258"></a>04258          <span class="comment">/* return if file too big */</span>
<a name="l04259"></a>04259          <span class="keywordflow">if</span> (length &gt; (<span class="keywordtype">int</span>) (<span class="keyword">sizeof</span>(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>) - strlen(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>))) {
<a name="l04260"></a>04260             printf(<span class="stringliteral">&quot;return buffer too small\n&quot;</span>);
<a name="l04261"></a>04261             close(fh);
<a name="l04262"></a>04262             <span class="keywordflow">return</span>;
<a name="l04263"></a>04263          }
<a name="l04264"></a>04264 
<a name="l04265"></a>04265          <a class="code" href="mhttpd_8c.html#a518fedf43db3f1313f9c88b2009380b5">return_length</a> = strlen(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>) + length;
<a name="l04266"></a>04266          <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, <a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a> + strlen(<a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>), length);
<a name="l04267"></a>04267 
<a name="l04268"></a>04268          close(fh);
<a name="l04269"></a>04269       }
<a name="l04270"></a>04270 
<a name="l04271"></a>04271       <span class="keywordflow">return</span>;
<a name="l04272"></a>04272    }
<a name="l04273"></a>04273 
<a name="l04274"></a>04274   <span class="comment">/*---- check if runlog is requested ------------------------------*/</span>
<a name="l04275"></a>04275 
<a name="l04276"></a>04276    <span class="keywordflow">if</span> (path[0] &gt; <span class="charliteral">&apos;9&apos;</span>) {
<a name="l04277"></a>04277       <a class="code" href="mhttpd_8c.html#abe470e8b895f261f77a887fb45b67b1b">show_rawfile</a>(path);
<a name="l04278"></a>04278       <span class="keywordflow">return</span>;
<a name="l04279"></a>04279    }
<a name="l04280"></a>04280 
<a name="l04281"></a>04281   <span class="comment">/*---- check next/previous message -------------------------------*/</span>
<a name="l04282"></a>04282 
<a name="l04283"></a>04283    last_message = first_message = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l04284"></a>04284    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;next&quot;</span>) || <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;previous&quot;</span>) ||
<a name="l04285"></a>04285        <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;last&quot;</span>)) {
<a name="l04286"></a>04286       strcpy(orig_path, path);
<a name="l04287"></a>04287 
<a name="l04288"></a>04288       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;last&quot;</span>))
<a name="l04289"></a>04289          path[0] = 0;
<a name="l04290"></a>04290 
<a name="l04291"></a>04291       <span class="keywordflow">do</span> {
<a name="l04292"></a>04292          strcat(path, <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;next&quot;</span>) ? <span class="stringliteral">&quot;+1&quot;</span> : <span class="stringliteral">&quot;-1&quot;</span>);
<a name="l04293"></a>04293          status = <a class="code" href="group__msectionh.html#gad272ad608ea84675b7a2fa0ad57308ba">el_search_message</a>(path, &amp;fh, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l04294"></a>04294          close(fh);
<a name="l04295"></a>04295          <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a>) {
<a name="l04296"></a>04296             <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(command, <span class="stringliteral">&quot;next&quot;</span>))
<a name="l04297"></a>04297                last_message = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l04298"></a>04298             <span class="keywordflow">else</span>
<a name="l04299"></a>04299                first_message = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l04300"></a>04300             strcpy(path, orig_path);
<a name="l04301"></a>04301             <span class="keywordflow">break</span>;
<a name="l04302"></a>04302          }
<a name="l04303"></a>04303 
<a name="l04304"></a>04304          size = <span class="keyword">sizeof</span>(text);
<a name="l04305"></a>04305          <a class="code" href="group__msectionh.html#ga203cfa8e2d036e5e56a2fdd9d17eb09d">el_retrieve</a>(path, date, &amp;run, author, type, system, subject,
<a name="l04306"></a>04306                      text, &amp;size, orig_tag, reply_tag,
<a name="l04307"></a>04307                      attachment[0], attachment[1], attachment[2], encoding);
<a name="l04308"></a>04308 
<a name="l04309"></a>04309          <span class="keywordflow">if</span> (strchr(author, <span class="charliteral">&apos;@&apos;</span>))
<a name="l04310"></a>04310             *strchr(author, <span class="charliteral">&apos;@&apos;</span>) = 0;
<a name="l04311"></a>04311          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;lauthor&quot;</span>) == <span class="charliteral">&apos;1&apos;</span> &amp;&amp; !<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;author&quot;</span>), author))
<a name="l04312"></a>04312             <span class="keywordflow">continue</span>;
<a name="l04313"></a>04313          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;ltype&quot;</span>) == <span class="charliteral">&apos;1&apos;</span> &amp;&amp; !<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;type&quot;</span>), type))
<a name="l04314"></a>04314             <span class="keywordflow">continue</span>;
<a name="l04315"></a>04315          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;lsystem&quot;</span>) == <span class="charliteral">&apos;1&apos;</span> &amp;&amp; !<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;system&quot;</span>), system))
<a name="l04316"></a>04316             <span class="keywordflow">continue</span>;
<a name="l04317"></a>04317          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;lsubject&quot;</span>) == <span class="charliteral">&apos;1&apos;</span>) {
<a name="l04318"></a>04318             strcpy(str, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;subject&quot;</span>));
<a name="l04319"></a>04319             <span class="keywordflow">for</span> (i = 0; i &lt; (int) strlen(str); i++)
<a name="l04320"></a>04320                str[i] = toupper(str[i]);
<a name="l04321"></a>04321             <span class="keywordflow">for</span> (i = 0; i &lt; (int) strlen(subject); i++)
<a name="l04322"></a>04322                subject[i] = toupper(subject[i]);
<a name="l04323"></a>04323 
<a name="l04324"></a>04324             <span class="keywordflow">if</span> (strstr(subject, str) == NULL)
<a name="l04325"></a>04325                <span class="keywordflow">continue</span>;
<a name="l04326"></a>04326          }
<a name="l04327"></a>04327 
<a name="l04328"></a>04328          sprintf(str, <span class="stringliteral">&quot;EL/%s&quot;</span>, path);
<a name="l04329"></a>04329 
<a name="l04330"></a>04330          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;lauthor&quot;</span>) == <span class="charliteral">&apos;1&apos;</span>) {
<a name="l04331"></a>04331             <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;?&apos;</span>) == NULL)
<a name="l04332"></a>04332                strcat(str, <span class="stringliteral">&quot;?lauthor=1&quot;</span>);
<a name="l04333"></a>04333             <span class="keywordflow">else</span>
<a name="l04334"></a>04334                strcat(str, <span class="stringliteral">&quot;&amp;lauthor=1&quot;</span>);
<a name="l04335"></a>04335          }
<a name="l04336"></a>04336 
<a name="l04337"></a>04337          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;ltype&quot;</span>) == <span class="charliteral">&apos;1&apos;</span>) {
<a name="l04338"></a>04338             <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;?&apos;</span>) == NULL)
<a name="l04339"></a>04339                strcat(str, <span class="stringliteral">&quot;?ltype=1&quot;</span>);
<a name="l04340"></a>04340             <span class="keywordflow">else</span>
<a name="l04341"></a>04341                strcat(str, <span class="stringliteral">&quot;&amp;ltype=1&quot;</span>);
<a name="l04342"></a>04342          }
<a name="l04343"></a>04343 
<a name="l04344"></a>04344          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;lsystem&quot;</span>) == <span class="charliteral">&apos;1&apos;</span>) {
<a name="l04345"></a>04345             <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;?&apos;</span>) == NULL)
<a name="l04346"></a>04346                strcat(str, <span class="stringliteral">&quot;?lsystem=1&quot;</span>);
<a name="l04347"></a>04347             <span class="keywordflow">else</span>
<a name="l04348"></a>04348                strcat(str, <span class="stringliteral">&quot;&amp;lsystem=1&quot;</span>);
<a name="l04349"></a>04349          }
<a name="l04350"></a>04350 
<a name="l04351"></a>04351          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;lsubject&quot;</span>) == <span class="charliteral">&apos;1&apos;</span>) {
<a name="l04352"></a>04352             <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;?&apos;</span>) == NULL)
<a name="l04353"></a>04353                strcat(str, <span class="stringliteral">&quot;?lsubject=1&quot;</span>);
<a name="l04354"></a>04354             <span class="keywordflow">else</span>
<a name="l04355"></a>04355                strcat(str, <span class="stringliteral">&quot;&amp;lsubject=1&quot;</span>);
<a name="l04356"></a>04356          }
<a name="l04357"></a>04357 
<a name="l04358"></a>04358          <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(str);
<a name="l04359"></a>04359          <span class="keywordflow">return</span>;
<a name="l04360"></a>04360 
<a name="l04361"></a>04361       } <span class="keywordflow">while</span> (<a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l04362"></a>04362    }
<a name="l04363"></a>04363 
<a name="l04364"></a>04364   <span class="comment">/*---- get current message ---------------------------------------*/</span>
<a name="l04365"></a>04365 
<a name="l04366"></a>04366    size = <span class="keyword">sizeof</span>(text);
<a name="l04367"></a>04367    strcpy(str, path);
<a name="l04368"></a>04368    subject[0] = 0;
<a name="l04369"></a>04369    msg_status = <a class="code" href="group__msectionh.html#ga203cfa8e2d036e5e56a2fdd9d17eb09d">el_retrieve</a>(str, date, &amp;run, author, type, system, subject,
<a name="l04370"></a>04370                             text, &amp;size, orig_tag, reply_tag,
<a name="l04371"></a>04371                             attachment[0], attachment[1], attachment[2], encoding);
<a name="l04372"></a>04372 
<a name="l04373"></a>04373   <span class="comment">/*---- header ----*/</span>
<a name="l04374"></a>04374 
<a name="l04375"></a>04375    <span class="comment">/* header */</span>
<a name="l04376"></a>04376    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l04377"></a>04377    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l04378"></a>04378    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l04379"></a>04379 
<a name="l04380"></a>04380    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;MIDAS ELog - %s&lt;/title&gt;&lt;/head&gt;\n&quot;</span>, subject);
<a name="l04381"></a>04381    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;body&gt;&lt;form method=\&quot;GET\&quot; action=\&quot;/EL/%s\&quot;&gt;\n&quot;</span>, str);
<a name="l04382"></a>04382 
<a name="l04383"></a>04383    <span class="comment">/* define hidden field for experiment */</span>
<a name="l04384"></a>04384    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l04385"></a>04385       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=exp value=\&quot;%s\&quot;&gt;\n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l04386"></a>04386 
<a name="l04387"></a>04387    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;table cols=2 border=2 cellpadding=2&gt;\n&quot;</span>);
<a name="l04388"></a>04388 
<a name="l04389"></a>04389   <span class="comment">/*---- title row ----*/</span>
<a name="l04390"></a>04390 
<a name="l04391"></a>04391    size = <span class="keyword">sizeof</span>(str);
<a name="l04392"></a>04392    str[0] = 0;
<a name="l04393"></a>04393    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Name&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l04394"></a>04394 
<a name="l04395"></a>04395    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#A0A0FF&gt;MIDAS Electronic Logbook&quot;</span>);
<a name="l04396"></a>04396    <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#a9c91f81733a48f1fbc887b013ee0de14">elog_mode</a>)
<a name="l04397"></a>04397       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th bgcolor=#A0A0FF&gt;Logbook \&quot;%s\&quot;&lt;/tr&gt;\n&quot;</span>, str);
<a name="l04398"></a>04398    <span class="keywordflow">else</span>
<a name="l04399"></a>04399       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th bgcolor=#A0A0FF&gt;Experiment \&quot;%s\&quot;&lt;/tr&gt;\n&quot;</span>, str);
<a name="l04400"></a>04400 
<a name="l04401"></a>04401   <span class="comment">/*---- menu buttons ----*/</span>
<a name="l04402"></a>04402 
<a name="l04403"></a>04403    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l04404"></a>04404    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=New&gt;\n&quot;</span>);
<a name="l04405"></a>04405    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Edit&gt;\n&quot;</span>);
<a name="l04406"></a>04406    <span class="keywordflow">if</span> (allow_delete)
<a name="l04407"></a>04407       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Delete&gt;\n&quot;</span>);
<a name="l04408"></a>04408    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Reply&gt;\n&quot;</span>);
<a name="l04409"></a>04409    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Query&gt;\n&quot;</span>);
<a name="l04410"></a>04410 
<a name="l04411"></a>04411    <span class="comment">/* check forms from ODB */</span>
<a name="l04412"></a>04412    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Forms&quot;</span>, &amp;hkeyroot);
<a name="l04413"></a>04413    <span class="keywordflow">if</span> (hkeyroot)
<a name="l04414"></a>04414       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l04415"></a>04415          <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyroot, i, &amp;hkey);
<a name="l04416"></a>04416          <span class="keywordflow">if</span> (!hkey)
<a name="l04417"></a>04417             <span class="keywordflow">break</span>;
<a name="l04418"></a>04418 
<a name="l04419"></a>04419          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l04420"></a>04420 
<a name="l04421"></a>04421          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=form value=\&quot;%s\&quot;&gt;\n&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l04422"></a>04422       }
<a name="l04423"></a>04423 
<a name="l04424"></a>04424    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Runlog&gt;\n&quot;</span>);
<a name="l04425"></a>04425 
<a name="l04426"></a>04426    <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9c91f81733a48f1fbc887b013ee0de14">elog_mode</a>)
<a name="l04427"></a>04427       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Status&gt;\n&quot;</span>);
<a name="l04428"></a>04428    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l04429"></a>04429 
<a name="l04430"></a>04430    <span class="comment">/* &quot;last x&quot; button row */</span>
<a name="l04431"></a>04431    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#D0D0D0&gt;\n&quot;</span>);
<a name="l04432"></a>04432 
<a name="l04433"></a>04433    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Buttons&quot;</span>, &amp;hkeybutton);
<a name="l04434"></a>04434    <span class="keywordflow">if</span> (hkeybutton == 0) {
<a name="l04435"></a>04435       <span class="comment">/* create default buttons */</span>
<a name="l04436"></a>04436       <a class="code" href="group__msectionh.html#ga1441e5b7ca1923cf8611f920cf2c31b4">db_create_key</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Buttons&quot;</span>, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l04437"></a>04437       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Buttons&quot;</span>, &amp;hkeybutton);
<a name="l04438"></a>04438       <a class="code" href="group__msectionh.html#ga6b98aa5ac9036c49023c0cc9353922d4">db_set_data</a>(hDB, hkeybutton, def_button, <span class="keyword">sizeof</span>(def_button), 3, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l04439"></a>04439    }
<a name="l04440"></a>04440 
<a name="l04441"></a>04441    <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkeybutton, &amp;key);
<a name="l04442"></a>04442 
<a name="l04443"></a>04443    <span class="keywordflow">for</span> (i = 0; i &lt; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; i++) {
<a name="l04444"></a>04444       size = <span class="keyword">sizeof</span>(str);
<a name="l04445"></a>04445       <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hkeybutton, str, &amp;size, i, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l04446"></a>04446       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;Last %s\&quot;&gt;\n&quot;</span>, str);
<a name="l04447"></a>04447    }
<a name="l04448"></a>04448 
<a name="l04449"></a>04449    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l04450"></a>04450 
<a name="l04451"></a>04451    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#E0E0E0&gt;&quot;</span>);
<a name="l04452"></a>04452    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Next&gt;\n&quot;</span>);
<a name="l04453"></a>04453    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Previous&gt;\n&quot;</span>);
<a name="l04454"></a>04454    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Last&gt;\n&quot;</span>);
<a name="l04455"></a>04455    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;i&gt;Check a category to browse only entries from that category&lt;/i&gt;\n&quot;</span>);
<a name="l04456"></a>04456    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n\n&quot;</span>);
<a name="l04457"></a>04457 
<a name="l04458"></a>04458    <span class="keywordflow">if</span> (msg_status != <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a> &amp;&amp; (reply_tag[0] || orig_tag[0])) {
<a name="l04459"></a>04459       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#F0F0F0&gt;&quot;</span>);
<a name="l04460"></a>04460       <span class="keywordflow">if</span> (orig_tag[0]) {
<a name="l04461"></a>04461          <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l04462"></a>04462             sprintf(ref, <span class="stringliteral">&quot;/EL/%s?exp=%s&quot;</span>, orig_tag, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l04463"></a>04463          <span class="keywordflow">else</span>
<a name="l04464"></a>04464             sprintf(ref, <span class="stringliteral">&quot;/EL/%s&quot;</span>, orig_tag);
<a name="l04465"></a>04465          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;  &lt;a href=\&quot;%s\&quot;&gt;Original message&lt;/a&gt;  &quot;</span>, ref);
<a name="l04466"></a>04466       }
<a name="l04467"></a>04467       <span class="keywordflow">if</span> (reply_tag[0]) {
<a name="l04468"></a>04468          <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l04469"></a>04469             sprintf(ref, <span class="stringliteral">&quot;/EL/%s?exp=%s&quot;</span>, reply_tag, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l04470"></a>04470          <span class="keywordflow">else</span>
<a name="l04471"></a>04471             sprintf(ref, <span class="stringliteral">&quot;/EL/%s&quot;</span>, reply_tag);
<a name="l04472"></a>04472          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;  &lt;a href=\&quot;%s\&quot;&gt;Reply to this message&lt;/a&gt;  &quot;</span>, ref);
<a name="l04473"></a>04473       }
<a name="l04474"></a>04474       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l04475"></a>04475    }
<a name="l04476"></a>04476 
<a name="l04477"></a>04477   <span class="comment">/*---- message ----*/</span>
<a name="l04478"></a>04478 
<a name="l04479"></a>04479    <span class="keywordflow">if</span> (msg_status == <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a>)
<a name="l04480"></a>04480       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l04481"></a>04481           (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FF0000 colspan=2 align=center&gt;&lt;h1&gt;No message available&lt;/h1&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l04482"></a>04482    <span class="keywordflow">else</span> {
<a name="l04483"></a>04483       <span class="keywordflow">if</span> (last_message)
<a name="l04484"></a>04484          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l04485"></a>04485              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FF0000 colspan=2 align=center&gt;&lt;b&gt;This is the last message in the ELog&lt;/b&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l04486"></a>04486 
<a name="l04487"></a>04487       <span class="keywordflow">if</span> (first_message)
<a name="l04488"></a>04488          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l04489"></a>04489              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FF0000 colspan=2 align=center&gt;&lt;b&gt;This is the first message in the ELog&lt;/b&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l04490"></a>04490 
<a name="l04491"></a>04491       <span class="comment">/* check for mail submissions */</span>
<a name="l04492"></a>04492       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l04493"></a>04493          sprintf(str, <span class="stringliteral">&quot;mail%d&quot;</span>, i);
<a name="l04494"></a>04494          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str)) {
<a name="l04495"></a>04495             <span class="keywordflow">if</span> (i == 0)
<a name="l04496"></a>04496                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#FFC020&gt;&quot;</span>);
<a name="l04497"></a>04497             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Mail sent to &lt;b&gt;%s&lt;/b&gt;&lt;br&gt;\n&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str));
<a name="l04498"></a>04498          } <span class="keywordflow">else</span>
<a name="l04499"></a>04499             <span class="keywordflow">break</span>;
<a name="l04500"></a>04500       }
<a name="l04501"></a>04501       <span class="keywordflow">if</span> (i &gt; 0)
<a name="l04502"></a>04502          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l04503"></a>04503 
<a name="l04504"></a>04504 
<a name="l04505"></a>04505       <span class="keywordflow">if</span> (display_run_number) {
<a name="l04506"></a>04506          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;Entry date: &lt;b&gt;%s&lt;/b&gt;&quot;</span>, date);
<a name="l04507"></a>04507 
<a name="l04508"></a>04508          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#FFFF00&gt;Run number: &lt;b&gt;%d&lt;/b&gt;&lt;/tr&gt;\n\n&quot;</span>, run);
<a name="l04509"></a>04509       } <span class="keywordflow">else</span>
<a name="l04510"></a>04510          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#FFFF00&gt;Entry date: &lt;b&gt;%s&lt;/b&gt;&lt;/tr&gt;\n\n&quot;</span>,
<a name="l04511"></a>04511                   date);
<a name="l04512"></a>04512 
<a name="l04513"></a>04513 
<a name="l04514"></a>04514       <span class="comment">/* define hidded fields */</span>
<a name="l04515"></a>04515       strcpy(str, author);
<a name="l04516"></a>04516       <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;@&apos;</span>))
<a name="l04517"></a>04517          *strchr(str, <span class="charliteral">&apos;@&apos;</span>) = 0;
<a name="l04518"></a>04518       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=author  value=\&quot;%s\&quot;&gt;\n&quot;</span>, str);
<a name="l04519"></a>04519       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=type    value=\&quot;%s\&quot;&gt;\n&quot;</span>, type);
<a name="l04520"></a>04520       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=system  value=\&quot;%s\&quot;&gt;\n&quot;</span>, system);
<a name="l04521"></a>04521       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=subject value=\&quot;%s\&quot;&gt;\n\n&quot;</span>, subject);
<a name="l04522"></a>04522 
<a name="l04523"></a>04523       <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;lauthor&quot;</span>) == <span class="charliteral">&apos;1&apos;</span>)
<a name="l04524"></a>04524          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l04525"></a>04525              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFA0A0&gt;&lt;input type=\&quot;checkbox\&quot; checked name=\&quot;lauthor\&quot; value=\&quot;1\&quot;&gt;&quot;</span>);
<a name="l04526"></a>04526       <span class="keywordflow">else</span>
<a name="l04527"></a>04527          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l04528"></a>04528              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFA0A0&gt;&lt;input type=\&quot;checkbox\&quot; name=\&quot;lauthor\&quot; value=\&quot;1\&quot;&gt;&quot;</span>);
<a name="l04529"></a>04529       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;  Author: &lt;b&gt;%s&lt;/b&gt;\n&quot;</span>, author);
<a name="l04530"></a>04530 
<a name="l04531"></a>04531       <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;ltype&quot;</span>) == <span class="charliteral">&apos;1&apos;</span>)
<a name="l04532"></a>04532          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l04533"></a>04533              (<span class="stringliteral">&quot;&lt;td bgcolor=#FFA0A0&gt;&lt;input type=\&quot;checkbox\&quot; checked name=\&quot;ltype\&quot; value=\&quot;1\&quot;&gt;&quot;</span>);
<a name="l04534"></a>04534       <span class="keywordflow">else</span>
<a name="l04535"></a>04535          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l04536"></a>04536              (<span class="stringliteral">&quot;&lt;td bgcolor=#FFA0A0&gt;&lt;input type=\&quot;checkbox\&quot; name=\&quot;ltype\&quot; value=\&quot;1\&quot;&gt;&quot;</span>);
<a name="l04537"></a>04537       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;  Type: &lt;b&gt;%s&lt;/b&gt;&lt;/tr&gt;\n&quot;</span>, type);
<a name="l04538"></a>04538 
<a name="l04539"></a>04539       <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;lsystem&quot;</span>) == <span class="charliteral">&apos;1&apos;</span>)
<a name="l04540"></a>04540          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l04541"></a>04541              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#A0FFA0&gt;&lt;input type=\&quot;checkbox\&quot; checked name=\&quot;lsystem\&quot; value=\&quot;1\&quot;&gt;&quot;</span>);
<a name="l04542"></a>04542       <span class="keywordflow">else</span>
<a name="l04543"></a>04543          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l04544"></a>04544              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#A0FFA0&gt;&lt;input type=\&quot;checkbox\&quot; name=\&quot;lsystem\&quot; value=\&quot;1\&quot;&gt;&quot;</span>);
<a name="l04545"></a>04545 
<a name="l04546"></a>04546       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;  System: &lt;b&gt;%s&lt;/b&gt;\n&quot;</span>, system);
<a name="l04547"></a>04547 
<a name="l04548"></a>04548       <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;lsubject&quot;</span>) == <span class="charliteral">&apos;1&apos;</span>)
<a name="l04549"></a>04549          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l04550"></a>04550              (<span class="stringliteral">&quot;&lt;td bgcolor=#A0FFA0&gt;&lt;input type=\&quot;checkbox\&quot; checked name=\&quot;lsubject\&quot; value=\&quot;1\&quot;&gt;&quot;</span>);
<a name="l04551"></a>04551       <span class="keywordflow">else</span>
<a name="l04552"></a>04552          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l04553"></a>04553              (<span class="stringliteral">&quot;&lt;td bgcolor=#A0FFA0&gt;&lt;input type=\&quot;checkbox\&quot; name=\&quot;lsubject\&quot; value=\&quot;1\&quot;&gt;&quot;</span>);
<a name="l04554"></a>04554       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;  Subject: &lt;b&gt;%s&lt;/b&gt;&lt;/tr&gt;\n&quot;</span>, subject);
<a name="l04555"></a>04555 
<a name="l04556"></a>04556 
<a name="l04557"></a>04557       <span class="comment">/* message text */</span>
<a name="l04558"></a>04558       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2&gt;\n&quot;</span>);
<a name="l04559"></a>04559       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(encoding, <span class="stringliteral">&quot;plain&quot;</span>)) {
<a name="l04560"></a>04560          <a class="code" href="mhttpd_8c.html#a0c625fe56e336fc4d14a579b876b9fa8">rsputs</a>(<span class="stringliteral">&quot;&lt;pre&gt;&quot;</span>);
<a name="l04561"></a>04561          <a class="code" href="mhttpd_8c.html#a3fc73195d7773ac70a09f5afb5588d5a">rsputs2</a>(text);
<a name="l04562"></a>04562          <a class="code" href="mhttpd_8c.html#a0c625fe56e336fc4d14a579b876b9fa8">rsputs</a>(<span class="stringliteral">&quot;&lt;/pre&gt;&quot;</span>);
<a name="l04563"></a>04563       } <span class="keywordflow">else</span>
<a name="l04564"></a>04564          <a class="code" href="mhttpd_8c.html#a0c625fe56e336fc4d14a579b876b9fa8">rsputs</a>(text);
<a name="l04565"></a>04565       <a class="code" href="mhttpd_8c.html#a0c625fe56e336fc4d14a579b876b9fa8">rsputs</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l04566"></a>04566 
<a name="l04567"></a>04567       <span class="keywordflow">for</span> (index = 0; index &lt; 3; index++) {
<a name="l04568"></a>04568          <span class="keywordflow">if</span> (attachment[index][0]) {
<a name="l04569"></a>04569             <span class="keywordflow">for</span> (i = 0; i &lt; (int) strlen(attachment[index]); i++)
<a name="l04570"></a>04570                att[i] = toupper(attachment[index][i]);
<a name="l04571"></a>04571             att[i] = 0;
<a name="l04572"></a>04572 
<a name="l04573"></a>04573             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l04574"></a>04574                sprintf(ref, <span class="stringliteral">&quot;/EL/%s?exp=%s&quot;</span>, attachment[index], <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l04575"></a>04575             <span class="keywordflow">else</span>
<a name="l04576"></a>04576                sprintf(ref, <span class="stringliteral">&quot;/EL/%s&quot;</span>, attachment[index]);
<a name="l04577"></a>04577 
<a name="l04578"></a>04578             <span class="keywordflow">if</span> (strstr(att, <span class="stringliteral">&quot;.GIF&quot;</span>) || strstr(att, <span class="stringliteral">&quot;.PNG&quot;</span>) || strstr(att, <span class="stringliteral">&quot;.JPG&quot;</span>)) {
<a name="l04579"></a>04579                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l04580"></a>04580                    (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2&gt;Attachment: &lt;a href=\&quot;%s\&quot;&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/a&gt;&lt;br&gt;\n&quot;</span>,
<a name="l04581"></a>04581                     ref, attachment[index] + 14);
<a name="l04582"></a>04582                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;img src=\&quot;%s\&quot;&gt;&lt;/tr&gt;&quot;</span>, ref);
<a name="l04583"></a>04583             } <span class="keywordflow">else</span> {
<a name="l04584"></a>04584                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l04585"></a>04585                    (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#C0C0FF&gt;Attachment: &lt;a href=\&quot;%s\&quot;&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/a&gt;\n&quot;</span>,
<a name="l04586"></a>04586                     ref, attachment[index] + 14);
<a name="l04587"></a>04587                <span class="keywordflow">if</span> (strstr(att, <span class="stringliteral">&quot;.TXT&quot;</span>) || strstr(att, <span class="stringliteral">&quot;.ASC&quot;</span>) || strchr(att, <span class="charliteral">&apos;.&apos;</span>) == NULL) {
<a name="l04588"></a>04588                   <span class="comment">/* display attachment */</span>
<a name="l04589"></a>04589                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;br&gt;&quot;</span>);
<a name="l04590"></a>04590                   <span class="keywordflow">if</span> (!strstr(att, <span class="stringliteral">&quot;.HTML&quot;</span>))
<a name="l04591"></a>04591                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;pre&gt;&quot;</span>);
<a name="l04592"></a>04592 
<a name="l04593"></a>04593                   file_name[0] = 0;
<a name="l04594"></a>04594                   size = <span class="keyword">sizeof</span>(file_name);
<a name="l04595"></a>04595                   memset(file_name, 0, size);
<a name="l04596"></a>04596                   <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Data dir&quot;</span>, file_name, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>,
<a name="l04597"></a>04597                                <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l04598"></a>04598                   <span class="keywordflow">if</span> (file_name[0] != 0)
<a name="l04599"></a>04599                      <span class="keywordflow">if</span> (file_name[strlen(file_name) - 1] != <a class="code" href="group__midasincludecode.html#ga0920890c442b665b0c6609fa796e9047">DIR_SEPARATOR</a>)
<a name="l04600"></a>04600                         strcat(file_name, <a class="code" href="group__midasincludecode.html#ga23e72ca2d8456a971c13441bdfc4586f">DIR_SEPARATOR_STR</a>);
<a name="l04601"></a>04601                   strcat(file_name, attachment[index]);
<a name="l04602"></a>04602 
<a name="l04603"></a>04603                   f = fopen(file_name, <span class="stringliteral">&quot;rt&quot;</span>);
<a name="l04604"></a>04604                   <span class="keywordflow">if</span> (f != NULL) {
<a name="l04605"></a>04605                      <span class="keywordflow">while</span> (!feof(f)) {
<a name="l04606"></a>04606                         str[0] = 0;
<a name="l04607"></a>04607                         fgets(str, <span class="keyword">sizeof</span>(str), f);
<a name="l04608"></a>04608                         <span class="keywordflow">if</span> (!strstr(att, <span class="stringliteral">&quot;.HTML&quot;</span>))
<a name="l04609"></a>04609                            <a class="code" href="mhttpd_8c.html#a3fc73195d7773ac70a09f5afb5588d5a">rsputs2</a>(str);
<a name="l04610"></a>04610                         <span class="keywordflow">else</span>
<a name="l04611"></a>04611                            <a class="code" href="mhttpd_8c.html#a0c625fe56e336fc4d14a579b876b9fa8">rsputs</a>(str);
<a name="l04612"></a>04612                      }
<a name="l04613"></a>04613                      fclose(f);
<a name="l04614"></a>04614                   }
<a name="l04615"></a>04615 
<a name="l04616"></a>04616                   <span class="keywordflow">if</span> (!strstr(att, <span class="stringliteral">&quot;.HTML&quot;</span>))
<a name="l04617"></a>04617                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/pre&gt;&quot;</span>);
<a name="l04618"></a>04618                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l04619"></a>04619                }
<a name="l04620"></a>04620                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l04621"></a>04621             }
<a name="l04622"></a>04622          }
<a name="l04623"></a>04623       }
<a name="l04624"></a>04624    }
<a name="l04625"></a>04625 
<a name="l04626"></a>04626    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>);
<a name="l04627"></a>04627    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l04628"></a>04628 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1ec76c094a5ba43c43a698f0f7d6b6e5"></a><!-- doxytag: member="mhttpd.c::show_elog_query" ref="a1ec76c094a5ba43c43a698f0f7d6b6e5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_elog_query </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l02771">2771</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="odb_8c_source.html#l03128">db_set_value()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="mhttpd_8c_source.html#l00891">elog_mode</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="mhttpd_8c_source.html#l00894">mname</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="mhttpd_8c_source.html#l00924">system_list</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, and <a class="el" href="mhttpd_8c_source.html#l00909">type_list</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02772"></a>02772 {
<a name="l02773"></a>02773    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l02774"></a>02774    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l02775"></a>02775    time_t now;
<a name="l02776"></a>02776    <span class="keyword">struct </span>tm *tms;
<a name="l02777"></a>02777    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey, hkeyroot;
<a name="l02778"></a>02778    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l02779"></a>02779    <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> display_run_number;
<a name="l02780"></a>02780 
<a name="l02781"></a>02781    <span class="comment">/* get flag for displaying run number */</span>
<a name="l02782"></a>02782    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l02783"></a>02783    display_run_number = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02784"></a>02784    size = <span class="keyword">sizeof</span>(<a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>);
<a name="l02785"></a>02785    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Display run number&quot;</span>, &amp;display_run_number, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>,
<a name="l02786"></a>02786                 <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02787"></a>02787 
<a name="l02788"></a>02788    <span class="comment">/* header */</span>
<a name="l02789"></a>02789    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l02790"></a>02790    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l02791"></a>02791    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l02792"></a>02792 
<a name="l02793"></a>02793    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;MIDAS ELog&lt;/title&gt;&lt;/head&gt;\n&quot;</span>);
<a name="l02794"></a>02794    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;body&gt;&lt;form method=\&quot;GET\&quot; action=\&quot;/EL/\&quot;&gt;\n&quot;</span>);
<a name="l02795"></a>02795 
<a name="l02796"></a>02796    <span class="comment">/* define hidden field for experiment */</span>
<a name="l02797"></a>02797    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l02798"></a>02798       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=exp value=\&quot;%s\&quot;&gt;\n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l02799"></a>02799 
<a name="l02800"></a>02800    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;table border=3 cellpadding=5&gt;\n&quot;</span>);
<a name="l02801"></a>02801 
<a name="l02802"></a>02802   <span class="comment">/*---- title row ----*/</span>
<a name="l02803"></a>02803 
<a name="l02804"></a>02804    size = <span class="keyword">sizeof</span>(str);
<a name="l02805"></a>02805    str[0] = 0;
<a name="l02806"></a>02806    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Name&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02807"></a>02807 
<a name="l02808"></a>02808    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th colspan=2 bgcolor=#A0A0FF&gt;MIDAS Electronic Logbook&quot;</span>);
<a name="l02809"></a>02809    <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#a9c91f81733a48f1fbc887b013ee0de14">elog_mode</a>)
<a name="l02810"></a>02810       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th colspan=2 bgcolor=#A0A0FF&gt;Logbook \&quot;%s\&quot;&lt;/tr&gt;\n&quot;</span>, str);
<a name="l02811"></a>02811    <span class="keywordflow">else</span>
<a name="l02812"></a>02812       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th colspan=2 bgcolor=#A0A0FF&gt;Experiment \&quot;%s\&quot;&lt;/tr&gt;\n&quot;</span>, str);
<a name="l02813"></a>02813 
<a name="l02814"></a>02814   <span class="comment">/*---- menu buttons ----*/</span>
<a name="l02815"></a>02815 
<a name="l02816"></a>02816    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=4 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l02817"></a>02817 
<a name="l02818"></a>02818    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;Submit Query\&quot;&gt;\n&quot;</span>);
<a name="l02819"></a>02819    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=reset value=\&quot;Reset Form\&quot;&gt;\n&quot;</span>);
<a name="l02820"></a>02820    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n\n&quot;</span>);
<a name="l02821"></a>02821 
<a name="l02822"></a>02822   <span class="comment">/*---- entry form ----*/</span>
<a name="l02823"></a>02823 
<a name="l02824"></a>02824    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#C0C000&gt;&quot;</span>);
<a name="l02825"></a>02825    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=checkbox name=mode value=\&quot;summary\&quot;&gt;Summary only\n&quot;</span>);
<a name="l02826"></a>02826    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=2 bgcolor=#C0C000&gt;&quot;</span>);
<a name="l02827"></a>02827    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=checkbox name=attach value=1&gt;Show attachments&lt;/tr&gt;\n&quot;</span>);
<a name="l02828"></a>02828 
<a name="l02829"></a>02829    <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l02830"></a>02830    now -= 3600 * 24;
<a name="l02831"></a>02831    tms = localtime(&amp;now);
<a name="l02832"></a>02832    tms-&gt;tm_year += 1900;
<a name="l02833"></a>02833 
<a name="l02834"></a>02834    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;Start date: &quot;</span>);
<a name="l02835"></a>02835    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=3 bgcolor=#FFFF00&gt;&lt;select name=\&quot;m1\&quot;&gt;\n&quot;</span>);
<a name="l02836"></a>02836 
<a name="l02837"></a>02837    <span class="keywordflow">for</span> (i = 0; i &lt; 12; i++)
<a name="l02838"></a>02838       <span class="keywordflow">if</span> (i == tms-&gt;tm_mon)
<a name="l02839"></a>02839          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[i], <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[i]);
<a name="l02840"></a>02840       <span class="keywordflow">else</span>
<a name="l02841"></a>02841          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[i], <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[i]);
<a name="l02842"></a>02842    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;\n&quot;</span>);
<a name="l02843"></a>02843 
<a name="l02844"></a>02844    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;select name=\&quot;d1\&quot;&gt;&quot;</span>);
<a name="l02845"></a>02845    <span class="keywordflow">for</span> (i = 0; i &lt; 31; i++)
<a name="l02846"></a>02846       <span class="keywordflow">if</span> (i + 1 == tms-&gt;tm_mday)
<a name="l02847"></a>02847          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=%d&gt;%d\n&quot;</span>, i + 1, i + 1);
<a name="l02848"></a>02848       <span class="keywordflow">else</span>
<a name="l02849"></a>02849          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=%d&gt;%d\n&quot;</span>, i + 1, i + 1);
<a name="l02850"></a>02850    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;\n&quot;</span>);
<a name="l02851"></a>02851 
<a name="l02852"></a>02852    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot; &lt;input type=\&quot;text\&quot; size=5 maxlength=5 name=\&quot;y1\&quot; value=\&quot;%d\&quot;&gt;&quot;</span>,
<a name="l02853"></a>02853             tms-&gt;tm_year);
<a name="l02854"></a>02854    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l02855"></a>02855 
<a name="l02856"></a>02856    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;End date: &quot;</span>);
<a name="l02857"></a>02857    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=3 bgcolor=#FFFF00&gt;&lt;select name=\&quot;m2\&quot; value=\&quot;%s\&quot;&gt;\n&quot;</span>,
<a name="l02858"></a>02858             <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[tms-&gt;tm_mon]);
<a name="l02859"></a>02859 
<a name="l02860"></a>02860    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;\&quot;&gt;\n&quot;</span>);
<a name="l02861"></a>02861    <span class="keywordflow">for</span> (i = 0; i &lt; 12; i++)
<a name="l02862"></a>02862       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[i], <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[i]);
<a name="l02863"></a>02863    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;\n&quot;</span>);
<a name="l02864"></a>02864 
<a name="l02865"></a>02865    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;select name=\&quot;d2\&quot;&gt;&quot;</span>);
<a name="l02866"></a>02866    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=\&quot;\&quot;&gt;\n&quot;</span>);
<a name="l02867"></a>02867    <span class="keywordflow">for</span> (i = 0; i &lt; 31; i++)
<a name="l02868"></a>02868       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=%d&gt;%d\n&quot;</span>, i + 1, i + 1);
<a name="l02869"></a>02869    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;\n&quot;</span>);
<a name="l02870"></a>02870 
<a name="l02871"></a>02871    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot; &lt;input type=\&quot;text\&quot; size=5 maxlength=5 name=\&quot;y2\&quot;&gt;&quot;</span>);
<a name="l02872"></a>02872    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l02873"></a>02873 
<a name="l02874"></a>02874    <span class="keywordflow">if</span> (display_run_number) {
<a name="l02875"></a>02875       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#A0FFFF&gt;Start run: &quot;</span>);
<a name="l02876"></a>02876       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02877"></a>02877           (<span class="stringliteral">&quot;&lt;td bgcolor=#A0FFFF&gt;&lt;input type=\&quot;text\&quot; size=\&quot;10\&quot; maxlength=\&quot;10\&quot; name=\&quot;r1\&quot;&gt;\n&quot;</span>);
<a name="l02878"></a>02878       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#A0FFFF&gt;End run: &quot;</span>);
<a name="l02879"></a>02879       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02880"></a>02880           (<span class="stringliteral">&quot;&lt;td bgcolor=#A0FFFF&gt;&lt;input type=\&quot;text\&quot; size=\&quot;10\&quot; maxlength=\&quot;10\&quot; name=\&quot;r2\&quot;&gt;\n&quot;</span>);
<a name="l02881"></a>02881       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l02882"></a>02882    }
<a name="l02883"></a>02883 
<a name="l02884"></a>02884    <span class="comment">/* get type list from ODB */</span>
<a name="l02885"></a>02885    size = 20 * <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>;
<a name="l02886"></a>02886    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Types&quot;</span>, &amp;hkey) != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l02887"></a>02887       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Types&quot;</span>, <a class="code" href="mhttpd_8c.html#a204c9ddc30d18e95a386f1e6734e66f4">type_list</a>, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a> * 20, 20, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l02888"></a>02888    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Types&quot;</span>, &amp;hkey);
<a name="l02889"></a>02889    <span class="keywordflow">if</span> (hkey)
<a name="l02890"></a>02890       <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, <a class="code" href="mhttpd_8c.html#a204c9ddc30d18e95a386f1e6734e66f4">type_list</a>, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l02891"></a>02891 
<a name="l02892"></a>02892    <span class="comment">/* get system list from ODB */</span>
<a name="l02893"></a>02893    size = 20 * <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>;
<a name="l02894"></a>02894    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Systems&quot;</span>, &amp;hkey) != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l02895"></a>02895       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Systems&quot;</span>, <a class="code" href="mhttpd_8c.html#a63288067ecc0045da645c023c6867ecc">system_list</a>, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a> * 20, 20,
<a name="l02896"></a>02896                    <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l02897"></a>02897    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Systems&quot;</span>, &amp;hkey);
<a name="l02898"></a>02898    <span class="keywordflow">if</span> (hkey)
<a name="l02899"></a>02899       <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, <a class="code" href="mhttpd_8c.html#a63288067ecc0045da645c023c6867ecc">system_list</a>, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l02900"></a>02900 
<a name="l02901"></a>02901    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#FFA0A0&gt;Author: &quot;</span>);
<a name="l02902"></a>02902    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=\&quot;test\&quot; size=\&quot;15\&quot; maxlength=\&quot;80\&quot; name=\&quot;author\&quot;&gt;\n&quot;</span>);
<a name="l02903"></a>02903 
<a name="l02904"></a>02904    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=2 bgcolor=#FFA0A0&gt;Type: &quot;</span>);
<a name="l02905"></a>02905    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;select name=\&quot;type\&quot;&gt;\n&quot;</span>);
<a name="l02906"></a>02906    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;\&quot;&gt;\n&quot;</span>);
<a name="l02907"></a>02907    <span class="keywordflow">for</span> (i = 0; i &lt; 20 &amp;&amp; <a class="code" href="mhttpd_8c.html#a204c9ddc30d18e95a386f1e6734e66f4">type_list</a>[i][0]; i++)
<a name="l02908"></a>02908       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, type_list[i], type_list[i]);
<a name="l02909"></a>02909    <span class="comment">/* add forms as types */</span>
<a name="l02910"></a>02910    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Forms&quot;</span>, &amp;hkeyroot);
<a name="l02911"></a>02911    <span class="keywordflow">if</span> (hkeyroot)
<a name="l02912"></a>02912       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l02913"></a>02913          <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyroot, i, &amp;hkey);
<a name="l02914"></a>02914          <span class="keywordflow">if</span> (!hkey)
<a name="l02915"></a>02915             <span class="keywordflow">break</span>;
<a name="l02916"></a>02916          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l02917"></a>02917          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l02918"></a>02918       }
<a name="l02919"></a>02919    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l02920"></a>02920 
<a name="l02921"></a>02921    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#A0FFA0&gt;System: &quot;</span>);
<a name="l02922"></a>02922    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;select name=\&quot;system\&quot;&gt;\n&quot;</span>);
<a name="l02923"></a>02923    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;\&quot;&gt;\n&quot;</span>);
<a name="l02924"></a>02924    <span class="keywordflow">for</span> (i = 0; i &lt; 20 &amp;&amp; <a class="code" href="mhttpd_8c.html#a63288067ecc0045da645c023c6867ecc">system_list</a>[i][0]; i++)
<a name="l02925"></a>02925       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, system_list[i], system_list[i]);
<a name="l02926"></a>02926    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;\n&quot;</span>);
<a name="l02927"></a>02927 
<a name="l02928"></a>02928    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=2 bgcolor=#A0FFA0&gt;Subject: &quot;</span>);
<a name="l02929"></a>02929    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=\&quot;text\&quot; size=\&quot;15\&quot; maxlength=\&quot;80\&quot; name=\&quot;subject\&quot;&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l02930"></a>02930 
<a name="l02931"></a>02931    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=4 bgcolor=#FFA0FF&gt;Text: &quot;</span>);
<a name="l02932"></a>02932    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=\&quot;text\&quot; size=\&quot;15\&quot; maxlength=\&quot;80\&quot; name=\&quot;subtext\&quot;&gt;\n&quot;</span>);
<a name="l02933"></a>02933    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;i&gt;(case insensitive substring)&lt;/i&gt;&lt;tr&gt;\n&quot;</span>);
<a name="l02934"></a>02934 
<a name="l02935"></a>02935    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;&lt;/table&gt;\n&quot;</span>);
<a name="l02936"></a>02936    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l02937"></a>02937 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa7c5a2983f221f65fb6415ab1fadce70"></a><!-- doxytag: member="mhttpd.c::show_elog_submit_query" ref="aa7c5a2983f221f65fb6415ab1fadce70" args="(INT last_n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_elog_submit_query </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>last_n</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l03003">3003</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="midas_8h_source.html#l00639">DIR_SEPARATOR</a>, <a class="el" href="midas_8h_source.html#l00640">DIR_SEPARATOR_STR</a>, <a class="el" href="midas_8c_source.html#l15633">el_retrieve()</a>, <a class="el" href="midas_8c_source.html#l15790">el_search_run()</a>, <a class="el" href="midas_8h_source.html#l01110">EL_SUCCESS</a>, <a class="el" href="mhttpd_8c_source.html#l00891">elog_mode</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="odbhist_8c_source.html#l00059">file_name</a>, <a class="el" href="mana_8cpp_source.html#l00800">getparam()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="mhttpd_8c_source.html#l00894">mname</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l00959">rsputs()</a>, <a class="el" href="mhttpd_8c_source.html#l00972">rsputs2()</a>, <a class="el" href="odbhist_8c_source.html#l00057">run</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="mhttpd_8c_source.html#l02421">strencode()</a>, <a class="el" href="mhist_8c_source.html#l00102">tag</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03004"></a>03004 {
<a name="l03005"></a>03005    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="odbhist_8c.html#a369e3b30815f09142abc86f462a501ff">run</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, m1, d2, m2, y2, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, colspan;
<a name="l03006"></a>03006    <span class="keywordtype">char</span> date[80], author[80], <a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>[80], system[80], subject[256], text[10000],
<a name="l03007"></a>03007        orig_tag[80], reply_tag[80], attachment[3][256], encoding[80];
<a name="l03008"></a>03008    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], str2[10000], <a class="code" href="mhist_8c.html#a27ce05f73a16e6abc070da1007833b9b">tag</a>[256], ref[256], <a class="code" href="odbhist_8c.html#a4da1fcf44864d811e793f03bf36e6e17">file_name</a>[256];
<a name="l03009"></a>03009    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>;
<a name="l03010"></a>03010    <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> full, show_attachments, display_run_number;
<a name="l03011"></a>03011    <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> ltime_start, ltime_end, ltime_current, now;
<a name="l03012"></a>03012    <span class="keyword">struct </span>tm tms, *ptms;
<a name="l03013"></a>03013    FILE *f;
<a name="l03014"></a>03014 
<a name="l03015"></a>03015    <span class="comment">/* get flag for displaying run number */</span>
<a name="l03016"></a>03016    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l03017"></a>03017    display_run_number = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l03018"></a>03018    size = <span class="keyword">sizeof</span>(<a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>);
<a name="l03019"></a>03019    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Display run number&quot;</span>, &amp;display_run_number, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>,
<a name="l03020"></a>03020                 <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l03021"></a>03021 
<a name="l03022"></a>03022    <span class="comment">/* header */</span>
<a name="l03023"></a>03023    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l03024"></a>03024    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l03025"></a>03025    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l03026"></a>03026 
<a name="l03027"></a>03027    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;MIDAS ELog&lt;/title&gt;&lt;/head&gt;\n&quot;</span>);
<a name="l03028"></a>03028    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;body&gt;&lt;form method=\&quot;GET\&quot; action=\&quot;/EL/\&quot;&gt;\n&quot;</span>);
<a name="l03029"></a>03029 
<a name="l03030"></a>03030    <span class="comment">/* define hidden field for experiment */</span>
<a name="l03031"></a>03031    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l03032"></a>03032       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=exp value=\&quot;%s\&quot;&gt;\n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l03033"></a>03033 
<a name="l03034"></a>03034    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;table border=3 cellpadding=2 width=\&quot;100%%\&quot;&gt;\n&quot;</span>);
<a name="l03035"></a>03035 
<a name="l03036"></a>03036    <span class="comment">/* get mode */</span>
<a name="l03037"></a>03037    <span class="keywordflow">if</span> (last_n) {
<a name="l03038"></a>03038       full = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l03039"></a>03039       show_attachments = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l03040"></a>03040    } <span class="keywordflow">else</span> {
<a name="l03041"></a>03041       full = !(*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;mode&quot;</span>));
<a name="l03042"></a>03042       show_attachments = (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;attach&quot;</span>) &gt; 0);
<a name="l03043"></a>03043    }
<a name="l03044"></a>03044 
<a name="l03045"></a>03045   <span class="comment">/*---- title row ----*/</span>
<a name="l03046"></a>03046 
<a name="l03047"></a>03047    size = <span class="keyword">sizeof</span>(str);
<a name="l03048"></a>03048    str[0] = 0;
<a name="l03049"></a>03049    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Name&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l03050"></a>03050 
<a name="l03051"></a>03051    colspan = full ? 3 : 4;
<a name="l03052"></a>03052    <span class="keywordflow">if</span> (!display_run_number)
<a name="l03053"></a>03053       colspan--;
<a name="l03054"></a>03054 
<a name="l03055"></a>03055    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th colspan=3 bgcolor=#A0A0FF&gt;MIDAS Electronic Logbook&quot;</span>);
<a name="l03056"></a>03056    <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#a9c91f81733a48f1fbc887b013ee0de14">elog_mode</a>)
<a name="l03057"></a>03057       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th colspan=%d bgcolor=#A0A0FF&gt;Logbook \&quot;%s\&quot;&lt;/tr&gt;\n&quot;</span>, colspan, str);
<a name="l03058"></a>03058    <span class="keywordflow">else</span>
<a name="l03059"></a>03059       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th colspan=%d bgcolor=#A0A0FF&gt;Experiment \&quot;%s\&quot;&lt;/tr&gt;\n&quot;</span>, colspan, str);
<a name="l03060"></a>03060 
<a name="l03061"></a>03061   <span class="comment">/*---- menu buttons ----*/</span>
<a name="l03062"></a>03062 
<a name="l03063"></a>03063    <span class="keywordflow">if</span> (!full) {
<a name="l03064"></a>03064       colspan = display_run_number ? 7 : 6;
<a name="l03065"></a>03065       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=%d bgcolor=#C0C0C0&gt;\n&quot;</span>, colspan);
<a name="l03066"></a>03066 
<a name="l03067"></a>03067       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;Query\&quot;&gt;\n&quot;</span>);
<a name="l03068"></a>03068       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;ELog\&quot;&gt;\n&quot;</span>);
<a name="l03069"></a>03069       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;Status\&quot;&gt;\n&quot;</span>);
<a name="l03070"></a>03070       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n\n&quot;</span>);
<a name="l03071"></a>03071    }
<a name="l03072"></a>03072 
<a name="l03073"></a>03073   <span class="comment">/*---- convert end date to ltime ----*/</span>
<a name="l03074"></a>03074 
<a name="l03075"></a>03075    ltime_end = ltime_start = 0;
<a name="l03076"></a>03076    m1 = m2 = d2 = y2 = 0;
<a name="l03077"></a>03077 
<a name="l03078"></a>03078    <span class="keywordflow">if</span> (!last_n) {
<a name="l03079"></a>03079       strcpy(str, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;m1&quot;</span>));
<a name="l03080"></a>03080       <span class="keywordflow">for</span> (m1 = 0; m1 &lt; 12; m1++)
<a name="l03081"></a>03081          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[m1]))
<a name="l03082"></a>03082             <span class="keywordflow">break</span>;
<a name="l03083"></a>03083       <span class="keywordflow">if</span> (m1 == 12)
<a name="l03084"></a>03084          m1 = 0;
<a name="l03085"></a>03085 
<a name="l03086"></a>03086       <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;m2&quot;</span>) || *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;y2&quot;</span>) || *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;d2&quot;</span>)) {
<a name="l03087"></a>03087          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;m2&quot;</span>)) {
<a name="l03088"></a>03088             strcpy(str, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;m2&quot;</span>));
<a name="l03089"></a>03089             <span class="keywordflow">for</span> (m2 = 0; m2 &lt; 12; m2++)
<a name="l03090"></a>03090                <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[m2]))
<a name="l03091"></a>03091                   <span class="keywordflow">break</span>;
<a name="l03092"></a>03092             <span class="keywordflow">if</span> (m2 == 12)
<a name="l03093"></a>03093                m2 = 0;
<a name="l03094"></a>03094          } <span class="keywordflow">else</span>
<a name="l03095"></a>03095             m2 = m1;
<a name="l03096"></a>03096 
<a name="l03097"></a>03097          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;y2&quot;</span>))
<a name="l03098"></a>03098             y2 = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;y2&quot;</span>));
<a name="l03099"></a>03099          <span class="keywordflow">else</span>
<a name="l03100"></a>03100             y2 = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;y1&quot;</span>));
<a name="l03101"></a>03101 
<a name="l03102"></a>03102          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;d2&quot;</span>))
<a name="l03103"></a>03103             d2 = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;d2&quot;</span>));
<a name="l03104"></a>03104          <span class="keywordflow">else</span>
<a name="l03105"></a>03105             d2 = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;d1&quot;</span>));
<a name="l03106"></a>03106 
<a name="l03107"></a>03107          memset(&amp;tms, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> tm));
<a name="l03108"></a>03108          tms.tm_year = y2 % 100;
<a name="l03109"></a>03109          tms.tm_mon = m2;
<a name="l03110"></a>03110          tms.tm_mday = d2;
<a name="l03111"></a>03111          tms.tm_hour = 24;
<a name="l03112"></a>03112 
<a name="l03113"></a>03113          <span class="keywordflow">if</span> (tms.tm_year &lt; 90)
<a name="l03114"></a>03114             tms.tm_year += 100;
<a name="l03115"></a>03115          ltime_end = mktime(&amp;tms);
<a name="l03116"></a>03116       }
<a name="l03117"></a>03117    }
<a name="l03118"></a>03118 
<a name="l03119"></a>03119   <span class="comment">/*---- title row ----*/</span>
<a name="l03120"></a>03120 
<a name="l03121"></a>03121    colspan = full ? 6 : 7;
<a name="l03122"></a>03122    <span class="keywordflow">if</span> (!display_run_number)
<a name="l03123"></a>03123       colspan--;
<a name="l03124"></a>03124 
<a name="l03125"></a>03125    <span class="comment">/* menu buttons */</span>
<a name="l03126"></a>03126    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=%d bgcolor=#C0C0C0&gt;\n&quot;</span>, colspan);
<a name="l03127"></a>03127    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Query&gt;\n&quot;</span>);
<a name="l03128"></a>03128    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Last&gt;\n&quot;</span>);
<a name="l03129"></a>03129    <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9c91f81733a48f1fbc887b013ee0de14">elog_mode</a>)
<a name="l03130"></a>03130       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Status&gt;\n&quot;</span>);
<a name="l03131"></a>03131    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l03132"></a>03132 
<a name="l03133"></a>03133    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;r1&quot;</span>)) {
<a name="l03134"></a>03134       <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;r2&quot;</span>))
<a name="l03135"></a>03135          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l03136"></a>03136              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=%d bgcolor=#FFFF00&gt;&lt;b&gt;Query result between runs %s and %s&lt;/b&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l03137"></a>03137               colspan, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;r1&quot;</span>), <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;r2&quot;</span>));
<a name="l03138"></a>03138       <span class="keywordflow">else</span>
<a name="l03139"></a>03139          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l03140"></a>03140              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=%d bgcolor=#FFFF00&gt;&lt;b&gt;Query result between run %s and today&lt;/b&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l03141"></a>03141               colspan, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;r1&quot;</span>));
<a name="l03142"></a>03142    } <span class="keywordflow">else</span> {
<a name="l03143"></a>03143       <span class="keywordflow">if</span> (last_n) {
<a name="l03144"></a>03144          <span class="keywordflow">if</span> (last_n &lt; 24) {
<a name="l03145"></a>03145             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l03146"></a>03146                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l03147"></a>03147                    (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6&gt;&lt;a href=\&quot;last%d?exp=%s\&quot;&gt;Last %d hours&lt;/a&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l03148"></a>03148                     last_n * 2, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, last_n * 2);
<a name="l03149"></a>03149             <span class="keywordflow">else</span>
<a name="l03150"></a>03150                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6&gt;&lt;a href=\&quot;last%d\&quot;&gt;Last %d hours&lt;/a&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l03151"></a>03151                         last_n * 2, last_n * 2);
<a name="l03152"></a>03152 
<a name="l03153"></a>03153             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6 bgcolor=#FFFF00&gt;&lt;b&gt;Last %d hours&lt;/b&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l03154"></a>03154                      last_n);
<a name="l03155"></a>03155          } <span class="keywordflow">else</span> {
<a name="l03156"></a>03156             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l03157"></a>03157                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l03158"></a>03158                    (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6&gt;&lt;a href=\&quot;last%d?exp=%s\&quot;&gt;Last %d days&lt;/a&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l03159"></a>03159                     last_n * 2, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, last_n / 24 * 2);
<a name="l03160"></a>03160             <span class="keywordflow">else</span>
<a name="l03161"></a>03161                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6&gt;&lt;a href=\&quot;last%d\&quot;&gt;Last %d days&lt;/a&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l03162"></a>03162                         last_n * 2, last_n / 24 * 2);
<a name="l03163"></a>03163 
<a name="l03164"></a>03164             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6 bgcolor=#FFFF00&gt;&lt;b&gt;Last %d days&lt;/b&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l03165"></a>03165                      last_n / 24);
<a name="l03166"></a>03166          }
<a name="l03167"></a>03167       }
<a name="l03168"></a>03168 
<a name="l03169"></a>03169       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;m2&quot;</span>) || *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;y2&quot;</span>) || *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;d2&quot;</span>))
<a name="l03170"></a>03170          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l03171"></a>03171              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=%d bgcolor=#FFFF00&gt;&lt;b&gt;Query result between %s %s %s and %s %d %d&lt;/b&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l03172"></a>03172               colspan, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;m1&quot;</span>), <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;d1&quot;</span>), <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;y1&quot;</span>), <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[m2], d2, y2);
<a name="l03173"></a>03173       <span class="keywordflow">else</span> {
<a name="l03174"></a>03174          <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l03175"></a>03175          ptms = localtime(&amp;now);
<a name="l03176"></a>03176          ptms-&gt;tm_year += 1900;
<a name="l03177"></a>03177 
<a name="l03178"></a>03178          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l03179"></a>03179              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=%d bgcolor=#FFFF00&gt;&lt;b&gt;Query result between %s %s %s and %s %d %d&lt;/b&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l03180"></a>03180               colspan, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;m1&quot;</span>), <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;d1&quot;</span>), <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;y1&quot;</span>),
<a name="l03181"></a>03181               <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[ptms-&gt;tm_mon], ptms-&gt;tm_mday, ptms-&gt;tm_year);
<a name="l03182"></a>03182       }
<a name="l03183"></a>03183    }
<a name="l03184"></a>03184 
<a name="l03185"></a>03185    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&lt;tr&gt;&quot;</span>);
<a name="l03186"></a>03186 
<a name="l03187"></a>03187    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=%d bgcolor=#FFA0A0&gt;\n&quot;</span>, colspan);
<a name="l03188"></a>03188 
<a name="l03189"></a>03189    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;author&quot;</span>))
<a name="l03190"></a>03190       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Author: &lt;b&gt;%s&lt;/b&gt;   &quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;author&quot;</span>));
<a name="l03191"></a>03191 
<a name="l03192"></a>03192    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;type&quot;</span>))
<a name="l03193"></a>03193       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Type: &lt;b&gt;%s&lt;/b&gt;   &quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;type&quot;</span>));
<a name="l03194"></a>03194 
<a name="l03195"></a>03195    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;system&quot;</span>))
<a name="l03196"></a>03196       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;System: &lt;b&gt;%s&lt;/b&gt;   &quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;system&quot;</span>));
<a name="l03197"></a>03197 
<a name="l03198"></a>03198    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;subject&quot;</span>))
<a name="l03199"></a>03199       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Subject: &lt;b&gt;%s&lt;/b&gt;   &quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;subject&quot;</span>));
<a name="l03200"></a>03200 
<a name="l03201"></a>03201    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;subtext&quot;</span>))
<a name="l03202"></a>03202       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Text: &lt;b&gt;%s&lt;/b&gt;   &quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;subtext&quot;</span>));
<a name="l03203"></a>03203 
<a name="l03204"></a>03204    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l03205"></a>03205 
<a name="l03206"></a>03206   <span class="comment">/*---- table titles ----*/</span>
<a name="l03207"></a>03207 
<a name="l03208"></a>03208    <span class="keywordflow">if</span> (display_run_number) {
<a name="l03209"></a>03209       <span class="keywordflow">if</span> (full)
<a name="l03210"></a>03210          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th&gt;Date&lt;th&gt;Run&lt;th&gt;Author&lt;th&gt;Type&lt;th&gt;System&lt;th&gt;Subject&lt;/tr&gt;\n&quot;</span>);
<a name="l03211"></a>03211       <span class="keywordflow">else</span>
<a name="l03212"></a>03212          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l03213"></a>03213              (<span class="stringliteral">&quot;&lt;tr&gt;&lt;th&gt;Date&lt;th&gt;Run&lt;th&gt;Author&lt;th&gt;Type&lt;th&gt;System&lt;th&gt;Subject&lt;th&gt;Text&lt;/tr&gt;\n&quot;</span>);
<a name="l03214"></a>03214    } <span class="keywordflow">else</span> {
<a name="l03215"></a>03215       <span class="keywordflow">if</span> (full)
<a name="l03216"></a>03216          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th&gt;Date&lt;th&gt;Author&lt;th&gt;Type&lt;th&gt;System&lt;th&gt;Subject&lt;/tr&gt;\n&quot;</span>);
<a name="l03217"></a>03217       <span class="keywordflow">else</span>
<a name="l03218"></a>03218          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th&gt;Date&lt;th&gt;Author&lt;th&gt;Type&lt;th&gt;System&lt;th&gt;Subject&lt;th&gt;Text&lt;/tr&gt;\n&quot;</span>);
<a name="l03219"></a>03219    }
<a name="l03220"></a>03220 
<a name="l03221"></a>03221   <span class="comment">/*---- do query ----*/</span>
<a name="l03222"></a>03222 
<a name="l03223"></a>03223    <span class="keywordflow">if</span> (last_n) {
<a name="l03224"></a>03224       <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l03225"></a>03225       ltime_start = now - 3600 * last_n;
<a name="l03226"></a>03226       ptms = localtime(&amp;ltime_start);
<a name="l03227"></a>03227 
<a name="l03228"></a>03228       sprintf(tag, <span class="stringliteral">&quot;%02d%02d%02d.0&quot;</span>, ptms-&gt;tm_year % 100, ptms-&gt;tm_mon + 1,
<a name="l03229"></a>03229               ptms-&gt;tm_mday);
<a name="l03230"></a>03230    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;r1&quot;</span>)) {
<a name="l03231"></a>03231       <span class="comment">/* do run query */</span>
<a name="l03232"></a>03232       <a class="code" href="group__msectionh.html#ga4855981b0cdcc0d4f3dbab590b365619">el_search_run</a>(atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;r1&quot;</span>)), tag);
<a name="l03233"></a>03233    } <span class="keywordflow">else</span> {
<a name="l03234"></a>03234       <span class="comment">/* do date-date query */</span>
<a name="l03235"></a>03235       sprintf(tag, <span class="stringliteral">&quot;%02d%02d%02d.0&quot;</span>, atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;y1&quot;</span>)) % 100, m1 + 1,
<a name="l03236"></a>03236               atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;d1&quot;</span>)));
<a name="l03237"></a>03237    }
<a name="l03238"></a>03238 
<a name="l03239"></a>03239    <span class="keywordflow">do</span> {
<a name="l03240"></a>03240       size = <span class="keyword">sizeof</span>(text);
<a name="l03241"></a>03241       status = <a class="code" href="group__msectionh.html#ga203cfa8e2d036e5e56a2fdd9d17eb09d">el_retrieve</a>(tag, date, &amp;run, author, type, system, subject,
<a name="l03242"></a>03242                            text, &amp;size, orig_tag, reply_tag,
<a name="l03243"></a>03243                            attachment[0], attachment[1], attachment[2], encoding);
<a name="l03244"></a>03244       strcat(tag, <span class="stringliteral">&quot;+1&quot;</span>);
<a name="l03245"></a>03245 
<a name="l03246"></a>03246       <span class="comment">/* check for end run */</span>
<a name="l03247"></a>03247       <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;r2&quot;</span>) &amp;&amp; atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;r2&quot;</span>)) &lt; run)
<a name="l03248"></a>03248          <span class="keywordflow">break</span>;
<a name="l03249"></a>03249 
<a name="l03250"></a>03250       <span class="comment">/* convert date to unix format */</span>
<a name="l03251"></a>03251       memset(&amp;tms, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> tm));
<a name="l03252"></a>03252       tms.tm_year = (tag[0] - <span class="charliteral">&apos;0&apos;</span>) * 10 + (tag[1] - <span class="charliteral">&apos;0&apos;</span>);
<a name="l03253"></a>03253       tms.tm_mon = (tag[2] - <span class="charliteral">&apos;0&apos;</span>) * 10 + (tag[3] - <span class="charliteral">&apos;0&apos;</span>) - 1;
<a name="l03254"></a>03254       tms.tm_mday = (tag[4] - <span class="charliteral">&apos;0&apos;</span>) * 10 + (tag[5] - <span class="charliteral">&apos;0&apos;</span>);
<a name="l03255"></a>03255       tms.tm_hour = (date[11] - <span class="charliteral">&apos;0&apos;</span>) * 10 + (date[12] - <span class="charliteral">&apos;0&apos;</span>);
<a name="l03256"></a>03256       tms.tm_min = (date[14] - <span class="charliteral">&apos;0&apos;</span>) * 10 + (date[15] - <span class="charliteral">&apos;0&apos;</span>);
<a name="l03257"></a>03257       tms.tm_sec = (date[17] - <span class="charliteral">&apos;0&apos;</span>) * 10 + (date[18] - <span class="charliteral">&apos;0&apos;</span>);
<a name="l03258"></a>03258 
<a name="l03259"></a>03259       <span class="keywordflow">if</span> (tms.tm_year &lt; 90)
<a name="l03260"></a>03260          tms.tm_year += 100;
<a name="l03261"></a>03261       ltime_current = mktime(&amp;tms);
<a name="l03262"></a>03262 
<a name="l03263"></a>03263       <span class="comment">/* check for start date */</span>
<a name="l03264"></a>03264       <span class="keywordflow">if</span> (ltime_start &gt; 0)
<a name="l03265"></a>03265          <span class="keywordflow">if</span> (ltime_current &lt; ltime_start)
<a name="l03266"></a>03266             <span class="keywordflow">continue</span>;
<a name="l03267"></a>03267 
<a name="l03268"></a>03268       <span class="comment">/* check for end date */</span>
<a name="l03269"></a>03269       <span class="keywordflow">if</span> (ltime_end &gt; 0) {
<a name="l03270"></a>03270          <span class="keywordflow">if</span> (ltime_current &gt; ltime_end)
<a name="l03271"></a>03271             <span class="keywordflow">break</span>;
<a name="l03272"></a>03272       }
<a name="l03273"></a>03273 
<a name="l03274"></a>03274       <span class="keywordflow">if</span> (status == <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a>) {
<a name="l03275"></a>03275          <span class="comment">/* do filtering */</span>
<a name="l03276"></a>03276          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;type&quot;</span>) &amp;&amp; !<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;type&quot;</span>), type))
<a name="l03277"></a>03277             <span class="keywordflow">continue</span>;
<a name="l03278"></a>03278          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;system&quot;</span>) &amp;&amp; !<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;system&quot;</span>), system))
<a name="l03279"></a>03279             <span class="keywordflow">continue</span>;
<a name="l03280"></a>03280 
<a name="l03281"></a>03281          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;author&quot;</span>)) {
<a name="l03282"></a>03282             strcpy(str, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;author&quot;</span>));
<a name="l03283"></a>03283             <span class="keywordflow">for</span> (i = 0; i &lt; (int) strlen(str); i++)
<a name="l03284"></a>03284                str[i] = toupper(str[i]);
<a name="l03285"></a>03285             str[i] = 0;
<a name="l03286"></a>03286             <span class="keywordflow">for</span> (i = 0; i &lt; (int) strlen(author) &amp;&amp; author[i] != <span class="charliteral">&apos;@&apos;</span>; i++)
<a name="l03287"></a>03287                str2[i] = toupper(author[i]);
<a name="l03288"></a>03288             str2[i] = 0;
<a name="l03289"></a>03289 
<a name="l03290"></a>03290             <span class="keywordflow">if</span> (strstr(str2, str) == NULL)
<a name="l03291"></a>03291                <span class="keywordflow">continue</span>;
<a name="l03292"></a>03292          }
<a name="l03293"></a>03293 
<a name="l03294"></a>03294          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;subject&quot;</span>)) {
<a name="l03295"></a>03295             strcpy(str, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;subject&quot;</span>));
<a name="l03296"></a>03296             <span class="keywordflow">for</span> (i = 0; i &lt; (int) strlen(str); i++)
<a name="l03297"></a>03297                str[i] = toupper(str[i]);
<a name="l03298"></a>03298             str[i] = 0;
<a name="l03299"></a>03299             <span class="keywordflow">for</span> (i = 0; i &lt; (int) strlen(subject); i++)
<a name="l03300"></a>03300                str2[i] = toupper(subject[i]);
<a name="l03301"></a>03301             str2[i] = 0;
<a name="l03302"></a>03302 
<a name="l03303"></a>03303             <span class="keywordflow">if</span> (strstr(str2, str) == NULL)
<a name="l03304"></a>03304                <span class="keywordflow">continue</span>;
<a name="l03305"></a>03305          }
<a name="l03306"></a>03306 
<a name="l03307"></a>03307          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;subtext&quot;</span>)) {
<a name="l03308"></a>03308             strcpy(str, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;subtext&quot;</span>));
<a name="l03309"></a>03309             <span class="keywordflow">for</span> (i = 0; i &lt; (int) strlen(str); i++)
<a name="l03310"></a>03310                str[i] = toupper(str[i]);
<a name="l03311"></a>03311             str[i] = 0;
<a name="l03312"></a>03312             <span class="keywordflow">for</span> (i = 0; i &lt; (int) strlen(text); i++)
<a name="l03313"></a>03313                str2[i] = toupper(text[i]);
<a name="l03314"></a>03314             str2[i] = 0;
<a name="l03315"></a>03315 
<a name="l03316"></a>03316             <span class="keywordflow">if</span> (strstr(str2, str) == NULL)
<a name="l03317"></a>03317                <span class="keywordflow">continue</span>;
<a name="l03318"></a>03318          }
<a name="l03319"></a>03319 
<a name="l03320"></a>03320          <span class="comment">/* filter passed: display line */</span>
<a name="l03321"></a>03321 
<a name="l03322"></a>03322          strcpy(str, tag);
<a name="l03323"></a>03323          <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;+&apos;</span>))
<a name="l03324"></a>03324             *strchr(str, <span class="charliteral">&apos;+&apos;</span>) = 0;
<a name="l03325"></a>03325          <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l03326"></a>03326             sprintf(ref, <span class="stringliteral">&quot;/EL/%s?exp=%s&quot;</span>, str, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l03327"></a>03327          <span class="keywordflow">else</span>
<a name="l03328"></a>03328             sprintf(ref, <span class="stringliteral">&quot;/EL/%s&quot;</span>, str);
<a name="l03329"></a>03329 
<a name="l03330"></a>03330          strncpy(str, text, 80);
<a name="l03331"></a>03331          str[80] = 0;
<a name="l03332"></a>03332 
<a name="l03333"></a>03333          <span class="keywordflow">if</span> (full) {
<a name="l03334"></a>03334             <span class="keywordflow">if</span> (display_run_number) {
<a name="l03335"></a>03335                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;&lt;a href=%s&gt;%s&lt;/a&gt;&lt;td&gt;%d&lt;td&gt;%s&lt;td&gt;%s&lt;td&gt;%s&lt;td&gt;%s&lt;/tr&gt;\n&quot;</span>,
<a name="l03336"></a>03336                         ref, date, run, author, type, system, subject);
<a name="l03337"></a>03337                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6&gt;&quot;</span>);
<a name="l03338"></a>03338             } <span class="keywordflow">else</span> {
<a name="l03339"></a>03339                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;&lt;a href=%s&gt;%s&lt;/a&gt;&lt;td&gt;%s&lt;td&gt;%s&lt;td&gt;%s&lt;td&gt;%s&lt;/tr&gt;\n&quot;</span>, ref,
<a name="l03340"></a>03340                         date, author, type, system, subject);
<a name="l03341"></a>03341                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=5&gt;&quot;</span>);
<a name="l03342"></a>03342             }
<a name="l03343"></a>03343 
<a name="l03344"></a>03344             <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(encoding, <span class="stringliteral">&quot;plain&quot;</span>)) {
<a name="l03345"></a>03345                <a class="code" href="mhttpd_8c.html#a0c625fe56e336fc4d14a579b876b9fa8">rsputs</a>(<span class="stringliteral">&quot;&lt;pre&gt;&quot;</span>);
<a name="l03346"></a>03346                <a class="code" href="mhttpd_8c.html#a3fc73195d7773ac70a09f5afb5588d5a">rsputs2</a>(text);
<a name="l03347"></a>03347                <a class="code" href="mhttpd_8c.html#a0c625fe56e336fc4d14a579b876b9fa8">rsputs</a>(<span class="stringliteral">&quot;&lt;/pre&gt;&quot;</span>);
<a name="l03348"></a>03348             } <span class="keywordflow">else</span>
<a name="l03349"></a>03349                <a class="code" href="mhttpd_8c.html#a0c625fe56e336fc4d14a579b876b9fa8">rsputs</a>(text);
<a name="l03350"></a>03350 
<a name="l03351"></a>03351             <span class="keywordflow">if</span> (!show_attachments &amp;&amp; attachment[0][0]) {
<a name="l03352"></a>03352                <span class="keywordflow">if</span> (attachment[1][0])
<a name="l03353"></a>03353                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Attachments: &quot;</span>);
<a name="l03354"></a>03354                <span class="keywordflow">else</span>
<a name="l03355"></a>03355                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Attachment: &quot;</span>);
<a name="l03356"></a>03356             } <span class="keywordflow">else</span>
<a name="l03357"></a>03357                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l03358"></a>03358 
<a name="l03359"></a>03359             <span class="keywordflow">for</span> (index = 0; index &lt; 3; index++) {
<a name="l03360"></a>03360                <span class="keywordflow">if</span> (attachment[index][0]) {
<a name="l03361"></a>03361                   <span class="keywordflow">for</span> (i = 0; i &lt; (int) strlen(attachment[index]); i++)
<a name="l03362"></a>03362                      str[i] = toupper(attachment[index][i]);
<a name="l03363"></a>03363                   str[i] = 0;
<a name="l03364"></a>03364 
<a name="l03365"></a>03365                   <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l03366"></a>03366                      sprintf(ref, <span class="stringliteral">&quot;/EL/%s?exp=%s&quot;</span>, attachment[index], <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l03367"></a>03367                   <span class="keywordflow">else</span>
<a name="l03368"></a>03368                      sprintf(ref, <span class="stringliteral">&quot;/EL/%s&quot;</span>, attachment[index]);
<a name="l03369"></a>03369 
<a name="l03370"></a>03370                   <span class="keywordflow">if</span> (!show_attachments) {
<a name="l03371"></a>03371                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;%s\&quot;&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/a&gt; &quot;</span>,
<a name="l03372"></a>03372                               ref, attachment[index] + 14);
<a name="l03373"></a>03373                   } <span class="keywordflow">else</span> {
<a name="l03374"></a>03374                      colspan = display_run_number ? 6 : 5;
<a name="l03375"></a>03375                      <span class="keywordflow">if</span> (strstr(str, <span class="stringliteral">&quot;.GIF&quot;</span>) || strstr(str, <span class="stringliteral">&quot;.PNG&quot;</span>)
<a name="l03376"></a>03376                          || strstr(str, <span class="stringliteral">&quot;.JPG&quot;</span>)) {
<a name="l03377"></a>03377                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l03378"></a>03378                             (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=%d&gt;Attachment: &lt;a href=\&quot;%s\&quot;&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/a&gt;&lt;br&gt;\n&quot;</span>,
<a name="l03379"></a>03379                              colspan, ref, attachment[index] + 14);
<a name="l03380"></a>03380                         <span class="keywordflow">if</span> (show_attachments)
<a name="l03381"></a>03381                            <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;img src=\&quot;%s\&quot;&gt;&lt;/tr&gt;&quot;</span>, ref);
<a name="l03382"></a>03382                      } <span class="keywordflow">else</span> {
<a name="l03383"></a>03383                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l03384"></a>03384                             (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=%d bgcolor=#C0C0FF&gt;Attachment: &lt;a href=\&quot;%s\&quot;&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/a&gt;\n&quot;</span>,
<a name="l03385"></a>03385                              colspan, ref, attachment[index] + 14);
<a name="l03386"></a>03386 
<a name="l03387"></a>03387                         <span class="keywordflow">if</span> ((strstr(str, <span class="stringliteral">&quot;.TXT&quot;</span>) ||
<a name="l03388"></a>03388                              strstr(str, <span class="stringliteral">&quot;.ASC&quot;</span>) ||
<a name="l03389"></a>03389                              strchr(str, <span class="charliteral">&apos;.&apos;</span>) == NULL) &amp;&amp; show_attachments) {
<a name="l03390"></a>03390                            <span class="comment">/* display attachment */</span>
<a name="l03391"></a>03391                            <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;br&gt;&lt;pre&gt;&quot;</span>);
<a name="l03392"></a>03392 
<a name="l03393"></a>03393                            file_name[0] = 0;
<a name="l03394"></a>03394                            size = <span class="keyword">sizeof</span>(file_name);
<a name="l03395"></a>03395                            memset(file_name, 0, size);
<a name="l03396"></a>03396                            <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Data dir&quot;</span>, file_name, &amp;size,
<a name="l03397"></a>03397                                         <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l03398"></a>03398                            <span class="keywordflow">if</span> (file_name[0] != 0)
<a name="l03399"></a>03399                               <span class="keywordflow">if</span> (file_name[strlen(file_name) - 1] != <a class="code" href="group__midasincludecode.html#ga0920890c442b665b0c6609fa796e9047">DIR_SEPARATOR</a>)
<a name="l03400"></a>03400                                  strcat(file_name, <a class="code" href="group__midasincludecode.html#ga23e72ca2d8456a971c13441bdfc4586f">DIR_SEPARATOR_STR</a>);
<a name="l03401"></a>03401                            strcat(file_name, attachment[index]);
<a name="l03402"></a>03402 
<a name="l03403"></a>03403                            f = fopen(file_name, <span class="stringliteral">&quot;rt&quot;</span>);
<a name="l03404"></a>03404                            <span class="keywordflow">if</span> (f != NULL) {
<a name="l03405"></a>03405                               <span class="keywordflow">while</span> (!feof(f)) {
<a name="l03406"></a>03406                                  str[0] = 0;
<a name="l03407"></a>03407                                  fgets(str, <span class="keyword">sizeof</span>(str), f);
<a name="l03408"></a>03408                                  <a class="code" href="mhttpd_8c.html#a3fc73195d7773ac70a09f5afb5588d5a">rsputs2</a>(str);
<a name="l03409"></a>03409                               }
<a name="l03410"></a>03410                               fclose(f);
<a name="l03411"></a>03411                            }
<a name="l03412"></a>03412 
<a name="l03413"></a>03413                            <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/pre&gt;\n&quot;</span>);
<a name="l03414"></a>03414                         }
<a name="l03415"></a>03415                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l03416"></a>03416                      }
<a name="l03417"></a>03417                   }
<a name="l03418"></a>03418                }
<a name="l03419"></a>03419             }
<a name="l03420"></a>03420 
<a name="l03421"></a>03421             <span class="keywordflow">if</span> (!show_attachments &amp;&amp; attachment[0][0])
<a name="l03422"></a>03422                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l03423"></a>03423 
<a name="l03424"></a>03424          } <span class="keywordflow">else</span> {
<a name="l03425"></a>03425             <span class="keywordflow">if</span> (display_run_number)
<a name="l03426"></a>03426                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;&lt;a href=%s&gt;%s&lt;/a&gt;&lt;td&gt;%d&lt;td&gt;%s&lt;td&gt;%s&lt;td&gt;%s&lt;td&gt;%s\n&quot;</span>, ref,
<a name="l03427"></a>03427                         date, run, author, type, system, subject);
<a name="l03428"></a>03428             <span class="keywordflow">else</span>
<a name="l03429"></a>03429                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;&lt;a href=%s&gt;%s&lt;/a&gt;&lt;td&gt;%s&lt;td&gt;%s&lt;td&gt;%s&lt;td&gt;%s\n&quot;</span>, ref, date,
<a name="l03430"></a>03430                         author, type, system, subject);
<a name="l03431"></a>03431 
<a name="l03432"></a>03432             <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(encoding, <span class="stringliteral">&quot;HTML&quot;</span>))
<a name="l03433"></a>03433                <a class="code" href="mhttpd_8c.html#a0c625fe56e336fc4d14a579b876b9fa8">rsputs</a>(text);
<a name="l03434"></a>03434             <span class="keywordflow">else</span>
<a name="l03435"></a>03435                <a class="code" href="mhttpd_8c.html#af374dce40baae97a533a83a0626c23dc">strencode</a>(text);
<a name="l03436"></a>03436 
<a name="l03437"></a>03437             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l03438"></a>03438          }
<a name="l03439"></a>03439       }
<a name="l03440"></a>03440 
<a name="l03441"></a>03441    } <span class="keywordflow">while</span> (status == <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a>);
<a name="l03442"></a>03442 
<a name="l03443"></a>03443    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>);
<a name="l03444"></a>03444    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l03445"></a>03445 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6c4dc4a30c55473c220a5ba8a5ea4575"></a><!-- doxytag: member="mhttpd.c::show_error" ref="a6c4dc4a30c55473c220a5ba8a5ea4575" args="(char *error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_error </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>error</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01557">1557</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, and <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>, <a class="el" href="mhttpd_8c_source.html#l09964">server_loop()</a>, <a class="el" href="mhttpd_8c_source.html#l08158">show_hist_config_page()</a>, <a class="el" href="mhttpd_8c_source.html#l06598">show_programs_page()</a>, and <a class="el" href="mhttpd_8c_source.html#l03805">submit_elog()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01558"></a>01558 {
<a name="l01559"></a>01559    <span class="comment">/* header */</span>
<a name="l01560"></a>01560    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l01561"></a>01561    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l01562"></a>01562    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l01563"></a>01563 
<a name="l01564"></a>01564    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;MIDAS error&lt;/title&gt;&lt;/head&gt;\n&quot;</span>);
<a name="l01565"></a>01565    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;body&gt;&lt;H1&gt;%s&lt;/H1&gt;&lt;/body&gt;&lt;/html&gt;\n&quot;</span>, error);
<a name="l01566"></a>01566 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3b0a144daa9f2395fbba48e847a4e6d6"></a><!-- doxytag: member="mhttpd.c::show_experiment_page" ref="a3b0a144daa9f2395fbba48e847a4e6d6" args="(char exp_list[MAX_EXPERIMENT][NAME_LENGTH])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_experiment_page </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>exp_list</em>[MAX_EXPERIMENT][NAME_LENGTH]</td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l05528">5528</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="midas_8h_source.html#l00687">MAX_EXPERIMENT</a>, and <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05529"></a>05529 {
<a name="l05530"></a>05530    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l05531"></a>05531 
<a name="l05532"></a>05532    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l05533"></a>05533    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l05534"></a>05534    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l05535"></a>05535 
<a name="l05536"></a>05536    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;\n&quot;</span>);
<a name="l05537"></a>05537    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;head&gt;\n&quot;</span>);
<a name="l05538"></a>05538    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;title&gt;MIDAS Experiment Selection&lt;/title&gt;\n&quot;</span>);
<a name="l05539"></a>05539    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/head&gt;\n\n&quot;</span>);
<a name="l05540"></a>05540 
<a name="l05541"></a>05541    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;body&gt;\n\n&quot;</span>);
<a name="l05542"></a>05542    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Several experiments are defined on this host.&lt;BR&gt;\n&quot;</span>);
<a name="l05543"></a>05543    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Please select the one to connect to:&lt;P&gt;&quot;</span>);
<a name="l05544"></a>05544 
<a name="l05545"></a>05545    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__midasincludecode.html#ga96dcd778f7870d9d3a834f63f7e8506e">MAX_EXPERIMENT</a>; i++) {
<a name="l05546"></a>05546       <span class="keywordflow">if</span> (exp_list[i][0])
<a name="l05547"></a>05547          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/?exp=%s\&quot;&gt;%s&lt;/a&gt;&lt;p&gt;&quot;</span>, exp_list[i], exp_list[i]);
<a name="l05548"></a>05548    }
<a name="l05549"></a>05549 
<a name="l05550"></a>05550    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;\n&quot;</span>);
<a name="l05551"></a>05551    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/html&gt;\r\n&quot;</span>);
<a name="l05552"></a>05552 
<a name="l05553"></a>05553 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a428671e131872ee405c8b4d799ee1ffe"></a><!-- doxytag: member="mhttpd.c::show_find_page" ref="a428671e131872ee405c8b4d799ee1ffe" args="(char *enc_path, char *value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_find_page </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>enc_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l06130">6130</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="group__msectionh.html#ga2d3ab37fad6c363eaa39676b3cdb4f7a">db_scan_tree()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l01382">search_callback()</a>, and <a class="el" href="mhttpd_8c_source.html#l01502">show_header()</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06131"></a>06131 {
<a name="l06132"></a>06132    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey;
<a name="l06133"></a>06133 
<a name="l06134"></a>06134    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l06135"></a>06135 
<a name="l06136"></a>06136    <span class="keywordflow">if</span> (<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>[0] == 0) {
<a name="l06137"></a>06137       <span class="comment">/* without value, show find dialog */</span>
<a name="l06138"></a>06138 
<a name="l06139"></a>06139       <a class="code" href="mhttpd_8c.html#ae5fb6c731656613ead122d173a8ef7a8">show_header</a>(hDB, <span class="stringliteral">&quot;Find value&quot;</span>, <span class="stringliteral">&quot;GET&quot;</span>, enc_path, 1, 0);
<a name="l06140"></a>06140 
<a name="l06141"></a>06141       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#A0A0FF colspan=2&gt;Find string in Online Database&lt;/tr&gt;\n&quot;</span>);
<a name="l06142"></a>06142       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;Enter substring (case insensitive)\n&quot;</span>);
<a name="l06143"></a>06143 
<a name="l06144"></a>06144       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td&gt;&lt;input type=\&quot;text\&quot; size=\&quot;20\&quot; maxlength=\&quot;80\&quot; name=\&quot;value\&quot;&gt;\n&quot;</span>);
<a name="l06145"></a>06145       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>);
<a name="l06146"></a>06146 
<a name="l06147"></a>06147       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=center colspan=2&gt;&quot;</span>);
<a name="l06148"></a>06148       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Find&gt;&quot;</span>);
<a name="l06149"></a>06149       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Cancel&gt;&quot;</span>);
<a name="l06150"></a>06150       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>);
<a name="l06151"></a>06151       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>);
<a name="l06152"></a>06152 
<a name="l06153"></a>06153       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=cmd value=Find&gt;&quot;</span>);
<a name="l06154"></a>06154 
<a name="l06155"></a>06155       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l06156"></a>06156    } <span class="keywordflow">else</span> {
<a name="l06157"></a>06157       <a class="code" href="mhttpd_8c.html#ae5fb6c731656613ead122d173a8ef7a8">show_header</a>(hDB, <span class="stringliteral">&quot;Search results&quot;</span>, <span class="stringliteral">&quot;GET&quot;</span>, enc_path, 1, 0);
<a name="l06158"></a>06158 
<a name="l06159"></a>06159       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#A0A0A0&gt;\n&quot;</span>);
<a name="l06160"></a>06160       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Find&gt;\n&quot;</span>);
<a name="l06161"></a>06161       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=ODB&gt;\n&quot;</span>);
<a name="l06162"></a>06162       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Help&gt;\n&quot;</span>);
<a name="l06163"></a>06163       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n\n&quot;</span>);
<a name="l06164"></a>06164 
<a name="l06165"></a>06165       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#A0A0FF colspan=2&gt;&quot;</span>);
<a name="l06166"></a>06166       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Results of search for substring \&quot;%s\&quot;&lt;/tr&gt;\n&quot;</span>, <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l06167"></a>06167       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th&gt;Key&lt;th&gt;Value&lt;/tr&gt;\n&quot;</span>);
<a name="l06168"></a>06168 
<a name="l06169"></a>06169       <span class="comment">/* start from root */</span>
<a name="l06170"></a>06170       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;&quot;</span>, &amp;hkey);
<a name="l06171"></a>06171 
<a name="l06172"></a>06172       <span class="comment">/* scan tree, call &quot;search_callback&quot; for each key */</span>
<a name="l06173"></a>06173       <a class="code" href="group__msectionh.html#ga2d3ab37fad6c363eaa39676b3cdb4f7a">db_scan_tree</a>(hDB, hkey, 0, <a class="code" href="mhttpd_8c.html#ad8887c77d8b39e96ce32b579f1f8b17b">search_callback</a>, (<span class="keywordtype">void</span> *) <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l06174"></a>06174 
<a name="l06175"></a>06175       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>);
<a name="l06176"></a>06176       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l06177"></a>06177    }
<a name="l06178"></a>06178 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af66885df3b396f0b6193e07753159c2d"></a><!-- doxytag: member="mhttpd.c::show_form_query" ref="af66885df3b396f0b6193e07753159c2d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_form_query </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l03588">3588</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="mana_8cpp_source.html#l00800">getparam()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00323">run_number</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="bit3__mvme_2mvmestd_8h_source.html#l00045">SUCCESS</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03589"></a>03589 {
<a name="l03590"></a>03590    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a> = 0, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a16695ea2bfd19f294afe066d6007ab36">run_number</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l03591"></a>03591    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l03592"></a>03592    time_t now;
<a name="l03593"></a>03593    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey, hkeyroot;
<a name="l03594"></a>03594    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l03595"></a>03595 
<a name="l03596"></a>03596    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l03597"></a>03597 
<a name="l03598"></a>03598    <span class="comment">/* header */</span>
<a name="l03599"></a>03599    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l03600"></a>03600    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l03601"></a>03601    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l03602"></a>03602 
<a name="l03603"></a>03603    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;MIDAS ELog&lt;/title&gt;&lt;/head&gt;\n&quot;</span>);
<a name="l03604"></a>03604    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;body&gt;&lt;form method=\&quot;GET\&quot; action=\&quot;/EL/\&quot;&gt;\n&quot;</span>);
<a name="l03605"></a>03605 
<a name="l03606"></a>03606    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;form&quot;</span>) == 0)
<a name="l03607"></a>03607       <span class="keywordflow">return</span>;
<a name="l03608"></a>03608 
<a name="l03609"></a>03609    <span class="comment">/* define hidden field for experiment */</span>
<a name="l03610"></a>03610    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l03611"></a>03611       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=exp value=\&quot;%s\&quot;&gt;\n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l03612"></a>03612 
<a name="l03613"></a>03613    <span class="comment">/* hidden field for form */</span>
<a name="l03614"></a>03614    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=form value=\&quot;%s\&quot;&gt;\n&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;form&quot;</span>));
<a name="l03615"></a>03615 
<a name="l03616"></a>03616    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;table border=3 cellpadding=1&gt;\n&quot;</span>);
<a name="l03617"></a>03617 
<a name="l03618"></a>03618   <span class="comment">/*---- title row ----*/</span>
<a name="l03619"></a>03619 
<a name="l03620"></a>03620    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th colspan=2 bgcolor=#A0A0FF&gt;MIDAS Electronic Logbook&quot;</span>);
<a name="l03621"></a>03621    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th colspan=2 bgcolor=#A0A0FF&gt;Form \&quot;%s\&quot;&lt;/tr&gt;\n&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;form&quot;</span>));
<a name="l03622"></a>03622 
<a name="l03623"></a>03623   <span class="comment">/*---- menu buttons ----*/</span>
<a name="l03624"></a>03624 
<a name="l03625"></a>03625    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=4 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l03626"></a>03626 
<a name="l03627"></a>03627    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;Submit\&quot;&gt;\n&quot;</span>);
<a name="l03628"></a>03628    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=reset value=\&quot;Reset Form\&quot;&gt;\n&quot;</span>);
<a name="l03629"></a>03629    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n\n&quot;</span>);
<a name="l03630"></a>03630 
<a name="l03631"></a>03631   <span class="comment">/*---- entry form ----*/</span>
<a name="l03632"></a>03632 
<a name="l03633"></a>03633    <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l03634"></a>03634    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#FFFF00&gt;Entry date: %s&quot;</span>, ctime(&amp;now));
<a name="l03635"></a>03635 
<a name="l03636"></a>03636    run_number = 0;
<a name="l03637"></a>03637    <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> = <span class="keyword">sizeof</span>(run_number);
<a name="l03638"></a>03638    status =
<a name="l03639"></a>03639        <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Runinfo/Run number&quot;</span>, &amp;run_number, &amp;<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l03640"></a>03640    assert(status == <a class="code" href="group__mvmestdinclude.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>);
<a name="l03641"></a>03641 
<a name="l03642"></a>03642    <span class="keywordflow">if</span> (run_number &lt; 0) {
<a name="l03643"></a>03643       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;show_form_query&quot;</span>,
<a name="l03644"></a>03644              <span class="stringliteral">&quot;aborting on attempt to use invalid run number %d&quot;</span>, run_number);
<a name="l03645"></a>03645       abort();
<a name="l03646"></a>03646    }
<a name="l03647"></a>03647 
<a name="l03648"></a>03648    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#FFFF00&gt;Run number: &quot;</span>);
<a name="l03649"></a>03649    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=\&quot;text\&quot; size=10 maxlength=10 name=\&quot;run\&quot; value=\&quot;%d\&quot;&lt;/tr&gt;&quot;</span>,
<a name="l03650"></a>03650             run_number);
<a name="l03651"></a>03651 
<a name="l03652"></a>03652    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l03653"></a>03653        (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#FFA0A0&gt;Author: &lt;input type=\&quot;text\&quot; size=\&quot;15\&quot; maxlength=\&quot;80\&quot; name=\&quot;Author\&quot;&gt;\n&quot;</span>);
<a name="l03654"></a>03654 
<a name="l03655"></a>03655    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l03656"></a>03656        (<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#A0FFA0&gt;Item&lt;th bgcolor=#FFFF00&gt;Checked&lt;th bgcolor=#A0A0FF colspan=2&gt;Comment&lt;/tr&gt;\n&quot;</span>);
<a name="l03657"></a>03657 
<a name="l03658"></a>03658    sprintf(str, <span class="stringliteral">&quot;/Elog/Forms/%s&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;form&quot;</span>));
<a name="l03659"></a>03659    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkeyroot);
<a name="l03660"></a>03660    i = 0;
<a name="l03661"></a>03661    <span class="keywordflow">if</span> (hkeyroot)
<a name="l03662"></a>03662       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l03663"></a>03663          <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyroot, i, &amp;hkey);
<a name="l03664"></a>03664          <span class="keywordflow">if</span> (!hkey)
<a name="l03665"></a>03665             <span class="keywordflow">break</span>;
<a name="l03666"></a>03666 
<a name="l03667"></a>03667          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l03668"></a>03668 
<a name="l03669"></a>03669          strcpy(str, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l03670"></a>03670          <span class="keywordflow">if</span> (str[0])
<a name="l03671"></a>03671             str[strlen(str) - 1] = 0;
<a name="l03672"></a>03672          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, <span class="stringliteral">&quot;attachment&quot;</span>)) {
<a name="l03673"></a>03673             <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> = <span class="keyword">sizeof</span>(str);
<a name="l03674"></a>03674             <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, str, &amp;<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l03675"></a>03675             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 align=center bgcolor=#FFFFFF&gt;&lt;b&gt;%s:&lt;/b&gt;&quot;</span>,
<a name="l03676"></a>03676                      key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l03677"></a>03677             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l03678"></a>03678                 (<span class="stringliteral">&quot;&lt;td bgcolor=#A0A0FF colspan=2&gt;&lt;input type=text size=30 maxlength=255 name=c%d value=\&quot;%s\&quot;&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l03679"></a>03679                  i, str);
<a name="l03680"></a>03680          } <span class="keywordflow">else</span> {
<a name="l03681"></a>03681             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#A0FFA0&gt;%d &lt;b&gt;%s&lt;/b&gt;&quot;</span>, i + 1, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l03682"></a>03682             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l03683"></a>03683                 (<span class="stringliteral">&quot;&lt;td bgcolor=#FFFF00 align=center&gt;&lt;input type=checkbox name=x%d value=1&gt;&quot;</span>,
<a name="l03684"></a>03684                  i);
<a name="l03685"></a>03685             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l03686"></a>03686                 (<span class="stringliteral">&quot;&lt;td bgcolor=#A0A0FF colspan=2&gt;&lt;input type=text size=30 maxlength=255 name=c%d&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l03687"></a>03687                  i);
<a name="l03688"></a>03688          }
<a name="l03689"></a>03689       }
<a name="l03690"></a>03690 
<a name="l03691"></a>03691 
<a name="l03692"></a>03692   <span class="comment">/*---- menu buttons at bottom ----*/</span>
<a name="l03693"></a>03693 
<a name="l03694"></a>03694    <span class="keywordflow">if</span> (i &gt; 10) {
<a name="l03695"></a>03695       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=4 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l03696"></a>03696 
<a name="l03697"></a>03697       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;Submit\&quot;&gt;\n&quot;</span>);
<a name="l03698"></a>03698       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n\n&quot;</span>);
<a name="l03699"></a>03699    }
<a name="l03700"></a>03700 
<a name="l03701"></a>03701    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;&lt;/table&gt;\n&quot;</span>);
<a name="l03702"></a>03702    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l03703"></a>03703 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae5fb6c731656613ead122d173a8ef7a8"></a><!-- doxytag: member="mhttpd.c::show_header" ref="ae5fb6c731656613ead122d173a8ef7a8" args="(HNDLE hDB, char *title, char *method, char *path, int colspan, int refresh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_header </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a>&nbsp;</td>
          <td class="paramname"> <em>hDB</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>title</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>colspan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>refresh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01502">1502</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l06777">show_config_page()</a>, <a class="el" href="mhttpd_8c_source.html#l06182">show_create_page()</a>, <a class="el" href="mhttpd_8c_source.html#l06297">show_delete_page()</a>, <a class="el" href="mhttpd_8c_source.html#l02941">show_elog_delete()</a>, <a class="el" href="mhttpd_8c_source.html#l06130">show_find_page()</a>, <a class="el" href="mhttpd_8c_source.html#l08158">show_hist_config_page()</a>, <a class="el" href="mhttpd_8c_source.html#l08606">show_hist_page()</a>, <a class="el" href="mhttpd_8c_source.html#l05737">show_odb_page()</a>, <a class="el" href="mhttpd_8c_source.html#l06598">show_programs_page()</a>, <a class="el" href="mhttpd_8c_source.html#l08029">show_query_page()</a>, <a class="el" href="mhttpd_8c_source.html#l04659">show_sc_page()</a>, <a class="el" href="mhttpd_8c_source.html#l05983">show_set_page()</a>, and <a class="el" href="mhttpd_8c_source.html#l05639">show_start_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01504"></a>01504 {
<a name="l01505"></a>01505    time_t now;
<a name="l01506"></a>01506    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l01507"></a>01507    <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l01508"></a>01508 
<a name="l01509"></a>01509    <span class="comment">/* header */</span>
<a name="l01510"></a>01510    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l01511"></a>01511    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l01512"></a>01512    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Pragma: no-cache\r\n&quot;</span>);
<a name="l01513"></a>01513    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Expires: Fri, 01 Jan 1983 00:00:00 GMT\r\n&quot;</span>);
<a name="l01514"></a>01514    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l01515"></a>01515 
<a name="l01516"></a>01516    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;!DOCTYPE HTML PUBLIC \&quot;-//IETF//DTD HTML 2.0//EN\&quot;&gt;\n&quot;</span>);
<a name="l01517"></a>01517    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;\n&quot;</span>);
<a name="l01518"></a>01518 
<a name="l01519"></a>01519    <span class="comment">/* auto refresh */</span>
<a name="l01520"></a>01520    <span class="keywordflow">if</span> (refresh &gt; 0)
<a name="l01521"></a>01521       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;meta http-equiv=\&quot;Refresh\&quot; content=\&quot;%02d\&quot;&gt;\n&quot;</span>, refresh);
<a name="l01522"></a>01522 
<a name="l01523"></a>01523    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;title&gt;%s&lt;/title&gt;&lt;/head&gt;\n&quot;</span>, <a class="code" href="plot__max_8c.html#ab683205367791ff60928e417b096d210">title</a>);
<a name="l01524"></a>01524 
<a name="l01525"></a>01525    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(method, <span class="stringliteral">&quot;POST&quot;</span>))
<a name="l01526"></a>01526       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l01527"></a>01527           (<span class="stringliteral">&quot;&lt;body&gt;&lt;form name=\&quot;form1\&quot; method=\&quot;POST\&quot; action=\&quot;/%s\&quot; enctype=\&quot;multipart/form-data\&quot;&gt;\n\n&quot;</span>,
<a name="l01528"></a>01528            path);
<a name="l01529"></a>01529    <span class="keywordflow">else</span>
<a name="l01530"></a>01530       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;body&gt;&lt;form name=\&quot;form1\&quot; method=\&quot;%s\&quot; action=\&quot;/%s\&quot;&gt;\n\n&quot;</span>, method,
<a name="l01531"></a>01531                path);
<a name="l01532"></a>01532 
<a name="l01533"></a>01533    <span class="comment">/* title row */</span>
<a name="l01534"></a>01534 
<a name="l01535"></a>01535    size = <span class="keyword">sizeof</span>(str);
<a name="l01536"></a>01536    str[0] = 0;
<a name="l01537"></a>01537    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(<a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, 0, <span class="stringliteral">&quot;/Experiment/Name&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01538"></a>01538    <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l01539"></a>01539 
<a name="l01540"></a>01540    <span class="comment">/* define hidden field for experiment */</span>
<a name="l01541"></a>01541    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l01542"></a>01542       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=exp value=\&quot;%s\&quot;&gt;\n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l01543"></a>01543 
<a name="l01544"></a>01544    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;table border=3 cellpadding=2&gt;\n&quot;</span>);
<a name="l01545"></a>01545    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th colspan=%d bgcolor=\&quot;#A0A0FF\&quot;&gt;MIDAS experiment \&quot;%s\&quot;&quot;</span>, colspan,
<a name="l01546"></a>01546             str);
<a name="l01547"></a>01547 
<a name="l01548"></a>01548    <span class="keywordflow">if</span> (refresh &gt; 0)
<a name="l01549"></a>01549       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th colspan=%d bgcolor=\&quot;#A0A0FF\&quot;&gt;%s &amp;nbsp;&amp;nbsp;Refr:%d&lt;/tr&gt;\n&quot;</span>,
<a name="l01550"></a>01550                colspan, ctime(&amp;now), refresh);
<a name="l01551"></a>01551    <span class="keywordflow">else</span>
<a name="l01552"></a>01552       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th colspan=%d bgcolor=\&quot;#A0A0FF\&quot;&gt;%s&lt;/tr&gt;\n&quot;</span>, colspan, ctime(&amp;now));
<a name="l01553"></a>01553 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a754bb75919b1e2a9e934218bce65c472"></a><!-- doxytag: member="mhttpd.c::show_help_page" ref="a754bb75919b1e2a9e934218bce65c472" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_help_page </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01472">1472</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01473"></a>01473 {
<a name="l01474"></a>01474    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;\n&quot;</span>);
<a name="l01475"></a>01475    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;title&gt;MIDAS WWW Gateway Help&lt;/title&gt;\n&quot;</span>);
<a name="l01476"></a>01476    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/head&gt;\n\n&quot;</span>);
<a name="l01477"></a>01477 
<a name="l01478"></a>01478    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;body&gt;\n&quot;</span>);
<a name="l01479"></a>01479    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;h1&gt;Using the MIDAS WWW Gateway&lt;/h1&gt;\n&quot;</span>);
<a name="l01480"></a>01480    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;With the MIDAS WWW Gateway basic experiment control can be achieved.\n&quot;</span>);
<a name="l01481"></a>01481    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;The status page displays the current run status including front-end\n&quot;</span>);
<a name="l01482"></a>01482    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;and logger statistics. The Start and Stop buttons can start and stop\n&quot;</span>);
<a name="l01483"></a>01483    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;a run. The ODB button switches into the Online Database mode, where\n&quot;</span>);
<a name="l01484"></a>01484    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l01485"></a>01485        (<span class="stringliteral">&quot;the contents of the experiment database can be displayed and modified.&lt;P&gt;\n\n&quot;</span>);
<a name="l01486"></a>01486 
<a name="l01487"></a>01487    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;For more information, refer to the\n&quot;</span>);
<a name="l01488"></a>01488    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;A HREF=\&quot;http://midas.psi.ch/htmldoc/index.html\&quot;&gt;PSI MIDAS manual&lt;/A&gt;,\n&quot;</span>);
<a name="l01489"></a>01489    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l01490"></a>01490        (<span class="stringliteral">&quot;&lt;A HREF=\&quot;http://midas.triumf.ca/doc/html/index.html\&quot;&gt;Triumf MIDAS manual&lt;/A&gt;.&lt;P&gt;\n\n&quot;</span>);
<a name="l01491"></a>01491 
<a name="l01492"></a>01492    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;hr&gt;\n&quot;</span>);
<a name="l01493"></a>01493    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;address&gt;\n&quot;</span>);
<a name="l01494"></a>01494    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;http://pibeta.psi.ch/~stefan\&quot;&gt;S. Ritt&lt;/a&gt;, 26 Sep 2000&quot;</span>);
<a name="l01495"></a>01495    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/address&gt;&quot;</span>);
<a name="l01496"></a>01496 
<a name="l01497"></a>01497    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l01498"></a>01498 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5295c3eb3d85123c2f79dcdebf08a3a3"></a><!-- doxytag: member="mhttpd.c::show_hist_config_page" ref="a5295c3eb3d85123c2f79dcdebf08a3a3" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_hist_config_page </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l08158">8158</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="jorway73a_8c_source.html#l00628">cmd</a>, <a class="el" href="odb_8c_source.html#l01721">db_create_key()</a>, <a class="el" href="odb_8c_source.html#l02160">db_delete_key()</a>, <a class="el" href="odb_8c_source.html#l03390">db_enum_key()</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l02489">db_find_link()</a>, <a class="el" href="odb_8c_source.html#l04376">db_get_data_index()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="midas_8h_source.html#l01016">DB_NO_MORE_SUBKEYS</a>, <a class="el" href="odb_8c_source.html#l04727">db_set_data_index()</a>, <a class="el" href="odb_8c_source.html#l04607">db_set_num_values()</a>, <a class="el" href="odb_8c_source.html#l03128">db_set_value()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="lcd__menu_8c_source.html#l00262">display_name()</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="scs__310__ql355p_8c_source.html#l00055">flag</a>, <a class="el" href="mana_8cpp_source.html#l00800">getparam()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="cmdedit_8c_source.html#l00054">history</a>, <a class="el" href="mevb_8cpp_source.html#l00100">hKey</a>, <a class="el" href="fal_8c_source.html#l00203">hKeyVar</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="midas_8h_source.html#l01316">KEY::num_values</a>, <a class="el" href="mhttpd_8c_source.html#l01356">redirect()</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l01557">show_error()</a>, <a class="el" href="mhttpd_8c_source.html#l01502">show_header()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, <a class="el" href="midas_8h_source.html#l00743">TID_FLOAT</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, <a class="el" href="ADCS_8h_source.html#l00004">value</a>, and <a class="el" href="odbhist_8c_source.html#l00059">var_name</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l08606">show_hist_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08159"></a>08159 {
<a name="l08160"></a>08160    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, max_event_id, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a>, n_names;
<a name="l08161"></a>08161    <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> single_names, <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a>, is_link;
<a name="l08162"></a>08162    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hKeyRoot, hKeyEq, <a class="code" href="fal_8c.html#a93d13d4a80b9fb8ab8d7e9cbec8f99e9">hKeyVar</a>, <a class="code" href="mevb_8cpp.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>, hKeyNames;
<a name="l08163"></a>08163    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>, varkey;
<a name="l08164"></a>08164    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], eq_name[256], <a class="code" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a>[256], <a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a>[256], ref[256];
<a name="l08165"></a>08165    <span class="keywordtype">char</span> <a class="code" href="lcd__menu_8c.html#a54ae02d5ad96a91d28477b21166eb5a6">display_name</a>[10][2 * <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>];
<a name="l08166"></a>08166    <span class="keywordtype">float</span> <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;
<a name="l08167"></a>08167    <span class="keywordtype">char</span> *hist_col[] = { <span class="stringliteral">&quot;#0000FF&quot;</span>, <span class="stringliteral">&quot;#00C000&quot;</span>, <span class="stringliteral">&quot;#FF0000&quot;</span>, <span class="stringliteral">&quot;#00C0C0&quot;</span>, <span class="stringliteral">&quot;#FF00FF&quot;</span>,
<a name="l08168"></a>08168       <span class="stringliteral">&quot;#C0C000&quot;</span>, <span class="stringliteral">&quot;#808080&quot;</span>, <span class="stringliteral">&quot;#80FF80&quot;</span>, <span class="stringliteral">&quot;#FF8080&quot;</span>, <span class="stringliteral">&quot;#8080FF&quot;</span>
<a name="l08169"></a>08169    };
<a name="l08170"></a>08170 
<a name="l08171"></a>08171    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l08172"></a>08172    strcpy(cmd, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>));
<a name="l08173"></a>08173    hKeyVar = 0;
<a name="l08174"></a>08174 
<a name="l08175"></a>08175    <span class="keywordflow">if</span> (cmd[0] &amp;&amp; <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(cmd, <span class="stringliteral">&quot;save&quot;</span>)) {
<a name="l08176"></a>08176       <span class="comment">/* copy parameters to their ODB location */</span>
<a name="l08177"></a>08177       <span class="keywordflow">for</span> (index = 0; index &lt; 10; index++) {
<a name="l08178"></a>08178          sprintf(str, <span class="stringliteral">&quot;event%d&quot;</span>, index);
<a name="l08179"></a>08179          <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str)) {
<a name="l08180"></a>08180             strcpy(var_name, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str));
<a name="l08181"></a>08181             strcat(var_name, <span class="stringliteral">&quot;:&quot;</span>);
<a name="l08182"></a>08182             sprintf(str, <span class="stringliteral">&quot;var%d&quot;</span>, index);
<a name="l08183"></a>08183             strcat(var_name, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str));
<a name="l08184"></a>08184 
<a name="l08185"></a>08185             sprintf(str, <span class="stringliteral">&quot;/History/Display/%s/Variables&quot;</span>, path);
<a name="l08186"></a>08186             <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hKeyVar);
<a name="l08187"></a>08187             <span class="keywordflow">if</span> (hKeyVar) {
<a name="l08188"></a>08188                <span class="comment">/* make sure size is correct */</span>
<a name="l08189"></a>08189                <span class="keywordflow">if</span> (index == 0) {
<a name="l08190"></a>08190                   <a class="code" href="group__msectionh.html#ga91277a012e0bfddbc32885da450409e0">db_delete_key</a>(hDB, hKeyVar, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l08191"></a>08191                   <a class="code" href="group__msectionh.html#ga1441e5b7ca1923cf8611f920cf2c31b4">db_create_key</a>(hDB, 0, str, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l08192"></a>08192                   <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hKeyVar);
<a name="l08193"></a>08193                }
<a name="l08194"></a>08194                <a class="code" href="group__msectionh.html#ga18f5e7743545b06fca4f3d5ce9889034">db_set_data_index</a>(hDB, hKeyVar, var_name, 2 * <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>, index,
<a name="l08195"></a>08195                                  <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l08196"></a>08196             }
<a name="l08197"></a>08197 
<a name="l08198"></a>08198             sprintf(str, <span class="stringliteral">&quot;/History/Display/%s/Factor&quot;</span>, path);
<a name="l08199"></a>08199             <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hKey);
<a name="l08200"></a>08200             sprintf(str, <span class="stringliteral">&quot;fac%d&quot;</span>, index);
<a name="l08201"></a>08201             value = (float) atof(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str));
<a name="l08202"></a>08202             <span class="keywordflow">if</span> (hKey)
<a name="l08203"></a>08203                <a class="code" href="group__msectionh.html#ga18f5e7743545b06fca4f3d5ce9889034">db_set_data_index</a>(hDB, hKey, &amp;value, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), index, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l08204"></a>08204 
<a name="l08205"></a>08205             sprintf(str, <span class="stringliteral">&quot;/History/Display/%s/Offset&quot;</span>, path);
<a name="l08206"></a>08206             <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hKey);
<a name="l08207"></a>08207             sprintf(str, <span class="stringliteral">&quot;ofs%d&quot;</span>, index);
<a name="l08208"></a>08208             value = (float) atof(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str));
<a name="l08209"></a>08209             <span class="keywordflow">if</span> (hKey)
<a name="l08210"></a>08210                <a class="code" href="group__msectionh.html#ga18f5e7743545b06fca4f3d5ce9889034">db_set_data_index</a>(hDB, hKey, &amp;value, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), index, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l08211"></a>08211          } <span class="keywordflow">else</span> {
<a name="l08212"></a>08212             sprintf(str, <span class="stringliteral">&quot;/History/Display/%s/Variables&quot;</span>, path);
<a name="l08213"></a>08213             <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hKey);
<a name="l08214"></a>08214             <a class="code" href="group__msectionh.html#gaebce0b43863ff5b77d689f3a8e482656">db_set_num_values</a>(hDB, hKey, index);
<a name="l08215"></a>08215             sprintf(str, <span class="stringliteral">&quot;/History/Display/%s/Factor&quot;</span>, path);
<a name="l08216"></a>08216             <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hKey);
<a name="l08217"></a>08217             <a class="code" href="group__msectionh.html#gaebce0b43863ff5b77d689f3a8e482656">db_set_num_values</a>(hDB, hKey, index);
<a name="l08218"></a>08218             sprintf(str, <span class="stringliteral">&quot;/History/Display/%s/Offset&quot;</span>, path);
<a name="l08219"></a>08219             <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hKey);
<a name="l08220"></a>08220             <a class="code" href="group__msectionh.html#gaebce0b43863ff5b77d689f3a8e482656">db_set_num_values</a>(hDB, hKey, index);
<a name="l08221"></a>08221             <span class="keywordflow">break</span>;
<a name="l08222"></a>08222          }
<a name="l08223"></a>08223       }
<a name="l08224"></a>08224 
<a name="l08225"></a>08225       <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;timescale&quot;</span>)) {
<a name="l08226"></a>08226          sprintf(ref, <span class="stringliteral">&quot;/History/Display/%s/Timescale&quot;</span>, path);
<a name="l08227"></a>08227          strcpy(str, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;timescale&quot;</span>));
<a name="l08228"></a>08228          <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, 0, ref, str, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>, 1, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l08229"></a>08229       }
<a name="l08230"></a>08230 
<a name="l08231"></a>08231       sprintf(ref, <span class="stringliteral">&quot;/History/Display/%s/Zero ylow&quot;</span>, path);
<a name="l08232"></a>08232       flag = *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;zero_ylow&quot;</span>);
<a name="l08233"></a>08233       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, 0, ref, &amp;flag, <span class="keyword">sizeof</span>(flag), 1, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>);
<a name="l08234"></a>08234 
<a name="l08235"></a>08235       sprintf(ref, <span class="stringliteral">&quot;/History/Display/%s/Log Axis&quot;</span>, path);
<a name="l08236"></a>08236       flag = *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;log_axis&quot;</span>);
<a name="l08237"></a>08237       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, 0, ref, &amp;flag, <span class="keyword">sizeof</span>(flag), 1, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>);
<a name="l08238"></a>08238 
<a name="l08239"></a>08239       sprintf(ref, <span class="stringliteral">&quot;/History/Display/%s/Show run markers&quot;</span>, path);
<a name="l08240"></a>08240       flag = *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;run_markers&quot;</span>);
<a name="l08241"></a>08241       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, 0, ref, &amp;flag, <span class="keyword">sizeof</span>(flag), 1, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>);
<a name="l08242"></a>08242 
<a name="l08243"></a>08243       sprintf(str, <span class="stringliteral">&quot;HS/%s&quot;</span>, path);
<a name="l08244"></a>08244       <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(str);
<a name="l08245"></a>08245       <span class="keywordflow">return</span>;
<a name="l08246"></a>08246    }
<a name="l08247"></a>08247 
<a name="l08248"></a>08248    sprintf(str, <span class="stringliteral">&quot;HS/%s&quot;</span>, path);
<a name="l08249"></a>08249    <a class="code" href="mhttpd_8c.html#ae5fb6c731656613ead122d173a8ef7a8">show_header</a>(hDB, <span class="stringliteral">&quot;History Config&quot;</span>, <span class="stringliteral">&quot;GET&quot;</span>, str, 3, 0);
<a name="l08250"></a>08250 
<a name="l08251"></a>08251    <span class="comment">/* menu buttons */</span>
<a name="l08252"></a>08252    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6 bgcolor=\&quot;#C0C0C0\&quot;&gt;\n&quot;</span>);
<a name="l08253"></a>08253    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Save&gt;\n&quot;</span>);
<a name="l08254"></a>08254    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Cancel&gt;\n&quot;</span>);
<a name="l08255"></a>08255    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Refresh&gt;\n&quot;</span>);
<a name="l08256"></a>08256    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;Delete Panel\&quot;&gt;\n&quot;</span>);
<a name="l08257"></a>08257    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l08258"></a>08258 
<a name="l08259"></a>08259    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6 bgcolor=\&quot;#FFFF00\&quot; align=center&gt;&lt;b&gt;Panel \&quot;%s\&quot;&lt;/b&gt;\n&quot;</span>,
<a name="l08260"></a>08260             path);
<a name="l08261"></a>08261 
<a name="l08262"></a>08262    <span class="comment">/* hidden command for refresh */</span>
<a name="l08263"></a>08263    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=cmd value=Refresh&gt;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l08264"></a>08264 
<a name="l08265"></a>08265    <span class="comment">/* time scale */</span>
<a name="l08266"></a>08266    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(cmd, <span class="stringliteral">&quot;refresh&quot;</span>))
<a name="l08267"></a>08267       strcpy(str, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;timescale&quot;</span>));
<a name="l08268"></a>08268    <span class="keywordflow">else</span> {
<a name="l08269"></a>08269       sprintf(ref, <span class="stringliteral">&quot;/History/Display/%s/Timescale&quot;</span>, path);
<a name="l08270"></a>08270       size = <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>;
<a name="l08271"></a>08271       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, ref, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l08272"></a>08272    }
<a name="l08273"></a>08273    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l08274"></a>08274        (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#E0E0E0\&quot; colspan=6&gt;Time scale: &amp;nbsp;&amp;nbsp;&lt;input type=text name=timescale value=%s&gt;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l08275"></a>08275         str);
<a name="l08276"></a>08276 
<a name="l08277"></a>08277    <span class="comment">/* ylow_zero */</span>
<a name="l08278"></a>08278    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(cmd, <span class="stringliteral">&quot;refresh&quot;</span>))
<a name="l08279"></a>08279       flag = *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;zero_ylow&quot;</span>);
<a name="l08280"></a>08280    <span class="keywordflow">else</span> {
<a name="l08281"></a>08281       sprintf(ref, <span class="stringliteral">&quot;/History/Display/%s/Zero ylow&quot;</span>, path);
<a name="l08282"></a>08282       size = <span class="keyword">sizeof</span>(flag);
<a name="l08283"></a>08283       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, ref, &amp;flag, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l08284"></a>08284    }
<a name="l08285"></a>08285    <span class="keywordflow">if</span> (flag)
<a name="l08286"></a>08286       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l08287"></a>08287           (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#E0E0E0\&quot; colspan=6&gt;&lt;input type=checkbox checked name=zero_ylow value=1&gt;&quot;</span>,
<a name="l08288"></a>08288            str);
<a name="l08289"></a>08289    <span class="keywordflow">else</span>
<a name="l08290"></a>08290       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l08291"></a>08291           (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#E0E0E0\&quot; colspan=6&gt;&lt;input type=checkbox name=zero_ylow value=1&gt;&quot;</span>,
<a name="l08292"></a>08292            str);
<a name="l08293"></a>08293    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&amp;nbsp;&amp;nbsp;Zero Ylow&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l08294"></a>08294 
<a name="l08295"></a>08295    <span class="comment">/* log_axis */</span>
<a name="l08296"></a>08296    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(cmd, <span class="stringliteral">&quot;refresh&quot;</span>))
<a name="l08297"></a>08297       flag = *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;log_axis&quot;</span>);
<a name="l08298"></a>08298    <span class="keywordflow">else</span> {
<a name="l08299"></a>08299       sprintf(ref, <span class="stringliteral">&quot;/History/Display/%s/Log axis&quot;</span>, path);
<a name="l08300"></a>08300       size = <span class="keyword">sizeof</span>(flag);
<a name="l08301"></a>08301       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, ref, &amp;flag, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l08302"></a>08302    }
<a name="l08303"></a>08303    <span class="keywordflow">if</span> (flag)
<a name="l08304"></a>08304       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l08305"></a>08305           (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#E0E0E0\&quot; colspan=6&gt;&lt;input type=checkbox checked name=log_axis value=1&gt;&quot;</span>,
<a name="l08306"></a>08306            str);
<a name="l08307"></a>08307    <span class="keywordflow">else</span>
<a name="l08308"></a>08308       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l08309"></a>08309           (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#E0E0E0\&quot; colspan=6&gt;&lt;input type=checkbox name=log_axis value=1&gt;&quot;</span>,
<a name="l08310"></a>08310            str);
<a name="l08311"></a>08311    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&amp;nbsp;&amp;nbsp;Logarighmic Y axis&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l08312"></a>08312 
<a name="l08313"></a>08313    <span class="comment">/* run_markers */</span>
<a name="l08314"></a>08314    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(cmd, <span class="stringliteral">&quot;refresh&quot;</span>))
<a name="l08315"></a>08315       flag = *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;run_markers&quot;</span>);
<a name="l08316"></a>08316    <span class="keywordflow">else</span> {
<a name="l08317"></a>08317       sprintf(ref, <span class="stringliteral">&quot;/History/Display/%s/Show run markers&quot;</span>, path);
<a name="l08318"></a>08318       size = <span class="keyword">sizeof</span>(flag);
<a name="l08319"></a>08319       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, ref, &amp;flag, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l08320"></a>08320    }
<a name="l08321"></a>08321    <span class="keywordflow">if</span> (flag)
<a name="l08322"></a>08322       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l08323"></a>08323           (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#E0E0E0\&quot; colspan=6&gt;&lt;input type=checkbox checked name=run_markers value=1&gt;&quot;</span>,
<a name="l08324"></a>08324            str);
<a name="l08325"></a>08325    <span class="keywordflow">else</span>
<a name="l08326"></a>08326       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l08327"></a>08327           (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#E0E0E0\&quot; colspan=6&gt;&lt;input type=checkbox name=run_markers value=1&gt;&quot;</span>,
<a name="l08328"></a>08328            str);
<a name="l08329"></a>08329    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&amp;nbsp;&amp;nbsp;Show run markers&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l08330"></a>08330 
<a name="l08331"></a>08331   <span class="comment">/*---- events and variables ----*/</span>
<a name="l08332"></a>08332 
<a name="l08333"></a>08333    <span class="comment">/* get display event name */</span>
<a name="l08334"></a>08334 
<a name="l08335"></a>08335    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(cmd, <span class="stringliteral">&quot;refresh&quot;</span>)) {
<a name="l08336"></a>08336       <span class="comment">/* from parameters in a refresh */</span>
<a name="l08337"></a>08337       <span class="keywordflow">for</span> (i = 0; i &lt; 10; i++) {
<a name="l08338"></a>08338          sprintf(str, <span class="stringliteral">&quot;event%d&quot;</span>, i);
<a name="l08339"></a>08339          strcpy(display_name[i], <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str));
<a name="l08340"></a>08340 
<a name="l08341"></a>08341          <span class="keywordflow">if</span> (display_name[i][0]) {
<a name="l08342"></a>08342             sprintf(str, <span class="stringliteral">&quot;var%d&quot;</span>, i);
<a name="l08343"></a>08343             strcat(display_name[i], <span class="stringliteral">&quot;:&quot;</span>);
<a name="l08344"></a>08344             strcat(display_name[i], <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str));
<a name="l08345"></a>08345          }
<a name="l08346"></a>08346       }
<a name="l08347"></a>08347    } <span class="keywordflow">else</span> {
<a name="l08348"></a>08348       <span class="comment">/* from ODB else */</span>
<a name="l08349"></a>08349       sprintf(str, <span class="stringliteral">&quot;/History/Display/%s/Variables&quot;</span>, path);
<a name="l08350"></a>08350       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hKey);
<a name="l08351"></a>08351 
<a name="l08352"></a>08352       memset(display_name, 0, <span class="keyword">sizeof</span>(display_name));
<a name="l08353"></a>08353       <span class="keywordflow">if</span> (hKey) {
<a name="l08354"></a>08354          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hKey, &amp;key);
<a name="l08355"></a>08355 
<a name="l08356"></a>08356          <span class="keywordflow">for</span> (i = 0; i &lt; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; i++) {
<a name="l08357"></a>08357             size = 2 * <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>;
<a name="l08358"></a>08358             <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hKey, display_name[i], &amp;size, i, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l08359"></a>08359          }
<a name="l08360"></a>08360       }
<a name="l08361"></a>08361    }
<a name="l08362"></a>08362 
<a name="l08363"></a>08363    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th&gt;Col&lt;th&gt;Event&lt;th colspan=2&gt;Variable&lt;th&gt;Factor&lt;th&gt;Offset&lt;/tr&gt;\n&quot;</span>);
<a name="l08364"></a>08364 
<a name="l08365"></a>08365    <span class="keywordflow">for</span> (index = 0; index &lt; 10; index++) {
<a name="l08366"></a>08366       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;%s\&quot;&gt;&amp;nbsp;&lt;td&gt;\n&quot;</span>, hist_col[index]);
<a name="l08367"></a>08367 
<a name="l08368"></a>08368       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;select name=\&quot;event%d\&quot; size=1 onChange=\&quot;document.form1.submit()\&quot;&gt;\n&quot;</span>,
<a name="l08369"></a>08369                index);
<a name="l08370"></a>08370 
<a name="l08371"></a>08371       <span class="comment">/* enumerate events */</span>
<a name="l08372"></a>08372       max_event_id = 0;
<a name="l08373"></a>08373 
<a name="l08374"></a>08374       status = <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Equipment&quot;</span>, &amp;hKeyRoot);
<a name="l08375"></a>08375       <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l08376"></a>08376          <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(<span class="stringliteral">&quot;Cannot find /Equipment entry in database&quot;</span>);
<a name="l08377"></a>08377          <span class="keywordflow">return</span>;
<a name="l08378"></a>08378       }
<a name="l08379"></a>08379 
<a name="l08380"></a>08380       <span class="comment">/* empty option */</span>
<a name="l08381"></a>08381       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;\&quot;&gt;&amp;lt;empty&amp;gt;\n&quot;</span>);
<a name="l08382"></a>08382 
<a name="l08383"></a>08383       <span class="comment">/* loop over equipment to display event name */</span>
<a name="l08384"></a>08384       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l08385"></a>08385          status = <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hKeyRoot, i, &amp;hKeyEq);
<a name="l08386"></a>08386          <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l08387"></a>08387             <span class="keywordflow">break</span>;
<a name="l08388"></a>08388 
<a name="l08389"></a>08389          <span class="comment">/* check history flag */</span>
<a name="l08390"></a>08390          size = <span class="keyword">sizeof</span>(history);
<a name="l08391"></a>08391          <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hKeyEq, <span class="stringliteral">&quot;Common/Log history&quot;</span>, &amp;history, &amp;size, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l08392"></a>08392 
<a name="l08393"></a>08393          <span class="comment">/* show event only if log history flag is on */</span>
<a name="l08394"></a>08394          <span class="keywordflow">if</span> (history &gt; 0) {
<a name="l08395"></a>08395             <span class="comment">/* get equipment name */</span>
<a name="l08396"></a>08396             <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hKeyEq, &amp;key);
<a name="l08397"></a>08397 
<a name="l08398"></a>08398             strcpy(str, display_name[index]);
<a name="l08399"></a>08399             str[strlen(key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>)] = 0;
<a name="l08400"></a>08400             <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>))
<a name="l08401"></a>08401                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l08402"></a>08402             <span class="keywordflow">else</span>
<a name="l08403"></a>08403                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l08404"></a>08404          }
<a name="l08405"></a>08405       }
<a name="l08406"></a>08406 
<a name="l08407"></a>08407       <span class="comment">/* loop over history links to displayh event name */</span>
<a name="l08408"></a>08408       status = <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/History/Links&quot;</span>, &amp;hKeyRoot);
<a name="l08409"></a>08409       <span class="keywordflow">if</span> (status == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l08410"></a>08410          <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l08411"></a>08411             status = <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hKeyRoot, i, &amp;hKey);
<a name="l08412"></a>08412             <span class="keywordflow">if</span> (status == <a class="code" href="group__err23.html#gaf2249d36fd8ffb254cd33a3bbc899638">DB_NO_MORE_SUBKEYS</a>)
<a name="l08413"></a>08413                <span class="keywordflow">break</span>;
<a name="l08414"></a>08414 
<a name="l08415"></a>08415             <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hKey, &amp;key);
<a name="l08416"></a>08416 
<a name="l08417"></a>08417             <span class="keywordflow">if</span> (strncmp(display_name[index], key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, strlen(key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>)) == 0)
<a name="l08418"></a>08418                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l08419"></a>08419             <span class="keywordflow">else</span>
<a name="l08420"></a>08420                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l08421"></a>08421          }
<a name="l08422"></a>08422       }
<a name="l08423"></a>08423 
<a name="l08424"></a>08424       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;&lt;/td&gt;\n&quot;</span>);
<a name="l08425"></a>08425 
<a name="l08426"></a>08426       <span class="comment">/* display variables for selected event */</span>
<a name="l08427"></a>08427 
<a name="l08428"></a>08428       status = <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Equipment&quot;</span>, &amp;hKeyRoot);
<a name="l08429"></a>08429       <span class="keywordflow">if</span> (status == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a> &amp;&amp; display_name[index][0]) {
<a name="l08430"></a>08430          strcpy(eq_name, display_name[index]);
<a name="l08431"></a>08431          <span class="keywordflow">if</span> (strchr(eq_name, <span class="charliteral">&apos;:&apos;</span>))
<a name="l08432"></a>08432             *strchr(eq_name, <span class="charliteral">&apos;:&apos;</span>) = 0;
<a name="l08433"></a>08433 
<a name="l08434"></a>08434          is_link = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l08435"></a>08435          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hKeyRoot, eq_name, &amp;hKeyEq);
<a name="l08436"></a>08436          <span class="keywordflow">if</span> (!hKeyEq) {
<a name="l08437"></a>08437             sprintf(str, <span class="stringliteral">&quot;/History/Links/%s&quot;</span>, eq_name);
<a name="l08438"></a>08438             status = <a class="code" href="group__msectionh.html#ga59083dc8be945d488b2d0708c3d922d6">db_find_link</a>(hDB, 0, str, &amp;hKeyVar);
<a name="l08439"></a>08439             <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l08440"></a>08440                sprintf(str, <span class="stringliteral">&quot;Cannot find /Equipment/%s or /History/Links/%s in ODB&quot;</span>,
<a name="l08441"></a>08441                        eq_name, eq_name);
<a name="l08442"></a>08442                <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(str);
<a name="l08443"></a>08443                <span class="keywordflow">return</span>;
<a name="l08444"></a>08444             } <span class="keywordflow">else</span>
<a name="l08445"></a>08445                is_link = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l08446"></a>08446          }
<a name="l08447"></a>08447 
<a name="l08448"></a>08448          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=2&gt;&lt;select name=\&quot;var%d\&quot;&gt;\n&quot;</span>, index);
<a name="l08449"></a>08449 
<a name="l08450"></a>08450          <span class="comment">/* go through variables for selected event */</span>
<a name="l08451"></a>08451          <span class="keywordflow">if</span> (!is_link) {
<a name="l08452"></a>08452             sprintf(str, <span class="stringliteral">&quot;/Equipment/%s/Variables&quot;</span>, eq_name);
<a name="l08453"></a>08453             status = <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hKeyVar);
<a name="l08454"></a>08454             <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l08455"></a>08455                sprintf(str, <span class="stringliteral">&quot;Cannot find /Equipment/%s/Variables in ODB&quot;</span>, eq_name);
<a name="l08456"></a>08456                <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(str);
<a name="l08457"></a>08457                <span class="keywordflow">return</span>;
<a name="l08458"></a>08458             }
<a name="l08459"></a>08459          }
<a name="l08460"></a>08460 
<a name="l08461"></a>08461          <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l08462"></a>08462             status = <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hKeyVar, i, &amp;hKey);
<a name="l08463"></a>08463             <span class="keywordflow">if</span> (status == <a class="code" href="group__err23.html#gaf2249d36fd8ffb254cd33a3bbc899638">DB_NO_MORE_SUBKEYS</a>)
<a name="l08464"></a>08464                <span class="keywordflow">break</span>;
<a name="l08465"></a>08465 
<a name="l08466"></a>08466             <span class="keywordflow">if</span> (is_link) {
<a name="l08467"></a>08467                <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hKey, &amp;varkey);
<a name="l08468"></a>08468 
<a name="l08469"></a>08469                <span class="keywordflow">if</span> (strchr(display_name[index], <span class="charliteral">&apos;:&apos;</span>))
<a name="l08470"></a>08470                   strcpy(str, strchr(display_name[index], <span class="charliteral">&apos;:&apos;</span>) + 1);
<a name="l08471"></a>08471                <span class="keywordflow">else</span>
<a name="l08472"></a>08472                   str[0] = 0;
<a name="l08473"></a>08473 
<a name="l08474"></a>08474                <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>))
<a name="l08475"></a>08475                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>,
<a name="l08476"></a>08476                            varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l08477"></a>08477                <span class="keywordflow">else</span>
<a name="l08478"></a>08478                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l08479"></a>08479             } <span class="keywordflow">else</span> {
<a name="l08480"></a>08480                <span class="comment">/* get variable key */</span>
<a name="l08481"></a>08481                <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hKey, &amp;varkey);
<a name="l08482"></a>08482                n_names = 0;
<a name="l08483"></a>08483 
<a name="l08484"></a>08484                <span class="comment">/* look for names */</span>
<a name="l08485"></a>08485                <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hKeyEq, <span class="stringliteral">&quot;Settings/Names&quot;</span>, &amp;hKeyNames);
<a name="l08486"></a>08486                single_names = (hKeyNames &gt; 0);
<a name="l08487"></a>08487                <span class="keywordflow">if</span> (hKeyNames) {
<a name="l08488"></a>08488                   <span class="comment">/* get variables from names list */</span>
<a name="l08489"></a>08489                   <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hKeyNames, &amp;key);
<a name="l08490"></a>08490                   n_names = key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>;
<a name="l08491"></a>08491                } <span class="keywordflow">else</span> {
<a name="l08492"></a>08492                   sprintf(str, <span class="stringliteral">&quot;Settings/Names %s&quot;</span>, varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l08493"></a>08493                   <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hKeyEq, str, &amp;hKeyNames);
<a name="l08494"></a>08494                   <span class="keywordflow">if</span> (hKeyNames) {
<a name="l08495"></a>08495                      <span class="comment">/* get variables from names list */</span>
<a name="l08496"></a>08496                      <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hKeyNames, &amp;key);
<a name="l08497"></a>08497                      n_names = key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>;
<a name="l08498"></a>08498                   }
<a name="l08499"></a>08499                }
<a name="l08500"></a>08500 
<a name="l08501"></a>08501                <span class="keywordflow">if</span> (hKeyNames) {
<a name="l08502"></a>08502                   <span class="comment">/* loop over array elements */</span>
<a name="l08503"></a>08503                   <span class="keywordflow">for</span> (j = 0; j &lt; n_names; j++) {
<a name="l08504"></a>08504                      <span class="comment">/* get name #j */</span>
<a name="l08505"></a>08505                      size = <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>;
<a name="l08506"></a>08506                      <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hKeyNames, var_name, &amp;size, j, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l08507"></a>08507 
<a name="l08508"></a>08508                      <span class="comment">/* append variable key name for single name array */</span>
<a name="l08509"></a>08509                      <span class="keywordflow">if</span> (single_names) {
<a name="l08510"></a>08510                         strcat(var_name, <span class="stringliteral">&quot; &quot;</span>);
<a name="l08511"></a>08511                         strcat(var_name, varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l08512"></a>08512                      }
<a name="l08513"></a>08513 
<a name="l08514"></a>08514                      <span class="comment">/* get name from ODB */</span>
<a name="l08515"></a>08515                      <span class="keywordflow">if</span> (strchr(display_name[index], <span class="charliteral">&apos;:&apos;</span>))
<a name="l08516"></a>08516                         strcpy(str, strchr(display_name[index], <span class="charliteral">&apos;:&apos;</span>) + 1);
<a name="l08517"></a>08517                      <span class="keywordflow">else</span>
<a name="l08518"></a>08518                         str[0] = 0;
<a name="l08519"></a>08519 
<a name="l08520"></a>08520                      <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, var_name))
<a name="l08521"></a>08521                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, var_name,
<a name="l08522"></a>08522                                  var_name);
<a name="l08523"></a>08523                      <span class="keywordflow">else</span>
<a name="l08524"></a>08524                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, var_name, var_name);
<a name="l08525"></a>08525                   }
<a name="l08526"></a>08526                } <span class="keywordflow">else</span> {
<a name="l08527"></a>08527                   <span class="keywordflow">if</span> (strchr(display_name[index], <span class="charliteral">&apos;:&apos;</span>))
<a name="l08528"></a>08528                      strcpy(str, strchr(display_name[index], <span class="charliteral">&apos;:&apos;</span>) + 1);
<a name="l08529"></a>08529                   <span class="keywordflow">else</span>
<a name="l08530"></a>08530                      str[0] = 0;
<a name="l08531"></a>08531 
<a name="l08532"></a>08532                   <span class="keywordflow">if</span> (varkey.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a> &gt; 0) {
<a name="l08533"></a>08533                      <span class="keywordflow">for</span> (j = 0; j &lt; varkey.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; j++) {
<a name="l08534"></a>08534                         sprintf(var_name, <span class="stringliteral">&quot;%s[%d]&quot;</span>, varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, j);
<a name="l08535"></a>08535 
<a name="l08536"></a>08536                         <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, var_name))
<a name="l08537"></a>08537                            <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, var_name,
<a name="l08538"></a>08538                                     var_name);
<a name="l08539"></a>08539                         <span class="keywordflow">else</span>
<a name="l08540"></a>08540                            <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, var_name, var_name);
<a name="l08541"></a>08541                      }
<a name="l08542"></a>08542                   } <span class="keywordflow">else</span> {
<a name="l08543"></a>08543                      <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, var_name))
<a name="l08544"></a>08544                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>,
<a name="l08545"></a>08545                                  varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l08546"></a>08546                      <span class="keywordflow">else</span>
<a name="l08547"></a>08547                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l08548"></a>08548                   }
<a name="l08549"></a>08549                }
<a name="l08550"></a>08550             }
<a name="l08551"></a>08551          }
<a name="l08552"></a>08552 
<a name="l08553"></a>08553          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;&lt;/td&gt;\n&quot;</span>);
<a name="l08554"></a>08554       } <span class="keywordflow">else</span>
<a name="l08555"></a>08555          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=2&gt;&lt;/td&gt;\n&quot;</span>);
<a name="l08556"></a>08556 
<a name="l08557"></a>08557       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(cmd, <span class="stringliteral">&quot;refresh&quot;</span>)) {
<a name="l08558"></a>08558          <span class="comment">/* get value from parameters */</span>
<a name="l08559"></a>08559          sprintf(str, <span class="stringliteral">&quot;fac%d&quot;</span>, index);
<a name="l08560"></a>08560          value = (float) atof(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str));
<a name="l08561"></a>08561       } <span class="keywordflow">else</span> {
<a name="l08562"></a>08562          <span class="comment">/* get value from ODB */</span>
<a name="l08563"></a>08563          value = 1;
<a name="l08564"></a>08564          sprintf(str, <span class="stringliteral">&quot;/History/Display/%s/Factor&quot;</span>, path);
<a name="l08565"></a>08565          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hKey);
<a name="l08566"></a>08566          size = <span class="keyword">sizeof</span>(float);
<a name="l08567"></a>08567          <span class="keywordflow">if</span> (hKey) {
<a name="l08568"></a>08568             <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hKey, &amp;key);
<a name="l08569"></a>08569             <span class="keywordflow">if</span> (index &lt; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>)
<a name="l08570"></a>08570                <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hKey, &amp;value, &amp;size, index, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l08571"></a>08571          }
<a name="l08572"></a>08572       }
<a name="l08573"></a>08573       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l08574"></a>08574           (<span class="stringliteral">&quot;&lt;td&gt;&lt;input type=text size=10 maxlength=10 name=\&quot;fac%d\&quot; value=%g&gt;&lt;/td&gt;\n&quot;</span>,
<a name="l08575"></a>08575            index, value);
<a name="l08576"></a>08576 
<a name="l08577"></a>08577       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(cmd, <span class="stringliteral">&quot;refresh&quot;</span>)) {
<a name="l08578"></a>08578          <span class="comment">/* get value from parameters */</span>
<a name="l08579"></a>08579          sprintf(str, <span class="stringliteral">&quot;ofs%d&quot;</span>, index);
<a name="l08580"></a>08580          value = (float) atof(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str));
<a name="l08581"></a>08581       } <span class="keywordflow">else</span> {
<a name="l08582"></a>08582          <span class="comment">/* get value from ODB */</span>
<a name="l08583"></a>08583          value = 0;
<a name="l08584"></a>08584          sprintf(str, <span class="stringliteral">&quot;/History/Display/%s/Offset&quot;</span>, path);
<a name="l08585"></a>08585          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hKey);
<a name="l08586"></a>08586          size = <span class="keyword">sizeof</span>(float);
<a name="l08587"></a>08587          <span class="keywordflow">if</span> (hKey) {
<a name="l08588"></a>08588             <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hKey, &amp;key);
<a name="l08589"></a>08589             <span class="keywordflow">if</span> (index &lt; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>)
<a name="l08590"></a>08590                <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hKey, &amp;value, &amp;size, index, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l08591"></a>08591          }
<a name="l08592"></a>08592       }
<a name="l08593"></a>08593       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l08594"></a>08594           (<span class="stringliteral">&quot;&lt;td&gt;&lt;input type=text size=10 maxlength=10 name=\&quot;ofs%d\&quot; value=%g&gt;&lt;/td&gt;\n&quot;</span>,
<a name="l08595"></a>08595            index, value);
<a name="l08596"></a>08596 
<a name="l08597"></a>08597       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l08598"></a>08598    }
<a name="l08599"></a>08599 
<a name="l08600"></a>08600    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;&lt;/form&gt;\n&quot;</span>);
<a name="l08601"></a>08601    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l08602"></a>08602 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af3853f14404bead7ea2dbfa3683b6f1b"></a><!-- doxytag: member="mhttpd.c::show_hist_page" ref="af3853f14404bead7ea2dbfa3683b6f1b" args="(char *path, char *buffer, int *buffer_size, int refresh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_hist_page </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>buffer_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>refresh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l08606">8606</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="odb_8c_source.html#l01721">db_create_key()</a>, <a class="el" href="odb_8c_source.html#l02160">db_delete_key()</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04376">db_get_data_index()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="odb_8c_source.html#l04503">db_set_data()</a>, <a class="el" href="odb_8c_source.html#l03128">db_set_value()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mhttpd_8c_source.html#l07289">generate_hist_graph()</a>, <a class="el" href="mana_8cpp_source.html#l00800">getparam()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="mhttpd_8c_source.html#l01089">isparam()</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="odbhist_8c_source.html#l00058">k</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="midas_8h_source.html#l01316">KEY::num_values</a>, <a class="el" href="mgd_8c_source.html#l01505">offset</a>, <a class="el" href="mhttpd_8c_source.html#l01356">redirect()</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l02506">show_elog_new()</a>, <a class="el" href="mhttpd_8c_source.html#l01502">show_header()</a>, <a class="el" href="mhttpd_8c_source.html#l08158">show_hist_config_page()</a>, <a class="el" href="mhttpd_8c_source.html#l08029">show_query_page()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, <a class="el" href="midas_8h_source.html#l00743">TID_FLOAT</a>, <a class="el" href="midas_8h_source.html#l00749">TID_KEY</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="mhttpd_8c_source.html#l07262">time_to_sec()</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, and <a class="el" href="mainWindow_8cpp_source.html#l00032">width</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>, and <a class="el" href="mhttpd_8c_source.html#l03805">submit_elog()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08607"></a>08607 {
<a name="l08608"></a>08608    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], ref[256], ref2[256], paramstr[256], scalestr[256], hgroup[256];
<a name="l08609"></a>08609    <span class="keywordtype">char</span> *poffset, *pscale, *pmag, *pindex;
<a name="l08610"></a>08610    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey, hikeyp, hkeyp, hkeybutton;
<a name="l08611"></a>08611    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>, ikey;
<a name="l08612"></a>08612    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, <a class="code" href="odbhist_8c.html#a43fa990200c3ddd47c35f151bd4d66bf">k</a>, scale, <a class="code" href="mgd_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a>, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, labels;
<a name="l08613"></a>08613    <span class="keywordtype">float</span> factor[2];
<a name="l08614"></a>08614    <span class="keywordtype">char</span> def_button[][<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>] = { <span class="stringliteral">&quot;10m&quot;</span>, <span class="stringliteral">&quot;1h&quot;</span>, <span class="stringliteral">&quot;3h&quot;</span>, <span class="stringliteral">&quot;12h&quot;</span>, <span class="stringliteral">&quot;24h&quot;</span>, <span class="stringliteral">&quot;3d&quot;</span>, <span class="stringliteral">&quot;7d&quot;</span> };
<a name="l08615"></a>08615 
<a name="l08616"></a>08616    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l08617"></a>08617 
<a name="l08618"></a>08618    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>), <span class="stringliteral">&quot;Query&quot;</span>)) {
<a name="l08619"></a>08619       <a class="code" href="mhttpd_8c.html#a3b49c186437b81cc90e327008cf6293d">show_query_page</a>(path);
<a name="l08620"></a>08620       <span class="keywordflow">return</span>;
<a name="l08621"></a>08621    }
<a name="l08622"></a>08622 
<a name="l08623"></a>08623    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>), <span class="stringliteral">&quot;Config&quot;</span>) ||
<a name="l08624"></a>08624        <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>), <span class="stringliteral">&quot;Save&quot;</span>) ||
<a name="l08625"></a>08625        <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>), <span class="stringliteral">&quot;Refresh&quot;</span>)) {
<a name="l08626"></a>08626       <a class="code" href="mhttpd_8c.html#a5295c3eb3d85123c2f79dcdebf08a3a3">show_hist_config_page</a>(path);
<a name="l08627"></a>08627       <span class="comment">/*</span>
<a name="l08628"></a>08628 <span class="comment">         sprintf(str, &quot;History/Display/%s&quot;, path);</span>
<a name="l08629"></a>08629 <span class="comment">         redirect(str);</span>
<a name="l08630"></a>08630 <span class="comment">       */</span>
<a name="l08631"></a>08631 
<a name="l08632"></a>08632       <span class="keywordflow">return</span>;
<a name="l08633"></a>08633    }
<a name="l08634"></a>08634 
<a name="l08635"></a>08635    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>), <span class="stringliteral">&quot;New&quot;</span>)) {
<a name="l08636"></a>08636       sprintf(str, <span class="stringliteral">&quot;HS/%s&quot;</span>, path);
<a name="l08637"></a>08637       <a class="code" href="mhttpd_8c.html#ae5fb6c731656613ead122d173a8ef7a8">show_header</a>(hDB, <span class="stringliteral">&quot;History&quot;</span>, <span class="stringliteral">&quot;GET&quot;</span>, str, 1, 0);
<a name="l08638"></a>08638 
<a name="l08639"></a>08639       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=center bgcolor=\&quot;#FFFF00\&quot; colspan=2&gt;\n&quot;</span>);
<a name="l08640"></a>08640       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Select group: &amp;nbsp;&amp;nbsp;&quot;</span>);
<a name="l08641"></a>08641       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;select name=\&quot;group\&quot;&gt;\n&quot;</span>);
<a name="l08642"></a>08642 
<a name="l08643"></a>08643       <span class="comment">/* list existing groups */</span>
<a name="l08644"></a>08644       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/History/Display&quot;</span>, &amp;hkey);
<a name="l08645"></a>08645       <span class="keywordflow">if</span> (hkey) {
<a name="l08646"></a>08646          <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l08647"></a>08647             <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkey, i, &amp;hkeyp);
<a name="l08648"></a>08648 
<a name="l08649"></a>08649             <span class="keywordflow">if</span> (!hkeyp)
<a name="l08650"></a>08650                <span class="keywordflow">break</span>;
<a name="l08651"></a>08651 
<a name="l08652"></a>08652             <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkeyp, &amp;key);
<a name="l08653"></a>08653             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option&gt;%s&lt;/option&gt;\n&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l08654"></a>08654          }
<a name="l08655"></a>08655       }
<a name="l08656"></a>08656       <span class="keywordflow">if</span> (!hkey || i == 0)
<a name="l08657"></a>08657          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option&gt;Default&lt;/option&gt;\n&quot;</span>);
<a name="l08658"></a>08658       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;&lt;p&gt;\n&quot;</span>);
<a name="l08659"></a>08659 
<a name="l08660"></a>08660       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Or enter new group name: &amp;nbsp;&amp;nbsp;&quot;</span>);
<a name="l08661"></a>08661       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=text size=15 maxlength=31 name=new_group&gt;\n&quot;</span>);
<a name="l08662"></a>08662 
<a name="l08663"></a>08663       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=center bgcolor=\&quot;#FFFF00\&quot; colspan=2&gt;\n&quot;</span>);
<a name="l08664"></a>08664       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;br&gt;Panel name: &amp;nbsp;&amp;nbsp;&quot;</span>);
<a name="l08665"></a>08665       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=text size=15 maxlength=31 name=panel&gt;&lt;br&gt;&lt;br&gt;\n&quot;</span>);
<a name="l08666"></a>08666       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l08667"></a>08667 
<a name="l08668"></a>08668       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=center colspan=2&gt;&quot;</span>);
<a name="l08669"></a>08669       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit value=Submit&gt;\n&quot;</span>);
<a name="l08670"></a>08670       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l08671"></a>08671 
<a name="l08672"></a>08672       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;\r\n&quot;</span>);
<a name="l08673"></a>08673       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l08674"></a>08674       <span class="keywordflow">return</span>;
<a name="l08675"></a>08675    }
<a name="l08676"></a>08676 
<a name="l08677"></a>08677    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>), <span class="stringliteral">&quot;Delete Panel&quot;</span>)) {
<a name="l08678"></a>08678       sprintf(str, <span class="stringliteral">&quot;/History/Display/%s&quot;</span>, path);
<a name="l08679"></a>08679       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkey))
<a name="l08680"></a>08680          <a class="code" href="group__msectionh.html#ga91277a012e0bfddbc32885da450409e0">db_delete_key</a>(hDB, hkey, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l08681"></a>08681 
<a name="l08682"></a>08682       <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;HS/&quot;</span>);
<a name="l08683"></a>08683       <span class="keywordflow">return</span>;
<a name="l08684"></a>08684    }
<a name="l08685"></a>08685 
<a name="l08686"></a>08686    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;panel&quot;</span>)) {
<a name="l08687"></a>08687       strcpy(path, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;panel&quot;</span>));
<a name="l08688"></a>08688       strcpy(hgroup, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;group&quot;</span>));
<a name="l08689"></a>08689       <span class="comment">/* use new group if present */</span>
<a name="l08690"></a>08690       <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#a4879491abfc24dbd22963a8b33f3f6ac">isparam</a>(<span class="stringliteral">&quot;new_group&quot;</span>) &amp;&amp; *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;new_group&quot;</span>))
<a name="l08691"></a>08691          strcpy(hgroup, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;new_group&quot;</span>));
<a name="l08692"></a>08692 
<a name="l08693"></a>08693       <span class="comment">/* create new panel */</span>
<a name="l08694"></a>08694       sprintf(str, <span class="stringliteral">&quot;/History/Display/%s/%s&quot;</span>, hgroup, path);
<a name="l08695"></a>08695       <a class="code" href="group__msectionh.html#ga1441e5b7ca1923cf8611f920cf2c31b4">db_create_key</a>(hDB, 0, str, <a class="code" href="group__mdefineh.html#ga15ae151ae0b7588b3327bd8451d9bcb8">TID_KEY</a>);
<a name="l08696"></a>08696       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkey);
<a name="l08697"></a>08697       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, hkey, <span class="stringliteral">&quot;Variables&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a> * 2, 1, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l08698"></a>08698 
<a name="l08699"></a>08699       factor[0] = 1;
<a name="l08700"></a>08700       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, hkey, <span class="stringliteral">&quot;Factor&quot;</span>, factor, 1 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), 1, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l08701"></a>08701       factor[0] = 0;
<a name="l08702"></a>08702       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, hkey, <span class="stringliteral">&quot;Offset&quot;</span>, factor, 1 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), 1, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l08703"></a>08703       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, hkey, <span class="stringliteral">&quot;Timescale&quot;</span>, <span class="stringliteral">&quot;1h&quot;</span>, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>, 1, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l08704"></a>08704       i = 1;
<a name="l08705"></a>08705       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, hkey, <span class="stringliteral">&quot;Zero ylow&quot;</span>, &amp;i, <span class="keyword">sizeof</span>(<a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>), 1, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>);
<a name="l08706"></a>08706       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, hkey, <span class="stringliteral">&quot;Show run markers&quot;</span>, &amp;i, <span class="keyword">sizeof</span>(<a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>), 1, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>);
<a name="l08707"></a>08707       i = 0;
<a name="l08708"></a>08708       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, hkey, <span class="stringliteral">&quot;Log axis&quot;</span>, &amp;i, <span class="keyword">sizeof</span>(<a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>), 1, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>);
<a name="l08709"></a>08709 
<a name="l08710"></a>08710       <span class="comment">/* configure that panel */</span>
<a name="l08711"></a>08711       sprintf(str, <span class="stringliteral">&quot;%s/%s&quot;</span>, hgroup, path);
<a name="l08712"></a>08712       <a class="code" href="mhttpd_8c.html#a5295c3eb3d85123c2f79dcdebf08a3a3">show_hist_config_page</a>(str);
<a name="l08713"></a>08713       <span class="keywordflow">return</span>;
<a name="l08714"></a>08714    }
<a name="l08715"></a>08715 
<a name="l08716"></a>08716    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>), <span class="stringliteral">&quot;Create ELog&quot;</span>)) {
<a name="l08717"></a>08717       sprintf(str, <span class="stringliteral">&quot;\\HS\\%s.gif&quot;</span>, path);
<a name="l08718"></a>08718       <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;hscale&quot;</span>) &amp;&amp; *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;hscale&quot;</span>))
<a name="l08719"></a>08719          sprintf(str + strlen(str), <span class="stringliteral">&quot;?scale=%s&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;hscale&quot;</span>));
<a name="l08720"></a>08720       <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;hoffset&quot;</span>) &amp;&amp; *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;hoffset&quot;</span>)) {
<a name="l08721"></a>08721          <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;?&apos;</span>))
<a name="l08722"></a>08722             strcat(str, <span class="stringliteral">&quot;&amp;&quot;</span>);
<a name="l08723"></a>08723          <span class="keywordflow">else</span>
<a name="l08724"></a>08724             strcat(str, <span class="stringliteral">&quot;?&quot;</span>);
<a name="l08725"></a>08725          sprintf(str + strlen(str), <span class="stringliteral">&quot;offset=%s&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;hoffset&quot;</span>));
<a name="l08726"></a>08726       }
<a name="l08727"></a>08727       <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;hwidth&quot;</span>) &amp;&amp; *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;hwidth&quot;</span>)) {
<a name="l08728"></a>08728          <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;?&apos;</span>))
<a name="l08729"></a>08729             strcat(str, <span class="stringliteral">&quot;&amp;&quot;</span>);
<a name="l08730"></a>08730          <span class="keywordflow">else</span>
<a name="l08731"></a>08731             strcat(str, <span class="stringliteral">&quot;?&quot;</span>);
<a name="l08732"></a>08732          sprintf(str + strlen(str), <span class="stringliteral">&quot;width=%s&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;hwidth&quot;</span>));
<a name="l08733"></a>08733       }
<a name="l08734"></a>08734       <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;hindex&quot;</span>) &amp;&amp; *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;hindex&quot;</span>)) {
<a name="l08735"></a>08735          <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;?&apos;</span>))
<a name="l08736"></a>08736             strcat(str, <span class="stringliteral">&quot;&amp;&quot;</span>);
<a name="l08737"></a>08737          <span class="keywordflow">else</span>
<a name="l08738"></a>08738             strcat(str, <span class="stringliteral">&quot;?&quot;</span>);
<a name="l08739"></a>08739          sprintf(str + strlen(str), <span class="stringliteral">&quot;index=%s&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;hindex&quot;</span>));
<a name="l08740"></a>08740       }
<a name="l08741"></a>08741 
<a name="l08742"></a>08742       <a class="code" href="mhttpd_8c.html#a20b81ae6551aa9bd26ecd6057d3442ab">show_elog_new</a>(NULL, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, str);
<a name="l08743"></a>08743       <span class="keywordflow">return</span>;
<a name="l08744"></a>08744    }
<a name="l08745"></a>08745 
<a name="l08746"></a>08746    pscale = <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;scale&quot;</span>);
<a name="l08747"></a>08747    <span class="keywordflow">if</span> (pscale == NULL || *pscale == 0)
<a name="l08748"></a>08748       pscale = <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;hscale&quot;</span>);
<a name="l08749"></a>08749    poffset = <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;offset&quot;</span>);
<a name="l08750"></a>08750    <span class="keywordflow">if</span> (poffset == NULL || *poffset == 0)
<a name="l08751"></a>08751       poffset = <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;hoffset&quot;</span>);
<a name="l08752"></a>08752    pmag = <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;width&quot;</span>);
<a name="l08753"></a>08753    <span class="keywordflow">if</span> (pmag == NULL || *pmag == 0)
<a name="l08754"></a>08754       pmag = <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;hwidth&quot;</span>);
<a name="l08755"></a>08755    pindex = <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;index&quot;</span>);
<a name="l08756"></a>08756    <span class="keywordflow">if</span> (pindex == NULL || *pindex == 0)
<a name="l08757"></a>08757       pindex = <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;hindex&quot;</span>);
<a name="l08758"></a>08758 
<a name="l08759"></a>08759    labels = 1;
<a name="l08760"></a>08760    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;labels&quot;</span>) &amp;&amp; atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;labels&quot;</span>)) == 0)
<a name="l08761"></a>08761       labels = 0;
<a name="l08762"></a>08762 
<a name="l08763"></a>08763    <span class="comment">/* evaluate scale and offset */</span>
<a name="l08764"></a>08764 
<a name="l08765"></a>08765    <span class="keywordflow">if</span> (poffset &amp;&amp; *poffset)
<a name="l08766"></a>08766       offset = <a class="code" href="mhttpd_8c.html#a0f7449df3cdf1d111e5c926dc798180b">time_to_sec</a>(poffset);
<a name="l08767"></a>08767    <span class="keywordflow">else</span>
<a name="l08768"></a>08768       offset = 0;
<a name="l08769"></a>08769 
<a name="l08770"></a>08770    <span class="keywordflow">if</span> (pscale &amp;&amp; *pscale)
<a name="l08771"></a>08771       scale = <a class="code" href="mhttpd_8c.html#a0f7449df3cdf1d111e5c926dc798180b">time_to_sec</a>(pscale);
<a name="l08772"></a>08772    <span class="keywordflow">else</span>
<a name="l08773"></a>08773       scale = 0;
<a name="l08774"></a>08774 
<a name="l08775"></a>08775    <span class="keywordflow">if</span> (strstr(path, <span class="stringliteral">&quot;.gif&quot;</span>)) {
<a name="l08776"></a>08776       index = -1;
<a name="l08777"></a>08777       <span class="keywordflow">if</span> (pindex &amp;&amp; *pindex)
<a name="l08778"></a>08778          index = atoi(pindex);
<a name="l08779"></a>08779 
<a name="l08780"></a>08780       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(pmag, <span class="stringliteral">&quot;Large&quot;</span>))
<a name="l08781"></a>08781          <a class="code" href="mhttpd_8c.html#a9506713463026c887f8d19f1c6a5ea20">generate_hist_graph</a>(path, <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, <a class="code" href="fal_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a>, 1024, 768, scale, offset, index,
<a name="l08782"></a>08782                              labels);
<a name="l08783"></a>08783       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(pmag, <span class="stringliteral">&quot;Small&quot;</span>))
<a name="l08784"></a>08784          <a class="code" href="mhttpd_8c.html#a9506713463026c887f8d19f1c6a5ea20">generate_hist_graph</a>(path, <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, <a class="code" href="fal_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a>, 320, 200, scale, offset, index,
<a name="l08785"></a>08785                              labels);
<a name="l08786"></a>08786       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (atoi(pmag) &gt; 0)
<a name="l08787"></a>08787          <a class="code" href="mhttpd_8c.html#a9506713463026c887f8d19f1c6a5ea20">generate_hist_graph</a>(path, <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, <a class="code" href="fal_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a>, atoi(pmag),
<a name="l08788"></a>08788                              (<span class="keywordtype">int</span>) (atoi(pmag) * 0.625), scale, offset, index, labels);
<a name="l08789"></a>08789       <span class="keywordflow">else</span>
<a name="l08790"></a>08790          <a class="code" href="mhttpd_8c.html#a9506713463026c887f8d19f1c6a5ea20">generate_hist_graph</a>(path, <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, <a class="code" href="fal_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a>, 640, 400, scale, offset, index,
<a name="l08791"></a>08791                              labels);
<a name="l08792"></a>08792 
<a name="l08793"></a>08793       <span class="keywordflow">return</span>;
<a name="l08794"></a>08794    }
<a name="l08795"></a>08795 
<a name="l08796"></a>08796    <span class="comment">/* evaluate offset shift */</span>
<a name="l08797"></a>08797    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;shift&quot;</span>), <span class="stringliteral">&quot;&lt;&quot;</span>))
<a name="l08798"></a>08798       offset -= scale / 2;
<a name="l08799"></a>08799 
<a name="l08800"></a>08800    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;shift&quot;</span>), <span class="stringliteral">&quot;&gt;&quot;</span>)) {
<a name="l08801"></a>08801       offset += scale / 2;
<a name="l08802"></a>08802       <span class="keywordflow">if</span> (offset &gt; 0)
<a name="l08803"></a>08803          offset = 0;
<a name="l08804"></a>08804    }
<a name="l08805"></a>08805    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;shift&quot;</span>), <span class="stringliteral">&quot;&gt;&gt;&quot;</span>))
<a name="l08806"></a>08806       offset = 0;
<a name="l08807"></a>08807 
<a name="l08808"></a>08808    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;shift&quot;</span>), <span class="stringliteral">&quot; + &quot;</span>)) {
<a name="l08809"></a>08809       offset -= scale / 4;
<a name="l08810"></a>08810       scale /= 2;
<a name="l08811"></a>08811    }
<a name="l08812"></a>08812 
<a name="l08813"></a>08813    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;shift&quot;</span>), <span class="stringliteral">&quot; - &quot;</span>)) {
<a name="l08814"></a>08814       offset += scale / 2;
<a name="l08815"></a>08815       <span class="keywordflow">if</span> (offset &gt; 0)
<a name="l08816"></a>08816          offset = 0;
<a name="l08817"></a>08817       scale *= 2;
<a name="l08818"></a>08818    }
<a name="l08819"></a>08819 
<a name="l08820"></a>08820    sprintf(str, <span class="stringliteral">&quot;HS/%s&quot;</span>, path);
<a name="l08821"></a>08821    <a class="code" href="mhttpd_8c.html#ae5fb6c731656613ead122d173a8ef7a8">show_header</a>(hDB, <span class="stringliteral">&quot;History&quot;</span>, <span class="stringliteral">&quot;GET&quot;</span>, str, 1, offset == 0 ? refresh : 0);
<a name="l08822"></a>08822 
<a name="l08823"></a>08823    <span class="comment">/* menu buttons */</span>
<a name="l08824"></a>08824    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=\&quot;#C0C0C0\&quot;&gt;\n&quot;</span>);
<a name="l08825"></a>08825    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=ODB&gt;\n&quot;</span>);
<a name="l08826"></a>08826    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Alarms&gt;\n&quot;</span>);
<a name="l08827"></a>08827    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Status&gt;\n&quot;</span>);
<a name="l08828"></a>08828 
<a name="l08829"></a>08829    <span class="comment">/* define hidden field for parameters */</span>
<a name="l08830"></a>08830    <span class="keywordflow">if</span> (pscale &amp;&amp; *pscale)
<a name="l08831"></a>08831       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=hscale value=%d&gt;\n&quot;</span>, scale);
<a name="l08832"></a>08832    <span class="keywordflow">else</span> {
<a name="l08833"></a>08833       <span class="comment">/* if no scale and offset given, get it from default */</span>
<a name="l08834"></a>08834       <span class="keywordflow">if</span> (path[0] &amp;&amp; !<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(path, <span class="stringliteral">&quot;All&quot;</span>)) {
<a name="l08835"></a>08835          sprintf(str, <span class="stringliteral">&quot;/History/Display/%s/Timescale&quot;</span>, path);
<a name="l08836"></a>08836 
<a name="l08837"></a>08837          strcpy(scalestr, <span class="stringliteral">&quot;1h&quot;</span>);
<a name="l08838"></a>08838          size = <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>;
<a name="l08839"></a>08839          status = <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, str, scalestr, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l08840"></a>08840          <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l08841"></a>08841             <span class="comment">/* delete old integer key */</span>
<a name="l08842"></a>08842             <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkey);
<a name="l08843"></a>08843             <span class="keywordflow">if</span> (hkey)
<a name="l08844"></a>08844                <a class="code" href="group__msectionh.html#ga91277a012e0bfddbc32885da450409e0">db_delete_key</a>(hDB, hkey, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l08845"></a>08845 
<a name="l08846"></a>08846             strcpy(scalestr, <span class="stringliteral">&quot;1h&quot;</span>);
<a name="l08847"></a>08847             size = <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>;
<a name="l08848"></a>08848             <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, str, scalestr, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l08849"></a>08849          }
<a name="l08850"></a>08850 
<a name="l08851"></a>08851          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=hscale value=%s&gt;\n&quot;</span>, scalestr);
<a name="l08852"></a>08852          scale = <a class="code" href="mhttpd_8c.html#a0f7449df3cdf1d111e5c926dc798180b">time_to_sec</a>(scalestr);
<a name="l08853"></a>08853       }
<a name="l08854"></a>08854    }
<a name="l08855"></a>08855 
<a name="l08856"></a>08856    <span class="keywordflow">if</span> (offset != 0)
<a name="l08857"></a>08857       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=hoffset value=%d&gt;\n&quot;</span>, offset);
<a name="l08858"></a>08858    <span class="keywordflow">if</span> (pmag &amp;&amp; *pmag)
<a name="l08859"></a>08859       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=hwidth value=%s&gt;\n&quot;</span>, pmag);
<a name="l08860"></a>08860    <span class="keywordflow">if</span> (pindex &amp;&amp; *pindex)
<a name="l08861"></a>08861       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=hindex value=%s&gt;\n&quot;</span>, pindex);
<a name="l08862"></a>08862 
<a name="l08863"></a>08863    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l08864"></a>08864 
<a name="l08865"></a>08865    <span class="comment">/* links for history panels */</span>
<a name="l08866"></a>08866    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=\&quot;#FFFF00\&quot;&gt;\n&quot;</span>);
<a name="l08867"></a>08867    <span class="keywordflow">if</span> (!path[0])
<a name="l08868"></a>08868       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;b&gt;Please select panel:&lt;/b&gt;&lt;br&gt;\n&quot;</span>);
<a name="l08869"></a>08869 
<a name="l08870"></a>08870    <span class="comment">/* table for panel selection */</span>
<a name="l08871"></a>08871    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;table border=1 cellpadding=3 style=&apos;text-align: left;&apos;&gt;&quot;</span>);
<a name="l08872"></a>08872 
<a name="l08873"></a>08873    <span class="comment">/* &quot;All&quot; link */</span>
<a name="l08874"></a>08874    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2&gt;\n&quot;</span>);
<a name="l08875"></a>08875    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(path, <span class="stringliteral">&quot;All&quot;</span>))
<a name="l08876"></a>08876       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;b&gt;All&lt;/b&gt; &amp;nbsp;&amp;nbsp;&quot;</span>);
<a name="l08877"></a>08877    <span class="keywordflow">else</span> {
<a name="l08878"></a>08878       <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l08879"></a>08879          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/HS/All?exp=%s\&quot;&gt;ALL&lt;/a&gt; &amp;nbsp;&amp;nbsp;\n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l08880"></a>08880       <span class="keywordflow">else</span>
<a name="l08881"></a>08881          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/HS/All\&quot;&gt;ALL&lt;/a&gt;\n&quot;</span>);
<a name="l08882"></a>08882    }
<a name="l08883"></a>08883    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l08884"></a>08884 
<a name="l08885"></a>08885    <span class="comment">/* Setup History table links */</span>
<a name="l08886"></a>08886    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/History/Display&quot;</span>, &amp;hkey);
<a name="l08887"></a>08887    <span class="keywordflow">if</span> (!hkey) {
<a name="l08888"></a>08888       <span class="comment">/* create default panel */</span>
<a name="l08889"></a>08889       strcpy(str, <span class="stringliteral">&quot;System:Trigger per sec.&quot;</span>);
<a name="l08890"></a>08890       strcpy(str + 2 * <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>, <span class="stringliteral">&quot;System:Trigger kB per sec.&quot;</span>);
<a name="l08891"></a>08891       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, 0, <span class="stringliteral">&quot;/History/Display/Default/Trigger rate/Variables&quot;</span>,
<a name="l08892"></a>08892                    str, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a> * 4, 2, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l08893"></a>08893       strcpy(str, <span class="stringliteral">&quot;1h&quot;</span>);
<a name="l08894"></a>08894       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, 0, <span class="stringliteral">&quot;/History/Display/Default/Trigger rate/Time Scale&quot;</span>,
<a name="l08895"></a>08895                    str, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>, 1, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l08896"></a>08896 
<a name="l08897"></a>08897       factor[0] = 1;
<a name="l08898"></a>08898       factor[1] = 1;
<a name="l08899"></a>08899       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, 0, <span class="stringliteral">&quot;/History/Display/Default/Trigger rate/Factor&quot;</span>,
<a name="l08900"></a>08900                    factor, 2 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), 2, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l08901"></a>08901       factor[0] = 0;
<a name="l08902"></a>08902       factor[1] = 0;
<a name="l08903"></a>08903       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, 0, <span class="stringliteral">&quot;/History/Display/Default/Trigger rate/Offset&quot;</span>,
<a name="l08904"></a>08904                    factor, 2 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), 2, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l08905"></a>08905       strcpy(str, <span class="stringliteral">&quot;1h&quot;</span>);
<a name="l08906"></a>08906       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, 0, <span class="stringliteral">&quot;/History/Display/Default/Trigger rate/Timescale&quot;</span>,
<a name="l08907"></a>08907                    str, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>, 1, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l08908"></a>08908       i = 1;
<a name="l08909"></a>08909       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, 0, <span class="stringliteral">&quot;/History/Display/Default/Trigger rate/Zero ylow&quot;</span>,
<a name="l08910"></a>08910                    &amp;i, <span class="keyword">sizeof</span>(<a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>), 1, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>);
<a name="l08911"></a>08911       i = 1;
<a name="l08912"></a>08912       <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, 0, <span class="stringliteral">&quot;/History/Display/Default/Trigger rate/Show run markers&quot;</span>,
<a name="l08913"></a>08913                    &amp;i, <span class="keyword">sizeof</span>(<a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>), 1, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>);
<a name="l08914"></a>08914    }
<a name="l08915"></a>08915 
<a name="l08916"></a>08916    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/History/Display&quot;</span>, &amp;hkey);
<a name="l08917"></a>08917    <span class="keywordflow">if</span> (hkey) {
<a name="l08918"></a>08918       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l08919"></a>08919          <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkey, i, &amp;hkeyp);
<a name="l08920"></a>08920 
<a name="l08921"></a>08921          <span class="keywordflow">if</span> (!hkeyp)
<a name="l08922"></a>08922             <span class="keywordflow">break</span>;
<a name="l08923"></a>08923 
<a name="l08924"></a>08924          <span class="comment">// Group key</span>
<a name="l08925"></a>08925          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkeyp, &amp;key);
<a name="l08926"></a>08926          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/td&gt;\n&lt;td&gt;&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l08927"></a>08927 
<a name="l08928"></a>08928          <span class="keywordflow">for</span> (j = 0;; j++) {
<a name="l08929"></a>08929             <span class="comment">// scan items </span>
<a name="l08930"></a>08930             <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyp, j, &amp;hikeyp);
<a name="l08931"></a>08931 
<a name="l08932"></a>08932             <span class="keywordflow">if</span> (!hikeyp) {
<a name="l08933"></a>08933                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>);
<a name="l08934"></a>08934                <span class="keywordflow">break</span>;
<a name="l08935"></a>08935             }
<a name="l08936"></a>08936             <span class="comment">// Item key</span>
<a name="l08937"></a>08937             <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hikeyp, &amp;ikey);
<a name="l08938"></a>08938 
<a name="l08939"></a>08939             <span class="keywordflow">if</span> (strchr(path, <span class="charliteral">&apos;/&apos;</span>))
<a name="l08940"></a>08940                strcpy(str, strchr(path, <span class="charliteral">&apos;/&apos;</span>) + 1);
<a name="l08941"></a>08941             <span class="keywordflow">else</span>
<a name="l08942"></a>08942                strcpy(str, path);
<a name="l08943"></a>08943 
<a name="l08944"></a>08944             <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, ikey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>))
<a name="l08945"></a>08945                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;small&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/small&gt; &amp;nbsp;&quot;</span>, ikey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l08946"></a>08946             <span class="keywordflow">else</span> {
<a name="l08947"></a>08947                <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l08948"></a>08948                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;small&gt;&lt;a href=\&quot;/HS/%s/%s?exp=%s\&quot;&gt;%s&lt;/a&gt;&lt;/small&gt; &amp;nbsp;\n&quot;</span>,
<a name="l08949"></a>08949                            key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, ikey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, ikey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l08950"></a>08950                <span class="keywordflow">else</span>
<a name="l08951"></a>08951                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;small&gt;&lt;a href=\&quot;/HS/%s/%s\&quot;&gt;%s&lt;/a&gt;&lt;/small&gt; &amp;nbsp;\n&quot;</span>,
<a name="l08952"></a>08952                            key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, ikey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, ikey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l08953"></a>08953             }
<a name="l08954"></a>08954          }
<a name="l08955"></a>08955       }
<a name="l08956"></a>08956    }
<a name="l08957"></a>08957 
<a name="l08958"></a>08958    <span class="comment">/* &quot;New&quot; button */</span>
<a name="l08959"></a>08959    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2&gt;&lt;input type=submit name=cmd value=New&gt;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l08960"></a>08960 
<a name="l08961"></a>08961    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l08962"></a>08962 
<a name="l08963"></a>08963    <span class="comment">/* image panel */</span>
<a name="l08964"></a>08964    <span class="keywordflow">if</span> (path[0] &amp;&amp; !<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(path, <span class="stringliteral">&quot;All&quot;</span>)) {
<a name="l08965"></a>08965       <span class="comment">/* navigation links */</span>
<a name="l08966"></a>08966       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=\&quot;#A0FFA0\&quot;&gt;\n&quot;</span>);
<a name="l08967"></a>08967 
<a name="l08968"></a>08968       sprintf(str, <span class="stringliteral">&quot;/History/Display/%s/Buttons&quot;</span>, path);
<a name="l08969"></a>08969       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkeybutton);
<a name="l08970"></a>08970       <span class="keywordflow">if</span> (hkeybutton == 0) {
<a name="l08971"></a>08971          <span class="comment">/* create default buttons */</span>
<a name="l08972"></a>08972          <a class="code" href="group__msectionh.html#ga1441e5b7ca1923cf8611f920cf2c31b4">db_create_key</a>(hDB, 0, str, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l08973"></a>08973          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkeybutton);
<a name="l08974"></a>08974          <a class="code" href="group__msectionh.html#ga6b98aa5ac9036c49023c0cc9353922d4">db_set_data</a>(hDB, hkeybutton, def_button, <span class="keyword">sizeof</span>(def_button), 7, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l08975"></a>08975       }
<a name="l08976"></a>08976 
<a name="l08977"></a>08977       <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkeybutton, &amp;key);
<a name="l08978"></a>08978 
<a name="l08979"></a>08979       <span class="keywordflow">for</span> (i = 0; i &lt; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; i++) {
<a name="l08980"></a>08980          size = <span class="keyword">sizeof</span>(str);
<a name="l08981"></a>08981          <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hkeybutton, str, &amp;size, i, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l08982"></a>08982          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=scale value=%s&gt;\n&quot;</span>, str);
<a name="l08983"></a>08983       }
<a name="l08984"></a>08984 
<a name="l08985"></a>08985       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=shift value=\&quot;&lt;\&quot;&gt;\n&quot;</span>);
<a name="l08986"></a>08986       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=shift value=\&quot; + \&quot;&gt;\n&quot;</span>);
<a name="l08987"></a>08987       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=shift value=\&quot; - \&quot;&gt;\n&quot;</span>);
<a name="l08988"></a>08988       <span class="keywordflow">if</span> (offset != 0) {
<a name="l08989"></a>08989          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=shift value=\&quot;&gt;\&quot;&gt;\n&quot;</span>);
<a name="l08990"></a>08990          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=shift value=\&quot;&gt;&gt;\&quot;&gt;\n&quot;</span>);
<a name="l08991"></a>08991       }
<a name="l08992"></a>08992 
<a name="l08993"></a>08993       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=\&quot;#A0FFA0\&quot;&gt;\n&quot;</span>);
<a name="l08994"></a>08994       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=width value=Large&gt;\n&quot;</span>);
<a name="l08995"></a>08995       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=width value=Small&gt;\n&quot;</span>);
<a name="l08996"></a>08996       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;Create ELog\&quot;&gt;\n&quot;</span>);
<a name="l08997"></a>08997       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Config&gt;\n&quot;</span>);
<a name="l08998"></a>08998       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Query&gt;\n&quot;</span>);
<a name="l08999"></a>08999 
<a name="l09000"></a>09000       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l09001"></a>09001 
<a name="l09002"></a>09002       paramstr[0] = 0;
<a name="l09003"></a>09003       sprintf(paramstr + strlen(paramstr), <span class="stringliteral">&quot;&amp;scale=%d&quot;</span>, scale);
<a name="l09004"></a>09004       <span class="keywordflow">if</span> (offset != 0)
<a name="l09005"></a>09005          sprintf(paramstr + strlen(paramstr), <span class="stringliteral">&quot;&amp;offset=%d&quot;</span>, offset);
<a name="l09006"></a>09006       <span class="keywordflow">if</span> (pmag &amp;&amp; *pmag)
<a name="l09007"></a>09007          sprintf(paramstr + strlen(paramstr), <span class="stringliteral">&quot;&amp;width=%s&quot;</span>, pmag);
<a name="l09008"></a>09008 
<a name="l09009"></a>09009       <span class="comment">/* define image map */</span>
<a name="l09010"></a>09010       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;map name=\&quot;%s\&quot;&gt;\r\n&quot;</span>, path);
<a name="l09011"></a>09011 
<a name="l09012"></a>09012       <span class="keywordflow">if</span> (!(pindex &amp;&amp; *pindex)) {
<a name="l09013"></a>09013          sprintf(str, <span class="stringliteral">&quot;/History/Display/%s/Variables&quot;</span>, path);
<a name="l09014"></a>09014          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkey);
<a name="l09015"></a>09015          <span class="keywordflow">if</span> (hkey) {
<a name="l09016"></a>09016             <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l09017"></a>09017 
<a name="l09018"></a>09018             <span class="keywordflow">for</span> (i = 0; i &lt; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; i++) {
<a name="l09019"></a>09019                <span class="keywordflow">if</span> (paramstr[0]) {
<a name="l09020"></a>09020                   <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l09021"></a>09021                      sprintf(ref, <span class="stringliteral">&quot;/HS/%s?exp=%s%s&amp;index=%d&quot;</span>, path, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, paramstr,
<a name="l09022"></a>09022                              i);
<a name="l09023"></a>09023                   <span class="keywordflow">else</span>
<a name="l09024"></a>09024                      sprintf(ref, <span class="stringliteral">&quot;/HS/%s?%s&amp;index=%d&quot;</span>, path, paramstr, i);
<a name="l09025"></a>09025                } <span class="keywordflow">else</span> {
<a name="l09026"></a>09026                   <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l09027"></a>09027                      sprintf(ref, <span class="stringliteral">&quot;/HS/%s?exp=%s&amp;index=%d&quot;</span>, path, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, i);
<a name="l09028"></a>09028                   <span class="keywordflow">else</span>
<a name="l09029"></a>09029                      sprintf(ref, <span class="stringliteral">&quot;/HS/%s?index=%d&quot;</span>, path, i);
<a name="l09030"></a>09030                }
<a name="l09031"></a>09031 
<a name="l09032"></a>09032                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;  &lt;area shape=rect coords=\&quot;%d,%d,%d,%d\&quot; href=\&quot;%s\&quot;&gt;\r\n&quot;</span>,
<a name="l09033"></a>09033                         30, 31 + 23 * i, 150, 30 + 23 * i + 17, ref);
<a name="l09034"></a>09034             }
<a name="l09035"></a>09035          }
<a name="l09036"></a>09036       } <span class="keywordflow">else</span> {
<a name="l09037"></a>09037          <span class="keywordflow">if</span> (paramstr[0]) {
<a name="l09038"></a>09038             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l09039"></a>09039                sprintf(ref, <span class="stringliteral">&quot;/HS/%s?exp=%s%s&quot;</span>, path, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, paramstr);
<a name="l09040"></a>09040             <span class="keywordflow">else</span>
<a name="l09041"></a>09041                sprintf(ref, <span class="stringliteral">&quot;/HS/%s?%s&quot;</span>, path, paramstr);
<a name="l09042"></a>09042          } <span class="keywordflow">else</span> {
<a name="l09043"></a>09043             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l09044"></a>09044                sprintf(ref, <span class="stringliteral">&quot;/HS/%s?exp=%s&quot;</span>, path, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l09045"></a>09045             <span class="keywordflow">else</span>
<a name="l09046"></a>09046                sprintf(ref, <span class="stringliteral">&quot;/HS/%s&quot;</span>, path);
<a name="l09047"></a>09047          }
<a name="l09048"></a>09048 
<a name="l09049"></a>09049          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(pmag, <span class="stringliteral">&quot;Large&quot;</span>))
<a name="l09050"></a>09050             width = 1024;
<a name="l09051"></a>09051          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(pmag, <span class="stringliteral">&quot;Small&quot;</span>))
<a name="l09052"></a>09052             width = 320;
<a name="l09053"></a>09053          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (atoi(pmag) &gt; 0)
<a name="l09054"></a>09054             width = atoi(pmag);
<a name="l09055"></a>09055          <span class="keywordflow">else</span>
<a name="l09056"></a>09056             width = 640;
<a name="l09057"></a>09057 
<a name="l09058"></a>09058          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;  &lt;area shape=rect coords=\&quot;%d,%d,%d,%d\&quot; href=\&quot;%s\&quot;&gt;\r\n&quot;</span>,
<a name="l09059"></a>09059                   0, 0, width, 20, ref);
<a name="l09060"></a>09060       }
<a name="l09061"></a>09061 
<a name="l09062"></a>09062       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/map&gt;\r\n&quot;</span>);
<a name="l09063"></a>09063 
<a name="l09064"></a>09064       <span class="comment">/* Display individual panels */</span>
<a name="l09065"></a>09065       <span class="keywordflow">if</span> (pindex &amp;&amp; *pindex)
<a name="l09066"></a>09066          sprintf(paramstr + strlen(paramstr), <span class="stringliteral">&quot;&amp;index=%s&quot;</span>, pindex);
<a name="l09067"></a>09067       <span class="keywordflow">if</span> (paramstr[0]) {
<a name="l09068"></a>09068          <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l09069"></a>09069             sprintf(ref, <span class="stringliteral">&quot;/HS/%s.gif?exp=%s%s&quot;</span>, path, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, paramstr);
<a name="l09070"></a>09070          <span class="keywordflow">else</span>
<a name="l09071"></a>09071             sprintf(ref, <span class="stringliteral">&quot;/HS/%s.gif?%s&quot;</span>, path, paramstr);
<a name="l09072"></a>09072       } <span class="keywordflow">else</span> {
<a name="l09073"></a>09073          <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l09074"></a>09074             sprintf(ref, <span class="stringliteral">&quot;/HS/%s.gif?exp=%s&quot;</span>, path, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l09075"></a>09075          <span class="keywordflow">else</span>
<a name="l09076"></a>09076             sprintf(ref, <span class="stringliteral">&quot;/HS/%s.gif&quot;</span>, path);
<a name="l09077"></a>09077       }
<a name="l09078"></a>09078 
<a name="l09079"></a>09079       <span class="comment">/* put reference to graph */</span>
<a name="l09080"></a>09080       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2&gt;&lt;img src=\&quot;%s\&quot; alt=\&quot;%s.gif\&quot; usemap=\&quot;#%s\&quot;&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l09081"></a>09081                ref, path, path);
<a name="l09082"></a>09082    }
<a name="l09083"></a>09083 
<a name="l09084"></a>09084    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(path, <span class="stringliteral">&quot;All&quot;</span>)) {
<a name="l09085"></a>09085       <span class="comment">/* Display all panels */</span>
<a name="l09086"></a>09086       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/History/Display&quot;</span>, &amp;hkey);
<a name="l09087"></a>09087       <span class="keywordflow">if</span> (hkey)
<a name="l09088"></a>09088          <span class="keywordflow">for</span> (i = 0, k = 0;; i++) {     <span class="comment">// scan Groups</span>
<a name="l09089"></a>09089             <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkey, i, &amp;hkeyp);
<a name="l09090"></a>09090 
<a name="l09091"></a>09091             <span class="keywordflow">if</span> (!hkeyp)
<a name="l09092"></a>09092                <span class="keywordflow">break</span>;
<a name="l09093"></a>09093 
<a name="l09094"></a>09094             <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkeyp, &amp;key);
<a name="l09095"></a>09095 
<a name="l09096"></a>09096             <span class="keywordflow">for</span> (j = 0;; j++, k++) {
<a name="l09097"></a>09097                <span class="comment">// scan items </span>
<a name="l09098"></a>09098                <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyp, j, &amp;hikeyp);
<a name="l09099"></a>09099 
<a name="l09100"></a>09100                <span class="keywordflow">if</span> (!hikeyp)
<a name="l09101"></a>09101                   <span class="keywordflow">break</span>;
<a name="l09102"></a>09102 
<a name="l09103"></a>09103                <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hikeyp, &amp;ikey);
<a name="l09104"></a>09104                <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0]) {
<a name="l09105"></a>09105                   sprintf(ref, <span class="stringliteral">&quot;/HS/%s/%s.gif?exp=%s&amp;width=Small&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, ikey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>,
<a name="l09106"></a>09106                           <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l09107"></a>09107                   sprintf(ref2, <span class="stringliteral">&quot;/HS/%s/%s?exp=%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, ikey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l09108"></a>09108                } <span class="keywordflow">else</span> {
<a name="l09109"></a>09109                   sprintf(ref, <span class="stringliteral">&quot;/HS/%s/%s.gif?width=Small&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, ikey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l09110"></a>09110                   sprintf(ref2, <span class="stringliteral">&quot;/HS/%s/%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, ikey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l09111"></a>09111                }
<a name="l09112"></a>09112 
<a name="l09113"></a>09113                <span class="keywordflow">if</span> (k % 2 == 0)
<a name="l09114"></a>09114                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;&lt;a href=\&quot;%s\&quot;&gt;&lt;img src=\&quot;%s\&quot; alt=\&quot;%s.gif\&quot;&gt;&lt;/a&gt;\n&quot;</span>,
<a name="l09115"></a>09115                            ref2, ref, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l09116"></a>09116                <span class="keywordflow">else</span>
<a name="l09117"></a>09117                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l09118"></a>09118                       (<span class="stringliteral">&quot;&lt;td&gt;&lt;a href=\&quot;%s\&quot;&gt;&lt;img src=\&quot;%s\&quot; alt=\&quot;%s.gif\&quot;&gt;&lt;/a&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l09119"></a>09119                        ref2, ref, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l09120"></a>09120             }                   <span class="comment">// items loop</span>
<a name="l09121"></a>09121          }                      <span class="comment">// Groups loop</span>
<a name="l09122"></a>09122    }                            <span class="comment">// All</span>
<a name="l09123"></a>09123    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;\r\n&quot;</span>);
<a name="l09124"></a>09124    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l09125"></a>09125 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae0a76abf95fa8e8bbc8cfa721c2e9e3e"></a><!-- doxytag: member="mhttpd.c::show_messages_page" ref="ae0a76abf95fa8e8bbc8cfa721c2e9e3e" args="(int refresh, int n_message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_messages_page </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>refresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>n_message</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l02323">2323</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="fal_8c_source.html#l00201">buffer</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="midas_8c_source.html#l01507">cm_msg_retrieve()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02324"></a>02324 {
<a name="l02325"></a>02325    <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, more;
<a name="l02326"></a>02326    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>[100000], line[256], *pline;
<a name="l02327"></a>02327    time_t now;
<a name="l02328"></a>02328    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>;
<a name="l02329"></a>02329    <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> eob;
<a name="l02330"></a>02330 
<a name="l02331"></a>02331    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l02332"></a>02332 
<a name="l02333"></a>02333    <span class="comment">/* header */</span>
<a name="l02334"></a>02334    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l02335"></a>02335    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l02336"></a>02336    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l02337"></a>02337 
<a name="l02338"></a>02338    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;\n&quot;</span>);
<a name="l02339"></a>02339 
<a name="l02340"></a>02340    <span class="comment">/* auto refresh */</span>
<a name="l02341"></a>02341    <span class="keywordflow">if</span> (refresh &gt; 0)
<a name="l02342"></a>02342       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;meta http-equiv=\&quot;Refresh\&quot; content=\&quot;%d\&quot;&gt;\n\n&quot;</span>, refresh);
<a name="l02343"></a>02343 
<a name="l02344"></a>02344    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;title&gt;MIDAS messages&lt;/title&gt;&lt;/head&gt;\n&quot;</span>);
<a name="l02345"></a>02345    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;body&gt;&lt;form method=\&quot;GET\&quot; action=\&quot;/\&quot;&gt;\n&quot;</span>);
<a name="l02346"></a>02346 
<a name="l02347"></a>02347    <span class="comment">/* define hidden field for experiment */</span>
<a name="l02348"></a>02348    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l02349"></a>02349       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=exp value=\&quot;%s\&quot;&gt;\n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l02350"></a>02350 
<a name="l02351"></a>02351    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;table columns=2 border=3 cellpadding=2&gt;\n&quot;</span>);
<a name="l02352"></a>02352 
<a name="l02353"></a>02353   <span class="comment">/*---- title row ----*/</span>
<a name="l02354"></a>02354 
<a name="l02355"></a>02355    size = <span class="keyword">sizeof</span>(str);
<a name="l02356"></a>02356    str[0] = 0;
<a name="l02357"></a>02357    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Name&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02358"></a>02358    <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l02359"></a>02359 
<a name="l02360"></a>02360    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#A0A0FF&gt;MIDAS experiment \&quot;%s\&quot;&quot;</span>, str);
<a name="l02361"></a>02361    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th bgcolor=#A0A0FF&gt;%s&lt;/tr&gt;\n&quot;</span>, ctime(&amp;now));
<a name="l02362"></a>02362 
<a name="l02363"></a>02363   <span class="comment">/*---- menu buttons ----*/</span>
<a name="l02364"></a>02364 
<a name="l02365"></a>02365    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l02366"></a>02366 
<a name="l02367"></a>02367    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=ODB&gt;\n&quot;</span>);
<a name="l02368"></a>02368    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Status&gt;\n&quot;</span>);
<a name="l02369"></a>02369    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Config&gt;\n&quot;</span>);
<a name="l02370"></a>02370    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Help&gt;\n&quot;</span>);
<a name="l02371"></a>02371    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n\n&quot;</span>);
<a name="l02372"></a>02372 
<a name="l02373"></a>02373    <span class="comment">/*---- messages ----*/</span>
<a name="l02374"></a>02374 
<a name="l02375"></a>02375    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2&gt;\n&quot;</span>);
<a name="l02376"></a>02376 
<a name="l02377"></a>02377    <span class="comment">/* more button */</span>
<a name="l02378"></a>02378    <span class="keywordflow">if</span> (n_message == 20)
<a name="l02379"></a>02379       more = 100;
<a name="l02380"></a>02380    <span class="keywordflow">else</span>
<a name="l02381"></a>02381       more = n_message + 100;
<a name="l02382"></a>02382 
<a name="l02383"></a>02383    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=More%d&gt;&lt;p&gt;\n&quot;</span>, more);
<a name="l02384"></a>02384 
<a name="l02385"></a>02385    size = <span class="keyword">sizeof</span>(buffer);
<a name="l02386"></a>02386 
<a name="l02387"></a>02387    <a class="code" href="group__msectionh.html#ga53139935a652b7f225ff2e83d9abd204">cm_msg_retrieve</a>(n_message, buffer, &amp;size);
<a name="l02388"></a>02388 
<a name="l02389"></a>02389    pline = buffer;
<a name="l02390"></a>02390    eob = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02391"></a>02391 
<a name="l02392"></a>02392    <span class="keywordflow">do</span> {
<a name="l02393"></a>02393       strncpy(line, pline, <span class="keyword">sizeof</span>(line));
<a name="l02394"></a>02394 
<a name="l02395"></a>02395       <span class="comment">/* extract single line */</span>
<a name="l02396"></a>02396       <span class="keywordflow">if</span> (strchr(line, <span class="charliteral">&apos;\n&apos;</span>))
<a name="l02397"></a>02397          *strchr(line, <span class="charliteral">&apos;\n&apos;</span>) = 0;
<a name="l02398"></a>02398       <span class="keywordflow">if</span> (strchr(line, <span class="charliteral">&apos;\r&apos;</span>))
<a name="l02399"></a>02399          *strchr(line, <span class="charliteral">&apos;\r&apos;</span>) = 0;
<a name="l02400"></a>02400 
<a name="l02401"></a>02401       pline += strlen(line);
<a name="l02402"></a>02402 
<a name="l02403"></a>02403       <span class="keywordflow">while</span> (*pline == <span class="charliteral">&apos;\r&apos;</span> || *pline == <span class="charliteral">&apos;\n&apos;</span>)
<a name="l02404"></a>02404          pline++;
<a name="l02405"></a>02405 
<a name="l02406"></a>02406       <span class="comment">/* check for error */</span>
<a name="l02407"></a>02407       <span class="keywordflow">if</span> (strchr(line+26, <span class="charliteral">&apos;[&apos;</span>) &amp;&amp; strchr(line+25, <span class="charliteral">&apos;:&apos;</span>))
<a name="l02408"></a>02408          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;span style=\&quot;color:white;background-color:red\&quot;&gt;%s&lt;/span&gt;&quot;</span>, line);
<a name="l02409"></a>02409       <span class="keywordflow">else</span>
<a name="l02410"></a>02410          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;%s&quot;</span>, line);
<a name="l02411"></a>02411 
<a name="l02412"></a>02412       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;br&gt;\n&quot;</span>);
<a name="l02413"></a>02413    } <span class="keywordflow">while</span> (!eob &amp;&amp; *pline);
<a name="l02414"></a>02414 
<a name="l02415"></a>02415    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;&lt;/table&gt;\n&quot;</span>);
<a name="l02416"></a>02416    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l02417"></a>02417 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a457c736466c7c7ddd14880114a4838e4"></a><!-- doxytag: member="mhttpd.c::show_odb_page" ref="a457c736466c7c7ddd14880114a4838e4" args="(char *enc_path, char *dec_path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_odb_page </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>enc_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dec_path</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l05737">5737</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="lrs1821_8c_source.html#l00038">data</a>, <a class="el" href="odb_8c_source.html#l03390">db_enum_key()</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l04376">db_get_data_index()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l06308">db_sprintf()</a>, <a class="el" href="odb_8c_source.html#l06363">db_sprintfh()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="mhttpd_8c_source.html#l00891">elog_mode</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="midas_8h_source.html#l01320">KEY::item_size</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="midas_8h_source.html#l01316">KEY::num_values</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l01502">show_header()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="mhttpd_8c_source.html#l02421">strencode()</a>, <a class="el" href="mhttpd_8c_source.html#l02480">strencode3()</a>, <a class="el" href="mhttpd_8c_source.html#l00882">TEXT_SIZE</a>, <a class="el" href="midas_8h_source.html#l00749">TID_KEY</a>, <a class="el" href="midas_8h_source.html#l00750">TID_LINK</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="midas_8h_source.html#l01315">KEY::type</a>, and <a class="el" href="mhttpd_8c_source.html#l01153">urlEncode()</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05738"></a>05738 {
<a name="l05739"></a>05739    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l05740"></a>05740    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], tmp_path[256], url_path[256],
<a name="l05741"></a>05741        data_str[<a class="code" href="mhttpd_8c.html#afb6f36d91ffbf947cfa3f1114ca79764">TEXT_SIZE</a>], hex_str[256], ref[256], keyname[32], link_name[256];
<a name="l05742"></a>05742    <span class="keywordtype">char</span> *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>, *pd;
<a name="l05743"></a>05743    <span class="keywordtype">char</span> <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>[<a class="code" href="mhttpd_8c.html#afb6f36d91ffbf947cfa3f1114ca79764">TEXT_SIZE</a>];
<a name="l05744"></a>05744    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey, hkeyroot;
<a name="l05745"></a>05745    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l05746"></a>05746 
<a name="l05747"></a>05747    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l05748"></a>05748 
<a name="l05749"></a>05749    <span class="keywordflow">if</span> (strcmp(enc_path, <span class="stringliteral">&quot;root&quot;</span>) == 0) {
<a name="l05750"></a>05750       strcpy(enc_path, <span class="stringliteral">&quot;&quot;</span>);
<a name="l05751"></a>05751       strcpy(dec_path, <span class="stringliteral">&quot;&quot;</span>);
<a name="l05752"></a>05752    }
<a name="l05753"></a>05753 
<a name="l05754"></a>05754    <a class="code" href="mhttpd_8c.html#ae5fb6c731656613ead122d173a8ef7a8">show_header</a>(hDB, <span class="stringliteral">&quot;MIDAS online database&quot;</span>, <span class="stringliteral">&quot;GET&quot;</span>, enc_path, 1, 0);
<a name="l05755"></a>05755 
<a name="l05756"></a>05756    <span class="comment">/* find key via path */</span>
<a name="l05757"></a>05757    status = <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, dec_path, &amp;hkeyroot);
<a name="l05758"></a>05758    <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l05759"></a>05759       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Error: cannot find key %s&lt;P&gt;\n&quot;</span>, dec_path);
<a name="l05760"></a>05760       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l05761"></a>05761       <span class="keywordflow">return</span>;
<a name="l05762"></a>05762    }
<a name="l05763"></a>05763 
<a name="l05764"></a>05764    <span class="comment">/* if key is not of type TID_KEY, cut off key name */</span>
<a name="l05765"></a>05765    <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkeyroot, &amp;key);
<a name="l05766"></a>05766    <span class="keywordflow">if</span> (key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> != <a class="code" href="group__mdefineh.html#ga15ae151ae0b7588b3327bd8451d9bcb8">TID_KEY</a>) {
<a name="l05767"></a>05767       <span class="comment">/* strip variable name from path */</span>
<a name="l05768"></a>05768       p = dec_path + strlen(dec_path) - 1;
<a name="l05769"></a>05769       <span class="keywordflow">while</span> (*p &amp;&amp; *p != <span class="charliteral">&apos;/&apos;</span>)
<a name="l05770"></a>05770          *p-- = 0;
<a name="l05771"></a>05771       <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;/&apos;</span>)
<a name="l05772"></a>05772          *p = 0;
<a name="l05773"></a>05773 
<a name="l05774"></a>05774       strcpy(enc_path, dec_path);
<a name="l05775"></a>05775       <a class="code" href="mhttpd_8c.html#a477e33c685ba6ebcb9d429fb057c2760">urlEncode</a>(enc_path);
<a name="l05776"></a>05776 
<a name="l05777"></a>05777       status = <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, dec_path, &amp;hkeyroot);
<a name="l05778"></a>05778       <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l05779"></a>05779          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Error: cannot find key %s&lt;P&gt;\n&quot;</span>, dec_path);
<a name="l05780"></a>05780          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l05781"></a>05781          <span class="keywordflow">return</span>;
<a name="l05782"></a>05782       }
<a name="l05783"></a>05783    }
<a name="l05784"></a>05784 
<a name="l05785"></a>05785   <span class="comment">/*---- menu buttons ----*/</span>
<a name="l05786"></a>05786 
<a name="l05787"></a>05787    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#A0A0A0&gt;\n&quot;</span>);
<a name="l05788"></a>05788    <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#a9c91f81733a48f1fbc887b013ee0de14">elog_mode</a>) {
<a name="l05789"></a>05789       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=ELog&gt;\n&quot;</span>);
<a name="l05790"></a>05790       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l05791"></a>05791    } <span class="keywordflow">else</span> {
<a name="l05792"></a>05792       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Find&gt;\n&quot;</span>);
<a name="l05793"></a>05793       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Create&gt;\n&quot;</span>);
<a name="l05794"></a>05794       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Delete&gt;\n&quot;</span>);
<a name="l05795"></a>05795       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Alarms&gt;\n&quot;</span>);
<a name="l05796"></a>05796       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Programs&gt;\n&quot;</span>);
<a name="l05797"></a>05797       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Status&gt;\n&quot;</span>);
<a name="l05798"></a>05798       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Help&gt;\n&quot;</span>);
<a name="l05799"></a>05799       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l05800"></a>05800 
<a name="l05801"></a>05801       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#A0A0A0&gt;\n&quot;</span>);
<a name="l05802"></a>05802       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;Create Elog from this page\&quot;&gt;\n&quot;</span>);
<a name="l05803"></a>05803       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l05804"></a>05804    }
<a name="l05805"></a>05805 
<a name="l05806"></a>05806   <span class="comment">/*---- ODB display -----------------------------------------------*/</span>
<a name="l05807"></a>05807 
<a name="l05808"></a>05808    <span class="comment">/* display root key */</span>
<a name="l05809"></a>05809    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 align=center&gt;&lt;b&gt;&quot;</span>);
<a name="l05810"></a>05810    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l05811"></a>05811       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/root?exp=%s\&quot;&gt;/&lt;/a&gt; \n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l05812"></a>05812    <span class="keywordflow">else</span>
<a name="l05813"></a>05813       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/root?\&quot;&gt;/&lt;/a&gt; \n&quot;</span>);
<a name="l05814"></a>05814 
<a name="l05815"></a>05815    strcpy(tmp_path, <span class="stringliteral">&quot;&quot;</span>);
<a name="l05816"></a>05816 
<a name="l05817"></a>05817    p = dec_path;
<a name="l05818"></a>05818    <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;/&apos;</span>)
<a name="l05819"></a>05819       p++;
<a name="l05820"></a>05820 
<a name="l05821"></a>05821   <span class="comment">/*---- display path ----*/</span>
<a name="l05822"></a>05822    <span class="keywordflow">while</span> (*p) {
<a name="l05823"></a>05823       pd = str;
<a name="l05824"></a>05824       <span class="keywordflow">while</span> (*p &amp;&amp; *p != <span class="charliteral">&apos;/&apos;</span>)
<a name="l05825"></a>05825          *pd++ = *p++;
<a name="l05826"></a>05826       *pd = 0;
<a name="l05827"></a>05827 
<a name="l05828"></a>05828       strcat(tmp_path, str);
<a name="l05829"></a>05829       strcpy(url_path, tmp_path);
<a name="l05830"></a>05830       <a class="code" href="mhttpd_8c.html#a477e33c685ba6ebcb9d429fb057c2760">urlEncode</a>(url_path);
<a name="l05831"></a>05831 
<a name="l05832"></a>05832       <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l05833"></a>05833          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/%s?&amp;exp=%s\&quot;&gt;%s&lt;/a&gt;\n / &quot;</span>, url_path, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, str);
<a name="l05834"></a>05834       <span class="keywordflow">else</span>
<a name="l05835"></a>05835          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/%s\&quot;&gt;%s&lt;/a&gt;\n / &quot;</span>, url_path, str);
<a name="l05836"></a>05836 
<a name="l05837"></a>05837       strcat(tmp_path, <span class="stringliteral">&quot;/&quot;</span>);
<a name="l05838"></a>05838       <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;/&apos;</span>)
<a name="l05839"></a>05839          p++;
<a name="l05840"></a>05840    }
<a name="l05841"></a>05841    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/b&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l05842"></a>05842 
<a name="l05843"></a>05843    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th&gt;Key&lt;th&gt;Value&lt;/tr&gt;\n&quot;</span>);
<a name="l05844"></a>05844 
<a name="l05845"></a>05845    <span class="comment">/* enumerate subkeys */</span>
<a name="l05846"></a>05846    <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l05847"></a>05847       <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyroot, i, &amp;hkey);
<a name="l05848"></a>05848       <span class="keywordflow">if</span> (!hkey)
<a name="l05849"></a>05849          <span class="keywordflow">break</span>;
<a name="l05850"></a>05850       <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l05851"></a>05851 
<a name="l05852"></a>05852       strcpy(str, dec_path);
<a name="l05853"></a>05853       <span class="keywordflow">if</span> (str[0] &amp;&amp; str[strlen(str) - 1] != <span class="charliteral">&apos;/&apos;</span>)
<a name="l05854"></a>05854          strcat(str, <span class="stringliteral">&quot;/&quot;</span>);
<a name="l05855"></a>05855       strcat(str, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l05856"></a>05856       <a class="code" href="mhttpd_8c.html#a477e33c685ba6ebcb9d429fb057c2760">urlEncode</a>(str);
<a name="l05857"></a>05857       strcpy(keyname, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l05858"></a>05858 
<a name="l05859"></a>05859       <span class="comment">/* resolve links */</span>
<a name="l05860"></a>05860       link_name[0] = 0;
<a name="l05861"></a>05861       <span class="keywordflow">if</span> (key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#gaa63f41f547c7f46f828aaf35073807ea">TID_LINK</a>) {
<a name="l05862"></a>05862          size = <span class="keyword">sizeof</span>(link_name);
<a name="l05863"></a>05863          <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, link_name, &amp;size, <a class="code" href="group__mdefineh.html#gaa63f41f547c7f46f828aaf35073807ea">TID_LINK</a>);
<a name="l05864"></a>05864          <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkeyroot, i, &amp;hkey);
<a name="l05865"></a>05865          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l05866"></a>05866       }
<a name="l05867"></a>05867 
<a name="l05868"></a>05868       <span class="keywordflow">if</span> (key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#ga15ae151ae0b7588b3327bd8451d9bcb8">TID_KEY</a>) {
<a name="l05869"></a>05869          <span class="comment">/* for keys, don&apos;t display data value */</span>
<a name="l05870"></a>05870          <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l05871"></a>05871             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05872"></a>05872                 (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#FFD000&gt;&lt;a href=\&quot;/%s?exp=%s\&quot;&gt;%s&lt;/a&gt;&lt;br&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l05873"></a>05873                  str, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, keyname);
<a name="l05874"></a>05874          <span class="keywordflow">else</span>
<a name="l05875"></a>05875             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05876"></a>05876                 (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#FFD000&gt;&lt;a href=\&quot;/%s\&quot;&gt;%s&lt;/a&gt;&lt;br&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l05877"></a>05877                  str, keyname);
<a name="l05878"></a>05878       } <span class="keywordflow">else</span> {
<a name="l05879"></a>05879          <span class="comment">/* display single value */</span>
<a name="l05880"></a>05880          <span class="keywordflow">if</span> (key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a> == 1) {
<a name="l05881"></a>05881             size = <span class="keyword">sizeof</span>(data);
<a name="l05882"></a>05882             <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, data, &amp;size, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05883"></a>05883             <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(data_str, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05884"></a>05884 
<a name="l05885"></a>05885             <span class="keywordflow">if</span> (key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> != <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>)
<a name="l05886"></a>05886                <a class="code" href="group__msectionh.html#gacf595105fe1399620f51c3af5bfb54b4">db_sprintfh</a>(hex_str, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05887"></a>05887             <span class="keywordflow">else</span>
<a name="l05888"></a>05888                hex_str[0] = 0;
<a name="l05889"></a>05889 
<a name="l05890"></a>05890             <span class="keywordflow">if</span> (data_str[0] == 0 || <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(data_str, <span class="stringliteral">&quot;&lt;NULL&gt;&quot;</span>)) {
<a name="l05891"></a>05891                strcpy(data_str, <span class="stringliteral">&quot;(empty)&quot;</span>);
<a name="l05892"></a>05892                hex_str[0] = 0;
<a name="l05893"></a>05893             }
<a name="l05894"></a>05894 
<a name="l05895"></a>05895             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l05896"></a>05896                sprintf(ref, <span class="stringliteral">&quot;/%s?cmd=Set&amp;exp=%s&quot;</span>, str, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l05897"></a>05897             <span class="keywordflow">else</span>
<a name="l05898"></a>05898                sprintf(ref, <span class="stringliteral">&quot;/%s?cmd=Set&quot;</span>, str);
<a name="l05899"></a>05899 
<a name="l05900"></a>05900             <span class="keywordflow">if</span> (strcmp(data_str, hex_str) != 0 &amp;&amp; hex_str[0]) {
<a name="l05901"></a>05901                <span class="keywordflow">if</span> (link_name[0])
<a name="l05902"></a>05902                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05903"></a>05903                       (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;%s &lt;i&gt;-&gt; %s&lt;/i&gt;&lt;td&gt;&lt;a href=\&quot;%s\&quot;&gt;%s (%s)&lt;/a&gt;&lt;br&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l05904"></a>05904                        keyname, link_name, ref, data_str, hex_str);
<a name="l05905"></a>05905                <span class="keywordflow">else</span>
<a name="l05906"></a>05906                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05907"></a>05907                       (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;%s&lt;td&gt;&lt;a href=\&quot;%s\&quot;&gt;%s (%s)&lt;/a&gt;&lt;br&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l05908"></a>05908                        keyname, ref, data_str, hex_str);
<a name="l05909"></a>05909             } <span class="keywordflow">else</span> {
<a name="l05910"></a>05910                <span class="keywordflow">if</span> (strchr(data_str, <span class="charliteral">&apos;\n&apos;</span>)) {
<a name="l05911"></a>05911                   <span class="keywordflow">if</span> (link_name[0])
<a name="l05912"></a>05912                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;%s &lt;i&gt;-&gt; %s&lt;/i&gt;&lt;td&gt;&quot;</span>, keyname,
<a name="l05913"></a>05913                               link_name);
<a name="l05914"></a>05914                   <span class="keywordflow">else</span>
<a name="l05915"></a>05915                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;%s&lt;td&gt;&quot;</span>, keyname);
<a name="l05916"></a>05916                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;\n&lt;pre&gt;&quot;</span>);
<a name="l05917"></a>05917                   <a class="code" href="mhttpd_8c.html#ac66e5e8150fdd60c55a68d566f2f6228">strencode3</a>(data_str);
<a name="l05918"></a>05918                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/pre&gt;&quot;</span>);
<a name="l05919"></a>05919                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;%s\&quot;&gt;Edit&lt;/a&gt;&lt;/tr&gt;\n&quot;</span>, ref);
<a name="l05920"></a>05920                } <span class="keywordflow">else</span> {
<a name="l05921"></a>05921                   <span class="keywordflow">if</span> (link_name[0])
<a name="l05922"></a>05922                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05923"></a>05923                          (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;%s &lt;i&gt;-&gt; %s&lt;/i&gt;&lt;td&gt;&lt;a href=\&quot;%s\&quot;&gt;&quot;</span>,
<a name="l05924"></a>05924                           keyname, link_name, ref);
<a name="l05925"></a>05925                   <span class="keywordflow">else</span>
<a name="l05926"></a>05926                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;%s&lt;td&gt;&lt;a href=\&quot;%s\&quot;&gt;&quot;</span>,
<a name="l05927"></a>05927                               keyname, ref);
<a name="l05928"></a>05928                   <a class="code" href="mhttpd_8c.html#af374dce40baae97a533a83a0626c23dc">strencode</a>(data_str);
<a name="l05929"></a>05929                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/a&gt;&lt;br&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l05930"></a>05930                }
<a name="l05931"></a>05931             }
<a name="l05932"></a>05932          } <span class="keywordflow">else</span> {
<a name="l05933"></a>05933             <span class="comment">/* check for exceeding length */</span>
<a name="l05934"></a>05934             <span class="keywordflow">if</span> (key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a> &gt; 1000)
<a name="l05935"></a>05935                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;%s&lt;td&gt;&lt;i&gt;... %d values ...&lt;/i&gt;\n&quot;</span>,
<a name="l05936"></a>05936                         keyname, key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>);
<a name="l05937"></a>05937             <span class="keywordflow">else</span> {
<a name="l05938"></a>05938                <span class="comment">/* display first value */</span>
<a name="l05939"></a>05939                <span class="keywordflow">if</span> (link_name[0])
<a name="l05940"></a>05940                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td  bgcolor=#FFFF00 rowspan=%d&gt;%s&lt;br&gt;&lt;i&gt;-&gt; %s&lt;/i&gt;\n&quot;</span>,
<a name="l05941"></a>05941                            key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>, keyname, link_name);
<a name="l05942"></a>05942                <span class="keywordflow">else</span>
<a name="l05943"></a>05943                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td  bgcolor=#FFFF00 rowspan=%d&gt;%s\n&quot;</span>, key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>,
<a name="l05944"></a>05944                            keyname);
<a name="l05945"></a>05945 
<a name="l05946"></a>05946                <span class="keywordflow">for</span> (j = 0; j &lt; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; j++) {
<a name="l05947"></a>05947                   size = <span class="keyword">sizeof</span>(data);
<a name="l05948"></a>05948                   <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hkey, data, &amp;size, j, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05949"></a>05949                   <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(data_str, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05950"></a>05950                   <a class="code" href="group__msectionh.html#gacf595105fe1399620f51c3af5bfb54b4">db_sprintfh</a>(hex_str, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05951"></a>05951 
<a name="l05952"></a>05952                   <span class="keywordflow">if</span> (data_str[0] == 0 || <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(data_str, <span class="stringliteral">&quot;&lt;NULL&gt;&quot;</span>)) {
<a name="l05953"></a>05953                      strcpy(data_str, <span class="stringliteral">&quot;(empty)&quot;</span>);
<a name="l05954"></a>05954                      hex_str[0] = 0;
<a name="l05955"></a>05955                   }
<a name="l05956"></a>05956 
<a name="l05957"></a>05957                   <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l05958"></a>05958                      sprintf(ref, <span class="stringliteral">&quot;/%s?cmd=Set&amp;index=%d&amp;exp=%s&quot;</span>, str, j, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l05959"></a>05959                   <span class="keywordflow">else</span>
<a name="l05960"></a>05960                      sprintf(ref, <span class="stringliteral">&quot;/%s?cmd=Set&amp;index=%d&quot;</span>, str, j);
<a name="l05961"></a>05961 
<a name="l05962"></a>05962                   <span class="keywordflow">if</span> (j &gt; 0)
<a name="l05963"></a>05963                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>);
<a name="l05964"></a>05964 
<a name="l05965"></a>05965                   <span class="keywordflow">if</span> (strcmp(data_str, hex_str) != 0 &amp;&amp; hex_str[0])
<a name="l05966"></a>05966                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td&gt;&lt;a href=\&quot;%s\&quot;&gt;[%d] %s (%s)&lt;/a&gt;&lt;br&gt;&lt;/tr&gt;\n&quot;</span>, ref, j,
<a name="l05967"></a>05967                               data_str, hex_str);
<a name="l05968"></a>05968                   <span class="keywordflow">else</span>
<a name="l05969"></a>05969                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td&gt;&lt;a href=\&quot;%s\&quot;&gt;[%d] %s&lt;/a&gt;&lt;br&gt;&lt;/tr&gt;\n&quot;</span>, ref, j,
<a name="l05970"></a>05970                               data_str);
<a name="l05971"></a>05971                }
<a name="l05972"></a>05972             }
<a name="l05973"></a>05973          }
<a name="l05974"></a>05974       }
<a name="l05975"></a>05975    }
<a name="l05976"></a>05976 
<a name="l05977"></a>05977    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>);
<a name="l05978"></a>05978    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l05979"></a>05979 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ada74df02203a2fd3f1ca5b1f8f5d6152"></a><!-- doxytag: member="mhttpd.c::show_password_page" ref="ada74df02203a2fd3f1ca5b1f8f5d6152" args="(char *password, char *experiment)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_password_page </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>password</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>experiment</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l05557">5557</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, and <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05558"></a>05558 {
<a name="l05559"></a>05559    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l05560"></a>05560    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l05561"></a>05561    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l05562"></a>05562 
<a name="l05563"></a>05563    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Enter password&lt;/title&gt;&lt;/head&gt;&lt;body&gt;\n\n&quot;</span>);
<a name="l05564"></a>05564 
<a name="l05565"></a>05565    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;form method=\&quot;GET\&quot; action=\&quot;/\&quot;&gt;\n\n&quot;</span>);
<a name="l05566"></a>05566 
<a name="l05567"></a>05567    <span class="comment">/* define hidden fields for current experiment */</span>
<a name="l05568"></a>05568    <span class="keywordflow">if</span> (experiment[0])
<a name="l05569"></a>05569       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=exp value=\&quot;%s\&quot;&gt;\n&quot;</span>, experiment);
<a name="l05570"></a>05570 
<a name="l05571"></a>05571    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;table border=1 cellpadding=5&gt;&quot;</span>);
<a name="l05572"></a>05572 
<a name="l05573"></a>05573    <span class="keywordflow">if</span> (password[0])
<a name="l05574"></a>05574       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#FF0000&gt;Wrong password!&lt;/tr&gt;\n&quot;</span>);
<a name="l05575"></a>05575 
<a name="l05576"></a>05576    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#A0A0FF&gt;Please enter password&lt;/tr&gt;\n&quot;</span>);
<a name="l05577"></a>05577    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=center&gt;&lt;input type=password name=pwd&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l05578"></a>05578    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=center&gt;&lt;input type=submit value=Submit&gt;&lt;/tr&gt;&quot;</span>);
<a name="l05579"></a>05579 
<a name="l05580"></a>05580    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>);
<a name="l05581"></a>05581 
<a name="l05582"></a>05582    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l05583"></a>05583 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a52835fe4a232ad6286c9734a7283ec47"></a><!-- doxytag: member="mhttpd.c::show_programs_page" ref="a52835fe4a232ad6286c9734a7283ec47" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_programs_page </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l06598">6598</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l05069">cm_exist()</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l04979">cm_shutdown()</a>, <a class="el" href="midas_8h_source.html#l00956">CM_SUCCESS</a>, <a class="el" href="mdump_8c_source.html#l00115">count</a>, <a class="el" href="odb_8c_source.html#l03390">db_enum_key()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mana_8cpp_source.html#l00800">getparam()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00039">name</a>, <a class="el" href="mhttpd_8c_source.html#l01356">redirect()</a>, <a class="el" href="mhttpd_8c_source.html#l01372">redirect2()</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l01557">show_error()</a>, <a class="el" href="mhttpd_8c_source.html#l01502">show_header()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="system_8c_source.html#l02491">ss_sleep()</a>, <a class="el" href="group__msystemincludecode.html#ga7a14ecba483c2767fe699633d0bc677e">ss_system()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, <a class="el" href="midas_8h_source.html#l00749">TID_KEY</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, and <a class="el" href="midas_8h_source.html#l01315">KEY::type</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06599"></a>06599 {
<a name="l06600"></a>06600    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="mdump_8c.html#a3d42cdd395a9c14f809d2fe53748c620">count</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l06601"></a>06601    <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> restart, first, required;
<a name="l06602"></a>06602    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkeyroot, hkey, hkey_rc, hkeycl;
<a name="l06603"></a>06603    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>, keycl;
<a name="l06604"></a>06604    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], ref[256], command[256], <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>[80];
<a name="l06605"></a>06605 
<a name="l06606"></a>06606    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l06607"></a>06607 
<a name="l06608"></a>06608    <span class="comment">/* stop command */</span>
<a name="l06609"></a>06609    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;Stop&quot;</span>)) {
<a name="l06610"></a>06610       status = <a class="code" href="group__msectionh.html#ga5c224ebc90480c8df5bc2a7dd81ff27c">cm_shutdown</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;Stop&quot;</span>) + 5, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l06611"></a>06611 
<a name="l06612"></a>06612       <span class="keywordflow">if</span> (status == <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l06613"></a>06613          <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(<span class="stringliteral">&quot;?cmd=programs&quot;</span>);
<a name="l06614"></a>06614       <span class="keywordflow">else</span> {
<a name="l06615"></a>06615          sprintf(str,
<a name="l06616"></a>06616                  <span class="stringliteral">&quot;Cannot shut down client \&quot;%s\&quot;, please kill manually and do an ODB cleanup&quot;</span>,
<a name="l06617"></a>06617                  <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;Stop&quot;</span>) + 5);
<a name="l06618"></a>06618          <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(str);
<a name="l06619"></a>06619       }
<a name="l06620"></a>06620 
<a name="l06621"></a>06621       <span class="keywordflow">return</span>;
<a name="l06622"></a>06622    }
<a name="l06623"></a>06623 
<a name="l06624"></a>06624    <span class="comment">/* start command */</span>
<a name="l06625"></a>06625    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;Start&quot;</span>)) {
<a name="l06626"></a>06626       <span class="comment">/* for NT: close reply socket before starting subprocess */</span>
<a name="l06627"></a>06627       <a class="code" href="mhttpd_8c.html#a53eda54404f0531285b06ef8c48bbf9b">redirect2</a>(<span class="stringliteral">&quot;?cmd=programs&quot;</span>);
<a name="l06628"></a>06628 
<a name="l06629"></a>06629       strcpy(name, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;Start&quot;</span>) + 6);
<a name="l06630"></a>06630       sprintf(str, <span class="stringliteral">&quot;/Programs/%s/Start command&quot;</span>, name);
<a name="l06631"></a>06631       command[0] = 0;
<a name="l06632"></a>06632       size = <span class="keyword">sizeof</span>(command);
<a name="l06633"></a>06633       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, str, command, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06634"></a>06634       <span class="keywordflow">if</span> (command[0]) {
<a name="l06635"></a>06635          <a class="code" href="group__msystemincludecode.html#ga7a14ecba483c2767fe699633d0bc677e">ss_system</a>(command);
<a name="l06636"></a>06636          <span class="keywordflow">for</span> (i = 0; i &lt; 50; i++) {
<a name="l06637"></a>06637             <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#gafe2e23ec2e5c20fbc65ee238bd6cd48e">cm_exist</a>(name, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) == <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l06638"></a>06638                <span class="keywordflow">break</span>;
<a name="l06639"></a>06639             <a class="code" href="group__msectionh.html#gaaec652d8878ceb5ef38ad1ba2cbf7dec">ss_sleep</a>(100);
<a name="l06640"></a>06640          }
<a name="l06641"></a>06641       }
<a name="l06642"></a>06642 
<a name="l06643"></a>06643       <span class="keywordflow">return</span>;
<a name="l06644"></a>06644    }
<a name="l06645"></a>06645 
<a name="l06646"></a>06646    <a class="code" href="mhttpd_8c.html#ae5fb6c731656613ead122d173a8ef7a8">show_header</a>(hDB, <span class="stringliteral">&quot;Programs&quot;</span>, <span class="stringliteral">&quot;GET&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 3, 0);
<a name="l06647"></a>06647 
<a name="l06648"></a>06648   <span class="comment">/*---- menu buttons ----*/</span>
<a name="l06649"></a>06649 
<a name="l06650"></a>06650    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l06651"></a>06651 
<a name="l06652"></a>06652    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Alarms&gt;\n&quot;</span>);
<a name="l06653"></a>06653    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Status&gt;\n&quot;</span>);
<a name="l06654"></a>06654    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n\n&quot;</span>);
<a name="l06655"></a>06655 
<a name="l06656"></a>06656    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=cmd value=Programs&gt;\n&quot;</span>);
<a name="l06657"></a>06657 
<a name="l06658"></a>06658   <span class="comment">/*---- programs ----*/</span>
<a name="l06659"></a>06659 
<a name="l06660"></a>06660    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th&gt;Program&lt;th&gt;Running on host&lt;th&gt;Alarm class&lt;th&gt;Autorestart&lt;/tr&gt;\n&quot;</span>);
<a name="l06661"></a>06661 
<a name="l06662"></a>06662    <span class="comment">/* go through all programs */</span>
<a name="l06663"></a>06663    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Programs&quot;</span>, &amp;hkeyroot);
<a name="l06664"></a>06664    <span class="keywordflow">if</span> (hkeyroot) {
<a name="l06665"></a>06665       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l06666"></a>06666          <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkeyroot, i, &amp;hkey);
<a name="l06667"></a>06667 
<a name="l06668"></a>06668          <span class="keywordflow">if</span> (!hkey)
<a name="l06669"></a>06669             <span class="keywordflow">break</span>;
<a name="l06670"></a>06670 
<a name="l06671"></a>06671          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l06672"></a>06672 
<a name="l06673"></a>06673          <span class="comment">/* skip &quot;execute on xxxx&quot; */</span>
<a name="l06674"></a>06674          <span class="keywordflow">if</span> (key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> != <a class="code" href="group__mdefineh.html#ga15ae151ae0b7588b3327bd8451d9bcb8">TID_KEY</a>)
<a name="l06675"></a>06675             <span class="keywordflow">continue</span>;
<a name="l06676"></a>06676 
<a name="l06677"></a>06677          <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l06678"></a>06678             sprintf(ref, <span class="stringliteral">&quot;/Programs/%s?exp=%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l06679"></a>06679          <span class="keywordflow">else</span>
<a name="l06680"></a>06680             sprintf(ref, <span class="stringliteral">&quot;/Programs/%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l06681"></a>06681 
<a name="l06682"></a>06682          <span class="comment">/* required? */</span>
<a name="l06683"></a>06683          size = <span class="keyword">sizeof</span>(required);
<a name="l06684"></a>06684          <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkey, <span class="stringliteral">&quot;Required&quot;</span>, &amp;required, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06685"></a>06685 
<a name="l06686"></a>06686          <span class="comment">/* running */</span>
<a name="l06687"></a>06687          count = 0;
<a name="l06688"></a>06688          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/System/Clients&quot;</span>, &amp;hkey_rc) == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l06689"></a>06689             first = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l06690"></a>06690             <span class="keywordflow">for</span> (j = 0;; j++) {
<a name="l06691"></a>06691                <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkey_rc, j, &amp;hkeycl);
<a name="l06692"></a>06692                <span class="keywordflow">if</span> (!hkeycl)
<a name="l06693"></a>06693                   <span class="keywordflow">break</span>;
<a name="l06694"></a>06694 
<a name="l06695"></a>06695                size = <span class="keyword">sizeof</span>(name);
<a name="l06696"></a>06696                <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkeycl, <span class="stringliteral">&quot;Name&quot;</span>, name, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06697"></a>06697 
<a name="l06698"></a>06698                <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkeycl, &amp;keycl);
<a name="l06699"></a>06699                name[strlen(key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>)] = 0;
<a name="l06700"></a>06700 
<a name="l06701"></a>06701                <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(name, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>)) {
<a name="l06702"></a>06702                   size = <span class="keyword">sizeof</span>(str);
<a name="l06703"></a>06703                   <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkeycl, <span class="stringliteral">&quot;Host&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06704"></a>06704 
<a name="l06705"></a>06705                   <span class="keywordflow">if</span> (first) {
<a name="l06706"></a>06706                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#C0C0FF&gt;&lt;a href=\&quot;%s\&quot;&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/a&gt;&quot;</span>, ref,
<a name="l06707"></a>06707                               key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l06708"></a>06708                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center bgcolor=#00FF00&gt;&quot;</span>);
<a name="l06709"></a>06709                   }
<a name="l06710"></a>06710                   <span class="keywordflow">if</span> (!first)
<a name="l06711"></a>06711                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;br&gt;&quot;</span>);
<a name="l06712"></a>06712                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(str);
<a name="l06713"></a>06713 
<a name="l06714"></a>06714                   first = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l06715"></a>06715                   count++;
<a name="l06716"></a>06716                }
<a name="l06717"></a>06717             }
<a name="l06718"></a>06718          }
<a name="l06719"></a>06719 
<a name="l06720"></a>06720          <span class="keywordflow">if</span> (count == 0 &amp;&amp; required) {
<a name="l06721"></a>06721             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#C0C0FF&gt;&lt;a href=\&quot;%s\&quot;&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/a&gt;&quot;</span>, ref,
<a name="l06722"></a>06722                      key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l06723"></a>06723             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center bgcolor=#FF0000&gt;Not running&quot;</span>);
<a name="l06724"></a>06724          }
<a name="l06725"></a>06725 
<a name="l06726"></a>06726          <span class="comment">/* dont display non-running programs which are not required */</span>
<a name="l06727"></a>06727          <span class="keywordflow">if</span> (count == 0 &amp;&amp; !required)
<a name="l06728"></a>06728             <span class="keywordflow">continue</span>;
<a name="l06729"></a>06729 
<a name="l06730"></a>06730          <span class="comment">/* Alarm */</span>
<a name="l06731"></a>06731          size = <span class="keyword">sizeof</span>(str);
<a name="l06732"></a>06732          <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkey, <span class="stringliteral">&quot;Alarm Class&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06733"></a>06733          <span class="keywordflow">if</span> (str[0]) {
<a name="l06734"></a>06734             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l06735"></a>06735                sprintf(ref, <span class="stringliteral">&quot;/Alarms/Classes/%s?exp=%s&quot;</span>, str, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l06736"></a>06736             <span class="keywordflow">else</span>
<a name="l06737"></a>06737                sprintf(ref, <span class="stringliteral">&quot;/Alarms/Classes/%s&quot;</span>, str);
<a name="l06738"></a>06738             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#FFFF00 align=center&gt;&lt;a href=\&quot;%s\&quot;&gt;%s&lt;/a&gt;&quot;</span>, ref, str);
<a name="l06739"></a>06739          } <span class="keywordflow">else</span>
<a name="l06740"></a>06740             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;-&quot;</span>);
<a name="l06741"></a>06741 
<a name="l06742"></a>06742          <span class="comment">/* auto restart */</span>
<a name="l06743"></a>06743          size = <span class="keyword">sizeof</span>(restart);
<a name="l06744"></a>06744          <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkey, <span class="stringliteral">&quot;Auto restart&quot;</span>, &amp;restart, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06745"></a>06745 
<a name="l06746"></a>06746          <span class="keywordflow">if</span> (restart)
<a name="l06747"></a>06747             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;Yes\n&quot;</span>);
<a name="l06748"></a>06748          <span class="keywordflow">else</span>
<a name="l06749"></a>06749             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;No\n&quot;</span>);
<a name="l06750"></a>06750 
<a name="l06751"></a>06751          <span class="comment">/* start/stop button */</span>
<a name="l06752"></a>06752          size = <span class="keyword">sizeof</span>(str);
<a name="l06753"></a>06753          <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkey, <span class="stringliteral">&quot;Start Command&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l06754"></a>06754          <span class="keywordflow">if</span> (str[0] &amp;&amp; count == 0) {
<a name="l06755"></a>06755             sprintf(str, <span class="stringliteral">&quot;Start %s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l06756"></a>06756             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;&lt;input type=submit name=\&quot;Start\&quot; value=\&quot;%s\&quot;&gt;\n&quot;</span>,
<a name="l06757"></a>06757                      str);
<a name="l06758"></a>06758          }
<a name="l06759"></a>06759 
<a name="l06760"></a>06760          <span class="keywordflow">if</span> (count &gt; 0 &amp;&amp; strncmp(key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, <span class="stringliteral">&quot;mhttpd&quot;</span>, 6) != 0) {
<a name="l06761"></a>06761             sprintf(str, <span class="stringliteral">&quot;Stop %s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l06762"></a>06762             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;&lt;input type=submit name=\&quot;Stop\&quot; value=\&quot;%s\&quot;&gt;\n&quot;</span>,
<a name="l06763"></a>06763                      str);
<a name="l06764"></a>06764          }
<a name="l06765"></a>06765 
<a name="l06766"></a>06766          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l06767"></a>06767       }
<a name="l06768"></a>06768    }
<a name="l06769"></a>06769 
<a name="l06770"></a>06770 
<a name="l06771"></a>06771    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>);
<a name="l06772"></a>06772    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l06773"></a>06773 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3b49c186437b81cc90e327008cf6293d"></a><!-- doxytag: member="mhttpd.c::show_query_page" ref="a3b49c186437b81cc90e327008cf6293d" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_query_page </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l08029">8029</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="mana_8cpp_source.html#l00800">getparam()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="Mql_8h_source.html#l00007">MIN</a>, <a class="el" href="mhttpd_8c_source.html#l00894">mname</a>, <a class="el" href="mhttpd_8c_source.html#l01356">redirect()</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l01502">show_header()</a>, <a class="el" href="system_8c_source.html#l02332">ss_time()</a>, and <a class="el" href="CAET_8h_source.html#l00002">time</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l08606">show_hist_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08030"></a>08030 {
<a name="l08031"></a>08031    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l08032"></a>08032    time_t ltime_start, ltime_end;
<a name="l08033"></a>08033    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>;
<a name="l08034"></a>08034    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l08035"></a>08035    time_t now;
<a name="l08036"></a>08036    <span class="keyword">struct </span>tm *ptms, tms;
<a name="l08037"></a>08037 
<a name="l08038"></a>08038    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;m1&quot;</span>)) {
<a name="l08039"></a>08039       memset(&amp;tms, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> tm));
<a name="l08040"></a>08040       tms.tm_year = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;y1&quot;</span>)) % 100;
<a name="l08041"></a>08041 
<a name="l08042"></a>08042       strcpy(str, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;m1&quot;</span>));
<a name="l08043"></a>08043       <span class="keywordflow">for</span> (i = 0; i &lt; 12; i++)
<a name="l08044"></a>08044          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[i]))
<a name="l08045"></a>08045             <span class="keywordflow">break</span>;
<a name="l08046"></a>08046       <span class="keywordflow">if</span> (i == 12)
<a name="l08047"></a>08047          i = 0;
<a name="l08048"></a>08048 
<a name="l08049"></a>08049       tms.tm_mon = i;
<a name="l08050"></a>08050       tms.tm_mday = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;d1&quot;</span>));
<a name="l08051"></a>08051       tms.tm_hour = 0;
<a name="l08052"></a>08052 
<a name="l08053"></a>08053       <span class="keywordflow">if</span> (tms.tm_year &lt; 90)
<a name="l08054"></a>08054          tms.tm_year += 100;
<a name="l08055"></a>08055 
<a name="l08056"></a>08056       ltime_start = mktime(&amp;tms);
<a name="l08057"></a>08057       memset(&amp;tms, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> tm));
<a name="l08058"></a>08058       tms.tm_year = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;y2&quot;</span>)) % 100;
<a name="l08059"></a>08059 
<a name="l08060"></a>08060       strcpy(str, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;m2&quot;</span>));
<a name="l08061"></a>08061       <span class="keywordflow">for</span> (i = 0; i &lt; 12; i++)
<a name="l08062"></a>08062          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[i]))
<a name="l08063"></a>08063             <span class="keywordflow">break</span>;
<a name="l08064"></a>08064       <span class="keywordflow">if</span> (i == 12)
<a name="l08065"></a>08065          i = 0;
<a name="l08066"></a>08066 
<a name="l08067"></a>08067       tms.tm_mon = i;
<a name="l08068"></a>08068       tms.tm_mday = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;d2&quot;</span>));
<a name="l08069"></a>08069       tms.tm_hour = 0;
<a name="l08070"></a>08070 
<a name="l08071"></a>08071       <span class="keywordflow">if</span> (tms.tm_year &lt; 90)
<a name="l08072"></a>08072          tms.tm_year += 100;
<a name="l08073"></a>08073       ltime_end = mktime(&amp;tms);
<a name="l08074"></a>08074       ltime_end += 3600 * 24;
<a name="l08075"></a>08075 
<a name="l08076"></a>08076       sprintf(str, <span class="stringliteral">&quot;HS/%s?scale=%d&amp;offset=%d&quot;</span>, path, (<span class="keywordtype">int</span>) (ltime_end - ltime_start),
<a name="l08077"></a>08077               <a class="code" href="Mql_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>((<span class="keywordtype">int</span>) (ltime_end - <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>()), 0));
<a name="l08078"></a>08078       <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(str);
<a name="l08079"></a>08079       <span class="keywordflow">return</span>;
<a name="l08080"></a>08080    }
<a name="l08081"></a>08081 
<a name="l08082"></a>08082    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l08083"></a>08083 
<a name="l08084"></a>08084    sprintf(str, <span class="stringliteral">&quot;HS/%s&quot;</span>, path);
<a name="l08085"></a>08085    <a class="code" href="mhttpd_8c.html#ae5fb6c731656613ead122d173a8ef7a8">show_header</a>(hDB, <span class="stringliteral">&quot;History&quot;</span>, <span class="stringliteral">&quot;GET&quot;</span>, str, 1, 0);
<a name="l08086"></a>08086 
<a name="l08087"></a>08087    <span class="comment">/* menu buttons */</span>
<a name="l08088"></a>08088    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l08089"></a>08089    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Query&gt;\n&quot;</span>);
<a name="l08090"></a>08090    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=History&gt;\n&quot;</span>);
<a name="l08091"></a>08091    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Status&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l08092"></a>08092    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n\n&quot;</span>);
<a name="l08093"></a>08093 
<a name="l08094"></a>08094    <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l08095"></a>08095    now -= 3600 * 24;
<a name="l08096"></a>08096    ptms = localtime(&amp;now);
<a name="l08097"></a>08097    ptms-&gt;tm_year += 1900;
<a name="l08098"></a>08098 
<a name="l08099"></a>08099    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td nowrap bgcolor=#CCCCFF&gt;Start date:&lt;/td&gt;&quot;</span>, <span class="stringliteral">&quot;Start date&quot;</span>);
<a name="l08100"></a>08100 
<a name="l08101"></a>08101    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#DDEEBB&gt;Month: &lt;select name=\&quot;m1\&quot;&gt;\n&quot;</span>);
<a name="l08102"></a>08102    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;\&quot;&gt;\n&quot;</span>);
<a name="l08103"></a>08103    <span class="keywordflow">for</span> (i = 0; i &lt; 12; i++)
<a name="l08104"></a>08104       <span class="keywordflow">if</span> (i == ptms-&gt;tm_mon)
<a name="l08105"></a>08105          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[i], <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[i]);
<a name="l08106"></a>08106       <span class="keywordflow">else</span>
<a name="l08107"></a>08107          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[i], <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[i]);
<a name="l08108"></a>08108    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;\n&quot;</span>);
<a name="l08109"></a>08109 
<a name="l08110"></a>08110    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&amp;nbsp;Day: &lt;select name=\&quot;d1\&quot;&gt;&quot;</span>);
<a name="l08111"></a>08111    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=\&quot;\&quot;&gt;\n&quot;</span>);
<a name="l08112"></a>08112    <span class="keywordflow">for</span> (i = 0; i &lt; 31; i++)
<a name="l08113"></a>08113       <span class="keywordflow">if</span> (i + 1 == ptms-&gt;tm_mday)
<a name="l08114"></a>08114          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=%d&gt;%d\n&quot;</span>, i + 1, i + 1);
<a name="l08115"></a>08115       <span class="keywordflow">else</span>
<a name="l08116"></a>08116          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=%d&gt;%d\n&quot;</span>, i + 1, i + 1);
<a name="l08117"></a>08117    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;\n&quot;</span>);
<a name="l08118"></a>08118 
<a name="l08119"></a>08119    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l08120"></a>08120        (<span class="stringliteral">&quot;&amp;nbsp;Year: &lt;input type=\&quot;text\&quot; size=5 maxlength=5 name=\&quot;y1\&quot; value=\&quot;%d\&quot;&gt;&quot;</span>,
<a name="l08121"></a>08121         ptms-&gt;tm_year);
<a name="l08122"></a>08122    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l08123"></a>08123 
<a name="l08124"></a>08124    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td nowrap bgcolor=#CCCCFF&gt;End date:&lt;/td&gt;&quot;</span>);
<a name="l08125"></a>08125    <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l08126"></a>08126    ptms = localtime(&amp;now);
<a name="l08127"></a>08127    ptms-&gt;tm_year += 1900;
<a name="l08128"></a>08128 
<a name="l08129"></a>08129    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#DDEEBB&gt;Month: &lt;select name=\&quot;m2\&quot;&gt;\n&quot;</span>);
<a name="l08130"></a>08130    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;\&quot;&gt;\n&quot;</span>);
<a name="l08131"></a>08131    <span class="keywordflow">for</span> (i = 0; i &lt; 12; i++)
<a name="l08132"></a>08132       <span class="keywordflow">if</span> (i == ptms-&gt;tm_mon)
<a name="l08133"></a>08133          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[i], <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[i]);
<a name="l08134"></a>08134       <span class="keywordflow">else</span>
<a name="l08135"></a>08135          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=\&quot;%s\&quot;&gt;%s\n&quot;</span>, <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[i], <a class="code" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[i]);
<a name="l08136"></a>08136    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;\n&quot;</span>);
<a name="l08137"></a>08137 
<a name="l08138"></a>08138    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&amp;nbsp;Day: &lt;select name=\&quot;d2\&quot;&gt;&quot;</span>);
<a name="l08139"></a>08139    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=\&quot;\&quot;&gt;\n&quot;</span>);
<a name="l08140"></a>08140    <span class="keywordflow">for</span> (i = 0; i &lt; 31; i++)
<a name="l08141"></a>08141       <span class="keywordflow">if</span> (i + 1 == ptms-&gt;tm_mday)
<a name="l08142"></a>08142          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option selected value=%d&gt;%d\n&quot;</span>, i + 1, i + 1);
<a name="l08143"></a>08143       <span class="keywordflow">else</span>
<a name="l08144"></a>08144          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;option value=%d&gt;%d\n&quot;</span>, i + 1, i + 1);
<a name="l08145"></a>08145    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/select&gt;\n&quot;</span>);
<a name="l08146"></a>08146 
<a name="l08147"></a>08147    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l08148"></a>08148        (<span class="stringliteral">&quot;&amp;nbsp;Year: &lt;input type=\&quot;text\&quot; size=5 maxlength=5 name=\&quot;y2\&quot; value=\&quot;%d\&quot;&gt;&quot;</span>,
<a name="l08149"></a>08149         ptms-&gt;tm_year);
<a name="l08150"></a>08150    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l08151"></a>08151 
<a name="l08152"></a>08152    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>);
<a name="l08153"></a>08153    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l08154"></a>08154 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abe470e8b895f261f77a887fb45b67b1b"></a><!-- doxytag: member="mhttpd.c::show_rawfile" ref="abe470e8b895f261f77a887fb45b67b1b" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_rawfile </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l03449">3449</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="fal_8c_source.html#l00201">buffer</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="midas_8h_source.html#l00639">DIR_SEPARATOR</a>, <a class="el" href="midas_8h_source.html#l00640">DIR_SEPARATOR_STR</a>, <a class="el" href="mhttpd_8c_source.html#l00891">elog_mode</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="odbhist_8c_source.html#l00059">file_name</a>, <a class="el" href="mana_8cpp_source.html#l00800">getparam()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mgd_8c_source.html#l01505">offset</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="midas_8h_source.html#l00615">PTYPE</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l00959">rsputs()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03450"></a>03450 {
<a name="l03451"></a>03451    <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, lines, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, buf_size, <a class="code" href="mgd_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a>;
<a name="l03452"></a>03452    <span class="keywordtype">char</span> *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>;
<a name="l03453"></a>03453    FILE *f;
<a name="l03454"></a>03454    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a4da1fcf44864d811e793f03bf36e6e17">file_name</a>[256], <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[100], <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>[100000];
<a name="l03455"></a>03455    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>;
<a name="l03456"></a>03456 
<a name="l03457"></a>03457    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l03458"></a>03458 
<a name="l03459"></a>03459    lines = 10;
<a name="l03460"></a>03460    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;lines&quot;</span>))
<a name="l03461"></a>03461       lines = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;lines&quot;</span>));
<a name="l03462"></a>03462 
<a name="l03463"></a>03463    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>) &amp;&amp; <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>), <span class="stringliteral">&quot;More lines&quot;</span>))
<a name="l03464"></a>03464       lines *= 2;
<a name="l03465"></a>03465 
<a name="l03466"></a>03466    <span class="comment">/* header */</span>
<a name="l03467"></a>03467    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l03468"></a>03468    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l03469"></a>03469    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l03470"></a>03470 
<a name="l03471"></a>03471    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;MIDAS File Display %s&lt;/title&gt;&lt;/head&gt;\n&quot;</span>, path);
<a name="l03472"></a>03472    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;body&gt;&lt;form method=\&quot;GET\&quot; action=\&quot;/EL/%s\&quot;&gt;\n&quot;</span>, path);
<a name="l03473"></a>03473 
<a name="l03474"></a>03474    <span class="comment">/* define hidden field for experiment */</span>
<a name="l03475"></a>03475    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l03476"></a>03476       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=exp value=\&quot;%s\&quot;&gt;\n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l03477"></a>03477 
<a name="l03478"></a>03478    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=lines value=%d&gt;\n&quot;</span>, lines);
<a name="l03479"></a>03479 
<a name="l03480"></a>03480    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;table border=3 cellpadding=1 width=\&quot;100%%\&quot;&gt;\n&quot;</span>);
<a name="l03481"></a>03481 
<a name="l03482"></a>03482   <span class="comment">/*---- title row ----*/</span>
<a name="l03483"></a>03483 
<a name="l03484"></a>03484    size = <span class="keyword">sizeof</span>(str);
<a name="l03485"></a>03485    str[0] = 0;
<a name="l03486"></a>03486    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Name&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l03487"></a>03487 
<a name="l03488"></a>03488    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#A0A0FF&gt;MIDAS File Display &lt;code&gt;\&quot;%s\&quot;&lt;/code&gt;&quot;</span>, path);
<a name="l03489"></a>03489    <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#a9c91f81733a48f1fbc887b013ee0de14">elog_mode</a>)
<a name="l03490"></a>03490       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th bgcolor=#A0A0FF&gt;Logbook \&quot;%s\&quot;&lt;/tr&gt;\n&quot;</span>, str);
<a name="l03491"></a>03491    <span class="keywordflow">else</span>
<a name="l03492"></a>03492       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th bgcolor=#A0A0FF&gt;Experiment \&quot;%s\&quot;&lt;/tr&gt;\n&quot;</span>, str);
<a name="l03493"></a>03493 
<a name="l03494"></a>03494   <span class="comment">/*---- menu buttons ----*/</span>
<a name="l03495"></a>03495 
<a name="l03496"></a>03496    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l03497"></a>03497 
<a name="l03498"></a>03498    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;ELog\&quot;&gt;\n&quot;</span>);
<a name="l03499"></a>03499    <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a9c91f81733a48f1fbc887b013ee0de14">elog_mode</a>)
<a name="l03500"></a>03500       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;Status\&quot;&gt;\n&quot;</span>);
<a name="l03501"></a>03501 
<a name="l03502"></a>03502    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;More lines\&quot;&gt;\n&quot;</span>);
<a name="l03503"></a>03503 
<a name="l03504"></a>03504    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n\n&quot;</span>);
<a name="l03505"></a>03505 
<a name="l03506"></a>03506   <span class="comment">/*---- open file ----*/</span>
<a name="l03507"></a>03507 
<a name="l03508"></a>03508    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l03509"></a>03509    file_name[0] = 0;
<a name="l03510"></a>03510    <span class="keywordflow">if</span> (hDB &gt; 0) {
<a name="l03511"></a>03511       size = <span class="keyword">sizeof</span>(file_name);
<a name="l03512"></a>03512       memset(file_name, 0, size);
<a name="l03513"></a>03513       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Data dir&quot;</span>, file_name, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l03514"></a>03514       <span class="keywordflow">if</span> (file_name[0] != 0)
<a name="l03515"></a>03515          <span class="keywordflow">if</span> (file_name[strlen(file_name) - 1] != <a class="code" href="group__midasincludecode.html#ga0920890c442b665b0c6609fa796e9047">DIR_SEPARATOR</a>)
<a name="l03516"></a>03516             strcat(file_name, <a class="code" href="group__midasincludecode.html#ga23e72ca2d8456a971c13441bdfc4586f">DIR_SEPARATOR_STR</a>);
<a name="l03517"></a>03517    }
<a name="l03518"></a>03518    strcat(file_name, path);
<a name="l03519"></a>03519 
<a name="l03520"></a>03520    f = fopen(file_name, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l03521"></a>03521    <span class="keywordflow">if</span> (f == NULL) {
<a name="l03522"></a>03522       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;h3&gt;Cannot find file \&quot;%s\&quot;&lt;/h3&gt;\n&quot;</span>, file_name);
<a name="l03523"></a>03523       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\n&quot;</span>);
<a name="l03524"></a>03524       <span class="keywordflow">return</span>;
<a name="l03525"></a>03525    }
<a name="l03526"></a>03526 
<a name="l03527"></a>03527   <span class="comment">/*---- file contents ----*/</span>
<a name="l03528"></a>03528 
<a name="l03529"></a>03529    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2&gt;\n&quot;</span>);
<a name="l03530"></a>03530 
<a name="l03531"></a>03531    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;pre&gt;\n&quot;</span>);
<a name="l03532"></a>03532 
<a name="l03533"></a>03533    buf_size = <span class="keyword">sizeof</span>(buffer);
<a name="l03534"></a>03534 
<a name="l03535"></a>03535    <span class="comment">/* position buf_size bytes before the EOF */</span>
<a name="l03536"></a>03536    fseek(f, -(buf_size - 1), SEEK_END);
<a name="l03537"></a>03537    offset = ftell(f);
<a name="l03538"></a>03538    <span class="keywordflow">if</span> (offset != 0) {
<a name="l03539"></a>03539       <span class="comment">/* go to end of line */</span>
<a name="l03540"></a>03540       fgets(buffer, buf_size - 1, f);
<a name="l03541"></a>03541       offset = ftell(f) - offset;
<a name="l03542"></a>03542       buf_size -= offset;
<a name="l03543"></a>03543    }
<a name="l03544"></a>03544 
<a name="l03545"></a>03545    memset(buffer, 0, buf_size);
<a name="l03546"></a>03546    fread(buffer, 1, buf_size - 1, f);
<a name="l03547"></a>03547    buffer[buf_size - 1] = 0;
<a name="l03548"></a>03548    fclose(f);
<a name="l03549"></a>03549 
<a name="l03550"></a>03550    p = buffer + (buf_size - 2);
<a name="l03551"></a>03551 
<a name="l03552"></a>03552    <span class="comment">/* goto end of buffer */</span>
<a name="l03553"></a>03553    <span class="keywordflow">while</span> (p != buffer &amp;&amp; *p == 0)
<a name="l03554"></a>03554       p--;
<a name="l03555"></a>03555 
<a name="l03556"></a>03556    <span class="comment">/* strip line break */</span>
<a name="l03557"></a>03557    <span class="keywordflow">while</span> (p != buffer &amp;&amp; (*p == <span class="charliteral">&apos;\n&apos;</span> || *p == <span class="charliteral">&apos;\r&apos;</span>))
<a name="l03558"></a>03558       *(p--) = 0;
<a name="l03559"></a>03559 
<a name="l03560"></a>03560    <span class="comment">/* trim buffer so that last lines remain */</span>
<a name="l03561"></a>03561    <span class="keywordflow">for</span> (i = 0; i &lt; lines; i++) {
<a name="l03562"></a>03562       <span class="keywordflow">while</span> (p != buffer &amp;&amp; *p != <span class="charliteral">&apos;\n&apos;</span>)
<a name="l03563"></a>03563          p--;
<a name="l03564"></a>03564 
<a name="l03565"></a>03565       <span class="keywordflow">while</span> (p != buffer &amp;&amp; (*p == <span class="charliteral">&apos;\n&apos;</span> || *p == <span class="charliteral">&apos;\r&apos;</span>))
<a name="l03566"></a>03566          p--;
<a name="l03567"></a>03567    }
<a name="l03568"></a>03568    <span class="keywordflow">if</span> (p != buffer) {
<a name="l03569"></a>03569       p++;
<a name="l03570"></a>03570       <span class="keywordflow">while</span> (*p == <span class="charliteral">&apos;\n&apos;</span> || *p == <span class="charliteral">&apos;\r&apos;</span>)
<a name="l03571"></a>03571          p++;
<a name="l03572"></a>03572    }
<a name="l03573"></a>03573 
<a name="l03574"></a>03574    buf_size = (buf_size - 1) - ((<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) p - (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) buffer);
<a name="l03575"></a>03575 
<a name="l03576"></a>03576    memmove(buffer, p, buf_size);
<a name="l03577"></a>03577    buffer[buf_size] = 0;
<a name="l03578"></a>03578 
<a name="l03579"></a>03579    <a class="code" href="mhttpd_8c.html#a0c625fe56e336fc4d14a579b876b9fa8">rsputs</a>(buffer);
<a name="l03580"></a>03580 
<a name="l03581"></a>03581    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/pre&gt;\n&quot;</span>);
<a name="l03582"></a>03582 
<a name="l03583"></a>03583    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l03584"></a>03584 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a600f971ed8a8bda53571f0c1dc027cf7"></a><!-- doxytag: member="mhttpd.c::show_sc_page" ref="a600f971ed8a8bda53571f0c1dc027cf7" args="(char *path, int refresh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_sc_page </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>refresh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l04659">4659</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="lrs1821_8c_source.html#l00038">data</a>, <a class="el" href="odb_8c_source.html#l03390">db_enum_key()</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l04376">db_get_data_index()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l04727">db_set_data_index()</a>, <a class="el" href="odb_8c_source.html#l06308">db_sprintf()</a>, <a class="el" href="odb_8c_source.html#l06363">db_sprintfh()</a>, <a class="el" href="odb_8c_source.html#l06435">db_sscanf()</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="mana_8cpp_source.html#l00800">getparam()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mhttpd_8c_source.html#l04632">is_editable()</a>, <a class="el" href="midas_8h_source.html#l01320">KEY::item_size</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="odbhist_8c_source.html#l00058">k</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="mhttpd_8c_source.html#l00878">MAX_GROUPS</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00039">name</a>, <a class="el" href="midas_8h_source.html#l01316">KEY::num_values</a>, <a class="el" href="mhttpd_8c_source.html#l01356">redirect()</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l01502">show_header()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="mhttpd_8c_source.html#l00871">strlen_retbuf</a>, <a class="el" href="midas_8h_source.html#l00749">TID_KEY</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, and <a class="el" href="midas_8h_source.html#l01315">KEY::type</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04660"></a>04660 {
<a name="l04661"></a>04661    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, <a class="code" href="odbhist_8c.html#a43fa990200c3ddd47c35f151bd4d66bf">k</a>, colspan, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, n_var, i_edit, i_set;
<a name="l04662"></a>04662    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], eq_name[32], group[32], <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>[32], ref[256];
<a name="l04663"></a>04663    <span class="keywordtype">char</span> group_name[<a class="code" href="mhttpd_8c.html#a36d20ba74425036fd66f863bb89adeda">MAX_GROUPS</a>][32], <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>[256];
<a name="l04664"></a>04664    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey, hkeyeq, hkeyset, hkeynames, hkeyvar, hkeyroot;
<a name="l04665"></a>04665    <a class="code" href="structKEY.html">KEY</a> eqkey, <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>, varkey;
<a name="l04666"></a>04666    <span class="keywordtype">char</span> data_str[256], hex_str[256];
<a name="l04667"></a>04667 
<a name="l04668"></a>04668    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l04669"></a>04669 
<a name="l04670"></a>04670    <span class="comment">/* check if variable to edit */</span>
<a name="l04671"></a>04671    i_edit = -1;
<a name="l04672"></a>04672    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>), <span class="stringliteral">&quot;Edit&quot;</span>))
<a name="l04673"></a>04673       i_edit = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;index&quot;</span>));
<a name="l04674"></a>04674 
<a name="l04675"></a>04675    <span class="comment">/* check if variable to set */</span>
<a name="l04676"></a>04676    i_set = -1;
<a name="l04677"></a>04677    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;cmd&quot;</span>), <span class="stringliteral">&quot;Set&quot;</span>))
<a name="l04678"></a>04678       i_set = atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;index&quot;</span>));
<a name="l04679"></a>04679 
<a name="l04680"></a>04680    <span class="comment">/* split path into equipment and group */</span>
<a name="l04681"></a>04681    strcpy(eq_name, path);
<a name="l04682"></a>04682    strcpy(group, <span class="stringliteral">&quot;All&quot;</span>);
<a name="l04683"></a>04683    <span class="keywordflow">if</span> (strchr(eq_name, <span class="charliteral">&apos;/&apos;</span>)) {
<a name="l04684"></a>04684       strcpy(group, strchr(eq_name, <span class="charliteral">&apos;/&apos;</span>) + 1);
<a name="l04685"></a>04685       *strchr(eq_name, <span class="charliteral">&apos;/&apos;</span>) = 0;
<a name="l04686"></a>04686    }
<a name="l04687"></a>04687 
<a name="l04688"></a>04688    <span class="comment">/* check for &quot;names&quot; in settings */</span>
<a name="l04689"></a>04689    <span class="keywordflow">if</span> (eq_name[0]) {
<a name="l04690"></a>04690       sprintf(str, <span class="stringliteral">&quot;/Equipment/%s/Settings&quot;</span>, eq_name);
<a name="l04691"></a>04691       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkeyset);
<a name="l04692"></a>04692       hkeynames = 0;
<a name="l04693"></a>04693       <span class="keywordflow">if</span> (hkeyset) {
<a name="l04694"></a>04694          <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l04695"></a>04695             <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyset, i, &amp;hkeynames);
<a name="l04696"></a>04696 
<a name="l04697"></a>04697             <span class="keywordflow">if</span> (!hkeynames)
<a name="l04698"></a>04698                <span class="keywordflow">break</span>;
<a name="l04699"></a>04699 
<a name="l04700"></a>04700             <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkeynames, &amp;key);
<a name="l04701"></a>04701 
<a name="l04702"></a>04702             <span class="keywordflow">if</span> (strncmp(key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, <span class="stringliteral">&quot;Names&quot;</span>, 5) == 0)
<a name="l04703"></a>04703                <span class="keywordflow">break</span>;
<a name="l04704"></a>04704          }
<a name="l04705"></a>04705 
<a name="l04706"></a>04706       }
<a name="l04707"></a>04707 
<a name="l04708"></a>04708       <span class="comment">/* redirect if no names found */</span>
<a name="l04709"></a>04709       <span class="keywordflow">if</span> (!hkeyset || !hkeynames) {
<a name="l04710"></a>04710          <span class="comment">/* redirect */</span>
<a name="l04711"></a>04711          sprintf(str, <span class="stringliteral">&quot;Equipment/%s/Variables&quot;</span>, eq_name);
<a name="l04712"></a>04712          <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(str);
<a name="l04713"></a>04713          <span class="keywordflow">return</span>;
<a name="l04714"></a>04714       }
<a name="l04715"></a>04715    }
<a name="l04716"></a>04716 
<a name="l04717"></a>04717    sprintf(str, <span class="stringliteral">&quot;SC/%s/%s&quot;</span>, eq_name, group);
<a name="l04718"></a>04718    <a class="code" href="mhttpd_8c.html#ae5fb6c731656613ead122d173a8ef7a8">show_header</a>(hDB, <span class="stringliteral">&quot;MIDAS slow control&quot;</span>, <span class="stringliteral">&quot;GET&quot;</span>, str, 8, i_edit == -1 ? refresh : 0);
<a name="l04719"></a>04719 
<a name="l04720"></a>04720   <span class="comment">/*---- menu buttons ----*/</span>
<a name="l04721"></a>04721 
<a name="l04722"></a>04722    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=15 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l04723"></a>04723 
<a name="l04724"></a>04724    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=ODB&gt;\n&quot;</span>);
<a name="l04725"></a>04725    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Status&gt;\n&quot;</span>);
<a name="l04726"></a>04726    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Help&gt;\n&quot;</span>);
<a name="l04727"></a>04727    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n\n&quot;</span>);
<a name="l04728"></a>04728 
<a name="l04729"></a>04729   <span class="comment">/*---- enumerate SC equipment ----*/</span>
<a name="l04730"></a>04730 
<a name="l04731"></a>04731    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=15 bgcolor=#FFFF00&gt;&lt;i&gt;Equipment:&lt;/i&gt; &amp;nbsp;&amp;nbsp;\n&quot;</span>);
<a name="l04732"></a>04732 
<a name="l04733"></a>04733    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Equipment&quot;</span>, &amp;hkey);
<a name="l04734"></a>04734    <span class="keywordflow">if</span> (hkey)
<a name="l04735"></a>04735       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l04736"></a>04736          <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkey, i, &amp;hkeyeq);
<a name="l04737"></a>04737 
<a name="l04738"></a>04738          <span class="keywordflow">if</span> (!hkeyeq)
<a name="l04739"></a>04739             <span class="keywordflow">break</span>;
<a name="l04740"></a>04740 
<a name="l04741"></a>04741          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkeyeq, &amp;eqkey);
<a name="l04742"></a>04742 
<a name="l04743"></a>04743          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hkeyeq, <span class="stringliteral">&quot;Settings&quot;</span>, &amp;hkeyset);
<a name="l04744"></a>04744          <span class="keywordflow">if</span> (hkeyset) {
<a name="l04745"></a>04745             <span class="keywordflow">for</span> (j = 0;; j++) {
<a name="l04746"></a>04746                <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyset, j, &amp;hkeynames);
<a name="l04747"></a>04747 
<a name="l04748"></a>04748                <span class="keywordflow">if</span> (!hkeynames)
<a name="l04749"></a>04749                   <span class="keywordflow">break</span>;
<a name="l04750"></a>04750 
<a name="l04751"></a>04751                <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkeynames, &amp;key);
<a name="l04752"></a>04752 
<a name="l04753"></a>04753                <span class="keywordflow">if</span> (strncmp(key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, <span class="stringliteral">&quot;Names&quot;</span>, 5) == 0) {
<a name="l04754"></a>04754                   <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(eq_name, eqkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>))
<a name="l04755"></a>04755                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;b&gt;%s&lt;/b&gt; &amp;nbsp;&amp;nbsp;&quot;</span>, eqkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l04756"></a>04756                   <span class="keywordflow">else</span> {
<a name="l04757"></a>04757                      <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l04758"></a>04758                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/SC/%s?exp=%s\&quot;&gt;%s&lt;/a&gt; &amp;nbsp;&amp;nbsp;&quot;</span>,
<a name="l04759"></a>04759                                  eqkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, eqkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l04760"></a>04760                      <span class="keywordflow">else</span>
<a name="l04761"></a>04761                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/SC/%s?\&quot;&gt;%s&lt;/a&gt; &amp;nbsp;&amp;nbsp;&quot;</span>, eqkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>,
<a name="l04762"></a>04762                                  eqkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l04763"></a>04763                   }
<a name="l04764"></a>04764                   <span class="keywordflow">break</span>;
<a name="l04765"></a>04765                }
<a name="l04766"></a>04766             }
<a name="l04767"></a>04767          }
<a name="l04768"></a>04768       }
<a name="l04769"></a>04769    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l04770"></a>04770 
<a name="l04771"></a>04771    <span class="keywordflow">if</span> (!eq_name[0]) {
<a name="l04772"></a>04772       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>);
<a name="l04773"></a>04773       <span class="keywordflow">return</span>;
<a name="l04774"></a>04774    }
<a name="l04775"></a>04775 
<a name="l04776"></a>04776    <span class="comment">/*---- display SC ----*/</span>
<a name="l04777"></a>04777 
<a name="l04778"></a>04778    n_var = 0;
<a name="l04779"></a>04779    sprintf(str, <span class="stringliteral">&quot;/Equipment/%s/Settings/Names&quot;</span>, eq_name);
<a name="l04780"></a>04780    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkey);
<a name="l04781"></a>04781 
<a name="l04782"></a>04782    <span class="keywordflow">if</span> (hkey) {
<a name="l04783"></a>04783       
<a name="l04784"></a>04784       <span class="comment">/*---- single name array ----*/</span>
<a name="l04785"></a>04785       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=15 bgcolor=#FFFFA0&gt;&lt;i&gt;Groups:&lt;/i&gt; &amp;nbsp;&amp;nbsp;&quot;</span>);
<a name="l04786"></a>04786 
<a name="l04787"></a>04787       <span class="comment">/* &quot;all&quot; group */</span>
<a name="l04788"></a>04788       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(group, <span class="stringliteral">&quot;All&quot;</span>))
<a name="l04789"></a>04789          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;b&gt;All&lt;/b&gt; &amp;nbsp;&amp;nbsp;&quot;</span>);
<a name="l04790"></a>04790       <span class="keywordflow">else</span> {
<a name="l04791"></a>04791          <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l04792"></a>04792             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/SC/%s/All?exp=%s\&quot;&gt;All&lt;/a&gt; &amp;nbsp;&amp;nbsp;&quot;</span>, eq_name,
<a name="l04793"></a>04793                      <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l04794"></a>04794          <span class="keywordflow">else</span>
<a name="l04795"></a>04795             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/SC/%s/All?\&quot;&gt;All&lt;/a&gt; &amp;nbsp;&amp;nbsp;&quot;</span>, eq_name);
<a name="l04796"></a>04796       }
<a name="l04797"></a>04797 
<a name="l04798"></a>04798       <span class="comment">/* collect groups */</span>
<a name="l04799"></a>04799 
<a name="l04800"></a>04800       memset(group_name, 0, <span class="keyword">sizeof</span>(group_name));
<a name="l04801"></a>04801       <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l04802"></a>04802 
<a name="l04803"></a>04803       <span class="keywordflow">for</span> (i = 0; i &lt; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; i++) {
<a name="l04804"></a>04804          size = <span class="keyword">sizeof</span>(str);
<a name="l04805"></a>04805          <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hkey, str, &amp;size, i, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l04806"></a>04806 
<a name="l04807"></a>04807          <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;%&apos;</span>)) {
<a name="l04808"></a>04808             *strchr(str, <span class="charliteral">&apos;%&apos;</span>) = 0;
<a name="l04809"></a>04809             <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="mhttpd_8c.html#a36d20ba74425036fd66f863bb89adeda">MAX_GROUPS</a>; j++) {
<a name="l04810"></a>04810                <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(group_name[j], str) || group_name[j][0] == 0)
<a name="l04811"></a>04811                   <span class="keywordflow">break</span>;
<a name="l04812"></a>04812             }
<a name="l04813"></a>04813             <span class="keywordflow">if</span> (group_name[j][0] == 0)
<a name="l04814"></a>04814                strcpy(group_name[j], str);
<a name="l04815"></a>04815          }
<a name="l04816"></a>04816       }
<a name="l04817"></a>04817 
<a name="l04818"></a>04818       <span class="keywordflow">for</span> (i = 0; i &lt; MAX_GROUPS &amp;&amp; group_name[i][0]; i++) {
<a name="l04819"></a>04819          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(group_name[i], group))
<a name="l04820"></a>04820             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;b&gt;%s&lt;/b&gt; &amp;nbsp;&amp;nbsp;&quot;</span>, group_name[i]);
<a name="l04821"></a>04821          <span class="keywordflow">else</span> {
<a name="l04822"></a>04822             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l04823"></a>04823                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/SC/%s/%s?exp=%s\&quot;&gt;%s&lt;/a&gt; &amp;nbsp;&amp;nbsp;&quot;</span>,
<a name="l04824"></a>04824                         eq_name, group_name[i], <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, group_name[i]);
<a name="l04825"></a>04825             <span class="keywordflow">else</span>
<a name="l04826"></a>04826                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/SC/%s/%s?\&quot;&gt;%s&lt;/a&gt; &amp;nbsp;&amp;nbsp;&quot;</span>,
<a name="l04827"></a>04827                         eq_name, group_name[i], group_name[i]);
<a name="l04828"></a>04828          }
<a name="l04829"></a>04829       }
<a name="l04830"></a>04830       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l04831"></a>04831 
<a name="l04832"></a>04832       <span class="comment">/* count variables */</span>
<a name="l04833"></a>04833       sprintf(str, <span class="stringliteral">&quot;/Equipment/%s/Variables&quot;</span>, eq_name);
<a name="l04834"></a>04834       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkeyvar);
<a name="l04835"></a>04835       <span class="keywordflow">if</span> (!hkeyvar) {
<a name="l04836"></a>04836          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>);
<a name="l04837"></a>04837          <span class="keywordflow">return</span>;
<a name="l04838"></a>04838       }
<a name="l04839"></a>04839       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l04840"></a>04840          <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyvar, i, &amp;hkey);
<a name="l04841"></a>04841          <span class="keywordflow">if</span> (!hkey)
<a name="l04842"></a>04842             <span class="keywordflow">break</span>;
<a name="l04843"></a>04843       }
<a name="l04844"></a>04844 
<a name="l04845"></a>04845       <span class="keywordflow">if</span> (i == 0 || i &gt; 15) {
<a name="l04846"></a>04846          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>);
<a name="l04847"></a>04847          <span class="keywordflow">return</span>;
<a name="l04848"></a>04848       }
<a name="l04849"></a>04849 
<a name="l04850"></a>04850       <span class="comment">/* title row */</span>
<a name="l04851"></a>04851       colspan = 15 - i;
<a name="l04852"></a>04852       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th colspan=%d&gt;Names&quot;</span>, colspan);
<a name="l04853"></a>04853 
<a name="l04854"></a>04854       <span class="comment">/* display entries for this group */</span>
<a name="l04855"></a>04855       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l04856"></a>04856          <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyvar, i, &amp;hkey);
<a name="l04857"></a>04857 
<a name="l04858"></a>04858          <span class="keywordflow">if</span> (!hkey)
<a name="l04859"></a>04859             <span class="keywordflow">break</span>;
<a name="l04860"></a>04860 
<a name="l04861"></a>04861          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l04862"></a>04862          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th&gt;%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l04863"></a>04863       }
<a name="l04864"></a>04864 
<a name="l04865"></a>04865       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l04866"></a>04866 
<a name="l04867"></a>04867       <span class="comment">/* data for current group */</span>
<a name="l04868"></a>04868       sprintf(str, <span class="stringliteral">&quot;/Equipment/%s/Settings/Names&quot;</span>, eq_name);
<a name="l04869"></a>04869       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkeyset);
<a name="l04870"></a>04870       <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkeyset, &amp;key);
<a name="l04871"></a>04871       <span class="keywordflow">for</span> (i = 0; i &lt; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; i++) {
<a name="l04872"></a>04872          size = <span class="keyword">sizeof</span>(str);
<a name="l04873"></a>04873          <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hkeyset, str, &amp;size, i, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l04874"></a>04874 
<a name="l04875"></a>04875          name[0] = 0;
<a name="l04876"></a>04876          <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;%&apos;</span>)) {
<a name="l04877"></a>04877             *strchr(str, <span class="charliteral">&apos;%&apos;</span>) = 0;
<a name="l04878"></a>04878             strcpy(name, str + strlen(str) + 1);
<a name="l04879"></a>04879          } <span class="keywordflow">else</span>
<a name="l04880"></a>04880             strcpy(name, str);
<a name="l04881"></a>04881 
<a name="l04882"></a>04882          <span class="keywordflow">if</span> (!<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(group, <span class="stringliteral">&quot;All&quot;</span>) &amp;&amp; !<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, group))
<a name="l04883"></a>04883             <span class="keywordflow">continue</span>;
<a name="l04884"></a>04884 
<a name="l04885"></a>04885          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=%d&gt;%s&quot;</span>, colspan, name);
<a name="l04886"></a>04886 
<a name="l04887"></a>04887          <span class="keywordflow">for</span> (j = 0;; j++) {
<a name="l04888"></a>04888             <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyvar, j, &amp;hkey);
<a name="l04889"></a>04889             <span class="keywordflow">if</span> (!hkey)
<a name="l04890"></a>04890                <span class="keywordflow">break</span>;
<a name="l04891"></a>04891             <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;varkey);
<a name="l04892"></a>04892 
<a name="l04893"></a>04893             size = <span class="keyword">sizeof</span>(data);
<a name="l04894"></a>04894             <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hkey, data, &amp;size, i, varkey.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l04895"></a>04895             <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(str, data, varkey.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, varkey.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l04896"></a>04896 
<a name="l04897"></a>04897             <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#a085b231653bb8eb34d8b17f5a77f8f9c">is_editable</a>(eq_name, varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>)) {
<a name="l04898"></a>04898                <span class="keywordflow">if</span> (n_var == i_set) {
<a name="l04899"></a>04899                   <span class="comment">/* set value */</span>
<a name="l04900"></a>04900                   strcpy(str, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;value&quot;</span>));
<a name="l04901"></a>04901                   <a class="code" href="group__msectionh.html#ga7b3d26e7b258c093ad999bf1286bb871">db_sscanf</a>(str, data, &amp;size, 0, varkey.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l04902"></a>04902                   <a class="code" href="group__msectionh.html#ga18f5e7743545b06fca4f3d5ce9889034">db_set_data_index</a>(hDB, hkey, data, size, i, varkey.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l04903"></a>04903 
<a name="l04904"></a>04904                   <span class="comment">/* redirect (so that &apos;reload&apos; does not reset value) */</span>
<a name="l04905"></a>04905                   <a class="code" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a> = 0;
<a name="l04906"></a>04906                   sprintf(str, <span class="stringliteral">&quot;SC/%s/%s&quot;</span>, eq_name, group);
<a name="l04907"></a>04907                   <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(str);
<a name="l04908"></a>04908                   <span class="keywordflow">return</span>;
<a name="l04909"></a>04909                }
<a name="l04910"></a>04910                <span class="keywordflow">if</span> (n_var == i_edit) {
<a name="l04911"></a>04911                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l04912"></a>04912                       (<span class="stringliteral">&quot;&lt;td align=center&gt;&lt;input type=text size=10 maxlenth=80 name=value value=\&quot;%s\&quot;&gt;\n&quot;</span>,
<a name="l04913"></a>04913                        str);
<a name="l04914"></a>04914                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit size=20 name=cmd value=Set&gt;\n&quot;</span>);
<a name="l04915"></a>04915                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=index value=%d&gt;\n&quot;</span>, i_edit);
<a name="l04916"></a>04916                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=cmd value=Set&gt;\n&quot;</span>);
<a name="l04917"></a>04917                   n_var++;
<a name="l04918"></a>04918                } <span class="keywordflow">else</span> {
<a name="l04919"></a>04919                   <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l04920"></a>04920                      sprintf(ref, <span class="stringliteral">&quot;/SC/%s/%s?cmd=Edit&amp;index=%d&amp;exp=%s&quot;</span>,
<a name="l04921"></a>04921                              eq_name, group, n_var, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l04922"></a>04922                   <span class="keywordflow">else</span>
<a name="l04923"></a>04923                      sprintf(ref, <span class="stringliteral">&quot;/SC/%s/%s?cmd=Edit&amp;index=%d&quot;</span>, eq_name, group, n_var);
<a name="l04924"></a>04924 
<a name="l04925"></a>04925                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;&lt;a href=\&quot;%s\&quot;&gt;%s&lt;/a&gt;&quot;</span>, ref, str);
<a name="l04926"></a>04926                   n_var++;
<a name="l04927"></a>04927                }
<a name="l04928"></a>04928             } <span class="keywordflow">else</span>
<a name="l04929"></a>04929                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;%s&quot;</span>, str);
<a name="l04930"></a>04930          }
<a name="l04931"></a>04931 
<a name="l04932"></a>04932          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l04933"></a>04933       }
<a name="l04934"></a>04934    } <span class="keywordflow">else</span> {
<a name="l04935"></a>04935       <span class="comment">/*---- multiple name arrays ----*/</span>
<a name="l04936"></a>04936       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=15 bgcolor=#FFFFA0&gt;&lt;i&gt;Groups:&lt;/i&gt; &quot;</span>);
<a name="l04937"></a>04937 
<a name="l04938"></a>04938       <span class="comment">/* &quot;all&quot; group */</span>
<a name="l04939"></a>04939       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(group, <span class="stringliteral">&quot;All&quot;</span>))
<a name="l04940"></a>04940          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;b&gt;All&lt;/b&gt; &amp;nbsp;&amp;nbsp;&quot;</span>);
<a name="l04941"></a>04941       <span class="keywordflow">else</span> {
<a name="l04942"></a>04942          <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l04943"></a>04943             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/SC/%s?exp=%s\&quot;&gt;All&lt;/a&gt; &amp;nbsp;&amp;nbsp;&quot;</span>, eq_name, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l04944"></a>04944          <span class="keywordflow">else</span>
<a name="l04945"></a>04945             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/SC/%s?\&quot;&gt;All&lt;/a&gt; &amp;nbsp;&amp;nbsp;&quot;</span>, eq_name);
<a name="l04946"></a>04946       }
<a name="l04947"></a>04947 
<a name="l04948"></a>04948       <span class="comment">/* groups from Variables tree */</span>
<a name="l04949"></a>04949 
<a name="l04950"></a>04950       sprintf(str, <span class="stringliteral">&quot;/Equipment/%s/Variables&quot;</span>, eq_name);
<a name="l04951"></a>04951       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkeyvar);
<a name="l04952"></a>04952 
<a name="l04953"></a>04953       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l04954"></a>04954          <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyvar, i, &amp;hkey);
<a name="l04955"></a>04955 
<a name="l04956"></a>04956          <span class="keywordflow">if</span> (!hkey)
<a name="l04957"></a>04957             <span class="keywordflow">break</span>;
<a name="l04958"></a>04958 
<a name="l04959"></a>04959          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l04960"></a>04960 
<a name="l04961"></a>04961          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, group))
<a name="l04962"></a>04962             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;b&gt;%s&lt;/b&gt; &amp;nbsp;&amp;nbsp;&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l04963"></a>04963          <span class="keywordflow">else</span> {
<a name="l04964"></a>04964             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l04965"></a>04965                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/SC/%s/%s?exp=%s\&quot;&gt;%s&lt;/a&gt; &amp;nbsp;&amp;nbsp;&quot;</span>,
<a name="l04966"></a>04966                         eq_name, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l04967"></a>04967             <span class="keywordflow">else</span>
<a name="l04968"></a>04968                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;/SC/%s/%s?\&quot;&gt;%s&lt;/a&gt; &amp;nbsp;&amp;nbsp;&quot;</span>,
<a name="l04969"></a>04969                         eq_name, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l04970"></a>04970          }
<a name="l04971"></a>04971       }
<a name="l04972"></a>04972 
<a name="l04973"></a>04973       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l04974"></a>04974 
<a name="l04975"></a>04975       <span class="comment">/* enumerate variable arrays */</span>
<a name="l04976"></a>04976 
<a name="l04977"></a>04977       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l04978"></a>04978          <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyvar, i, &amp;hkey);
<a name="l04979"></a>04979 
<a name="l04980"></a>04980          <span class="keywordflow">if</span> (!hkey)
<a name="l04981"></a>04981             <span class="keywordflow">break</span>;
<a name="l04982"></a>04982 
<a name="l04983"></a>04983          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;varkey);
<a name="l04984"></a>04984 
<a name="l04985"></a>04985          <span class="keywordflow">if</span> (!<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(group, <span class="stringliteral">&quot;All&quot;</span>) &amp;&amp; !<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, group))
<a name="l04986"></a>04986             <span class="keywordflow">continue</span>;
<a name="l04987"></a>04987 
<a name="l04988"></a>04988          <span class="comment">/* title row */</span>
<a name="l04989"></a>04989          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th colspan=9&gt;Names&lt;th&gt;%s&lt;/tr&gt;\n&quot;</span>, varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l04990"></a>04990 
<a name="l04991"></a>04991 
<a name="l04992"></a>04992          <span class="keywordflow">if</span> (varkey.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#ga15ae151ae0b7588b3327bd8451d9bcb8">TID_KEY</a>) {
<a name="l04993"></a>04993             hkeyroot = hkey;
<a name="l04994"></a>04994 
<a name="l04995"></a>04995             <span class="comment">/* enumerate subkeys */</span>
<a name="l04996"></a>04996             <span class="keywordflow">for</span> (j = 0;; j++) {
<a name="l04997"></a>04997                <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkeyroot, j, &amp;hkey);
<a name="l04998"></a>04998                <span class="keywordflow">if</span> (!hkey)
<a name="l04999"></a>04999                   <span class="keywordflow">break</span>;
<a name="l05000"></a>05000                <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l05001"></a>05001 
<a name="l05002"></a>05002                <span class="keywordflow">if</span> (key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#ga15ae151ae0b7588b3327bd8451d9bcb8">TID_KEY</a>) {
<a name="l05003"></a>05003                   <span class="comment">/* for keys, don&apos;t display data value */</span>
<a name="l05004"></a>05004                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=9&gt;%s&lt;br&gt;&lt;/tr&gt;\n&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l05005"></a>05005                } <span class="keywordflow">else</span> {
<a name="l05006"></a>05006                   <span class="comment">/* display single value */</span>
<a name="l05007"></a>05007                   <span class="keywordflow">if</span> (key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a> == 1) {
<a name="l05008"></a>05008                      size = <span class="keyword">sizeof</span>(data);
<a name="l05009"></a>05009                      <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, data, &amp;size, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05010"></a>05010                      <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(data_str, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05011"></a>05011                      <a class="code" href="group__msectionh.html#gacf595105fe1399620f51c3af5bfb54b4">db_sprintfh</a>(hex_str, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05012"></a>05012 
<a name="l05013"></a>05013                      <span class="keywordflow">if</span> (data_str[0] == 0 || <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(data_str, <span class="stringliteral">&quot;&lt;NULL&gt;&quot;</span>)) {
<a name="l05014"></a>05014                         strcpy(data_str, <span class="stringliteral">&quot;(empty)&quot;</span>);
<a name="l05015"></a>05015                         hex_str[0] = 0;
<a name="l05016"></a>05016                      }
<a name="l05017"></a>05017 
<a name="l05018"></a>05018                      <span class="keywordflow">if</span> (strcmp(data_str, hex_str) != 0 &amp;&amp; hex_str[0])
<a name="l05019"></a>05019                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05020"></a>05020                             (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=9&gt;%s&lt;td align=center&gt;%s (%s)&lt;br&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l05021"></a>05021                              key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, data_str, hex_str);
<a name="l05022"></a>05022                      <span class="keywordflow">else</span>
<a name="l05023"></a>05023                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=9&gt;%s&lt;td align=center&gt;%s&lt;br&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l05024"></a>05024                                  key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, data_str);
<a name="l05025"></a>05025                   } <span class="keywordflow">else</span> {
<a name="l05026"></a>05026                      <span class="comment">/* display first value */</span>
<a name="l05027"></a>05027                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=9 rowspan=%d&gt;%s\n&quot;</span>, key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>,
<a name="l05028"></a>05028                               key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l05029"></a>05029 
<a name="l05030"></a>05030                      <span class="keywordflow">for</span> (k = 0; k &lt; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; k++) {
<a name="l05031"></a>05031                         size = <span class="keyword">sizeof</span>(data);
<a name="l05032"></a>05032                         <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hkey, data, &amp;size, k, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05033"></a>05033                         <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(data_str, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05034"></a>05034                         <a class="code" href="group__msectionh.html#gacf595105fe1399620f51c3af5bfb54b4">db_sprintfh</a>(hex_str, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05035"></a>05035 
<a name="l05036"></a>05036                         <span class="keywordflow">if</span> (data_str[0] == 0 || <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(data_str, <span class="stringliteral">&quot;&lt;NULL&gt;&quot;</span>)) {
<a name="l05037"></a>05037                            strcpy(data_str, <span class="stringliteral">&quot;(empty)&quot;</span>);
<a name="l05038"></a>05038                            hex_str[0] = 0;
<a name="l05039"></a>05039                         }
<a name="l05040"></a>05040 
<a name="l05041"></a>05041                         <span class="keywordflow">if</span> (k &gt; 0)
<a name="l05042"></a>05042                            <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>);
<a name="l05043"></a>05043 
<a name="l05044"></a>05044                         <span class="keywordflow">if</span> (strcmp(data_str, hex_str) != 0 &amp;&amp; hex_str[0])
<a name="l05045"></a>05045                            <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td&gt;[%d] %s (%s)&lt;br&gt;&lt;/tr&gt;\n&quot;</span>, k, data_str, hex_str);
<a name="l05046"></a>05046                         <span class="keywordflow">else</span>
<a name="l05047"></a>05047                            <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td&gt;[%d] %s&lt;br&gt;&lt;/tr&gt;\n&quot;</span>, k, data_str);
<a name="l05048"></a>05048                      }
<a name="l05049"></a>05049                   }
<a name="l05050"></a>05050                }
<a name="l05051"></a>05051             }
<a name="l05052"></a>05052          } <span class="keywordflow">else</span> {
<a name="l05053"></a>05053             <span class="comment">/* data for current group */</span>
<a name="l05054"></a>05054             sprintf(str, <span class="stringliteral">&quot;/Equipment/%s/Settings/Names %s&quot;</span>, eq_name, varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l05055"></a>05055             <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkeyset);
<a name="l05056"></a>05056 
<a name="l05057"></a>05057             <span class="keywordflow">if</span> (varkey.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a> &gt; 1000)
<a name="l05058"></a>05058                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=9&gt;%s&lt;td align=center&gt;&lt;i&gt;... %d values ...&lt;/i&gt;&quot;</span>,
<a name="l05059"></a>05059                         varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, varkey.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>);
<a name="l05060"></a>05060             <span class="keywordflow">else</span> {
<a name="l05061"></a>05061                <span class="keywordflow">for</span> (j = 0; j &lt; varkey.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; j++) {
<a name="l05062"></a>05062                   <span class="keywordflow">if</span> (hkeyset) {
<a name="l05063"></a>05063                      size = <span class="keyword">sizeof</span>(name);
<a name="l05064"></a>05064                      <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hkeyset, name, &amp;size, j, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l05065"></a>05065                   } <span class="keywordflow">else</span>
<a name="l05066"></a>05066                      sprintf(name, <span class="stringliteral">&quot;%s[%d]&quot;</span>, varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, j);
<a name="l05067"></a>05067 
<a name="l05068"></a>05068                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=9&gt;%s&quot;</span>, name);
<a name="l05069"></a>05069 
<a name="l05070"></a>05070                   size = <span class="keyword">sizeof</span>(data);
<a name="l05071"></a>05071                   <a class="code" href="group__msectionh.html#gae5fdb22d30254c06d074236a1f93b0d6">db_get_data_index</a>(hDB, hkey, data, &amp;size, j, varkey.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05072"></a>05072                   <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(str, data, varkey.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 0, varkey.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05073"></a>05073 
<a name="l05074"></a>05074                   <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#a085b231653bb8eb34d8b17f5a77f8f9c">is_editable</a>(eq_name, varkey.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>)) {
<a name="l05075"></a>05075                      <span class="keywordflow">if</span> (n_var == i_set) {
<a name="l05076"></a>05076                         <span class="comment">/* set value */</span>
<a name="l05077"></a>05077                         strcpy(str, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;value&quot;</span>));
<a name="l05078"></a>05078                         <a class="code" href="group__msectionh.html#ga7b3d26e7b258c093ad999bf1286bb871">db_sscanf</a>(str, data, &amp;size, 0, varkey.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05079"></a>05079                         <a class="code" href="group__msectionh.html#ga18f5e7743545b06fca4f3d5ce9889034">db_set_data_index</a>(hDB, hkey, data, size, j, varkey.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05080"></a>05080 
<a name="l05081"></a>05081                         <span class="comment">/* redirect (so that &apos;reload&apos; does not reset value) */</span>
<a name="l05082"></a>05082                         <a class="code" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a> = 0;
<a name="l05083"></a>05083                         sprintf(str, <span class="stringliteral">&quot;SC/%s/%s&quot;</span>, eq_name, group);
<a name="l05084"></a>05084                         <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(str);
<a name="l05085"></a>05085                         <span class="keywordflow">return</span>;
<a name="l05086"></a>05086                      }
<a name="l05087"></a>05087                      <span class="keywordflow">if</span> (n_var == i_edit) {
<a name="l05088"></a>05088                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05089"></a>05089                             (<span class="stringliteral">&quot;&lt;td align=center&gt;&lt;input type=text size=10 maxlenth=80 name=value value=\&quot;%s\&quot;&gt;\n&quot;</span>,
<a name="l05090"></a>05090                              str);
<a name="l05091"></a>05091                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit size=20 name=cmd value=Set&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l05092"></a>05092                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=index value=%d&gt;\n&quot;</span>, i_edit);
<a name="l05093"></a>05093                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=cmd value=Set&gt;\n&quot;</span>);
<a name="l05094"></a>05094                         n_var++;
<a name="l05095"></a>05095                      } <span class="keywordflow">else</span> {
<a name="l05096"></a>05096                         <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l05097"></a>05097                            sprintf(ref, <span class="stringliteral">&quot;/SC/%s/%s?cmd=Edit&amp;index=%d&amp;exp=%s&quot;</span>,
<a name="l05098"></a>05098                                    eq_name, group, n_var, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l05099"></a>05099                         <span class="keywordflow">else</span>
<a name="l05100"></a>05100                            sprintf(ref, <span class="stringliteral">&quot;/SC/%s/%s?cmd=Edit&amp;index=%d&quot;</span>,
<a name="l05101"></a>05101                                    eq_name, group, n_var);
<a name="l05102"></a>05102 
<a name="l05103"></a>05103                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;&lt;a href=\&quot;%s\&quot;&gt;%s&lt;/a&gt;&quot;</span>, ref, str);
<a name="l05104"></a>05104                         n_var++;
<a name="l05105"></a>05105                      }
<a name="l05106"></a>05106 
<a name="l05107"></a>05107                   } <span class="keywordflow">else</span>
<a name="l05108"></a>05108                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;%s&quot;</span>, str);
<a name="l05109"></a>05109                }
<a name="l05110"></a>05110             }
<a name="l05111"></a>05111 
<a name="l05112"></a>05112             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l05113"></a>05113          }
<a name="l05114"></a>05114       }
<a name="l05115"></a>05115    }
<a name="l05116"></a>05116 
<a name="l05117"></a>05117    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;\r\n&quot;</span>);
<a name="l05118"></a>05118 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9ff6a4fe23af7c7a7a09b39837d2cae1"></a><!-- doxytag: member="mhttpd.c::show_set_page" ref="a9ff6a4fe23af7c7a7a09b39837d2cae1" args="(char *enc_path, char *dec_path, char *group, int index, char *value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_set_page </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>enc_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dec_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>group</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l05983">5983</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="lrs1821_8c_source.html#l00038">data</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="midas_8h_source.html#l01018">DB_NO_ACCESS</a>, <a class="el" href="odb_8c_source.html#l04503">db_set_data()</a>, <a class="el" href="odb_8c_source.html#l04727">db_set_data_index()</a>, <a class="el" href="odb_8c_source.html#l06308">db_sprintf()</a>, <a class="el" href="odb_8c_source.html#l06435">db_sscanf()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="mana_8cpp_source.html#l00800">getparam()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mhttpd_8c_source.html#l01089">isparam()</a>, <a class="el" href="midas_8h_source.html#l01320">KEY::item_size</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="midas_8h_source.html#l01316">KEY::num_values</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="mhttpd_8c_source.html#l01356">redirect()</a>, <a class="el" href="midas_8c_source.html#l08170">rpc_tid_name()</a>, <a class="el" href="midas_8c_source.html#l08162">rpc_tid_size()</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l00959">rsputs()</a>, <a class="el" href="mhttpd_8c_source.html#l01502">show_header()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="mhttpd_8c_source.html#l00882">TEXT_SIZE</a>, <a class="el" href="midas_8h_source.html#l00750">TID_LINK</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="midas_8h_source.html#l01315">KEY::type</a>, and <a class="el" href="mhttpd_8c_source.html#l01153">urlEncode()</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05984"></a>05984 {
<a name="l05985"></a>05985    <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l05986"></a>05986    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey;
<a name="l05987"></a>05987    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l05988"></a>05988    <span class="keywordtype">char</span> data_str[<a class="code" href="mhttpd_8c.html#afb6f36d91ffbf947cfa3f1114ca79764">TEXT_SIZE</a>], <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>, eq_name[<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>];
<a name="l05989"></a>05989    <span class="keywordtype">char</span> <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>[<a class="code" href="mhttpd_8c.html#afb6f36d91ffbf947cfa3f1114ca79764">TEXT_SIZE</a>];
<a name="l05990"></a>05990 
<a name="l05991"></a>05991    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l05992"></a>05992 
<a name="l05993"></a>05993    <span class="comment">/* show set page if no value is given */</span>
<a name="l05994"></a>05994    <span class="keywordflow">if</span> (!<a class="code" href="mhttpd_8c.html#a4879491abfc24dbd22963a8b33f3f6ac">isparam</a>(<span class="stringliteral">&quot;value&quot;</span>) &amp;&amp; !*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;text&quot;</span>)) {
<a name="l05995"></a>05995       status = <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, dec_path, &amp;hkey);
<a name="l05996"></a>05996       <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l05997"></a>05997          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Error: cannot find key %s&lt;P&gt;\n&quot;</span>, dec_path);
<a name="l05998"></a>05998          <span class="keywordflow">return</span>;
<a name="l05999"></a>05999       }
<a name="l06000"></a>06000       <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l06001"></a>06001 
<a name="l06002"></a>06002       <a class="code" href="mhttpd_8c.html#ae5fb6c731656613ead122d173a8ef7a8">show_header</a>(hDB, <span class="stringliteral">&quot;Set value&quot;</span>, <span class="stringliteral">&quot;POST&quot;</span>, enc_path, 1, 0);
<a name="l06003"></a>06003 
<a name="l06004"></a>06004       <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> &gt; 0)
<a name="l06005"></a>06005          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=index value=\&quot;%d\&quot;&gt;\n&quot;</span>, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>);
<a name="l06006"></a>06006       <span class="keywordflow">else</span>
<a name="l06007"></a>06007          <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> = 0;
<a name="l06008"></a>06008 
<a name="l06009"></a>06009       <span class="keywordflow">if</span> (group[0])
<a name="l06010"></a>06010          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=group value=\&quot;%s\&quot;&gt;\n&quot;</span>, group);
<a name="l06011"></a>06011 
<a name="l06012"></a>06012       strcpy(data_str, <a class="code" href="group__msectionh.html#ga94fb45fa1cdd442e964ebe32c7668976">rpc_tid_name</a>(key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>));
<a name="l06013"></a>06013       <span class="keywordflow">if</span> (key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a> &gt; 1) {
<a name="l06014"></a>06014          sprintf(str, <span class="stringliteral">&quot;[%d]&quot;</span>, key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>);
<a name="l06015"></a>06015          strcat(data_str, str);
<a name="l06016"></a>06016 
<a name="l06017"></a>06017          sprintf(str, <span class="stringliteral">&quot;%s[%d]&quot;</span>, dec_path, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>);
<a name="l06018"></a>06018       } <span class="keywordflow">else</span>
<a name="l06019"></a>06019          strcpy(str, dec_path);
<a name="l06020"></a>06020 
<a name="l06021"></a>06021       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#A0A0FF colspan=2&gt;Set new value - type = %s&lt;/tr&gt;\n&quot;</span>,
<a name="l06022"></a>06022                data_str);
<a name="l06023"></a>06023       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td bgcolor=#FFFF00&gt;%s&lt;td&gt;\n&quot;</span>, str);
<a name="l06024"></a>06024 
<a name="l06025"></a>06025       <span class="comment">/* set current value as default */</span>
<a name="l06026"></a>06026       size = <span class="keyword">sizeof</span>(data);
<a name="l06027"></a>06027       <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, data, &amp;size, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l06028"></a>06028       <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(data_str, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l06029"></a>06029 
<a name="l06030"></a>06030       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(data_str, <span class="stringliteral">&quot;&lt;NULL&gt;&quot;</span>))
<a name="l06031"></a>06031          data_str[0] = 0;
<a name="l06032"></a>06032 
<a name="l06033"></a>06033       <span class="keywordflow">if</span> (strchr(data_str, <span class="charliteral">&apos;\n&apos;</span>) != NULL) {
<a name="l06034"></a>06034          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;textarea rows=20 cols=80 name=\&quot;text\&quot;&gt;\n&quot;</span>);
<a name="l06035"></a>06035          <a class="code" href="mhttpd_8c.html#a0c625fe56e336fc4d14a579b876b9fa8">rsputs</a>(data_str);
<a name="l06036"></a>06036          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/textarea&gt;\n&quot;</span>);
<a name="l06037"></a>06037       } <span class="keywordflow">else</span> {
<a name="l06038"></a>06038          size = 20;
<a name="l06039"></a>06039          <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>) strlen(data_str) &gt; size)
<a name="l06040"></a>06040             size = strlen(data_str) + 3;
<a name="l06041"></a>06041          <span class="keywordflow">if</span> (size &gt; 80)
<a name="l06042"></a>06042             size = 80;
<a name="l06043"></a>06043          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l06044"></a>06044              (<span class="stringliteral">&quot;&lt;input type=\&quot;text\&quot; size=%d maxlength=256 name=\&quot;value\&quot; value=\&quot;%s\&quot;&gt;\n&quot;</span>,
<a name="l06045"></a>06045               size, data_str);
<a name="l06046"></a>06046       }
<a name="l06047"></a>06047 
<a name="l06048"></a>06048       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l06049"></a>06049 
<a name="l06050"></a>06050       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=center colspan=2&gt;&quot;</span>);
<a name="l06051"></a>06051       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Set&gt;&quot;</span>);
<a name="l06052"></a>06052       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Cancel&gt;&quot;</span>);
<a name="l06053"></a>06053       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>);
<a name="l06054"></a>06054       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>);
<a name="l06055"></a>06055 
<a name="l06056"></a>06056       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=cmd value=Set&gt;\n&quot;</span>);
<a name="l06057"></a>06057 
<a name="l06058"></a>06058       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l06059"></a>06059       <span class="keywordflow">return</span>;
<a name="l06060"></a>06060    } <span class="keywordflow">else</span> {
<a name="l06061"></a>06061       <span class="comment">/* set value */</span>
<a name="l06062"></a>06062 
<a name="l06063"></a>06063       status = <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, dec_path, &amp;hkey);
<a name="l06064"></a>06064       <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l06065"></a>06065          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Error: cannot find key %s&lt;P&gt;\n&quot;</span>, dec_path);
<a name="l06066"></a>06066          <span class="keywordflow">return</span>;
<a name="l06067"></a>06067       }
<a name="l06068"></a>06068       <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l06069"></a>06069 
<a name="l06070"></a>06070       memset(data, 0, <span class="keyword">sizeof</span>(data));
<a name="l06071"></a>06071 
<a name="l06072"></a>06072       <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;text&quot;</span>))
<a name="l06073"></a>06073          strncpy(data, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;text&quot;</span>), <span class="keyword">sizeof</span>(data));
<a name="l06074"></a>06074       <span class="keywordflow">else</span>
<a name="l06075"></a>06075          <a class="code" href="group__msectionh.html#ga7b3d26e7b258c093ad999bf1286bb871">db_sscanf</a>(<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, data, &amp;size, 0, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l06076"></a>06076 
<a name="l06077"></a>06077       <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> &lt; 0)
<a name="l06078"></a>06078          <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> = 0;
<a name="l06079"></a>06079 
<a name="l06080"></a>06080       <span class="comment">/* extend data size for single string if necessary */</span>
<a name="l06081"></a>06081       <span class="keywordflow">if</span> ((key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a> || key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#gaa63f41f547c7f46f828aaf35073807ea">TID_LINK</a>)
<a name="l06082"></a>06082           &amp;&amp; (<span class="keywordtype">int</span>) strlen(data) + 1 &gt; key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a> &amp;&amp; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a> == 1)
<a name="l06083"></a>06083          key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a> = strlen(data) + 1;
<a name="l06084"></a>06084 
<a name="l06085"></a>06085       <span class="keywordflow">if</span> (key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a> == 0)
<a name="l06086"></a>06086          key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a> = <a class="code" href="group__msectionh.html#gaa0bf5cc257f83e9a7f3936738fe009f3">rpc_tid_size</a>(key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l06087"></a>06087 
<a name="l06088"></a>06088       <span class="keywordflow">if</span> (key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a> &gt; 1)
<a name="l06089"></a>06089          status = <a class="code" href="group__msectionh.html#ga18f5e7743545b06fca4f3d5ce9889034">db_set_data_index</a>(hDB, hkey, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l06090"></a>06090       <span class="keywordflow">else</span>
<a name="l06091"></a>06091          status = <a class="code" href="group__msectionh.html#ga6b98aa5ac9036c49023c0cc9353922d4">db_set_data</a>(hDB, hkey, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, 1, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l06092"></a>06092 
<a name="l06093"></a>06093       <span class="keywordflow">if</span> (status == <a class="code" href="group__err23.html#ga467b0af34b1011481919088b6af86b95">DB_NO_ACCESS</a>)
<a name="l06094"></a>06094          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;h2&gt;Write access not allowed&lt;/h2&gt;\n&quot;</span>);
<a name="l06095"></a>06095 
<a name="l06096"></a>06096       <span class="comment">/* strip variable name from path */</span>
<a name="l06097"></a>06097       p = dec_path + strlen(dec_path) - 1;
<a name="l06098"></a>06098       <span class="keywordflow">while</span> (*p &amp;&amp; *p != <span class="charliteral">&apos;/&apos;</span>)
<a name="l06099"></a>06099          *p-- = 0;
<a name="l06100"></a>06100       <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;/&apos;</span>)
<a name="l06101"></a>06101          *p = 0;
<a name="l06102"></a>06102 
<a name="l06103"></a>06103       strcpy(enc_path, dec_path);
<a name="l06104"></a>06104       <a class="code" href="mhttpd_8c.html#a477e33c685ba6ebcb9d429fb057c2760">urlEncode</a>(enc_path);
<a name="l06105"></a>06105 
<a name="l06106"></a>06106       <span class="comment">/* redirect */</span>
<a name="l06107"></a>06107 
<a name="l06108"></a>06108       <span class="keywordflow">if</span> (group[0]) {
<a name="l06109"></a>06109          <span class="comment">/* extract equipment name */</span>
<a name="l06110"></a>06110          eq_name[0] = 0;
<a name="l06111"></a>06111          <span class="keywordflow">if</span> (strncmp(enc_path, <span class="stringliteral">&quot;Equipment/&quot;</span>, 10) == 0) {
<a name="l06112"></a>06112             strcpy(eq_name, enc_path + 10);
<a name="l06113"></a>06113             <span class="keywordflow">if</span> (strchr(eq_name, <span class="charliteral">&apos;/&apos;</span>))
<a name="l06114"></a>06114                *strchr(eq_name, <span class="charliteral">&apos;/&apos;</span>) = 0;
<a name="l06115"></a>06115          }
<a name="l06116"></a>06116 
<a name="l06117"></a>06117          <span class="comment">/* back to SC display */</span>
<a name="l06118"></a>06118          sprintf(str, <span class="stringliteral">&quot;SC/%s/%s&quot;</span>, eq_name, group);
<a name="l06119"></a>06119          <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(str);
<a name="l06120"></a>06120       } <span class="keywordflow">else</span>
<a name="l06121"></a>06121          <a class="code" href="mhttpd_8c.html#aae1a5afad4cf44ffc56fe0a1b82a3d93">redirect</a>(enc_path);
<a name="l06122"></a>06122 
<a name="l06123"></a>06123       <span class="keywordflow">return</span>;
<a name="l06124"></a>06124    }
<a name="l06125"></a>06125 
<a name="l06126"></a>06126 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abd8300ac3ea05f7225a591cbb6255fd0"></a><!-- doxytag: member="mhttpd.c::show_start_page" ref="abd8300ac3ea05f7225a591cbb6255fd0" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_start_page </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l05639">5639</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="lrs1821_8c_source.html#l00038">data</a>, <a class="el" href="odb_8c_source.html#l03390">db_enum_key()</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="odb_8c_source.html#l06308">db_sprintf()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="midas_8h_source.html#l01320">KEY::item_size</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="midas_8h_source.html#l01316">KEY::num_values</a>, <a class="el" href="mstat_8c_source.html#l00087">rn</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l01502">show_header()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="bit3__mvme_2mvmestd_8h_source.html#l00045">SUCCESS</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, and <a class="el" href="midas_8h_source.html#l01315">KEY::type</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05640"></a>05640 {
<a name="l05641"></a>05641    <span class="keywordtype">int</span> <a class="code" href="mstat_8c.html#a2c1c963021a4d8af2cce969c892c10f1">rn</a>, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, maxlength;
<a name="l05642"></a>05642    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey, hsubkey, hkeycomm, hkeyc;
<a name="l05643"></a>05643    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l05644"></a>05644    <span class="keywordtype">char</span> <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>[1000], <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[32];
<a name="l05645"></a>05645    <span class="keywordtype">char</span> data_str[256], comment[1000];
<a name="l05646"></a>05646 
<a name="l05647"></a>05647    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l05648"></a>05648 
<a name="l05649"></a>05649    <a class="code" href="mhttpd_8c.html#ae5fb6c731656613ead122d173a8ef7a8">show_header</a>(hDB, <span class="stringliteral">&quot;Start run&quot;</span>, <span class="stringliteral">&quot;GET&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 1, 0);
<a name="l05650"></a>05650 
<a name="l05651"></a>05651    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th bgcolor=#A0A0FF colspan=2&gt;Start new run&lt;/tr&gt;\n&quot;</span>);
<a name="l05652"></a>05652    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;Run number&quot;</span>);
<a name="l05653"></a>05653 
<a name="l05654"></a>05654    <span class="comment">/* run number */</span>
<a name="l05655"></a>05655    size = <span class="keyword">sizeof</span>(rn);
<a name="l05656"></a>05656    status = <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Runinfo/Run number&quot;</span>, &amp;rn, &amp;size, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l05657"></a>05657    assert(status == <a class="code" href="group__mvmestdinclude.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>);
<a name="l05658"></a>05658 
<a name="l05659"></a>05659    <span class="keywordflow">if</span> (rn &lt; 0)                  <span class="comment">// value &quot;zero&quot; is okey</span>
<a name="l05660"></a>05660    {
<a name="l05661"></a>05661       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;show_start_page&quot;</span>,
<a name="l05662"></a>05662              <span class="stringliteral">&quot;aborting on attempt to use invalid run number %d&quot;</span>, rn);
<a name="l05663"></a>05663       abort();
<a name="l05664"></a>05664    }
<a name="l05665"></a>05665 
<a name="l05666"></a>05666    size = <span class="keyword">sizeof</span>(i);
<a name="l05667"></a>05667    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Edit on start/Edit Run number&quot;</span>, &amp;hkey) ==
<a name="l05668"></a>05668        <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a> &amp;&amp; <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, &amp;i, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>) &amp;&amp; i == 0)
<a name="l05669"></a>05669       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td&gt;&lt;input type=hidden name=value value=%d&gt;%d&lt;/tr&gt;\n&quot;</span>, rn + 1, rn + 1);
<a name="l05670"></a>05670    <span class="keywordflow">else</span>
<a name="l05671"></a>05671       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td&gt;&lt;input type=text size=20 maxlength=80 name=value value=%d&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l05672"></a>05672                rn + 1);
<a name="l05673"></a>05673 
<a name="l05674"></a>05674    <span class="comment">/* run parameters */</span>
<a name="l05675"></a>05675    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Edit on start&quot;</span>, &amp;hkey);
<a name="l05676"></a>05676    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Parameter Comments&quot;</span>, &amp;hkeycomm);
<a name="l05677"></a>05677    <span class="keywordflow">if</span> (hkey) {
<a name="l05678"></a>05678       <span class="keywordflow">for</span> (i = 0, n = 0;; i++) {
<a name="l05679"></a>05679          <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkey, i, &amp;hsubkey);
<a name="l05680"></a>05680 
<a name="l05681"></a>05681          <span class="keywordflow">if</span> (!hsubkey)
<a name="l05682"></a>05682             <span class="keywordflow">break</span>;
<a name="l05683"></a>05683 
<a name="l05684"></a>05684          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hsubkey, &amp;key);
<a name="l05685"></a>05685          strcpy(str, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l05686"></a>05686 
<a name="l05687"></a>05687          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, <span class="stringliteral">&quot;Edit run number&quot;</span>))
<a name="l05688"></a>05688             <span class="keywordflow">continue</span>;
<a name="l05689"></a>05689 
<a name="l05690"></a>05690          <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkey, i, &amp;hsubkey);
<a name="l05691"></a>05691          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hsubkey, &amp;key);
<a name="l05692"></a>05692 
<a name="l05693"></a>05693          size = <span class="keyword">sizeof</span>(data);
<a name="l05694"></a>05694          status = <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hsubkey, data, &amp;size, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05695"></a>05695          <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l05696"></a>05696             <span class="keywordflow">continue</span>;
<a name="l05697"></a>05697 
<a name="l05698"></a>05698          <span class="keywordflow">for</span> (j = 0; j &lt; key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a>; j++) {
<a name="l05699"></a>05699             <span class="keywordflow">if</span> (key.<a class="code" href="group__midasincludecode.html#ga2604fa0fc38ce19b011785f806185a02">num_values</a> &gt; 1)
<a name="l05700"></a>05700                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;%s [%d]&quot;</span>, str, j);
<a name="l05701"></a>05701             <span class="keywordflow">else</span>
<a name="l05702"></a>05702                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;%s&quot;</span>, str);
<a name="l05703"></a>05703 
<a name="l05704"></a>05704             <span class="keywordflow">if</span> (j == 0 &amp;&amp; hkeycomm) {
<a name="l05705"></a>05705                <span class="comment">/* look for comment */</span>
<a name="l05706"></a>05706                <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hkeycomm, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, &amp;hkeyc) == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l05707"></a>05707                   size = <span class="keyword">sizeof</span>(comment);
<a name="l05708"></a>05708                   <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkeyc, comment, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>) == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l05709"></a>05709                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;br&gt;%s\n&quot;</span>, comment);
<a name="l05710"></a>05710                }
<a name="l05711"></a>05711             }
<a name="l05712"></a>05712 
<a name="l05713"></a>05713             <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(data_str, data, key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>, j, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l05714"></a>05714 
<a name="l05715"></a>05715             maxlength = 80;
<a name="l05716"></a>05716             <span class="keywordflow">if</span> (key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>)
<a name="l05717"></a>05717                maxlength = key.<a class="code" href="group__midasincludecode.html#gacd1951fdb8bf0dec79ef833f6dec9276">item_size</a>;
<a name="l05718"></a>05718 
<a name="l05719"></a>05719             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l05720"></a>05720                 (<span class="stringliteral">&quot;&lt;td&gt;&lt;input type=text size=80 maxlength=%d name=x%d value=\&quot;%s\&quot;&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l05721"></a>05721                  maxlength, n++, data_str);
<a name="l05722"></a>05722          }
<a name="l05723"></a>05723       }
<a name="l05724"></a>05724    }
<a name="l05725"></a>05725 
<a name="l05726"></a>05726    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td align=center colspan=2&gt;&quot;</span>);
<a name="l05727"></a>05727    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Start&gt;&quot;</span>);
<a name="l05728"></a>05728    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Cancel&gt;&quot;</span>);
<a name="l05729"></a>05729    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>);
<a name="l05730"></a>05730    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>);
<a name="l05731"></a>05731 
<a name="l05732"></a>05732    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l05733"></a>05733 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3db9b2c2ff96ccddfa05fc7587e3d3c7"></a><!-- doxytag: member="mhttpd.c::show_status_page" ref="a3db9b2c2ff96ccddfa05fc7587e3d3c7" args="(int refresh, char *cookie_wpwd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_status_page </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>refresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>cookie_wpwd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01641">1641</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="msystem_8h_source.html#l00592">CHN_SETTINGS::active</a>, <a class="el" href="msystem_8h_source.html#l00611">CHN_STATISTICS::bytes_written</a>, <a class="el" href="msystem_8h_source.html#l00612">CHN_STATISTICS::bytes_written_total</a>, <a class="el" href="midas_8c_source.html#l02768">cm_disconnect_experiment()</a>, <a class="el" href="midas_8c_source.html#l05069">cm_exist()</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l00956">CM_SUCCESS</a>, <a class="el" href="msystem_8h_source.html#l00606">CHN_SETTINGS::current_filename</a>, <a class="el" href="system_8c_source.html#l00966">d</a>, <a class="el" href="odb_8c_source.html#l07436">db_check_record()</a>, <a class="el" href="odb_8c_source.html#l03390">db_enum_key()</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l06770">db_get_record()</a>, <a class="el" href="odb_8c_source.html#l06684">db_get_record_size()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="midas_8h_source.html#l01016">DB_NO_MORE_SUBKEYS</a>, <a class="el" href="midas_8h_source.html#l01024">DB_STRUCT_MISMATCH</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l01370">EQUIPMENT_INFO::enabled</a>, <a class="el" href="midas_8h_source.html#l00803">EQ_MANUAL_TRIG</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00075">equipment</a>, <a class="el" href="midas_8h_source.html#l01383">EQUIPMENT_STATS::events_per_sec</a>, <a class="el" href="midas_8h_source.html#l01382">EQUIPMENT_STATS::events_sent</a>, <a class="el" href="msystem_8h_source.html#l00610">CHN_STATISTICS::events_written</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="scs__310__ql355p_8c_source.html#l00055">flag</a>, <a class="el" href="midas_8h_source.html#l01376">EQUIPMENT_INFO::frontend_host</a>, <a class="el" href="midas_8h_source.html#l01377">EQUIPMENT_INFO::frontend_name</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="generate-MODULES_8h_source.html#l00003">if</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="odbhist_8c_source.html#l00058">k</a>, <a class="el" href="midas_8h_source.html#l01384">EQUIPMENT_STATS::kbytes_per_sec</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="mhttpd_8c_source.html#l01177">message_buffer</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00039">name</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="midas_8h_source.html#l01601">RUNINFO::requested_transition</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="midas_8h_source.html#l01599">RUNINFO::run_number</a>, <a class="el" href="experiment_2analyzer_8c_source.html#l00101">runinfo</a>, <a class="el" href="midas_8h_source.html#l01608">RUNINFO_STR</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="midas_8h_source.html#l01602">RUNINFO::start_time</a>, <a class="el" href="midas_8h_source.html#l01603">RUNINFO::start_time_binary</a>, <a class="el" href="midas_8h_source.html#l01597">RUNINFO::state</a>, <a class="el" href="midas_8h_source.html#l00713">STATE_PAUSED</a>, <a class="el" href="midas_8h_source.html#l00714">STATE_RUNNING</a>, <a class="el" href="midas_8h_source.html#l00712">STATE_STOPPED</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="midas_8h_source.html#l01604">RUNINFO::stop_time</a>, <a class="el" href="odb_8c_source.html#l00631">strcomb()</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, <a class="el" href="midas_8h_source.html#l00744">TID_DOUBLE</a>, <a class="el" href="midas_8h_source.html#l00743">TID_FLOAT</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="midas_8h_source.html#l00750">TID_LINK</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, <a class="el" href="group__midasincludecode.html#ga81fabd22ad4035bf4223f0e29a167b15">trans_name</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, <a class="el" href="msystem_8h_source.html#l00593">CHN_SETTINGS::type</a>, <a class="el" href="midas_8h_source.html#l01315">KEY::type</a>, <a class="el" href="mana_8cpp_source.html#l00675">type</a>, and <a class="el" href="ADCS_8h_source.html#l00004">value</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01642"></a>01642 {
<a name="l01643"></a>01643    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, <a class="code" href="odbhist_8c.html#a43fa990200c3ddd47c35f151bd4d66bf">k</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>;
<a name="l01644"></a>01644    <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a>, first;
<a name="l01645"></a>01645    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[1000], <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>[32], ref[256], bgcol[32], fgcol[32], alarm_class[32];
<a name="l01646"></a>01646    <span class="keywordtype">char</span> *<a class="code" href="group__midasincludecode.html#ga81fabd22ad4035bf4223f0e29a167b15">trans_name</a>[] = { <span class="stringliteral">&quot;Start&quot;</span>, <span class="stringliteral">&quot;Stop&quot;</span>, <span class="stringliteral">&quot;Pause&quot;</span>, <span class="stringliteral">&quot;Resume&quot;</span> };
<a name="l01647"></a>01647    time_t now, difftime;
<a name="l01648"></a>01648    <span class="keywordtype">double</span> analyzed, analyze_ratio, <a class="code" href="system_8c.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>;
<a name="l01649"></a>01649    <span class="keywordtype">float</span> <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;
<a name="l01650"></a>01650    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey, hLKey, hsubkey, hkeytmp;
<a name="l01651"></a>01651    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l01652"></a>01652    <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> ftp_mode, previous_mode;
<a name="l01653"></a>01653    <span class="keywordtype">char</span> client_name[<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>];
<a name="l01654"></a>01654    <span class="keyword">struct </span>tm *gmt;
<a name="l01655"></a>01655    <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> new_window;
<a name="l01656"></a>01656 
<a name="l01657"></a>01657    <a class="code" href="group__modbh.html#gae26d58f1036d07ca15fc73a991ccadc2">RUNINFO_STR</a>(runinfo_str);
<a name="l01658"></a>01658    <a class="code" href="structRUNINFO.html">RUNINFO</a> <a class="code" href="experiment_2adccalib_8c.html#ade46d29add32a0b6910ebc8da0fea69b">runinfo</a>;
<a name="l01659"></a>01659    <a class="code" href="structEQUIPMENT__INFO.html">EQUIPMENT_INFO</a> <a class="code" href="examples_2macro_2midas__macro_8h.html#ae8b8f6d8b9bae4600c7eac6eee4e57b4">equipment</a>;
<a name="l01660"></a>01660    <a class="code" href="structEQUIPMENT__STATS.html">EQUIPMENT_STATS</a> equipment_stats;
<a name="l01661"></a>01661    <a class="code" href="structCHN__SETTINGS.html">CHN_SETTINGS</a> chn_settings;
<a name="l01662"></a>01662    <a class="code" href="structCHN__STATISTICS.html">CHN_STATISTICS</a> chn_stats;
<a name="l01663"></a>01663 
<a name="l01664"></a>01664    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l01665"></a>01665 
<a name="l01666"></a>01666    status = <a class="code" href="group__msectionh.html#gaba7341fc6e27b70739734a50b489ef4f">db_check_record</a>(hDB, 0, <span class="stringliteral">&quot;/Runinfo&quot;</span>, <a class="code" href="group__msectionh.html#gaccf82d3dbd8eb7090db598725713e012">strcomb</a>(runinfo_str), <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01667"></a>01667    <span class="keywordflow">if</span> (status == <a class="code" href="group__err23.html#ga0ee271607cfbec2e6050b0ea6e5ef533">DB_STRUCT_MISMATCH</a>) {
<a name="l01668"></a>01668       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;show_status_page&quot;</span>, <span class="stringliteral">&quot;Aborting on mismatching /Runinfo structure&quot;</span>);
<a name="l01669"></a>01669       <a class="code" href="group__msectionh.html#ga9792ed24b1150464250ac794067c9196">cm_disconnect_experiment</a>();
<a name="l01670"></a>01670       abort();
<a name="l01671"></a>01671    }
<a name="l01672"></a>01672 
<a name="l01673"></a>01673    <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l01674"></a>01674       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;show_status_page&quot;</span>,
<a name="l01675"></a>01675              <span class="stringliteral">&quot;Aborting on invalid access to ODB /Runinfo, status=%d&quot;</span>, status);
<a name="l01676"></a>01676       <a class="code" href="group__msectionh.html#ga9792ed24b1150464250ac794067c9196">cm_disconnect_experiment</a>();
<a name="l01677"></a>01677       abort();
<a name="l01678"></a>01678    }
<a name="l01679"></a>01679 
<a name="l01680"></a>01680    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Runinfo&quot;</span>, &amp;hkey);
<a name="l01681"></a>01681    assert(hkey);
<a name="l01682"></a>01682 
<a name="l01683"></a>01683    size = <span class="keyword">sizeof</span>(runinfo);
<a name="l01684"></a>01684    status = <a class="code" href="group__msectionh.html#gaae4cf88eaadf5d2dd9eefa3e1b6389e6">db_get_record</a>(hDB, hkey, &amp;runinfo, &amp;size, 0);
<a name="l01685"></a>01685    assert(status == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>);
<a name="l01686"></a>01686 
<a name="l01687"></a>01687    <span class="comment">/* header */</span>
<a name="l01688"></a>01688    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.1 200 OK\r\n&quot;</span>);
<a name="l01689"></a>01689    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l01690"></a>01690    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n&quot;</span>);
<a name="l01691"></a>01691    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Pragma: no-cache\r\n&quot;</span>);
<a name="l01692"></a>01692    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Expires: Fri, 01-Jan-1983 00:00:00 GMT\r\n&quot;</span>);
<a name="l01693"></a>01693    <span class="keywordflow">if</span> (cookie_wpwd[0]) {
<a name="l01694"></a>01694       <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l01695"></a>01695       now += 3600 * 24;
<a name="l01696"></a>01696       gmt = gmtime(&amp;now);
<a name="l01697"></a>01697       strftime(str, <span class="keyword">sizeof</span>(str), <span class="stringliteral">&quot;%A, %d-%b-%Y %H:%M:%S GMT&quot;</span>, gmt);
<a name="l01698"></a>01698 
<a name="l01699"></a>01699       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Set-Cookie: midas_wpwd=%s; path=/; expires=%s\r\n&quot;</span>, cookie_wpwd, str);
<a name="l01700"></a>01700    }
<a name="l01701"></a>01701 
<a name="l01702"></a>01702    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;\r\n&lt;html&gt;\n&quot;</span>);
<a name="l01703"></a>01703 
<a name="l01704"></a>01704    <span class="comment">/* auto refresh */</span>
<a name="l01705"></a>01705    <span class="keywordflow">if</span> (refresh &gt; 0)
<a name="l01706"></a>01706       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;head&gt;&lt;meta http-equiv=\&quot;Refresh\&quot; content=\&quot;%02d\&quot;&gt;\n&quot;</span>, refresh);
<a name="l01707"></a>01707 
<a name="l01708"></a>01708    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;title&gt;MIDAS status&lt;/title&gt;&lt;/head&gt;\n&quot;</span>);
<a name="l01709"></a>01709    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;body&gt;&lt;form method=\&quot;GET\&quot; action=\&quot;/\&quot;&gt;\n&quot;</span>);
<a name="l01710"></a>01710 
<a name="l01711"></a>01711    <span class="comment">/* define hidden field for experiment */</span>
<a name="l01712"></a>01712    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l01713"></a>01713       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=hidden name=exp value=\&quot;%s\&quot;&gt;\n&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l01714"></a>01714 
<a name="l01715"></a>01715    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;table border=3 cellpadding=2&gt;\n&quot;</span>);
<a name="l01716"></a>01716 
<a name="l01717"></a>01717   <span class="comment">/*---- title row ----*/</span>
<a name="l01718"></a>01718 
<a name="l01719"></a>01719    size = <span class="keyword">sizeof</span>(str);
<a name="l01720"></a>01720    str[0] = 0;
<a name="l01721"></a>01721    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Name&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01722"></a>01722    <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(&amp;now);
<a name="l01723"></a>01723 
<a name="l01724"></a>01724    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th colspan=3 bgcolor=#A0A0FF&gt;MIDAS experiment \&quot;%s\&quot;&quot;</span>, str);
<a name="l01725"></a>01725    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th colspan=3 bgcolor=#A0A0FF&gt;%s &amp;nbsp;&amp;nbsp;Refr:%d&lt;/tr&gt;\n&quot;</span>, ctime(&amp;now),
<a name="l01726"></a>01726             refresh);
<a name="l01727"></a>01727 
<a name="l01728"></a>01728   <span class="comment">/*---- menu buttons ----*/</span>
<a name="l01729"></a>01729 
<a name="l01730"></a>01730    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l01731"></a>01731 
<a name="l01732"></a>01732    <span class="keywordflow">if</span> (runinfo.<a class="code" href="structRUNINFO.html#a7c400fc343d96a490a32bc64fca7be05">state</a> == <a class="code" href="group__mdefineh.html#ga6a8dac64367bd381245f2eb09a7fe919">STATE_STOPPED</a>)
<a name="l01733"></a>01733       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Start&gt;\n&quot;</span>);
<a name="l01734"></a>01734    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (runinfo.<a class="code" href="structRUNINFO.html#a7c400fc343d96a490a32bc64fca7be05">state</a> == <a class="code" href="group__mdefineh.html#gab08c47284371c683ba80d6b3244400f1">STATE_PAUSED</a>)
<a name="l01735"></a>01735       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Resume&gt;\n&quot;</span>);
<a name="l01736"></a>01736    <span class="keywordflow">else</span>
<a name="l01737"></a>01737       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l01738"></a>01738           (<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Stop&gt;\n&lt;input type=submit name=cmd value=Pause&gt;\n&quot;</span>);
<a name="l01739"></a>01739 
<a name="l01740"></a>01740    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=ODB&gt;\n&quot;</span>);
<a name="l01741"></a>01741    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=CNAF&gt;\n&quot;</span>);
<a name="l01742"></a>01742    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Messages&gt;\n&quot;</span>);
<a name="l01743"></a>01743    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=ELog&gt;\n&quot;</span>);
<a name="l01744"></a>01744    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Alarms&gt;\n&quot;</span>);
<a name="l01745"></a>01745    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Programs&gt;\n&quot;</span>);
<a name="l01746"></a>01746    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=History&gt;\n&quot;</span>);
<a name="l01747"></a>01747    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Config&gt;\n&quot;</span>);
<a name="l01748"></a>01748    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=Help&gt;\n&quot;</span>);
<a name="l01749"></a>01749 
<a name="l01750"></a>01750   <span class="comment">/*---- script buttons ----*/</span>
<a name="l01751"></a>01751 
<a name="l01752"></a>01752    status = <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;Script&quot;</span>, &amp;hkey);
<a name="l01753"></a>01753    <span class="keywordflow">if</span> (status == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l01754"></a>01754       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6 bgcolor=#D0D0D0&gt;\n&quot;</span>);
<a name="l01755"></a>01755 
<a name="l01756"></a>01756       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l01757"></a>01757          <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkey, i, &amp;hsubkey);
<a name="l01758"></a>01758          <span class="keywordflow">if</span> (!hsubkey)
<a name="l01759"></a>01759             <span class="keywordflow">break</span>;
<a name="l01760"></a>01760          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hsubkey, &amp;key);
<a name="l01761"></a>01761          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=script value=\&quot;%s\&quot;&gt;\n&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l01762"></a>01762       }
<a name="l01763"></a>01763    }
<a name="l01764"></a>01764 
<a name="l01765"></a>01765    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n\n&quot;</span>);
<a name="l01766"></a>01766 
<a name="l01767"></a>01767   <span class="comment">/*---- alarms ----*/</span>
<a name="l01768"></a>01768 
<a name="l01769"></a>01769    <span class="comment">/* go through all triggered alarms */</span>
<a name="l01770"></a>01770    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Alarms/Alarms&quot;</span>, &amp;hkey);
<a name="l01771"></a>01771    <span class="keywordflow">if</span> (hkey) {
<a name="l01772"></a>01772       <span class="comment">/* check global alarm flag */</span>
<a name="l01773"></a>01773       flag = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01774"></a>01774       size = <span class="keyword">sizeof</span>(flag);
<a name="l01775"></a>01775       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Alarms/Alarm System active&quot;</span>, &amp;flag, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01776"></a>01776       <span class="keywordflow">if</span> (flag) {
<a name="l01777"></a>01777          <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l01778"></a>01778             <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkey, i, &amp;hsubkey);
<a name="l01779"></a>01779 
<a name="l01780"></a>01780             <span class="keywordflow">if</span> (!hsubkey)
<a name="l01781"></a>01781                <span class="keywordflow">break</span>;
<a name="l01782"></a>01782 
<a name="l01783"></a>01783             size = <span class="keyword">sizeof</span>(flag);
<a name="l01784"></a>01784             <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hsubkey, <span class="stringliteral">&quot;Triggered&quot;</span>, &amp;flag, &amp;size, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01785"></a>01785             <span class="keywordflow">if</span> (flag) {
<a name="l01786"></a>01786                <span class="comment">/*</span>
<a name="l01787"></a>01787 <span class="comment">                  if (exp_name[0])</span>
<a name="l01788"></a>01788 <span class="comment">                  sprintf(ref, &quot;/?exp=%s&amp;cmd=alarms&quot;, exp_name);</span>
<a name="l01789"></a>01789 <span class="comment">                  else</span>
<a name="l01790"></a>01790 <span class="comment">                  sprintf(ref, &quot;/?cmd=alarms&quot;);</span>
<a name="l01791"></a>01791 <span class="comment">                */</span>
<a name="l01792"></a>01792 
<a name="l01793"></a>01793                size = <span class="keyword">sizeof</span>(alarm_class);
<a name="l01794"></a>01794                <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hsubkey, <span class="stringliteral">&quot;Alarm Class&quot;</span>, alarm_class, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>,
<a name="l01795"></a>01795                             <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01796"></a>01796 
<a name="l01797"></a>01797                strcpy(bgcol, <span class="stringliteral">&quot;red&quot;</span>);
<a name="l01798"></a>01798                sprintf(str, <span class="stringliteral">&quot;/Alarms/Classes/%s/Display BGColor&quot;</span>, alarm_class);
<a name="l01799"></a>01799                size = <span class="keyword">sizeof</span>(bgcol);
<a name="l01800"></a>01800                <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, str, bgcol, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01801"></a>01801 
<a name="l01802"></a>01802                strcpy(fgcol, <span class="stringliteral">&quot;black&quot;</span>);
<a name="l01803"></a>01803                sprintf(str, <span class="stringliteral">&quot;/Alarms/Classes/%s/Display FGColor&quot;</span>, alarm_class);
<a name="l01804"></a>01804                size = <span class="keyword">sizeof</span>(fgcol);
<a name="l01805"></a>01805                <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, str, fgcol, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01806"></a>01806 
<a name="l01807"></a>01807                size = <span class="keyword">sizeof</span>(str);
<a name="l01808"></a>01808                <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hsubkey, <span class="stringliteral">&quot;Alarm Message&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01809"></a>01809 
<a name="l01810"></a>01810                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6 bgcolor=\&quot;%s\&quot; align=center&gt;&quot;</span>, bgcol);
<a name="l01811"></a>01811 
<a name="l01812"></a>01812                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;font color=\&quot;%s\&quot; size=+3&gt;%s: %s&lt;/font&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l01813"></a>01813                         fgcol, alarm_class, str);
<a name="l01814"></a>01814             }
<a name="l01815"></a>01815          }
<a name="l01816"></a>01816       }
<a name="l01817"></a>01817    }
<a name="l01818"></a>01818 
<a name="l01819"></a>01819   <span class="comment">/*---- manual triggered equipment ----*/</span>
<a name="l01820"></a>01820 
<a name="l01821"></a>01821    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/equipment&quot;</span>, &amp;hkey) == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l01822"></a>01822       first = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01823"></a>01823       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l01824"></a>01824          <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkey, i, &amp;hsubkey);
<a name="l01825"></a>01825          <span class="keywordflow">if</span> (!hsubkey)
<a name="l01826"></a>01826             <span class="keywordflow">break</span>;
<a name="l01827"></a>01827 
<a name="l01828"></a>01828          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hsubkey, &amp;key);
<a name="l01829"></a>01829 
<a name="l01830"></a>01830          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hsubkey, <span class="stringliteral">&quot;Common&quot;</span>, &amp;hkeytmp);
<a name="l01831"></a>01831 
<a name="l01832"></a>01832          <span class="keywordflow">if</span> (hkeytmp) {
<a name="l01833"></a>01833             size = <span class="keyword">sizeof</span>(type);
<a name="l01834"></a>01834             <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkeytmp, <span class="stringliteral">&quot;Type&quot;</span>, &amp;type, &amp;size, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01835"></a>01835             <span class="keywordflow">if</span> (type &amp; <a class="code" href="group__mdefineh.html#gac73e1045dff2b724325100af2e946717">EQ_MANUAL_TRIG</a>) {
<a name="l01836"></a>01836                <span class="keywordflow">if</span> (first)
<a name="l01837"></a>01837                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l01838"></a>01838 
<a name="l01839"></a>01839                first = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01840"></a>01840 
<a name="l01841"></a>01841                sprintf(str, <span class="stringliteral">&quot;Trigger %s event&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l01842"></a>01842                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;input type=submit name=cmd value=\&quot;%s\&quot;&gt;\n&quot;</span>, str);
<a name="l01843"></a>01843             }
<a name="l01844"></a>01844          }
<a name="l01845"></a>01845       }
<a name="l01846"></a>01846       <span class="keywordflow">if</span> (!first)
<a name="l01847"></a>01847          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n\n&quot;</span>);
<a name="l01848"></a>01848    }
<a name="l01849"></a>01849 
<a name="l01850"></a>01850   <span class="comment">/*---- aliases ----*/</span>
<a name="l01851"></a>01851 
<a name="l01852"></a>01852    first = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01853"></a>01853 
<a name="l01854"></a>01854    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Alias&quot;</span>, &amp;hkey);
<a name="l01855"></a>01855    <span class="keywordflow">if</span> (hkey) {
<a name="l01856"></a>01856       <span class="keywordflow">if</span> (first) {
<a name="l01857"></a>01857          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l01858"></a>01858          first = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01859"></a>01859       }
<a name="l01860"></a>01860       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l01861"></a>01861          <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkey, i, &amp;hsubkey);
<a name="l01862"></a>01862          <span class="keywordflow">if</span> (!hsubkey)
<a name="l01863"></a>01863             <span class="keywordflow">break</span>;
<a name="l01864"></a>01864 
<a name="l01865"></a>01865          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hsubkey, &amp;key);
<a name="l01866"></a>01866 
<a name="l01867"></a>01867          strcpy(name, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l01868"></a>01868          new_window = (name[strlen(name) - 1] != <span class="charliteral">&apos;&amp;&apos;</span>);
<a name="l01869"></a>01869          <span class="keywordflow">if</span> (!new_window)
<a name="l01870"></a>01870             name[strlen(name) - 1] = 0;
<a name="l01871"></a>01871 
<a name="l01872"></a>01872          <span class="keywordflow">if</span> (key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>) {
<a name="l01873"></a>01873             <span class="comment">/* html link */</span>
<a name="l01874"></a>01874             size = <span class="keyword">sizeof</span>(ref);
<a name="l01875"></a>01875             <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hsubkey, ref, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l01876"></a>01876             <span class="keywordflow">if</span> (new_window)
<a name="l01877"></a>01877                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;%s\&quot; target=\&quot;_blank\&quot;&gt;%s&lt;/a&gt; &quot;</span>, ref, name);
<a name="l01878"></a>01878             <span class="keywordflow">else</span>
<a name="l01879"></a>01879                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;%s\&quot;&gt;%s&lt;/a&gt; &quot;</span>, ref, name);
<a name="l01880"></a>01880          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#gaa63f41f547c7f46f828aaf35073807ea">TID_LINK</a>) {
<a name="l01881"></a>01881             <span class="comment">/* odb link */</span>
<a name="l01882"></a>01882             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l01883"></a>01883                sprintf(ref, <span class="stringliteral">&quot;/Alias/%s?exp=%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l01884"></a>01884             <span class="keywordflow">else</span>
<a name="l01885"></a>01885                sprintf(ref, <span class="stringliteral">&quot;/Alias/%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l01886"></a>01886 
<a name="l01887"></a>01887             <span class="keywordflow">if</span> (new_window)
<a name="l01888"></a>01888                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;%s\&quot; target=\&quot;_blank\&quot;&gt;%s&lt;/a&gt; &quot;</span>, ref, name);
<a name="l01889"></a>01889             <span class="keywordflow">else</span>
<a name="l01890"></a>01890                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;%s\&quot;&gt;%s&lt;/a&gt; &quot;</span>, ref, name);
<a name="l01891"></a>01891          }
<a name="l01892"></a>01892       }
<a name="l01893"></a>01893    }
<a name="l01894"></a>01894 
<a name="l01895"></a>01895    <span class="comment">/*---- custom pages ----*/</span>
<a name="l01896"></a>01896 
<a name="l01897"></a>01897    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Custom&quot;</span>, &amp;hkey);
<a name="l01898"></a>01898    <span class="keywordflow">if</span> (hkey) {
<a name="l01899"></a>01899       <span class="keywordflow">if</span> (first) {
<a name="l01900"></a>01900          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6 bgcolor=#C0C0C0&gt;\n&quot;</span>);
<a name="l01901"></a>01901          first = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01902"></a>01902       }
<a name="l01903"></a>01903       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l01904"></a>01904          <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkey, i, &amp;hsubkey);
<a name="l01905"></a>01905          <span class="keywordflow">if</span> (!hsubkey)
<a name="l01906"></a>01906             <span class="keywordflow">break</span>;
<a name="l01907"></a>01907 
<a name="l01908"></a>01908          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hsubkey, &amp;key);
<a name="l01909"></a>01909 
<a name="l01910"></a>01910          strcpy(name, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l01911"></a>01911          new_window = (name[strlen(name) - 1] != <span class="charliteral">&apos;&amp;&apos;</span>);
<a name="l01912"></a>01912          <span class="keywordflow">if</span> (!new_window)
<a name="l01913"></a>01913             name[strlen(name) - 1] = 0;
<a name="l01914"></a>01914 
<a name="l01915"></a>01915          <span class="keywordflow">if</span> (key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>) {
<a name="l01916"></a>01916             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l01917"></a>01917                sprintf(ref, <span class="stringliteral">&quot;/CS/%s?exp=%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l01918"></a>01918             <span class="keywordflow">else</span>
<a name="l01919"></a>01919                sprintf(ref, <span class="stringliteral">&quot;/CS/%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l01920"></a>01920 
<a name="l01921"></a>01921             <span class="keywordflow">if</span> (new_window)
<a name="l01922"></a>01922                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;%s\&quot; target=\&quot;_blank\&quot;&gt;%s&lt;/a&gt; &quot;</span>, ref, name);
<a name="l01923"></a>01923             <span class="keywordflow">else</span>
<a name="l01924"></a>01924                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;a href=\&quot;%s\&quot;&gt;%s&lt;/a&gt; &quot;</span>, ref, name);
<a name="l01925"></a>01925          }
<a name="l01926"></a>01926       }
<a name="l01927"></a>01927    }
<a name="l01928"></a>01928 
<a name="l01929"></a>01929    <span class="comment">/*---- run info ----*/</span>
<a name="l01930"></a>01930 
<a name="l01931"></a>01931    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr align=center&gt;&lt;td&gt;Run #%d&quot;</span>, runinfo.<a class="code" href="group__midasincludecode.html#gae34f31b041d6b30e555170811ef376ee">run_number</a>);
<a name="l01932"></a>01932 
<a name="l01933"></a>01933    <span class="keywordflow">if</span> (runinfo.<a class="code" href="structRUNINFO.html#a7c400fc343d96a490a32bc64fca7be05">state</a> == <a class="code" href="group__mdefineh.html#ga6a8dac64367bd381245f2eb09a7fe919">STATE_STOPPED</a>)
<a name="l01934"></a>01934       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=1 bgcolor=#FF0000&gt;Stopped&quot;</span>);
<a name="l01935"></a>01935    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (runinfo.<a class="code" href="structRUNINFO.html#a7c400fc343d96a490a32bc64fca7be05">state</a> == <a class="code" href="group__mdefineh.html#gab08c47284371c683ba80d6b3244400f1">STATE_PAUSED</a>)
<a name="l01936"></a>01936       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=1 bgcolor=#FFFF00&gt;Paused&quot;</span>);
<a name="l01937"></a>01937    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (runinfo.<a class="code" href="structRUNINFO.html#a7c400fc343d96a490a32bc64fca7be05">state</a> == <a class="code" href="group__mdefineh.html#gac4c0304c569818c811515e24523c3150">STATE_RUNNING</a>)
<a name="l01938"></a>01938       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=1 bgcolor=#00FF00&gt;Running&quot;</span>);
<a name="l01939"></a>01939    <span class="keywordflow">else</span>
<a name="l01940"></a>01940       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=1 bgcolor=#FFFFFF&gt;Unknown&quot;</span>);
<a name="l01941"></a>01941 
<a name="l01942"></a>01942    <span class="keywordflow">if</span> (runinfo.<a class="code" href="group__midasincludecode.html#ga2a4b8247ea78b5463c30f427460cd16e">requested_transition</a>)
<a name="l01943"></a>01943       <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++)
<a name="l01944"></a>01944          <span class="keywordflow">if</span> (runinfo.<a class="code" href="group__midasincludecode.html#ga2a4b8247ea78b5463c30f427460cd16e">requested_transition</a> &amp; (1 &lt;&lt; i))
<a name="l01945"></a>01945             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;br&gt;&lt;b&gt;%s requested&lt;/b&gt;&quot;</span>, trans_name[i]);
<a name="l01946"></a>01946 
<a name="l01947"></a>01947    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l01948"></a>01948       sprintf(ref, <span class="stringliteral">&quot;/Alarms/Alarm system active?cmd=set&amp;exp=%s&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l01949"></a>01949    <span class="keywordflow">else</span>
<a name="l01950"></a>01950       sprintf(ref, <span class="stringliteral">&quot;/Alarms/Alarm system active?cmd=set&quot;</span>);
<a name="l01951"></a>01951 
<a name="l01952"></a>01952    size = <span class="keyword">sizeof</span>(flag);
<a name="l01953"></a>01953    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Alarms/Alarm system active&quot;</span>, &amp;flag, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01954"></a>01954    strcpy(str, flag ? <span class="stringliteral">&quot;00FF00&quot;</span> : <span class="stringliteral">&quot;FFC0C0&quot;</span>);
<a name="l01955"></a>01955    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#%s&gt;&lt;a href=\&quot;%s\&quot;&gt;Alarms: %s&lt;/a&gt;&quot;</span>, str, ref,
<a name="l01956"></a>01956             flag ? <span class="stringliteral">&quot;On&quot;</span> : <span class="stringliteral">&quot;Off&quot;</span>);
<a name="l01957"></a>01957 
<a name="l01958"></a>01958    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l01959"></a>01959       sprintf(ref, <span class="stringliteral">&quot;/Logger/Auto restart?cmd=set&amp;exp=%s&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l01960"></a>01960    <span class="keywordflow">else</span>
<a name="l01961"></a>01961       sprintf(ref, <span class="stringliteral">&quot;/Logger/Auto restart?cmd=set&quot;</span>);
<a name="l01962"></a>01962 
<a name="l01963"></a>01963    size = <span class="keyword">sizeof</span>(flag);
<a name="l01964"></a>01964    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Auto restart&quot;</span>, &amp;flag, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01965"></a>01965    strcpy(str, flag ? <span class="stringliteral">&quot;00FF00&quot;</span> : <span class="stringliteral">&quot;FFFF00&quot;</span>);
<a name="l01966"></a>01966    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td bgcolor=#%s&gt;&lt;a href=\&quot;%s\&quot;&gt;Restart: %s&lt;/a&gt;&quot;</span>, str, ref,
<a name="l01967"></a>01967             flag ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);
<a name="l01968"></a>01968 
<a name="l01969"></a>01969    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#gafe2e23ec2e5c20fbc65ee238bd6cd48e">cm_exist</a>(<span class="stringliteral">&quot;Logger&quot;</span>, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a> &amp;&amp; <a class="code" href="group__msectionh.html#gafe2e23ec2e5c20fbc65ee238bd6cd48e">cm_exist</a>(<span class="stringliteral">&quot;FAL&quot;</span>, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l01970"></a>01970       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=2 bgcolor=#FF0000&gt;Logger not running&lt;/tr&gt;\n&quot;</span>);
<a name="l01971"></a>01971    <span class="keywordflow">else</span> {
<a name="l01972"></a>01972       <span class="comment">/* write data flag */</span>
<a name="l01973"></a>01973       size = <span class="keyword">sizeof</span>(flag);
<a name="l01974"></a>01974       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Write data&quot;</span>, &amp;flag, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01975"></a>01975 
<a name="l01976"></a>01976       <span class="keywordflow">if</span> (!flag)
<a name="l01977"></a>01977          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=2 bgcolor=#FFFF00&gt;Logging disabled&lt;/tr&gt;\n&quot;</span>);
<a name="l01978"></a>01978       <span class="keywordflow">else</span> {
<a name="l01979"></a>01979          size = <span class="keyword">sizeof</span>(str);
<a name="l01980"></a>01980          <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Data dir&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01981"></a>01981 
<a name="l01982"></a>01982          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=3&gt;Data dir: %s&lt;/tr&gt;\n&quot;</span>, str);
<a name="l01983"></a>01983       }
<a name="l01984"></a>01984    }
<a name="l01985"></a>01985 
<a name="l01986"></a>01986    <span class="comment">/*---- time ----*/</span>
<a name="l01987"></a>01987 
<a name="l01988"></a>01988    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr align=center&gt;&lt;td colspan=3&gt;Start: %s&quot;</span>, runinfo.<a class="code" href="group__midasincludecode.html#ga11fb9fb218581c46a448aa9fd3531b68">start_time</a>);
<a name="l01989"></a>01989 
<a name="l01990"></a>01990    difftime = now - runinfo.<a class="code" href="group__midasincludecode.html#ga495a2887a420437a45c0a602758fcf34">start_time_binary</a>;
<a name="l01991"></a>01991    <span class="keywordflow">if</span> (runinfo.<a class="code" href="structRUNINFO.html#a7c400fc343d96a490a32bc64fca7be05">state</a> == <a class="code" href="group__mdefineh.html#ga6a8dac64367bd381245f2eb09a7fe919">STATE_STOPPED</a>)
<a name="l01992"></a>01992       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=3&gt;Stop: %s&lt;/tr&gt;\n&quot;</span>, runinfo.<a class="code" href="group__midasincludecode.html#ga3c0b44aedcf1670b74c1516f6702ee9f">stop_time</a>);
<a name="l01993"></a>01993    <span class="keywordflow">else</span>
<a name="l01994"></a>01994       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=3&gt;Running time: %dh%02dm%02ds&lt;/tr&gt;\n&quot;</span>,
<a name="l01995"></a>01995                difftime / 3600, difftime % 3600 / 60, difftime % 60);
<a name="l01996"></a>01996 
<a name="l01997"></a>01997    <span class="comment">/*---- run comment ----*/</span>
<a name="l01998"></a>01998 
<a name="l01999"></a>01999    size = <span class="keyword">sizeof</span>(str);
<a name="l02000"></a>02000    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Run parameters/Comment&quot;</span>, str,
<a name="l02001"></a>02001                     &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l02002"></a>02002       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr align=center&gt;&lt;td colspan=6 bgcolor=#E0E0FF&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>,
<a name="l02003"></a>02003                str);
<a name="l02004"></a>02004 
<a name="l02005"></a>02005    <span class="comment">/*---- Equipment list ----*/</span>
<a name="l02006"></a>02006 
<a name="l02007"></a>02007    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;th&gt;Equipment&lt;th&gt;FE Node&lt;th&gt;Events&quot;</span>);
<a name="l02008"></a>02008    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;th&gt;Event rate[/s]&lt;th&gt;Data rate[kB/s]&lt;th&gt;Analyzed&lt;/tr&gt;\n&quot;</span>);
<a name="l02009"></a>02009 
<a name="l02010"></a>02010    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/equipment&quot;</span>, &amp;hkey) == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l02011"></a>02011       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l02012"></a>02012          <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkey, i, &amp;hsubkey);
<a name="l02013"></a>02013          <span class="keywordflow">if</span> (!hsubkey)
<a name="l02014"></a>02014             <span class="keywordflow">break</span>;
<a name="l02015"></a>02015 
<a name="l02016"></a>02016          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hsubkey, &amp;key);
<a name="l02017"></a>02017 
<a name="l02018"></a>02018          memset(&amp;equipment, 0, <span class="keyword">sizeof</span>(equipment));
<a name="l02019"></a>02019          memset(&amp;equipment_stats, 0, <span class="keyword">sizeof</span>(equipment_stats));
<a name="l02020"></a>02020 
<a name="l02021"></a>02021          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hsubkey, <span class="stringliteral">&quot;Common&quot;</span>, &amp;hkeytmp);
<a name="l02022"></a>02022 
<a name="l02023"></a>02023          <span class="keywordflow">if</span> (hkeytmp) {
<a name="l02024"></a>02024             <a class="code" href="group__msectionh.html#ga1880903c0ebb0d58809f48f6b2d59704">db_get_record_size</a>(hDB, hkeytmp, 0, &amp;size);
<a name="l02025"></a>02025             <span class="comment">/* discard wrong equipments (caused by analyzer) */</span>
<a name="l02026"></a>02026             <span class="keywordflow">if</span> (size == <span class="keyword">sizeof</span>(equipment))
<a name="l02027"></a>02027                <a class="code" href="group__msectionh.html#gaae4cf88eaadf5d2dd9eefa3e1b6389e6">db_get_record</a>(hDB, hkeytmp, &amp;equipment, &amp;size, 0);
<a name="l02028"></a>02028          }
<a name="l02029"></a>02029 
<a name="l02030"></a>02030          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hsubkey, <span class="stringliteral">&quot;Statistics&quot;</span>, &amp;hkeytmp);
<a name="l02031"></a>02031 
<a name="l02032"></a>02032          <span class="keywordflow">if</span> (hkeytmp) {
<a name="l02033"></a>02033             <a class="code" href="group__msectionh.html#ga1880903c0ebb0d58809f48f6b2d59704">db_get_record_size</a>(hDB, hkeytmp, 0, &amp;size);
<a name="l02034"></a>02034             <span class="keywordflow">if</span> (size == <span class="keyword">sizeof</span>(equipment_stats))
<a name="l02035"></a>02035                <a class="code" href="group__msectionh.html#gaae4cf88eaadf5d2dd9eefa3e1b6389e6">db_get_record</a>(hDB, hkeytmp, &amp;equipment_stats, &amp;size, 0);
<a name="l02036"></a>02036          }
<a name="l02037"></a>02037 
<a name="l02038"></a>02038          <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l02039"></a>02039             sprintf(ref, <span class="stringliteral">&quot;/SC/%s?exp=%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l02040"></a>02040          <span class="keywordflow">else</span>
<a name="l02041"></a>02041             sprintf(ref, <span class="stringliteral">&quot;/SC/%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l02042"></a>02042 
<a name="l02043"></a>02043          <span class="comment">/* check if client running this equipment is present */</span>
<a name="l02044"></a>02044          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#gafe2e23ec2e5c20fbc65ee238bd6cd48e">cm_exist</a>(equipment.<a class="code" href="group__midasincludecode.html#ga2cfd04e323109fe1cbb75ca8047aaa77">frontend_name</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a> &amp;&amp;
<a name="l02045"></a>02045              <a class="code" href="group__msectionh.html#gafe2e23ec2e5c20fbc65ee238bd6cd48e">cm_exist</a>(<span class="stringliteral">&quot;FAL&quot;</span>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l02046"></a>02046             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02047"></a>02047                 (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;&lt;a href=\&quot;%s\&quot;&gt;%s&lt;/a&gt;&lt;td align=center bgcolor=#FF0000&gt;(inactive)&quot;</span>,
<a name="l02048"></a>02048                  ref, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l02049"></a>02049          <span class="keywordflow">else</span> {
<a name="l02050"></a>02050             <span class="keywordflow">if</span> (equipment.<a class="code" href="group__midasincludecode.html#ga512d7966d5f96f8c75fec4ba1b1946c4">enabled</a>)
<a name="l02051"></a>02051                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02052"></a>02052                    (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;&lt;a href=\&quot;%s\&quot;&gt;%s&lt;/a&gt;&lt;td align=center bgcolor=#00FF00&gt;%s@%s&quot;</span>,
<a name="l02053"></a>02053                     ref, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, equipment.<a class="code" href="group__midasincludecode.html#ga2cfd04e323109fe1cbb75ca8047aaa77">frontend_name</a>, equipment.<a class="code" href="group__midasincludecode.html#ga0f7f20fef7826740571d2ffa82da4dfd">frontend_host</a>);
<a name="l02054"></a>02054             <span class="keywordflow">else</span>
<a name="l02055"></a>02055                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02056"></a>02056                    (<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;&lt;a href=\&quot;%s\&quot;&gt;%s&lt;/a&gt;&lt;td align=center bgcolor=#FFFF00&gt;%s@%s&quot;</span>,
<a name="l02057"></a>02057                     ref, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, equipment.<a class="code" href="group__midasincludecode.html#ga2cfd04e323109fe1cbb75ca8047aaa77">frontend_name</a>, equipment.<a class="code" href="group__midasincludecode.html#ga0f7f20fef7826740571d2ffa82da4dfd">frontend_host</a>);
<a name="l02058"></a>02058          }
<a name="l02059"></a>02059 
<a name="l02060"></a>02060          <span class="comment">/* event statistics */</span>
<a name="l02061"></a>02061          d = equipment_stats.<a class="code" href="structEQUIPMENT__STATS.html#a6e140b7938891bd8452fdf0217815ddd">events_sent</a>;
<a name="l02062"></a>02062          <span class="keywordflow">if</span> (d &gt; 1E9)
<a name="l02063"></a>02063             sprintf(str, <span class="stringliteral">&quot;%1.3lfG&quot;</span>, d / 1E9);
<a name="l02064"></a>02064          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d &gt; 1E6)
<a name="l02065"></a>02065             sprintf(str, <span class="stringliteral">&quot;%1.3lfM&quot;</span>, d / 1E6);
<a name="l02066"></a>02066          <span class="keywordflow">else</span>
<a name="l02067"></a>02067             sprintf(str, <span class="stringliteral">&quot;%1.0lf&quot;</span>, d);
<a name="l02068"></a>02068 
<a name="l02069"></a>02069          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;%s&lt;td align=center&gt;%1.1lf&lt;td align=center&gt;%1.1lf\n&quot;</span>,
<a name="l02070"></a>02070                   str, equipment_stats.<a class="code" href="group__midasincludecode.html#ga218c744ea441413af262fbd5ddf3780f">events_per_sec</a>, equipment_stats.<a class="code" href="group__midasincludecode.html#ga7a7a7d4b78841a36d156a0941616538f">kbytes_per_sec</a>);
<a name="l02071"></a>02071 
<a name="l02072"></a>02072          <span class="comment">/* check if /Analyzer is defined */</span>
<a name="l02073"></a>02073          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Analyzer&quot;</span>, &amp;hkeytmp) == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l02074"></a>02074             <span class="comment">/* get analyzed ratio */</span>
<a name="l02075"></a>02075             analyze_ratio = 0;
<a name="l02076"></a>02076             sprintf(ref, <span class="stringliteral">&quot;/Analyzer/%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l02077"></a>02077             <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, ref, &amp;hkeytmp);
<a name="l02078"></a>02078             <span class="keywordflow">if</span> (hkeytmp) {
<a name="l02079"></a>02079                size = <span class="keyword">sizeof</span>(double);
<a name="l02080"></a>02080                <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hkeytmp, <span class="stringliteral">&quot;Statistics/Events received&quot;</span>,
<a name="l02081"></a>02081                                 &amp;analyzed, &amp;size, <a class="code" href="group__mdefineh.html#ga13378fa303cf601b4b491866a6688362">TID_DOUBLE</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a> &amp;&amp;
<a name="l02082"></a>02082                    equipment_stats.<a class="code" href="structEQUIPMENT__STATS.html#a6e140b7938891bd8452fdf0217815ddd">events_sent</a> &gt; 0)
<a name="l02083"></a>02083                   analyze_ratio = analyzed / equipment_stats.<a class="code" href="structEQUIPMENT__STATS.html#a6e140b7938891bd8452fdf0217815ddd">events_sent</a>;
<a name="l02084"></a>02084                <a class="code" href="generate-MODULES_8h.html#aaac43492f2954cc70dd9a286b2b3ab02">if</a> (analyze_ratio &gt; 1)
<a name="l02085"></a>02085                   analyze_ratio = 1;
<a name="l02086"></a>02086             }
<a name="l02087"></a>02087 
<a name="l02088"></a>02088             <span class="comment">/* check if analyzer is running */</span>
<a name="l02089"></a>02089             <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#gafe2e23ec2e5c20fbc65ee238bd6cd48e">cm_exist</a>(<span class="stringliteral">&quot;Analyzer&quot;</span>, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) == <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a> ||
<a name="l02090"></a>02090                 <a class="code" href="group__msectionh.html#gafe2e23ec2e5c20fbc65ee238bd6cd48e">cm_exist</a>(<span class="stringliteral">&quot;FAL&quot;</span>, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) == <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l02091"></a>02091                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center bgcolor=#00FF00&gt;%3.1lf%%&lt;/tr&gt;\n&quot;</span>,
<a name="l02092"></a>02092                         analyze_ratio * 100.0);
<a name="l02093"></a>02093             <span class="keywordflow">else</span>
<a name="l02094"></a>02094                <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center bgcolor=#FF0000&gt;%3.1lf%%&lt;/tr&gt;\n&quot;</span>,
<a name="l02095"></a>02095                         analyze_ratio * 100.0);
<a name="l02096"></a>02096          } <span class="keywordflow">else</span> {
<a name="l02097"></a>02097             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;N/A&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>);
<a name="l02098"></a>02098          }
<a name="l02099"></a>02099       }
<a name="l02100"></a>02100    }
<a name="l02101"></a>02101 
<a name="l02102"></a>02102    <span class="comment">/*---- Logging channels ----*/</span>
<a name="l02103"></a>02103 
<a name="l02104"></a>02104    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02105"></a>02105        (<span class="stringliteral">&quot;&lt;tr&gt;&lt;th colspan=2&gt;Channel&lt;th&gt;Active&lt;th&gt;Events&lt;th&gt;MB written&lt;th&gt;GB total&lt;/tr&gt;\n&quot;</span>);
<a name="l02106"></a>02106 
<a name="l02107"></a>02107    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Channels&quot;</span>, &amp;hkey) == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l02108"></a>02108       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l02109"></a>02109          <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkey, i, &amp;hsubkey);
<a name="l02110"></a>02110          <span class="keywordflow">if</span> (!hsubkey)
<a name="l02111"></a>02111             <span class="keywordflow">break</span>;
<a name="l02112"></a>02112 
<a name="l02113"></a>02113          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hsubkey, &amp;key);
<a name="l02114"></a>02114 
<a name="l02115"></a>02115          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hsubkey, <span class="stringliteral">&quot;Settings&quot;</span>, &amp;hkeytmp);
<a name="l02116"></a>02116          size = <span class="keyword">sizeof</span>(chn_settings);
<a name="l02117"></a>02117          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#gaae4cf88eaadf5d2dd9eefa3e1b6389e6">db_get_record</a>(hDB, hkeytmp, &amp;chn_settings, &amp;size, 0) != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l02118"></a>02118             <span class="keywordflow">continue</span>;
<a name="l02119"></a>02119 
<a name="l02120"></a>02120          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, hsubkey, <span class="stringliteral">&quot;Statistics&quot;</span>, &amp;hkeytmp);
<a name="l02121"></a>02121          size = <span class="keyword">sizeof</span>(chn_stats);
<a name="l02122"></a>02122          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#gaae4cf88eaadf5d2dd9eefa3e1b6389e6">db_get_record</a>(hDB, hkeytmp, &amp;chn_stats, &amp;size, 0) != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l02123"></a>02123             <span class="keywordflow">continue</span>;
<a name="l02124"></a>02124 
<a name="l02125"></a>02125          <span class="comment">/* filename */</span>
<a name="l02126"></a>02126 
<a name="l02127"></a>02127          strcpy(str, chn_settings.<a class="code" href="structCHN__SETTINGS.html#aa7ae03d4f3f6ab73e4efb06e41afc6e4">current_filename</a>);
<a name="l02128"></a>02128 
<a name="l02129"></a>02129          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(chn_settings.<a class="code" href="structCHN__SETTINGS.html#a31d67c6b375c371bfbd627ef53cb5f26">type</a>, <span class="stringliteral">&quot;FTP&quot;</span>)) {
<a name="l02130"></a>02130             <span class="keywordtype">char</span> *token, orig[256];
<a name="l02131"></a>02131 
<a name="l02132"></a>02132             strcpy(orig, str);
<a name="l02133"></a>02133 
<a name="l02134"></a>02134             strcpy(str, <span class="stringliteral">&quot;ftp://&quot;</span>);
<a name="l02135"></a>02135             token = strtok(orig, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l02136"></a>02136             <span class="keywordflow">if</span> (token) {
<a name="l02137"></a>02137                strcat(str, token);
<a name="l02138"></a>02138                token = strtok(NULL, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l02139"></a>02139                token = strtok(NULL, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l02140"></a>02140                token = strtok(NULL, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l02141"></a>02141                token = strtok(NULL, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l02142"></a>02142                <span class="keywordflow">if</span> (token) {
<a name="l02143"></a>02143                   strcat(str, <span class="stringliteral">&quot;/&quot;</span>);
<a name="l02144"></a>02144                   strcat(str, token);
<a name="l02145"></a>02145                   strcat(str, <span class="stringliteral">&quot;/&quot;</span>);
<a name="l02146"></a>02146                   token = strtok(NULL, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l02147"></a>02147                   strcat(str, token);
<a name="l02148"></a>02148                }
<a name="l02149"></a>02149             }
<a name="l02150"></a>02150          }
<a name="l02151"></a>02151 
<a name="l02152"></a>02152          <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l02153"></a>02153             sprintf(ref, <span class="stringliteral">&quot;/Logger/Channels/%s/Settings?exp=%s&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l02154"></a>02154          <span class="keywordflow">else</span>
<a name="l02155"></a>02155             sprintf(ref, <span class="stringliteral">&quot;/Logger/Channels/%s/Settings&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l02156"></a>02156 
<a name="l02157"></a>02157          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2&gt;&lt;B&gt;&lt;a href=\&quot;%s\&quot;&gt;%s&lt;/a&gt;&lt;/B&gt; %s&quot;</span>, ref, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>,
<a name="l02158"></a>02158                   str);
<a name="l02159"></a>02159 
<a name="l02160"></a>02160          <span class="comment">/* active */</span>
<a name="l02161"></a>02161 
<a name="l02162"></a>02162          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#gafe2e23ec2e5c20fbc65ee238bd6cd48e">cm_exist</a>(<span class="stringliteral">&quot;Logger&quot;</span>, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a> &amp;&amp;
<a name="l02163"></a>02163              <a class="code" href="group__msectionh.html#gafe2e23ec2e5c20fbc65ee238bd6cd48e">cm_exist</a>(<span class="stringliteral">&quot;FAL&quot;</span>, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
<a name="l02164"></a>02164             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center bgcolor=\&quot;FF0000\&quot;&gt;No Logger&quot;</span>);
<a name="l02165"></a>02165          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!flag)
<a name="l02166"></a>02166             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center bgcolor=\&quot;FFFF00\&quot;&gt;Disabled&quot;</span>);
<a name="l02167"></a>02167          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (chn_settings.<a class="code" href="structCHN__SETTINGS.html#a31fa5da7e6a57c007052a5088d9068b0">active</a>)
<a name="l02168"></a>02168             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center bgcolor=\&quot;00FF00\&quot;&gt;Yes&quot;</span>);
<a name="l02169"></a>02169          <span class="keywordflow">else</span>
<a name="l02170"></a>02170             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center bgcolor=\&quot;FFFF00\&quot;&gt;No&quot;</span>);
<a name="l02171"></a>02171 
<a name="l02172"></a>02172          <span class="comment">/* statistics */</span>
<a name="l02173"></a>02173 
<a name="l02174"></a>02174          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02175"></a>02175              (<span class="stringliteral">&quot;&lt;td align=center&gt;%1.0lf&lt;td align=center&gt;%1.3lf&lt;td align=center&gt;%1.3lf&lt;/tr&gt;\n&quot;</span>,
<a name="l02176"></a>02176               chn_stats.<a class="code" href="structCHN__STATISTICS.html#aa314b315e3b535e7442803526c7c515d">events_written</a>, chn_stats.<a class="code" href="structCHN__STATISTICS.html#a7f50d67aca6cc223a2049e75b67e62f0">bytes_written</a> / 1024 / 1024,
<a name="l02177"></a>02177               chn_stats.<a class="code" href="structCHN__STATISTICS.html#a4781a92eaf28c8718c72f092d2cbfcd1">bytes_written_total</a> / 1024 / 1024 / 1024);
<a name="l02178"></a>02178       }
<a name="l02179"></a>02179    }
<a name="l02180"></a>02180 
<a name="l02181"></a>02181    <span class="comment">/*---- Lazy Logger ----*/</span>
<a name="l02182"></a>02182 
<a name="l02183"></a>02183    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Lazy&quot;</span>, &amp;hkey) == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l02184"></a>02184       status = <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;System/Clients&quot;</span>, &amp;hkey);
<a name="l02185"></a>02185       <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l02186"></a>02186          <span class="keywordflow">return</span>;
<a name="l02187"></a>02187 
<a name="l02188"></a>02188       k = 0;
<a name="l02189"></a>02189       previous_mode = -1;
<a name="l02190"></a>02190       <span class="comment">/* loop over all clients */</span>
<a name="l02191"></a>02191       <span class="keywordflow">for</span> (j = 0;; j++) {
<a name="l02192"></a>02192          status = <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkey, j, &amp;hsubkey);
<a name="l02193"></a>02193          <span class="keywordflow">if</span> (status == <a class="code" href="group__err23.html#gaf2249d36fd8ffb254cd33a3bbc899638">DB_NO_MORE_SUBKEYS</a>)
<a name="l02194"></a>02194             <span class="keywordflow">break</span>;
<a name="l02195"></a>02195 
<a name="l02196"></a>02196          <span class="keywordflow">if</span> (status == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l02197"></a>02197             <span class="comment">/* get client name */</span>
<a name="l02198"></a>02198             size = <span class="keyword">sizeof</span>(client_name);
<a name="l02199"></a>02199             <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hsubkey, <span class="stringliteral">&quot;Name&quot;</span>, client_name, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02200"></a>02200             client_name[4] = 0; <span class="comment">/* search only for the 4 first char */</span>
<a name="l02201"></a>02201             <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(client_name, <span class="stringliteral">&quot;Lazy&quot;</span>)) {
<a name="l02202"></a>02202                sprintf(str, <span class="stringliteral">&quot;/Lazy/%s&quot;</span>, &amp;client_name[5]);
<a name="l02203"></a>02203                status = <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hLKey);
<a name="l02204"></a>02204                <span class="keywordflow">if</span> (status == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l02205"></a>02205                   size = <span class="keyword">sizeof</span>(str);
<a name="l02206"></a>02206                   <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hLKey, <span class="stringliteral">&quot;Settings/Backup Type&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>,
<a name="l02207"></a>02207                                <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02208"></a>02208                   ftp_mode = <a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, <span class="stringliteral">&quot;FTP&quot;</span>);
<a name="l02209"></a>02209 
<a name="l02210"></a>02210                   <span class="keywordflow">if</span> (previous_mode != ftp_mode)
<a name="l02211"></a>02211                      k = 0;
<a name="l02212"></a>02212                   <span class="keywordflow">if</span> (k == 0) {
<a name="l02213"></a>02213                      <span class="keywordflow">if</span> (ftp_mode)
<a name="l02214"></a>02214                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02215"></a>02215                             (<span class="stringliteral">&quot;&lt;tr&gt;&lt;th colspan=2&gt;Lazy Destination&lt;th&gt;Progress&lt;th&gt;File Name&lt;th&gt;Speed [kb/s]&lt;th&gt;Total&lt;/tr&gt;\n&quot;</span>);
<a name="l02216"></a>02216                      <span class="keywordflow">else</span>
<a name="l02217"></a>02217                         <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l02218"></a>02218                             (<span class="stringliteral">&quot;&lt;tr&gt;&lt;th colspan=2&gt;Lazy Label&lt;th&gt;Progress&lt;th&gt;File Name&lt;th&gt;# Files&lt;th&gt;Total&lt;/tr&gt;\n&quot;</span>);
<a name="l02219"></a>02219                   }
<a name="l02220"></a>02220                   previous_mode = ftp_mode;
<a name="l02221"></a>02221                   <span class="keywordflow">if</span> (ftp_mode) {
<a name="l02222"></a>02222                      size = <span class="keyword">sizeof</span>(str);
<a name="l02223"></a>02223                      <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hLKey, <span class="stringliteral">&quot;Settings/Path&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>,
<a name="l02224"></a>02224                                   <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02225"></a>02225                      <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;,&apos;</span>))
<a name="l02226"></a>02226                         *strchr(str, <span class="charliteral">&apos;,&apos;</span>) = 0;
<a name="l02227"></a>02227                   } <span class="keywordflow">else</span> {
<a name="l02228"></a>02228                      size = <span class="keyword">sizeof</span>(str);
<a name="l02229"></a>02229                      <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hLKey, <span class="stringliteral">&quot;Settings/List Label&quot;</span>, str, &amp;size,
<a name="l02230"></a>02230                                   <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02231"></a>02231                      <span class="keywordflow">if</span> (str[0] == 0)
<a name="l02232"></a>02232                         strcpy(str, <span class="stringliteral">&quot;(empty)&quot;</span>);
<a name="l02233"></a>02233                   }
<a name="l02234"></a>02234 
<a name="l02235"></a>02235                   <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l02236"></a>02236                      sprintf(ref, <span class="stringliteral">&quot;/Lazy/%s/Settings?exp=%s&quot;</span>, &amp;client_name[5], <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l02237"></a>02237                   <span class="keywordflow">else</span>
<a name="l02238"></a>02238                      sprintf(ref, <span class="stringliteral">&quot;/Lazy/%s/Settings&quot;</span>, &amp;client_name[5]);
<a name="l02239"></a>02239 
<a name="l02240"></a>02240                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=2&gt;&lt;B&gt;&lt;a href=\&quot;%s\&quot;&gt;%s&lt;/a&gt;&lt;/B&gt;&quot;</span>, ref, str);
<a name="l02241"></a>02241 
<a name="l02242"></a>02242                   size = <span class="keyword">sizeof</span>(value);
<a name="l02243"></a>02243                   <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hLKey, <span class="stringliteral">&quot;Statistics/Copy progress [%]&quot;</span>, &amp;value, &amp;size,
<a name="l02244"></a>02244                                <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02245"></a>02245                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;%1.0f %%&quot;</span>, value);
<a name="l02246"></a>02246 
<a name="l02247"></a>02247                   size = <span class="keyword">sizeof</span>(str);
<a name="l02248"></a>02248                   <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hLKey, <span class="stringliteral">&quot;Statistics/Backup File&quot;</span>, str, &amp;size,
<a name="l02249"></a>02249                                <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02250"></a>02250                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;%s&quot;</span>, str);
<a name="l02251"></a>02251 
<a name="l02252"></a>02252                   <span class="keywordflow">if</span> (ftp_mode) {
<a name="l02253"></a>02253                      size = <span class="keyword">sizeof</span>(value);
<a name="l02254"></a>02254                      <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hLKey, <span class="stringliteral">&quot;Statistics/Copy Rate [bytes per s]&quot;</span>,
<a name="l02255"></a>02255                                   &amp;value, &amp;size, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02256"></a>02256                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;%1.1f&quot;</span>, value / 1024.0f);
<a name="l02257"></a>02257                   } <span class="keywordflow">else</span> {
<a name="l02258"></a>02258                      size = <span class="keyword">sizeof</span>(i);
<a name="l02259"></a>02259                      <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hLKey, <span class="stringliteral">&quot;/Statistics/Number of files&quot;</span>, &amp;i, &amp;size,
<a name="l02260"></a>02260                                   <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02261"></a>02261                      <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;%d&quot;</span>, i);
<a name="l02262"></a>02262                   }
<a name="l02263"></a>02263 
<a name="l02264"></a>02264                   size = <span class="keyword">sizeof</span>(value);
<a name="l02265"></a>02265                   <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hLKey, <span class="stringliteral">&quot;Statistics/Backup status [%]&quot;</span>, &amp;value, &amp;size,
<a name="l02266"></a>02266                                <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02267"></a>02267                   <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td align=center&gt;%1.1f %%&quot;</span>, value);
<a name="l02268"></a>02268                   k++;
<a name="l02269"></a>02269                }
<a name="l02270"></a>02270             }
<a name="l02271"></a>02271          }
<a name="l02272"></a>02272       }
<a name="l02273"></a>02273 
<a name="l02274"></a>02274       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l02275"></a>02275    }
<a name="l02276"></a>02276 
<a name="l02277"></a>02277    <span class="comment">/*---- Messages ----*/</span>
<a name="l02278"></a>02278 
<a name="l02279"></a>02279    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr&gt;&lt;td colspan=6&gt;&quot;</span>);
<a name="l02280"></a>02280 
<a name="l02281"></a>02281    <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#acdef68f81e8b732531ba7f1de9d73fc5">message_buffer</a>[0]) {
<a name="l02282"></a>02282 
<a name="l02283"></a>02283       <span class="keywordflow">if</span> (strchr(<a class="code" href="mhttpd_8c.html#acdef68f81e8b732531ba7f1de9d73fc5">message_buffer</a>+9, <span class="charliteral">&apos;[&apos;</span>) &amp;&amp; strchr(<a class="code" href="mhttpd_8c.html#acdef68f81e8b732531ba7f1de9d73fc5">message_buffer</a>+9, <span class="charliteral">&apos;:&apos;</span>))
<a name="l02284"></a>02284          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;span style=\&quot;color:white;background-color:red\&quot;&gt;&lt;b&gt;%s&lt;/b&gt;&lt;/span&gt;&quot;</span>, <a class="code" href="mhttpd_8c.html#acdef68f81e8b732531ba7f1de9d73fc5">message_buffer</a>);
<a name="l02285"></a>02285       <span class="keywordflow">else</span>
<a name="l02286"></a>02286          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;b&gt;%s&lt;/b&gt;&quot;</span>, <a class="code" href="mhttpd_8c.html#acdef68f81e8b732531ba7f1de9d73fc5">message_buffer</a>);
<a name="l02287"></a>02287    }
<a name="l02288"></a>02288 
<a name="l02289"></a>02289    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>);
<a name="l02290"></a>02290 
<a name="l02291"></a>02291    <span class="comment">/*---- Clients ----*/</span>
<a name="l02292"></a>02292 
<a name="l02293"></a>02293    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/System/Clients&quot;</span>, &amp;hkey) == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l02294"></a>02294       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l02295"></a>02295          <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkey, i, &amp;hsubkey);
<a name="l02296"></a>02296          <span class="keywordflow">if</span> (!hsubkey)
<a name="l02297"></a>02297             <span class="keywordflow">break</span>;
<a name="l02298"></a>02298 
<a name="l02299"></a>02299          <span class="keywordflow">if</span> (i % 3 == 0)
<a name="l02300"></a>02300             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;tr bgcolor=#E0E0FF&gt;&quot;</span>);
<a name="l02301"></a>02301 
<a name="l02302"></a>02302          size = <span class="keyword">sizeof</span>(name);
<a name="l02303"></a>02303          <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hsubkey, <span class="stringliteral">&quot;Name&quot;</span>, name, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02304"></a>02304          size = <span class="keyword">sizeof</span>(str);
<a name="l02305"></a>02305          <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, hsubkey, <span class="stringliteral">&quot;Host&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l02306"></a>02306 
<a name="l02307"></a>02307          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;td colspan=2 align=center&gt;%s [%s]&quot;</span>, name, str);
<a name="l02308"></a>02308 
<a name="l02309"></a>02309          <span class="keywordflow">if</span> (i % 3 == 2)
<a name="l02310"></a>02310             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l02311"></a>02311       }
<a name="l02312"></a>02312 
<a name="l02313"></a>02313       <span class="keywordflow">if</span> (i % 3 != 0)
<a name="l02314"></a>02314          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>);
<a name="l02315"></a>02315    }
<a name="l02316"></a>02316 
<a name="l02317"></a>02317    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>);
<a name="l02318"></a>02318    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>);
<a name="l02319"></a>02319 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af374dce40baae97a533a83a0626c23dc"></a><!-- doxytag: member="mhttpd.c::strencode" ref="af374dce40baae97a533a83a0626c23dc" args="(char *text)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void strencode </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>text</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l02421">2421</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mdump_8c_source.html#l00115">i</a>, and <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l06375">show_alarm_page()</a>, <a class="el" href="mhttpd_8c_source.html#l03003">show_elog_submit_query()</a>, and <a class="el" href="mhttpd_8c_source.html#l05737">show_odb_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02422"></a>02422 {
<a name="l02423"></a>02423    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l02424"></a>02424 
<a name="l02425"></a>02425    <span class="keywordflow">for</span> (i = 0; i &lt; (int) strlen(text); i++) {
<a name="l02426"></a>02426       <span class="keywordflow">switch</span> (text[i]) {
<a name="l02427"></a>02427       <span class="keywordflow">case</span> <span class="charliteral">&apos;\n&apos;</span>:
<a name="l02428"></a>02428          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;br&gt;\n&quot;</span>);
<a name="l02429"></a>02429          <span class="keywordflow">break</span>;
<a name="l02430"></a>02430       <span class="keywordflow">case</span> <span class="charliteral">&apos;&lt;&apos;</span>:
<a name="l02431"></a>02431          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&amp;lt;&quot;</span>);
<a name="l02432"></a>02432          <span class="keywordflow">break</span>;
<a name="l02433"></a>02433       <span class="keywordflow">case</span> <span class="charliteral">&apos;&gt;&apos;</span>:
<a name="l02434"></a>02434          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&amp;gt;&quot;</span>);
<a name="l02435"></a>02435          <span class="keywordflow">break</span>;
<a name="l02436"></a>02436       <span class="keywordflow">case</span> <span class="charliteral">&apos;&amp;&apos;</span>:
<a name="l02437"></a>02437          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&amp;amp;&quot;</span>);
<a name="l02438"></a>02438          <span class="keywordflow">break</span>;
<a name="l02439"></a>02439       <span class="keywordflow">case</span> <span class="charliteral">&apos;\&quot;&apos;</span>:
<a name="l02440"></a>02440          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&amp;quot;&quot;</span>);
<a name="l02441"></a>02441          <span class="keywordflow">break</span>;
<a name="l02442"></a>02442       <span class="keywordflow">default</span>:
<a name="l02443"></a>02443          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;%c&quot;</span>, text[i]);
<a name="l02444"></a>02444       }
<a name="l02445"></a>02445    }
<a name="l02446"></a>02446 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7497f3d4247306f2eabccaf53748ca43"></a><!-- doxytag: member="mhttpd.c::strencode2" ref="a7497f3d4247306f2eabccaf53748ca43" args="(char *b, char *text)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void strencode2 </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>text</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l02450">2450</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mdump_8c_source.html#l00115">i</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l03707">gen_odb_attachment()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02451"></a>02451 {
<a name="l02452"></a>02452    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l02453"></a>02453 
<a name="l02454"></a>02454    <span class="keywordflow">for</span> (i = 0; i &lt; (int) strlen(text); b++, i++) {
<a name="l02455"></a>02455       <span class="keywordflow">switch</span> (text[i]) {
<a name="l02456"></a>02456       <span class="keywordflow">case</span> <span class="charliteral">&apos;\n&apos;</span>:
<a name="l02457"></a>02457          sprintf(b, <span class="stringliteral">&quot;&lt;br&gt;\n&quot;</span>);
<a name="l02458"></a>02458          <span class="keywordflow">break</span>;
<a name="l02459"></a>02459       <span class="keywordflow">case</span> <span class="charliteral">&apos;&lt;&apos;</span>:
<a name="l02460"></a>02460          sprintf(b, <span class="stringliteral">&quot;&amp;lt;&quot;</span>);
<a name="l02461"></a>02461          <span class="keywordflow">break</span>;
<a name="l02462"></a>02462       <span class="keywordflow">case</span> <span class="charliteral">&apos;&gt;&apos;</span>:
<a name="l02463"></a>02463          sprintf(b, <span class="stringliteral">&quot;&amp;gt;&quot;</span>);
<a name="l02464"></a>02464          <span class="keywordflow">break</span>;
<a name="l02465"></a>02465       <span class="keywordflow">case</span> <span class="charliteral">&apos;&amp;&apos;</span>:
<a name="l02466"></a>02466          sprintf(b, <span class="stringliteral">&quot;&amp;amp;&quot;</span>);
<a name="l02467"></a>02467          <span class="keywordflow">break</span>;
<a name="l02468"></a>02468       <span class="keywordflow">case</span> <span class="charliteral">&apos;\&quot;&apos;</span>:
<a name="l02469"></a>02469          sprintf(b, <span class="stringliteral">&quot;&amp;quot;&quot;</span>);
<a name="l02470"></a>02470          <span class="keywordflow">break</span>;
<a name="l02471"></a>02471       <span class="keywordflow">default</span>:
<a name="l02472"></a>02472          sprintf(b, <span class="stringliteral">&quot;%c&quot;</span>, text[i]);
<a name="l02473"></a>02473       }
<a name="l02474"></a>02474    }
<a name="l02475"></a>02475    *b = 0;
<a name="l02476"></a>02476 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac66e5e8150fdd60c55a68d566f2f6228"></a><!-- doxytag: member="mhttpd.c::strencode3" ref="ac66e5e8150fdd60c55a68d566f2f6228" args="(char *text)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void strencode3 </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>text</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l02480">2480</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mdump_8c_source.html#l00115">i</a>, and <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l05737">show_odb_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02481"></a>02481 {
<a name="l02482"></a>02482    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l02483"></a>02483 
<a name="l02484"></a>02484    <span class="keywordflow">for</span> (i = 0; i &lt; (int) strlen(text); i++) {
<a name="l02485"></a>02485       <span class="keywordflow">switch</span> (text[i]) {
<a name="l02486"></a>02486       <span class="keywordflow">case</span> <span class="charliteral">&apos;&lt;&apos;</span>:
<a name="l02487"></a>02487          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&amp;lt;&quot;</span>);
<a name="l02488"></a>02488          <span class="keywordflow">break</span>;
<a name="l02489"></a>02489       <span class="keywordflow">case</span> <span class="charliteral">&apos;&gt;&apos;</span>:
<a name="l02490"></a>02490          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&amp;gt;&quot;</span>);
<a name="l02491"></a>02491          <span class="keywordflow">break</span>;
<a name="l02492"></a>02492       <span class="keywordflow">case</span> <span class="charliteral">&apos;&amp;&apos;</span>:
<a name="l02493"></a>02493          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&amp;amp;&quot;</span>);
<a name="l02494"></a>02494          <span class="keywordflow">break</span>;
<a name="l02495"></a>02495       <span class="keywordflow">case</span> <span class="charliteral">&apos;\&quot;&apos;</span>:
<a name="l02496"></a>02496          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&amp;quot;&quot;</span>);
<a name="l02497"></a>02497          <span class="keywordflow">break</span>;
<a name="l02498"></a>02498       <span class="keywordflow">default</span>:
<a name="l02499"></a>02499          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;%c&quot;</span>, text[i]);
<a name="l02500"></a>02500       }
<a name="l02501"></a>02501    }
<a name="l02502"></a>02502 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7da098af5efaf5b7e9f01e8d8a3d019a"></a><!-- doxytag: member="mhttpd.c::submit_elog" ref="a7da098af5efaf5b7e9f01e8d8a3d019a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void submit_elog </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l03805">3805</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mhttpd_8c_source.html#l00887">_attachment_buffer</a>, <a class="el" href="mhttpd_8c_source.html#l00888">_attachment_size</a>, <a class="el" href="fal_8c_source.html#l00201">buffer</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="midas_8c_source.html#l15064">el_submit()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00328">exp_name</a>, <a class="el" href="mhttpd_8c_source.html#l03707">gen_odb_attachment()</a>, <a class="el" href="mana_8cpp_source.html#l00800">getparam()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00327">host_name</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="midas_8h_source.html#l01755">M_FREE</a>, <a class="el" href="midas_8h_source.html#l01753">M_MALLOC</a>, <a class="el" href="msystem_8h_source.html#l00351">O_BINARY</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00256">read</a>, <a class="el" href="mhttpd_8c_source.html#l00889">remote_addr</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="sendmail_8c_source.html#l00106">sendmail()</a>, <a class="el" href="mhttpd_8c_source.html#l01042">setparam()</a>, <a class="el" href="mhttpd_8c_source.html#l01557">show_error()</a>, <a class="el" href="mhttpd_8c_source.html#l08606">show_hist_page()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="mscb_8c_source.html#l00445">strlcat()</a>, <a class="el" href="mhist_8c_source.html#l00102">tag</a>, <a class="el" href="mhttpd_8c_source.html#l00876">tcp_port</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, <a class="el" href="mhttpd_8c_source.html#l01103">unsetparam()</a>, and <a class="el" href="mhttpd_8c_source.html#l01119">urlDecode()</a>.</p>

<p>Referenced by <a class="el" href="melog_8c_source.html#l00370">main()</a>, <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>, and <a class="el" href="mhttpd_8c_source.html#l04034">submit_form()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03806"></a>03806 {
<a name="l03807"></a>03807    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[80], author[256], path[256], path1[256];
<a name="l03808"></a>03808    <span class="keywordtype">char</span> mail_to[256], mail_from[256], mail_text[10000], mail_list[256],
<a name="l03809"></a>03809        smtp_host[256], <a class="code" href="mhist_8c.html#a27ce05f73a16e6abc070da1007833b9b">tag</a>[80], mail_param[1000];
<a name="l03810"></a>03810    <span class="keywordtype">char</span> *<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>[3], *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>, *pitem;
<a name="l03811"></a>03811    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey;
<a name="l03812"></a>03812    <span class="keywordtype">char</span> att_file[3][256];
<a name="l03813"></a>03813    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, fh, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, n_mail, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>;
<a name="l03814"></a>03814    <span class="keyword">struct </span>hostent *phe;
<a name="l03815"></a>03815    <span class="keywordtype">char</span> mhttpd_full_url[256];
<a name="l03816"></a>03816 
<a name="l03817"></a>03817    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l03818"></a>03818    strcpy(att_file[0], <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;attachment0&quot;</span>));
<a name="l03819"></a>03819    strcpy(att_file[1], <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;attachment1&quot;</span>));
<a name="l03820"></a>03820    strcpy(att_file[2], <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;attachment2&quot;</span>));
<a name="l03821"></a>03821 
<a name="l03822"></a>03822    <span class="comment">/* check for author */</span>
<a name="l03823"></a>03823    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;author&quot;</span>) == 0) {
<a name="l03824"></a>03824       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l03825"></a>03825       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l03826"></a>03826       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l03827"></a>03827 
<a name="l03828"></a>03828       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;ELog Error&lt;/title&gt;&lt;/head&gt;\n&quot;</span>);
<a name="l03829"></a>03829       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;i&gt;Error: No author supplied.&lt;/i&gt;&lt;p&gt;\n&quot;</span>);
<a name="l03830"></a>03830       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Please go back and enter your name in the &lt;i&gt;author&lt;/i&gt; field.\n&quot;</span>);
<a name="l03831"></a>03831       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;\n&quot;</span>);
<a name="l03832"></a>03832       <span class="keywordflow">return</span>;
<a name="l03833"></a>03833    }
<a name="l03834"></a>03834 
<a name="l03835"></a>03835    <span class="comment">/* check for valid attachment files */</span>
<a name="l03836"></a>03836    <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {
<a name="l03837"></a>03837       buffer[i] = NULL;
<a name="l03838"></a>03838       sprintf(str, <span class="stringliteral">&quot;attachment%d&quot;</span>, i);
<a name="l03839"></a>03839       <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str) &amp;&amp; *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str) &amp;&amp; <a class="code" href="mhttpd_8c.html#a42dc7c4c704ca581c25ba7582da7e05e">_attachment_size</a>[i] == 0) {
<a name="l03840"></a>03840          <span class="comment">/* replace &apos;\&apos; by &apos;/&apos; */</span>
<a name="l03841"></a>03841          strcpy(path, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str));
<a name="l03842"></a>03842          strcpy(path1, path);
<a name="l03843"></a>03843          <span class="keywordflow">while</span> (strchr(path, <span class="charliteral">&apos;\\&apos;</span>))
<a name="l03844"></a>03844             *strchr(path, <span class="charliteral">&apos;\\&apos;</span>) = <span class="charliteral">&apos;/&apos;</span>;
<a name="l03845"></a>03845 
<a name="l03846"></a>03846          <span class="comment">/* check if valid ODB tree */</span>
<a name="l03847"></a>03847          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, path, &amp;hkey) == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l03848"></a>03848             buffer[i] = <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(100000);
<a name="l03849"></a>03849             <a class="code" href="mhttpd_8c.html#a58b44d117968b2a7b75adb40f95ea5bf">gen_odb_attachment</a>(path, buffer[i]);
<a name="l03850"></a>03850             strcpy(att_file[i], path);
<a name="l03851"></a>03851             strcat(att_file[i], <span class="stringliteral">&quot;.html&quot;</span>);
<a name="l03852"></a>03852             <a class="code" href="mhttpd_8c.html#a4d08376c0479b1115d6c07cf263459af">_attachment_buffer</a>[i] = buffer[i];
<a name="l03853"></a>03853             <a class="code" href="mhttpd_8c.html#a42dc7c4c704ca581c25ba7582da7e05e">_attachment_size</a>[i] = strlen(buffer[i]) + 1;
<a name="l03854"></a>03854          }
<a name="l03855"></a>03855          <span class="comment">/* check if local file */</span>
<a name="l03856"></a>03856          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((fh = open(path1, O_RDONLY | <a class="code" href="group__msystemincludecode.html#ga36fa9b2e726512bc17a7a6d3e39002be">O_BINARY</a>)) &gt;= 0) {
<a name="l03857"></a>03857             size = lseek(fh, 0, SEEK_END);
<a name="l03858"></a>03858             buffer[i] = <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(size);
<a name="l03859"></a>03859             lseek(fh, 0, SEEK_SET);
<a name="l03860"></a>03860             <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, buffer[i], size);
<a name="l03861"></a>03861             close(fh);
<a name="l03862"></a>03862             strcpy(att_file[i], path);
<a name="l03863"></a>03863             <a class="code" href="mhttpd_8c.html#a4d08376c0479b1115d6c07cf263459af">_attachment_buffer</a>[i] = buffer[i];
<a name="l03864"></a>03864             <a class="code" href="mhttpd_8c.html#a42dc7c4c704ca581c25ba7582da7e05e">_attachment_size</a>[i] = size;
<a name="l03865"></a>03865          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(path, <span class="stringliteral">&quot;/HS/&quot;</span>, 4) == 0) {
<a name="l03866"></a>03866             buffer[i] = <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(100000);
<a name="l03867"></a>03867             size = 100000;
<a name="l03868"></a>03868             strcpy(str, path + 4);
<a name="l03869"></a>03869             <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;?&apos;</span>)) {
<a name="l03870"></a>03870                p = strchr(str, <span class="charliteral">&apos;?&apos;</span>) + 1;
<a name="l03871"></a>03871                p = strtok(p, <span class="stringliteral">&quot;&amp;&quot;</span>);
<a name="l03872"></a>03872                <span class="keywordflow">while</span> (p != NULL) {
<a name="l03873"></a>03873                   pitem = p;
<a name="l03874"></a>03874                   p = strchr(p, <span class="charliteral">&apos;=&apos;</span>);
<a name="l03875"></a>03875                   <span class="keywordflow">if</span> (p != NULL) {
<a name="l03876"></a>03876                      *p++ = 0;
<a name="l03877"></a>03877                      <a class="code" href="mhttpd_8c.html#a314e523b7d95b4a434216200167e5e0a">urlDecode</a>(pitem);
<a name="l03878"></a>03878                      <a class="code" href="mhttpd_8c.html#a314e523b7d95b4a434216200167e5e0a">urlDecode</a>(p);
<a name="l03879"></a>03879 
<a name="l03880"></a>03880                      <a class="code" href="mhttpd_8c.html#a2956fb85032748af9fb7f544a4fb6c93">setparam</a>(pitem, p);
<a name="l03881"></a>03881 
<a name="l03882"></a>03882                      p = strtok(NULL, <span class="stringliteral">&quot;&amp;&quot;</span>);
<a name="l03883"></a>03883                   }
<a name="l03884"></a>03884                }
<a name="l03885"></a>03885                *strchr(str, <span class="charliteral">&apos;?&apos;</span>) = 0;
<a name="l03886"></a>03886             }
<a name="l03887"></a>03887             <a class="code" href="mhttpd_8c.html#af3853f14404bead7ea2dbfa3683b6f1b">show_hist_page</a>(str, buffer[i], &amp;size, 0);
<a name="l03888"></a>03888             strcpy(att_file[i], str);
<a name="l03889"></a>03889             <a class="code" href="mhttpd_8c.html#a4d08376c0479b1115d6c07cf263459af">_attachment_buffer</a>[i] = buffer[i];
<a name="l03890"></a>03890             <a class="code" href="mhttpd_8c.html#a42dc7c4c704ca581c25ba7582da7e05e">_attachment_size</a>[i] = size;
<a name="l03891"></a>03891             <a class="code" href="mhttpd_8c.html#ad0587659617510bc64b05992882d7d9e">unsetparam</a>(<span class="stringliteral">&quot;scale&quot;</span>);
<a name="l03892"></a>03892             <a class="code" href="mhttpd_8c.html#ad0587659617510bc64b05992882d7d9e">unsetparam</a>(<span class="stringliteral">&quot;offset&quot;</span>);
<a name="l03893"></a>03893             <a class="code" href="mhttpd_8c.html#ad0587659617510bc64b05992882d7d9e">unsetparam</a>(<span class="stringliteral">&quot;width&quot;</span>);
<a name="l03894"></a>03894             <a class="code" href="mhttpd_8c.html#ad0587659617510bc64b05992882d7d9e">unsetparam</a>(<span class="stringliteral">&quot;index&quot;</span>);
<a name="l03895"></a>03895          } <span class="keywordflow">else</span> {
<a name="l03896"></a>03896             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l03897"></a>03897             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l03898"></a>03898             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l03899"></a>03899 
<a name="l03900"></a>03900             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;ELog Error&lt;/title&gt;&lt;/head&gt;\n&quot;</span>);
<a name="l03901"></a>03901             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;i&gt;Error: Attachment file &lt;i&gt;%s&lt;/i&gt; not valid.&lt;/i&gt;&lt;p&gt;\n&quot;</span>,
<a name="l03902"></a>03902                      <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str));
<a name="l03903"></a>03903             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>
<a name="l03904"></a>03904                 (<span class="stringliteral">&quot;Please go back and enter a proper filename (use the &lt;b&gt;Browse&lt;/b&gt; button).\n&quot;</span>);
<a name="l03905"></a>03905             <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;\n&quot;</span>);
<a name="l03906"></a>03906             <span class="keywordflow">return</span>;
<a name="l03907"></a>03907          }
<a name="l03908"></a>03908       }
<a name="l03909"></a>03909    }
<a name="l03910"></a>03910 
<a name="l03911"></a>03911    <span class="comment">/* add remote host name to author */</span>
<a name="l03912"></a>03912    phe = gethostbyaddr((<span class="keywordtype">char</span> *) &amp;<a class="code" href="mhttpd_8c.html#ae4c6d44dc33d45aceef3c6b589414715">remote_addr</a>, 4, PF_INET);
<a name="l03913"></a>03913    <span class="keywordflow">if</span> (phe == NULL) {
<a name="l03914"></a>03914       <span class="comment">/* use IP number instead */</span>
<a name="l03915"></a>03915       strcpy(str, (<span class="keywordtype">char</span> *) inet_ntoa(<a class="code" href="mhttpd_8c.html#ae4c6d44dc33d45aceef3c6b589414715">remote_addr</a>));
<a name="l03916"></a>03916    } <span class="keywordflow">else</span>
<a name="l03917"></a>03917       strcpy(str, phe-&gt;h_name);
<a name="l03918"></a>03918 
<a name="l03919"></a>03919    strcpy(author, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;author&quot;</span>));
<a name="l03920"></a>03920    strcat(author, <span class="stringliteral">&quot;@&quot;</span>);
<a name="l03921"></a>03921    strcat(author, str);
<a name="l03922"></a>03922 
<a name="l03923"></a>03923    tag[0] = 0;
<a name="l03924"></a>03924    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;edit&quot;</span>))
<a name="l03925"></a>03925       strcpy(tag, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;orig&quot;</span>));
<a name="l03926"></a>03926 
<a name="l03927"></a>03927    <a class="code" href="group__msectionh.html#ga0403d907441aaec11229bbe9b43d0f5c">el_submit</a>(atoi(<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;run&quot;</span>)), author, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;type&quot;</span>),
<a name="l03928"></a>03928              <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;system&quot;</span>), <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;subject&quot;</span>), <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;text&quot;</span>),
<a name="l03929"></a>03929              <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;orig&quot;</span>), *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;html&quot;</span>) ? <span class="stringliteral">&quot;HTML&quot;</span> : <span class="stringliteral">&quot;plain&quot;</span>,
<a name="l03930"></a>03930              att_file[0], <a class="code" href="mhttpd_8c.html#a4d08376c0479b1115d6c07cf263459af">_attachment_buffer</a>[0], <a class="code" href="mhttpd_8c.html#a42dc7c4c704ca581c25ba7582da7e05e">_attachment_size</a>[0],
<a name="l03931"></a>03931              att_file[1], <a class="code" href="mhttpd_8c.html#a4d08376c0479b1115d6c07cf263459af">_attachment_buffer</a>[1], <a class="code" href="mhttpd_8c.html#a42dc7c4c704ca581c25ba7582da7e05e">_attachment_size</a>[1],
<a name="l03932"></a>03932              att_file[2], <a class="code" href="mhttpd_8c.html#a4d08376c0479b1115d6c07cf263459af">_attachment_buffer</a>[2], <a class="code" href="mhttpd_8c.html#a42dc7c4c704ca581c25ba7582da7e05e">_attachment_size</a>[2], tag, <span class="keyword">sizeof</span>(tag));
<a name="l03933"></a>03933 
<a name="l03934"></a>03934    <span class="comment">/* supersede host name with &quot;/Elog/Host name&quot; */</span>
<a name="l03935"></a>03935    size = <span class="keyword">sizeof</span>(<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>);
<a name="l03936"></a>03936    <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/Host name&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l03937"></a>03937 
<a name="l03938"></a>03938    <span class="keywordflow">if</span> (<a class="code" href="mhttpd_8c.html#aa9edbe9dd2977e5cc56138a3a05f7a98">tcp_port</a> == 80)
<a name="l03939"></a>03939       sprintf(mhttpd_full_url, <span class="stringliteral">&quot;http://%s/&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>);
<a name="l03940"></a>03940    <span class="keywordflow">else</span>
<a name="l03941"></a>03941       sprintf(mhttpd_full_url, <span class="stringliteral">&quot;http://%s:%d/&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>, <a class="code" href="mhttpd_8c.html#aa9edbe9dd2977e5cc56138a3a05f7a98">tcp_port</a>);
<a name="l03942"></a>03942 
<a name="l03943"></a>03943    <span class="comment">/* check for mail submissions */</span>
<a name="l03944"></a>03944    mail_param[0] = 0;
<a name="l03945"></a>03945    n_mail = 0;
<a name="l03946"></a>03946 
<a name="l03947"></a>03947    <span class="keywordflow">for</span> (index = 0; index &lt;= 1; index++) {
<a name="l03948"></a>03948       <span class="keywordflow">if</span> (index == 0)
<a name="l03949"></a>03949          sprintf(str, <span class="stringliteral">&quot;/Elog/Email %s&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;type&quot;</span>));
<a name="l03950"></a>03950       <span class="keywordflow">else</span>
<a name="l03951"></a>03951          sprintf(str, <span class="stringliteral">&quot;/Elog/Email %s&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;system&quot;</span>));
<a name="l03952"></a>03952 
<a name="l03953"></a>03953       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkey) == <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l03954"></a>03954          size = <span class="keyword">sizeof</span>(mail_list);
<a name="l03955"></a>03955          <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, mail_list, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l03956"></a>03956 
<a name="l03957"></a>03957          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Elog/SMTP host&quot;</span>, &amp;hkey) != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l03958"></a>03958             <a class="code" href="mhttpd_8c.html#a6c4dc4a30c55473c220a5ba8a5ea4575">show_error</a>(<span class="stringliteral">&quot;No SMTP host defined under /Elog/SMTP host&quot;</span>);
<a name="l03959"></a>03959             <span class="keywordflow">return</span>;
<a name="l03960"></a>03960          }
<a name="l03961"></a>03961          size = <span class="keyword">sizeof</span>(smtp_host);
<a name="l03962"></a>03962          <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, smtp_host, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l03963"></a>03963 
<a name="l03964"></a>03964          p = strtok(mail_list, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l03965"></a>03965          <span class="keywordflow">for</span> (i = 0; p; i++) {
<a name="l03966"></a>03966             strcpy(mail_to, p);
<a name="l03967"></a>03967             sprintf(mail_from, <span class="stringliteral">&quot;MIDAS &lt;MIDAS@%s&gt;&quot;</span>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>);
<a name="l03968"></a>03968 
<a name="l03969"></a>03969             size = <span class="keyword">sizeof</span>(str);
<a name="l03970"></a>03970             str[0] = 0;
<a name="l03971"></a>03971             <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Experiment/Name&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l03972"></a>03972 
<a name="l03973"></a>03973             sprintf(mail_text, <span class="stringliteral">&quot;A new entry has been submitted by %s:\n\n&quot;</span>, author);
<a name="l03974"></a>03974             sprintf(mail_text + strlen(mail_text), <span class="stringliteral">&quot;Experiment : %s\n&quot;</span>, str);
<a name="l03975"></a>03975             sprintf(mail_text + strlen(mail_text), <span class="stringliteral">&quot;Type       : %s\n&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;type&quot;</span>));
<a name="l03976"></a>03976             sprintf(mail_text + strlen(mail_text), <span class="stringliteral">&quot;System     : %s\n&quot;</span>,
<a name="l03977"></a>03977                     <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;system&quot;</span>));
<a name="l03978"></a>03978             sprintf(mail_text + strlen(mail_text), <span class="stringliteral">&quot;Subject    : %s\n&quot;</span>,
<a name="l03979"></a>03979                     <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;subject&quot;</span>));
<a name="l03980"></a>03980 
<a name="l03981"></a>03981             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l03982"></a>03982                sprintf(mail_text + strlen(mail_text), <span class="stringliteral">&quot;Link       : %sEL/%s?exp=%s\n&quot;</span>,
<a name="l03983"></a>03983                        mhttpd_full_url, tag, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l03984"></a>03984             <span class="keywordflow">else</span>
<a name="l03985"></a>03985                sprintf(mail_text + strlen(mail_text), <span class="stringliteral">&quot;Link       : %sEL/%s\n&quot;</span>,
<a name="l03986"></a>03986                        mhttpd_full_url, tag);
<a name="l03987"></a>03987 
<a name="l03988"></a>03988             assert(strlen(mail_text) + 100 &lt; <span class="keyword">sizeof</span>(mail_text));        <span class="comment">// bomb out on array overrun.</span>
<a name="l03989"></a>03989 
<a name="l03990"></a>03990             <a class="code" href="mscb_8c.html#a08a3fda60543c77e368c74b10f3d9799">strlcat</a>(mail_text + strlen(mail_text), <span class="stringliteral">&quot;\n&quot;</span>, <span class="keyword">sizeof</span>(mail_text));
<a name="l03991"></a>03991             <a class="code" href="mscb_8c.html#a08a3fda60543c77e368c74b10f3d9799">strlcat</a>(mail_text + strlen(mail_text), <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;text&quot;</span>),
<a name="l03992"></a>03992                     <span class="keyword">sizeof</span>(mail_text) - strlen(mail_text) - 50);
<a name="l03993"></a>03993             <a class="code" href="mscb_8c.html#a08a3fda60543c77e368c74b10f3d9799">strlcat</a>(mail_text + strlen(mail_text), <span class="stringliteral">&quot;\n&quot;</span>, <span class="keyword">sizeof</span>(mail_text));
<a name="l03994"></a>03994 
<a name="l03995"></a>03995             assert(strlen(mail_text) &lt; <span class="keyword">sizeof</span>(mail_text));      <span class="comment">// bomb out on array overrun.</span>
<a name="l03996"></a>03996 
<a name="l03997"></a>03997             <a class="code" href="sendmail_8c.html#a84f777d982afcc506b03636f2ec4b9f4">sendmail</a>(smtp_host, mail_from, mail_to, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;type&quot;</span>), mail_text);
<a name="l03998"></a>03998 
<a name="l03999"></a>03999             <span class="keywordflow">if</span> (mail_param[0] == 0 &amp;&amp; <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0] == 0)
<a name="l04000"></a>04000                strcpy(mail_param, <span class="stringliteral">&quot;?&quot;</span>);
<a name="l04001"></a>04001             <span class="keywordflow">else</span>
<a name="l04002"></a>04002                strcat(mail_param, <span class="stringliteral">&quot;&amp;&quot;</span>);
<a name="l04003"></a>04003             sprintf(mail_param + strlen(mail_param), <span class="stringliteral">&quot;mail%d=%s&quot;</span>, n_mail++, mail_to);
<a name="l04004"></a>04004 
<a name="l04005"></a>04005             p = strtok(NULL, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l04006"></a>04006             <span class="keywordflow">if</span> (!p)
<a name="l04007"></a>04007                <span class="keywordflow">break</span>;
<a name="l04008"></a>04008             <span class="keywordflow">while</span> (*p == <span class="charliteral">&apos; &apos;</span>)
<a name="l04009"></a>04009                p++;
<a name="l04010"></a>04010          }
<a name="l04011"></a>04011       }
<a name="l04012"></a>04012    }
<a name="l04013"></a>04013 
<a name="l04014"></a>04014    <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++)
<a name="l04015"></a>04015       <span class="keywordflow">if</span> (buffer[i])
<a name="l04016"></a>04016          <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(buffer[i]);
<a name="l04017"></a>04017 
<a name="l04018"></a>04018    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 302 Found\r\n&quot;</span>);
<a name="l04019"></a>04019    <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l04020"></a>04020 
<a name="l04021"></a>04021    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0])
<a name="l04022"></a>04022       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Location: /EL/%s?exp=%s%s\n\n&lt;html&gt;redir&lt;/html&gt;\r\n&quot;</span>, tag, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>,
<a name="l04023"></a>04023                mail_param);
<a name="l04024"></a>04024    <span class="keywordflow">else</span> {
<a name="l04025"></a>04025       <span class="keywordflow">if</span> (mail_param[0])
<a name="l04026"></a>04026          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Location: /EL/%s?%s\n\n&lt;html&gt;redir&lt;/html&gt;\r\n&quot;</span>, tag, mail_param + 1);
<a name="l04027"></a>04027       <span class="keywordflow">else</span>
<a name="l04028"></a>04028          <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Location: /EL/%s\n\n&lt;html&gt;redir&lt;/html&gt;\r\n&quot;</span>, tag);
<a name="l04029"></a>04029    }
<a name="l04030"></a>04030 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a79eec108616ceddc04c6dcb076387aea"></a><!-- doxytag: member="mhttpd.c::submit_form" ref="a79eec108616ceddc04c6dcb076387aea" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void submit_form </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l04034">4034</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mhttpd_8c_source.html#l00888">_attachment_size</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="mana_8cpp_source.html#l00800">getparam()</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l01042">setparam()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="mhttpd_8c_source.html#l03805">submit_elog()</a>, and <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04035"></a>04035 {
<a name="l04036"></a>04036    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], att_name[256];
<a name="l04037"></a>04037    <span class="keywordtype">char</span> text[10000];
<a name="l04038"></a>04038    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, n_att, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l04039"></a>04039    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey, hkeyroot;
<a name="l04040"></a>04040    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l04041"></a>04041 
<a name="l04042"></a>04042    <span class="comment">/* check for author */</span>
<a name="l04043"></a>04043    <span class="keywordflow">if</span> (*<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;author&quot;</span>) == 0) {
<a name="l04044"></a>04044       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;HTTP/1.0 200 Document follows\r\n&quot;</span>);
<a name="l04045"></a>04045       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Server: MIDAS HTTP %s\r\n&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l04046"></a>04046       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Content-Type: text/html; charset=iso-8859-1\r\n\r\n&quot;</span>);
<a name="l04047"></a>04047 
<a name="l04048"></a>04048       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;ELog Error&lt;/title&gt;&lt;/head&gt;\n&quot;</span>);
<a name="l04049"></a>04049       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;i&gt;Error: No author supplied.&lt;/i&gt;&lt;p&gt;\n&quot;</span>);
<a name="l04050"></a>04050       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;Please go back and enter your name in the &lt;i&gt;author&lt;/i&gt; field.\n&quot;</span>);
<a name="l04051"></a>04051       <a class="code" href="mhttpd_8c.html#af3273cdaacb7a8ea6ad26e4dc8389f42">rsprintf</a>(<span class="stringliteral">&quot;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;\n&quot;</span>);
<a name="l04052"></a>04052       <span class="keywordflow">return</span>;
<a name="l04053"></a>04053    }
<a name="l04054"></a>04054 
<a name="l04055"></a>04055    <span class="comment">/* assemble text from form */</span>
<a name="l04056"></a>04056    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l04057"></a>04057    sprintf(str, <span class="stringliteral">&quot;/Elog/Forms/%s&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;form&quot;</span>));
<a name="l04058"></a>04058    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkeyroot);
<a name="l04059"></a>04059    text[0] = 0;
<a name="l04060"></a>04060    n_att = 0;
<a name="l04061"></a>04061    <span class="keywordflow">if</span> (hkeyroot)
<a name="l04062"></a>04062       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l04063"></a>04063          <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyroot, i, &amp;hkey);
<a name="l04064"></a>04064          <span class="keywordflow">if</span> (!hkey)
<a name="l04065"></a>04065             <span class="keywordflow">break</span>;
<a name="l04066"></a>04066 
<a name="l04067"></a>04067          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l04068"></a>04068 
<a name="l04069"></a>04069          strcpy(str, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l04070"></a>04070          <span class="keywordflow">if</span> (str[0])
<a name="l04071"></a>04071             str[strlen(str) - 1] = 0;
<a name="l04072"></a>04072          <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, <span class="stringliteral">&quot;attachment&quot;</span>)) {
<a name="l04073"></a>04073             <span class="comment">/* generate attachments */</span>
<a name="l04074"></a>04074             size = <span class="keyword">sizeof</span>(str);
<a name="l04075"></a>04075             <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l04076"></a>04076             <a class="code" href="mhttpd_8c.html#a42dc7c4c704ca581c25ba7582da7e05e">_attachment_size</a>[n_att] = 0;
<a name="l04077"></a>04077             sprintf(att_name, <span class="stringliteral">&quot;attachment%d&quot;</span>, n_att++);
<a name="l04078"></a>04078 
<a name="l04079"></a>04079             sprintf(str, <span class="stringliteral">&quot;c%d&quot;</span>, i);
<a name="l04080"></a>04080             <a class="code" href="mhttpd_8c.html#a2956fb85032748af9fb7f544a4fb6c93">setparam</a>(att_name, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str));
<a name="l04081"></a>04081          } <span class="keywordflow">else</span> {
<a name="l04082"></a>04082             sprintf(str, <span class="stringliteral">&quot;x%d&quot;</span>, i);
<a name="l04083"></a>04083             sprintf(text + strlen(text), <span class="stringliteral">&quot;%d %s : [%c]  &quot;</span>, i + 1, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>,
<a name="l04084"></a>04084                     *<a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str) == <span class="charliteral">&apos;1&apos;</span> ? <span class="charliteral">&apos;X&apos;</span> : <span class="charliteral">&apos; &apos;</span>);
<a name="l04085"></a>04085             sprintf(str, <span class="stringliteral">&quot;c%d&quot;</span>, i);
<a name="l04086"></a>04086             sprintf(text + strlen(text), <span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(str));
<a name="l04087"></a>04087          }
<a name="l04088"></a>04088       }
<a name="l04089"></a>04089 
<a name="l04090"></a>04090    <span class="comment">/* set parameters for submit_elog() */</span>
<a name="l04091"></a>04091    <a class="code" href="mhttpd_8c.html#a2956fb85032748af9fb7f544a4fb6c93">setparam</a>(<span class="stringliteral">&quot;type&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;form&quot;</span>));
<a name="l04092"></a>04092    <a class="code" href="mhttpd_8c.html#a2956fb85032748af9fb7f544a4fb6c93">setparam</a>(<span class="stringliteral">&quot;system&quot;</span>, <span class="stringliteral">&quot;General&quot;</span>);
<a name="l04093"></a>04093    <a class="code" href="mhttpd_8c.html#a2956fb85032748af9fb7f544a4fb6c93">setparam</a>(<span class="stringliteral">&quot;subject&quot;</span>, <a class="code" href="mana_8cpp.html#ac965acb06ece6889fd3b68d82ca916c5">getparam</a>(<span class="stringliteral">&quot;form&quot;</span>));
<a name="l04094"></a>04094    <a class="code" href="mhttpd_8c.html#a2956fb85032748af9fb7f544a4fb6c93">setparam</a>(<span class="stringliteral">&quot;text&quot;</span>, text);
<a name="l04095"></a>04095    <a class="code" href="mhttpd_8c.html#a2956fb85032748af9fb7f544a4fb6c93">setparam</a>(<span class="stringliteral">&quot;orig&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l04096"></a>04096    <a class="code" href="mhttpd_8c.html#a2956fb85032748af9fb7f544a4fb6c93">setparam</a>(<span class="stringliteral">&quot;html&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l04097"></a>04097 
<a name="l04098"></a>04098    <a class="code" href="mhttpd_8c.html#a7da098af5efaf5b7e9f01e8d8a3d019a">submit_elog</a>();
<a name="l04099"></a>04099 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a777d92b7262b97dd454477828f8df20a"></a><!-- doxytag: member="mhttpd.c::taxis" ref="a777d92b7262b97dd454477828f8df20a" args="(gdImagePtr im, gdFont *font, int col, int gcol, int x1, int y1, int width, int xr, int minor, int major, int text, int label, int grid, double xmin, double xmax)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void taxis </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgdImageStruct.html">gdImagePtr</a>&nbsp;</td>
          <td class="paramname"> <em>im</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structgdFont.html">gdFont</a> *&nbsp;</td>
          <td class="paramname"> <em>font</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>col</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>gcol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>x1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>y1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>xr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>minor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>major</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>text</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>xmin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>xmax</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l06961">6961</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mgd_8c_source.html#l00643">gdImageLine()</a>, <a class="el" href="mgd_8c_source.html#l00882">gdImageString()</a>, <a class="el" href="mgd_8h_source.html#l00062">gdFont::h</a>, <a class="el" href="mhttpd_8c_source.html#l06929">sec_to_label()</a>, <a class="el" href="system_8c_source.html#l02332">ss_time()</a>, <a class="el" href="system_8c_source.html#l02440">ss_timezone()</a>, and <a class="el" href="mgd_8h_source.html#l00061">gdFont::w</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l07289">generate_hist_graph()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06964"></a>06964 {
<a name="l06965"></a>06965    <span class="keywordtype">int</span> dx, x_act, label_dx, major_dx, x_screen, maxwidth;
<a name="l06966"></a>06966    <span class="keywordtype">int</span> tick_base, major_base, label_base, xs, xl;
<a name="l06967"></a>06967    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[80];
<a name="l06968"></a>06968    <span class="keywordtype">int</span> base[] = { 1, 5, 10, 60, 300, 600, 1800, 3600, 3600 * 6, 3600 * 12, 3600 * 24, 0 };
<a name="l06969"></a>06969    time_t ltime;
<a name="l06970"></a>06970    <span class="keywordtype">int</span> force_date, d1, d2;
<a name="l06971"></a>06971    <span class="keyword">struct </span>tm *ptms;
<a name="l06972"></a>06972 
<a name="l06973"></a>06973    <span class="keywordflow">if</span> (xmax &lt;= xmin || <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> &lt;= 0)
<a name="l06974"></a>06974       <span class="keywordflow">return</span>;
<a name="l06975"></a>06975 
<a name="l06976"></a>06976    <span class="comment">/* force date display if xmax not today */</span>
<a name="l06977"></a>06977    ltime = <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>();
<a name="l06978"></a>06978    ptms = localtime(&amp;ltime);
<a name="l06979"></a>06979    d1 = ptms-&gt;tm_mday;
<a name="l06980"></a>06980    ltime = (time_t) xmax;
<a name="l06981"></a>06981    ptms = localtime(&amp;ltime);
<a name="l06982"></a>06982    d2 = ptms-&gt;tm_mday;
<a name="l06983"></a>06983    force_date = (d1 != d2);
<a name="l06984"></a>06984 
<a name="l06985"></a>06985    <span class="comment">/* use 5 pixel as min tick distance */</span>
<a name="l06986"></a>06986    dx = (int) ((xmax - xmin) / (double) (<a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> / 5) + 0.5);
<a name="l06987"></a>06987 
<a name="l06988"></a>06988    <span class="keywordflow">for</span> (tick_base = 0; base[tick_base]; tick_base++) {
<a name="l06989"></a>06989       <span class="keywordflow">if</span> (base[tick_base] &gt; dx)
<a name="l06990"></a>06990          <span class="keywordflow">break</span>;
<a name="l06991"></a>06991    }
<a name="l06992"></a>06992    <span class="keywordflow">if</span> (!base[tick_base])
<a name="l06993"></a>06993       tick_base--;
<a name="l06994"></a>06994    dx = base[tick_base];
<a name="l06995"></a>06995 
<a name="l06996"></a>06996    <span class="keywordflow">if</span> (base[tick_base + 1])
<a name="l06997"></a>06997       major_base = tick_base + 1;
<a name="l06998"></a>06998    <span class="keywordflow">else</span>
<a name="l06999"></a>06999       major_base = tick_base;
<a name="l07000"></a>07000    major_dx = base[major_base];
<a name="l07001"></a>07001 
<a name="l07002"></a>07002    <span class="keywordflow">if</span> (base[major_base + 1])
<a name="l07003"></a>07003       label_base = major_base + 1;
<a name="l07004"></a>07004    <span class="keywordflow">else</span>
<a name="l07005"></a>07005       label_base = major_base;
<a name="l07006"></a>07006    label_dx = base[label_base];
<a name="l07007"></a>07007 
<a name="l07008"></a>07008    <span class="keywordflow">do</span> {
<a name="l07009"></a>07009       <a class="code" href="mhttpd_8c.html#a9602d6d6719f5884ac3a8433c6b65daf">sec_to_label</a>(str, (<span class="keywordtype">int</span>) (xmin + 0.5), label_dx, force_date);
<a name="l07010"></a>07010       maxwidth = font-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> / 2 * strlen(str);
<a name="l07011"></a>07011 
<a name="l07012"></a>07012       <span class="comment">/* increasing label_dx, if labels would overlap */</span>
<a name="l07013"></a>07013       <span class="keywordflow">if</span> (maxwidth &gt; 0.7 * label_dx / (xmax - xmin) * <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a>) {
<a name="l07014"></a>07014          <span class="keywordflow">if</span> (base[label_base + 1])
<a name="l07015"></a>07015             label_dx = base[++label_base];
<a name="l07016"></a>07016          <span class="keywordflow">else</span>
<a name="l07017"></a>07017             label_dx += 3600 * 24;
<a name="l07018"></a>07018       } <span class="keywordflow">else</span>
<a name="l07019"></a>07019          <span class="keywordflow">break</span>;
<a name="l07020"></a>07020    } <span class="keywordflow">while</span> (1);
<a name="l07021"></a>07021 
<a name="l07022"></a>07022    x_act =
<a name="l07023"></a>07023        (int) floor((<span class="keywordtype">double</span>) (xmin - <a class="code" href="group__msystemincludecode.html#gacfb6ca0d7f77184eda08c7059c5c8530">ss_timezone</a>()) / label_dx) * label_dx + <a class="code" href="group__msystemincludecode.html#gacfb6ca0d7f77184eda08c7059c5c8530">ss_timezone</a>();
<a name="l07024"></a>07024 
<a name="l07025"></a>07025    <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, x1, y1, x1 + width, y1, col);
<a name="l07026"></a>07026 
<a name="l07027"></a>07027    <span class="keywordflow">do</span> {
<a name="l07028"></a>07028       x_screen = (int) ((x_act - xmin) / (xmax - xmin) * width + x1 + 0.5);
<a name="l07029"></a>07029       xs = (int) (x_screen + 0.5);
<a name="l07030"></a>07030 
<a name="l07031"></a>07031       <span class="keywordflow">if</span> (x_screen &gt; x1 + width + 0.001)
<a name="l07032"></a>07032          <span class="keywordflow">break</span>;
<a name="l07033"></a>07033 
<a name="l07034"></a>07034       <span class="keywordflow">if</span> (x_screen &gt;= x1) {
<a name="l07035"></a>07035          <span class="keywordflow">if</span> ((x_act - <a class="code" href="group__msystemincludecode.html#gacfb6ca0d7f77184eda08c7059c5c8530">ss_timezone</a>()) % major_dx == 0) {
<a name="l07036"></a>07036             <span class="keywordflow">if</span> ((x_act - <a class="code" href="group__msystemincludecode.html#gacfb6ca0d7f77184eda08c7059c5c8530">ss_timezone</a>()) % label_dx == 0) {
<a name="l07037"></a>07037           <span class="comment">/**** label tick mark ****/</span>
<a name="l07038"></a>07038                <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, xs, y1, xs, y1 + text, col);
<a name="l07039"></a>07039 
<a name="l07040"></a>07040           <span class="comment">/**** grid line ***/</span>
<a name="l07041"></a>07041                <span class="keywordflow">if</span> (grid != 0 &amp;&amp; xs &gt; x1 &amp;&amp; xs &lt; x1 + width)
<a name="l07042"></a>07042                   <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, xs, y1, xs, y1 + grid, col);
<a name="l07043"></a>07043 
<a name="l07044"></a>07044           <span class="comment">/**** label ****/</span>
<a name="l07045"></a>07045                <span class="keywordflow">if</span> (label != 0) {
<a name="l07046"></a>07046                   <a class="code" href="mhttpd_8c.html#a9602d6d6719f5884ac3a8433c6b65daf">sec_to_label</a>(str, x_act, label_dx, force_date);
<a name="l07047"></a>07047 
<a name="l07048"></a>07048                   <span class="comment">/* if labels at edge, shift them in */</span>
<a name="l07049"></a>07049                   xl = (int) xs - font-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a> * strlen(str) / 2;
<a name="l07050"></a>07050                   <span class="keywordflow">if</span> (xl &lt; 0)
<a name="l07051"></a>07051                      xl = 0;
<a name="l07052"></a>07052                   <span class="keywordflow">if</span> (xl + font-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a> * (<span class="keywordtype">int</span>) strlen(str) &gt; xr)
<a name="l07053"></a>07053                      xl = xr - font-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a> * strlen(str);
<a name="l07054"></a>07054                   <a class="code" href="mgd_8h.html#a04908d388ee58943527604c035eb1aeb">gdImageString</a>(im, font, xl, y1 + label, str, col);
<a name="l07055"></a>07055                }
<a name="l07056"></a>07056             } <span class="keywordflow">else</span> {
<a name="l07057"></a>07057           <span class="comment">/**** major tick mark ****/</span>
<a name="l07058"></a>07058                <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, xs, y1, xs, y1 + major, col);
<a name="l07059"></a>07059 
<a name="l07060"></a>07060           <span class="comment">/**** grid line ****/</span>
<a name="l07061"></a>07061                <span class="keywordflow">if</span> (grid != 0 &amp;&amp; xs &gt; x1 &amp;&amp; xs &lt; x1 + width)
<a name="l07062"></a>07062                   <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, xs, y1 - 1, xs, y1 + grid, gcol);
<a name="l07063"></a>07063             }
<a name="l07064"></a>07064 
<a name="l07065"></a>07065          } <span class="keywordflow">else</span>
<a name="l07066"></a>07066         <span class="comment">/**** minor tick mark ****/</span>
<a name="l07067"></a>07067             <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, xs, y1, xs, y1 + minor, col);
<a name="l07068"></a>07068 
<a name="l07069"></a>07069       }
<a name="l07070"></a>07070 
<a name="l07071"></a>07071       x_act += dx;
<a name="l07072"></a>07072 
<a name="l07073"></a>07073       <span class="comment">/* supress 1.23E-17 ... */</span>
<a name="l07074"></a>07074       <span class="keywordflow">if</span> (fabs(x_act) &lt; dx / 100)
<a name="l07075"></a>07075          x_act = 0;
<a name="l07076"></a>07076 
<a name="l07077"></a>07077    } <span class="keywordflow">while</span> (1);
<a name="l07078"></a>07078 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0f7449df3cdf1d111e5c926dc798180b"></a><!-- doxytag: member="mhttpd.c::time_to_sec" ref="a0f7449df3cdf1d111e5c926dc798180b" args="(char *str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int time_to_sec </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>str</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l07262">7262</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l07289">generate_hist_graph()</a>, and <a class="el" href="mhttpd_8c_source.html#l08606">show_hist_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07263"></a>07263 {
<a name="l07264"></a>07264    <span class="keywordtype">double</span> s;
<a name="l07265"></a>07265 
<a name="l07266"></a>07266    s = atof(<a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>);
<a name="l07267"></a>07267    <span class="keywordflow">switch</span> (<a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[strlen(<a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>) - 1]) {
<a name="l07268"></a>07268    <span class="keywordflow">case</span> <span class="charliteral">&apos;m&apos;</span>:
<a name="l07269"></a>07269    <span class="keywordflow">case</span> <span class="charliteral">&apos;M&apos;</span>:
<a name="l07270"></a>07270       s *= 60;
<a name="l07271"></a>07271       <span class="keywordflow">break</span>;
<a name="l07272"></a>07272    <span class="keywordflow">case</span> <span class="charliteral">&apos;h&apos;</span>:
<a name="l07273"></a>07273    <span class="keywordflow">case</span> <span class="charliteral">&apos;H&apos;</span>:
<a name="l07274"></a>07274       s *= 3600;
<a name="l07275"></a>07275       <span class="keywordflow">break</span>;
<a name="l07276"></a>07276    <span class="keywordflow">case</span> <span class="charliteral">&apos;d&apos;</span>:
<a name="l07277"></a>07277    <span class="keywordflow">case</span> <span class="charliteral">&apos;D&apos;</span>:
<a name="l07278"></a>07278       s *= 3600 * 24;
<a name="l07279"></a>07279       <span class="keywordflow">break</span>;
<a name="l07280"></a>07280    }
<a name="l07281"></a>07281 
<a name="l07282"></a>07282    <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) s;
<a name="l07283"></a>07283 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad0587659617510bc64b05992882d7d9e"></a><!-- doxytag: member="mhttpd.c::unsetparam" ref="ad0587659617510bc64b05992882d7d9e" args="(char *param)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void unsetparam </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>param</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01103">1103</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="experiment_2template_8c_source.html#l00070">_param</a>, <a class="el" href="mhttpd_8c_source.html#l00885">_value</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, and <a class="el" href="mhttpd_8c_source.html#l00879">MAX_PARAM</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l03805">submit_elog()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01104"></a>01104 {
<a name="l01105"></a>01105    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l01106"></a>01106 
<a name="l01107"></a>01107    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="mhttpd_8c.html#a5732be69f55a5dbbfa3df82d31314cb1">MAX_PARAM</a>; i++)
<a name="l01108"></a>01108       <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>, <a class="code" href="experiment_2template_8c.html#afb3a768ad8339a2cefa693559a115d80">_param</a>[i]))
<a name="l01109"></a>01109          <span class="keywordflow">break</span>;
<a name="l01110"></a>01110 
<a name="l01111"></a>01111    <span class="keywordflow">if</span> (i &lt; MAX_PARAM) {
<a name="l01112"></a>01112       <a class="code" href="experiment_2template_8c.html#afb3a768ad8339a2cefa693559a115d80">_param</a>[i][0] = 0;
<a name="l01113"></a>01113       <a class="code" href="mhttpd_8c.html#abcd78d8c212e69ce3b664c10cfabf5f6">_value</a>[i][0] = 0;
<a name="l01114"></a>01114    }
<a name="l01115"></a>01115 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a314e523b7d95b4a434216200167e5e0a"></a><!-- doxytag: member="mhttpd.c::urlDecode" ref="a314e523b7d95b4a434216200167e5e0a" args="(char *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void urlDecode </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01119">1119</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="mdump_8c_source.html#l00115">i</a>.</p>

<p>Referenced by <a class="el" href="webpaw_8c_source.html#l01259">decode()</a>, <a class="el" href="mhttpd_8c_source.html#l09800">decode_get()</a>, <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>, and <a class="el" href="mhttpd_8c_source.html#l03805">submit_elog()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01123"></a>01123 {
<a name="l01124"></a>01124    <span class="keywordtype">char</span> *pD, <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[3];
<a name="l01125"></a>01125    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l01126"></a>01126 
<a name="l01127"></a>01127    pD = <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>;
<a name="l01128"></a>01128    <span class="keywordflow">while</span> (*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>) {
<a name="l01129"></a>01129       <span class="keywordflow">if</span> (*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> == <span class="charliteral">&apos;%&apos;</span>) {
<a name="l01130"></a>01130          <span class="comment">/* Escape: next 2 chars are hex representation of the actual character */</span>
<a name="l01131"></a>01131          <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>++;
<a name="l01132"></a>01132          <span class="keywordflow">if</span> (isxdigit(<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>[0]) &amp;&amp; isxdigit(<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>[1])) {
<a name="l01133"></a>01133             str[0] = <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>[0];
<a name="l01134"></a>01134             str[1] = <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>[1];
<a name="l01135"></a>01135             str[2] = 0;
<a name="l01136"></a>01136             sscanf(<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>, <span class="stringliteral">&quot;%02X&quot;</span>, &amp;i);
<a name="l01137"></a>01137 
<a name="l01138"></a>01138             *pD++ = (char) i;
<a name="l01139"></a>01139             <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> += 2;
<a name="l01140"></a>01140          } <span class="keywordflow">else</span>
<a name="l01141"></a>01141             *pD++ = <span class="charliteral">&apos;%&apos;</span>;
<a name="l01142"></a>01142       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> == <span class="charliteral">&apos;+&apos;</span>) {
<a name="l01143"></a>01143          <span class="comment">/* convert &apos;+&apos; to &apos; &apos; */</span>
<a name="l01144"></a>01144          *pD++ = <span class="charliteral">&apos; &apos;</span>;
<a name="l01145"></a>01145          <a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>++;
<a name="l01146"></a>01146       } <span class="keywordflow">else</span> {
<a name="l01147"></a>01147          *pD++ = *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>++;
<a name="l01148"></a>01148       }
<a name="l01149"></a>01149    }
<a name="l01150"></a>01150    *pD = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01151"></a>01151 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a477e33c685ba6ebcb9d429fb057c2760"></a><!-- doxytag: member="mhttpd.c::urlEncode" ref="a477e33c685ba6ebcb9d429fb057c2760" args="(char *ps)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void urlEncode </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>ps</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01153">1153</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="sis3803_8c_source.html#l00925">p</a>.</p>

<p>Referenced by <a class="el" href="webpaw_8c_source.html#l00765">display_kumac()</a>, <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>, <a class="el" href="mhttpd_8c_source.html#l01382">search_callback()</a>, <a class="el" href="mhttpd_8c_source.html#l05737">show_odb_page()</a>, and <a class="el" href="mhttpd_8c_source.html#l05983">show_set_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01157"></a>01157 {
<a name="l01158"></a>01158    <span class="keywordtype">char</span> *pd, *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>, <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l01159"></a>01159 
<a name="l01160"></a>01160    pd = str;
<a name="l01161"></a>01161    p = ps;
<a name="l01162"></a>01162    <span class="keywordflow">while</span> (*p) {
<a name="l01163"></a>01163       <span class="keywordflow">if</span> (strchr(<span class="stringliteral">&quot; %&amp;=+#\&quot;&apos;&quot;</span>, *p)) {
<a name="l01164"></a>01164          sprintf(pd, <span class="stringliteral">&quot;%%%02X&quot;</span>, *p);
<a name="l01165"></a>01165          pd += 3;
<a name="l01166"></a>01166          p++;
<a name="l01167"></a>01167       } <span class="keywordflow">else</span> {
<a name="l01168"></a>01168          *pd++ = *p++;
<a name="l01169"></a>01169       }
<a name="l01170"></a>01170    }
<a name="l01171"></a>01171    *pd = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01172"></a>01172    strcpy(ps, str);
<a name="l01173"></a>01173 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a64e35192402b30fb1908344ff3bc5376"></a><!-- doxytag: member="mhttpd.c::vaxis" ref="a64e35192402b30fb1908344ff3bc5376" args="(gdImagePtr im, gdFont *font, int col, int gcol, int x1, int y1, int width, int minor, int major, int text, int label, int grid, double ymin, double ymax, BOOL logaxis)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int vaxis </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgdImageStruct.html">gdImagePtr</a>&nbsp;</td>
          <td class="paramname"> <em>im</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structgdFont.html">gdFont</a> *&nbsp;</td>
          <td class="paramname"> <em>font</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>col</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>gcol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>x1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>y1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>minor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>major</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>text</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>ymin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>ymax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td>
          <td class="paramname"> <em>logaxis</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l07082">7082</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>References <a class="el" href="generic_8c_source.html#l00091">abs</a>, <a class="el" href="mgd_8c_source.html#l00643">gdImageLine()</a>, <a class="el" href="mgd_8c_source.html#l00882">gdImageString()</a>, <a class="el" href="mgd_8h_source.html#l00062">gdFont::h</a>, <a class="el" href="generate-MODULES_8h_source.html#l00006">h</a>, <a class="el" href="mhttpd_8c_source.html#l06806">LN10</a>, <a class="el" href="mhttpd_8c_source.html#l06807">LOG2</a>, <a class="el" href="mhttpd_8c_source.html#l06808">LOG5</a>, <a class="el" href="Mql_8h_source.html#l00011">MAX</a>, and <a class="el" href="mgd_8h_source.html#l00061">gdFont::w</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l07289">generate_hist_graph()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07086"></a>07086 {
<a name="l07087"></a>07087    <span class="keywordtype">double</span> dy, int_dy, frac_dy, y_act, label_dy, major_dy, y_screen, y_next;
<a name="l07088"></a>07088    <span class="keywordtype">int</span> tick_base, major_base, label_base, n_sig1, n_sig2, ys, max_width;
<a name="l07089"></a>07089    <span class="keywordtype">int</span> last_label_y;
<a name="l07090"></a>07090    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[80];
<a name="l07091"></a>07091    <span class="keywordtype">double</span> base[] = { 1, 2, 5, 10, 20, 50, 100, 200, 500, 1000 };
<a name="l07092"></a>07092 
<a name="l07093"></a>07093    <span class="keywordflow">if</span> (ymax &lt;= ymin || <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> &lt;= 0)
<a name="l07094"></a>07094       <span class="keywordflow">return</span> 0;
<a name="l07095"></a>07095 
<a name="l07096"></a>07096    <span class="keywordflow">if</span> (logaxis) {
<a name="l07097"></a>07097       dy = pow(10, floor(log(ymin) / <a class="code" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>));
<a name="l07098"></a>07098       label_dy = dy;
<a name="l07099"></a>07099       major_dy = dy * 10;
<a name="l07100"></a>07100       n_sig1 = 4;
<a name="l07101"></a>07101    } <span class="keywordflow">else</span> {
<a name="l07102"></a>07102       dy = (ymax - ymin) / (<span class="keywordtype">double</span>) (<a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> / 5);
<a name="l07103"></a>07103 
<a name="l07104"></a>07104       frac_dy = modf(log(dy) / <a class="code" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>, &amp;int_dy);
<a name="l07105"></a>07105       <span class="keywordflow">if</span> (frac_dy &lt; 0) {
<a name="l07106"></a>07106          frac_dy += 1;
<a name="l07107"></a>07107          int_dy -= 1;
<a name="l07108"></a>07108       }
<a name="l07109"></a>07109 
<a name="l07110"></a>07110       tick_base = frac_dy &lt; <a class="code" href="mhttpd_8c.html#a07267dcd6834194cfed517197ab1e2ad">LOG2</a> ? 1 : frac_dy &lt; <a class="code" href="mhttpd_8c.html#a5a6825d23f0ed9ea6166b890404c0526">LOG5</a> ? 2 : 3;
<a name="l07111"></a>07111       major_base = label_base = tick_base + 1;
<a name="l07112"></a>07112 
<a name="l07113"></a>07113       <span class="comment">/* rounding up of dy, label_dy */</span>
<a name="l07114"></a>07114       dy = pow(10, int_dy) * base[tick_base];
<a name="l07115"></a>07115       major_dy = pow(10, int_dy) * base[major_base];
<a name="l07116"></a>07116       label_dy = major_dy;
<a name="l07117"></a>07117 
<a name="l07118"></a>07118       <span class="comment">/* number of significant digits */</span>
<a name="l07119"></a>07119       <span class="keywordflow">if</span> (ymin == 0)
<a name="l07120"></a>07120          n_sig1 = 0;
<a name="l07121"></a>07121       <span class="keywordflow">else</span>
<a name="l07122"></a>07122          n_sig1 = (int) floor(log(fabs(ymin)) / <a class="code" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>) -
<a name="l07123"></a>07123              (<span class="keywordtype">int</span>) floor(log(fabs(label_dy)) / <a class="code" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>) + 1;
<a name="l07124"></a>07124 
<a name="l07125"></a>07125       <span class="keywordflow">if</span> (ymax == 0)
<a name="l07126"></a>07126          n_sig2 = 0;
<a name="l07127"></a>07127       <span class="keywordflow">else</span>
<a name="l07128"></a>07128          n_sig2 = (int) floor(log(fabs(ymax)) / <a class="code" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>) -
<a name="l07129"></a>07129              (<span class="keywordtype">int</span>) floor(log(fabs(label_dy)) / <a class="code" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>) + 1;
<a name="l07130"></a>07130 
<a name="l07131"></a>07131       n_sig1 = <a class="code" href="Mql_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(n_sig1, n_sig2);
<a name="l07132"></a>07132       n_sig1 = <a class="code" href="Mql_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(n_sig1, 4);
<a name="l07133"></a>07133 
<a name="l07134"></a>07134       <span class="comment">/* increasing label_dy, if labels would overlap */</span>
<a name="l07135"></a>07135       <span class="keywordflow">while</span> (label_dy / (ymax - ymin) * width &lt; 1.5 * font-&gt;<a class="code" href="generate-MODULES_8h.html#a00d5923485ea4382260221681abdb205">h</a>) {
<a name="l07136"></a>07136          label_base++;
<a name="l07137"></a>07137          label_dy = pow(10, int_dy) * base[label_base];
<a name="l07138"></a>07138          <span class="keywordflow">if</span> (label_base % 3 == 2 &amp;&amp; major_base % 3 == 1) {
<a name="l07139"></a>07139             major_base++;
<a name="l07140"></a>07140             major_dy = pow(10, int_dy) * base[major_base];
<a name="l07141"></a>07141          }
<a name="l07142"></a>07142       }
<a name="l07143"></a>07143    }
<a name="l07144"></a>07144 
<a name="l07145"></a>07145    max_width = 0;
<a name="l07146"></a>07146    y_act = floor(ymin / dy) * dy;
<a name="l07147"></a>07147 
<a name="l07148"></a>07148    <span class="keywordflow">if</span> (x1 != 0 || y1 != 0)
<a name="l07149"></a>07149       <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, x1, y1, x1, y1 - <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a>, col);
<a name="l07150"></a>07150 
<a name="l07151"></a>07151    last_label_y = y1 + 2 * font-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a>;
<a name="l07152"></a>07152 
<a name="l07153"></a>07153    <span class="keywordflow">do</span> {
<a name="l07154"></a>07154       <span class="keywordflow">if</span> (logaxis)
<a name="l07155"></a>07155          y_screen = y1 - (log(y_act) - log(ymin)) / (log(ymax) - log(ymin)) * <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a>;
<a name="l07156"></a>07156       <span class="keywordflow">else</span>
<a name="l07157"></a>07157          y_screen = y1 - (y_act - ymin) / (ymax - ymin) * <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a>;
<a name="l07158"></a>07158       ys = (int) (y_screen + 0.5);
<a name="l07159"></a>07159 
<a name="l07160"></a>07160       <span class="keywordflow">if</span> (y_screen &lt; y1 - <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> - 0.001)
<a name="l07161"></a>07161          <span class="keywordflow">break</span>;
<a name="l07162"></a>07162 
<a name="l07163"></a>07163       <span class="keywordflow">if</span> (y_screen &lt;= y1 + 0.001) {
<a name="l07164"></a>07164          <span class="keywordflow">if</span> (fabs(floor(y_act / major_dy + 0.5) - y_act / major_dy) &lt;
<a name="l07165"></a>07165              dy / major_dy / 10.0) {
<a name="l07166"></a>07166             <span class="keywordflow">if</span> (fabs(floor(y_act / label_dy + 0.5) - y_act / label_dy) &lt;
<a name="l07167"></a>07167                 dy / label_dy / 10.0) {
<a name="l07168"></a>07168                <span class="keywordflow">if</span> (x1 != 0 || y1 != 0) {
<a name="l07169"></a>07169             <span class="comment">/**** label tick mark ****/</span>
<a name="l07170"></a>07170                   <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, x1, ys, x1 + text, ys, col);
<a name="l07171"></a>07171 
<a name="l07172"></a>07172             <span class="comment">/**** grid line ***/</span>
<a name="l07173"></a>07173                   <span class="keywordflow">if</span> (grid != 0 &amp;&amp; y_screen &lt; y1 &amp;&amp; y_screen &gt; y1 - <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a>) {
<a name="l07174"></a>07174                      <span class="keywordflow">if</span> (grid &gt; 0)
<a name="l07175"></a>07175                         <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, x1 + 1, ys, x1 + grid, ys, gcol);
<a name="l07176"></a>07176                      <span class="keywordflow">else</span>
<a name="l07177"></a>07177                         <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, x1 - 1, ys, x1 + grid, ys, gcol);
<a name="l07178"></a>07178                   }
<a name="l07179"></a>07179 
<a name="l07180"></a>07180             <span class="comment">/**** label ****/</span>
<a name="l07181"></a>07181                   <span class="keywordflow">if</span> (label != 0) {
<a name="l07182"></a>07182                      sprintf(str, <span class="stringliteral">&quot;%1.*lG&quot;</span>, n_sig1, y_act);
<a name="l07183"></a>07183                      <span class="keywordflow">if</span> (label &lt; 0)
<a name="l07184"></a>07184                         <a class="code" href="mgd_8h.html#a04908d388ee58943527604c035eb1aeb">gdImageString</a>(im, font, x1 + label - font-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a> * strlen(str),
<a name="l07185"></a>07185                                       ys - font-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> / 2, str, col);
<a name="l07186"></a>07186                      <span class="keywordflow">else</span>
<a name="l07187"></a>07187                         <a class="code" href="mgd_8h.html#a04908d388ee58943527604c035eb1aeb">gdImageString</a>(im, font, x1 + label, ys - font-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> / 2, str, col);
<a name="l07188"></a>07188 
<a name="l07189"></a>07189                      last_label_y = ys - font-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> / 2;
<a name="l07190"></a>07190                   }
<a name="l07191"></a>07191                } <span class="keywordflow">else</span> {
<a name="l07192"></a>07192                   sprintf(str, <span class="stringliteral">&quot;%1.*lG&quot;</span>, n_sig1, y_act);
<a name="l07193"></a>07193                   max_width = <a class="code" href="Mql_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(max_width, (<span class="keywordtype">int</span>) (font-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a> * strlen(str)));
<a name="l07194"></a>07194                }
<a name="l07195"></a>07195             } <span class="keywordflow">else</span> {
<a name="l07196"></a>07196                <span class="keywordflow">if</span> (x1 != 0 || y1 != 0) {
<a name="l07197"></a>07197             <span class="comment">/**** major tick mark ****/</span>
<a name="l07198"></a>07198                   <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, x1, ys, x1 + major, ys, col);
<a name="l07199"></a>07199 
<a name="l07200"></a>07200             <span class="comment">/**** grid line ***/</span>
<a name="l07201"></a>07201                   <span class="keywordflow">if</span> (grid != 0 &amp;&amp; y_screen &lt; y1 &amp;&amp; y_screen &gt; y1 - <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a>)
<a name="l07202"></a>07202                      <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, x1, ys, x1 + grid, ys, col);
<a name="l07203"></a>07203                }
<a name="l07204"></a>07204             }
<a name="l07205"></a>07205             <span class="keywordflow">if</span> (logaxis) {
<a name="l07206"></a>07206                dy *= 10;
<a name="l07207"></a>07207                major_dy *= 10;
<a name="l07208"></a>07208                label_dy *= 10;
<a name="l07209"></a>07209             }
<a name="l07210"></a>07210 
<a name="l07211"></a>07211          } <span class="keywordflow">else</span> {
<a name="l07212"></a>07212             <span class="keywordflow">if</span> (x1 != 0 || y1 != 0) {
<a name="l07213"></a>07213           <span class="comment">/**** minor tick mark ****/</span>
<a name="l07214"></a>07214                <a class="code" href="mgd_8h.html#a296f5987b2098717d2da0147a3acf7b3">gdImageLine</a>(im, x1, ys, x1 + minor, ys, col);
<a name="l07215"></a>07215             }
<a name="l07216"></a>07216 
<a name="l07217"></a>07217             <span class="comment">/* for logaxis, also put labes on minor tick marks */</span>
<a name="l07218"></a>07218             <span class="keywordflow">if</span> (logaxis) {
<a name="l07219"></a>07219                <span class="keywordflow">if</span> (label != 0) {
<a name="l07220"></a>07220                   <span class="keywordflow">if</span> (x1 != 0 || y1 != 0) {
<a name="l07221"></a>07221                      <span class="comment">/* calculate position of next major label */</span>
<a name="l07222"></a>07222                      y_next = pow(10, floor(log(y_act) / <a class="code" href="mhttpd_8c.html#a0b731aa35652c377dc6f58cd42969440">LN10</a>) + 1);
<a name="l07223"></a>07223                      y_screen =
<a name="l07224"></a>07224                          (int) (y1 -
<a name="l07225"></a>07225                                 (log(y_next) - log(ymin)) / (log(ymax) -
<a name="l07226"></a>07226                                                              log(ymin)) * <a class="code" href="mainWindow_8cpp.html#a2474a5474cbff19523a51eb1de01cda4">width</a> + 0.5);
<a name="l07227"></a>07227 
<a name="l07228"></a>07228                      <span class="keywordflow">if</span> (ys + font-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> / 2 &lt; last_label_y &amp;&amp;
<a name="l07229"></a>07229                          ys - font-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> / 2 &gt; y_screen + font-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> / 2) {
<a name="l07230"></a>07230                         sprintf(str, <span class="stringliteral">&quot;%1.*lG&quot;</span>, n_sig1, y_act);
<a name="l07231"></a>07231                         <span class="keywordflow">if</span> (label &lt; 0)
<a name="l07232"></a>07232                            <a class="code" href="mgd_8h.html#a04908d388ee58943527604c035eb1aeb">gdImageString</a>(im, font, x1 + label - font-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a> * strlen(str),
<a name="l07233"></a>07233                                          ys - font-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> / 2, str, col);
<a name="l07234"></a>07234                         <span class="keywordflow">else</span>
<a name="l07235"></a>07235                            <a class="code" href="mgd_8h.html#a04908d388ee58943527604c035eb1aeb">gdImageString</a>(im, font, x1 + label, ys - font-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> / 2, str,
<a name="l07236"></a>07236                                          col);
<a name="l07237"></a>07237                      }
<a name="l07238"></a>07238 
<a name="l07239"></a>07239                      last_label_y = ys - font-&gt;<a class="code" href="structgdFont.html#a5ea462fcaa5e64cc6e0a1be7de8f8e22">h</a> / 2;
<a name="l07240"></a>07240                   } <span class="keywordflow">else</span> {
<a name="l07241"></a>07241                      sprintf(str, <span class="stringliteral">&quot;%1.*lG&quot;</span>, n_sig1, y_act);
<a name="l07242"></a>07242                      max_width = <a class="code" href="Mql_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(max_width, (<span class="keywordtype">int</span>) (font-&gt;<a class="code" href="structgdFont.html#a48c26afb9d536c17bbf4fd122685b460">w</a> * strlen(str)));
<a name="l07243"></a>07243                   }
<a name="l07244"></a>07244                }
<a name="l07245"></a>07245             }
<a name="l07246"></a>07246          }
<a name="l07247"></a>07247       }
<a name="l07248"></a>07248 
<a name="l07249"></a>07249       y_act += dy;
<a name="l07250"></a>07250 
<a name="l07251"></a>07251       <span class="comment">/* supress 1.23E-17 ... */</span>
<a name="l07252"></a>07252       <span class="keywordflow">if</span> (fabs(y_act) &lt; dy / 100)
<a name="l07253"></a>07253          y_act = 0;
<a name="l07254"></a>07254 
<a name="l07255"></a>07255    } <span class="keywordflow">while</span> (1);
<a name="l07256"></a>07256 
<a name="l07257"></a>07257    <span class="keywordflow">return</span> max_width + <a class="code" href="generic_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(label);
<a name="l07258"></a>07258 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="aacdbc1e91899f516cd3947ea81b373ac"></a><!-- doxytag: member="mhttpd.c::_abort" ref="aacdbc1e91899f516cd3947ea81b373ac" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> <a class="el" href="mhttpd_8c.html#aacdbc1e91899f516cd3947ea81b373ac">_abort</a> = FALSE</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l09953">9953</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09955">ctrlc_handler()</a>, and <a class="el" href="mhttpd_8c_source.html#l09964">server_loop()</a>.</p>

</div>
</div>
<a class="anchor" id="a4d08376c0479b1115d6c07cf263459af"></a><!-- doxytag: member="mhttpd.c::_attachment_buffer" ref="a4d08376c0479b1115d6c07cf263459af" args="[3]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="mhttpd_8c.html#a4d08376c0479b1115d6c07cf263459af">_attachment_buffer</a>[3]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00887">887</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09841">decode_post()</a>, and <a class="el" href="mhttpd_8c_source.html#l03805">submit_elog()</a>.</p>

</div>
</div>
<a class="anchor" id="a42dc7c4c704ca581c25ba7582da7e05e"></a><!-- doxytag: member="mhttpd.c::_attachment_size" ref="a42dc7c4c704ca581c25ba7582da7e05e" args="[3]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="mhttpd_8c.html#a42dc7c4c704ca581c25ba7582da7e05e">_attachment_size</a>[3]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00888">888</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09841">decode_post()</a>, <a class="el" href="mhttpd_8c_source.html#l03805">submit_elog()</a>, and <a class="el" href="mhttpd_8c_source.html#l04034">submit_form()</a>.</p>

</div>
</div>
<a class="anchor" id="a8d769c1a97fec55473c5f591221dea4c"></a><!-- doxytag: member="mhttpd.c::_param" ref="a8d769c1a97fec55473c5f591221dea4c" args="[MAX_PARAM][PARAM_LENGTH]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="webpaw_8c.html#a8d769c1a97fec55473c5f591221dea4c">_param</a>[MAX_PARAM][PARAM_LENGTH]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00884">884</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

</div>
</div>
<a class="anchor" id="a22283e600d5dd8c6c363cccd5adc2529"></a><!-- doxytag: member="mhttpd.c::_sock" ref="a22283e600d5dd8c6c363cccd5adc2529" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="webpaw_8c.html#a275776e6df5d25b1778564974ea48485">_sock</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00890">890</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l01372">redirect2()</a>, <a class="el" href="mhttpd_8c_source.html#l09964">server_loop()</a>, and <a class="el" href="webpaw_8c_source.html#l00660">submit_paw()</a>.</p>

</div>
</div>
<a class="anchor" id="a81d95c442aeb0cc03e6fb077222a9a2b"></a><!-- doxytag: member="mhttpd.c::_text" ref="a81d95c442aeb0cc03e6fb077222a9a2b" args="[TEXT_SIZE]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="mhttpd_8c.html#a81d95c442aeb0cc03e6fb077222a9a2b">_text</a>[TEXT_SIZE]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00886">886</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l01072">getparam()</a>, <a class="el" href="mhttpd_8c_source.html#l01035">initparam()</a>, and <a class="el" href="mhttpd_8c_source.html#l01042">setparam()</a>.</p>

</div>
</div>
<a class="anchor" id="abcd78d8c212e69ce3b664c10cfabf5f6"></a><!-- doxytag: member="mhttpd.c::_value" ref="abcd78d8c212e69ce3b664c10cfabf5f6" args="[MAX_PARAM][VALUE_SIZE]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="webpaw_8c.html#abcd78d8c212e69ce3b664c10cfabf5f6">_value</a>[MAX_PARAM][VALUE_SIZE]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00885">885</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l01072">getparam()</a>, <a class="el" href="mhttpd_8c_source.html#l01035">initparam()</a>, <a class="el" href="mhttpd_8c_source.html#l01042">setparam()</a>, and <a class="el" href="mhttpd_8c_source.html#l01103">unsetparam()</a>.</p>

</div>
</div>
<a class="anchor" id="abc82b64a25110404c4a845a5e969b348"></a><!-- doxytag: member="mhttpd.c::connected" ref="abc82b64a25110404c4a845a5e969b348" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> <a class="el" href="mhttpd_8c.html#abc82b64a25110404c4a845a5e969b348">connected</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00875">875</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>, and <a class="el" href="mhttpd_8c_source.html#l09964">server_loop()</a>.</p>

</div>
</div>
<a class="anchor" id="a9c91f81733a48f1fbc887b013ee0de14"></a><!-- doxytag: member="mhttpd.c::elog_mode" ref="a9c91f81733a48f1fbc887b013ee0de14" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> <a class="el" href="mhttpd_8c.html#a9c91f81733a48f1fbc887b013ee0de14">elog_mode</a> = FALSE</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00891">891</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>, <a class="el" href="mhttpd_8c_source.html#l10293">main()</a>, <a class="el" href="mhttpd_8c_source.html#l02506">show_elog_new()</a>, <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>, <a class="el" href="mhttpd_8c_source.html#l02771">show_elog_query()</a>, <a class="el" href="mhttpd_8c_source.html#l03003">show_elog_submit_query()</a>, <a class="el" href="mhttpd_8c_source.html#l05737">show_odb_page()</a>, and <a class="el" href="mhttpd_8c_source.html#l03449">show_rawfile()</a>.</p>

</div>
</div>
<a class="anchor" id="a2f66ab590c0bf6aa5385f2c964eef5fe"></a><!-- doxytag: member="mhttpd.c::exp_name" ref="a2f66ab590c0bf6aa5385f2c964eef5fe" args="[32]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="mhttpd_8c.html#a2f66ab590c0bf6aa5385f2c964eef5fe">exp_name</a>[32]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00874">874</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

</div>
</div>
<a class="anchor" id="acbbdcdfacfc8c43d7d6ba5412ea70365"></a><!-- doxytag: member="mhttpd.c::ext" ref="acbbdcdfacfc8c43d7d6ba5412ea70365" args="[32]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="mhttpd_8c.html#acbbdcdfacfc8c43d7d6ba5412ea70365">ext</a>[32]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00935">935</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="ybos__simfe_8c_source.html#l00200">begin_of_run()</a>, <a class="el" href="ces8210_8c_source.html#l00124">cam16i()</a>, <a class="el" href="ces8210_8c_source.html#l00291">cam16o()</a>, <a class="el" href="ces8210_8c_source.html#l00135">cam24i()</a>, <a class="el" href="ces8210_8c_source.html#l00301">cam24o()</a>, <a class="el" href="esonetest_8c_source.html#l00004">isr()</a>, <a class="el" href="esonetest_8c_source.html#l00026">main()</a>, and <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>.</p>

</div>
</div>
<a class="anchor" id="ab9ec7b8b41990fd9f8dc4d6167c0dc4c"></a><!-- doxytag: member="mhttpd.c::filetype" ref="ab9ec7b8b41990fd9f8dc4d6167c0dc4c" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct { ... }   <a class="el" href="mhttpd_8c.html#ab9ec7b8b41990fd9f8dc4d6167c0dc4c">filetype</a>[]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>.</p>

</div>
</div>
<a class="anchor" id="af30d16605d5c80183cd199983a653081"></a><!-- doxytag: member="mhttpd.c::host_name" ref="af30d16605d5c80183cd199983a653081" args="[256]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="webpaw_8c.html#af30d16605d5c80183cd199983a653081">host_name</a>[256]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00873">873</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

</div>
</div>
<a class="anchor" id="acdef68f81e8b732531ba7f1de9d73fc5"></a><!-- doxytag: member="mhttpd.c::message_buffer" ref="acdef68f81e8b732531ba7f1de9d73fc5" args="[256]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="mhttpd_8c.html#acdef68f81e8b732531ba7f1de9d73fc5">message_buffer</a>[256] = &quot;&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l01177">1177</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l01179">print_message()</a>, and <a class="el" href="mhttpd_8c_source.html#l01641">show_status_page()</a>.</p>

</div>
</div>
<a class="anchor" id="acd81e4916e85a466130a378af645ed1d"></a><!-- doxytag: member="mhttpd.c::mname" ref="acd81e4916e85a466130a378af645ed1d" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="mhttpd_8c.html#acd81e4916e85a466130a378af645ed1d">mname</a>[]</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   <span class="stringliteral">&quot;January&quot;</span>,
   <span class="stringliteral">&quot;February&quot;</span>,
   <span class="stringliteral">&quot;March&quot;</span>,
   <span class="stringliteral">&quot;April&quot;</span>,
   <span class="stringliteral">&quot;May&quot;</span>,
   <span class="stringliteral">&quot;June&quot;</span>,
   <span class="stringliteral">&quot;July&quot;</span>,
   <span class="stringliteral">&quot;August&quot;</span>,
   <span class="stringliteral">&quot;September&quot;</span>,
   <span class="stringliteral">&quot;October&quot;</span>,
   <span class="stringliteral">&quot;November&quot;</span>,
   <span class="stringliteral">&quot;December&quot;</span>
}
</pre></div>
<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00894">894</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l06929">sec_to_label()</a>, <a class="el" href="mhttpd_8c_source.html#l02771">show_elog_query()</a>, <a class="el" href="mhttpd_8c_source.html#l03003">show_elog_submit_query()</a>, and <a class="el" href="mhttpd_8c_source.html#l08029">show_query_page()</a>.</p>

</div>
</div>
<a class="anchor" id="a203be81bafae956e5d4d101154c3528e"></a><!-- doxytag: member="mhttpd.c::net_buffer" ref="a203be81bafae956e5d4d101154c3528e" args="[WEB_BUFFER_SIZE]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="webpaw_8c.html#a203be81bafae956e5d4d101154c3528e">net_buffer</a>[WEB_BUFFER_SIZE]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l09962">9962</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

</div>
</div>
<a class="anchor" id="a62893d3a883339864af5371490807e54"></a><!-- doxytag: member="mhttpd.c::no_disconnect" ref="a62893d3a883339864af5371490807e54" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> <a class="el" href="mhttpd_8c.html#a62893d3a883339864af5371490807e54">no_disconnect</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00875">875</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l10293">main()</a>, and <a class="el" href="mhttpd_8c_source.html#l09964">server_loop()</a>.</p>

</div>
</div>
<a class="anchor" id="ae4c6d44dc33d45aceef3c6b589414715"></a><!-- doxytag: member="mhttpd.c::remote_addr" ref="ae4c6d44dc33d45aceef3c6b589414715" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct in_addr <a class="el" href="mhttpd_8c.html#ae4c6d44dc33d45aceef3c6b589414715">remote_addr</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00889">889</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l09964">server_loop()</a>, and <a class="el" href="mhttpd_8c_source.html#l03805">submit_elog()</a>.</p>

</div>
</div>
<a class="anchor" id="a156f86e47f22882eb9855d44e63a464b"></a><!-- doxytag: member="mhttpd.c::return_buffer" ref="a156f86e47f22882eb9855d44e63a464b" args="[WEB_BUFFER_SIZE]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="webpaw_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>[WEB_BUFFER_SIZE]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00870">870</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l07289">generate_hist_graph()</a>, <a class="el" href="webpaw_8c_source.html#l00823">interprete()</a>, <a class="el" href="rpc_8c_source.html#l00487">mrpc_execute()</a>, <a class="el" href="mhttpd_8c_source.html#l01372">redirect2()</a>, <a class="el" href="midas_8c_source.html#l10990">rpc_execute()</a>, <a class="el" href="midas_8c_source.html#l11292">rpc_execute_ascii()</a>, <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l00959">rsputs()</a>, <a class="el" href="mhttpd_8c_source.html#l00972">rsputs2()</a>, <a class="el" href="mhttpd_8c_source.html#l09964">server_loop()</a>, and <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>.</p>

</div>
</div>
<a class="anchor" id="a518fedf43db3f1313f9c88b2009380b5"></a><!-- doxytag: member="mhttpd.c::return_length" ref="a518fedf43db3f1313f9c88b2009380b5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="webpaw_8c.html#a518fedf43db3f1313f9c88b2009380b5">return_length</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00872">872</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l07289">generate_hist_graph()</a>, <a class="el" href="webpaw_8c_source.html#l00823">interprete()</a>, <a class="el" href="mhttpd_8c_source.html#l01372">redirect2()</a>, <a class="el" href="mhttpd_8c_source.html#l09964">server_loop()</a>, and <a class="el" href="mhttpd_8c_source.html#l04103">show_elog_page()</a>.</p>

</div>
</div>
<a class="anchor" id="a157641c7ced39a3ee593e8d6818e6566"></a><!-- doxytag: member="mhttpd.c::strlen_retbuf" ref="a157641c7ced39a3ee593e8d6818e6566" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="mhttpd_8c.html#a157641c7ced39a3ee593e8d6818e6566">strlen_retbuf</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00871">871</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l01014">rsprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l00959">rsputs()</a>, <a class="el" href="mhttpd_8c_source.html#l00972">rsputs2()</a>, <a class="el" href="mhttpd_8c_source.html#l09964">server_loop()</a>, and <a class="el" href="mhttpd_8c_source.html#l04659">show_sc_page()</a>.</p>

</div>
</div>
<a class="anchor" id="a63288067ecc0045da645c023c6867ecc"></a><!-- doxytag: member="mhttpd.c::system_list" ref="a63288067ecc0045da645c023c6867ecc" args="[20][NAME_LENGTH]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="mhttpd_8c.html#a63288067ecc0045da645c023c6867ecc">system_list</a>[20][NAME_LENGTH]</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   <span class="stringliteral">&quot;General&quot;</span>,
   <span class="stringliteral">&quot;DAQ&quot;</span>,
   <span class="stringliteral">&quot;Detector&quot;</span>,
   <span class="stringliteral">&quot;Electronics&quot;</span>,
   <span class="stringliteral">&quot;Target&quot;</span>,
   <span class="stringliteral">&quot;Beamline&quot;</span>
}
</pre></div>
<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00924">924</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l02506">show_elog_new()</a>, and <a class="el" href="mhttpd_8c_source.html#l02771">show_elog_query()</a>.</p>

</div>
</div>
<a class="anchor" id="aa9edbe9dd2977e5cc56138a3a05f7a98"></a><!-- doxytag: member="mhttpd.c::tcp_port" ref="aa9edbe9dd2977e5cc56138a3a05f7a98" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="mhttpd_8c.html#aa9edbe9dd2977e5cc56138a3a05f7a98">tcp_port</a> = 80</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00876">876</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l10293">main()</a>, <a class="el" href="mhttpd_8c_source.html#l09964">server_loop()</a>, and <a class="el" href="mhttpd_8c_source.html#l03805">submit_elog()</a>.</p>

</div>
</div>
<a class="anchor" id="a9acf1fefc6ac2287c48bfac44b8f3b81"></a><!-- doxytag: member="mhttpd.c::type" ref="a9acf1fefc6ac2287c48bfac44b8f3b81" args="[32]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="ybos_8c.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>[32]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00936">936</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

</div>
</div>
<a class="anchor" id="a204c9ddc30d18e95a386f1e6734e66f4"></a><!-- doxytag: member="mhttpd.c::type_list" ref="a204c9ddc30d18e95a386f1e6734e66f4" args="[20][NAME_LENGTH]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="mhttpd_8c.html#a204c9ddc30d18e95a386f1e6734e66f4">type_list</a>[20][NAME_LENGTH]</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   <span class="stringliteral">&quot;Routine&quot;</span>,
   <span class="stringliteral">&quot;Shift summary&quot;</span>,
   <span class="stringliteral">&quot;Minor error&quot;</span>,
   <span class="stringliteral">&quot;Severe error&quot;</span>,
   <span class="stringliteral">&quot;Fix&quot;</span>,
   <span class="stringliteral">&quot;Question&quot;</span>,
   <span class="stringliteral">&quot;Info&quot;</span>,
   <span class="stringliteral">&quot;Modification&quot;</span>,
   <span class="stringliteral">&quot;Reply&quot;</span>,
   <span class="stringliteral">&quot;Alarm&quot;</span>,
   <span class="stringliteral">&quot;Test&quot;</span>,
   <span class="stringliteral">&quot;Other&quot;</span>
}
</pre></div>
<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00909">909</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l02506">show_elog_new()</a>, and <a class="el" href="mhttpd_8c_source.html#l02771">show_elog_query()</a>.</p>

</div>
</div>
<a class="anchor" id="ad023bbf13e60f8caee82c26f70e0f0a5"></a><!-- doxytag: member="mhttpd.c::verbose" ref="ad023bbf13e60f8caee82c26f70e0f0a5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> <a class="el" href="mtape_8c.html#ad023bbf13e60f8caee82c26f70e0f0a5">verbose</a> = FALSE</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mhttpd_8c_source.html#l00892">892</a> of file <a class="el" href="mhttpd_8c_source.html">mhttpd.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 6 Jun 2014 for AlcapDAQ by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
