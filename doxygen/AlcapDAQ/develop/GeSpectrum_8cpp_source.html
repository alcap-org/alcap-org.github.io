<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>AlcapDAQ: rootana/src/GeSpectrum.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>rootana/src/GeSpectrum.cpp</h1><a href="GeSpectrum_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;<a class="code" href="GeSpectrum_8h.html">GeSpectrum.h</a>&quot;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &quot;<a class="code" href="RegisterModule_8inc.html">RegisterModule.inc</a>&quot;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &quot;<a class="code" href="TPulseIsland_8h.html">TPulseIsland.h</a>&quot;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &quot;<a class="code" href="TGlobalData_8h.html">TGlobalData.h</a>&quot;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &quot;<a class="code" href="TSetupData_8h.html">TSetupData.h</a>&quot;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &quot;<a class="code" href="ModulesOptions_8h.html">ModulesOptions.h</a>&quot;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;<a class="code" href="definitions_8h.html">definitions.h</a>&quot;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;<a class="code" href="SetupNavigator_8h.html">SetupNavigator.h</a>&quot;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;<a class="code" href="ExportPulse_8h.html">ExportPulse.h</a>&quot;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="code" href="PulseCandidateFinder_8h.html">PulseCandidateFinder.h</a>&quot;</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;TH1I.h&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;TH2D.h&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;TF1.h&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;TDirectory.h&quot;</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;numeric&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;climits&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="keyword">const</span> <a class="code" href="classIDs_1_1channel.html">IDs::channel</a> <a class="code" href="classGeSpectrum.html#a3c48f1bac41b26b68d97e670266c16cf">GeSpectrum::fGeS</a>(<a class="code" href="namespaceIDs.html#aa179f67aeac8473d1a57daaa59b4e8aeaad48db5e2c1c76f822373199710cc65e">IDs::kGe</a>, <a class="code" href="namespaceIDs.html#aecc6c6a922921188b481adeeb91f2e31a964c16a4b0c67d0c2a46515829d4b441">IDs::kSlow</a>);
<a name="l00027"></a>00027 <span class="keyword">const</span> <a class="code" href="classIDs_1_1channel.html">IDs::channel</a> <a class="code" href="classGeSpectrum.html#a2772efa9c299afd6004d4c61ebc28dc9">GeSpectrum::fGeF</a>(<a class="code" href="namespaceIDs.html#aa179f67aeac8473d1a57daaa59b4e8aeaad48db5e2c1c76f822373199710cc65e">IDs::kGe</a>, <a class="code" href="namespaceIDs.html#aecc6c6a922921188b481adeeb91f2e31aed3c6c495b6b1d50820412dca0e1f0cd">IDs::kFast</a>);
<a name="l00028"></a>00028 <span class="keyword">const</span> <a class="code" href="classIDs_1_1channel.html">IDs::channel</a> <a class="code" href="classGeSpectrum.html#a00d1d9e24e32a951248dfc84025a549a">GeSpectrum::fMuSc</a>(<a class="code" href="namespaceIDs.html#aa179f67aeac8473d1a57daaa59b4e8aea9f7d7f2c53d9b647950010051d538a01">IDs::kMuSc</a>, <a class="code" href="namespaceIDs.html#aecc6c6a922921188b481adeeb91f2e31a681e98882a8133802fa8beb7ff789aae">IDs::kNotApplicable</a>);
<a name="l00029"></a>00029 
<a name="l00030"></a><a class="code" href="classGeSpectrum.html#aeb18deb210109f1ec78da88ddb13510b">00030</a> <a class="code" href="classGeSpectrum.html#aeb18deb210109f1ec78da88ddb13510b" title="Constructor description. If necessary, add a details tag like above.">GeSpectrum::GeSpectrum</a>(<a class="code" href="classmodules_1_1options.html" title="Class to handle options given through the MODULES file.">modules::options</a>* opts) :
<a name="l00031"></a>00031   <a class="code" href="classBaseModule.html">BaseModule</a>(<span class="stringliteral">&quot;GeSpectrum&quot;</span>,opts),
<a name="l00032"></a>00032   fHist_Energy(NULL), fHist_Time(NULL), fHist_MoreTime(NULL),
<a name="l00033"></a>00033   fHist_EnergyOOT(NULL), fHist_EnergyFarOOT(NULL), fHist_TimeEnergy(NULL), fHist_MeanTOffset(NULL),
<a name="l00034"></a>00034   fMBAmpGe(<a class="code" href="classSetupNavigator.html">SetupNavigator</a>::Instance()-&gt;GetPedestal(fGeS), <a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>::Instance()-&gt;GetTriggerPolarity(<a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>::Instance()-&gt;GetBankName(fGeS.str()))),
<a name="l00035"></a>00035   fMBAmpMuSc(<a class="code" href="classSetupNavigator.html">SetupNavigator</a>::Instance()-&gt;GetPedestal(fMuSc), <a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>::Instance()-&gt;GetTriggerPolarity(<a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>::Instance()-&gt;GetBankName(fMuSc.str()))),
<a name="l00036"></a>00036   fCFTimeGe(<a class="code" href="classSetupNavigator.html">SetupNavigator</a>::Instance()-&gt;GetPedestal(fGeF),
<a name="l00037"></a>00037             <a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>::Instance()-&gt;GetTriggerPolarity(<a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>::Instance()-&gt;GetBankName(fGeF.str())),
<a name="l00038"></a>00038             <a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>::Instance()-&gt;GetClockTick(<a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>::Instance()-&gt;GetBankName(fGeF.str())),
<a name="l00039"></a>00039             <a class="code" href="classSetupNavigator.html">SetupNavigator</a>::Instance()-&gt;GetCoarseTimeOffset(IDs::source(fGeF, IDs::generator(opts-&gt;GetString(<span class="stringliteral">&quot;gef_gen&quot;</span>), opts-&gt;GetString(<span class="stringliteral">&quot;gef_cfg&quot;</span>)))),
<a name="l00040"></a>00040             opts-&gt;<a class="code" href="namespacemodules_1_1parser.html#a0fbddc06cf5ff21fe6aab31f83b088d0">GetDouble</a>(<span class="stringliteral">&quot;gef_cf&quot;</span>)),
<a name="l00041"></a>00041   fCFTimeMuSc(<a class="code" href="classSetupNavigator.html">SetupNavigator</a>::Instance()-&gt;GetPedestal(fMuSc),
<a name="l00042"></a>00042               <a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>::Instance()-&gt;GetTriggerPolarity(<a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>::Instance()-&gt;GetBankName(fMuSc.str())),
<a name="l00043"></a>00043               <a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>::Instance()-&gt;GetClockTick(<a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>::Instance()-&gt;GetBankName(fMuSc.str())),
<a name="l00044"></a>00044               0.,
<a name="l00045"></a>00045               opts-&gt;<a class="code" href="namespacemodules_1_1parser.html#a0fbddc06cf5ff21fe6aab31f83b088d0">GetDouble</a>(<span class="stringliteral">&quot;musc_cf&quot;</span>)),
<a name="l00046"></a>00046   fADC2Energy(new TF1(<span class="stringliteral">&quot;adc2energy&quot;</span>,<span class="stringliteral">&quot;[0]*x+[1]&quot;</span>)),
<a name="l00047"></a>00047   fTimeWindow_Small(1000.), fTimeWindow_Big(5000.), fPileupProtectionWindow(15000.) {
<a name="l00048"></a>00048   <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">int</span> nbins = std::pow(2.,14);
<a name="l00049"></a>00049   <span class="keyword">const</span> std::pair&lt;double,double&gt; adc2energy_par = <a class="code" href="classSetupNavigator.html#acc09765c4d2ca0e1205977075bd7eb49">SetupNavigator::Instance</a>()-&gt;<a class="code" href="classSetupNavigator.html#ad6928600fac820b6fbd2eafaa07bc5b6" title="Gets the energy calibration constants.">GetEnergyCalibrationConstants</a>(<a class="code" href="classIDs_1_1channel.html">IDs::channel</a>(<span class="stringliteral">&quot;Ge-S&quot;</span>));
<a name="l00050"></a>00050   <a class="code" href="classGeSpectrum.html#a95dd43711bbf2f8ec9cc1fd661850d93">fADC2Energy</a>-&gt;SetParameters(adc2energy_par.first, adc2energy_par.second);
<a name="l00051"></a>00051   TDirectory* cwd = TDirectory::CurrentDirectory();
<a name="l00052"></a>00052   <a class="code" href="classBaseModule.html#aa00f24e65a18c1d08149965da0fa1a22">dir</a>-&gt;cd();
<a name="l00053"></a>00053   <a class="code" href="classGeSpectrum.html#aed57fdfa2e7173db437b6549375df00e">fHist_ADC</a>          = <span class="keyword">new</span> TH1D(<span class="stringliteral">&quot;hADC&quot;</span>, <span class="stringliteral">&quot;Energy of Gammas;Energy (ADC);Counts&quot;</span>, nbins, 0., nbins);
<a name="l00054"></a>00054 
<a name="l00055"></a>00055   <span class="keywordtype">double</span> energy_bin_width = 0.1; <span class="comment">// keV</span>
<a name="l00056"></a>00056   <span class="keywordtype">double</span> min_energy = 0;
<a name="l00057"></a>00057   <span class="keywordtype">double</span> max_energy = 2000;
<a name="l00058"></a>00058   <span class="keywordtype">int</span> n_energy_bins = (max_energy - min_energy) / energy_bin_width;
<a name="l00059"></a>00059   <a class="code" href="classGeSpectrum.html#a176bb031a643cb89cab521a1229edd53">fHist_Energy</a>       = <span class="keyword">new</span> TH1D(<span class="stringliteral">&quot;hEnergy&quot;</span>, <span class="stringliteral">&quot;Energy of Gammas;Energy (keV);Counts&quot;</span>, n_energy_bins, min_energy, max_energy);
<a name="l00060"></a>00060   <a class="code" href="classGeSpectrum.html#aae2bc8d40199e23a94c8f6019bd4d3d9">fHist_Time</a>         = <span class="keyword">new</span> TH1D(<span class="stringliteral">&quot;hTime&quot;</span>, <span class="stringliteral">&quot;Time of Gammas within Energy Window&quot;</span>, 1000, -10000., 10000.);
<a name="l00061"></a>00061   <a class="code" href="classGeSpectrum.html#add7ac7c7c5f08bc9ef98329c3490f998">fHist_MoreTime</a>     = <span class="keyword">new</span> TH1D(<span class="stringliteral">&quot;hMoreTime&quot;</span>, <span class="stringliteral">&quot;Time of Gammas within Energy Window (Wide)&quot;</span>, 1000, -100000., 100000.);
<a name="l00062"></a>00062   <a class="code" href="classGeSpectrum.html#abf527ba6f8443b3fe1d3c65f7984b726">fHist_ADCOOT</a>       = <span class="keyword">new</span> TH1D(<span class="stringliteral">&quot;hADCOOT&quot;</span>, <span class="stringliteral">&quot;Energy of Gammas outside of Time Window;Energy (ADC);Counts&quot;</span>, nbins, 0., nbins);
<a name="l00063"></a>00063   <a class="code" href="classGeSpectrum.html#a274934dead467330d1d84887d2fe60ac">fHist_EnergyOOT</a>    = <span class="keyword">new</span> TH1D(<span class="stringliteral">&quot;hEnergyOOT&quot;</span>, <span class="stringliteral">&quot;Energy of Gammas outside of Time Window;Energy (keV);Counts&quot;</span>, n_energy_bins, min_energy, max_energy);
<a name="l00064"></a>00064   <a class="code" href="classGeSpectrum.html#aec60ed832220bbe5c549fa738d8b31ad">fHist_ADCFarOOT</a>    = <span class="keyword">new</span> TH1D(<span class="stringliteral">&quot;hADCFarOOT&quot;</span>, <span class="stringliteral">&quot;Energy of Gammas far from Muons;Energy (ADC);Counts&quot;</span>, nbins, 0., nbins);
<a name="l00065"></a>00065   <a class="code" href="classGeSpectrum.html#ab6b338834dd1ab919579ab2a244ababd">fHist_EnergyFarOOT</a> = <span class="keyword">new</span> TH1D(<span class="stringliteral">&quot;hEnergyFarOOT&quot;</span>, <span class="stringliteral">&quot;Energy of Gammas far from Muons;Energy (keV);Counts&quot;</span>, n_energy_bins, min_energy, max_energy);
<a name="l00066"></a>00066   <a class="code" href="classGeSpectrum.html#a3df9cab164d30d29312b6b8f44cc6eec">fHist_TimeOOT</a>      = <span class="keyword">new</span> TH1D(<span class="stringliteral">&quot;hTimeOOT&quot;</span>, <span class="stringliteral">&quot;Time of Gammas outside of Time Window&quot;</span>, 1000., -2.*<a class="code" href="classGeSpectrum.html#a484672deaf86bcbe4504fae85907caa3">fTimeWindow_Small</a>, 2.*<a class="code" href="classGeSpectrum.html#a484672deaf86bcbe4504fae85907caa3">fTimeWindow_Small</a>);
<a name="l00067"></a>00067   <a class="code" href="classGeSpectrum.html#a50662cbae017970783f8afd861422138">fHist_TimeFarOOT</a>   = <span class="keyword">new</span> TH1D(<span class="stringliteral">&quot;hTimeFarOOT&quot;</span>, <span class="stringliteral">&quot;Time of Gammas far from Muons&quot;</span>, 1000., -100.*<a class="code" href="classGeSpectrum.html#a4526541637db3df7785907908744cc1d">fTimeWindow_Big</a>, 100.*<a class="code" href="classGeSpectrum.html#a4526541637db3df7785907908744cc1d">fTimeWindow_Big</a>);
<a name="l00068"></a>00068   <a class="code" href="classGeSpectrum.html#a896af334d004a9b7d087d67f6373b18f">fHist_TimeADC</a>      = <span class="keyword">new</span> TH2D(<span class="stringliteral">&quot;hTimeADC&quot;</span>, <span class="stringliteral">&quot;Energy of Gammas within Time Window;Energy (ADC);Time (ns);Counts&quot;</span>, 100, -<a class="code" href="classGeSpectrum.html#a484672deaf86bcbe4504fae85907caa3">fTimeWindow_Small</a>, <a class="code" href="classGeSpectrum.html#a484672deaf86bcbe4504fae85907caa3">fTimeWindow_Small</a>, nbins, 0., nbins);
<a name="l00069"></a>00069   <a class="code" href="classGeSpectrum.html#a4188b7ed89f61d9ec2ba0a5101f53d1f">fHist_TimeEnergy</a>   = <span class="keyword">new</span> TH2D(<span class="stringliteral">&quot;hTimeEnergy&quot;</span>, <span class="stringliteral">&quot;Energy of Gammas within Time Window;Energy (keV);Time (ns);Counts&quot;</span>, 100, -<a class="code" href="classGeSpectrum.html#a484672deaf86bcbe4504fae85907caa3">fTimeWindow_Small</a>, <a class="code" href="classGeSpectrum.html#a484672deaf86bcbe4504fae85907caa3">fTimeWindow_Small</a>, n_energy_bins, min_energy, max_energy);
<a name="l00070"></a>00070   <a class="code" href="classGeSpectrum.html#aa59cdcc592141dff3039ca33284cf068">fHist_MeanTOffset</a>  = <span class="keyword">new</span> TH1D(<span class="stringliteral">&quot;hMeanTOffset&quot;</span>, <span class="stringliteral">&quot;Mean offset from nearest muon taken over MIDAS event&quot;</span>, 4000, -4.*<a class="code" href="classGeSpectrum.html#a4526541637db3df7785907908744cc1d">fTimeWindow_Big</a>, 4.*<a class="code" href="classGeSpectrum.html#a4526541637db3df7785907908744cc1d">fTimeWindow_Big</a>);
<a name="l00071"></a>00071   cwd-&gt;cd();
<a name="l00072"></a>00072   <a class="code" href="classGeSpectrum.html#a4db76bf1276a4edf9699b03d5c0e022b">ThrowIfInputsInsane</a>(opts);
<a name="l00073"></a>00073 }
<a name="l00074"></a>00074 
<a name="l00075"></a><a class="code" href="classGeSpectrum.html#a883231044d2d592d802f4ee7f6de1906">00075</a> <a class="code" href="classGeSpectrum.html#a883231044d2d592d802f4ee7f6de1906" title="Is anything done in the destructor?">GeSpectrum::~GeSpectrum</a>(){
<a name="l00076"></a>00076 }
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="comment">// Called before the main event loop</span>
<a name="l00079"></a>00079 <span class="comment">// Can be used to set things up, like histograms etc</span>
<a name="l00080"></a>00080 <span class="comment">// Return non-zero to indicate a problem</span>
<a name="l00081"></a><a class="code" href="classGeSpectrum.html#a0861f1460dbfa1a1440be28ed6eae1e6">00081</a> <span class="keywordtype">int</span> <a class="code" href="classGeSpectrum.html#a0861f1460dbfa1a1440be28ed6eae1e6" title="Does nothing.">GeSpectrum::BeforeFirstEntry</a>(<a class="code" href="classTGlobalData.html" title="This class holds all of the data created by alcapana analysis modules.">TGlobalData</a>* <a class="code" href="group__MCAENPulseIslandSortAndStitch.html#ga69cb952a194ddefc6004dd96e70ccd62" title="Object to hold data used and produced by modules throughout alcapana stage of analysis...">gData</a>, <span class="keyword">const</span> <a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a> *setup){
<a name="l00082"></a>00082   <span class="keywordflow">return</span> 0;
<a name="l00083"></a>00083 }
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="comment">// Called once for each event in the main event loop</span>
<a name="l00086"></a>00086 <span class="comment">// Return non-zero to indicate a problem and terminate the event loop</span>
<a name="l00087"></a><a class="code" href="classGeSpectrum.html#ad87af239d31922dd2893938e6f0def84">00087</a> <span class="keywordtype">int</span> <a class="code" href="classGeSpectrum.html#ad87af239d31922dd2893938e6f0def84" title="Histograms the heights in the germanium with time cuts relative to muSc.">GeSpectrum::ProcessEntry</a>(<a class="code" href="classTGlobalData.html" title="This class holds all of the data created by alcapana analysis modules.">TGlobalData</a>* <a class="code" href="group__MCAENPulseIslandSortAndStitch.html#ga69cb952a194ddefc6004dd96e70ccd62" title="Object to hold data used and produced by modules throughout alcapana stage of analysis...">gData</a>, <span class="keyword">const</span> <a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a> *setup){
<a name="l00088"></a>00088 
<a name="l00089"></a>00089   <span class="keyword">static</span> <span class="keyword">const</span> std::string bank_musc = <a class="code" href="group__alcapana__main.html#ga96d8c48f8693f69adda6aac005d17589" title="(Quasi-)Singleton interface">TSetupData::Instance</a>()-&gt;<a class="code" href="classTSetupData.html#a9d2cb193423208f99c9ee4673098f038">GetBankName</a>(<a class="code" href="classGeSpectrum.html#a00d1d9e24e32a951248dfc84025a549a">fMuSc</a>.<a class="code" href="classIDs_1_1channel.html#a8f2b9b6975b1a6e0f23830ba85f04ae9" title="Returns the channel as a string.">str</a>());
<a name="l00090"></a>00090   <span class="keyword">static</span> <span class="keyword">const</span> std::string bank_ges  = <a class="code" href="group__alcapana__main.html#ga96d8c48f8693f69adda6aac005d17589" title="(Quasi-)Singleton interface">TSetupData::Instance</a>()-&gt;<a class="code" href="classTSetupData.html#a9d2cb193423208f99c9ee4673098f038">GetBankName</a>(<a class="code" href="classGeSpectrum.html#a3c48f1bac41b26b68d97e670266c16cf">fGeS</a>.<a class="code" href="classIDs_1_1channel.html#a8f2b9b6975b1a6e0f23830ba85f04ae9" title="Returns the channel as a string.">str</a>());
<a name="l00091"></a>00091   <span class="keyword">static</span> <span class="keyword">const</span> std::string bank_gef  = <a class="code" href="group__alcapana__main.html#ga96d8c48f8693f69adda6aac005d17589" title="(Quasi-)Singleton interface">TSetupData::Instance</a>()-&gt;<a class="code" href="classTSetupData.html#a9d2cb193423208f99c9ee4673098f038">GetBankName</a>(<a class="code" href="classGeSpectrum.html#a2772efa9c299afd6004d4c61ebc28dc9">fGeF</a>.<a class="code" href="classIDs_1_1channel.html#a8f2b9b6975b1a6e0f23830ba85f04ae9" title="Returns the channel as a string.">str</a>());
<a name="l00092"></a>00092 
<a name="l00093"></a>00093   <span class="keyword">const</span> std::map&lt; std::string, std::vector&lt;TPulseIsland*&gt; &gt;&amp; TPIMap = gData-&gt;<a class="code" href="classTGlobalData.html#af871aca81ed72f5b05f063cfb471d9e8" title="Map of bank names to vectors of TPIs.">fPulseIslandToChannelMap</a>;
<a name="l00094"></a>00094   <a class="code" href="classGeSpectrum.html#aae5056133494cfe36ee999b690b3a671">ThrowIfGeInsane</a>(TPIMap.at(bank_ges), TPIMap.at(bank_gef));
<a name="l00095"></a>00095   <span class="keywordflow">if</span> (!(TPIMap.count(bank_musc) &amp;&amp; TPIMap.count(bank_ges) &amp;&amp; TPIMap.count(bank_gef)))
<a name="l00096"></a>00096     <span class="keywordflow">return</span> 0;
<a name="l00097"></a>00097   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (TPIMap.at(bank_musc).size() == 0 || TPIMap.at(bank_ges).size() == 0 || TPIMap.at(bank_gef).size() == 0)
<a name="l00098"></a>00098     <span class="keywordflow">return</span> 0;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100   <span class="keyword">const</span> std::vector&lt;double&gt; muScTimes  = <a class="code" href="classGeSpectrum.html#a98a991bc12830b4c3d742b7bbf4acec7" title="Takes a vector of TPIs and calculates all of their times.">CalculateTimes</a>(<a class="code" href="classGeSpectrum.html#a00d1d9e24e32a951248dfc84025a549a">fMuSc</a>,   TPIMap.at(bank_musc));
<a name="l00101"></a>00101   <span class="keyword">const</span> std::vector&lt;double&gt; muScEnergies  = <a class="code" href="classGeSpectrum.html#a5a61409a5727933a243304194bf13bf4" title="Takes a vector of TPIs and calculates all of their energies.">CalculateEnergies</a>(<a class="code" href="classGeSpectrum.html#a00d1d9e24e32a951248dfc84025a549a">fMuSc</a>,   TPIMap.at(bank_musc));
<a name="l00102"></a>00102   <span class="keyword">const</span> std::vector&lt;double&gt; geTimes    = <a class="code" href="classGeSpectrum.html#a98a991bc12830b4c3d742b7bbf4acec7" title="Takes a vector of TPIs and calculates all of their times.">CalculateTimes</a>(<a class="code" href="classGeSpectrum.html#a2772efa9c299afd6004d4c61ebc28dc9">fGeF</a>,    TPIMap.at(bank_gef));
<a name="l00103"></a>00103   <span class="keyword">const</span> std::vector&lt;double&gt; geEnergies = <a class="code" href="classGeSpectrum.html#a5a61409a5727933a243304194bf13bf4" title="Takes a vector of TPIs and calculates all of their energies.">CalculateEnergies</a>(<a class="code" href="classGeSpectrum.html#a3c48f1bac41b26b68d97e670266c16cf">fGeS</a>, TPIMap.at(bank_ges));
<a name="l00104"></a>00104   
<a name="l00105"></a>00105   std::vector&lt;double&gt; muScTimesPP(muScTimes), muScEnergiesPP(muScEnergies);
<a name="l00106"></a>00106   <a class="code" href="classGeSpectrum.html#a3cf43d2c624dee47831807959c1ed6cf">RemovePileupMuScPulses</a>(muScTimesPP, muScEnergiesPP);
<a name="l00107"></a>00107 
<a name="l00108"></a>00108   <span class="comment">//************************************//</span>
<a name="l00109"></a>00109   <span class="comment">//***** First get average offset *****//</span>
<a name="l00110"></a>00110   <span class="comment">//************************************//</span>
<a name="l00111"></a>00111   TH1I hTOff(<span class="stringliteral">&quot;hTOff&quot;</span>, <span class="stringliteral">&quot;Time Offset&quot;</span>, 4000, -20000., 20000.);
<a name="l00112"></a>00112   <span class="keywordflow">for</span> (<a class="code" href="namespacemodules.html#aecc7811d5380ed9d9e903c9b71a396aa">std::vector&lt;double&gt;::const_iterator</a> geT = geTimes.begin(), prev = muScTimesPP.begin(), next;
<a name="l00113"></a>00113        geT != geTimes.end();
<a name="l00114"></a>00114        ++geT) {
<a name="l00115"></a>00115     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> unfound = 1e9;
<a name="l00116"></a>00116     <span class="keywordtype">double</span> dt[2] = {unfound, unfound}, &amp;dt_prev = dt[0], &amp;dt_next = dt[1];
<a name="l00117"></a>00117     <a class="code" href="namespacemodules.html#aecc7811d5380ed9d9e903c9b71a396aa">std::vector&lt;double&gt;::const_iterator</a> end = muScTimesPP.end();
<a name="l00118"></a>00118     next = std::upper_bound(prev, end, *geT);
<a name="l00119"></a>00119     prev = next - 1;
<a name="l00120"></a>00120     <span class="keywordflow">if</span> (next == muScTimesPP.end())
<a name="l00121"></a>00121       dt_prev = *geT - *prev;
<a name="l00122"></a>00122     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (next == muScTimesPP.begin()) {
<a name="l00123"></a>00123       dt_next = *geT - *next;
<a name="l00124"></a>00124       prev = next;
<a name="l00125"></a>00125     } <span class="keywordflow">else</span> {
<a name="l00126"></a>00126       dt_prev = *geT - *prev;
<a name="l00127"></a>00127       dt_next = *geT - *next;
<a name="l00128"></a>00128     }
<a name="l00129"></a>00129     
<a name="l00130"></a>00130     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> it = 0; it &lt; 2; ++it)
<a name="l00131"></a>00131       <span class="keywordflow">if</span> (std::abs(dt[it]) &lt; 20000.)
<a name="l00132"></a>00132         hTOff.Fill(dt[it]);
<a name="l00133"></a>00133 
<a name="l00134"></a>00134   }
<a name="l00135"></a>00135   <span class="keywordtype">double</span> tOff = 0.;
<a name="l00136"></a>00136   <span class="keywordflow">if</span> (hTOff.Integral() &gt; 1) {
<a name="l00137"></a>00137     tOff = hTOff.GetMean();
<a name="l00138"></a>00138     <a class="code" href="classGeSpectrum.html#aa59cdcc592141dff3039ca33284cf068">fHist_MeanTOffset</a>-&gt;Fill(tOff);
<a name="l00139"></a>00139   }
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 
<a name="l00142"></a>00142   <span class="comment">//**************************//</span>
<a name="l00143"></a>00143   <span class="comment">//***** Now make plots *****//</span>
<a name="l00144"></a>00144   <span class="comment">//**************************//</span>
<a name="l00145"></a>00145   <span class="keywordflow">for</span> (<a class="code" href="namespacemodules.html#aecc7811d5380ed9d9e903c9b71a396aa">std::vector&lt;double&gt;::const_iterator</a> geT = geTimes.begin(), geE = geEnergies.begin(), prev = muScTimesPP.begin(), next;
<a name="l00146"></a>00146        geT != geTimes.end() &amp;&amp; geE != geEnergies.end();
<a name="l00147"></a>00147        ++geT, ++geE) {
<a name="l00148"></a>00148     <span class="keywordtype">bool</span> prev_found = <span class="keyword">false</span>, next_found = <span class="keyword">false</span>;
<a name="l00149"></a>00149     <span class="keywordtype">double</span> dt_prev, dt_next;
<a name="l00150"></a>00150   
<a name="l00151"></a>00151     <span class="comment">// Find the time difference with the most recent muon</span>
<a name="l00152"></a>00152     <span class="comment">// both before and after.</span>
<a name="l00153"></a>00153     <a class="code" href="namespacemodules.html#aecc7811d5380ed9d9e903c9b71a396aa">std::vector&lt;double&gt;::const_iterator</a> end = muScTimesPP.end();
<a name="l00154"></a>00154     next = std::upper_bound(prev, end, *geT);
<a name="l00155"></a>00155     prev = next - 1;
<a name="l00156"></a>00156     <span class="keywordflow">if</span> (next == muScTimesPP.end()) {
<a name="l00157"></a>00157       dt_prev = *geT - *prev;
<a name="l00158"></a>00158       prev_found = <span class="keyword">true</span>;
<a name="l00159"></a>00159     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (next == muScTimesPP.begin()) {
<a name="l00160"></a>00160       dt_next = *geT - *next;
<a name="l00161"></a>00161       next_found = <span class="keyword">true</span>;
<a name="l00162"></a>00162     } <span class="keywordflow">else</span> {
<a name="l00163"></a>00163       <span class="comment">// The vast majority of cases are here</span>
<a name="l00164"></a>00164       dt_prev = *geT - *prev;
<a name="l00165"></a>00165       dt_next = *geT - *next;
<a name="l00166"></a>00166       prev_found = next_found = <span class="keyword">true</span>;
<a name="l00167"></a>00167     }
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     <span class="comment">// Plot energy</span>
<a name="l00170"></a>00170     <span class="keywordflow">if</span> (( !prev_found || dt_prev &gt; <a class="code" href="classGeSpectrum.html#a4526541637db3df7785907908744cc1d">fTimeWindow_Big</a>) &amp;&amp; ( !next_found || dt_next &lt; -<a class="code" href="classGeSpectrum.html#a4526541637db3df7785907908744cc1d">fTimeWindow_Big</a>) ) {
<a name="l00171"></a>00171       <a class="code" href="classGeSpectrum.html#aec60ed832220bbe5c549fa738d8b31ad">fHist_ADCFarOOT</a>-&gt;Fill(*geE);
<a name="l00172"></a>00172       <a class="code" href="classGeSpectrum.html#ab6b338834dd1ab919579ab2a244ababd">fHist_EnergyFarOOT</a>-&gt;Fill(<a class="code" href="classGeSpectrum.html#a95dd43711bbf2f8ec9cc1fd661850d93">fADC2Energy</a>-&gt;Eval(*geE));
<a name="l00173"></a>00173     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (!prev_found || dt_prev &gt; <a class="code" href="classGeSpectrum.html#a484672deaf86bcbe4504fae85907caa3">fTimeWindow_Small</a>) &amp;&amp; (!next_found || dt_next &lt; -<a class="code" href="classGeSpectrum.html#a484672deaf86bcbe4504fae85907caa3">fTimeWindow_Small</a>) ) {
<a name="l00174"></a>00174       <a class="code" href="classGeSpectrum.html#abf527ba6f8443b3fe1d3c65f7984b726">fHist_ADCOOT</a>-&gt;Fill(*geE);
<a name="l00175"></a>00175       <a class="code" href="classGeSpectrum.html#a274934dead467330d1d84887d2fe60ac">fHist_EnergyOOT</a>-&gt;Fill(<a class="code" href="classGeSpectrum.html#a95dd43711bbf2f8ec9cc1fd661850d93">fADC2Energy</a>-&gt;Eval(*geE));
<a name="l00176"></a>00176     } <span class="keywordflow">else</span> {
<a name="l00177"></a>00177       <span class="keywordflow">if</span> (prev_found &amp;&amp; dt_prev &lt;= <a class="code" href="classGeSpectrum.html#a484672deaf86bcbe4504fae85907caa3">fTimeWindow_Small</a>) {
<a name="l00178"></a>00178         <a class="code" href="classGeSpectrum.html#a896af334d004a9b7d087d67f6373b18f">fHist_TimeADC</a>-&gt;Fill(dt_prev, *geE);
<a name="l00179"></a>00179         <a class="code" href="classGeSpectrum.html#a4188b7ed89f61d9ec2ba0a5101f53d1f">fHist_TimeEnergy</a>-&gt;Fill(dt_prev, <a class="code" href="classGeSpectrum.html#a95dd43711bbf2f8ec9cc1fd661850d93">fADC2Energy</a>-&gt;Eval(*geE));
<a name="l00180"></a>00180       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (next_found &amp;&amp; dt_next &gt;= -<a class="code" href="classGeSpectrum.html#a484672deaf86bcbe4504fae85907caa3">fTimeWindow_Small</a>) {
<a name="l00181"></a>00181         <a class="code" href="classGeSpectrum.html#a896af334d004a9b7d087d67f6373b18f">fHist_TimeADC</a>-&gt;Fill(dt_next, *geE);
<a name="l00182"></a>00182         <a class="code" href="classGeSpectrum.html#a4188b7ed89f61d9ec2ba0a5101f53d1f">fHist_TimeEnergy</a>-&gt;Fill(dt_next, <a class="code" href="classGeSpectrum.html#a95dd43711bbf2f8ec9cc1fd661850d93">fADC2Energy</a>-&gt;Eval(*geE));
<a name="l00183"></a>00183       } <span class="keywordflow">else</span> {
<a name="l00184"></a>00184         std::cout &lt;&lt; <span class="stringliteral">&quot;WARNING: Unexpected branch! Prev: (&quot;</span> &lt;&lt; prev_found &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dt_prev &lt;&lt; <span class="stringliteral">&quot;), Next: (&quot;</span> &lt;&lt; next_found &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dt_next &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;
<a name="l00185"></a>00185       }
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187     <a class="code" href="classGeSpectrum.html#aed57fdfa2e7173db437b6549375df00e">fHist_ADC</a>-&gt;Fill(*geE);
<a name="l00188"></a>00188     <a class="code" href="classGeSpectrum.html#a176bb031a643cb89cab521a1229edd53">fHist_Energy</a>-&gt;Fill(<a class="code" href="classGeSpectrum.html#a95dd43711bbf2f8ec9cc1fd661850d93">fADC2Energy</a>-&gt;Eval(*geE));
<a name="l00189"></a>00189     <span class="comment">// Plot time</span>
<a name="l00190"></a>00190     <span class="keywordflow">if</span> (prev_found) {
<a name="l00191"></a>00191       <span class="keywordflow">if</span> (dt_prev &gt; <a class="code" href="classGeSpectrum.html#a4526541637db3df7785907908744cc1d">fTimeWindow_Big</a>)
<a name="l00192"></a>00192         <a class="code" href="classGeSpectrum.html#a50662cbae017970783f8afd861422138">fHist_TimeFarOOT</a>-&gt;Fill(dt_prev);
<a name="l00193"></a>00193       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dt_prev &gt; <a class="code" href="classGeSpectrum.html#a484672deaf86bcbe4504fae85907caa3">fTimeWindow_Small</a>)
<a name="l00194"></a>00194         <a class="code" href="classGeSpectrum.html#a3df9cab164d30d29312b6b8f44cc6eec">fHist_TimeOOT</a>-&gt;Fill(dt_prev);
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196     <span class="keywordflow">if</span> (next_found) {
<a name="l00197"></a>00197       <span class="keywordflow">if</span> (dt_next &lt; -<a class="code" href="classGeSpectrum.html#a4526541637db3df7785907908744cc1d">fTimeWindow_Big</a>)
<a name="l00198"></a>00198         <a class="code" href="classGeSpectrum.html#a50662cbae017970783f8afd861422138">fHist_TimeFarOOT</a>-&gt;Fill(dt_next);
<a name="l00199"></a>00199       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dt_next &lt; -<a class="code" href="classGeSpectrum.html#a484672deaf86bcbe4504fae85907caa3">fTimeWindow_Small</a>)
<a name="l00200"></a>00200         <a class="code" href="classGeSpectrum.html#a3df9cab164d30d29312b6b8f44cc6eec">fHist_TimeOOT</a>-&gt;Fill(dt_next);
<a name="l00201"></a>00201     }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     <span class="comment">// Silicon XRay</span>
<a name="l00204"></a>00204     <span class="comment">//if (ge_energy &gt;= 3260 &amp;&amp; energy_ge &lt;= 3290)</span>
<a name="l00205"></a>00205     <span class="comment">// Aluminium XRay</span>
<a name="l00206"></a>00206     <span class="comment">//if (*geE &gt;= 340 &amp;&amp; *geE &lt;= 350) {</span>
<a name="l00207"></a>00207     <span class="comment">// Mg27 Gamma</span>
<a name="l00208"></a>00208     <span class="comment">// if (*geE &gt;= 838 &amp;&amp; *geE &lt;= 848) {</span>
<a name="l00209"></a>00209     <span class="comment">//   if (dt_prev != unfound) {</span>
<a name="l00210"></a>00210     <span class="comment">//  fHist_Time-&gt;Fill(dt_prev);</span>
<a name="l00211"></a>00211     <span class="comment">//  fHist_MoreTime-&gt;Fill(dt_prev);</span>
<a name="l00212"></a>00212     <span class="comment">//   }</span>
<a name="l00213"></a>00213     <span class="comment">//   if (dt_next != unfound) {</span>
<a name="l00214"></a>00214     <span class="comment">//  fHist_Time-&gt;Fill(dt_next);</span>
<a name="l00215"></a>00215     <span class="comment">//  fHist_MoreTime-&gt;Fill(dt_next);</span>
<a name="l00216"></a>00216     <span class="comment">//   }</span>
<a name="l00217"></a>00217     <span class="comment">// }</span>
<a name="l00218"></a>00218   }
<a name="l00219"></a>00219   <span class="keywordflow">return</span> 0;
<a name="l00220"></a>00220 }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 <span class="comment">// Called just after the main event loop</span>
<a name="l00223"></a>00223 <span class="comment">// Can be used to write things out, dump a summary etc</span>
<a name="l00224"></a>00224 <span class="comment">// Return non-zero to indicate a problem</span>
<a name="l00225"></a><a class="code" href="classGeSpectrum.html#ab12e02969f25752837d59de9c71715b9">00225</a> <span class="keywordtype">int</span> <a class="code" href="classGeSpectrum.html#ab12e02969f25752837d59de9c71715b9" title="Does nothing.">GeSpectrum::AfterLastEntry</a>(<a class="code" href="classTGlobalData.html" title="This class holds all of the data created by alcapana analysis modules.">TGlobalData</a>* <a class="code" href="group__MCAENPulseIslandSortAndStitch.html#ga69cb952a194ddefc6004dd96e70ccd62" title="Object to hold data used and produced by modules throughout alcapana stage of analysis...">gData</a>, <span class="keyword">const</span> <a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a> *setup){
<a name="l00226"></a>00226   <span class="keywordflow">return</span> 0;
<a name="l00227"></a>00227 }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 
<a name="l00230"></a><a class="code" href="classGeSpectrum.html#a98a991bc12830b4c3d742b7bbf4acec7">00230</a> std::vector&lt;double&gt; <a class="code" href="classGeSpectrum.html#a98a991bc12830b4c3d742b7bbf4acec7" title="Takes a vector of TPIs and calculates all of their times.">GeSpectrum::CalculateTimes</a>(<span class="keyword">const</span> <a class="code" href="classIDs_1_1channel.html">IDs::channel</a>&amp; ch, <span class="keyword">const</span> std::vector&lt;TPulseIsland*&gt;&amp; tpis) {
<a name="l00231"></a>00231   std::vector&lt;double&gt; t;
<a name="l00232"></a>00232   <span class="keywordflow">if</span> (ch == <a class="code" href="classGeSpectrum.html#a00d1d9e24e32a951248dfc84025a549a">fMuSc</a>)
<a name="l00233"></a>00233     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; tpis.size(); ++i)
<a name="l00234"></a>00234       t.push_back(<a class="code" href="classGeSpectrum.html#a4b6dc6deaadd026e4bd4937ff881ca89">fCFTimeMuSc</a>(tpis[i]));
<a name="l00235"></a>00235   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ch == <a class="code" href="classGeSpectrum.html#a2772efa9c299afd6004d4c61ebc28dc9">fGeF</a>)
<a name="l00236"></a>00236     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; tpis.size(); ++i)
<a name="l00237"></a>00237       t.push_back(<a class="code" href="classGeSpectrum.html#a4362be95ec4582f9f69cf6b261769974">fCFTimeGe</a>(tpis[i]));
<a name="l00238"></a>00238   <span class="keywordflow">else</span>
<a name="l00239"></a>00239     <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;GeSpectrum: Invalid channel to calculate times for.&quot;</span>);
<a name="l00240"></a>00240   <span class="keywordflow">return</span> t;
<a name="l00241"></a>00241 }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 
<a name="l00244"></a><a class="code" href="classGeSpectrum.html#a5a61409a5727933a243304194bf13bf4">00244</a> std::vector&lt;double&gt; <a class="code" href="classGeSpectrum.html#a5a61409a5727933a243304194bf13bf4" title="Takes a vector of TPIs and calculates all of their energies.">GeSpectrum::CalculateEnergies</a>(<span class="keyword">const</span> <a class="code" href="classIDs_1_1channel.html">IDs::channel</a>&amp; ch, <span class="keyword">const</span> std::vector&lt;TPulseIsland*&gt;&amp; tpis) {
<a name="l00245"></a>00245   std::vector&lt;double&gt; e;
<a name="l00246"></a>00246   <span class="keywordflow">if</span> (ch == <a class="code" href="classGeSpectrum.html#a3c48f1bac41b26b68d97e670266c16cf">fGeS</a>)
<a name="l00247"></a>00247     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; tpis.size(); ++i)
<a name="l00248"></a>00248       e.push_back(<a class="code" href="classGeSpectrum.html#a3f5f07a245afffd501d5821e15d76666">fMBAmpGe</a>(tpis[i]));
<a name="l00249"></a>00249   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ch == <a class="code" href="classGeSpectrum.html#a00d1d9e24e32a951248dfc84025a549a">fMuSc</a>)
<a name="l00250"></a>00250     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; tpis.size(); ++i)
<a name="l00251"></a>00251       e.push_back(<a class="code" href="classGeSpectrum.html#ab7effcd5716068aa1ece1cb8b1de64f8">fMBAmpMuSc</a>(tpis[i]));
<a name="l00252"></a>00252   <span class="keywordflow">else</span>
<a name="l00253"></a>00253     <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;GeSpectrum: Invalid channel to calculate energies for.&quot;</span>);
<a name="l00254"></a>00254   <span class="keywordflow">return</span> e;
<a name="l00255"></a>00255 }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 
<a name="l00258"></a><a class="code" href="classGeSpectrum.html#aae5056133494cfe36ee999b690b3a671">00258</a> <span class="keywordtype">void</span> <a class="code" href="classGeSpectrum.html#aae5056133494cfe36ee999b690b3a671">GeSpectrum::ThrowIfGeInsane</a>(<span class="keyword">const</span> std::vector&lt;TPulseIsland*&gt;&amp; ge1s, <span class="keyword">const</span> std::vector&lt;TPulseIsland*&gt;&amp; ge2s) {
<a name="l00259"></a>00259   <span class="keywordflow">if</span> (ge1s.size() != ge2s.size())
<a name="l00260"></a>00260     <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;Fast and slow vectors are not same size!&quot;</span>);
<a name="l00261"></a>00261   <span class="keywordflow">for</span> (<a class="code" href="namespacemodules.html#aecc7811d5380ed9d9e903c9b71a396aa">std::vector&lt;TPulseIsland*&gt;::const_iterator</a> ge1 = ge1s.begin(), ge2 = ge2s.begin(); ge1 != ge1s.end(); ++ge1, ++ge2)
<a name="l00262"></a>00262     <span class="keywordflow">if</span> ((*ge1)-&gt;GetTimeStamp() != (*ge2)-&gt;GetTimeStamp())
<a name="l00263"></a>00263       <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;Fast and slow timestamps don&apos;t match up when getting time&quot;</span>);
<a name="l00264"></a>00264 }
<a name="l00265"></a>00265 
<a name="l00266"></a><a class="code" href="classGeSpectrum.html#a4db76bf1276a4edf9699b03d5c0e022b">00266</a> <span class="keywordtype">void</span> <a class="code" href="classGeSpectrum.html#a4db76bf1276a4edf9699b03d5c0e022b">GeSpectrum::ThrowIfInputsInsane</a>(<span class="keyword">const</span> <a class="code" href="classmodules_1_1options.html" title="Class to handle options given through the MODULES file.">modules::options</a>* opts) {
<a name="l00267"></a>00267   <span class="keyword">const</span> std::string&amp; gef_cfg = opts-&gt;<a class="code" href="classmodules_1_1options.html#a5abd8fca2bf95e3d0d753d49089c08aa" title="Get the named option as a string.">GetString</a>(<span class="stringliteral">&quot;gef_cfg&quot;</span>);
<a name="l00268"></a>00268   <span class="keyword">const</span> <span class="keywordtype">double</span>       gef_cf  = opts-&gt;<a class="code" href="classmodules_1_1options.html#ae5dc83034f14668946edafd54a7d3131" title="Get the named option as a double.">GetDouble</a>(<span class="stringliteral">&quot;gef_cf&quot;</span>);
<a name="l00269"></a>00269   <span class="keyword">const</span> <span class="keywordtype">double</span>       musc_cf = opts-&gt;<a class="code" href="classmodules_1_1options.html#ae5dc83034f14668946edafd54a7d3131" title="Get the named option as a double.">GetDouble</a>(<span class="stringliteral">&quot;musc_cf&quot;</span>);
<a name="l00270"></a>00270   <span class="keyword">const</span> std::string  cf_str(<span class="stringliteral">&quot;constant_fraction=&quot;</span>);
<a name="l00271"></a>00271   std::stringstream ss(gef_cfg.substr(gef_cfg.find(cf_str) + cf_str.size()));
<a name="l00272"></a>00272   <span class="keywordtype">double</span> cf;
<a name="l00273"></a>00273   ss &gt;&gt; cf;
<a name="l00274"></a>00274   <span class="keywordflow">if</span> (cf != gef_cf)
<a name="l00275"></a>00275     <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;GeSpectrum: GeF CF in options don&apos;t match.&quot;</span>);
<a name="l00276"></a>00276   <span class="keywordflow">if</span> (gef_cf &lt;= 0. || gef_cf &gt; 1. || musc_cf &lt;= 0. || musc_cf &gt; 1.)
<a name="l00277"></a>00277     <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;GeSpectrum: CF are out of reasonable bounds (0. to 1.).&quot;</span>);
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 
<a name="l00280"></a><a class="code" href="classGeSpectrum.html#a3cf43d2c624dee47831807959c1ed6cf">00280</a> <span class="keywordtype">void</span> <a class="code" href="classGeSpectrum.html#a3cf43d2c624dee47831807959c1ed6cf">GeSpectrum::RemovePileupMuScPulses</a>(std::vector&lt;double&gt;&amp; t, std::vector&lt;double&gt;&amp; e) {
<a name="l00281"></a>00281   <span class="keywordflow">if</span> (t.empty()) <span class="keywordflow">return</span>;
<a name="l00282"></a>00282   std::vector&lt;bool&gt; rm(t.size(), <span class="keyword">false</span>);
<a name="l00283"></a>00283   <span class="keywordflow">if</span> (t.front() &lt; <a class="code" href="classGeSpectrum.html#af3aebcc10a38efd4f29df4379f005ed0">fPileupProtectionWindow</a>) rm.front() = <span class="keyword">true</span>;
<a name="l00284"></a>00284   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 1; i &lt; t.size(); ++i)
<a name="l00285"></a>00285     <span class="keywordflow">if</span> (t[i] - t[i-1] &lt; <a class="code" href="classGeSpectrum.html#af3aebcc10a38efd4f29df4379f005ed0">fPileupProtectionWindow</a>)
<a name="l00286"></a>00286       rm[i] = rm[i-1] = <span class="keyword">true</span>;
<a name="l00287"></a>00287   rm.back() = <span class="keyword">true</span>;
<a name="l00288"></a>00288   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; t.size(); ++i) {
<a name="l00289"></a>00289     <span class="keywordflow">if</span> (rm[i]) {
<a name="l00290"></a>00290       t.erase(t.begin()+i);
<a name="l00291"></a>00291       e.erase(e.begin()+i);
<a name="l00292"></a>00292       rm.erase(rm.begin()+i);
<a name="l00293"></a>00293       --i;
<a name="l00294"></a>00294     }
<a name="l00295"></a>00295   }
<a name="l00296"></a>00296 }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 <a class="code" href="Template__module_8cpp.html#af5a8f3de39b8d01369a5c344af6d4a8c">ALCAP_REGISTER_MODULE</a>(<a class="code" href="classGeSpectrum.html" title="This produces the height spectrum of the germanium based on timing cuts.">GeSpectrum</a>, musc_cf, gef_gen, gef_cfg, gef_cf);
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 30 Oct 2015 for AlcapDAQ by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
