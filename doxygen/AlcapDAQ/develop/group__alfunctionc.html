<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>AlcapDAQ: Midas Alarm Functions (al_xxx)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Midas Alarm Functions (al_xxx)<br/>
<small>
[<a class="el" href="group__midasincludecode.html">The midas.h &amp; midas.c</a>]</small>
</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__alfunctionc.html#gaba82c8ac2fb95dbda8a8666996184b71">al_evaluate_condition</a> (char *condition, char *<a class="el" href="odbhist_8c.html#a401da9cc2f96d4efd127de7463b69208">value</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__alfunctionc.html#ga5f4da58745979594add02a6beecd1a01">al_trigger_alarm</a> (char *alarm_name, char *alarm_message, char *default_class, char *cond_str, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="ybos_8c.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__alfunctionc.html#gaebd3c475f7f6eb17965213155bf9c19f">al_trigger_class</a> (char *alarm_class, char *alarm_message, <a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> first)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__alfunctionc.html#gaba54cb7e814e438d2d392398cd9e35e8">al_reset_alarm</a> (char *alarm_name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__alfunctionc.html#gaf31864a8bc5fe779057e81bde12167a9">al_check</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>dox dox dox </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="gaf31864a8bc5fe779057e81bde12167a9"></a><!-- doxytag: member="midas.c::al_check" ref="gaf31864a8bc5fe779057e81bde12167a9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> al_check </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l16417">16417</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l01698">ALARM::active</a>, <a class="el" href="midas_8c_source.html#l15975">al_evaluate_condition()</a>, <a class="el" href="midas_8h_source.html#l01119">AL_SUCCESS</a>, <a class="el" href="midas_8c_source.html#l16104">al_trigger_alarm()</a>, <a class="el" href="midas_8h_source.html#l01641">PROGRAM_INFO::alarm_class</a>, <a class="el" href="midas_8h_source.html#l01706">ALARM::alarm_class</a>, <a class="el" href="midas_8h_source.html#l01680">ALARM_CLASS_STR</a>, <a class="el" href="midas_8h_source.html#l01707">ALARM::alarm_message</a>, <a class="el" href="midas_8h_source.html#l01710">ALARM_ODB_STR</a>, <a class="el" href="midas_8h_source.html#l01725">ALARM_PERIODIC_STR</a>, <a class="el" href="midas_8h_source.html#l01647">AT_EVALUATED</a>, <a class="el" href="midas_8h_source.html#l01649">AT_LAST</a>, <a class="el" href="midas_8h_source.html#l01648">AT_PERIODIC</a>, <a class="el" href="midas_8h_source.html#l01646">AT_PROGRAM</a>, <a class="el" href="midas_8h_source.html#l01640">PROGRAM_INFO::auto_restart</a>, <a class="el" href="midas_8h_source.html#l01636">PROGRAM_INFO::check_interval</a>, <a class="el" href="midas_8h_source.html#l01701">ALARM::check_interval</a>, <a class="el" href="midas_8h_source.html#l01702">ALARM::checked_last</a>, <a class="el" href="midas_8c_source.html#l05069">cm_exist()</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l02934">cm_get_experiment_mutex()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l00958">CM_NO_CLIENT</a>, <a class="el" href="midas_8h_source.html#l01705">ALARM::condition</a>, <a class="el" href="odb_8c_source.html#l07436">db_check_record()</a>, <a class="el" href="odb_8c_source.html#l07266">db_create_record()</a>, <a class="el" href="odb_8c_source.html#l03390">db_enum_key()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l06770">db_get_record()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="midas_8h_source.html#l01016">DB_NO_MORE_SUBKEYS</a>, <a class="el" href="odb_8c_source.html#l06874">db_set_record()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="midas_8h_source.html#l01642">PROGRAM_INFO::first_failed</a>, <a class="el" href="scs__310__ql355p_8c_source.html#l00055">flag</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l00938">MTALK</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="mrpc_8h_source.html#l00185">RPC_AL_CHECK</a>, <a class="el" href="midas_8c_source.html#l09810">rpc_call()</a>, <a class="el" href="midas_8c_source.html#l09368">rpc_get_name()</a>, <a class="el" href="midas_8c_source.html#l09022">rpc_is_remote()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="system_8c_source.html#l02091">ss_mutex_release()</a>, <a class="el" href="system_8c_source.html#l01980">ss_mutex_wait_for()</a>, <a class="el" href="midas_8h_source.html#l01033">SS_SUCCESS</a>, <a class="el" href="group__msystemincludecode.html#ga7a14ecba483c2767fe699633d0bc677e">ss_system()</a>, <a class="el" href="system_8c_source.html#l02332">ss_time()</a>, <a class="el" href="midas_8h_source.html#l01637">PROGRAM_INFO::start_command</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="odb_8c_source.html#l00631">strcomb()</a>, <a class="el" href="bit3__mvme_2mvmestd_8h_source.html#l00045">SUCCESS</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="midas_8h_source.html#l00749">TID_KEY</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, <a class="el" href="midas_8h_source.html#l01315">KEY::type</a>, <a class="el" href="midas_8h_source.html#l01700">ALARM::type</a>, and <a class="el" href="ADCS_8h_source.html#l00004">value</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l04166">cm_yield()</a>, <a class="el" href="mserver_8c_source.html#l00534">rpc_server_dispatch()</a>, and <a class="el" href="midas_8c_source.html#l12166">rpc_server_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l16420"></a>16420          : al_scan
<a name="l16421"></a>16421 
<a name="l16422"></a>16422   Purpose: Scan ODB alarams <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> programs
<a name="l16423"></a>16423 
<a name="l16424"></a>16424   Input:
<a name="l16425"></a>16425 
<a name="l16426"></a>16426   Output:
<a name="l16427"></a>16427 
<a name="l16428"></a>16428   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l16429"></a>16429     <a class="code" href="group__err26.html#ga5bf38fa7fcb948150030918ced138deb">AL_SUCCESS</a>              Successful completion
<a name="l16430"></a>16430 
<a name="l16431"></a>16431 \********************************************************************/
<a name="l16432"></a>16432 {
<a name="l16433"></a>16433    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga0090933001e7e1ddd52ed3f321bea957">rpc_is_remote</a>())
<a name="l16434"></a>16434       <span class="keywordflow">return</span> <a class="code" href="group__msectionh.html#ga6bf1d13a0c49a3f7a02650885937b5e7">rpc_call</a>(<a class="code" href="group__mrpcdefineh.html#gaf06b2b267be4f2a46a0e5d6ba5c9be55">RPC_AL_CHECK</a>);
<a name="l16435"></a>16435 
<a name="l16436"></a>16436 <span class="preprocessor">#ifdef LOCAL_ROUTINES</span>
<a name="l16437"></a>16437 <span class="preprocessor"></span>   {
<a name="l16438"></a>16438       <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, mutex;
<a name="l16439"></a>16439       <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkeyroot, hkey;
<a name="l16440"></a>16440       <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l16441"></a>16441       <a class="code" href="structALARM.html">ALARM</a> alarm;
<a name="l16442"></a>16442       <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>[256];
<a name="l16443"></a>16443       <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> now;
<a name="l16444"></a>16444       <a class="code" href="structPROGRAM__INFO.html">PROGRAM_INFO</a> program_info;
<a name="l16445"></a>16445       <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a>;
<a name="l16446"></a>16446 
<a name="l16447"></a>16447       <a class="code" href="group__malarmh.html#ga6e3217ec92c923301ce6ab366561c06c">ALARM_CLASS_STR</a>(alarm_class_str);
<a name="l16448"></a>16448       <a class="code" href="group__malarmh.html#ga74ef6be93ea17e528cfffabf646075f1">ALARM_ODB_STR</a>(alarm_odb_str);
<a name="l16449"></a>16449       <a class="code" href="group__malarmh.html#ga32ee832ef89f8b42e0cb0f6c0b8a51b7">ALARM_PERIODIC_STR</a>(alarm_periodic_str);
<a name="l16450"></a>16450 
<a name="l16451"></a>16451       <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l16452"></a>16452 
<a name="l16453"></a>16453       <span class="keywordflow">if</span> (hDB == 0)
<a name="l16454"></a>16454          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga5bf38fa7fcb948150030918ced138deb">AL_SUCCESS</a>;     <span class="comment">/* called from server not yet connected */</span>
<a name="l16455"></a>16455 
<a name="l16456"></a>16456       <span class="comment">/* check online mode */</span>
<a name="l16457"></a>16457       flag = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l16458"></a>16458       size = <span class="keyword">sizeof</span>(flag);
<a name="l16459"></a>16459       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Runinfo/Online Mode&quot;</span>, &amp;flag, &amp;size, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l16460"></a>16460       <span class="keywordflow">if</span> (!flag)
<a name="l16461"></a>16461          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga5bf38fa7fcb948150030918ced138deb">AL_SUCCESS</a>;
<a name="l16462"></a>16462 
<a name="l16463"></a>16463       <span class="comment">/* check global alarm flag */</span>
<a name="l16464"></a>16464       flag = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l16465"></a>16465       size = <span class="keyword">sizeof</span>(flag);
<a name="l16466"></a>16466       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Alarms/Alarm system active&quot;</span>, &amp;flag, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l16467"></a>16467       <span class="keywordflow">if</span> (!flag)
<a name="l16468"></a>16468          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga5bf38fa7fcb948150030918ced138deb">AL_SUCCESS</a>;
<a name="l16469"></a>16469 
<a name="l16470"></a>16470       <span class="comment">/* request semaphore */</span>
<a name="l16471"></a>16471       <a class="code" href="group__msectionh.html#ga6df13ff68685b0b1f818a983430de5ec">cm_get_experiment_mutex</a>(&amp;mutex, NULL);
<a name="l16472"></a>16472       status = <a class="code" href="group__msystemincludecode.html#gad3c6b30fd77b7be3d4d3d6db5f106b45">ss_mutex_wait_for</a>(mutex, 100);
<a name="l16473"></a>16473       <span class="keywordflow">if</span> (status != <a class="code" href="group__err24.html#ga0abac6c68d7a79ce83d1a25b2c800321">SS_SUCCESS</a>)
<a name="l16474"></a>16474          <span class="keywordflow">return</span> <a class="code" href="group__mvmestdinclude.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>;        <span class="comment">/* someone else is doing alarm business */</span>
<a name="l16475"></a>16475 
<a name="l16476"></a>16476       <span class="comment">/* check ODB alarms */</span>
<a name="l16477"></a>16477       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Alarms/Alarms&quot;</span>, &amp;hkeyroot);
<a name="l16478"></a>16478       <span class="keywordflow">if</span> (!hkeyroot) {
<a name="l16479"></a>16479          <span class="comment">/* create default ODB alarm */</span>
<a name="l16480"></a>16480          status =
<a name="l16481"></a>16481              <a class="code" href="group__msectionh.html#ga8ed1d02d89738e2ac692ec60e727d1a7">db_create_record</a>(hDB, 0, <span class="stringliteral">&quot;/Alarms/Alarms/Demo ODB&quot;</span>, <a class="code" href="group__msectionh.html#gaccf82d3dbd8eb7090db598725713e012">strcomb</a>(alarm_odb_str));
<a name="l16482"></a>16482          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Alarms/Alarms&quot;</span>, &amp;hkeyroot);
<a name="l16483"></a>16483          <span class="keywordflow">if</span> (!hkeyroot) {
<a name="l16484"></a>16484             <a class="code" href="group__msystemincludecode.html#gae9746bf50ec478e587bb9d981f8eb9da">ss_mutex_release</a>(mutex);
<a name="l16485"></a>16485             <span class="keywordflow">return</span> <a class="code" href="group__mvmestdinclude.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>;
<a name="l16486"></a>16486          }
<a name="l16487"></a>16487 
<a name="l16488"></a>16488          status =
<a name="l16489"></a>16489              <a class="code" href="group__msectionh.html#ga8ed1d02d89738e2ac692ec60e727d1a7">db_create_record</a>(hDB, 0, <span class="stringliteral">&quot;/Alarms/Alarms/Demo periodic&quot;</span>,
<a name="l16490"></a>16490                               <a class="code" href="group__msectionh.html#gaccf82d3dbd8eb7090db598725713e012">strcomb</a>(alarm_periodic_str));
<a name="l16491"></a>16491          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Alarms/Alarms&quot;</span>, &amp;hkeyroot);
<a name="l16492"></a>16492          <span class="keywordflow">if</span> (!hkeyroot) {
<a name="l16493"></a>16493             <a class="code" href="group__msystemincludecode.html#gae9746bf50ec478e587bb9d981f8eb9da">ss_mutex_release</a>(mutex);
<a name="l16494"></a>16494             <span class="keywordflow">return</span> <a class="code" href="group__mvmestdinclude.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>;
<a name="l16495"></a>16495          }
<a name="l16496"></a>16496 
<a name="l16497"></a>16497          <span class="comment">/* create default alarm classes */</span>
<a name="l16498"></a>16498          status =
<a name="l16499"></a>16499              <a class="code" href="group__msectionh.html#ga8ed1d02d89738e2ac692ec60e727d1a7">db_create_record</a>(hDB, 0, <span class="stringliteral">&quot;/Alarms/Classes/Alarm&quot;</span>, <a class="code" href="group__msectionh.html#gaccf82d3dbd8eb7090db598725713e012">strcomb</a>(alarm_class_str));
<a name="l16500"></a>16500          status =
<a name="l16501"></a>16501              <a class="code" href="group__msectionh.html#ga8ed1d02d89738e2ac692ec60e727d1a7">db_create_record</a>(hDB, 0, <span class="stringliteral">&quot;/Alarms/Classes/Warning&quot;</span>,
<a name="l16502"></a>16502                               <a class="code" href="group__msectionh.html#gaccf82d3dbd8eb7090db598725713e012">strcomb</a>(alarm_class_str));
<a name="l16503"></a>16503          <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l16504"></a>16504             <a class="code" href="group__msystemincludecode.html#gae9746bf50ec478e587bb9d981f8eb9da">ss_mutex_release</a>(mutex);
<a name="l16505"></a>16505             <span class="keywordflow">return</span> <a class="code" href="group__mvmestdinclude.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>;
<a name="l16506"></a>16506          }
<a name="l16507"></a>16507       }
<a name="l16508"></a>16508 
<a name="l16509"></a>16509       <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l16510"></a>16510          status = <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkeyroot, i, &amp;hkey);
<a name="l16511"></a>16511          <span class="keywordflow">if</span> (status == <a class="code" href="group__err23.html#gaf2249d36fd8ffb254cd33a3bbc899638">DB_NO_MORE_SUBKEYS</a>)
<a name="l16512"></a>16512             <span class="keywordflow">break</span>;
<a name="l16513"></a>16513 
<a name="l16514"></a>16514          <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l16515"></a>16515 
<a name="l16516"></a>16516          size = <span class="keyword">sizeof</span>(alarm);
<a name="l16517"></a>16517          status = <a class="code" href="group__msectionh.html#gaae4cf88eaadf5d2dd9eefa3e1b6389e6">db_get_record</a>(hDB, hkey, &amp;alarm, &amp;size, 0);
<a name="l16518"></a>16518          <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a> || alarm.<a class="code" href="group__midasincludecode.html#ga0851d9756fd5ee82852d018d0cbd6982">type</a> &lt; 1 || alarm.<a class="code" href="group__midasincludecode.html#ga0851d9756fd5ee82852d018d0cbd6982">type</a> &gt; <a class="code" href="group__malarmh.html#ga5f102004d1642b0878502f7a6a05fdfa">AT_LAST</a>) {
<a name="l16519"></a>16519             <span class="comment">/* make sure alarm record has right structure */</span>
<a name="l16520"></a>16520             <a class="code" href="group__msectionh.html#gaba7341fc6e27b70739734a50b489ef4f">db_check_record</a>(hDB, hkey, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="group__msectionh.html#gaccf82d3dbd8eb7090db598725713e012">strcomb</a>(alarm_odb_str), <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l16521"></a>16521             size = <span class="keyword">sizeof</span>(alarm);
<a name="l16522"></a>16522             status = <a class="code" href="group__msectionh.html#gaae4cf88eaadf5d2dd9eefa3e1b6389e6">db_get_record</a>(hDB, hkey, &amp;alarm, &amp;size, 0);
<a name="l16523"></a>16523             <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a> || alarm.<a class="code" href="group__midasincludecode.html#ga0851d9756fd5ee82852d018d0cbd6982">type</a> &lt; 1 || alarm.<a class="code" href="group__midasincludecode.html#ga0851d9756fd5ee82852d018d0cbd6982">type</a> &gt; <a class="code" href="group__malarmh.html#ga5f102004d1642b0878502f7a6a05fdfa">AT_LAST</a>) {
<a name="l16524"></a>16524                <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;al_check&quot;</span>, <span class="stringliteral">&quot;Cannot get alarm record&quot;</span>);
<a name="l16525"></a>16525                <span class="keywordflow">continue</span>;
<a name="l16526"></a>16526             }
<a name="l16527"></a>16527          }
<a name="l16528"></a>16528 
<a name="l16529"></a>16529          <span class="comment">/* check periodic alarm only when active */</span>
<a name="l16530"></a>16530          <span class="keywordflow">if</span> (alarm.<a class="code" href="structALARM.html#a74ffb34dd6b2f77dad4fbd364fe766a2">active</a> &amp;&amp;
<a name="l16531"></a>16531              alarm.<a class="code" href="group__midasincludecode.html#ga0851d9756fd5ee82852d018d0cbd6982">type</a> == <a class="code" href="group__malarmh.html#ga40d5f5ba688496ddaa6f12e9a9b9f956">AT_PERIODIC</a> &amp;&amp;
<a name="l16532"></a>16532              alarm.<a class="code" href="group__midasincludecode.html#ga3e29ee1328fd1fa52c7923397be88489">check_interval</a> &gt; 0 &amp;&amp;
<a name="l16533"></a>16533              (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>() - (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) alarm.<a class="code" href="group__midasincludecode.html#ga53b5d66626b2a59154538b7eccf0da95">checked_last</a> &gt; alarm.<a class="code" href="group__midasincludecode.html#ga3e29ee1328fd1fa52c7923397be88489">check_interval</a>) {
<a name="l16534"></a>16534             <span class="comment">/* if checked_last has not been set, set it to current time */</span>
<a name="l16535"></a>16535             <span class="keywordflow">if</span> (alarm.<a class="code" href="group__midasincludecode.html#ga53b5d66626b2a59154538b7eccf0da95">checked_last</a> == 0) {
<a name="l16536"></a>16536                alarm.<a class="code" href="group__midasincludecode.html#ga53b5d66626b2a59154538b7eccf0da95">checked_last</a> = <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>();
<a name="l16537"></a>16537                <a class="code" href="group__msectionh.html#ga793daffa9cdc43b03465a1f2e82e58fc">db_set_record</a>(hDB, hkey, &amp;alarm, size, 0);
<a name="l16538"></a>16538             } <span class="keywordflow">else</span>
<a name="l16539"></a>16539                <a class="code" href="group__msectionh.html#ga084fb58f29f3fab1170966190462b29c">al_trigger_alarm</a>(key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, alarm.<a class="code" href="group__midasincludecode.html#gac5eb00685c40af0065b7987d38815255">alarm_message</a>, alarm.<a class="code" href="group__midasincludecode.html#ga0d3979e2fc61d91e50cde9992a6c6cbb">alarm_class</a>, <span class="stringliteral">&quot;&quot;</span>,
<a name="l16540"></a>16540                                 <a class="code" href="group__malarmh.html#ga40d5f5ba688496ddaa6f12e9a9b9f956">AT_PERIODIC</a>);
<a name="l16541"></a>16541          }
<a name="l16542"></a>16542 
<a name="l16543"></a>16543          <span class="comment">/* check alarm only when active and not internal */</span>
<a name="l16544"></a>16544          <span class="keywordflow">if</span> (alarm.<a class="code" href="structALARM.html#a74ffb34dd6b2f77dad4fbd364fe766a2">active</a> &amp;&amp;
<a name="l16545"></a>16545              alarm.<a class="code" href="group__midasincludecode.html#ga0851d9756fd5ee82852d018d0cbd6982">type</a> == <a class="code" href="group__malarmh.html#gabd367ea3feeb6b3fe27aaf45e9a067f6">AT_EVALUATED</a> &amp;&amp;
<a name="l16546"></a>16546              alarm.<a class="code" href="group__midasincludecode.html#ga3e29ee1328fd1fa52c7923397be88489">check_interval</a> &gt; 0 &amp;&amp;
<a name="l16547"></a>16547              (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>() - (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) alarm.<a class="code" href="group__midasincludecode.html#ga53b5d66626b2a59154538b7eccf0da95">checked_last</a> &gt; alarm.<a class="code" href="group__midasincludecode.html#ga3e29ee1328fd1fa52c7923397be88489">check_interval</a>) {
<a name="l16548"></a>16548             <span class="comment">/* if condition is true, trigger alarm */</span>
<a name="l16549"></a>16549             <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga6ea930a4a4dbf55d034b598ee3f1d5a8">al_evaluate_condition</a>(alarm.<a class="code" href="group__midasincludecode.html#gad2f752094f921b25ee3b5704bfb0e827">condition</a>, value)) {
<a name="l16550"></a>16550                sprintf(str, alarm.<a class="code" href="group__midasincludecode.html#gac5eb00685c40af0065b7987d38815255">alarm_message</a>, value);
<a name="l16551"></a>16551                <a class="code" href="group__msectionh.html#ga084fb58f29f3fab1170966190462b29c">al_trigger_alarm</a>(key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, str, alarm.<a class="code" href="group__midasincludecode.html#ga0d3979e2fc61d91e50cde9992a6c6cbb">alarm_class</a>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="group__malarmh.html#gabd367ea3feeb6b3fe27aaf45e9a067f6">AT_EVALUATED</a>);
<a name="l16552"></a>16552             } <span class="keywordflow">else</span> {
<a name="l16553"></a>16553                alarm.<a class="code" href="group__midasincludecode.html#ga53b5d66626b2a59154538b7eccf0da95">checked_last</a> = <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>();
<a name="l16554"></a>16554                status = <a class="code" href="group__msectionh.html#ga793daffa9cdc43b03465a1f2e82e58fc">db_set_record</a>(hDB, hkey, &amp;alarm, <span class="keyword">sizeof</span>(alarm), 0);
<a name="l16555"></a>16555                <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l16556"></a>16556                   <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;al_check&quot;</span>, <span class="stringliteral">&quot;Cannot write back alarm record&quot;</span>);
<a name="l16557"></a>16557                   <span class="keywordflow">continue</span>;
<a name="l16558"></a>16558                }
<a name="l16559"></a>16559             }
<a name="l16560"></a>16560          }
<a name="l16561"></a>16561       }
<a name="l16562"></a>16562 
<a name="l16563"></a>16563       <span class="comment">/* check /programs alarms */</span>
<a name="l16564"></a>16564       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Programs&quot;</span>, &amp;hkeyroot);
<a name="l16565"></a>16565       <span class="keywordflow">if</span> (hkeyroot) {
<a name="l16566"></a>16566          <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l16567"></a>16567             status = <a class="code" href="group__msectionh.html#ga5a2a739267f29b1b1d86c5f9b25ff487">db_enum_key</a>(hDB, hkeyroot, i, &amp;hkey);
<a name="l16568"></a>16568             <span class="keywordflow">if</span> (status == <a class="code" href="group__err23.html#gaf2249d36fd8ffb254cd33a3bbc899638">DB_NO_MORE_SUBKEYS</a>)
<a name="l16569"></a>16569                <span class="keywordflow">break</span>;
<a name="l16570"></a>16570 
<a name="l16571"></a>16571             <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l16572"></a>16572 
<a name="l16573"></a>16573             <span class="comment">/* don&apos;t check &quot;execute on xxx&quot; */</span>
<a name="l16574"></a>16574             <span class="keywordflow">if</span> (key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a> != <a class="code" href="group__mdefineh.html#ga15ae151ae0b7588b3327bd8451d9bcb8">TID_KEY</a>)
<a name="l16575"></a>16575                <span class="keywordflow">continue</span>;
<a name="l16576"></a>16576 
<a name="l16577"></a>16577             size = <span class="keyword">sizeof</span>(program_info);
<a name="l16578"></a>16578             status = <a class="code" href="group__msectionh.html#gaae4cf88eaadf5d2dd9eefa3e1b6389e6">db_get_record</a>(hDB, hkey, &amp;program_info, &amp;size, 0);
<a name="l16579"></a>16579             <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l16580"></a>16580                <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;al_check&quot;</span>, <span class="stringliteral">&quot;Cannot get program info record&quot;</span>);
<a name="l16581"></a>16581                <span class="keywordflow">continue</span>;
<a name="l16582"></a>16582             }
<a name="l16583"></a>16583 
<a name="l16584"></a>16584             now = <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>();
<a name="l16585"></a>16585 
<a name="l16586"></a>16586             <a class="code" href="group__msectionh.html#ga0fe26d0eebb34139d77a455e50246b26">rpc_get_name</a>(str);
<a name="l16587"></a>16587             str[strlen(key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>)] = 0;
<a name="l16588"></a>16588             <span class="keywordflow">if</span> (!<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(str, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>) &amp;&amp;
<a name="l16589"></a>16589                 <a class="code" href="group__msectionh.html#gafe2e23ec2e5c20fbc65ee238bd6cd48e">cm_exist</a>(key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) == <a class="code" href="group__err21.html#gaae1164bcc7a30753d96723b897ce234e">CM_NO_CLIENT</a>) {
<a name="l16590"></a>16590                <span class="keywordflow">if</span> (program_info.<a class="code" href="group__midasincludecode.html#gafdeda14ba819e8325f2645bfa8a922a6">first_failed</a> == 0)
<a name="l16591"></a>16591                   program_info.<a class="code" href="group__midasincludecode.html#gafdeda14ba819e8325f2645bfa8a922a6">first_failed</a> = now;
<a name="l16592"></a>16592 
<a name="l16593"></a>16593                <span class="comment">/* fire alarm when not running for more than what specified in check interval */</span>
<a name="l16594"></a>16594                <span class="keywordflow">if</span> (now - program_info.<a class="code" href="group__midasincludecode.html#gafdeda14ba819e8325f2645bfa8a922a6">first_failed</a> &gt;= program_info.<a class="code" href="group__midasincludecode.html#ga8d78fc124ff9bc61349951faf9ae09b0">check_interval</a> / 1000) {
<a name="l16595"></a>16595                   <span class="comment">/* if not running and alarm calss defined, trigger alarm */</span>
<a name="l16596"></a>16596                   <span class="keywordflow">if</span> (program_info.<a class="code" href="group__midasincludecode.html#gaa4bde5579c8584a3a8c5c436e95b1f17">alarm_class</a>[0]) {
<a name="l16597"></a>16597                      sprintf(str, <span class="stringliteral">&quot;Program %s is not running&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l16598"></a>16598                      <a class="code" href="group__msectionh.html#ga084fb58f29f3fab1170966190462b29c">al_trigger_alarm</a>(key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>, str, program_info.<a class="code" href="group__midasincludecode.html#gaa4bde5579c8584a3a8c5c436e95b1f17">alarm_class</a>,
<a name="l16599"></a>16599                                       <span class="stringliteral">&quot;Program not running&quot;</span>, <a class="code" href="group__malarmh.html#ga258ba8c74f1f017cc80ef51fa82e3e13">AT_PROGRAM</a>);
<a name="l16600"></a>16600                   }
<a name="l16601"></a>16601 
<a name="l16602"></a>16602                   <span class="comment">/* auto restart program */</span>
<a name="l16603"></a>16603                   <span class="keywordflow">if</span> (program_info.<a class="code" href="group__midasincludecode.html#ga7fa4d9e612b68c48ecf7204de63537d2">auto_restart</a> &amp;&amp; program_info.<a class="code" href="group__midasincludecode.html#gaae1ebff2f35189c870bfc6634e0f8f12">start_command</a>[0]) {
<a name="l16604"></a>16604                      <a class="code" href="group__msystemincludecode.html#ga7a14ecba483c2767fe699633d0bc677e">ss_system</a>(program_info.<a class="code" href="group__midasincludecode.html#gaae1ebff2f35189c870bfc6634e0f8f12">start_command</a>);
<a name="l16605"></a>16605                      program_info.<a class="code" href="group__midasincludecode.html#gafdeda14ba819e8325f2645bfa8a922a6">first_failed</a> = 0;
<a name="l16606"></a>16606                      <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#gad6a8d32f94873258d0eebcbe5b24a78e">MTALK</a>, <span class="stringliteral">&quot;al_check&quot;</span>, <span class="stringliteral">&quot;Program %s restarted&quot;</span>, key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l16607"></a>16607                   }
<a name="l16608"></a>16608                }
<a name="l16609"></a>16609             } <span class="keywordflow">else</span>
<a name="l16610"></a>16610                program_info.<a class="code" href="group__midasincludecode.html#gafdeda14ba819e8325f2645bfa8a922a6">first_failed</a> = 0;
<a name="l16611"></a>16611 
<a name="l16612"></a>16612             <a class="code" href="group__msectionh.html#ga793daffa9cdc43b03465a1f2e82e58fc">db_set_record</a>(hDB, hkey, &amp;program_info, <span class="keyword">sizeof</span>(program_info), 0);
<a name="l16613"></a>16613          }
<a name="l16614"></a>16614       }
<a name="l16615"></a>16615 
<a name="l16616"></a>16616       <a class="code" href="group__msystemincludecode.html#gae9746bf50ec478e587bb9d981f8eb9da">ss_mutex_release</a>(mutex);
<a name="l16617"></a>16617    }
<a name="l16618"></a>16618 <span class="preprocessor">#endif                          </span><span class="comment">/* LOCAL_COUTINES */</span>
<a name="l16619"></a>16619 
<a name="l16620"></a>16620    <span class="keywordflow">return</span> <a class="code" href="group__mvmestdinclude.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>;
<a name="l16621"></a>16621 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaba82c8ac2fb95dbda8a8666996184b71"></a><!-- doxytag: member="midas.c::al_evaluate_condition" ref="gaba82c8ac2fb95dbda8a8666996184b71" args="(char *condition, char *value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> al_evaluate_condition </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>condition</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox </p>

<p>Definition at line <a class="el" href="midas_8c_source.html#l15975">15975</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="lrs1821_8c_source.html#l00038">data</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l03782">db_get_key_time()</a>, <a class="el" href="odb_8c_source.html#l06308">db_sprintf()</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, and <a class="el" href="midas_8h_source.html#l01315">KEY::type</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l16417">al_check()</a>, and <a class="el" href="mhttpd_8c_source.html#l06375">show_alarm_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l15976"></a>15976 {
<a name="l15977"></a>15977    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkey;
<a name="l15978"></a>15978    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l15979"></a>15979    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l15980"></a>15980    <span class="keywordtype">double</span> value1, value2;
<a name="l15981"></a>15981    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], op[3], function[80];
<a name="l15982"></a>15982    <span class="keywordtype">char</span> <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>[10000];
<a name="l15983"></a>15983    <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>;
<a name="l15984"></a>15984 
<a name="l15985"></a>15985    strcpy(str, condition);
<a name="l15986"></a>15986    op[1] = op[2] = 0;
<a name="l15987"></a>15987    value1 = value2 = 0;
<a name="l15988"></a>15988    index = 0;
<a name="l15989"></a>15989 
<a name="l15990"></a>15990    <span class="comment">/* find value and operator */</span>
<a name="l15991"></a>15991    <span class="keywordflow">for</span> (i = strlen(str) - 1; i &gt; 0; i--)
<a name="l15992"></a>15992       <span class="keywordflow">if</span> (strchr(<span class="stringliteral">&quot;&lt;&gt;=!&quot;</span>, str[i]) != NULL)
<a name="l15993"></a>15993          <span class="keywordflow">break</span>;
<a name="l15994"></a>15994    op[0] = str[i];
<a name="l15995"></a>15995    value2 = atof(str + i + 1);
<a name="l15996"></a>15996    str[i] = 0;
<a name="l15997"></a>15997 
<a name="l15998"></a>15998    <span class="keywordflow">if</span> (i &gt; 0 &amp;&amp; strchr(<span class="stringliteral">&quot;&lt;&gt;=!&quot;</span>, str[i - 1])) {
<a name="l15999"></a>15999       op[1] = op[0];
<a name="l16000"></a>16000       op[0] = str[--i];
<a name="l16001"></a>16001       str[i] = 0;
<a name="l16002"></a>16002    }
<a name="l16003"></a>16003 
<a name="l16004"></a>16004    i--;
<a name="l16005"></a>16005    <span class="keywordflow">while</span> (i &gt; 0 &amp;&amp; str[i] == <span class="charliteral">&apos; &apos;</span>)
<a name="l16006"></a>16006       i--;
<a name="l16007"></a>16007    str[i + 1] = 0;
<a name="l16008"></a>16008 
<a name="l16009"></a>16009    <span class="comment">/* check if function */</span>
<a name="l16010"></a>16010    function[0] = 0;
<a name="l16011"></a>16011    <span class="keywordflow">if</span> (str[i] == <span class="charliteral">&apos;)&apos;</span>) {
<a name="l16012"></a>16012       str[i--] = 0;
<a name="l16013"></a>16013       <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;(&apos;</span>)) {
<a name="l16014"></a>16014          *strchr(str, <span class="charliteral">&apos;(&apos;</span>) = 0;
<a name="l16015"></a>16015          strcpy(function, str);
<a name="l16016"></a>16016          <span class="keywordflow">for</span> (i = strlen(str) + 1, j = 0; str[i]; i++, j++)
<a name="l16017"></a>16017             str[j] = str[i];
<a name="l16018"></a>16018          str[j] = 0;
<a name="l16019"></a>16019          i = j - 1;
<a name="l16020"></a>16020       }
<a name="l16021"></a>16021    }
<a name="l16022"></a>16022 
<a name="l16023"></a>16023    <span class="comment">/* find key */</span>
<a name="l16024"></a>16024    <span class="keywordflow">if</span> (str[i] == <span class="charliteral">&apos;]&apos;</span>) {
<a name="l16025"></a>16025       str[i--] = 0;
<a name="l16026"></a>16026       <span class="keywordflow">while</span> (i &gt; 0 &amp;&amp; isdigit(str[i]))
<a name="l16027"></a>16027          i--;
<a name="l16028"></a>16028       index = atoi(str + i + 1);
<a name="l16029"></a>16029       str[i] = 0;
<a name="l16030"></a>16030    }
<a name="l16031"></a>16031 
<a name="l16032"></a>16032    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l16033"></a>16033    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkey);
<a name="l16034"></a>16034    <span class="keywordflow">if</span> (!hkey) {
<a name="l16035"></a>16035       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;al_evaluate_condition&quot;</span>,
<a name="l16036"></a>16036              <span class="stringliteral">&quot;Cannot find key %s to evaluate alarm condition&quot;</span>, str);
<a name="l16037"></a>16037       <span class="keywordflow">if</span> (<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>)
<a name="l16038"></a>16038          strcpy(<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <span class="stringliteral">&quot;unknown&quot;</span>);
<a name="l16039"></a>16039       <span class="keywordflow">return</span> <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l16040"></a>16040    }
<a name="l16041"></a>16041 
<a name="l16042"></a>16042    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(function, <span class="stringliteral">&quot;access&quot;</span>)) {
<a name="l16043"></a>16043       <span class="comment">/* check key access time */</span>
<a name="l16044"></a>16044       <a class="code" href="group__msectionh.html#gab88340d8b3bd21153346a90aeeead25c">db_get_key_time</a>(hDB, hkey, &amp;time);
<a name="l16045"></a>16045       sprintf(str, <span class="stringliteral">&quot;%ld&quot;</span>, time);
<a name="l16046"></a>16046       value1 = atof(str);
<a name="l16047"></a>16047    } <span class="keywordflow">else</span> {
<a name="l16048"></a>16048       <span class="comment">/* get key data and convert to double */</span>
<a name="l16049"></a>16049       <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hkey, &amp;key);
<a name="l16050"></a>16050       size = <span class="keyword">sizeof</span>(data);
<a name="l16051"></a>16051       <a class="code" href="group__msectionh.html#gad6e53374f24813cdba8713781683c556">db_get_data</a>(hDB, hkey, data, &amp;size, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l16052"></a>16052       <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(str, data, size, index, key.<a class="code" href="structKEY.html#a3360f9082d5083ea144f093d0cd774e3">type</a>);
<a name="l16053"></a>16053       value1 = atof(str);
<a name="l16054"></a>16054    }
<a name="l16055"></a>16055 
<a name="l16056"></a>16056    <span class="comment">/* return value */</span>
<a name="l16057"></a>16057    <span class="keywordflow">if</span> (<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>)
<a name="l16058"></a>16058       strcpy(<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, str);
<a name="l16059"></a>16059 
<a name="l16060"></a>16060    <span class="comment">/* now do logical operation */</span>
<a name="l16061"></a>16061    <span class="keywordflow">if</span> (strcmp(op, <span class="stringliteral">&quot;=&quot;</span>) == 0)
<a name="l16062"></a>16062       <span class="keywordflow">return</span> value1 == value2;
<a name="l16063"></a>16063    <span class="keywordflow">if</span> (strcmp(op, <span class="stringliteral">&quot;==&quot;</span>) == 0)
<a name="l16064"></a>16064       <span class="keywordflow">return</span> value1 == value2;
<a name="l16065"></a>16065    <span class="keywordflow">if</span> (strcmp(op, <span class="stringliteral">&quot;!=&quot;</span>) == 0)
<a name="l16066"></a>16066       <span class="keywordflow">return</span> value1 != value2;
<a name="l16067"></a>16067    <span class="keywordflow">if</span> (strcmp(op, <span class="stringliteral">&quot;&lt;&quot;</span>) == 0)
<a name="l16068"></a>16068       <span class="keywordflow">return</span> value1 &lt; value2;
<a name="l16069"></a>16069    <span class="keywordflow">if</span> (strcmp(op, <span class="stringliteral">&quot;&gt;&quot;</span>) == 0)
<a name="l16070"></a>16070       <span class="keywordflow">return</span> value1 &gt; value2;
<a name="l16071"></a>16071    <span class="keywordflow">if</span> (strcmp(op, <span class="stringliteral">&quot;&lt;=&quot;</span>) == 0)
<a name="l16072"></a>16072       <span class="keywordflow">return</span> value1 &lt;= value2;
<a name="l16073"></a>16073    <span class="keywordflow">if</span> (strcmp(op, <span class="stringliteral">&quot;&gt;=&quot;</span>) == 0)
<a name="l16074"></a>16074       <span class="keywordflow">return</span> value1 &gt;= value2;
<a name="l16075"></a>16075 
<a name="l16076"></a>16076    <span class="keywordflow">return</span> <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l16077"></a>16077 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaba54cb7e814e438d2d392398cd9e35e8"></a><!-- doxytag: member="midas.c::al_reset_alarm" ref="gaba54cb7e814e438d2d392398cd9e35e8" args="(char *alarm_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> al_reset_alarm </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>alarm_name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l16313">16313</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l01121">AL_ERROR_ODB</a>, <a class="el" href="midas_8h_source.html#l01120">AL_INVALID_NAME</a>, <a class="el" href="midas_8h_source.html#l01122">AL_RESET</a>, <a class="el" href="midas_8c_source.html#l16313">al_reset_alarm()</a>, <a class="el" href="midas_8h_source.html#l01119">AL_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l01706">ALARM::alarm_class</a>, <a class="el" href="midas_8h_source.html#l01702">ALARM::checked_last</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l06770">db_get_record()</a>, <a class="el" href="odb_8c_source.html#l06874">db_set_record()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l01674">ALARM_CLASS::execute_last</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mdump_8c_source.html#l00116">key</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l01317">KEY::name</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="midas_8h_source.html#l01671">ALARM_CLASS::system_message_last</a>, <a class="el" href="midas_8h_source.html#l01703">ALARM::time_triggered_first</a>, <a class="el" href="midas_8h_source.html#l01704">ALARM::time_triggered_last</a>, and <a class="el" href="midas_8h_source.html#l01699">ALARM::triggered</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l16313">al_reset_alarm()</a>, <a class="el" href="odbedit_8c_source.html#l01415">command_loop()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l02384">epics_ca_get()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00777">epics_ca_init()</a>, <a class="el" href="slowcontrol_2ge__ln2_2frontend_8c_source.html#l00230">ge_ln2_read()</a>, <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>, and <a class="el" href="lazylogger_8c_source.html#l01389">lazy_main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l16316"></a>16316          : <a class="code" href="group__msectionh.html#ga906bbe1c84d87510755d6bf71e933edc">al_reset_alarm</a>
<a name="l16317"></a>16317 
<a name="l16318"></a>16318   Purpose: Reset (acknowledge) alarm
<a name="l16319"></a>16319 
<a name="l16320"></a>16320   Input:
<a name="l16321"></a>16321     <span class="keywordtype">char</span>   *alarm_name      <a class="code" href="slowcontrol_2separator_2frontend_8c.html#ad485dd371b9261f4597c77dfa1a6ceeb">Alarm</a> <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>, must be defined <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> /Alarms/Alarms
<a name="l16322"></a>16322                             If NULL reset all alarms
<a name="l16323"></a>16323 
<a name="l16324"></a>16324   Output:
<a name="l16325"></a>16325     &lt;none&gt;
<a name="l16326"></a>16326 
<a name="l16327"></a>16327   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l16328"></a>16328     <a class="code" href="group__err26.html#ga55849da05eeaa784af7a8b0969b6cab8">AL_INVALID_NAME</a>         <a class="code" href="slowcontrol_2separator_2frontend_8c.html#ad485dd371b9261f4597c77dfa1a6ceeb">Alarm</a> name not defined
<a name="l16329"></a>16329     <a class="code" href="group__err26.html#ga6fb127cb253f60659e9356f9eeff2107">AL_RESET</a>                <a class="code" href="slowcontrol_2separator_2frontend_8c.html#ad485dd371b9261f4597c77dfa1a6ceeb">Alarm</a> was triggered <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> reset
<a name="l16330"></a>16330     <a class="code" href="group__err26.html#ga5bf38fa7fcb948150030918ced138deb">AL_SUCCESS</a>              Successful completion
<a name="l16331"></a>16331 
<a name="l16332"></a>16332 \********************************************************************/
<a name="l16333"></a>16333 {
<a name="l16334"></a>16334    <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l16335"></a>16335    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkeyalarm, hkeyclass, hsubkey;
<a name="l16336"></a>16336    <a class="code" href="structKEY.html">KEY</a> <a class="code" href="mdump_8c.html#a5cdb181553f9aa7bb182db5c195bb079">key</a>;
<a name="l16337"></a>16337    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l16338"></a>16338    <a class="code" href="structALARM.html">ALARM</a> alarm;
<a name="l16339"></a>16339    <a class="code" href="structALARM__CLASS.html">ALARM_CLASS</a> ac;
<a name="l16340"></a>16340 
<a name="l16341"></a>16341    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l16342"></a>16342 
<a name="l16343"></a>16343    <span class="keywordflow">if</span> (alarm_name == NULL) {
<a name="l16344"></a>16344       <span class="comment">/* reset all alarms */</span>
<a name="l16345"></a>16345       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Alarms/Alarms&quot;</span>, &amp;hkeyalarm);
<a name="l16346"></a>16346       <span class="keywordflow">if</span> (hkeyalarm) {
<a name="l16347"></a>16347          <span class="keywordflow">for</span> (i = 0;; i++) {
<a name="l16348"></a>16348             <a class="code" href="group__msectionh.html#gae10d6bf5633a77eb2c837ee27e3eca98">db_enum_link</a>(hDB, hkeyalarm, i, &amp;hsubkey);
<a name="l16349"></a>16349 
<a name="l16350"></a>16350             <span class="keywordflow">if</span> (!hsubkey)
<a name="l16351"></a>16351                <span class="keywordflow">break</span>;
<a name="l16352"></a>16352 
<a name="l16353"></a>16353             <a class="code" href="group__msectionh.html#gab97e8d856c8089519a59d3e44c0c4e65">db_get_key</a>(hDB, hsubkey, &amp;key);
<a name="l16354"></a>16354             <a class="code" href="group__msectionh.html#ga906bbe1c84d87510755d6bf71e933edc">al_reset_alarm</a>(key.<a class="code" href="group__midasincludecode.html#gaab4927ab8eb9921525d82761adb11f5c">name</a>);
<a name="l16355"></a>16355          }
<a name="l16356"></a>16356       }
<a name="l16357"></a>16357       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga5bf38fa7fcb948150030918ced138deb">AL_SUCCESS</a>;
<a name="l16358"></a>16358    }
<a name="l16359"></a>16359 
<a name="l16360"></a>16360    <span class="comment">/* find alarm and alarm class */</span>
<a name="l16361"></a>16361    sprintf(str, <span class="stringliteral">&quot;/Alarms/Alarms/%s&quot;</span>, alarm_name);
<a name="l16362"></a>16362    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkeyalarm);
<a name="l16363"></a>16363    <span class="keywordflow">if</span> (!hkeyalarm) {
<a name="l16364"></a>16364       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;al_reset_alarm&quot;</span>, <span class="stringliteral">&quot;Alarm %s not found in ODB&quot;</span>, alarm_name);
<a name="l16365"></a>16365       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga55849da05eeaa784af7a8b0969b6cab8">AL_INVALID_NAME</a>;
<a name="l16366"></a>16366    }
<a name="l16367"></a>16367 
<a name="l16368"></a>16368    size = <span class="keyword">sizeof</span>(alarm);
<a name="l16369"></a>16369    status = <a class="code" href="group__msectionh.html#gaae4cf88eaadf5d2dd9eefa3e1b6389e6">db_get_record</a>(hDB, hkeyalarm, &amp;alarm, &amp;size, 0);
<a name="l16370"></a>16370    <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l16371"></a>16371       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;al_reset_alarm&quot;</span>, <span class="stringliteral">&quot;Cannot get alarm record&quot;</span>);
<a name="l16372"></a>16372       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae85455d8748ca9ad9c652365f4030178">AL_ERROR_ODB</a>;
<a name="l16373"></a>16373    }
<a name="l16374"></a>16374 
<a name="l16375"></a>16375    sprintf(str, <span class="stringliteral">&quot;/Alarms/Classes/%s&quot;</span>, alarm.<a class="code" href="group__midasincludecode.html#ga0d3979e2fc61d91e50cde9992a6c6cbb">alarm_class</a>);
<a name="l16376"></a>16376    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkeyclass);
<a name="l16377"></a>16377    <span class="keywordflow">if</span> (!hkeyclass) {
<a name="l16378"></a>16378       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;al_reset_alarm&quot;</span>, <span class="stringliteral">&quot;Alarm class %s not found in ODB&quot;</span>,
<a name="l16379"></a>16379              alarm.<a class="code" href="group__midasincludecode.html#ga0d3979e2fc61d91e50cde9992a6c6cbb">alarm_class</a>);
<a name="l16380"></a>16380       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga55849da05eeaa784af7a8b0969b6cab8">AL_INVALID_NAME</a>;
<a name="l16381"></a>16381    }
<a name="l16382"></a>16382 
<a name="l16383"></a>16383    size = <span class="keyword">sizeof</span>(ac);
<a name="l16384"></a>16384    status = <a class="code" href="group__msectionh.html#gaae4cf88eaadf5d2dd9eefa3e1b6389e6">db_get_record</a>(hDB, hkeyclass, &amp;ac, &amp;size, 0);
<a name="l16385"></a>16385    <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l16386"></a>16386       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;al_reset_alarm&quot;</span>, <span class="stringliteral">&quot;Cannot get alarm class record&quot;</span>);
<a name="l16387"></a>16387       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae85455d8748ca9ad9c652365f4030178">AL_ERROR_ODB</a>;
<a name="l16388"></a>16388    }
<a name="l16389"></a>16389 
<a name="l16390"></a>16390    <span class="keywordflow">if</span> (alarm.<a class="code" href="group__midasincludecode.html#ga5eb18d48345f3193450c95aa6da09122">triggered</a>) {
<a name="l16391"></a>16391       alarm.<a class="code" href="group__midasincludecode.html#ga5eb18d48345f3193450c95aa6da09122">triggered</a> = 0;
<a name="l16392"></a>16392       alarm.<a class="code" href="group__midasincludecode.html#ga0604590d549357078a21e2bf6ac4a9ca">time_triggered_first</a>[0] = 0;
<a name="l16393"></a>16393       alarm.<a class="code" href="group__midasincludecode.html#ga23e777e86dfe77137c46fcb31d2537a5">time_triggered_last</a>[0] = 0;
<a name="l16394"></a>16394       alarm.<a class="code" href="group__midasincludecode.html#ga53b5d66626b2a59154538b7eccf0da95">checked_last</a> = 0;
<a name="l16395"></a>16395 
<a name="l16396"></a>16396       ac.<a class="code" href="group__midasincludecode.html#ga253493c45cc07415341e19352a1b7ce3">system_message_last</a> = 0;
<a name="l16397"></a>16397       ac.<a class="code" href="group__midasincludecode.html#ga36d78fac1cc60c27e0acfe8dbe8576f1">execute_last</a> = 0;
<a name="l16398"></a>16398 
<a name="l16399"></a>16399       status = <a class="code" href="group__msectionh.html#ga793daffa9cdc43b03465a1f2e82e58fc">db_set_record</a>(hDB, hkeyalarm, &amp;alarm, <span class="keyword">sizeof</span>(alarm), 0);
<a name="l16400"></a>16400       <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l16401"></a>16401          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;al_reset_alarm&quot;</span>, <span class="stringliteral">&quot;Cannot update alarm record&quot;</span>);
<a name="l16402"></a>16402          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae85455d8748ca9ad9c652365f4030178">AL_ERROR_ODB</a>;
<a name="l16403"></a>16403       }
<a name="l16404"></a>16404       status = <a class="code" href="group__msectionh.html#ga793daffa9cdc43b03465a1f2e82e58fc">db_set_record</a>(hDB, hkeyclass, &amp;ac, <span class="keyword">sizeof</span>(ac), 0);
<a name="l16405"></a>16405       <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l16406"></a>16406          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;al_reset_alarm&quot;</span>, <span class="stringliteral">&quot;Cannot update alarm class record&quot;</span>);
<a name="l16407"></a>16407          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae85455d8748ca9ad9c652365f4030178">AL_ERROR_ODB</a>;
<a name="l16408"></a>16408       }
<a name="l16409"></a>16409       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga6fb127cb253f60659e9356f9eeff2107">AL_RESET</a>;
<a name="l16410"></a>16410    }
<a name="l16411"></a>16411 
<a name="l16412"></a>16412    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga5bf38fa7fcb948150030918ced138deb">AL_SUCCESS</a>;
<a name="l16413"></a>16413 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga5f4da58745979594add02a6beecd1a01"></a><!-- doxytag: member="midas.c::al_trigger_alarm" ref="ga5f4da58745979594add02a6beecd1a01" args="(char *alarm_name, char *alarm_message, char *default_class, char *cond_str, INT type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> al_trigger_alarm </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>alarm_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>alarm_message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>default_class</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>cond_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>type</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox Trigger a certain alarm. </p>
<div class="fragment"><pre class="fragment"> ...
  <a class="code" href="lazylogger_8c.html#adec3e8b6069f08f06fb57a48a1b02399">lazy</a>.<a class="code" href="structLAZY__SETTING.html#a3a9db40f4c34db2f35ae5806b99ed7bb">alarm</a>[0] = 0;
  size = <span class="keyword">sizeof</span>(<a class="code" href="lazylogger_8c.html#adec3e8b6069f08f06fb57a48a1b02399">lazy</a>.<a class="code" href="structLAZY__SETTING.html#a3a9db40f4c34db2f35ae5806b99ed7bb">alarm</a>);
  <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, pLch-&gt;hKey, <span class="stringliteral">&quot;Settings/Alarm Class&quot;</span>, <a class="code" href="lazylogger_8c.html#adec3e8b6069f08f06fb57a48a1b02399">lazy</a>.<a class="code" href="structLAZY__SETTING.html#a3a9db40f4c34db2f35ae5806b99ed7bb">alarm</a>, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);

  <span class="comment">// trigger alarm if defined</span>
  <span class="keywordflow">if</span> (<a class="code" href="lazylogger_8c.html#adec3e8b6069f08f06fb57a48a1b02399">lazy</a>.<a class="code" href="structLAZY__SETTING.html#a3a9db40f4c34db2f35ae5806b99ed7bb">alarm</a>[0])
    <a class="code" href="group__msectionh.html#ga084fb58f29f3fab1170966190462b29c">al_trigger_alarm</a>(<span class="stringliteral">&quot;Tape&quot;</span>, <span class="stringliteral">&quot;Tape full...load new one!&quot;</span>, <a class="code" href="lazylogger_8c.html#adec3e8b6069f08f06fb57a48a1b02399">lazy</a>.<a class="code" href="structLAZY__SETTING.html#a3a9db40f4c34db2f35ae5806b99ed7bb">alarm</a>, <span class="stringliteral">&quot;Tape full&quot;</span>, <a class="code" href="group__malarmh.html#ga0aecd2654d62ebd6b3d8d57ef8ccf2d9">AT_INTERNAL</a>);
  ...
</pre></div> <dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>alarm_name</em>&nbsp;</td><td>Alarm name, defined in /alarms/alarms </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>alarm_message</em>&nbsp;</td><td>Optional message which goes with alarm </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>default_class</em>&nbsp;</td><td>If alarm is not yet defined under /alarms/alarms/&lt;alarm_name&gt;, a new one is created and this default class is used. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cond_str</em>&nbsp;</td><td>String displayed in alarm condition </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>Alarm type, one of AT_xxx </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>AL_SUCCESS, AL_INVALID_NAME </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l16104">16104</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l01698">ALARM::active</a>, <a class="el" href="midas_8h_source.html#l01121">AL_ERROR_ODB</a>, <a class="el" href="midas_8h_source.html#l01119">AL_SUCCESS</a>, <a class="el" href="midas_8c_source.html#l16225">al_trigger_class()</a>, <a class="el" href="midas_8h_source.html#l01706">ALARM::alarm_class</a>, <a class="el" href="midas_8h_source.html#l01707">ALARM::alarm_message</a>, <a class="el" href="midas_8h_source.html#l01710">ALARM_ODB_STR</a>, <a class="el" href="midas_8h_source.html#l01647">AT_EVALUATED</a>, <a class="el" href="midas_8h_source.html#l01649">AT_LAST</a>, <a class="el" href="midas_8h_source.html#l01648">AT_PERIODIC</a>, <a class="el" href="midas_8h_source.html#l01701">ALARM::check_interval</a>, <a class="el" href="midas_8h_source.html#l01702">ALARM::checked_last</a>, <a class="el" href="midas_8c_source.html#l01646">cm_asctime()</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="odb_8c_source.html#l07436">db_check_record()</a>, <a class="el" href="odb_8c_source.html#l07266">db_create_record()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l06770">db_get_record()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="odb_8c_source.html#l06874">db_set_record()</a>, <a class="el" href="odb_8c_source.html#l03128">db_set_value()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="scs__310__ql355p_8c_source.html#l00055">flag</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="mrpc_8h_source.html#l00186">RPC_AL_TRIGGER_ALARM</a>, <a class="el" href="midas_8c_source.html#l09810">rpc_call()</a>, <a class="el" href="midas_8c_source.html#l09022">rpc_is_remote()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="system_8c_source.html#l02332">ss_time()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="odb_8c_source.html#l00631">strcomb()</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="midas_8h_source.html#l01703">ALARM::time_triggered_first</a>, <a class="el" href="midas_8h_source.html#l01704">ALARM::time_triggered_last</a>, <a class="el" href="midas_8h_source.html#l01699">ALARM::triggered</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, and <a class="el" href="midas_8h_source.html#l01700">ALARM::type</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l16417">al_check()</a>, <a class="el" href="slowcontrol_2ge__ln2_2frontend_8c_source.html#l00230">ge_ln2_read()</a>, <a class="el" href="lazylogger_8c_source.html#l01389">lazy_main()</a>, and <a class="el" href="mserver_8c_source.html#l00534">rpc_server_dispatch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l16106"></a>16106 {
<a name="l16107"></a>16107    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga0090933001e7e1ddd52ed3f321bea957">rpc_is_remote</a>())
<a name="l16108"></a>16108       <span class="keywordflow">return</span> <a class="code" href="group__msectionh.html#ga6bf1d13a0c49a3f7a02650885937b5e7">rpc_call</a>(<a class="code" href="group__mrpcdefineh.html#ga7010d8066162ac5b7dc3491ff46f45e0">RPC_AL_TRIGGER_ALARM</a>, alarm_name, alarm_message,
<a name="l16109"></a>16109                       default_class, cond_str, <a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>);
<a name="l16110"></a>16110 
<a name="l16111"></a>16111 <span class="preprocessor">#ifdef LOCAL_ROUTINES</span>
<a name="l16112"></a>16112 <span class="preprocessor"></span>   {
<a name="l16113"></a>16113       <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l16114"></a>16114       <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkeyalarm;
<a name="l16115"></a>16115       <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l16116"></a>16116       <a class="code" href="structALARM.html">ALARM</a> alarm;
<a name="l16117"></a>16117       <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a>;
<a name="l16118"></a>16118       <a class="code" href="group__malarmh.html#ga74ef6be93ea17e528cfffabf646075f1">ALARM_ODB_STR</a>(alarm_odb_str);
<a name="l16119"></a>16119 
<a name="l16120"></a>16120       <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l16121"></a>16121 
<a name="l16122"></a>16122       <span class="comment">/* check online mode */</span>
<a name="l16123"></a>16123       flag = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l16124"></a>16124       size = <span class="keyword">sizeof</span>(flag);
<a name="l16125"></a>16125       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Runinfo/Online Mode&quot;</span>, &amp;flag, &amp;size, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l16126"></a>16126       <span class="keywordflow">if</span> (!flag)
<a name="l16127"></a>16127          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga5bf38fa7fcb948150030918ced138deb">AL_SUCCESS</a>;
<a name="l16128"></a>16128 
<a name="l16129"></a>16129       <span class="comment">/* find alarm */</span>
<a name="l16130"></a>16130       sprintf(str, <span class="stringliteral">&quot;/Alarms/Alarms/%s&quot;</span>, alarm_name);
<a name="l16131"></a>16131       <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkeyalarm);
<a name="l16132"></a>16132       <span class="keywordflow">if</span> (!hkeyalarm) {
<a name="l16133"></a>16133          <span class="comment">/* alarm must be an internal analyzer alarm, so create a default alarm */</span>
<a name="l16134"></a>16134          status = <a class="code" href="group__msectionh.html#ga8ed1d02d89738e2ac692ec60e727d1a7">db_create_record</a>(hDB, 0, str, <a class="code" href="group__msectionh.html#gaccf82d3dbd8eb7090db598725713e012">strcomb</a>(alarm_odb_str));
<a name="l16135"></a>16135          <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkeyalarm);
<a name="l16136"></a>16136          <span class="keywordflow">if</span> (!hkeyalarm) {
<a name="l16137"></a>16137             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;al_trigger_alarm&quot;</span>, <span class="stringliteral">&quot;Cannot create alarm record&quot;</span>);
<a name="l16138"></a>16138             <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae85455d8748ca9ad9c652365f4030178">AL_ERROR_ODB</a>;
<a name="l16139"></a>16139          }
<a name="l16140"></a>16140 
<a name="l16141"></a>16141          <span class="keywordflow">if</span> (default_class &amp;&amp; default_class[0])
<a name="l16142"></a>16142             <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, hkeyalarm, <span class="stringliteral">&quot;Alarm Class&quot;</span>, default_class, 32, 1, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l16143"></a>16143          status = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l16144"></a>16144          <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, hkeyalarm, <span class="stringliteral">&quot;Active&quot;</span>, &amp;status, <span class="keyword">sizeof</span>(status), 1, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>);
<a name="l16145"></a>16145       }
<a name="l16146"></a>16146 
<a name="l16147"></a>16147       <span class="comment">/* set parameters for internal alarms */</span>
<a name="l16148"></a>16148       <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> != <a class="code" href="group__malarmh.html#gabd367ea3feeb6b3fe27aaf45e9a067f6">AT_EVALUATED</a> &amp;&amp; <a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> != <a class="code" href="group__malarmh.html#ga40d5f5ba688496ddaa6f12e9a9b9f956">AT_PERIODIC</a>) {
<a name="l16149"></a>16149          <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, hkeyalarm, <span class="stringliteral">&quot;Type&quot;</span>, &amp;<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>, <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>), 1, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>);
<a name="l16150"></a>16150          strcpy(str, cond_str);
<a name="l16151"></a>16151          <a class="code" href="group__msectionh.html#gaf83159c12a4e73b2ec3bf6099b3c5544">db_set_value</a>(hDB, hkeyalarm, <span class="stringliteral">&quot;Condition&quot;</span>, str, 256, 1, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l16152"></a>16152       }
<a name="l16153"></a>16153 
<a name="l16154"></a>16154       size = <span class="keyword">sizeof</span>(alarm);
<a name="l16155"></a>16155       status = <a class="code" href="group__msectionh.html#gaae4cf88eaadf5d2dd9eefa3e1b6389e6">db_get_record</a>(hDB, hkeyalarm, &amp;alarm, &amp;size, 0);
<a name="l16156"></a>16156       <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a> || alarm.<a class="code" href="group__midasincludecode.html#ga0851d9756fd5ee82852d018d0cbd6982">type</a> &lt; 1 || alarm.<a class="code" href="group__midasincludecode.html#ga0851d9756fd5ee82852d018d0cbd6982">type</a> &gt; <a class="code" href="group__malarmh.html#ga5f102004d1642b0878502f7a6a05fdfa">AT_LAST</a>) {
<a name="l16157"></a>16157          <span class="comment">/* make sure alarm record has right structure */</span>
<a name="l16158"></a>16158          <a class="code" href="group__msectionh.html#gaba7341fc6e27b70739734a50b489ef4f">db_check_record</a>(hDB, hkeyalarm, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="group__msectionh.html#gaccf82d3dbd8eb7090db598725713e012">strcomb</a>(alarm_odb_str), <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l16159"></a>16159 
<a name="l16160"></a>16160          size = <span class="keyword">sizeof</span>(alarm);
<a name="l16161"></a>16161          status = <a class="code" href="group__msectionh.html#gaae4cf88eaadf5d2dd9eefa3e1b6389e6">db_get_record</a>(hDB, hkeyalarm, &amp;alarm, &amp;size, 0);
<a name="l16162"></a>16162          <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l16163"></a>16163             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;al_trigger_alarm&quot;</span>, <span class="stringliteral">&quot;Cannot get alarm record&quot;</span>);
<a name="l16164"></a>16164             <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae85455d8748ca9ad9c652365f4030178">AL_ERROR_ODB</a>;
<a name="l16165"></a>16165          }
<a name="l16166"></a>16166       }
<a name="l16167"></a>16167 
<a name="l16168"></a>16168       <span class="comment">/* if internal alarm, check if active and check interval */</span>
<a name="l16169"></a>16169       <span class="keywordflow">if</span> (alarm.<a class="code" href="group__midasincludecode.html#ga0851d9756fd5ee82852d018d0cbd6982">type</a> != <a class="code" href="group__malarmh.html#gabd367ea3feeb6b3fe27aaf45e9a067f6">AT_EVALUATED</a> &amp;&amp; alarm.<a class="code" href="group__midasincludecode.html#ga0851d9756fd5ee82852d018d0cbd6982">type</a> != <a class="code" href="group__malarmh.html#ga40d5f5ba688496ddaa6f12e9a9b9f956">AT_PERIODIC</a>) {
<a name="l16170"></a>16170          <span class="comment">/* check global alarm flag */</span>
<a name="l16171"></a>16171          flag = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l16172"></a>16172          size = <span class="keyword">sizeof</span>(flag);
<a name="l16173"></a>16173          <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Alarms/Alarm system active&quot;</span>, &amp;flag, &amp;size, <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>,
<a name="l16174"></a>16174                       <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l16175"></a>16175          <span class="keywordflow">if</span> (!flag)
<a name="l16176"></a>16176             <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga5bf38fa7fcb948150030918ced138deb">AL_SUCCESS</a>;
<a name="l16177"></a>16177 
<a name="l16178"></a>16178          <span class="keywordflow">if</span> (!alarm.<a class="code" href="structALARM.html#a74ffb34dd6b2f77dad4fbd364fe766a2">active</a>)
<a name="l16179"></a>16179             <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga5bf38fa7fcb948150030918ced138deb">AL_SUCCESS</a>;
<a name="l16180"></a>16180 
<a name="l16181"></a>16181          <span class="keywordflow">if</span> ((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>() - (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) alarm.<a class="code" href="group__midasincludecode.html#ga53b5d66626b2a59154538b7eccf0da95">checked_last</a> &lt; alarm.<a class="code" href="group__midasincludecode.html#ga3e29ee1328fd1fa52c7923397be88489">check_interval</a>)
<a name="l16182"></a>16182             <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga5bf38fa7fcb948150030918ced138deb">AL_SUCCESS</a>;
<a name="l16183"></a>16183 
<a name="l16184"></a>16184          <span class="comment">/* now the alarm will be triggered, so save time */</span>
<a name="l16185"></a>16185          alarm.<a class="code" href="group__midasincludecode.html#ga53b5d66626b2a59154538b7eccf0da95">checked_last</a> = <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>();
<a name="l16186"></a>16186       }
<a name="l16187"></a>16187 
<a name="l16188"></a>16188       <span class="comment">/* write back alarm message for internal alarms */</span>
<a name="l16189"></a>16189       <span class="keywordflow">if</span> (alarm.<a class="code" href="group__midasincludecode.html#ga0851d9756fd5ee82852d018d0cbd6982">type</a> != <a class="code" href="group__malarmh.html#gabd367ea3feeb6b3fe27aaf45e9a067f6">AT_EVALUATED</a> &amp;&amp; alarm.<a class="code" href="group__midasincludecode.html#ga0851d9756fd5ee82852d018d0cbd6982">type</a> != <a class="code" href="group__malarmh.html#ga40d5f5ba688496ddaa6f12e9a9b9f956">AT_PERIODIC</a>) {
<a name="l16190"></a>16190          strncpy(alarm.<a class="code" href="group__midasincludecode.html#gac5eb00685c40af0065b7987d38815255">alarm_message</a>, alarm_message, 79);
<a name="l16191"></a>16191          alarm.<a class="code" href="group__midasincludecode.html#gac5eb00685c40af0065b7987d38815255">alarm_message</a>[79] = 0;
<a name="l16192"></a>16192       }
<a name="l16193"></a>16193 
<a name="l16194"></a>16194       <span class="comment">/* now trigger alarm class defined in this alarm */</span>
<a name="l16195"></a>16195       <span class="keywordflow">if</span> (alarm.<a class="code" href="group__midasincludecode.html#ga0d3979e2fc61d91e50cde9992a6c6cbb">alarm_class</a>[0])
<a name="l16196"></a>16196          <a class="code" href="group__msectionh.html#gadd00b45a9a785b80f9e4a73cc503024c">al_trigger_class</a>(alarm.<a class="code" href="group__midasincludecode.html#ga0d3979e2fc61d91e50cde9992a6c6cbb">alarm_class</a>, alarm_message, alarm.<a class="code" href="group__midasincludecode.html#ga5eb18d48345f3193450c95aa6da09122">triggered</a> &gt; 0);
<a name="l16197"></a>16197 
<a name="l16198"></a>16198       <span class="comment">/* signal alarm being triggered */</span>
<a name="l16199"></a>16199       <a class="code" href="group__msectionh.html#gabf6a37f5dd9ea2bee76eb4a0bb7a3270">cm_asctime</a>(str, <span class="keyword">sizeof</span>(str));
<a name="l16200"></a>16200 
<a name="l16201"></a>16201       <span class="keywordflow">if</span> (!alarm.<a class="code" href="group__midasincludecode.html#ga5eb18d48345f3193450c95aa6da09122">triggered</a>)
<a name="l16202"></a>16202          strcpy(alarm.<a class="code" href="group__midasincludecode.html#ga0604590d549357078a21e2bf6ac4a9ca">time_triggered_first</a>, str);
<a name="l16203"></a>16203 
<a name="l16204"></a>16204       alarm.<a class="code" href="group__midasincludecode.html#ga5eb18d48345f3193450c95aa6da09122">triggered</a>++;
<a name="l16205"></a>16205       strcpy(alarm.<a class="code" href="group__midasincludecode.html#ga23e777e86dfe77137c46fcb31d2537a5">time_triggered_last</a>, str);
<a name="l16206"></a>16206 
<a name="l16207"></a>16207       alarm.<a class="code" href="group__midasincludecode.html#ga53b5d66626b2a59154538b7eccf0da95">checked_last</a> = <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>();
<a name="l16208"></a>16208 
<a name="l16209"></a>16209       status = <a class="code" href="group__msectionh.html#ga793daffa9cdc43b03465a1f2e82e58fc">db_set_record</a>(hDB, hkeyalarm, &amp;alarm, <span class="keyword">sizeof</span>(alarm), 0);
<a name="l16210"></a>16210       <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l16211"></a>16211          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;al_trigger_alarm&quot;</span>, <span class="stringliteral">&quot;Cannot update alarm record&quot;</span>);
<a name="l16212"></a>16212          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae85455d8748ca9ad9c652365f4030178">AL_ERROR_ODB</a>;
<a name="l16213"></a>16213       }
<a name="l16214"></a>16214 
<a name="l16215"></a>16215    }
<a name="l16216"></a>16216 <span class="preprocessor">#endif                          </span><span class="comment">/* LOCAL_ROUTINES */</span>
<a name="l16217"></a>16217 
<a name="l16218"></a>16218    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga5bf38fa7fcb948150030918ced138deb">AL_SUCCESS</a>;
<a name="l16219"></a>16219 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaebd3c475f7f6eb17965213155bf9c19f"></a><!-- doxytag: member="midas.c::al_trigger_class" ref="gaebd3c475f7f6eb17965213155bf9c19f" args="(char *alarm_class, char *alarm_message, BOOL first)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> al_trigger_class </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>alarm_class</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>alarm_message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td>
          <td class="paramname"> <em>first</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox </p>

<p>Definition at line <a class="el" href="midas_8c_source.html#l16225">16225</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l01121">AL_ERROR_ODB</a>, <a class="el" href="midas_8h_source.html#l01120">AL_INVALID_NAME</a>, <a class="el" href="midas_8h_source.html#l01119">AL_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l00756">ASYNC</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8c_source.html#l03579">cm_transition()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l06770">db_get_record()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="odb_8c_source.html#l06874">db_set_record()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="midas_8c_source.html#l15064">el_submit()</a>, <a class="el" href="midas_8h_source.html#l01672">ALARM_CLASS::execute_command</a>, <a class="el" href="midas_8h_source.html#l01673">ALARM_CLASS::execute_interval</a>, <a class="el" href="midas_8h_source.html#l01674">ALARM_CLASS::execute_last</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="lrs1821_8h_source.html#l00221">MINFO</a>, <a class="el" href="midas_8h_source.html#l00938">MTALK</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="group__msystemincludecode.html#ga7a14ecba483c2767fe699633d0bc677e">ss_system()</a>, <a class="el" href="system_8c_source.html#l02332">ss_time()</a>, <a class="el" href="midas_8h_source.html#l00712">STATE_STOPPED</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="midas_8h_source.html#l01675">ALARM_CLASS::stop_run</a>, <a class="el" href="midas_8h_source.html#l01670">ALARM_CLASS::system_message_interval</a>, <a class="el" href="midas_8h_source.html#l01671">ALARM_CLASS::system_message_last</a>, <a class="el" href="mhist_8c_source.html#l00102">tag</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="midas_8h_source.html#l00792">TR_STOP</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, <a class="el" href="midas_8h_source.html#l01669">ALARM_CLASS::write_elog_message</a>, and <a class="el" href="midas_8h_source.html#l01668">ALARM_CLASS::write_system_message</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l16104">al_trigger_alarm()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l16228"></a>16228          : <a class="code" href="group__msectionh.html#gadd00b45a9a785b80f9e4a73cc503024c">al_trigger_class</a>
<a name="l16229"></a>16229 
<a name="l16230"></a>16230   Purpose: Trigger a certain alarm <span class="keyword">class</span>
<a name="l16231"></a>16231 
<a name="l16232"></a>16232   Input:
<a name="l16233"></a>16233     <span class="keywordtype">char</span>   *alarm_class     <a class="code" href="slowcontrol_2separator_2frontend_8c.html#ad485dd371b9261f4597c77dfa1a6ceeb">Alarm</a> <span class="keyword">class</span>, must be defined <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a>
<a name="l16234"></a>16234                             /alarms/classes
<a name="l16235"></a>16235     <span class="keywordtype">char</span>   *alarm_message   Optional <a class="code" href="examples_2macro_2midas__macro_8h.html#a408ca6b6abc64f4b82ea76d9a70dcacc">message</a> which goes with alarm
<a name="l16236"></a>16236     <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>   first            <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> <span class="keywordflow">if</span> alarm is triggered first <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>
<a name="l16237"></a>16237                             (used <span class="keywordflow">for</span> elog)
<a name="l16238"></a>16238 
<a name="l16239"></a>16239   Output:
<a name="l16240"></a>16240 
<a name="l16241"></a>16241   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l16242"></a>16242     <a class="code" href="group__err26.html#ga55849da05eeaa784af7a8b0969b6cab8">AL_INVALID_NAME</a>         <a class="code" href="slowcontrol_2separator_2frontend_8c.html#ad485dd371b9261f4597c77dfa1a6ceeb">Alarm</a> <span class="keyword">class </span>not defined
<a name="l16243"></a>16243     <a class="code" href="group__err26.html#ga5bf38fa7fcb948150030918ced138deb">AL_SUCCESS</a>              Successful completion
<a name="l16244"></a>16244 
<a name="l16245"></a>16245 \********************************************************************/
<a name="l16246"></a>16246 {
<a name="l16247"></a>16247    <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, state;
<a name="l16248"></a>16248    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, hkeyclass;
<a name="l16249"></a>16249    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], command[256], <a class="code" href="mhist_8c.html#a27ce05f73a16e6abc070da1007833b9b">tag</a>[32];
<a name="l16250"></a>16250    <a class="code" href="structALARM__CLASS.html">ALARM_CLASS</a> ac;
<a name="l16251"></a>16251 
<a name="l16252"></a>16252    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l16253"></a>16253 
<a name="l16254"></a>16254    <span class="comment">/* get alarm class */</span>
<a name="l16255"></a>16255    sprintf(str, <span class="stringliteral">&quot;/Alarms/Classes/%s&quot;</span>, alarm_class);
<a name="l16256"></a>16256    <a class="code" href="group__msectionh.html#ga2c6408e2f225703c9a666a2ab23d7680">db_find_key</a>(hDB, 0, str, &amp;hkeyclass);
<a name="l16257"></a>16257    <span class="keywordflow">if</span> (!hkeyclass) {
<a name="l16258"></a>16258       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;al_trigger_class&quot;</span>, <span class="stringliteral">&quot;Alarm class %s not found in ODB&quot;</span>, alarm_class);
<a name="l16259"></a>16259       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga55849da05eeaa784af7a8b0969b6cab8">AL_INVALID_NAME</a>;
<a name="l16260"></a>16260    }
<a name="l16261"></a>16261 
<a name="l16262"></a>16262    size = <span class="keyword">sizeof</span>(ac);
<a name="l16263"></a>16263    status = <a class="code" href="group__msectionh.html#gaae4cf88eaadf5d2dd9eefa3e1b6389e6">db_get_record</a>(hDB, hkeyclass, &amp;ac, &amp;size, 0);
<a name="l16264"></a>16264    <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l16265"></a>16265       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;al_trigger_class&quot;</span>, <span class="stringliteral">&quot;Cannot get alarm class record&quot;</span>);
<a name="l16266"></a>16266       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae85455d8748ca9ad9c652365f4030178">AL_ERROR_ODB</a>;
<a name="l16267"></a>16267    }
<a name="l16268"></a>16268 
<a name="l16269"></a>16269    <span class="comment">/* write system message */</span>
<a name="l16270"></a>16270    <span class="keywordflow">if</span> (ac.<a class="code" href="structALARM__CLASS.html#a0a3ec68d2f1343357fcc3a9d04a87017">write_system_message</a> &amp;&amp;
<a name="l16271"></a>16271        (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>() - (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) ac.<a class="code" href="group__midasincludecode.html#ga253493c45cc07415341e19352a1b7ce3">system_message_last</a> &gt; ac.<a class="code" href="group__midasincludecode.html#gab837d3354ac9d8f1b8ed63ba59d84fa2">system_message_interval</a>) {
<a name="l16272"></a>16272       sprintf(str, <span class="stringliteral">&quot;%s: %s&quot;</span>, alarm_class, alarm_message);
<a name="l16273"></a>16273       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#gad6a8d32f94873258d0eebcbe5b24a78e">MTALK</a>, <span class="stringliteral">&quot;al_trigger_class&quot;</span>, str);
<a name="l16274"></a>16274       ac.<a class="code" href="group__midasincludecode.html#ga253493c45cc07415341e19352a1b7ce3">system_message_last</a> = <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>();
<a name="l16275"></a>16275    }
<a name="l16276"></a>16276 
<a name="l16277"></a>16277    <span class="comment">/* write elog message on first trigger */</span>
<a name="l16278"></a>16278    <span class="keywordflow">if</span> (ac.<a class="code" href="group__midasincludecode.html#gad76276faeef73caacdb0ab06815bfa40">write_elog_message</a> &amp;&amp; first)
<a name="l16279"></a>16279       <a class="code" href="group__msectionh.html#ga0403d907441aaec11229bbe9b43d0f5c">el_submit</a>(0, <span class="stringliteral">&quot;Alarm system&quot;</span>, <span class="stringliteral">&quot;Alarm&quot;</span>, <span class="stringliteral">&quot;General&quot;</span>, alarm_class, str,
<a name="l16280"></a>16280                 <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;plain&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 0, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 0, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 0, tag, 32);
<a name="l16281"></a>16281 
<a name="l16282"></a>16282    <span class="comment">/* execute command */</span>
<a name="l16283"></a>16283    <span class="keywordflow">if</span> (ac.<a class="code" href="group__midasincludecode.html#ga8ecd57de94ffa8d60e874723234e0db9">execute_command</a>[0] &amp;&amp;
<a name="l16284"></a>16284        ac.<a class="code" href="group__midasincludecode.html#ga269998501195b908c3ba65522fdd64a3">execute_interval</a> &gt; 0 &amp;&amp;
<a name="l16285"></a>16285        (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>() - (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) ac.<a class="code" href="group__midasincludecode.html#ga36d78fac1cc60c27e0acfe8dbe8576f1">execute_last</a> &gt; ac.<a class="code" href="group__midasincludecode.html#ga269998501195b908c3ba65522fdd64a3">execute_interval</a>) {
<a name="l16286"></a>16286       sprintf(str, <span class="stringliteral">&quot;%s: %s&quot;</span>, alarm_class, alarm_message);
<a name="l16287"></a>16287       sprintf(command, ac.<a class="code" href="group__midasincludecode.html#ga8ecd57de94ffa8d60e874723234e0db9">execute_command</a>, str);
<a name="l16288"></a>16288       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#a6e27d8876a43afce3ee4dd16527cbb9e">MINFO</a>, <span class="stringliteral">&quot;al_trigger_class&quot;</span>, <span class="stringliteral">&quot;Execute: %s&quot;</span>, command);
<a name="l16289"></a>16289       <a class="code" href="group__msystemincludecode.html#ga7a14ecba483c2767fe699633d0bc677e">ss_system</a>(command);
<a name="l16290"></a>16290       ac.<a class="code" href="group__midasincludecode.html#ga36d78fac1cc60c27e0acfe8dbe8576f1">execute_last</a> = <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>();
<a name="l16291"></a>16291    }
<a name="l16292"></a>16292 
<a name="l16293"></a>16293    <span class="comment">/* stop run */</span>
<a name="l16294"></a>16294    <span class="keywordflow">if</span> (ac.<a class="code" href="group__midasincludecode.html#ga254404d845ae5a66d09e4642157ad501">stop_run</a>) {
<a name="l16295"></a>16295       state = <a class="code" href="group__mdefineh.html#ga6a8dac64367bd381245f2eb09a7fe919">STATE_STOPPED</a>;
<a name="l16296"></a>16296       size = <span class="keyword">sizeof</span>(state);
<a name="l16297"></a>16297       <a class="code" href="group__msectionh.html#ga9fc43f58a995c9f2cf9f734076ddedc2">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Runinfo/State&quot;</span>, &amp;state, &amp;size, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l16298"></a>16298       <span class="keywordflow">if</span> (state != <a class="code" href="group__mdefineh.html#ga6a8dac64367bd381245f2eb09a7fe919">STATE_STOPPED</a>)
<a name="l16299"></a>16299          <a class="code" href="group__msectionh.html#ga98ba67d921647dab7eb4f00e5dea7ba0">cm_transition</a>(<a class="code" href="group__mdefineh.html#gadd7d0605113ff6e1b4e705d31332a1a0">TR_STOP</a>, 0, NULL, 0, <a class="code" href="group__mdefineh.html#gad28b60868b6548c43e7a18f30c9b2022">ASYNC</a>, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l16300"></a>16300    }
<a name="l16301"></a>16301 
<a name="l16302"></a>16302    status = <a class="code" href="group__msectionh.html#ga793daffa9cdc43b03465a1f2e82e58fc">db_set_record</a>(hDB, hkeyclass, &amp;ac, <span class="keyword">sizeof</span>(ac), 0);
<a name="l16303"></a>16303    <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l16304"></a>16304       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;al_trigger_class&quot;</span>, <span class="stringliteral">&quot;Cannot update alarm class record&quot;</span>);
<a name="l16305"></a>16305       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae85455d8748ca9ad9c652365f4030178">AL_ERROR_ODB</a>;
<a name="l16306"></a>16306    }
<a name="l16307"></a>16307 
<a name="l16308"></a>16308    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga5bf38fa7fcb948150030918ced138deb">AL_SUCCESS</a>;
<a name="l16309"></a>16309 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 6 Jun 2014 for AlcapDAQ by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
