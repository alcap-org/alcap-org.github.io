<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>AlcapDAQ: rootana</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>rootana</h1>
<p>Second stage of analysis in the <a class="el" href="namespaceAlCap.html">AlCap</a> framework.  
<a href="#_details">More...</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTGlobalData.html">TGlobalData</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This class holds all of the data created by alcapana analysis <a class="el" href="namespacemodules.html">modules</a>.  <a href="classTGlobalData.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTPulseIsland.html">TPulseIsland</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A uniform format for data from many different detectors.  <a href="classTPulseIsland.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTSetupData.html">TSetupData</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Holds data relevent to each run.  <a href="classTSetupData.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrpd41d8cd98f00b204e9800998ecf8427e"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">Int_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rootana.html#ga598fb0749c3e9f76cb2085ee4eb75bd3">Main_event_loop</a> (TTree *dataTree, <a class="el" href="structARGUMENTS.html">ARGUMENTS</a> &amp;arguments)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Second stage of analysis in the <a class="el" href="namespaceAlCap.html">AlCap</a> framework. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga598fb0749c3e9f76cb2085ee4eb75bd3"></a><!-- doxytag: member="main.cpp::Main_event_loop" ref="ga598fb0749c3e9f76cb2085ee4eb75bd3" args="(TTree *dataTree, ARGUMENTS &amp;arguments)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Int_t Main_event_loop </td>
          <td>(</td>
          <td class="paramtype">TTree *&nbsp;</td>
          <td class="paramname"> <em>dataTree</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structARGUMENTS.html">ARGUMENTS</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>arguments</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>rootana_main </p>

<p>Definition at line <a class="el" href="main_8cpp_source.html#l00137">137</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>

<p>References <a class="el" href="classTGlobalData.html#a75ab79e5634f47cae79638c4b0fcaa16">TGlobalData::Clear()</a>, <a class="el" href="main_8cpp_source.html#l00227">ClearGlobalData()</a>, <a class="el" href="main_8cpp_source.html#l00057">gAnalysedPulseMap</a>, <a class="el" href="main_8cpp_source.html#l00054">gAnalysedPulseTree</a>, <a class="el" href="main_8cpp_source.html#l00050">gEntryNumber</a>, <a class="el" href="main_8cpp_source.html#l00051">gTotalEntries</a>, <a class="el" href="analyzer_8cpp_source.html#l00085">TSetupData::Instance()</a>, <a class="el" href="ModulesNavigator_8h_source.html#l00074">modules::navigator::Instance()</a>, <a class="el" href="TAnalysedPulseMapWrapper_8h_source.html#l00034">TAnalysedPulseMapWrapper::SetMap()</a>, <a class="el" href="CommandLine_8h_source.html#l00012">ARGUMENTS::start</a>, and <a class="el" href="CommandLine_8h_source.html#l00013">ARGUMENTS::stop</a>.</p>

<p>Referenced by <a class="el" href="main_8cpp_source.html#l00066">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00137"></a>00137                                                            {
<a name="l00138"></a>00138 <span class="comment">/*************************************************************************\</span>
<a name="l00139"></a>00139 <span class="comment">| Loop over tree entries and call histogramming modules.                  |</span>
<a name="l00140"></a>00140 <span class="comment">\*************************************************************************/</span>
<a name="l00141"></a>00141   Long64_t nentries = dataTree-&gt;GetEntriesFast();
<a name="l00142"></a>00142   printf(<span class="stringliteral">&quot;There are %d entries\n&quot;</span>,(<span class="keywordtype">int</span>)nentries);
<a name="l00143"></a>00143   std::cout&lt;&lt;<span class="stringliteral">&quot;Processing file, which may take a while. &quot;</span>
<a name="l00144"></a>00144      <span class="stringliteral">&quot;Have patience young padawan..&quot;</span>&lt;&lt;std::endl;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146   <span class="comment">//set up the input data</span>
<a name="l00147"></a>00147   <span class="keywordflow">if</span> (<a class="code" href="main_8cpp.html#aa663f5de5daf2b639ad8d307f4ffc562">g_event</a>){
<a name="l00148"></a>00148     <a class="code" href="main_8cpp.html#aa663f5de5daf2b639ad8d307f4ffc562">g_event</a>-&gt;<a class="code" href="classTGlobalData.html#a75ab79e5634f47cae79638c4b0fcaa16">Clear</a>(<span class="stringliteral">&quot;C&quot;</span>);
<a name="l00149"></a>00149     dataTree-&gt;SetBranchAddress(<span class="stringliteral">&quot;Event&quot;</span>,&amp;<a class="code" href="main_8cpp.html#aa663f5de5daf2b639ad8d307f4ffc562">g_event</a>);
<a name="l00150"></a>00150   }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152   <span class="comment">// How many entries should we loop over?</span>
<a name="l00153"></a>00153   Long64_t start = 0;
<a name="l00154"></a>00154   Long64_t stop = nentries;
<a name="l00155"></a>00155   <span class="keywordflow">if</span>(arguments.<a class="code" href="structARGUMENTS.html#acd97b12de160ede1038cdceb57a2fc9d">stop</a>&gt;0){
<a name="l00156"></a>00156     <span class="keywordflow">if</span>(arguments.<a class="code" href="structARGUMENTS.html#ab610db850e4d58b53127cb0bf1c55a91">start</a>&gt;0)
<a name="l00157"></a>00157       start = (Long64_t)(arguments.<a class="code" href="structARGUMENTS.html#ab610db850e4d58b53127cb0bf1c55a91">start</a>-1);
<a name="l00158"></a>00158     <span class="keywordflow">if</span>((Long64_t)arguments.<a class="code" href="structARGUMENTS.html#acd97b12de160ede1038cdceb57a2fc9d">stop</a> &lt; nentries)
<a name="l00159"></a>00159       stop = (Long64_t)arguments.<a class="code" href="structARGUMENTS.html#acd97b12de160ede1038cdceb57a2fc9d">stop</a>;
<a name="l00160"></a>00160   }
<a name="l00161"></a>00161   <span class="keywordflow">else</span> <span class="keywordflow">if</span>((Long64_t)arguments.<a class="code" href="structARGUMENTS.html#ab610db850e4d58b53127cb0bf1c55a91">start</a> &lt; nentries &amp;&amp; arguments.<a class="code" href="structARGUMENTS.html#ab610db850e4d58b53127cb0bf1c55a91">start</a> &gt; 0){
<a name="l00162"></a>00162     stop = (Long64_t)arguments.<a class="code" href="structARGUMENTS.html#ab610db850e4d58b53127cb0bf1c55a91">start</a>;
<a name="l00163"></a>00163   }
<a name="l00164"></a>00164   <a class="code" href="main_8cpp.html#a20d2d589778e4f17e762fd9e5130381a">gTotalEntries</a>=&amp;stop;
<a name="l00165"></a>00165   <span class="comment">// wind the file on to the first event</span>
<a name="l00166"></a>00166   dataTree-&gt;GetEntry(start);
<a name="l00167"></a>00167 
<a name="l00168"></a>00168   <span class="comment">// Get the first and last module to run with</span>
<a name="l00169"></a>00169   <a class="code" href="namespacemodules.html#a5ce57c86284eadc5b573cfab0949bfdb">modules::iterator</a> first_module = <a class="code" href="classmodules_1_1navigator.html#a7b9cc64f2131df1cb305c6e9c2256d5d" title="Static method to obtain the singleton instance of the navigator.">modules::navigator::Instance</a>()-&gt;Begin();
<a name="l00170"></a>00170   <a class="code" href="namespacemodules.html#a5ce57c86284eadc5b573cfab0949bfdb">modules::iterator</a> last_module = <a class="code" href="classmodules_1_1navigator.html#a7b9cc64f2131df1cb305c6e9c2256d5d" title="Static method to obtain the singleton instance of the navigator.">modules::navigator::Instance</a>()-&gt;End();
<a name="l00171"></a>00171   <a class="code" href="namespacemodules.html#a5ce57c86284eadc5b573cfab0949bfdb">modules::iterator</a> it_mod;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   <span class="keywordtype">int</span> q = 0;
<a name="l00174"></a>00174   <span class="keywordflow">for</span> (it_mod=first_module; it_mod != last_module; it_mod++) {
<a name="l00175"></a>00175     q |= it_mod-&gt;second-&gt;BeforeFirstEntry(<a class="code" href="main_8cpp.html#aa663f5de5daf2b639ad8d307f4ffc562">g_event</a>, <a class="code" href="group__alcapana__main.html#ga96d8c48f8693f69adda6aac005d17589" title="(Quasi-)Singleton interface">TSetupData::Instance</a>());
<a name="l00176"></a>00176   }
<a name="l00177"></a>00177   <span class="keywordflow">if</span>(q) {
<a name="l00178"></a>00178     printf(<span class="stringliteral">&quot;Error while preprocessing first entry (%d)\n&quot;</span>,(Int_t)start);
<a name="l00179"></a>00179     <span class="keywordflow">return</span> q;
<a name="l00180"></a>00180   }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182   q = 0;
<a name="l00183"></a>00183   <span class="comment">//process entries</span>
<a name="l00184"></a>00184   Long64_t jentry;
<a name="l00185"></a>00185   <a class="code" href="main_8cpp.html#a2e94975f51e212eb2f57e9d37cf07eb2">gEntryNumber</a>=&amp;jentry;
<a name="l00186"></a>00186   <span class="keywordflow">for</span> ( jentry=start; jentry&lt;stop;jentry++) {
<a name="l00187"></a>00187     <span class="keywordflow">if</span>(<a class="code" href="main_8cpp.html#aa663f5de5daf2b639ad8d307f4ffc562">g_event</a>){
<a name="l00188"></a>00188       <a class="code" href="main_8cpp.html#aa663f5de5daf2b639ad8d307f4ffc562">g_event</a>-&gt;<a class="code" href="classTGlobalData.html#a75ab79e5634f47cae79638c4b0fcaa16">Clear</a>(<span class="stringliteral">&quot;C&quot;</span>);
<a name="l00189"></a>00189       <a class="code" href="EventNavigator_8cpp.html#ae12fe750176b13f48eb21cb6ffc11971">ClearGlobalData</a>(<a class="code" href="main_8cpp.html#aa663f5de5daf2b639ad8d307f4ffc562">g_event</a>);
<a name="l00190"></a>00190       dataTree-&gt;SetBranchAddress(<span class="stringliteral">&quot;Event&quot;</span>,&amp;<a class="code" href="main_8cpp.html#aa663f5de5daf2b639ad8d307f4ffc562">g_event</a>);
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192     
<a name="l00193"></a>00193     <span class="keywordflow">if</span> (jentry%100 == 0) {
<a name="l00194"></a>00194       printf(<span class="stringliteral">&quot;Completed %lld events out of %lld\n&quot;</span>, jentry, stop);
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196     <span class="comment">// Let&apos;s get the next event</span>
<a name="l00197"></a>00197     dataTree-&gt;GetEntry(jentry);
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     <span class="keywordflow">for</span> (it_mod=first_module; it_mod != last_module; it_mod++) {
<a name="l00200"></a>00200       q |= it_mod-&gt;second-&gt;ProcessGenericEntry(<a class="code" href="main_8cpp.html#aa663f5de5daf2b639ad8d307f4ffc562">g_event</a>,<a class="code" href="group__alcapana__main.html#ga96d8c48f8693f69adda6aac005d17589" title="(Quasi-)Singleton interface">TSetupData::Instance</a>());
<a name="l00201"></a>00201       <span class="comment">//if(q) break;</span>
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203     <span class="keywordflow">if</span>(q){
<a name="l00204"></a>00204       printf(<span class="stringliteral">&quot;q was non-zero when jentry was %lld\n&quot;</span>,jentry);
<a name="l00205"></a>00205       <span class="keywordflow">break</span>;
<a name="l00206"></a>00206     }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     <a class="code" href="main_8cpp.html#adb5d6e458a1f896bbeceb8ab3ef5ff0c">gAnalysedPulseMapWrapper</a>-&gt;<a class="code" href="classTAnalysedPulseMapWrapper.html#aef282ffdfa668ec48ef51889ab27e733">SetMap</a>(<a class="code" href="main_8cpp.html#afac9e7a91d4a0f20cde9500610882d3a">gAnalysedPulseMap</a>);
<a name="l00209"></a>00209     <span class="comment">//gAnalysedPulseMapWrapper-&gt;ShowInfo();</span>
<a name="l00210"></a>00210     <a class="code" href="main_8cpp.html#a16da3578e3e090d93fffe5a2e325e6d0">gAnalysedPulseTree</a>-&gt;Fill();
<a name="l00211"></a>00211   }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213   <span class="comment">//post-process on last entry</span>
<a name="l00214"></a>00214   q = 0;
<a name="l00215"></a>00215   <span class="keywordflow">for</span> (it_mod=first_module; it_mod != last_module; it_mod++) {
<a name="l00216"></a>00216     q |= it_mod-&gt;second-&gt;AfterLastEntry(<a class="code" href="main_8cpp.html#aa663f5de5daf2b639ad8d307f4ffc562">g_event</a>,<a class="code" href="group__alcapana__main.html#ga96d8c48f8693f69adda6aac005d17589" title="(Quasi-)Singleton interface">TSetupData::Instance</a>());
<a name="l00217"></a>00217   }
<a name="l00218"></a>00218   <span class="keywordflow">if</span> (q) {
<a name="l00219"></a>00219      printf(<span class="stringliteral">&quot;Error during post-processing last entry (%lld)\n&quot;</span>,(stop-1));
<a name="l00220"></a>00220       <span class="keywordflow">return</span> q;
<a name="l00221"></a>00221   }
<a name="l00222"></a>00222   
<a name="l00223"></a>00223   printf(<span class="stringliteral">&quot;Finished processing data normally\n&quot;</span>);
<a name="l00224"></a>00224   <span class="keywordflow">return</span> 0;
<a name="l00225"></a>00225 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 19 Jun 2014 for AlcapDAQ by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
