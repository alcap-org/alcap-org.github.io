<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>AlcapDAQ: rootana/src/TAP_generators/template_fitting/TemplateCreator.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>rootana/src/TAP_generators/template_fitting/TemplateCreator.h</h1><a href="TemplateCreator_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifndef TEMPLATECREATOR_H_</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">#define TEMPLATECREATOR_H_</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &quot;<a class="code" href="BaseModule_8h.html">BaseModule.h</a>&quot;</span>
<a name="l00005"></a>00005 <span class="keyword">class </span>gTGlobalData;
<a name="l00006"></a>00006 <span class="keyword">class </span>gTSetupData;
<a name="l00007"></a>00007 <span class="keyword">class </span>gModulesOptions;
<a name="l00008"></a>00008 <span class="keyword">class </span>TH1D;
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="code" href="TAPAlgorithms_8h.html">TAPAlgorithms.h</a>&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="TemplateArchive_8h.html">TemplateArchive.h</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="PulseCandidateFinder_8h.html">PulseCandidateFinder.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="TemplateFitter_8h.html">TemplateFitter.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="TTemplate_8h.html">TTemplate.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="InterpolatePulse_8h.html">InterpolatePulse.h</a>&quot;</span>
<a name="l00016"></a>00016 
<a name="l00017"></a><a class="code" href="classTemplateCreator.html">00017</a> <span class="keyword">class </span><a class="code" href="classTemplateCreator.html">TemplateCreator</a> : <span class="keyword">public</span> <a class="code" href="classBaseModule.html">BaseModule</a>{
<a name="l00018"></a><a class="code" href="structTemplateCreator_1_1ChannelSet.html">00018</a>   <span class="keyword">struct </span><a class="code" href="structTemplateCreator_1_1ChannelSet.html">ChannelSet</a>{
<a name="l00019"></a><a class="code" href="structTemplateCreator_1_1ChannelSet.html#af176010b09a0f318852c0f02e89f1216">00019</a>      std::string <a class="code" href="structTemplateCreator_1_1ChannelSet.html#af176010b09a0f318852c0f02e89f1216">detname</a>, <a class="code" href="structTemplateCreator_1_1ChannelSet.html#a0897c208f3c58da6fdf246c91765fbdb">bankname</a>;
<a name="l00020"></a>00020 
<a name="l00021"></a><a class="code" href="structTemplateCreator_1_1ChannelSet.html#a42bef7e5af274ebec899451b8a7e1dc8">00021</a>      <span class="keywordtype">int</span> <a class="code" href="structTemplateCreator_1_1ChannelSet.html#a42bef7e5af274ebec899451b8a7e1dc8">fit_successes</a>, <a class="code" href="structTemplateCreator_1_1ChannelSet.html#a8d252e4c6d5fa1648abb308f4ea5b5aa">fit_attempts</a>;
<a name="l00022"></a><a class="code" href="structTemplateCreator_1_1ChannelSet.html#aa9ad268b84bebb23dc0394ec073badb9">00022</a>      <span class="keywordtype">int</span> <a class="code" href="structTemplateCreator_1_1ChannelSet.html#aa9ad268b84bebb23dc0394ec073badb9">trigger_polarity</a>;
<a name="l00023"></a><a class="code" href="structTemplateCreator_1_1ChannelSet.html#a668b4b90472aac177f958636cc2065c8">00023</a>      <a class="code" href="classTTemplate.html">TTemplate</a>* <a class="code" href="structTemplateCreator_1_1ChannelSet.html#a668b4b90472aac177f958636cc2065c8">template_pulse</a>;
<a name="l00024"></a>00024 
<a name="l00025"></a><a class="code" href="structTemplateCreator_1_1ChannelSet.html#aa659cc12feddcbbbdea638bf8b7ea02b">00025</a>      <a class="code" href="classTemplateFitter.html">TemplateFitter</a>* <a class="code" href="structTemplateCreator_1_1ChannelSet.html#aa659cc12feddcbbbdea638bf8b7ea02b">fitter</a>;
<a name="l00026"></a><a class="code" href="structTemplateCreator_1_1ChannelSet.html#a06ac4a65112b93b16bc6408ab8e9e672">00026</a>      <a class="code" href="classPulseCandidateFinder.html" title="Utility class to find pulse candidates on a TPulseIsland.">PulseCandidateFinder</a>* <a class="code" href="structTemplateCreator_1_1ChannelSet.html#a06ac4a65112b93b16bc6408ab8e9e672">pulse_finder</a>;
<a name="l00027"></a><a class="code" href="structTemplateCreator_1_1ChannelSet.html#a0d8ed018790360670e4a0715489e2c92">00027</a>      <a class="code" href="structAlgorithm_1_1IntegralRatio.html">Algorithm::IntegralRatio</a> *<a class="code" href="structTemplateCreator_1_1ChannelSet.html#a0d8ed018790360670e4a0715489e2c92">integralRatio</a>;
<a name="l00028"></a>00028 
<a name="l00029"></a>00029      <span class="comment">// constructor takes a lot of the effort of initialising the above fields</span>
<a name="l00030"></a>00030      <a class="code" href="structTemplateCreator_1_1ChannelSet.html#acba71f51ae2c2853c7dfe2aa84284de1">ChannelSet</a>(<span class="keyword">const</span> std::string&amp; <a class="code" href="structTemplateCreator_1_1ChannelSet.html#af176010b09a0f318852c0f02e89f1216">detname</a>, <span class="keyword">const</span> std::string&amp; <a class="code" href="structTemplateCreator_1_1ChannelSet.html#a0897c208f3c58da6fdf246c91765fbdb">bankname</a>, <a class="code" href="classmodules_1_1options.html" title="Class to handle options given through the MODULES file.">modules::options</a>* opts,<span class="keywordtype">int</span> refine );
<a name="l00031"></a>00031      <span class="keywordtype">void</span> <a class="code" href="structTemplateCreator_1_1ChannelSet.html#a32e31273206fa731c18cbd03c77df0ee">Clear</a>();
<a name="l00032"></a>00032   };
<a name="l00033"></a><a class="code" href="classTemplateCreator.html#a91f63dfa6f21cdb31efdb33ab66c5fe8">00033</a>   <span class="keyword">typedef</span> std::vector&lt;ChannelSet&gt; <a class="code" href="classTemplateCreator.html#a91f63dfa6f21cdb31efdb33ab66c5fe8">ChannelList</a>;
<a name="l00034"></a>00034 
<a name="l00035"></a>00035  <span class="keyword">public</span>:
<a name="l00036"></a>00036   <a class="code" href="classTemplateCreator.html#a14f9890eadec9e00bb37a97b7c4f4c13">TemplateCreator</a>(<a class="code" href="classmodules_1_1options.html" title="Class to handle options given through the MODULES file.">modules::options</a>* opts);
<a name="l00037"></a>00037   <a class="code" href="classTemplateCreator.html#a50828894e8aa3da51f3c543cd955a4ab">~TemplateCreator</a>();
<a name="l00038"></a>00038 
<a name="l00039"></a>00039  <span class="keyword">private</span>:
<a name="l00040"></a>00040   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classTemplateCreator.html#af011c57b324263249b1dd323861f9cff" title="The big kahuna. Overload this in the derived class and it will be called for each...">ProcessEntry</a>(<a class="code" href="classTGlobalData.html" title="This class holds all of the data created by alcapana analysis modules.">TGlobalData</a> *<a class="code" href="group__MCAENPulseIslandSortAndStitch.html#ga69cb952a194ddefc6004dd96e70ccd62" title="Object to hold data used and produced by modules throughout alcapana stage of analysis...">gData</a>, <span class="keyword">const</span> <a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>* <a class="code" href="group__MCAENPulseIslandSortAndStitch.html#gaad8aa5d5fe566b2f8f6ca3000b09f0e9" title="Hardware information about digitizers and detectors to be used during alcapana stage...">gSetup</a>);
<a name="l00041"></a>00041   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classTemplateCreator.html#a1465faef6f2c4f5de31794c64d5a3515">BeforeFirstEntry</a>(<a class="code" href="classTGlobalData.html" title="This class holds all of the data created by alcapana analysis modules.">TGlobalData</a>* <a class="code" href="group__MCAENPulseIslandSortAndStitch.html#ga69cb952a194ddefc6004dd96e70ccd62" title="Object to hold data used and produced by modules throughout alcapana stage of analysis...">gData</a>, <span class="keyword">const</span> <a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>* setup);
<a name="l00042"></a>00042   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classTemplateCreator.html#ae5f5a731f66c274dd42f17dc9e4ed738">AfterLastEntry</a>(<a class="code" href="classTGlobalData.html" title="This class holds all of the data created by alcapana analysis modules.">TGlobalData</a>* <a class="code" href="group__MCAENPulseIslandSortAndStitch.html#ga69cb952a194ddefc6004dd96e70ccd62" title="Object to hold data used and produced by modules throughout alcapana stage of analysis...">gData</a>, <span class="keyword">const</span> <a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>* setup);
<a name="l00043"></a>00043 
<a name="l00044"></a>00044   <span class="keywordtype">void</span> <a class="code" href="classTemplateCreator.html#a8eec6677365132e4b6e6801c26055c42">AddPulseToTemplate</a>(<a class="code" href="structTemplateCreator_1_1ChannelSet.html">ChannelSet</a>&amp; current, TH1D* &amp; hPulse);
<a name="l00045"></a>00045 
<a name="l00048"></a>00048   <span class="keywordtype">double</span> <a class="code" href="classTemplateCreator.html#ae474ec35dd56e9e85907c46b62a36ec0" title="Corrects a given sample value.">CorrectSampleValue</a>(<span class="keywordtype">double</span> old_value, <span class="keywordtype">double</span> template_pedestal);
<a name="l00049"></a>00049 
<a name="l00052"></a><a class="code" href="classTemplateCreator.html#a21231b763f400410e9f3ba8d7eb8d3cd">00052</a>   TH1D* <a class="code" href="classTemplateCreator.html#a21231b763f400410e9f3ba8d7eb8d3cd" title="Creates a refined histogram for a given TPulseIsland.">CreateRefinedPulseHistogram</a>(<span class="keyword">const</span> <a class="code" href="classTPulseIsland.html" title="A uniform format for data from many different detectors.">TPulseIsland</a>* pulse, std::string histname, std::string histtitle, <span class="keywordtype">bool</span> interpolate){
<a name="l00053"></a>00053      <span class="keywordflow">return</span> <a class="code" href="namespacefunctions.html#a7a3497de6dab041186f27c619e786ddb">InterpolatePulse</a>(pulse,histname,histtitle, interpolate, <a class="code" href="classTemplateCreator.html#a54b5408e48da1688055b6c4ed7a70724" title="The factor that we scale the number of bins in the template histogram by.">fRefineFactor</a>);
<a name="l00054"></a>00054   }
<a name="l00055"></a>00055 
<a name="l00059"></a>00059   <span class="keywordtype">bool</span> <a class="code" href="classTemplateCreator.html#addd3ae860e7cc93b63aed6963188671b" title="Checks if the template has converged and that adding a new pulse has not effect on...">CheckConvergence</a>(ChannelSet&amp; current);
<a name="l00060"></a>00060 
<a name="l00063"></a>00063   <span class="keywordtype">int</span> <a class="code" href="classTemplateCreator.html#a6b803bc7b0c76bb86a678b5dcbcd4fb2" title="Check if any part of the pulse&amp;#39; waveform has ADC overflow.">HasPulseOverflowed</a>(<span class="keyword">const</span> <a class="code" href="classTPulseIsland.html" title="A uniform format for data from many different detectors.">TPulseIsland</a>* pulse, <span class="keyword">const</span> std::string&amp; bankname);
<a name="l00064"></a>00064 
<a name="l00066"></a>00066   TH1D* <a class="code" href="classTemplateCreator.html#a4f556c5b90e7384d4bfe9d8a9b79d008" title="Init the template using the first valid pulse.">StartTemplate</a>(<span class="keywordtype">int</span> pulseID, <span class="keyword">const</span> <a class="code" href="classTPulseIsland.html" title="A uniform format for data from many different detectors.">TPulseIsland</a>* pulse,<span class="keyword">const</span> std::string&amp; detname);
<a name="l00067"></a>00067 
<a name="l00068"></a>00068  
<a name="l00069"></a>00069  <span class="keyword">private</span>:
<a name="l00070"></a>00070 
<a name="l00073"></a><a class="code" href="classTemplateCreator.html#a54b5408e48da1688055b6c4ed7a70724">00073</a>   <span class="keywordtype">int</span> <a class="code" href="classTemplateCreator.html#a54b5408e48da1688055b6c4ed7a70724" title="The factor that we scale the number of bins in the template histogram by.">fRefineFactor</a>;
<a name="l00074"></a>00074 
<a name="l00075"></a><a class="code" href="classTemplateCreator.html#a253ff352f3af4b5c91e3430071178816">00075</a>   <a class="code" href="classTemplateFitter.html">TemplateFitter</a>* <a class="code" href="classTemplateCreator.html#a253ff352f3af4b5c91e3430071178816">fTemplateFitter</a>;
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="classTemplateCreator.html#ab91fb1b10be88f3939523ab2ffac70b8">00077</a>   <a class="code" href="classmodules_1_1options.html" title="Class to handle options given through the MODULES file.">modules::options</a>* <a class="code" href="classTemplateCreator.html#ab91fb1b10be88f3939523ab2ffac70b8" title="Store the options for use in ProcessEntry.">fOpts</a>; 
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="classTemplateCreator.html#aff185729a609ddba8226b2f28ce88a4c">00079</a>   std::string <a class="code" href="classTemplateCreator.html#aff185729a609ddba8226b2f28ce88a4c">fArchiveName</a>;
<a name="l00080"></a><a class="code" href="classTemplateCreator.html#aa768b7261101542440cbc87440b9fe63">00080</a>   <a class="code" href="classTemplateArchive.html" title="Utility class that manages reading and writing template histograms to a ROOT file...">TemplateArchive</a>* <a class="code" href="classTemplateCreator.html#aa768b7261101542440cbc87440b9fe63">fTemplateArchive</a>;
<a name="l00081"></a>00081 
<a name="l00085"></a><a class="code" href="classTemplateCreator.html#afdc3d19a0799435e5f210a531ca60921">00085</a>   <span class="keywordtype">bool</span> <a class="code" href="classTemplateCreator.html#afdc3d19a0799435e5f210a531ca60921" title="If true, then print out all pulses that get added to the templates and also print...">fPulseDebug</a>;
<a name="l00086"></a><a class="code" href="classTemplateCreator.html#a16b3d73d8c5a9d951b70e78609f32c4e">00086</a>   <span class="keywordtype">bool</span> <a class="code" href="classTemplateCreator.html#a16b3d73d8c5a9d951b70e78609f32c4e">fAnalyseAllChannels</a>;
<a name="l00087"></a><a class="code" href="classTemplateCreator.html#ae1db2c8226ddf1ea148879ecd1ddd342">00087</a>   <a class="code" href="classTemplateCreator.html#a91f63dfa6f21cdb31efdb33ab66c5fe8">ChannelList</a> <a class="code" href="classTemplateCreator.html#ae1db2c8226ddf1ea148879ecd1ddd342">fChannels</a>;
<a name="l00088"></a><a class="code" href="classTemplateCreator.html#a180966a471ab741148c112714d0d1ccb">00088</a>   std::vector&lt;std::string&gt; <a class="code" href="classTemplateCreator.html#a180966a471ab741148c112714d0d1ccb">fRequestedChannels</a>;
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="classTemplateCreator.html#a25c993f38e35c5ea87da827dff4e10b4">00090</a>   <span class="keywordtype">bool</span> <a class="code" href="classTemplateCreator.html#a25c993f38e35c5ea87da827dff4e10b4">fCutIntegralRatio</a>;
<a name="l00091"></a><a class="code" href="classTemplateCreator.html#aaf4f6b5ef4b8608d5cfc1da845e609ef">00091</a>   <span class="keywordtype">double</span> <a class="code" href="classTemplateCreator.html#aceeae6047f2968c6cfe2b5ca533c8848">fIntegralMax</a>, <a class="code" href="classTemplateCreator.html#aaf4f6b5ef4b8608d5cfc1da845e609ef">fIntegralMin</a>;
<a name="l00092"></a><a class="code" href="classTemplateCreator.html#a8675d24f63bf2aa7044aed42df658f7b">00092</a>   <span class="keywordtype">double</span> <a class="code" href="classTemplateCreator.html#aa5bc6cbd2cfdde88ee9262f57e0c04eb">fIntegralRatioMax</a>, <a class="code" href="classTemplateCreator.html#a8675d24f63bf2aa7044aed42df658f7b">fIntegralRatioMin</a>;
<a name="l00093"></a><a class="code" href="classTemplateCreator.html#a0dc5c74bc4c4e9eb52f70e063677fc8e">00093</a>   <span class="keywordtype">int</span> <a class="code" href="classTemplateCreator.html#a690d4256ed3229fdb0085d3d734e5b62">fStartIntegral</a>, <a class="code" href="classTemplateCreator.html#a0dc5c74bc4c4e9eb52f70e063677fc8e">fStopIntegral</a>, <a class="code" href="classTemplateCreator.html#aff678607be5dff82c2c631edeaa21307">fStartTail</a>;
<a name="l00094"></a>00094   
<a name="l00095"></a>00095 };
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="preprocessor">#endif //TEMPLATECREATOR_H_</span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 25 Jan 2016 for AlcapDAQ by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
