<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>AlcapDAQ: rootana/src/data_quality/IslandLength.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>rootana/src/data_quality/IslandLength.cpp</h1><a href="IslandLength_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;utility&gt;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &quot;<a class="code" href="IslandLength_8h.html">IslandLength.h</a>&quot;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &quot;<a class="code" href="RegisterModule_8inc.html">RegisterModule.inc</a>&quot;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &quot;<a class="code" href="TGlobalData_8h.html">TGlobalData.h</a>&quot;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &quot;<a class="code" href="TSetupData_8h.html">TSetupData.h</a>&quot;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;<a class="code" href="ModulesOptions_8h.html">ModulesOptions.h</a>&quot;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;<a class="code" href="definitions_8h.html">definitions.h</a>&quot;</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="comment">//----------------------------------------------------------------------</span>
<a name="l00013"></a><a class="code" href="classIslandLength.html#ad935215eed1453afaf04fb14b8edbf11">00013</a> <a class="code" href="classIslandLength.html#ad935215eed1453afaf04fb14b8edbf11" title="Constructor description. If necessary, add a details tag like above.">IslandLength::IslandLength</a>(<a class="code" href="classmodules_1_1options.html" title="Class to handle options given through the MODULES file.">modules::options</a>* opts)
<a name="l00014"></a>00014   : <a class="code" href="classBaseModule.html">BaseModule</a>(<span class="stringliteral">&quot;IslandLength&quot;</span>,opts)
<a name="l00015"></a>00015 {
<a name="l00016"></a>00016 
<a name="l00017"></a>00017   <span class="comment">// Do something with opts here.  Has the user specified any</span>
<a name="l00018"></a>00018   <span class="comment">// particular configuration that you want to know?</span>
<a name="l00019"></a>00019   <span class="comment">// For example, perhaps this module wants an axis range:</span>
<a name="l00020"></a>00020   <span class="comment">//fXMax=opts-&gt;GetDouble(&quot;x_max&quot;,100); </span>
<a name="l00021"></a>00021   
<a name="l00022"></a>00022 }
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="comment">//----------------------------------------------------------------------</span>
<a name="l00026"></a><a class="code" href="classIslandLength.html#a5153e1d02576aee7c90fd73b563f6cf3">00026</a> <a class="code" href="classIslandLength.html#a5153e1d02576aee7c90fd73b563f6cf3" title="Is anything done in the destructor?">IslandLength::~IslandLength</a>()
<a name="l00027"></a>00027 {
<a name="l00028"></a>00028 }
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">//----------------------------------------------------------------------</span>
<a name="l00032"></a><a class="code" href="classIslandLength.html#aa8ec40511e0f2322ba3a0c8c7e82e82f">00032</a> <span class="keywordtype">int</span> <a class="code" href="classIslandLength.html#aa8ec40511e0f2322ba3a0c8c7e82e82f" title="What needes to be done before each run? Don&amp;#39;t hesitate to repeat what was said...">IslandLength::BeforeFirstEntry</a>(<a class="code" href="classTGlobalData.html" title="This class holds all of the data created by alcapana analysis modules.">TGlobalData</a>* data,<span class="keyword">const</span> <a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a> *setup)
<a name="l00033"></a>00033 {
<a name="l00034"></a>00034   <span class="comment">// Called before the main event loop</span>
<a name="l00035"></a>00035   <span class="comment">// Can be used to set things up, like histograms etc</span>
<a name="l00036"></a>00036   <span class="comment">// Return non-zero to indicate a problem</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038   <span class="comment">// Print extra info if we&apos;re debugging this module:</span>
<a name="l00039"></a>00039   <span class="keywordflow">if</span>(<a class="code" href="classBaseModule.html#ac6227c641b46487b3deb287fd3ea2408">Debug</a>()){
<a name="l00040"></a>00040     std::cout&lt;&lt;<span class="stringliteral">&quot;-----IslandLength::BeforeFirstEntry(): I&apos;m debugging!&quot;</span>
<a name="l00041"></a>00041              &lt;&lt;std::endl;
<a name="l00042"></a>00042   }
<a name="l00043"></a>00043 
<a name="l00044"></a>00044   <a class="code" href="classIslandLength.html#a08e6e1e881c5eed427bd0fcc791bb141">fNProcessed</a> = 0;
<a name="l00045"></a>00045   <a class="code" href="classIslandLength.html#aac3168556c595ce13777990bd7a7a196" title="Book histograms and similar.">Book</a>(data, setup);
<a name="l00046"></a>00046   <span class="keywordflow">return</span> 0;
<a name="l00047"></a>00047 }
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="comment">//----------------------------------------------------------------------</span>
<a name="l00051"></a><a class="code" href="classIslandLength.html#a0bcf32c728d663f72bb8281480a0ee5a">00051</a> <span class="keywordtype">int</span> <a class="code" href="classIslandLength.html#a0bcf32c728d663f72bb8281480a0ee5a" title="What&amp;#39;s calculated for every entry? Don&amp;#39;t hesitate to repeat what was said...">IslandLength::ProcessEntry</a>(<a class="code" href="classTGlobalData.html" title="This class holds all of the data created by alcapana analysis modules.">TGlobalData</a>* data,<span class="keyword">const</span> <a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>* setup)
<a name="l00052"></a>00052 {
<a name="l00053"></a>00053   ++<a class="code" href="classIslandLength.html#a08e6e1e881c5eed427bd0fcc791bb141">fNProcessed</a>;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055   <span class="comment">// Called once for each event in the main event loop</span>
<a name="l00056"></a>00056   <span class="comment">// Return non-zero to indicate a problem and terminate the event loop</span>
<a name="l00057"></a>00057   <a class="code" href="definitions_8h.html#a848e7d8148f5d52d30147ca5847f847e">StringPulseIslandMap</a>&amp; <a class="code" href="MyModule_8cpp.html#aebb1bc7b6b5a2c4ac668ccd06329e1f7">banks</a> = data-&gt;<a class="code" href="classTGlobalData.html#af871aca81ed72f5b05f063cfb471d9e8" title="Map of bank names to vectors of TPIs.">fPulseIslandToChannelMap</a>;
<a name="l00058"></a>00058   <span class="comment">//typedef StringPulseIslandMap::iterator mapSP_iter;</span>
<a name="l00059"></a>00059   <span class="keywordtype">int</span> entry_norm = -1;
<a name="l00060"></a>00060   <span class="keywordflow">for</span> (<a class="code" href="classIslandLength.html#ab118b8b932d0111b0656754ea6c2fca4">mapSP_iter</a> biter = banks.begin(); biter != banks.end(); ++biter){
<a name="l00061"></a>00061     std::string det_name = setup-&gt;<a class="code" href="classTSetupData.html#a796d0707e015edf53fd58b34ac2d823e">GetDetectorName</a>(biter-&gt;first);
<a name="l00062"></a>00062     <span class="keywordflow">if</span> (det_name == <span class="stringliteral">&quot;muSc&quot;</span>){
<a name="l00063"></a>00063       entry_norm = biter-&gt;second.size();
<a name="l00064"></a>00064     }
<a name="l00065"></a>00065   }  
<a name="l00066"></a>00066   <span class="keywordflow">for</span> (<a class="code" href="classIslandLength.html#ab118b8b932d0111b0656754ea6c2fca4">mapSP_iter</a> biter = banks.begin(); biter != banks.end(); ++biter){
<a name="l00067"></a>00067     std::string bank_name = biter-&gt;first;
<a name="l00068"></a>00068     std::string det_name = setup-&gt;<a class="code" href="classTSetupData.html#a796d0707e015edf53fd58b34ac2d823e">GetDetectorName</a>(bank_name);
<a name="l00069"></a>00069     <a class="code" href="definitions_8h.html#a3c0940832f8741b0c226a24e3dbd62a8">PulseIslandList</a>&amp; islands = biter-&gt;second;
<a name="l00070"></a>00070     
<a name="l00071"></a>00071     TH1F* hist = <a class="code" href="classIslandLength.html#aeb431052cfc9761e447c034fe77366bc" title="Map of histograms, keyed by bank_name;.">fHistos</a>.find(bank_name)-&gt;second;
<a name="l00072"></a>00072     TH1F* histNorm = <a class="code" href="classIslandLength.html#ac54dbe25cc60fbf2faae516b3e993c0b" title="Map of normalised histograms, keyed by bank_name;.">fHistosNorm</a>.find(bank_name)-&gt;second;
<a name="l00073"></a>00073    
<a name="l00074"></a>00074     <span class="keywordflow">for</span> (<a class="code" href="classIslandLength.html#ad46ef740aaf9cc430659b3dd9f1ab97a">PIL_iter</a> piter = islands.begin(); piter != islands.end(); ++piter){
<a name="l00075"></a>00075       <span class="keywordtype">int</span> length = (*piter)-&gt;GetSamples().size();
<a name="l00076"></a>00076       hist-&gt;Fill(length);
<a name="l00077"></a>00077       <span class="keywordflow">if</span> (entry_norm!=0) histNorm-&gt;Fill(length, 1./entry_norm);
<a name="l00078"></a>00078     }
<a name="l00079"></a>00079   }
<a name="l00080"></a>00080 
<a name="l00081"></a>00081   <span class="keywordflow">return</span> 0;
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="comment">//----------------------------------------------------------------------</span>
<a name="l00086"></a><a class="code" href="classIslandLength.html#a10dc5f1c78d6199ad235000c5e6cd163">00086</a> <span class="keywordtype">int</span> <a class="code" href="classIslandLength.html#a10dc5f1c78d6199ad235000c5e6cd163" title="What needs to be done after each run? Don&amp;#39;t hesitate to repeat what was said...">IslandLength::AfterLastEntry</a>(<a class="code" href="classTGlobalData.html" title="This class holds all of the data created by alcapana analysis modules.">TGlobalData</a>* <a class="code" href="group__MCAENPulseIslandSortAndStitch.html#ga69cb952a194ddefc6004dd96e70ccd62" title="Object to hold data used and produced by modules throughout alcapana stage of analysis...">gData</a>,<span class="keyword">const</span> <a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a> *setup)
<a name="l00087"></a>00087 {
<a name="l00088"></a>00088   <span class="comment">// Return non-zero to indicate a problem</span>
<a name="l00089"></a>00089   <span class="keywordflow">if</span>(<a class="code" href="classBaseModule.html#ac6227c641b46487b3deb287fd3ea2408">Debug</a>()){
<a name="l00090"></a>00090     std::cout &lt;&lt; <span class="stringliteral">&quot;-----IslandLength::AfterLastEntry(): I&apos;m debugging!&quot;</span>
<a name="l00091"></a>00091               &lt;&lt; std::endl;    
<a name="l00092"></a>00092   }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094   <span class="keywordtype">double</span> run_norm = <a class="code" href="classIslandLength.html#a57178c83316da0f7646d23fda066a894" title="The histogram that we use for normalising to;.">fNormHist</a>-&gt;Integral(0,-1);
<a name="l00095"></a>00095   <span class="keywordflow">for</span> (<a class="code" href="namespacemodules.html#a5ce57c86284eadc5b573cfab0949bfdb">mapSH_t::iterator</a> it = <a class="code" href="classIslandLength.html#aeb431052cfc9761e447c034fe77366bc" title="Map of histograms, keyed by bank_name;.">fHistos</a>.begin(); it != <a class="code" href="classIslandLength.html#aeb431052cfc9761e447c034fe77366bc" title="Map of histograms, keyed by bank_name;.">fHistos</a>.end(); ++it){
<a name="l00096"></a>00096     TH1F* h = it-&gt;second;
<a name="l00097"></a>00097     <a class="code" href="classTObject.html">TObject</a>* obj = h-&gt;Clone((std::string(h-&gt;GetName()) + <span class="stringliteral">&quot;_RunNorm&quot;</span>).c_str());
<a name="l00098"></a>00098     TH1* hn = <span class="keyword">static_cast&lt;</span>TH1*<span class="keyword">&gt;</span>(obj);
<a name="l00099"></a>00099     hn-&gt;SetTitle((std::string(h-&gt;GetTitle()) + <span class="stringliteral">&quot; (run normalised)&quot;</span>).c_str());
<a name="l00100"></a>00100     hn-&gt;Scale(1./run_norm);
<a name="l00101"></a>00101   }
<a name="l00102"></a>00102   <span class="keywordflow">for</span> (<a class="code" href="namespacemodules.html#a5ce57c86284eadc5b573cfab0949bfdb">mapSH_t::iterator</a> it = <a class="code" href="classIslandLength.html#ac54dbe25cc60fbf2faae516b3e993c0b" title="Map of normalised histograms, keyed by bank_name;.">fHistosNorm</a>.begin(); it != <a class="code" href="classIslandLength.html#ac54dbe25cc60fbf2faae516b3e993c0b" title="Map of normalised histograms, keyed by bank_name;.">fHistosNorm</a>.end(); ++it){
<a name="l00103"></a>00103     it-&gt;second-&gt;Scale(1./<a class="code" href="classIslandLength.html#a08e6e1e881c5eed427bd0fcc791bb141">fNProcessed</a>);
<a name="l00104"></a>00104   }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106   <span class="keywordflow">return</span> 0;
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="comment">//----------------------------------------------------------------------</span>
<a name="l00110"></a><a class="code" href="classIslandLength.html#aac3168556c595ce13777990bd7a7a196">00110</a> <span class="keywordtype">void</span> <a class="code" href="classIslandLength.html#aac3168556c595ce13777990bd7a7a196" title="Book histograms and similar.">IslandLength::Book</a>(<a class="code" href="classTGlobalData.html" title="This class holds all of the data created by alcapana analysis modules.">TGlobalData</a>* data,<span class="keyword">const</span> <a class="code" href="classTSetupData.html" title="Holds data relevent to each run.">TSetupData</a>* setup)
<a name="l00111"></a>00111 {
<a name="l00112"></a>00112   <span class="comment">//Change: Use the same map as when processing entries. This should</span>
<a name="l00113"></a>00113   <span class="comment">//guarentee that all histograms we try to fill also exist </span>
<a name="l00114"></a>00114   <a class="code" href="definitions_8h.html#a848e7d8148f5d52d30147ca5847f847e">StringPulseIslandMap</a>&amp; islands = data-&gt;<a class="code" href="classTGlobalData.html#af871aca81ed72f5b05f063cfb471d9e8" title="Map of bank names to vectors of TPIs.">fPulseIslandToChannelMap</a>;
<a name="l00115"></a>00115   <span class="keywordflow">for</span> (<a class="code" href="classIslandLength.html#ab118b8b932d0111b0656754ea6c2fca4">mapSP_iter</a> it = islands.begin(); it != islands.end(); ++it){
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     std::string bank_name = it-&gt;first;
<a name="l00118"></a>00118     std::string det_name = setup-&gt;<a class="code" href="classTSetupData.html#a796d0707e015edf53fd58b34ac2d823e">GetDetectorName</a>(bank_name);
<a name="l00119"></a>00119     std::string hist_name = <span class="stringliteral">&quot;hDQ_IslandLength_&quot;</span> + det_name + <span class="stringliteral">&quot;&quot;</span> + bank_name;
<a name="l00120"></a>00120     std::string hist_title = <span class="stringliteral">&quot;Length of TPulseIslands in &quot;</span> + det_name;
<a name="l00121"></a>00121     std::string axis_title = <span class="stringliteral">&quot;;Length /samples;Number of Islands&quot;</span>;
<a name="l00122"></a>00122     TH1F* histo = <span class="keyword">new</span> TH1F(hist_name.c_str(), (hist_title + axis_title).c_str(),
<a name="l00123"></a>00123                            500, 0, 2000);
<a name="l00124"></a>00124     <a class="code" href="classIslandLength.html#aeb431052cfc9761e447c034fe77366bc" title="Map of histograms, keyed by bank_name;.">fHistos</a>[bank_name] = histo;
<a name="l00125"></a>00125     <span class="keywordflow">if</span> (det_name == <span class="stringliteral">&quot;muSc&quot;</span>) <a class="code" href="classIslandLength.html#a57178c83316da0f7646d23fda066a894" title="The histogram that we use for normalising to;.">fNormHist</a> = histo;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     hist_name += <span class="stringliteral">&quot;_EvtNorm&quot;</span>;
<a name="l00128"></a>00128     hist_title += <span class="stringliteral">&quot; (event normalised)&quot;</span>;
<a name="l00129"></a>00129     histo = <span class="keyword">new</span> TH1F(hist_name.c_str(), (hist_title + axis_title).c_str(),
<a name="l00130"></a>00130                      500, 0, 2000);
<a name="l00131"></a>00131     <a class="code" href="classIslandLength.html#ac54dbe25cc60fbf2faae516b3e993c0b" title="Map of normalised histograms, keyed by bank_name;.">fHistosNorm</a>[bank_name] = histo;
<a name="l00132"></a>00132   }
<a name="l00133"></a>00133 }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="comment">//----------------------------------------------------------------------</span>
<a name="l00136"></a>00136 <span class="comment">// The following macro registers this module to be useable in the config file.</span>
<a name="l00137"></a>00137 <span class="comment">// The first argument is compulsory and gives the name of this module</span>
<a name="l00138"></a>00138 <span class="comment">// All subsequent arguments will be used as names for arguments given directly </span>
<a name="l00139"></a>00139 <span class="comment">// within the modules file.  See the github wiki for more.</span>
<a name="l00140"></a>00140 <a class="code" href="Template__module_8cpp.html#af5a8f3de39b8d01369a5c344af6d4a8c">ALCAP_REGISTER_MODULE</a>(<a class="code" href="classIslandLength.html" title="A one line description of what your module does.">IslandLength</a>);
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 2 May 2015 for AlcapDAQ by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
