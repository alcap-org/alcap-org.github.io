<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>AlcapDAQ: midas/mscb/mscb.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>midas/mscb/mscb.c File Reference</h1><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="mscb_8h_source.html">mscb.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="rpc_8h_source.html">rpc.h</a>&quot;</code><br/>

<p><a href="mscb_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCACHE__ENTRY.html">CACHE_ENTRY</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#acac460e2a19e766cfb2eedc0e39084c4">MSCB_LIBRARY_VERSION</a>&nbsp;&nbsp;&nbsp;&quot;1.7.5&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a825db2832559242d360eb92d077081e4">MSCB_PROTOCOL_VERSION</a>&nbsp;&nbsp;&nbsp;&quot;1.7&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#aa7b693ad182550b835a69b0fbd6bd2db">LPT_STROBE</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#abf3d598389a18a54466f7aa8ffed86fc">LPT_ACK</a>&nbsp;&nbsp;&nbsp;2</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#add1804fb4ed8a17464e7c516b51ac72b">LPT_RESET</a>&nbsp;&nbsp;&nbsp;3</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#aafc451f66099eadd66b93da2201893b8">LPT_BIT9</a>&nbsp;&nbsp;&nbsp;4</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a86391e262670a0332b41754452fbdd7b">LPT_READMODE</a>&nbsp;&nbsp;&nbsp;5</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a9e6f01a3d42fa39fe5ce37f50beea147">LPT_BUSY</a>&nbsp;&nbsp;&nbsp;6</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a70d318d8a0062dc4b32ebb8775c53653">LPT_DATAREADY</a>&nbsp;&nbsp;&nbsp;7</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a25c6eabcf221b9af262fe35eaf2704f1">TIMEOUT_OUT</a>&nbsp;&nbsp;&nbsp;1000</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#ace34d48b78d719270743b9cca5b2ab8c">RS485_FLAG_BIT9</a>&nbsp;&nbsp;&nbsp;(1&lt;&lt;0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a1265f1c3f2fdd44625d8392cc53d49e1">RS485_FLAG_NO_ACK</a>&nbsp;&nbsp;&nbsp;(1&lt;&lt;1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a91c3c417f72a54dc3458e899aecba641">RS485_FLAG_SHORT_TO</a>&nbsp;&nbsp;&nbsp;(1&lt;&lt;2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a86c0efa95b2455cd26b8629d32bd0a36">RS485_FLAG_LONG_TO</a>&nbsp;&nbsp;&nbsp;(1&lt;&lt;3)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a23b3240a4ffbe66e078cb0e6a2aa5ba7">RS485_FLAG_CMD</a>&nbsp;&nbsp;&nbsp;(1&lt;&lt;4)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a2bac5c4ef464fd0b474abc62f97ac8fa">CACHE_PERIOD</a>&nbsp;&nbsp;&nbsp;500</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a3f9b1b1b3b2ee5719d9ed7c7fc26638d">debug_log</a> (char *format,...)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#aca3f3982b04c5e7e5884b831f886a333">musb_init</a> (int <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, int *hr, int *hw)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#aa518f900dd243fca1f06fc3ca2f0974e">musb_close</a> (int fdr, int fdw)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a4637af6f79bac4043e1064f0837d0ddc">strlcpy</a> (char *dst, const char *src, size_t <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a08a3fda60543c77e368c74b10f3d9799">strlcat</a> (char *dst, const char *src, size_t <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a028834aa4ab9efe20d30184a7e4a7f1b">crc8</a> (unsigned char *<a class="el" href="odbedit_8c.html#a8c6d6f90e1d6932f65c6f43d2f9d49a7">data</a>, int len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#aecbad4f0c6c72f0f88c16c11dec81768">strieq</a> (const char *str1, const char *str2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a> (int fd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a> (int fd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a> (int fd, int signal, int <a class="el" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a6723dd6a26fb9c562657955556b67f9a">pp_rstatus</a> (int fd, int signal)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#af3238ffb136b143d8b080523c2f0cee5">pp_setdir</a> (int fd, unsigned int r)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a55a9e966b6acd75d76b6a9fb2e8e3c05">pp_wdata</a> (int fd, unsigned int <a class="el" href="odbedit_8c.html#a8c6d6f90e1d6932f65c6f43d2f9d49a7">data</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a937c66c4867e67cd9446bdd6dc9c1b22">pp_rdata</a> (int fd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a6536ba92ef823b92fdc1f68537b6b942">msend_usb</a> (int fd, void *<a class="el" href="new__fadc__old_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>, int <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#aeb75896003a6a32b0b28187e20c64d5d">mrecv_usb</a> (int fd, void *<a class="el" href="new__fadc__old_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>, int <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a> (int <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, unsigned char *<a class="el" href="mlogger_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, int len, int flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a4e1939506637fd6c20e1c0157f155ced">mscb_in1</a> (int fd, unsigned char *<a class="el" href="show__pulses_8cxx.html#a63b96401309cc0c66ce6c88f1783d7c2">c</a>, int <a class="el" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a> (int <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, char *<a class="el" href="mlogger_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, int <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, int <a class="el" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a0e5e695349a0e95873a34db09d5b6383">lpt_init</a> (char *device, int <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a42fe0df05ae6c2f64bbea26021a4d5ce">lpt_close</a> (int fd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a972b75e1f6cfc5fc3075ccdc95977de0">mscb_get_version</a> (char *lib_version, char *prot_version)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a> (int fd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a5dbc4a4a82e0e283c28418645b6116c3">mscb_init</a> (char *device, int bufsize, int <a class="el" href="mspeaker_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a39b66894ae320f9fa61f95e78dc75c3f">mscb_exit</a> (int fd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#aa23f2aa5aeb2b8ba41266b3467f32c60">mscb_cleanup</a> (int sock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a62e9002094c9f76730a338759320f371">mscb_get_device</a> (int fd, char *device, int bufsize)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a01b2447ef2852a2c7c01e52e93063b06">mscb_check</a> (char *device, int <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a> (int fd, int <a class="el" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a>, int adr, int retry, int lock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a32959634b103e904401d46c8b96ec53f">mscb_reboot</a> (int fd, int adr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#ac1aae2c6055ae4bdbb8ec9c7eeae6e2e">mscb_reset</a> (int fd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a9a9f11687252d151809f046874b3355f">mscb_ping</a> (int fd, int adr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a77c7935174bbbb756f0ecd27033e4925">mscb_info</a> (int fd, int adr, <a class="el" href="structMSCB__INFO.html">MSCB_INFO</a> *info)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#aa3f8e123ff427b0f372c5195b44f76fb">mscb_info_variable</a> (int fd, int adr, int <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="el" href="structMSCB__INFO__VAR.html">MSCB_INFO_VAR</a> *info)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a93968d67e92a88d97ea06783bc391ffa">mscb_set_addr</a> (int fd, int adr, int node, int group)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a7c4b7c89e256c181677ab43cfc3a5fd4">mscb_set_name</a> (int fd, int adr, char *name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a490b50468ada5e1bcf8749210d12888c">mscb_write_group</a> (int fd, int adr, unsigned char <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, void *<a class="el" href="odbedit_8c.html#a8c6d6f90e1d6932f65c6f43d2f9d49a7">data</a>, int <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#aa1058914021cc7101577223568c918d5">mscb_write</a> (int fd, int adr, unsigned char <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, void *<a class="el" href="odbedit_8c.html#a8c6d6f90e1d6932f65c6f43d2f9d49a7">data</a>, int <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a8e70bd17d7c75a9d5a1611632c4eaf71">mscb_write_block</a> (int fd, int adr, unsigned char <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, void *<a class="el" href="odbedit_8c.html#a8c6d6f90e1d6932f65c6f43d2f9d49a7">data</a>, int <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a4615b86801dfd9a3743851129093421d">mscb_flash</a> (int fd, int adr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a3037b604bf35bf8a5b1530ccc388e83e">mscb_upload</a> (int fd, int adr, char *<a class="el" href="mlogger_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, int <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, int <a class="el" href="mspeaker_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a69d5b26c572cc81cb271a272ce778f14">mscb_read</a> (int fd, int adr, unsigned char <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, void *<a class="el" href="odbedit_8c.html#a8c6d6f90e1d6932f65c6f43d2f9d49a7">data</a>, int *<a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a201e82083822cbb032f0e0b1eeab53a1">mscb_read_range</a> (int fd, int adr, unsigned char index1, unsigned char index2, void *<a class="el" href="odbedit_8c.html#a8c6d6f90e1d6932f65c6f43d2f9d49a7">data</a>, int *<a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a7605e8b75cb7689ba8dfcec04f59c464">mscb_user</a> (int fd, int adr, void *<a class="el" href="mana__orig_8c.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>, int <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, void *result, int *rsize)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#addc5a033bdf44635f04f2b5e972372b0">mscb_echo</a> (int fd, int adr, unsigned char d1, unsigned char *d2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#aa817cdaa652eda2c117296107a14cacc">millitime</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#ad3902f3005c1e5391f548c78c30bfa2b">mscb_link</a> (int fd, int adr, unsigned char <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, void *<a class="el" href="odbedit_8c.html#a8c6d6f90e1d6932f65c6f43d2f9d49a7">data</a>, int <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#ac1c6cabb70727474ecfd7f1e98cc193f">mscb_select_device</a> (char *device, int <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, int select)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structMSCB__FD.html">MSCB_FD</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a> [MSCB_MAX_FD]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a4112ca82bbeb36f213b9aeee78a70627">_debug_flag</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structCACHE__ENTRY.html">CACHE_ENTRY</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#aaeaf6cad3f72c74f6b0e5a08fba8a8ae">n_cache</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mscb_8c.html#a29a5bc733da811e1a7a9002c882a5b35">crc8_data</a> []</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a2bac5c4ef464fd0b474abc62f97ac8fa"></a><!-- doxytag: member="mscb.c::CACHE_PERIOD" ref="a2bac5c4ef464fd0b474abc62f97ac8fa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CACHE_PERIOD&nbsp;&nbsp;&nbsp;500</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00387">387</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l03334">mscb_link()</a>.</p>

</div>
</div>
<a class="anchor" id="abf3d598389a18a54466f7aa8ffed86fc"></a><!-- doxytag: member="mscb.c::LPT_ACK" ref="abf3d598389a18a54466f7aa8ffed86fc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="scs__300_8c.html#a5dc5637989f0d57598ea2c98922ce194">LPT_ACK</a>&nbsp;&nbsp;&nbsp;2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00320">320</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01833">mscb_check()</a>, <a class="el" href="mscb_8c_source.html#l00945">mscb_in1()</a>, <a class="el" href="mscb_8c_source.html#l00621">pp_wcontrol()</a>, <a class="el" href="scs__300_8c_source.html#l00141">putchar()</a>, and <a class="el" href="scs__300_8c_source.html#l00101">user_init()</a>.</p>

</div>
</div>
<a class="anchor" id="aafc451f66099eadd66b93da2201893b8"></a><!-- doxytag: member="mscb.c::LPT_BIT9" ref="aafc451f66099eadd66b93da2201893b8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="subm__300_8c.html#a14bbef42fa7709683afd9dd99e8228ac">LPT_BIT9</a>&nbsp;&nbsp;&nbsp;4</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00322">322</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="subm__300_8c_source.html#l00181">check_lpt()</a>, <a class="el" href="mscb_8c_source.html#l01833">mscb_check()</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00621">pp_wcontrol()</a>, and <a class="el" href="subm__300_8c_source.html#l00093">setup()</a>.</p>

</div>
</div>
<a class="anchor" id="a9e6f01a3d42fa39fe5ce37f50beea147"></a><!-- doxytag: member="mscb.c::LPT_BUSY" ref="a9e6f01a3d42fa39fe5ce37f50beea147" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="subm__300_8c.html#a525c7d69d4a55d502b0d18c0603ebf29">LPT_BUSY</a>&nbsp;&nbsp;&nbsp;6</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00325">325</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="subm__300_8c_source.html#l00181">check_lpt()</a>, <a class="el" href="scs__300_8c_source.html#l00164">getchar_nowait()</a>, <a class="el" href="mscb_8c_source.html#l01112">lpt_init()</a>, <a class="el" href="subm__300_8c_source.html#l00313">main()</a>, <a class="el" href="mscb_8c_source.html#l01833">mscb_check()</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00655">pp_rstatus()</a>, <a class="el" href="subm__300_8c_source.html#l00093">setup()</a>, and <a class="el" href="scs__300_8c_source.html#l00101">user_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a70d318d8a0062dc4b32ebb8775c53653"></a><!-- doxytag: member="mscb.c::LPT_DATAREADY" ref="a70d318d8a0062dc4b32ebb8775c53653" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LPT_DATAREADY&nbsp;&nbsp;&nbsp;7</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00326">326</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01833">mscb_check()</a>, <a class="el" href="mscb_8c_source.html#l00945">mscb_in1()</a>, and <a class="el" href="mscb_8c_source.html#l00655">pp_rstatus()</a>.</p>

</div>
</div>
<a class="anchor" id="a86391e262670a0332b41754452fbdd7b"></a><!-- doxytag: member="mscb.c::LPT_READMODE" ref="a86391e262670a0332b41754452fbdd7b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LPT_READMODE&nbsp;&nbsp;&nbsp;5</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00323">323</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l00680">pp_setdir()</a>, and <a class="el" href="mscb_8c_source.html#l00621">pp_wcontrol()</a>.</p>

</div>
</div>
<a class="anchor" id="add1804fb4ed8a17464e7c516b51ac72b"></a><!-- doxytag: member="mscb.c::LPT_RESET" ref="add1804fb4ed8a17464e7c516b51ac72b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LPT_RESET&nbsp;&nbsp;&nbsp;3</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00321">321</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01112">lpt_init()</a>, <a class="el" href="mscb_8c_source.html#l01833">mscb_check()</a>, <a class="el" href="mscb_8c_source.html#l02068">mscb_reset()</a>, and <a class="el" href="mscb_8c_source.html#l00621">pp_wcontrol()</a>.</p>

</div>
</div>
<a class="anchor" id="aa7b693ad182550b835a69b0fbd6bd2db"></a><!-- doxytag: member="mscb.c::LPT_STROBE" ref="aa7b693ad182550b835a69b0fbd6bd2db" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="scs__300_8c.html#abbb83f3515aae816313940922814a252">LPT_STROBE</a>&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00319">319</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01112">lpt_init()</a>, <a class="el" href="mscb_8c_source.html#l01833">mscb_check()</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00621">pp_wcontrol()</a>, <a class="el" href="scs__300_8c_source.html#l00141">putchar()</a>, and <a class="el" href="scs__300_8c_source.html#l00101">user_init()</a>.</p>

</div>
</div>
<a class="anchor" id="acac460e2a19e766cfb2eedc0e39084c4"></a><!-- doxytag: member="mscb.c::MSCB_LIBRARY_VERSION" ref="acac460e2a19e766cfb2eedc0e39084c4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MSCB_LIBRARY_VERSION&nbsp;&nbsp;&nbsp;&quot;1.7.5&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00236">236</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01578">mscb_get_version()</a>.</p>

</div>
</div>
<a class="anchor" id="a825db2832559242d360eb92d077081e4"></a><!-- doxytag: member="mscb.c::MSCB_PROTOCOL_VERSION" ref="a825db2832559242d360eb92d077081e4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MSCB_PROTOCOL_VERSION&nbsp;&nbsp;&nbsp;&quot;1.7&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00237">237</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01578">mscb_get_version()</a>.</p>

</div>
</div>
<a class="anchor" id="ace34d48b78d719270743b9cca5b2ab8c"></a><!-- doxytag: member="mscb.c::RS485_FLAG_BIT9" ref="ace34d48b78d719270743b9cca5b2ab8c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RS485_FLAG_BIT9&nbsp;&nbsp;&nbsp;(1&lt;&lt;0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00359">359</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

</div>
</div>
<a class="anchor" id="a23b3240a4ffbe66e078cb0e6a2aa5ba7"></a><!-- doxytag: member="mscb.c::RS485_FLAG_CMD" ref="a23b3240a4ffbe66e078cb0e6a2aa5ba7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RS485_FLAG_CMD&nbsp;&nbsp;&nbsp;(1&lt;&lt;4)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00363">363</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

</div>
</div>
<a class="anchor" id="a86c0efa95b2455cd26b8629d32bd0a36"></a><!-- doxytag: member="mscb.c::RS485_FLAG_LONG_TO" ref="a86c0efa95b2455cd26b8629d32bd0a36" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RS485_FLAG_LONG_TO&nbsp;&nbsp;&nbsp;(1&lt;&lt;3)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00362">362</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1265f1c3f2fdd44625d8392cc53d49e1"></a><!-- doxytag: member="mscb.c::RS485_FLAG_NO_ACK" ref="a1265f1c3f2fdd44625d8392cc53d49e1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RS485_FLAG_NO_ACK&nbsp;&nbsp;&nbsp;(1&lt;&lt;1)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00360">360</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

</div>
</div>
<a class="anchor" id="a91c3c417f72a54dc3458e899aecba641"></a><!-- doxytag: member="mscb.c::RS485_FLAG_SHORT_TO" ref="a91c3c417f72a54dc3458e899aecba641" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RS485_FLAG_SHORT_TO&nbsp;&nbsp;&nbsp;(1&lt;&lt;2)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00361">361</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

</div>
</div>
<a class="anchor" id="a25c6eabcf221b9af262fe35eaf2704f1"></a><!-- doxytag: member="mscb.c::TIMEOUT_OUT" ref="a25c6eabcf221b9af262fe35eaf2704f1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TIMEOUT_OUT&nbsp;&nbsp;&nbsp;1000</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00353">353</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a028834aa4ab9efe20d30184a7e4a7f1b"></a><!-- doxytag: member="mscb.c::crc8" ref="a028834aa4ab9efe20d30184a7e4a7f1b" args="(unsigned char *data, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char crc8 </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00511">511</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="mscbutil_8c_source.html#l00152">crc8_data</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, and <a class="el" href="mana_8cpp_source.html#l00677">index</a>.</p>

<p>Referenced by <a class="el" href="mscbmain_8c_source.html#l00704">interprete()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8c_source.html#l03243">mscb_echo()</a>, <a class="el" href="mscb_8c_source.html#l02626">mscb_flash()</a>, <a class="el" href="mscb_8c_source.html#l02156">mscb_info()</a>, <a class="el" href="mscb_8c_source.html#l02221">mscb_info_variable()</a>, <a class="el" href="mscb_8c_source.html#l02939">mscb_read()</a>, <a class="el" href="mscb_8c_source.html#l03060">mscb_read_range()</a>, <a class="el" href="mscb_8c_source.html#l02021">mscb_reboot()</a>, <a class="el" href="mscb_8c_source.html#l02286">mscb_set_addr()</a>, <a class="el" href="mscb_8c_source.html#l02345">mscb_set_name()</a>, <a class="el" href="mscb_8c_source.html#l02686">mscb_upload()</a>, <a class="el" href="mscb_8c_source.html#l03154">mscb_user()</a>, <a class="el" href="mscb_8c_source.html#l02461">mscb_write()</a>, <a class="el" href="mscb_8c_source.html#l02401">mscb_write_group()</a>, and <a class="el" href="mscbmain_8c_source.html#l00577">serial_int()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00514"></a>00514          : <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>
<a name="l00515"></a>00515 
<a name="l00516"></a>00516   Purpose: Calculate 8-bit cyclic redundancy checksum
<a name="l00517"></a>00517 
<a name="l00518"></a>00518   Input:
<a name="l00519"></a>00519     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>     <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l00520"></a>00520     <span class="keywordtype">int</span> len                 <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> <a class="code" href="FDCR_8h.html#a9f59b34b1f25fe00023291b678246bcc">length</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> bytes
<a name="l00521"></a>00521 
<a name="l00522"></a>00522 
<a name="l00523"></a>00523   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l00524"></a>00524     unsighend <span class="keywordtype">char</span>          CRC-8 code
<a name="l00525"></a>00525 
<a name="l00526"></a>00526 \********************************************************************/
<a name="l00527"></a>00527 {
<a name="l00528"></a>00528    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l00529"></a>00529    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> crc8_code, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>;
<a name="l00530"></a>00530 
<a name="l00531"></a>00531    crc8_code = 0;
<a name="l00532"></a>00532    <span class="keywordflow">for</span> (i = 0; i &lt; len; i++) {
<a name="l00533"></a>00533       index = <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>[i] ^ crc8_code;
<a name="l00534"></a>00534       crc8_code = <a class="code" href="mscbutil_8c.html#abf3e3406ecd519b9c4e49514602ed160">crc8_data</a>[index];
<a name="l00535"></a>00535    }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537    <span class="keywordflow">return</span> crc8_code;
<a name="l00538"></a>00538 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3f9b1b1b3b2ee5719d9ed7c7fc26638d"></a><!-- doxytag: member="mscb.c::debug_log" ref="a3f9b1b1b3b2ee5719d9ed7c7fc26638d" args="(char *format,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void debug_log </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rpc_8c_source.html#l00298">298</a> of file <a class="el" href="rpc_8c_source.html">rpc.c</a>.</p>

<p>References <a class="el" href="rpc_8c_source.html#l00118">_debug_flag</a>, and <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00259">write</a>.</p>

<p>Referenced by <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01593">mscb_init()</a>, and <a class="el" href="mscb_8c_source.html#l03334">mscb_link()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00299"></a>00299 {
<a name="l00300"></a>00300    <span class="keywordtype">int</span> fh;
<a name="l00301"></a>00301    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l00302"></a>00302    va_list argptr;
<a name="l00303"></a>00303 
<a name="l00304"></a>00304    <span class="keywordflow">if</span> (!<a class="code" href="mscb_8c.html#a4112ca82bbeb36f213b9aeee78a70627">_debug_flag</a>)
<a name="l00305"></a>00305       <span class="keywordflow">return</span>;
<a name="l00306"></a>00306 
<a name="l00307"></a>00307    va_start(argptr, <a class="code" href="webpaw_8c.html#a6113855b8e5965f1e91ee407b4026ab7">format</a>);
<a name="l00308"></a>00308    vsprintf(str, (<span class="keywordtype">char</span> *) <a class="code" href="webpaw_8c.html#a6113855b8e5965f1e91ee407b4026ab7">format</a>, argptr);
<a name="l00309"></a>00309    va_end(argptr);
<a name="l00310"></a>00310 
<a name="l00311"></a>00311    <span class="comment">/* if debug flag equals 2, write to stdout */</span>
<a name="l00312"></a>00312    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a4112ca82bbeb36f213b9aeee78a70627">_debug_flag</a> == 2)
<a name="l00313"></a>00313       <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fileno(stdout), str, strlen(str));
<a name="l00314"></a>00314    <span class="keywordflow">else</span> {
<a name="l00315"></a>00315       <span class="comment">/* else write to file */</span>
<a name="l00316"></a>00316       fh = open(<span class="stringliteral">&quot;mscb_debug.log&quot;</span>, O_CREAT | O_WRONLY | O_APPEND, 0644);
<a name="l00317"></a>00317       <span class="keywordflow">if</span> (fh &lt; 0)
<a name="l00318"></a>00318          <span class="keywordflow">return</span>;
<a name="l00319"></a>00319 
<a name="l00320"></a>00320       <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fh, str, strlen(str));
<a name="l00321"></a>00321       close(fh);
<a name="l00322"></a>00322    }
<a name="l00323"></a>00323 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a42fe0df05ae6c2f64bbea26021a4d5ce"></a><!-- doxytag: member="mscb.c::lpt_close" ref="a42fe0df05ae6c2f64bbea26021a4d5ce" args="(int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lpt_close </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l01247">1247</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="fal_8c_source.html#l00201">buffer</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, and <a class="el" href="ybos_8c_source.html#l00373">size</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l03438">mscb_select_device()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01250"></a>01250          : <a class="code" href="mscb_8c.html#a42fe0df05ae6c2f64bbea26021a4d5ce">lpt_close</a>
<a name="l01251"></a>01251 
<a name="l01252"></a>01252   Purpose: Close <a class="code" href="v1724__module_8c.html#a0e640374bff58e788b18fbed8f89fe11">handle</a> to MSCB submaster
<a name="l01253"></a>01253 
<a name="l01254"></a>01254   Input:
<a name="l01255"></a>01255     <span class="keywordtype">int</span>  <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>              Index to <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[] array
<a name="l01256"></a>01256 
<a name="l01257"></a>01257   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l01258"></a>01258     MSCB_SUCCES             Successful completion
<a name="l01259"></a>01259 
<a name="l01260"></a>01260 \********************************************************************/
<a name="l01261"></a>01261 {
<a name="l01262"></a>01262 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l01263"></a>01263 <span class="preprocessor"></span>
<a name="l01264"></a>01264    <span class="comment">/* under NT, user directio driver */</span>
<a name="l01265"></a>01265 
<a name="l01266"></a>01266    OSVERSIONINFO vi;
<a name="l01267"></a>01267    <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>[4];
<a name="l01268"></a>01268    <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l01269"></a>01269    HANDLE hdio;
<a name="l01270"></a>01270 
<a name="l01271"></a>01271    buffer[0] = 7;               <span class="comment">/* lock port */</span>
<a name="l01272"></a>01272    buffer[1] = fd;
<a name="l01273"></a>01273    buffer[2] = buffer[1] + 4;
<a name="l01274"></a>01274    buffer[3] = 0;
<a name="l01275"></a>01275 
<a name="l01276"></a>01276    vi.dwOSVersionInfoSize = <span class="keyword">sizeof</span>(OSVERSIONINFO);
<a name="l01277"></a>01277    GetVersionEx(&amp;vi);
<a name="l01278"></a>01278 
<a name="l01279"></a>01279    <span class="comment">/* use DirectIO driver under NT to gain port access */</span>
<a name="l01280"></a>01280    <span class="keywordflow">if</span> (vi.dwPlatformId == VER_PLATFORM_WIN32_NT) {
<a name="l01281"></a>01281       hdio = CreateFile(<span class="stringliteral">&quot;\\\\.\\directio&quot;</span>, GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_EXISTING, 0, NULL);
<a name="l01282"></a>01282       <span class="keywordflow">if</span> (hdio == INVALID_HANDLE_VALUE) {
<a name="l01283"></a>01283 <span class="preprocessor">#ifndef _USRDLL</span>
<a name="l01284"></a>01284 <span class="preprocessor"></span>         printf(<span class="stringliteral">&quot;mscb.c: Cannot access parallel port (No DirectIO driver installed)\n&quot;</span>);
<a name="l01285"></a>01285 <span class="preprocessor">#endif</span>
<a name="l01286"></a>01286 <span class="preprocessor"></span>         <span class="keywordflow">return</span> -1;
<a name="l01287"></a>01287       }
<a name="l01288"></a>01288 
<a name="l01289"></a>01289       <span class="keywordflow">if</span> (!DeviceIoControl(hdio, (<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>) 0x9c406000, &amp;buffer, <span class="keyword">sizeof</span>(buffer), NULL, 0, &amp;size, NULL))
<a name="l01290"></a>01290          <span class="keywordflow">return</span> -1;
<a name="l01291"></a>01291    }
<a name="l01292"></a>01292 <span class="preprocessor">#elif defined(OS_LINUX)</span>
<a name="l01293"></a>01293 <span class="preprocessor"></span>
<a name="l01294"></a>01294    close(fd);
<a name="l01295"></a>01295 
<a name="l01296"></a>01296 <span class="preprocessor">#endif</span>
<a name="l01297"></a>01297 <span class="preprocessor"></span>
<a name="l01298"></a>01298    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l01299"></a>01299 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0e5e695349a0e95873a34db09d5b6383"></a><!-- doxytag: member="mscb.c::lpt_init" ref="a0e5e695349a0e95873a34db09d5b6383" args="(char *device, int index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lpt_init </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l01112">1112</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="fal_8c_source.html#l00201">buffer</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00003">c</a>, <a class="el" href="mscb_8h_source.html#l00270">MSCB_FD::fd</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mscb_8c_source.html#l00325">LPT_BUSY</a>, <a class="el" href="mscb_8c_source.html#l00321">LPT_RESET</a>, <a class="el" href="mscb_8c_source.html#l00319">LPT_STROBE</a>, <a class="el" href="mscb_8c_source.html#l00945">mscb_in1()</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8c_source.html#l00655">pp_rstatus()</a>, <a class="el" href="mscb_8c_source.html#l00680">pp_setdir()</a>, <a class="el" href="mscb_8c_source.html#l00621">pp_wcontrol()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, and <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01593">mscb_init()</a>, and <a class="el" href="mscb_8c_source.html#l03438">mscb_select_device()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01115"></a>01115          : <a class="code" href="mscb_8c.html#a0e5e695349a0e95873a34db09d5b6383">lpt_init</a>
<a name="l01116"></a>01116 
<a name="l01117"></a>01117   Purpose: Initialize MSCB submaster on parallel port
<a name="l01118"></a>01118 
<a name="l01119"></a>01119   Input:
<a name="l01120"></a>01120     <span class="keywordtype">char</span> *device            Device <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a> <span class="stringliteral">&quot;lptx&quot;</span>/<span class="stringliteral">&quot;/dev/parportx&quot;</span>
<a name="l01121"></a>01121     <span class="keywordtype">int</span>  <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>              Index to <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[] array
<a name="l01122"></a>01122 
<a name="l01123"></a>01123   Output:
<a name="l01124"></a>01124     <span class="keywordtype">int</span>  <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structMSCB__FD.html#a08d909ba4fdeb086625d14289310c788">fd</a>  File descriptor <span class="keywordflow">for</span> device <a class="code" href="examples_2macro_2midas__macro_8h.html#a339a611d7f9dc3a59c359f0da7beaf3c">or</a>
<a name="l01125"></a>01125                             DirectIO <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l01126"></a>01126   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l01127"></a>01127     0                       Successful completion
<a name="l01128"></a>01128     -1                      Invalid <a class="code" href="HITS_8h.html#a4f188184523d527be63ee6079f182f17">parameter</a> <a class="code" href="examples_2macro_2midas__macro_8h.html#a339a611d7f9dc3a59c359f0da7beaf3c">or</a> other error
<a name="l01129"></a>01129     -2                      Submaster does not respond
<a name="l01130"></a>01130     -3                      No DirectIO <a class="code" href="examples_2macro_2midas__macro_8h.html#a612199f8c1c02dff06a91020903b66c1">driver</a>
<a name="l01131"></a>01131     -4                      MSCB system locked <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> other user
<a name="l01132"></a>01132 
<a name="l01133"></a>01133 \********************************************************************/
<a name="l01134"></a>01134 {
<a name="l01135"></a>01135    <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l01136"></a>01136    <span class="keywordtype">char</span> <a class="code" href="patch__mevb_8cpp.html#adce6024c3a1b29c5fcede88815f9b152">c</a>;
<a name="l01137"></a>01137 
<a name="l01138"></a>01138 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l01139"></a>01139 <span class="preprocessor"></span>
<a name="l01140"></a>01140    <span class="comment">/* under NT, user directio driver */</span>
<a name="l01141"></a>01141 
<a name="l01142"></a>01142    OSVERSIONINFO vi;
<a name="l01143"></a>01143    <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>[4];
<a name="l01144"></a>01144    <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l01145"></a>01145    HANDLE hdio;
<a name="l01146"></a>01146 
<a name="l01147"></a>01147 
<a name="l01148"></a>01148    <span class="comment">/* derive base address from device name */</span>
<a name="l01149"></a>01149    <span class="keywordflow">if</span> (atoi(device + 3) == 1)
<a name="l01150"></a>01150       <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structMSCB__FD.html#a08d909ba4fdeb086625d14289310c788">fd</a> = 0x378;
<a name="l01151"></a>01151    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (atoi(device + 3) == 2)
<a name="l01152"></a>01152       <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structMSCB__FD.html#a08d909ba4fdeb086625d14289310c788">fd</a> = 0x278;
<a name="l01153"></a>01153    <span class="keywordflow">else</span>
<a name="l01154"></a>01154       <span class="keywordflow">return</span> -1;
<a name="l01155"></a>01155 
<a name="l01156"></a>01156    buffer[0] = 6;               <span class="comment">/* give IO */</span>
<a name="l01157"></a>01157    buffer[1] = <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structMSCB__FD.html#a08d909ba4fdeb086625d14289310c788">fd</a>;
<a name="l01158"></a>01158    buffer[2] = buffer[1] + 4;
<a name="l01159"></a>01159    buffer[3] = 0;
<a name="l01160"></a>01160 
<a name="l01161"></a>01161    vi.dwOSVersionInfoSize = <span class="keyword">sizeof</span>(OSVERSIONINFO);
<a name="l01162"></a>01162    GetVersionEx(&amp;vi);
<a name="l01163"></a>01163 
<a name="l01164"></a>01164    <span class="comment">/* use DirectIO driver under NT to gain port access */</span>
<a name="l01165"></a>01165    <span class="keywordflow">if</span> (vi.dwPlatformId == VER_PLATFORM_WIN32_NT) {
<a name="l01166"></a>01166       hdio = CreateFile(<span class="stringliteral">&quot;\\\\.\\directio&quot;</span>, GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_EXISTING, 0, NULL);
<a name="l01167"></a>01167       <span class="keywordflow">if</span> (hdio == INVALID_HANDLE_VALUE) {
<a name="l01168"></a>01168          <span class="comment">//printf(&quot;mscb.c: Cannot access parallel port (No DirectIO driver installed)\n&quot;);</span>
<a name="l01169"></a>01169          <span class="keywordflow">return</span> -3;
<a name="l01170"></a>01170       }
<a name="l01171"></a>01171 
<a name="l01172"></a>01172       <span class="keywordflow">if</span> (!DeviceIoControl(hdio, (<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>) 0x9c406000, &amp;buffer, <span class="keyword">sizeof</span>(buffer), NULL, 0, &amp;size, NULL))
<a name="l01173"></a>01173          <span class="keywordflow">return</span> -1;
<a name="l01174"></a>01174    }
<a name="l01175"></a>01175 <span class="preprocessor">#elif defined(OS_LINUX)</span>
<a name="l01176"></a>01176 <span class="preprocessor"></span>
<a name="l01177"></a>01177    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l01178"></a>01178 
<a name="l01179"></a>01179    <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structMSCB__FD.html#a08d909ba4fdeb086625d14289310c788">fd</a> = open(device, O_RDWR);
<a name="l01180"></a>01180    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].fd &lt; 0) {
<a name="l01181"></a>01181 <span class="preprocessor">#ifndef _USRDLL</span>
<a name="l01182"></a>01182 <span class="preprocessor"></span>      perror(<span class="stringliteral">&quot;open&quot;</span>);
<a name="l01183"></a>01183       printf(<span class="stringliteral">&quot;Please make sure that device \&quot;%s\&quot; is world readable/writable\n&quot;</span>, device);
<a name="l01184"></a>01184 <span class="preprocessor">#endif</span>
<a name="l01185"></a>01185 <span class="preprocessor"></span>      <span class="keywordflow">return</span> -1;
<a name="l01186"></a>01186    }
<a name="l01187"></a>01187 
<a name="l01188"></a>01188    <span class="keywordflow">if</span> (ioctl(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].fd, PPCLAIM)) {
<a name="l01189"></a>01189 <span class="preprocessor">#ifndef _USRDLL</span>
<a name="l01190"></a>01190 <span class="preprocessor"></span>      perror(<span class="stringliteral">&quot;PPCLAIM&quot;</span>);
<a name="l01191"></a>01191       printf(<span class="stringliteral">&quot;Please load driver via \&quot;modprobe parport_pc\&quot; as root\n&quot;</span>);
<a name="l01192"></a>01192 <span class="preprocessor">#endif</span>
<a name="l01193"></a>01193 <span class="preprocessor"></span>      <span class="keywordflow">return</span> -1;
<a name="l01194"></a>01194    }
<a name="l01195"></a>01195 
<a name="l01196"></a>01196    <span class="keywordflow">if</span> (ioctl(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].fd, PPRELEASE)) {
<a name="l01197"></a>01197 <span class="preprocessor">#ifndef _USRDLL</span>
<a name="l01198"></a>01198 <span class="preprocessor"></span>      perror(<span class="stringliteral">&quot;PPRELEASE&quot;</span>);
<a name="l01199"></a>01199 <span class="preprocessor">#endif</span>
<a name="l01200"></a>01200 <span class="preprocessor"></span>      <span class="keywordflow">return</span> -1;
<a name="l01201"></a>01201    }
<a name="l01202"></a>01202 
<a name="l01203"></a>01203    i = IEEE1284_MODE_BYTE;
<a name="l01204"></a>01204    <span class="keywordflow">if</span> (ioctl(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].fd, PPSETMODE, &amp;i)) {
<a name="l01205"></a>01205 <span class="preprocessor">#ifndef _USRDLL</span>
<a name="l01206"></a>01206 <span class="preprocessor"></span>      perror(<span class="stringliteral">&quot;PPSETMODE&quot;</span>);
<a name="l01207"></a>01207 <span class="preprocessor">#endif</span>
<a name="l01208"></a>01208 <span class="preprocessor"></span>      <span class="keywordflow">return</span> -1;
<a name="l01209"></a>01209    }
<a name="l01210"></a>01210 <span class="preprocessor">#endif</span>
<a name="l01211"></a>01211 <span class="preprocessor"></span>
<a name="l01212"></a>01212    status = <a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> + 1);
<a name="l01213"></a>01213    <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l01214"></a>01214       <span class="keywordflow">return</span> -4;
<a name="l01215"></a>01215 
<a name="l01216"></a>01216    <span class="comment">/* set initial state of handshake lines */</span>
<a name="l01217"></a>01217    <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> + 1, <a class="code" href="mscb_8c.html#add1804fb4ed8a17464e7c516b51ac72b">LPT_RESET</a>, 0);
<a name="l01218"></a>01218    <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> + 1, <a class="code" href="mscb_8c.html#aa7b693ad182550b835a69b0fbd6bd2db">LPT_STROBE</a>, 0);
<a name="l01219"></a>01219 
<a name="l01220"></a>01220    <span class="comment">/* switch to output mode */</span>
<a name="l01221"></a>01221    <a class="code" href="mscb_8c.html#af3238ffb136b143d8b080523c2f0cee5">pp_setdir</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> + 1, 0);
<a name="l01222"></a>01222 
<a name="l01223"></a>01223    <span class="comment">/* wait for submaster irritated by a stuck LPT_STROBE */</span>
<a name="l01224"></a>01224    Sleep(100);
<a name="l01225"></a>01225 
<a name="l01226"></a>01226    <span class="comment">/* check if SM alive */</span>
<a name="l01227"></a>01227    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a6723dd6a26fb9c562657955556b67f9a">pp_rstatus</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> + 1, <a class="code" href="mscb_8c.html#a9e6f01a3d42fa39fe5ce37f50beea147">LPT_BUSY</a>)) {
<a name="l01228"></a>01228       <span class="comment">//printf(&quot;mscb.c: No SM present on parallel port\n&quot;);</span>
<a name="l01229"></a>01229       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> + 1);
<a name="l01230"></a>01230       <span class="keywordflow">return</span> -2;
<a name="l01231"></a>01231    }
<a name="l01232"></a>01232 
<a name="l01233"></a>01233    <span class="comment">/* empty RBuffer of SM */</span>
<a name="l01234"></a>01234    <span class="keywordflow">do</span> {
<a name="l01235"></a>01235       status = <a class="code" href="mscb_8c.html#a4e1939506637fd6c20e1c0157f155ced">mscb_in1</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> + 1, &amp;c, 1000);
<a name="l01236"></a>01236       <span class="keywordflow">if</span> (status == <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l01237"></a>01237          printf(<span class="stringliteral">&quot;%02X &quot;</span>, c);
<a name="l01238"></a>01238    } <span class="keywordflow">while</span> (status == <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>);
<a name="l01239"></a>01239 
<a name="l01240"></a>01240    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> + 1);
<a name="l01241"></a>01241 
<a name="l01242"></a>01242    <span class="keywordflow">return</span> 0;
<a name="l01243"></a>01243 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa817cdaa652eda2c117296107a14cacc"></a><!-- doxytag: member="mscb.c::millitime" ref="aa817cdaa652eda2c117296107a14cacc" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long millitime </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l03317">3317</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l03334">mscb_link()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03318"></a>03318 {
<a name="l03319"></a>03319 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l03320"></a>03320 <span class="preprocessor"></span>   <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) GetTickCount();
<a name="l03321"></a>03321 <span class="preprocessor">#else</span>
<a name="l03322"></a>03322 <span class="preprocessor"></span>   {
<a name="l03323"></a>03323       <span class="keyword">struct </span>timeval tv;
<a name="l03324"></a>03324 
<a name="l03325"></a>03325       gettimeofday(&amp;tv, NULL);
<a name="l03326"></a>03326 
<a name="l03327"></a>03327       <span class="keywordflow">return</span> tv.tv_sec * 1000 + tv.tv_usec / 1000;
<a name="l03328"></a>03328    }
<a name="l03329"></a>03329 <span class="preprocessor">#endif</span>
<a name="l03330"></a>03330 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="aeb75896003a6a32b0b28187e20c64d5d"></a><!-- doxytag: member="mscb.c::mrecv_usb" ref="aeb75896003a6a32b0b28187e20c64d5d" args="(int fd, void *buf, int size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mrecv_usb </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00747">747</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="vmedrv_8c_source.html#l00245">dev</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, and <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01027">mscb_in()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00748"></a>00748 {
<a name="l00749"></a>00749    <span class="keywordtype">int</span> n_read;
<a name="l00750"></a>00750 
<a name="l00751"></a>00751 <span class="preprocessor">#if defined(_MSC_VER)</span>
<a name="l00752"></a>00752 <span class="preprocessor"></span>   OVERLAPPED overlapped;
<a name="l00753"></a>00753    <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l00754"></a>00754 
<a name="l00755"></a>00755    memset(&amp;overlapped, 0, <span class="keyword">sizeof</span>(overlapped));
<a name="l00756"></a>00756    overlapped.hEvent = CreateEvent(NULL, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, NULL);
<a name="l00757"></a>00757    n_read = 0;
<a name="l00758"></a>00758 
<a name="l00759"></a>00759    status = ReadFile((HANDLE) fd, <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, &amp;n_read, &amp;overlapped);
<a name="l00760"></a>00760    <span class="keywordflow">if</span> (!status) {
<a name="l00761"></a>00761 
<a name="l00762"></a>00762       status = GetLastError();
<a name="l00763"></a>00763       <span class="keywordflow">if</span> (status != ERROR_IO_PENDING)
<a name="l00764"></a>00764          <span class="keywordflow">return</span> 0;
<a name="l00765"></a>00765 
<a name="l00766"></a>00766       <span class="comment">/* wait for completion, 1s timeout */</span>
<a name="l00767"></a>00767       status = WaitForSingleObject(overlapped.hEvent, 1000);
<a name="l00768"></a>00768       <span class="keywordflow">if</span> (status == WAIT_TIMEOUT)
<a name="l00769"></a>00769          CancelIo((HANDLE) fd);
<a name="l00770"></a>00770       <span class="keywordflow">else</span>
<a name="l00771"></a>00771          GetOverlappedResult((HANDLE) fd, &amp;overlapped, &amp;n_read, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00772"></a>00772    }
<a name="l00773"></a>00773 
<a name="l00774"></a>00774    CloseHandle(overlapped.hEvent);
<a name="l00775"></a>00775 <span class="preprocessor">#elif defined(HAVE_LIBUSB)</span>
<a name="l00776"></a>00776 <span class="preprocessor"></span>   usb_dev_handle *<a class="code" href="vmedrv_8c.html#a8910285a0352a5c710e65ec9ecbe32a1">dev</a>;
<a name="l00777"></a>00777    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l00778"></a>00778 
<a name="l00779"></a>00779    dev = (usb_dev_handle *) fd;
<a name="l00780"></a>00780 
<a name="l00781"></a>00781    <span class="keywordflow">for</span> (i = 0; i &lt; 10; i++) {
<a name="l00782"></a>00782       n_read = usb_bulk_read(dev, 1, <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, 1000);
<a name="l00783"></a>00783       <span class="comment">//printf(&quot;##mrecv_usb(%X): %d\n&quot;, dev, n_read);</span>
<a name="l00784"></a>00784 
<a name="l00785"></a>00785       <span class="keywordflow">if</span> (n_read &lt; 0)
<a name="l00786"></a>00786          usleep(10000);
<a name="l00787"></a>00787       <span class="keywordflow">else</span>
<a name="l00788"></a>00788          <span class="keywordflow">break</span>;
<a name="l00789"></a>00789    }
<a name="l00790"></a>00790 <span class="preprocessor">#elif defined(OS_DARWIN)</span>
<a name="l00791"></a>00791 <span class="preprocessor"></span>   IOReturn status;
<a name="l00792"></a>00792    IOUSBInterfaceInterface** device = (IOUSBInterfaceInterface**)fd;
<a name="l00793"></a>00793    n_read = <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l00794"></a>00794    status = (*device)-&gt;ReadPipe(device,1,<a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>,&amp;n_read);
<a name="l00795"></a>00795    <span class="keywordflow">if</span> (status != kIOReturnSuccess) {
<a name="l00796"></a>00796       printf(<span class="stringliteral">&quot;mrecv_usb: size %d, read %d, ReadPipe() status %d 0x%x\n&quot;</span>,<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>,n_read,status,status);
<a name="l00797"></a>00797       <span class="keywordflow">return</span> -1;
<a name="l00798"></a>00798    }
<a name="l00799"></a>00799 <span class="preprocessor">#endif</span>
<a name="l00800"></a>00800 <span class="preprocessor"></span>   <span class="keywordflow">return</span> n_read;
<a name="l00801"></a>00801 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0cbd83332d5f06ae34a67a4bf83a75a9"></a><!-- doxytag: member="mscb.c::mrpc_connected" ref="a0cbd83332d5f06ae34a67a4bf83a75a9" args="(int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mrpc_connected </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l01586">1586</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="mscb_8h_source.html#l00265">MSCB_TYPE_RPC</a>, and <a class="el" href="mscb_8h_source.html#l00269">MSCB_FD::type</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8c_source.html#l03243">mscb_echo()</a>, <a class="el" href="mscb_8c_source.html#l01750">mscb_exit()</a>, <a class="el" href="mscb_8c_source.html#l02626">mscb_flash()</a>, <a class="el" href="mscb_8c_source.html#l01800">mscb_get_device()</a>, <a class="el" href="mscb_8c_source.html#l02156">mscb_info()</a>, <a class="el" href="mscb_8c_source.html#l02221">mscb_info_variable()</a>, <a class="el" href="mscb_8c_source.html#l02116">mscb_ping()</a>, <a class="el" href="mscb_8c_source.html#l02939">mscb_read()</a>, <a class="el" href="mscb_8c_source.html#l03060">mscb_read_range()</a>, <a class="el" href="mscb_8c_source.html#l02021">mscb_reboot()</a>, <a class="el" href="mscb_8c_source.html#l02068">mscb_reset()</a>, <a class="el" href="mscb_8c_source.html#l02286">mscb_set_addr()</a>, <a class="el" href="mscb_8c_source.html#l02345">mscb_set_name()</a>, <a class="el" href="mscb_8c_source.html#l02686">mscb_upload()</a>, <a class="el" href="mscb_8c_source.html#l03154">mscb_user()</a>, <a class="el" href="mscb_8c_source.html#l02461">mscb_write()</a>, <a class="el" href="mscb_8c_source.html#l02549">mscb_write_block()</a>, and <a class="el" href="mscb_8c_source.html#l02401">mscb_write_group()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01587"></a>01587 {
<a name="l01588"></a>01588    <span class="keywordflow">return</span> <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="structMSCB__FD.html#ae427fc239f83f01f7a3d8a128cb9b2a3">type</a> == <a class="code" href="mscb_8h.html#a307b4900ff0e3f1ee6d0f7d97f68f45e">MSCB_TYPE_RPC</a>;
<a name="l01589"></a>01589 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af52e5d2a32748856cc0490ae3e905ea5"></a><!-- doxytag: member="mscb.c::mscb_addr" ref="af52e5d2a32748856cc0490ae3e905ea5" args="(int fd, int cmd, int adr, int retry, int lock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_addr </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>retry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>lock</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l01909">1909</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="mscbutil_8c_source.html#l00187">crc8()</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="subm__250_8c_source.html#l00074">MCMD_ACK</a>, <a class="el" href="subm__250_8c_source.html#l00056">MCMD_ADDR_GRP16</a>, <a class="el" href="subm__250_8c_source.html#l00055">MCMD_ADDR_GRP8</a>, <a class="el" href="subm__250_8c_source.html#l00053">MCMD_ADDR_NODE16</a>, <a class="el" href="subm__250_8c_source.html#l00052">MCMD_ADDR_NODE8</a>, <a class="el" href="subm__250_8c_source.html#l00058">MCMD_PING16</a>, <a class="el" href="subm__250_8c_source.html#l00057">MCMD_PING8</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8c_source.html#l01027">mscb_in()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8h_source.html#l00286">MSCB_SUBM_ERROR</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00281">MSCB_TIMEOUT</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="rpc_8h_source.html#l00160">RPC_MSCB_ADDR</a>, <a class="el" href="subm__250_8c_source.html#l00091">RS485_FLAG_BIT9</a>, <a class="el" href="subm__250_8c_source.html#l00092">RS485_FLAG_NO_ACK</a>, <a class="el" href="subm__250_8c_source.html#l00093">RS485_FLAG_SHORT_TO</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>, <a class="el" href="mscb_8c_source.html#l03243">mscb_echo()</a>, <a class="el" href="mscb_8c_source.html#l02626">mscb_flash()</a>, <a class="el" href="mscb_8c_source.html#l02156">mscb_info()</a>, <a class="el" href="mscb_8c_source.html#l02221">mscb_info_variable()</a>, <a class="el" href="mscb_8c_source.html#l02116">mscb_ping()</a>, <a class="el" href="mscb_8c_source.html#l02939">mscb_read()</a>, <a class="el" href="mscb_8c_source.html#l03060">mscb_read_range()</a>, <a class="el" href="mscb_8c_source.html#l02021">mscb_reboot()</a>, <a class="el" href="mscb_8c_source.html#l02286">mscb_set_addr()</a>, <a class="el" href="mscb_8c_source.html#l02345">mscb_set_name()</a>, <a class="el" href="mscb_8c_source.html#l02686">mscb_upload()</a>, <a class="el" href="mscb_8c_source.html#l03154">mscb_user()</a>, <a class="el" href="mscb_8c_source.html#l02461">mscb_write()</a>, <a class="el" href="mscb_8c_source.html#l02549">mscb_write_block()</a>, <a class="el" href="mscb_8c_source.html#l02401">mscb_write_group()</a>, and <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01912"></a>01912          : <a class="code" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a>
<a name="l01913"></a>01913 
<a name="l01914"></a>01914   Purpose: Address node <a class="code" href="examples_2macro_2midas__macro_8h.html#a339a611d7f9dc3a59c359f0da7beaf3c">or</a> nodes, only used internall from <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a> <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a>
<a name="l01915"></a>01915            <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a> routines. A MSCB lock has to be obtained outside
<a name="l01916"></a>01916            of <span class="keyword">this</span> routine!
<a name="l01917"></a>01917 
<a name="l01918"></a>01918   Input:
<a name="l01919"></a>01919     <span class="keywordtype">int</span> fd                  File descriptor <span class="keywordflow">for</span> connection
<a name="l01920"></a>01920     <span class="keywordtype">int</span> <a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a>                 Addressing <a class="code" href="mscbutil_8c.html#a74b654271a172a244c844fb86277cd8a">mode</a>, one of
<a name="l01921"></a>01921                               <a class="code" href="subm__250_8c.html#af90a3fd5d28cbd6bfc34a1b5cf1dc868">MCMD_ADDR_BC</a>
<a name="l01922"></a>01922                               <a class="code" href="subm__250_8c.html#abb5dae5df07d866f46ced4405a10db38">MCMD_ADDR_NODE8</a>
<a name="l01923"></a>01923                               <a class="code" href="subm__250_8c.html#a5db4886a7e067af1dcac6eb1f97d52aa">MCMD_ADDR_GRP8</a>
<a name="l01924"></a>01924                               <a class="code" href="subm__250_8c.html#aa3e2f887240d82460e92fbd076014bf1">MCMD_PING8</a>
<a name="l01925"></a>01925                               <a class="code" href="subm__250_8c.html#a9dedc2dcad7c085e159d8f3fbca98c19">MCMD_ADDR_NODE16</a>
<a name="l01926"></a>01926                               <a class="code" href="subm__250_8c.html#aa06f6457d8f01d5edcfd640bc6c51d09">MCMD_ADDR_GRP16</a>
<a name="l01927"></a>01927                               <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>
<a name="l01928"></a>01928 
<a name="l01929"></a>01929     <span class="keywordtype">int</span> adr                 Node <a class="code" href="examples_2macro_2midas__macro_8h.html#a339a611d7f9dc3a59c359f0da7beaf3c">or</a> group <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l01930"></a>01930     <span class="keywordtype">int</span> retry               Number of retries
<a name="l01931"></a>01931     <span class="keywordtype">int</span> lock                Lock MSCB <span class="keywordflow">if</span> <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>
<a name="l01932"></a>01932 
<a name="l01933"></a>01933   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l01934"></a>01934     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l01935"></a>01935     <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>            Timeout receiving ping acknowledge
<a name="l01936"></a>01936     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l01937"></a>01937 
<a name="l01938"></a>01938 \********************************************************************/
<a name="l01939"></a>01939 {
<a name="l01940"></a>01940    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[10];
<a name="l01941"></a>01941    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l01942"></a>01942 
<a name="l01943"></a>01943    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l01944"></a>01944       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l01945"></a>01945 
<a name="l01946"></a>01946    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd))
<a name="l01947"></a>01947       <span class="keywordflow">return</span> <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#a7f91a1c6d4d6d7f6b685bafb7d537329">RPC_MSCB_ADDR</a>, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd, <a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a>, adr, retry, lock);
<a name="l01948"></a>01948 
<a name="l01949"></a>01949    <span class="keywordflow">if</span> (lock) {
<a name="l01950"></a>01950       <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd) != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l01951"></a>01951          <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>;
<a name="l01952"></a>01952    }
<a name="l01953"></a>01953 
<a name="l01954"></a>01954    <span class="keywordflow">for</span> (n = 0; n &lt; retry; n++) {
<a name="l01955"></a>01955       buf[0] = <a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a>;
<a name="l01956"></a>01956 
<a name="l01957"></a>01957       <span class="keywordflow">if</span> (<a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a> == <a class="code" href="subm__250_8c.html#abb5dae5df07d866f46ced4405a10db38">MCMD_ADDR_NODE8</a> || <a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a> == <a class="code" href="subm__250_8c.html#a5db4886a7e067af1dcac6eb1f97d52aa">MCMD_ADDR_GRP8</a>) {
<a name="l01958"></a>01958          buf[1] = (<span class="keywordtype">unsigned</span> char) adr;
<a name="l01959"></a>01959          buf[2] = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 2);
<a name="l01960"></a>01960          status = <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 3, <a class="code" href="subm__250_8c.html#ace34d48b78d719270743b9cca5b2ab8c">RS485_FLAG_BIT9</a> | <a class="code" href="subm__250_8c.html#a91c3c417f72a54dc3458e899aecba641">RS485_FLAG_SHORT_TO</a> | <a class="code" href="subm__250_8c.html#a1265f1c3f2fdd44625d8392cc53d49e1">RS485_FLAG_NO_ACK</a>);
<a name="l01961"></a>01961       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a> == <a class="code" href="subm__250_8c.html#aa3e2f887240d82460e92fbd076014bf1">MCMD_PING8</a>) {
<a name="l01962"></a>01962          buf[1] = (<span class="keywordtype">unsigned</span> char) adr;
<a name="l01963"></a>01963          buf[2] = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 2);
<a name="l01964"></a>01964          status = <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 3, <a class="code" href="subm__250_8c.html#ace34d48b78d719270743b9cca5b2ab8c">RS485_FLAG_BIT9</a> | <a class="code" href="subm__250_8c.html#a91c3c417f72a54dc3458e899aecba641">RS485_FLAG_SHORT_TO</a>);
<a name="l01965"></a>01965       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a> == <a class="code" href="subm__250_8c.html#a9dedc2dcad7c085e159d8f3fbca98c19">MCMD_ADDR_NODE16</a> || <a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a> == <a class="code" href="subm__250_8c.html#aa06f6457d8f01d5edcfd640bc6c51d09">MCMD_ADDR_GRP16</a>) {
<a name="l01966"></a>01966          buf[1] = (<span class="keywordtype">unsigned</span> char) (adr &gt;&gt; 8);
<a name="l01967"></a>01967          buf[2] = (<span class="keywordtype">unsigned</span> char) (adr &amp; 0xFF);
<a name="l01968"></a>01968          buf[3] = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 3);
<a name="l01969"></a>01969          status = <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 4, <a class="code" href="subm__250_8c.html#ace34d48b78d719270743b9cca5b2ab8c">RS485_FLAG_BIT9</a> | <a class="code" href="subm__250_8c.html#a91c3c417f72a54dc3458e899aecba641">RS485_FLAG_SHORT_TO</a> | <a class="code" href="subm__250_8c.html#a1265f1c3f2fdd44625d8392cc53d49e1">RS485_FLAG_NO_ACK</a>);
<a name="l01970"></a>01970       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a> == <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>) {
<a name="l01971"></a>01971          buf[1] = (<span class="keywordtype">unsigned</span> char) (adr &gt;&gt; 8);
<a name="l01972"></a>01972          buf[2] = (<span class="keywordtype">unsigned</span> char) (adr &amp; 0xFF);
<a name="l01973"></a>01973          buf[3] = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 3);
<a name="l01974"></a>01974          status = <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 4, <a class="code" href="subm__250_8c.html#ace34d48b78d719270743b9cca5b2ab8c">RS485_FLAG_BIT9</a> | <a class="code" href="subm__250_8c.html#a91c3c417f72a54dc3458e899aecba641">RS485_FLAG_SHORT_TO</a>);
<a name="l01975"></a>01975       } <span class="keywordflow">else</span> {
<a name="l01976"></a>01976          buf[1] = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 1);
<a name="l01977"></a>01977          status = <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 2, <a class="code" href="subm__250_8c.html#ace34d48b78d719270743b9cca5b2ab8c">RS485_FLAG_BIT9</a> | <a class="code" href="subm__250_8c.html#a91c3c417f72a54dc3458e899aecba641">RS485_FLAG_SHORT_TO</a> | <a class="code" href="subm__250_8c.html#a1265f1c3f2fdd44625d8392cc53d49e1">RS485_FLAG_NO_ACK</a>);
<a name="l01978"></a>01978       }
<a name="l01979"></a>01979 
<a name="l01980"></a>01980       <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l01981"></a>01981          <span class="keywordflow">if</span> (lock)
<a name="l01982"></a>01982             <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l01983"></a>01983          <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#ac242f26c3c4503505ff91ba2bd3cf036">MSCB_SUBM_ERROR</a>;
<a name="l01984"></a>01984       }
<a name="l01985"></a>01985 
<a name="l01986"></a>01986       <span class="keywordflow">if</span> (<a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a> == <a class="code" href="subm__250_8c.html#aa3e2f887240d82460e92fbd076014bf1">MCMD_PING8</a> || <a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a> == <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>) {
<a name="l01987"></a>01987          <span class="comment">/* read back ping reply, 4ms timeout (for USB!) */</span>
<a name="l01988"></a>01988          i = <a class="code" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a>(fd, buf, 1, 4000);
<a name="l01989"></a>01989 
<a name="l01990"></a>01990          <span class="keywordflow">if</span> (i == <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a> &amp;&amp; buf[0] == <a class="code" href="subm__250_8c.html#a796320244ecb94c4814f6d480f55e0be">MCMD_ACK</a>) {
<a name="l01991"></a>01991             <span class="keywordflow">if</span> (lock)
<a name="l01992"></a>01992                <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l01993"></a>01993             <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l01994"></a>01994          }
<a name="l01995"></a>01995 
<a name="l01996"></a>01996          <span class="keywordflow">if</span> (retry &gt; 1) {
<a name="l01997"></a>01997             <span class="comment">/* send 0&apos;s to overflow partially filled node receive buffer */</span>
<a name="l01998"></a>01998             memset(buf, 0, <span class="keyword">sizeof</span>(buf));
<a name="l01999"></a>01999             <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 10, <a class="code" href="subm__250_8c.html#ace34d48b78d719270743b9cca5b2ab8c">RS485_FLAG_BIT9</a> | <a class="code" href="subm__250_8c.html#a1265f1c3f2fdd44625d8392cc53d49e1">RS485_FLAG_NO_ACK</a>);
<a name="l02000"></a>02000 
<a name="l02001"></a>02001             <span class="comment">/* wait some time */</span>
<a name="l02002"></a>02002             Sleep(10);
<a name="l02003"></a>02003          }
<a name="l02004"></a>02004 
<a name="l02005"></a>02005          <span class="comment">/* try again.... */</span>
<a name="l02006"></a>02006       } <span class="keywordflow">else</span> {
<a name="l02007"></a>02007          <span class="keywordflow">if</span> (lock)
<a name="l02008"></a>02008             <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02009"></a>02009          <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l02010"></a>02010       }
<a name="l02011"></a>02011    }
<a name="l02012"></a>02012 
<a name="l02013"></a>02013    <span class="keywordflow">if</span> (lock)
<a name="l02014"></a>02014       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02015"></a>02015 
<a name="l02016"></a>02016    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l02017"></a>02017 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a01b2447ef2852a2c7c01e52e93063b06"></a><!-- doxytag: member="mscb.c::mscb_check" ref="a01b2447ef2852a2c7c01e52e93063b06" args="(char *device, int size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mscb_check </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l01833">1833</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="system_8c_source.html#l00966">d</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mscb_8c_source.html#l00320">LPT_ACK</a>, <a class="el" href="mscb_8c_source.html#l00322">LPT_BIT9</a>, <a class="el" href="mscb_8c_source.html#l00325">LPT_BUSY</a>, <a class="el" href="mscb_8c_source.html#l00326">LPT_DATAREADY</a>, <a class="el" href="mscb_8c_source.html#l00321">LPT_RESET</a>, <a class="el" href="mscb_8c_source.html#l00319">LPT_STROBE</a>, <a class="el" href="mscb_8c_source.html#l01593">mscb_init()</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8c_source.html#l00709">pp_rdata()</a>, <a class="el" href="mscb_8c_source.html#l00655">pp_rstatus()</a>, <a class="el" href="mscb_8c_source.html#l00621">pp_wcontrol()</a>, and <a class="el" href="mscb_8c_source.html#l00695">pp_wdata()</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l01246">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01836"></a>01836          : <a class="code" href="mscb_8c.html#a01b2447ef2852a2c7c01e52e93063b06">mscb_check</a>
<a name="l01837"></a>01837 
<a name="l01838"></a>01838   Purpose: Check IO pins of port
<a name="l01839"></a>01839 
<a name="l01840"></a>01840   Input:
<a name="l01841"></a>01841     <span class="keywordtype">char</span> *device            Under NT: lpt1 <a class="code" href="examples_2macro_2midas__macro_8h.html#a339a611d7f9dc3a59c359f0da7beaf3c">or</a> lpt2
<a name="l01842"></a>01842                             Under Linux: /<a class="code" href="vmedrv_8c.html#a8910285a0352a5c710e65ec9ecbe32a1">dev</a>/parport0 <a class="code" href="examples_2macro_2midas__macro_8h.html#a339a611d7f9dc3a59c359f0da7beaf3c">or</a> /<a class="code" href="vmedrv_8c.html#a8910285a0352a5c710e65ec9ecbe32a1">dev</a>/parport1
<a name="l01843"></a>01843 
<a name="l01844"></a>01844   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l01845"></a>01845     <span class="keywordtype">int</span> fd                  device descriptor <span class="keywordflow">for</span> connection, -1 <span class="keywordflow">if</span>
<a name="l01846"></a>01846                             error
<a name="l01847"></a>01847 
<a name="l01848"></a>01848 \********************************************************************/
<a name="l01849"></a>01849 {
<a name="l01850"></a>01850    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, fd, <a class="code" href="system_8c.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>;
<a name="l01851"></a>01851 
<a name="l01852"></a>01852    <a class="code" href="mscb_8c.html#a5dbc4a4a82e0e283c28418645b6116c3">mscb_init</a>(device, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, 0);
<a name="l01853"></a>01853    fd = 1;
<a name="l01854"></a>01854 
<a name="l01855"></a>01855    <a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd);
<a name="l01856"></a>01856 
<a name="l01857"></a>01857    printf(<span class="stringliteral">&quot;Toggling %s output pins, hit ENTER to stop.\n&quot;</span>, device);
<a name="l01858"></a>01858    printf(<span class="stringliteral">&quot;GND = 19-25, toggling 2-9, 1, 14, 16 and 17\n\n&quot;</span>);
<a name="l01859"></a>01859    <span class="keywordflow">do</span> {
<a name="l01860"></a>01860       printf(<span class="stringliteral">&quot;\r11111111 1111&quot;</span>);
<a name="l01861"></a>01861       fflush(stdout);
<a name="l01862"></a>01862       <a class="code" href="mscb_8c.html#a55a9e966b6acd75d76b6a9fb2e8e3c05">pp_wdata</a>(fd, 0xFF);
<a name="l01863"></a>01863       <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(fd, <a class="code" href="mscb_8c.html#aa7b693ad182550b835a69b0fbd6bd2db">LPT_STROBE</a>, 1);
<a name="l01864"></a>01864       <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(fd, <a class="code" href="mscb_8c.html#abf3d598389a18a54466f7aa8ffed86fc">LPT_ACK</a>, 1);
<a name="l01865"></a>01865       <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(fd, <a class="code" href="mscb_8c.html#add1804fb4ed8a17464e7c516b51ac72b">LPT_RESET</a>, 1);
<a name="l01866"></a>01866       <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(fd, <a class="code" href="mscb_8c.html#aafc451f66099eadd66b93da2201893b8">LPT_BIT9</a>, 1);
<a name="l01867"></a>01867 
<a name="l01868"></a>01868       Sleep(1000);
<a name="l01869"></a>01869 
<a name="l01870"></a>01870       printf(<span class="stringliteral">&quot;\r00000000 0000&quot;</span>);
<a name="l01871"></a>01871       fflush(stdout);
<a name="l01872"></a>01872       <a class="code" href="mscb_8c.html#a55a9e966b6acd75d76b6a9fb2e8e3c05">pp_wdata</a>(fd, 0);
<a name="l01873"></a>01873       <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(fd, <a class="code" href="mscb_8c.html#aa7b693ad182550b835a69b0fbd6bd2db">LPT_STROBE</a>, 0);
<a name="l01874"></a>01874       <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(fd, <a class="code" href="mscb_8c.html#abf3d598389a18a54466f7aa8ffed86fc">LPT_ACK</a>, 0);
<a name="l01875"></a>01875       <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(fd, <a class="code" href="mscb_8c.html#add1804fb4ed8a17464e7c516b51ac72b">LPT_RESET</a>, 0);
<a name="l01876"></a>01876       <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(fd, <a class="code" href="mscb_8c.html#aafc451f66099eadd66b93da2201893b8">LPT_BIT9</a>, 0);
<a name="l01877"></a>01877 
<a name="l01878"></a>01878       Sleep(1000);
<a name="l01879"></a>01879 
<a name="l01880"></a>01880    } <span class="keywordflow">while</span> (!kbhit());
<a name="l01881"></a>01881 
<a name="l01882"></a>01882    <span class="keywordflow">while</span> (kbhit())
<a name="l01883"></a>01883       getch();
<a name="l01884"></a>01884 
<a name="l01885"></a>01885    printf(<span class="stringliteral">&quot;\n\n\nInput display, hit ENTER to stop.\n&quot;</span>);
<a name="l01886"></a>01886    printf(<span class="stringliteral">&quot;Pins 2-9, 10 and 11\n\n&quot;</span>);
<a name="l01887"></a>01887 
<a name="l01888"></a>01888    <span class="keywordflow">do</span> {
<a name="l01889"></a>01889       d = <a class="code" href="mscb_8c.html#a937c66c4867e67cd9446bdd6dc9c1b22">pp_rdata</a>(fd);
<a name="l01890"></a>01890       <span class="keywordflow">for</span> (i = 0; i &lt; 8; i++) {
<a name="l01891"></a>01891          printf(<span class="stringliteral">&quot;%d&quot;</span>, (d &amp; 1) &gt; 0);
<a name="l01892"></a>01892          d &gt;&gt;= 1;
<a name="l01893"></a>01893       }
<a name="l01894"></a>01894 
<a name="l01895"></a>01895       printf(<span class="stringliteral">&quot; %d%d\r&quot;</span>, !<a class="code" href="mscb_8c.html#a6723dd6a26fb9c562657955556b67f9a">pp_rstatus</a>(fd, <a class="code" href="mscb_8c.html#a70d318d8a0062dc4b32ebb8775c53653">LPT_DATAREADY</a>), <a class="code" href="mscb_8c.html#a6723dd6a26fb9c562657955556b67f9a">pp_rstatus</a>(fd, <a class="code" href="mscb_8c.html#a9e6f01a3d42fa39fe5ce37f50beea147">LPT_BUSY</a>));
<a name="l01896"></a>01896       fflush(stdout);
<a name="l01897"></a>01897 
<a name="l01898"></a>01898       Sleep(100);
<a name="l01899"></a>01899    } <span class="keywordflow">while</span> (!kbhit());
<a name="l01900"></a>01900 
<a name="l01901"></a>01901    <span class="keywordflow">while</span> (kbhit())
<a name="l01902"></a>01902       getch();
<a name="l01903"></a>01903 
<a name="l01904"></a>01904    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l01905"></a>01905 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa23f2aa5aeb2b8ba41266b3467f32c60"></a><!-- doxytag: member="mscb.c::mscb_cleanup" ref="aa23f2aa5aeb2b8ba41266b3467f32c60" args="(int sock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mscb_cleanup </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sock</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l01788">1788</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="mdump_8c_source.html#l00115">i</a>, and <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>.</p>

<p>Referenced by <a class="el" href="rpc_8c_source.html#l01047">mrpc_server_loop()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01790"></a>01790 {
<a name="l01791"></a>01791    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l01792"></a>01792 
<a name="l01793"></a>01793    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a>; i++)
<a name="l01794"></a>01794       <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[i].fd &amp;&amp; <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[i].remote_fd == sock)
<a name="l01795"></a>01795          memset(&amp;<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[i], 0, <span class="keyword">sizeof</span>(<a class="code" href="structMSCB__FD.html">MSCB_FD</a>));
<a name="l01796"></a>01796 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="addc5a033bdf44635f04f2b5e972372b0"></a><!-- doxytag: member="mscb.c::mscb_echo" ref="addc5a033bdf44635f04f2b5e972372b0" args="(int fd, int adr, unsigned char d1, unsigned char *d2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_echo </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&nbsp;</td>
          <td class="paramname"> <em>d1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>d2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l03243">3243</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="mscbutil_8c_source.html#l00187">crc8()</a>, <a class="el" href="subm__250_8c_source.html#l00070">MCMD_ECHO</a>, <a class="el" href="subm__250_8c_source.html#l00058">MCMD_PING16</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8h_source.html#l00280">MSCB_CRC_ERROR</a>, <a class="el" href="mscb_8c_source.html#l01027">mscb_in()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00281">MSCB_TIMEOUT</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="rpc_8h_source.html#l00158">RPC_MSCB_ECHO</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>, and <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03246"></a>03246          : <a class="code" href="mscb_8c.html#addc5a033bdf44635f04f2b5e972372b0">mscb_echo</a>
<a name="l03247"></a>03247 
<a name="l03248"></a>03248   Purpose: Send byte <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> receive echo, useful <span class="keywordflow">for</span> testing
<a name="l03249"></a>03249 
<a name="l03250"></a>03250   Input:
<a name="l03251"></a>03251     <span class="keywordtype">int</span>  fd                 File descriptor <span class="keywordflow">for</span> connection
<a name="l03252"></a>03252     <span class="keywordtype">int</span>  adr                Node <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l03253"></a>03253     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> d1        <a class="code" href="zconf_8h.html#ae3a497195d617519e5353ea7b417940f">Byte</a> to <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>
<a name="l03254"></a>03254 
<a name="l03255"></a>03255   Output:
<a name="l03256"></a>03256     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *d2       Received byte
<a name="l03257"></a>03257 
<a name="l03258"></a>03258   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l03259"></a>03259     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l03260"></a>03260     <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>            Timeout receiving <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>
<a name="l03261"></a>03261     <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>          CRC error
<a name="l03262"></a>03262     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l03263"></a>03263     <a class="code" href="mscb_8h.html#a5ecd90d1b7379da125d75b5f579a3496">MSCB_FORMAT_ERROR</a>       <span class="stringliteral">&quot;size&quot;</span> <a class="code" href="HITS_8h.html#a4f188184523d527be63ee6079f182f17">parameter</a> too large
<a name="l03264"></a>03264 
<a name="l03265"></a>03265 \********************************************************************/
<a name="l03266"></a>03266 {
<a name="l03267"></a>03267    <span class="keywordtype">int</span> <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l03268"></a>03268    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[80];
<a name="l03269"></a>03269 
<a name="l03270"></a>03270    *d2 = 0xFF;
<a name="l03271"></a>03271 
<a name="l03272"></a>03272    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l03273"></a>03273       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l03274"></a>03274 
<a name="l03275"></a>03275    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd))
<a name="l03276"></a>03276       <span class="keywordflow">return</span> <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#a962c14a59ae56ebeb7ec9b41c2291abd">RPC_MSCB_ECHO</a>, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd, adr, d1, d2);
<a name="l03277"></a>03277 
<a name="l03278"></a>03278    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd) != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l03279"></a>03279       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>;
<a name="l03280"></a>03280 
<a name="l03281"></a>03281    <span class="keywordflow">if</span> (adr) {
<a name="l03282"></a>03282       status = <a class="code" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a>(fd, <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>, adr, 1, 0);
<a name="l03283"></a>03283       <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l03284"></a>03284          <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l03285"></a>03285          <span class="keywordflow">return</span> status;
<a name="l03286"></a>03286       }
<a name="l03287"></a>03287    }
<a name="l03288"></a>03288 
<a name="l03289"></a>03289    buf[0] = <a class="code" href="subm__250_8c.html#a0048a6147b28406019a88cd5509e7acf">MCMD_ECHO</a>;
<a name="l03290"></a>03290    buf[1] = d1;
<a name="l03291"></a>03291 
<a name="l03292"></a>03292    <span class="comment">/* add CRC code and send data */</span>
<a name="l03293"></a>03293    buf[2] = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 2);
<a name="l03294"></a>03294    status = <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 3, 0);
<a name="l03295"></a>03295    <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l03296"></a>03296       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l03297"></a>03297       <span class="keywordflow">return</span> status;
<a name="l03298"></a>03298    }
<a name="l03299"></a>03299 
<a name="l03300"></a>03300    <span class="comment">/* read result */</span>
<a name="l03301"></a>03301    n = <a class="code" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a>(fd, buf, <span class="keyword">sizeof</span>(buf), 10000);
<a name="l03302"></a>03302    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l03303"></a>03303 
<a name="l03304"></a>03304    <span class="keywordflow">if</span> (n &lt; 0)
<a name="l03305"></a>03305       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l03306"></a>03306 
<a name="l03307"></a>03307    *d2 = buf[1];
<a name="l03308"></a>03308 
<a name="l03309"></a>03309    <span class="keywordflow">if</span> (buf[n - 1] != <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, n - 1))
<a name="l03310"></a>03310       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>;
<a name="l03311"></a>03311 
<a name="l03312"></a>03312    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l03313"></a>03313 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a39b66894ae320f9fa61f95e78dc75c3f"></a><!-- doxytag: member="mscb.c::mscb_exit" ref="a39b66894ae320f9fa61f95e78dc75c3f" args="(int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_exit </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l01750">1750</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="rpc_8c_source.html#l00708">mrpc_disconnect()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00263">MSCB_TYPE_USB</a>, <a class="el" href="mscb_8c_source.html#l01564">musb_close()</a>, <a class="el" href="rpc_8h_source.html#l00144">RPC_MSCB_EXIT</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="calib__520_8c_source.html#l00036">main()</a>, <a class="el" href="mscbdev_8c_source.html#l00148">mscbdev_exit()</a>, and <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01753"></a>01753          : <a class="code" href="mscb_8c.html#a39b66894ae320f9fa61f95e78dc75c3f">mscb_exit</a>
<a name="l01754"></a>01754 
<a name="l01755"></a>01755   Purpose: Close a MSCB interface
<a name="l01756"></a>01756 
<a name="l01757"></a>01757   Input:
<a name="l01758"></a>01758     <span class="keywordtype">int</span>  fd                 file descriptor <span class="keywordflow">for</span> connection
<a name="l01759"></a>01759 
<a name="l01760"></a>01760   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l01761"></a>01761     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l01762"></a>01762 
<a name="l01763"></a>01763 \********************************************************************/
<a name="l01764"></a>01764 {
<a name="l01765"></a>01765    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l01766"></a>01766       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l01767"></a>01767 
<a name="l01768"></a>01768    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd)) {
<a name="l01769"></a>01769       <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#a407c73c4db0468b7982ad4cb12511a09">RPC_MSCB_EXIT</a>, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd);
<a name="l01770"></a>01770       <a class="code" href="rpc_8c.html#a53529e202a6db320a735e39b8387c547">mrpc_disconnect</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd);
<a name="l01771"></a>01771    }
<a name="l01772"></a>01772 
<a name="l01773"></a>01773    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> == <a class="code" href="mscb_8h.html#a6543e1aedd1d4ca2ce5d964979fa8c5c">MSCB_TYPE_USB</a>)
<a name="l01774"></a>01774       <a class="code" href="mscb_8c.html#aa518f900dd243fca1f06fc3ca2f0974e">musb_close</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].hr, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].hw);
<a name="l01775"></a>01775 
<a name="l01776"></a>01776    <span class="comment">/* outcommented, other client (like Labview) could still use LPT ...</span>
<a name="l01777"></a>01777 <span class="comment">   if (mscb_fd[fd - 1].type == MSCB_TYPE_LPT)</span>
<a name="l01778"></a>01778 <span class="comment">      lpt_close(mscb_fd[fd - 1].fd);</span>
<a name="l01779"></a>01779 <span class="comment">   */</span>
<a name="l01780"></a>01780 
<a name="l01781"></a>01781    memset(&amp;<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1], 0, <span class="keyword">sizeof</span>(<a class="code" href="structMSCB__FD.html">MSCB_FD</a>));
<a name="l01782"></a>01782 
<a name="l01783"></a>01783    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l01784"></a>01784 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4615b86801dfd9a3743851129093421d"></a><!-- doxytag: member="mscb.c::mscb_flash" ref="a4615b86801dfd9a3743851129093421d" args="(int fd, int adr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_flash </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l02626">2626</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="mscbutil_8c_source.html#l00187">crc8()</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="subm__250_8c_source.html#l00074">MCMD_ACK</a>, <a class="el" href="subm__250_8c_source.html#l00079">MCMD_FLASH</a>, <a class="el" href="subm__250_8c_source.html#l00058">MCMD_PING16</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8h_source.html#l00280">MSCB_CRC_ERROR</a>, <a class="el" href="mscb_8c_source.html#l01027">mscb_in()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00281">MSCB_TIMEOUT</a>, <a class="el" href="rpc_8h_source.html#l00153">RPC_MSCB_FLASH</a>, <a class="el" href="subm__250_8c_source.html#l00094">RS485_FLAG_LONG_TO</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>, <a class="el" href="calib__520_8c_source.html#l00036">main()</a>, and <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02629"></a>02629          : <a class="code" href="mscb_8c.html#a4615b86801dfd9a3743851129093421d">mscb_flash</a>
<a name="l02630"></a>02630 
<a name="l02631"></a>02631   Purpose: Flash node <a class="code" href="hvr__200_8c.html#a900ff3a8ccab65692c28b012e3824819">variables</a> to EEPROM
<a name="l02632"></a>02632 
<a name="l02633"></a>02633 
<a name="l02634"></a>02634   Input:
<a name="l02635"></a>02635     <span class="keywordtype">int</span> fd                  File descriptor <span class="keywordflow">for</span> connection
<a name="l02636"></a>02636     <span class="keywordtype">int</span> adr                 Node <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l02637"></a>02637                             <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> dword
<a name="l02638"></a>02638 
<a name="l02639"></a>02639   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l02640"></a>02640     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l02641"></a>02641     <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>            Timeout receiving acknowledge
<a name="l02642"></a>02642     <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>          CRC error
<a name="l02643"></a>02643     <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>        Parameter <span class="stringliteral">&quot;size&quot;</span> has invalid <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>
<a name="l02644"></a>02644     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l02645"></a>02645 
<a name="l02646"></a>02646 \********************************************************************/
<a name="l02647"></a>02647 {
<a name="l02648"></a>02648    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l02649"></a>02649    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[10], crc, ack[2];
<a name="l02650"></a>02650 
<a name="l02651"></a>02651    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l02652"></a>02652       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l02653"></a>02653 
<a name="l02654"></a>02654    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd))
<a name="l02655"></a>02655       <span class="keywordflow">return</span> <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#aac672b62b9530a0f4d9a76597448ffcb">RPC_MSCB_FLASH</a>, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd, adr);
<a name="l02656"></a>02656 
<a name="l02657"></a>02657    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd) != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l02658"></a>02658       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>;
<a name="l02659"></a>02659 
<a name="l02660"></a>02660    status = <a class="code" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a>(fd, <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>, adr, 10, 0);
<a name="l02661"></a>02661    <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l02662"></a>02662       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02663"></a>02663       <span class="keywordflow">return</span> status;
<a name="l02664"></a>02664    }
<a name="l02665"></a>02665 
<a name="l02666"></a>02666    buf[0] = <a class="code" href="subm__250_8c.html#a955f56e15d31500541eb48a6e010af11">MCMD_FLASH</a>;
<a name="l02667"></a>02667    crc = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 1);
<a name="l02668"></a>02668    buf[1] = crc;
<a name="l02669"></a>02669    <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 2, <a class="code" href="subm__250_8c.html#a86c0efa95b2455cd26b8629d32bd0a36">RS485_FLAG_LONG_TO</a>);
<a name="l02670"></a>02670 
<a name="l02671"></a>02671    <span class="comment">/* read acknowledge, 100ms timeout */</span>
<a name="l02672"></a>02672    i = <a class="code" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a>(fd, ack, 2, 100000);
<a name="l02673"></a>02673    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02674"></a>02674 
<a name="l02675"></a>02675    <span class="keywordflow">if</span> (i &lt; 2)
<a name="l02676"></a>02676       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l02677"></a>02677 
<a name="l02678"></a>02678    <span class="keywordflow">if</span> (ack[0] != <a class="code" href="subm__250_8c.html#a796320244ecb94c4814f6d480f55e0be">MCMD_ACK</a> || ack[1] != crc)
<a name="l02679"></a>02679       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>;
<a name="l02680"></a>02680 
<a name="l02681"></a>02681    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l02682"></a>02682 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a62e9002094c9f76730a338759320f371"></a><!-- doxytag: member="mscb.c::mscb_get_device" ref="a62e9002094c9f76730a338759320f371" args="(int fd, char *device, int bufsize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mscb_get_device </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>bufsize</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l01800">1800</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="rpc_8h_source.html#l00162">RPC_MSCB_GET_DEVICE</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01803"></a>01803          : <a class="code" href="mscb_8c.html#a62e9002094c9f76730a338759320f371">mscb_get_device</a>
<a name="l01804"></a>01804 
<a name="l01805"></a>01805   Purpose: Return device <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a> <span class="keywordflow">for</span> fd
<a name="l01806"></a>01806 
<a name="l01807"></a>01807   Input:
<a name="l01808"></a>01808     <span class="keywordtype">int</span> fd                  File descriptor obtained wiv <a class="code" href="mscb_8c.html#a5dbc4a4a82e0e283c28418645b6116c3">mscb_init</a>()
<a name="l01809"></a>01809     int bufsize             Size of device <span class="keywordtype">string</span>
<a name="l01810"></a>01810     <span class="keywordtype">char</span> *device            device <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>, &quot;&quot; <a class="code" href="generate-MODULES_8h.html#aaac43492f2954cc70dd9a286b2b3ab02">if</a> invalid fd
<a name="l01811"></a>01811                             
<a name="l01812"></a>01812 \********************************************************************/
<a name="l01813"></a>01813 {
<a name="l01814"></a>01814    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l01815"></a>01815 
<a name="l01816"></a>01816    <span class="keywordflow">if</span> (!device)
<a name="l01817"></a>01817       <span class="keywordflow">return</span>;
<a name="l01818"></a>01818 
<a name="l01819"></a>01819    *device = 0;
<a name="l01820"></a>01820    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l01821"></a>01821       <span class="keywordflow">return</span>;
<a name="l01822"></a>01822 
<a name="l01823"></a>01823    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd)) {
<a name="l01824"></a>01824       <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#a368ad8857ddf1b14e7c84f52e0759813">RPC_MSCB_GET_DEVICE</a>, 
<a name="l01825"></a>01825                 <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd, str, <span class="keyword">sizeof</span>(str));
<a name="l01826"></a>01826    }
<a name="l01827"></a>01827 
<a name="l01828"></a>01828    strcpy(device, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd-1].device);
<a name="l01829"></a>01829 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a972b75e1f6cfc5fc3075ccdc95977de0"></a><!-- doxytag: member="mscb.c::mscb_get_version" ref="a972b75e1f6cfc5fc3075ccdc95977de0" args="(char *lib_version, char *prot_version)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mscb_get_version </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>lib_version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>prot_version</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l01578">1578</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="mscb_8c_source.html#l00236">MSCB_LIBRARY_VERSION</a>, and <a class="el" href="mscb_8c_source.html#l00237">MSCB_PROTOCOL_VERSION</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01579"></a>01579 {
<a name="l01580"></a>01580    strcpy(lib_version, <a class="code" href="mscb_8c.html#acac460e2a19e766cfb2eedc0e39084c4">MSCB_LIBRARY_VERSION</a>);
<a name="l01581"></a>01581    strcpy(prot_version, <a class="code" href="mscb_8c.html#a825db2832559242d360eb92d077081e4">MSCB_PROTOCOL_VERSION</a>);
<a name="l01582"></a>01582 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a479d3aa010c4d570f7fecec8263da987"></a><!-- doxytag: member="mscb.c::mscb_in" ref="a479d3aa010c4d570f7fecec8263da987" args="(int index, char *buffer, int size, int timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_in </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l01027">1027</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="subm__250_8c_source.html#l00074">MCMD_ACK</a>, <a class="el" href="mscb_8c_source.html#l00747">mrecv_usb()</a>, <a class="el" href="mscb_8c_source.html#l00945">mscb_in1()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00263">MSCB_TYPE_USB</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8c_source.html#l03243">mscb_echo()</a>, <a class="el" href="mscb_8c_source.html#l02626">mscb_flash()</a>, <a class="el" href="mscb_8c_source.html#l02156">mscb_info()</a>, <a class="el" href="mscb_8c_source.html#l02221">mscb_info_variable()</a>, <a class="el" href="mscb_8c_source.html#l01593">mscb_init()</a>, <a class="el" href="mscb_8c_source.html#l02939">mscb_read()</a>, <a class="el" href="mscb_8c_source.html#l03060">mscb_read_range()</a>, <a class="el" href="mscb_8c_source.html#l02686">mscb_upload()</a>, <a class="el" href="mscb_8c_source.html#l03154">mscb_user()</a>, and <a class="el" href="mscb_8c_source.html#l02461">mscb_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01030"></a>01030          : <a class="code" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a>
<a name="l01031"></a>01031 
<a name="l01032"></a>01032   Purpose: Read number of bytes from SM via parallel port
<a name="l01033"></a>01033 
<a name="l01034"></a>01034   Input:
<a name="l01035"></a>01035     <span class="keywordtype">int</span>  <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>              <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> to file descriptor table
<a name="l01036"></a>01036     <span class="keywordtype">int</span>  <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>               <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> of <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l01037"></a>01037     <span class="keywordtype">int</span>  <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>            <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> microseconds
<a name="l01038"></a>01038 
<a name="l01039"></a>01039   Output:
<a name="l01040"></a>01040     <span class="keywordtype">char</span> *<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>            <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l01041"></a>01041 
<a name="l01042"></a>01042   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l01043"></a>01043     <span class="keywordtype">int</span>                     number of received bytes, -1 <span class="keywordflow">for</span> <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>
<a name="l01044"></a>01044 
<a name="l01045"></a>01045 \********************************************************************/
<a name="l01046"></a>01046 {
<a name="l01047"></a>01047    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, len, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l01048"></a>01048 
<a name="l01049"></a>01049    n = 0;
<a name="l01050"></a>01050    len = -1;
<a name="l01051"></a>01051 
<a name="l01052"></a>01052    <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l01053"></a>01053       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l01054"></a>01054 
<a name="l01055"></a>01055    <span class="comment">/*---- USB code ----*/</span>
<a name="l01056"></a>01056    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> == <a class="code" href="mscb_8h.html#a6543e1aedd1d4ca2ce5d964979fa8c5c">MSCB_TYPE_USB</a>) {
<a name="l01057"></a>01057 
<a name="l01058"></a>01058       <span class="comment">/* receive result on IN pipe */</span>
<a name="l01059"></a>01059       n = <a class="code" href="mscb_8c.html#aeb75896003a6a32b0b28187e20c64d5d">mrecv_usb</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> - 1].hr, <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l01060"></a>01060 
<a name="l01061"></a>01061    } <span class="keywordflow">else</span> {
<a name="l01062"></a>01062 
<a name="l01063"></a>01063    <span class="comment">/*---- LPT code ----*/</span>
<a name="l01064"></a>01064 
<a name="l01065"></a>01065       <span class="comment">/* wait for MCMD_ACK command */</span>
<a name="l01066"></a>01066       <span class="keywordflow">do</span> {
<a name="l01067"></a>01067          status = <a class="code" href="mscb_8c.html#a4e1939506637fd6c20e1c0157f155ced">mscb_in1</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>);
<a name="l01068"></a>01068 
<a name="l01069"></a>01069          <span class="comment">/* only read single byte */</span>
<a name="l01070"></a>01070          <span class="keywordflow">if</span> (<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> == 1)
<a name="l01071"></a>01071             <span class="keywordflow">return</span> status;
<a name="l01072"></a>01072 
<a name="l01073"></a>01073          <span class="comment">/* return in case of timeout */</span>
<a name="l01074"></a>01074          <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l01075"></a>01075             <span class="keywordflow">return</span> -1;
<a name="l01076"></a>01076 
<a name="l01077"></a>01077          <span class="comment">/* check for Acknowledge */</span>
<a name="l01078"></a>01078          <span class="keywordflow">if</span> ((<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>[0] &amp; 0xF8) == <a class="code" href="subm__250_8c.html#a796320244ecb94c4814f6d480f55e0be">MCMD_ACK</a>) {
<a name="l01079"></a>01079             len = <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>[n++] &amp; 0x7;
<a name="l01080"></a>01080 
<a name="l01081"></a>01081             <span class="comment">/* check for variable length data block */</span>
<a name="l01082"></a>01082             <span class="keywordflow">if</span> (len == 7) {
<a name="l01083"></a>01083                status = <a class="code" href="mscb_8c.html#a4e1939506637fd6c20e1c0157f155ced">mscb_in1</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> + n, <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>);
<a name="l01084"></a>01084 
<a name="l01085"></a>01085                <span class="comment">/* return in case of timeout */</span>
<a name="l01086"></a>01086                <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l01087"></a>01087                   <span class="keywordflow">return</span> -1;
<a name="l01088"></a>01088 
<a name="l01089"></a>01089                len = <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>[n++];
<a name="l01090"></a>01090             }
<a name="l01091"></a>01091          }
<a name="l01092"></a>01092 
<a name="l01093"></a>01093       } <span class="keywordflow">while</span> (len == -1);
<a name="l01094"></a>01094 
<a name="l01095"></a>01095       <span class="comment">/* receive remaining bytes and CRC code */</span>
<a name="l01096"></a>01096       <span class="keywordflow">for</span> (i = 0; i &lt; len + 1; i++) {
<a name="l01097"></a>01097          status = <a class="code" href="mscb_8c.html#a4e1939506637fd6c20e1c0157f155ced">mscb_in1</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> + n + i, <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>);
<a name="l01098"></a>01098 
<a name="l01099"></a>01099          <span class="comment">/* return in case of timeout */</span>
<a name="l01100"></a>01100          <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l01101"></a>01101             <span class="keywordflow">return</span> -1;
<a name="l01102"></a>01102       }
<a name="l01103"></a>01103 
<a name="l01104"></a>01104       n += i;
<a name="l01105"></a>01105    }
<a name="l01106"></a>01106 
<a name="l01107"></a>01107    <span class="keywordflow">return</span> n;
<a name="l01108"></a>01108 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4e1939506637fd6c20e1c0157f155ced"></a><!-- doxytag: member="mscb.c::mscb_in1" ref="a4e1939506637fd6c20e1c0157f155ced" args="(int fd, unsigned char *c, int timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_in1 </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00945">945</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mscb_8c_source.html#l00320">LPT_ACK</a>, <a class="el" href="mscb_8c_source.html#l00326">LPT_DATAREADY</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00281">MSCB_TIMEOUT</a>, <a class="el" href="mscb_8c_source.html#l00709">pp_rdata()</a>, <a class="el" href="mscb_8c_source.html#l00655">pp_rstatus()</a>, <a class="el" href="mscb_8c_source.html#l00680">pp_setdir()</a>, and <a class="el" href="mscb_8c_source.html#l00621">pp_wcontrol()</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01112">lpt_init()</a>, and <a class="el" href="mscb_8c_source.html#l01027">mscb_in()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00948"></a>00948          : <a class="code" href="mscb_8c.html#a4e1939506637fd6c20e1c0157f155ced">mscb_in1</a>
<a name="l00949"></a>00949 
<a name="l00950"></a>00950   Purpose: Read one byte from SM via parallel port
<a name="l00951"></a>00951 
<a name="l00952"></a>00952   Input:
<a name="l00953"></a>00953     <span class="keywordtype">int</span>  fd                 file descriptor <span class="keywordflow">for</span> connection
<a name="l00954"></a>00954     <span class="keywordtype">int</span>  <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>            <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> microseconds
<a name="l00955"></a>00955 
<a name="l00956"></a>00956   Output:
<a name="l00957"></a>00957     <span class="keywordtype">char</span> *<a class="code" href="patch__mevb_8cpp.html#adce6024c3a1b29c5fcede88815f9b152">c</a>                 <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> bytes
<a name="l00958"></a>00958 
<a name="l00959"></a>00959   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l00960"></a>00960     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l00961"></a>00961     <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>            Timeout
<a name="l00962"></a>00962 
<a name="l00963"></a>00963 \********************************************************************/
<a name="l00964"></a>00964 {
<a name="l00965"></a>00965    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l00966"></a>00966 
<a name="l00967"></a>00967    <span class="comment">/* wait for DATAREADY, each port access takes roughly 1us */</span>
<a name="l00968"></a>00968    <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a> = (int) (<a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a> / 1.3);
<a name="l00969"></a>00969 
<a name="l00970"></a>00970    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>; i++) {
<a name="l00971"></a>00971       <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a6723dd6a26fb9c562657955556b67f9a">pp_rstatus</a>(fd, <a class="code" href="mscb_8c.html#a70d318d8a0062dc4b32ebb8775c53653">LPT_DATAREADY</a>))
<a name="l00972"></a>00972          <span class="keywordflow">break</span>;
<a name="l00973"></a>00973    }
<a name="l00974"></a>00974    <span class="keywordflow">if</span> (i == timeout)
<a name="l00975"></a>00975       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l00976"></a>00976 
<a name="l00977"></a>00977    <span class="comment">/* switch to input mode */</span>
<a name="l00978"></a>00978    <a class="code" href="mscb_8c.html#af3238ffb136b143d8b080523c2f0cee5">pp_setdir</a>(fd, 1);
<a name="l00979"></a>00979 
<a name="l00980"></a>00980    <span class="comment">/* signal switch to input */</span>
<a name="l00981"></a>00981    <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(fd, <a class="code" href="mscb_8c.html#abf3d598389a18a54466f7aa8ffed86fc">LPT_ACK</a>, 1);
<a name="l00982"></a>00982 
<a name="l00983"></a>00983    <span class="comment">/* wait for data ready */</span>
<a name="l00984"></a>00984    <span class="keywordflow">for</span> (i = 0; i &lt; 1000; i++) {
<a name="l00985"></a>00985       <span class="keywordflow">if</span> (!<a class="code" href="mscb_8c.html#a6723dd6a26fb9c562657955556b67f9a">pp_rstatus</a>(fd, <a class="code" href="mscb_8c.html#a70d318d8a0062dc4b32ebb8775c53653">LPT_DATAREADY</a>))
<a name="l00986"></a>00986          <span class="keywordflow">break</span>;
<a name="l00987"></a>00987    }
<a name="l00988"></a>00988 
<a name="l00989"></a>00989    <span class="comment">/* read data */</span>
<a name="l00990"></a>00990    *<a class="code" href="patch__mevb_8cpp.html#adce6024c3a1b29c5fcede88815f9b152">c</a> = <a class="code" href="mscb_8c.html#a937c66c4867e67cd9446bdd6dc9c1b22">pp_rdata</a>(fd);
<a name="l00991"></a>00991 
<a name="l00992"></a>00992    <span class="comment">/* signal data read */</span>
<a name="l00993"></a>00993    <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(fd, <a class="code" href="mscb_8c.html#abf3d598389a18a54466f7aa8ffed86fc">LPT_ACK</a>, 0);
<a name="l00994"></a>00994 
<a name="l00995"></a>00995    <span class="comment">/* wait for mode switch */</span>
<a name="l00996"></a>00996    <span class="keywordflow">for</span> (i = 0; i &lt; 1000; i++) {
<a name="l00997"></a>00997       <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a6723dd6a26fb9c562657955556b67f9a">pp_rstatus</a>(fd, <a class="code" href="mscb_8c.html#a70d318d8a0062dc4b32ebb8775c53653">LPT_DATAREADY</a>))
<a name="l00998"></a>00998          <span class="keywordflow">break</span>;
<a name="l00999"></a>00999    }
<a name="l01000"></a>01000 
<a name="l01001"></a>01001    <span class="comment">/* switch to output mode */</span>
<a name="l01002"></a>01002    <a class="code" href="mscb_8c.html#af3238ffb136b143d8b080523c2f0cee5">pp_setdir</a>(fd, 0);
<a name="l01003"></a>01003 
<a name="l01004"></a>01004    <span class="comment">/* indicate mode switch */</span>
<a name="l01005"></a>01005    <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(fd, <a class="code" href="mscb_8c.html#abf3d598389a18a54466f7aa8ffed86fc">LPT_ACK</a>, 1);
<a name="l01006"></a>01006 
<a name="l01007"></a>01007    <span class="comment">/* wait for end of cycle */</span>
<a name="l01008"></a>01008    <span class="keywordflow">for</span> (i = 0; i &lt; 1000; i++) {
<a name="l01009"></a>01009       <span class="keywordflow">if</span> (!<a class="code" href="mscb_8c.html#a6723dd6a26fb9c562657955556b67f9a">pp_rstatus</a>(fd, <a class="code" href="mscb_8c.html#a70d318d8a0062dc4b32ebb8775c53653">LPT_DATAREADY</a>))
<a name="l01010"></a>01010          <span class="keywordflow">break</span>;
<a name="l01011"></a>01011    }
<a name="l01012"></a>01012 
<a name="l01013"></a>01013    <span class="comment">/* remove acknowlege */</span>
<a name="l01014"></a>01014    <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(fd, <a class="code" href="mscb_8c.html#abf3d598389a18a54466f7aa8ffed86fc">LPT_ACK</a>, 0);
<a name="l01015"></a>01015 
<a name="l01016"></a>01016    <span class="keywordflow">if</span> (i == 1000)
<a name="l01017"></a>01017       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l01018"></a>01018 
<a name="l01019"></a>01019    <span class="keywordflow">for</span> (i = 0; i &lt; 50; i++)
<a name="l01020"></a>01020       <a class="code" href="mscb_8c.html#a937c66c4867e67cd9446bdd6dc9c1b22">pp_rdata</a>(fd);
<a name="l01021"></a>01021 
<a name="l01022"></a>01022    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l01023"></a>01023 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a77c7935174bbbb756f0ecd27033e4925"></a><!-- doxytag: member="mscb.c::mscb_info" ref="a77c7935174bbbb756f0ecd27033e4925" args="(int fd, int adr, MSCB_INFO *info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_info </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structMSCB__INFO.html">MSCB_INFO</a> *&nbsp;</td>
          <td class="paramname"> <em>info</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l02156">2156</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="mscbutil_8c_source.html#l00187">crc8()</a>, <a class="el" href="embedded_2mscb_8h_source.html#l00381">MSCB_INFO::group_address</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="subm__250_8c_source.html#l00061">MCMD_GET_INFO</a>, <a class="el" href="subm__250_8c_source.html#l00058">MCMD_PING16</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8h_source.html#l00280">MSCB_CRC_ERROR</a>, <a class="el" href="mscb_8c_source.html#l01027">mscb_in()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00281">MSCB_TIMEOUT</a>, <a class="el" href="embedded_2mscb_8h_source.html#l00380">MSCB_INFO::node_address</a>, <a class="el" href="rpc_8h_source.html#l00148">RPC_MSCB_INFO</a>, <a class="el" href="subm__250_8c_source.html#l00094">RS485_FLAG_LONG_TO</a>, <a class="el" href="mana_8cpp_source.html#l00675">type</a>, <a class="el" href="embedded_2mscb_8h_source.html#l00382">MSCB_INFO::watchdog_resets</a>, and <a class="el" href="msystem_8h_source.html#l00214">WORD_SWAP</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>, and <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02159"></a>02159          : <a class="code" href="mscb_8c.html#a77c7935174bbbb756f0ecd27033e4925">mscb_info</a>
<a name="l02160"></a>02160 
<a name="l02161"></a>02161   Purpose: Retrieve info on addressd node
<a name="l02162"></a>02162 
<a name="l02163"></a>02163   Input:
<a name="l02164"></a>02164     <span class="keywordtype">int</span> fd                  File descriptor <span class="keywordflow">for</span> connection
<a name="l02165"></a>02165     <span class="keywordtype">int</span> adr                 Node <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l02166"></a>02166 
<a name="l02167"></a>02167   Output:
<a name="l02168"></a>02168     <a class="code" href="structMSCB__INFO.html">MSCB_INFO</a> *info         Info structure defined <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> mscb.h
<a name="l02169"></a>02169 
<a name="l02170"></a>02170   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l02171"></a>02171     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l02172"></a>02172     <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>            Timeout receiving <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>
<a name="l02173"></a>02173     <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>          CRC error
<a name="l02174"></a>02174     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l02175"></a>02175 
<a name="l02176"></a>02176 \********************************************************************/
<a name="l02177"></a>02177 {
<a name="l02178"></a>02178    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l02179"></a>02179    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[256];
<a name="l02180"></a>02180 
<a name="l02181"></a>02181    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l02182"></a>02182       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l02183"></a>02183 
<a name="l02184"></a>02184    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd))
<a name="l02185"></a>02185       <span class="keywordflow">return</span> <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#aa773f4bcabdd0b845ee4e75c928214ed">RPC_MSCB_INFO</a>, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd, adr, info);
<a name="l02186"></a>02186 
<a name="l02187"></a>02187    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd) != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l02188"></a>02188       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>;
<a name="l02189"></a>02189 
<a name="l02190"></a>02190    status = <a class="code" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a>(fd, <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>, adr, 10, 0);
<a name="l02191"></a>02191    <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l02192"></a>02192       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02193"></a>02193       <span class="keywordflow">return</span> status;
<a name="l02194"></a>02194    }
<a name="l02195"></a>02195 
<a name="l02196"></a>02196    buf[0] = <a class="code" href="subm__250_8c.html#ad6997e3643496d05a6bcc36f5db0df1c">MCMD_GET_INFO</a>;
<a name="l02197"></a>02197    buf[1] = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 1);
<a name="l02198"></a>02198    <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 2, <a class="code" href="subm__250_8c.html#a86c0efa95b2455cd26b8629d32bd0a36">RS485_FLAG_LONG_TO</a>);
<a name="l02199"></a>02199 
<a name="l02200"></a>02200    i = <a class="code" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a>(fd, buf, <span class="keyword">sizeof</span>(buf), 10000);
<a name="l02201"></a>02201    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02202"></a>02202 
<a name="l02203"></a>02203    <span class="keywordflow">if</span> (i &lt; (<span class="keywordtype">int</span>) <span class="keyword">sizeof</span>(<a class="code" href="structMSCB__INFO.html">MSCB_INFO</a>) + 2)
<a name="l02204"></a>02204       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l02205"></a>02205 
<a name="l02206"></a>02206    memcpy(info, buf + 2, <span class="keyword">sizeof</span>(<a class="code" href="structMSCB__INFO.html">MSCB_INFO</a>));
<a name="l02207"></a>02207 
<a name="l02208"></a>02208    <span class="comment">/* do CRC check */</span>
<a name="l02209"></a>02209    <span class="keywordflow">if</span> (<a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, <span class="keyword">sizeof</span>(<a class="code" href="structMSCB__INFO.html">MSCB_INFO</a>) + 2) != buf[<span class="keyword">sizeof</span>(<a class="code" href="structMSCB__INFO.html">MSCB_INFO</a>) + 2])
<a name="l02210"></a>02210       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>;
<a name="l02211"></a>02211 
<a name="l02212"></a>02212    <a class="code" href="group__msmacroh.html#ga4670ac841b4b8e3c3141a91a743bc61d">WORD_SWAP</a>(&amp;info-&gt;<a class="code" href="structMSCB__INFO.html#a3c0cb94aa375d5e25532500d15f3b95c">node_address</a>);
<a name="l02213"></a>02213    <a class="code" href="group__msmacroh.html#ga4670ac841b4b8e3c3141a91a743bc61d">WORD_SWAP</a>(&amp;info-&gt;<a class="code" href="structMSCB__INFO.html#aca1681cf48905e98dc8f5d7c6872f638">group_address</a>);
<a name="l02214"></a>02214    <a class="code" href="group__msmacroh.html#ga4670ac841b4b8e3c3141a91a743bc61d">WORD_SWAP</a>(&amp;info-&gt;<a class="code" href="structMSCB__INFO.html#a2d124f04e6d3795a798f7ee397e023f2">watchdog_resets</a>);
<a name="l02215"></a>02215 
<a name="l02216"></a>02216    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l02217"></a>02217 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa3f8e123ff427b0f372c5195b44f76fb"></a><!-- doxytag: member="mscb.c::mscb_info_variable" ref="aa3f8e123ff427b0f372c5195b44f76fb" args="(int fd, int adr, int index, MSCB_INFO_VAR *info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_info_variable </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structMSCB__INFO__VAR.html">MSCB_INFO_VAR</a> *&nbsp;</td>
          <td class="paramname"> <em>info</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l02221">2221</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="mscbutil_8c_source.html#l00187">crc8()</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="subm__250_8c_source.html#l00061">MCMD_GET_INFO</a>, <a class="el" href="subm__250_8c_source.html#l00058">MCMD_PING16</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8h_source.html#l00280">MSCB_CRC_ERROR</a>, <a class="el" href="mscb_8c_source.html#l01027">mscb_in()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00281">MSCB_TIMEOUT</a>, <a class="el" href="rpc_8h_source.html#l00149">RPC_MSCB_INFO_VARIABLE</a>, <a class="el" href="subm__250_8c_source.html#l00094">RS485_FLAG_LONG_TO</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="mscbdev_8c_source.html#l00061">addr_changed()</a>, <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>, <a class="el" href="calib__520_8c_source.html#l00036">main()</a>, <a class="el" href="mscb_8c_source.html#l03334">mscb_link()</a>, <a class="el" href="mscbdev_8c_source.html#l00208">mscbdev_get_default_name()</a>, and <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02224"></a>02224          : <a class="code" href="mscb_8c.html#aa3f8e123ff427b0f372c5195b44f76fb">mscb_info_variable</a>
<a name="l02225"></a>02225 
<a name="l02226"></a>02226   Purpose: Retrieve info on a specific node <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a>
<a name="l02227"></a>02227 
<a name="l02228"></a>02228   Input:
<a name="l02229"></a>02229     <span class="keywordtype">int</span> fd                  File descriptor <span class="keywordflow">for</span> connection
<a name="l02230"></a>02230     <span class="keywordtype">int</span> adr                 Node <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l02231"></a>02231     <span class="keywordtype">int</span> <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>               Variable <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> 0..255
<a name="l02232"></a>02232 
<a name="l02233"></a>02233   Output:
<a name="l02234"></a>02234     <a class="code" href="structMSCB__INFO__VAR.html">MSCB_INFO_VAR</a> *info     Info structure defined <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> mscb.h
<a name="l02235"></a>02235 
<a name="l02236"></a>02236   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l02237"></a>02237     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l02238"></a>02238     <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>            Timeout receiving <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>
<a name="l02239"></a>02239     <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>          CRC error
<a name="l02240"></a>02240 
<a name="l02241"></a>02241     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l02242"></a>02242 
<a name="l02243"></a>02243 \********************************************************************/
<a name="l02244"></a>02244 {
<a name="l02245"></a>02245    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l02246"></a>02246    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[80];
<a name="l02247"></a>02247 
<a name="l02248"></a>02248    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l02249"></a>02249       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l02250"></a>02250 
<a name="l02251"></a>02251    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd))
<a name="l02252"></a>02252       <span class="keywordflow">return</span> <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#a09e19ceed367ec23b5a9dacd62617773">RPC_MSCB_INFO_VARIABLE</a>,
<a name="l02253"></a>02253                        <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd, adr, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, info);
<a name="l02254"></a>02254 
<a name="l02255"></a>02255    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd) != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l02256"></a>02256       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>;
<a name="l02257"></a>02257 
<a name="l02258"></a>02258    status = <a class="code" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a>(fd, <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>, adr, 10, 0);
<a name="l02259"></a>02259    <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l02260"></a>02260       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02261"></a>02261       <span class="keywordflow">return</span> status;
<a name="l02262"></a>02262    }
<a name="l02263"></a>02263 
<a name="l02264"></a>02264    buf[0] = <a class="code" href="subm__250_8c.html#ad6997e3643496d05a6bcc36f5db0df1c">MCMD_GET_INFO</a> + 1;
<a name="l02265"></a>02265    buf[1] = <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>;
<a name="l02266"></a>02266    buf[2] = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 2);
<a name="l02267"></a>02267    <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 3, <a class="code" href="subm__250_8c.html#a86c0efa95b2455cd26b8629d32bd0a36">RS485_FLAG_LONG_TO</a>);
<a name="l02268"></a>02268 
<a name="l02269"></a>02269    i = <a class="code" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a>(fd, buf, <span class="keyword">sizeof</span>(buf), 10000);
<a name="l02270"></a>02270    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02271"></a>02271 
<a name="l02272"></a>02272    <span class="keywordflow">if</span> (i &lt; (<span class="keywordtype">int</span>) <span class="keyword">sizeof</span>(<a class="code" href="structMSCB__INFO__VAR.html">MSCB_INFO_VAR</a>) + 3)
<a name="l02273"></a>02273       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l02274"></a>02274 
<a name="l02275"></a>02275    memcpy(info, buf + 2, <span class="keyword">sizeof</span>(<a class="code" href="structMSCB__INFO__VAR.html">MSCB_INFO_VAR</a>));
<a name="l02276"></a>02276 
<a name="l02277"></a>02277    <span class="comment">/* do CRC check */</span>
<a name="l02278"></a>02278    <span class="keywordflow">if</span> (<a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, <span class="keyword">sizeof</span>(<a class="code" href="structMSCB__INFO__VAR.html">MSCB_INFO_VAR</a>) + 2) != buf[<span class="keyword">sizeof</span>(<a class="code" href="structMSCB__INFO__VAR.html">MSCB_INFO_VAR</a>) + 2])
<a name="l02279"></a>02279       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>;
<a name="l02280"></a>02280 
<a name="l02281"></a>02281    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l02282"></a>02282 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5dbc4a4a82e0e283c28418645b6116c3"></a><!-- doxytag: member="mscb.c::mscb_init" ref="a5dbc4a4a82e0e283c28418645b6116c3" args="(char *device, int bufsize, int debug)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_init </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>bufsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>debug</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l01593">1593</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="rpc_8c_source.html#l00118">_debug_flag</a>, <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="lrs1821_8c_source.html#l00038">data</a>, <a class="el" href="rpc_8c_source.html#l00298">debug_log()</a>, <a class="el" href="mscb_8h_source.html#l00270">MSCB_FD::fd</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mscb_8c_source.html#l01112">lpt_init()</a>, <a class="el" href="subm__250_8c_source.html#l00074">MCMD_ACK</a>, <a class="el" href="subm__250_8c_source.html#l00070">MCMD_ECHO</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="rpc_8c_source.html#l00649">mrpc_connect()</a>, <a class="el" href="rpc_8c_source.html#l00708">mrpc_disconnect()</a>, <a class="el" href="mscb_8c_source.html#l01027">mscb_in()</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8c_source.html#l03438">mscb_select_device()</a>, <a class="el" href="mscb_8h_source.html#l00262">MSCB_TYPE_LPT</a>, <a class="el" href="mscb_8h_source.html#l00265">MSCB_TYPE_RPC</a>, <a class="el" href="mscb_8h_source.html#l00263">MSCB_TYPE_USB</a>, <a class="el" href="mscb_8c.html#aca3f3982b04c5e7e5884b831f886a333">musb_init()</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="mscb_8c_source.html#l00385">n_cache</a>, <a class="el" href="mscb_8h_source.html#l00271">MSCB_FD::remote_fd</a>, <a class="el" href="rpc_8h_source.html#l00143">RPC_MSCB_INIT</a>, <a class="el" href="subm__250_8c_source.html#l00095">RS485_FLAG_CMD</a>, <a class="el" href="mscb_8c_source.html#l00542">strieq()</a>, <a class="el" href="mscb_8c_source.html#l00414">strlcpy()</a>, <a class="el" href="mana_8cpp_source.html#l00675">type</a>, and <a class="el" href="mscb_8h_source.html#l00269">MSCB_FD::type</a>.</p>

<p>Referenced by <a class="el" href="calib__520_8c_source.html#l00036">main()</a>, <a class="el" href="mscb_8c_source.html#l01833">mscb_check()</a>, <a class="el" href="mscbdev_8c_source.html#l00086">mscbdev_init()</a>, and <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01596"></a>01596          : <a class="code" href="mscb_8c.html#a5dbc4a4a82e0e283c28418645b6116c3">mscb_init</a>
<a name="l01597"></a>01597 
<a name="l01598"></a>01598   Purpose: Initialize <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> open MSCB
<a name="l01599"></a>01599 
<a name="l01600"></a>01600   Input:
<a name="l01601"></a>01601     <span class="keywordtype">char</span> *device            Under NT: lpt1 <a class="code" href="examples_2macro_2midas__macro_8h.html#a339a611d7f9dc3a59c359f0da7beaf3c">or</a> lpt2
<a name="l01602"></a>01602                             Under Linux: /<a class="code" href="vmedrv_8c.html#a8910285a0352a5c710e65ec9ecbe32a1">dev</a>/parport0 <a class="code" href="examples_2macro_2midas__macro_8h.html#a339a611d7f9dc3a59c359f0da7beaf3c">or</a> /<a class="code" href="vmedrv_8c.html#a8910285a0352a5c710e65ec9ecbe32a1">dev</a>/parport1
<a name="l01603"></a>01603                             <span class="stringliteral">&quot;&lt;host&gt;:device&quot;</span> <span class="keywordflow">for</span> RPC connection
<a name="l01604"></a>01604                             usbx <span class="keywordflow">for</span> USB connection
<a name="l01605"></a>01605 
<a name="l01606"></a>01606                             If device equals <span class="stringliteral">&quot;&quot;</span>, the function 
<a name="l01607"></a>01607                             <a class="code" href="mscb_8c.html#ac1c6cabb70727474ecfd7f1e98cc193f">mscb_select_device</a> is called which selects
<a name="l01608"></a>01608                             the first available device <a class="code" href="examples_2macro_2midas__macro_8h.html#a339a611d7f9dc3a59c359f0da7beaf3c">or</a> asks the user
<a name="l01609"></a>01609                             which one to use.
<a name="l01610"></a>01610     <span class="keywordtype">int</span> bufsize             Size of <span class="stringliteral">&quot;device&quot;</span> <a class="code" href="scs__310__ql355p_8c.html#a2fcb7c4c10b2f35fc53f00938f78dcc1">string</a>, <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> <span class="keywordflow">case</span> no device
<a name="l01611"></a>01611                             is specified from the caller <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> <span class="keyword">this</span> function
<a name="l01612"></a>01612                             returns the chosen device
<a name="l01613"></a>01613     <span class="keywordtype">int</span> <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>               Debug <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a>. If <span class="stringliteral">&quot;1&quot;</span> debugging information is
<a name="l01614"></a>01614                             written to <span class="stringliteral">&quot;mscb_debug.log&quot;</span> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> the current
<a name="l01615"></a>01615                             directory. If <span class="stringliteral">&quot;-1&quot;</span>, <span class="keywordflow">do</span> not ask <span class="keywordflow">for</span> device
<a name="l01616"></a>01616                             (useb <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> LabView DLL)
<a name="l01617"></a>01617 
<a name="l01618"></a>01618   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l01619"></a>01619     <span class="keywordtype">int</span> fd                  device descriptor <span class="keywordflow">for</span> connection, -1 <span class="keywordflow">if</span>
<a name="l01620"></a>01620                             error
<a name="l01621"></a>01621 
<a name="l01622"></a>01622 \********************************************************************/
<a name="l01623"></a>01623 {
<a name="l01624"></a>01624    <span class="keywordtype">int</span> <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>;
<a name="l01625"></a>01625    <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l01626"></a>01626    <span class="keywordtype">char</span> host[256], port[256], dev3[256], <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[10], remote_device[256];
<a name="l01627"></a>01627 
<a name="l01628"></a>01628    <span class="comment">/* search for new file descriptor */</span>
<a name="l01629"></a>01629    <span class="keywordflow">for</span> (index = 0; index &lt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a>; index++)
<a name="l01630"></a>01630       <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].fd == 0)
<a name="l01631"></a>01631          <span class="keywordflow">break</span>;
<a name="l01632"></a>01632 
<a name="l01633"></a>01633    <span class="keywordflow">if</span> (index == MSCB_MAX_FD)
<a name="l01634"></a>01634       <span class="keywordflow">return</span> -1;
<a name="l01635"></a>01635 
<a name="l01636"></a>01636    <span class="comment">/* set global debug flag */</span>
<a name="l01637"></a>01637    <a class="code" href="mscb_8c.html#a4112ca82bbeb36f213b9aeee78a70627">_debug_flag</a> = (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a> == 1);
<a name="l01638"></a>01638 
<a name="l01639"></a>01639    <a class="code" href="mscb_8c.html#a3f9b1b1b3b2ee5719d9ed7c7fc26638d">debug_log</a>(<span class="stringliteral">&quot;mscb_init( %s %d %d * %d)\n&quot;</span>, device, bufsize, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>);
<a name="l01640"></a>01640 
<a name="l01641"></a>01641    <span class="comment">/* clear cache */</span>
<a name="l01642"></a>01642    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="mscb_8c.html#aaeaf6cad3f72c74f6b0e5a08fba8a8ae">n_cache</a>; i++)
<a name="l01643"></a>01643       free(<a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>);
<a name="l01644"></a>01644    free(<a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>);
<a name="l01645"></a>01645    n_cache = 0;
<a name="l01646"></a>01646 
<a name="l01647"></a>01647    <span class="keywordflow">if</span> (!device[0]) {
<a name="l01648"></a>01648       <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a> == -1)
<a name="l01649"></a>01649          <a class="code" href="mscb_8c.html#ac1c6cabb70727474ecfd7f1e98cc193f">mscb_select_device</a>(device, bufsize, 0); <span class="comment">/* for LabView */</span>
<a name="l01650"></a>01650       <span class="keywordflow">else</span>
<a name="l01651"></a>01651          <a class="code" href="mscb_8c.html#ac1c6cabb70727474ecfd7f1e98cc193f">mscb_select_device</a>(device, bufsize, 1); <span class="comment">/* interactively ask for device */</span>
<a name="l01652"></a>01652    }
<a name="l01653"></a>01653 
<a name="l01654"></a>01654    <span class="comment">/* check for RPC connection */</span>
<a name="l01655"></a>01655    <span class="keywordflow">if</span> (strchr(device, <span class="charliteral">&apos;:&apos;</span>)) {
<a name="l01656"></a>01656       <a class="code" href="mscb_8c.html#a4637af6f79bac4043e1064f0837d0ddc">strlcpy</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].device, device, <span class="keyword">sizeof</span>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].device));
<a name="l01657"></a>01657       <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].<a class="code" href="structMSCB__FD.html#ae427fc239f83f01f7a3d8a128cb9b2a3">type</a> = <a class="code" href="mscb_8h.html#a307b4900ff0e3f1ee6d0f7d97f68f45e">MSCB_TYPE_RPC</a>;
<a name="l01658"></a>01658 
<a name="l01659"></a>01659       strcpy(remote_device, strchr(device, <span class="charliteral">&apos;:&apos;</span>) + 1);
<a name="l01660"></a>01660       strcpy(host, device);
<a name="l01661"></a>01661       *strchr(host, <span class="charliteral">&apos;:&apos;</span>) = 0;
<a name="l01662"></a>01662 
<a name="l01663"></a>01663       <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].<a class="code" href="structMSCB__FD.html#a08d909ba4fdeb086625d14289310c788">fd</a> = <a class="code" href="rpc_8c.html#af1ea933c2885aaaeb1d4df7d4d4c41b8">mrpc_connect</a>(host);
<a name="l01664"></a>01664 
<a name="l01665"></a>01665       <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].fd &lt; 0) {
<a name="l01666"></a>01666          <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].<a class="code" href="structMSCB__FD.html#a08d909ba4fdeb086625d14289310c788">fd</a> = 0;
<a name="l01667"></a>01667          <span class="keywordflow">return</span> -1;
<a name="l01668"></a>01668       }
<a name="l01669"></a>01669 
<a name="l01670"></a>01670       <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].<a class="code" href="structMSCB__FD.html#ae035b83920732b1e7256eb3f8228a658">remote_fd</a> = <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].fd, <a class="code" href="rpc_8h.html#a27e7938ab3f2180591365a085dd60abf">RPC_MSCB_INIT</a>, remote_device, bufsize, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>);
<a name="l01671"></a>01671       <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].remote_fd &lt; 0) {
<a name="l01672"></a>01672          <a class="code" href="rpc_8c.html#a53529e202a6db320a735e39b8387c547">mrpc_disconnect</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].fd);
<a name="l01673"></a>01673          <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].<a class="code" href="structMSCB__FD.html#a08d909ba4fdeb086625d14289310c788">fd</a> = 0;
<a name="l01674"></a>01674          <span class="keywordflow">return</span> -1;
<a name="l01675"></a>01675       }
<a name="l01676"></a>01676 
<a name="l01677"></a>01677       sprintf(device, <span class="stringliteral">&quot;%s:%s&quot;</span>, host, remote_device);
<a name="l01678"></a>01678 
<a name="l01679"></a>01679       <span class="keywordflow">return</span> index + 1;
<a name="l01680"></a>01680    }
<a name="l01681"></a>01681 
<a name="l01682"></a>01682    <span class="comment">/* check which device type */</span>
<a name="l01683"></a>01683    strcpy(dev3, device);
<a name="l01684"></a>01684    dev3[3] = 0;
<a name="l01685"></a>01685    strcpy(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].device, device);
<a name="l01686"></a>01686    <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].<a class="code" href="structMSCB__FD.html#ae427fc239f83f01f7a3d8a128cb9b2a3">type</a> = 0;
<a name="l01687"></a>01687 
<a name="l01688"></a>01688    <span class="comment">/* LPT port with direct address */</span>
<a name="l01689"></a>01689    <span class="keywordflow">if</span> (device[1] == <span class="charliteral">&apos;x&apos;</span>) {
<a name="l01690"></a>01690       <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].<a class="code" href="structMSCB__FD.html#ae427fc239f83f01f7a3d8a128cb9b2a3">type</a> = <a class="code" href="mscb_8h.html#a4fb1beb5d116c3a7d04f422bdaf33262">MSCB_TYPE_LPT</a>;
<a name="l01691"></a>01691       sscanf(port + 2, <span class="stringliteral">&quot;%x&quot;</span>, &amp;<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].fd);
<a name="l01692"></a>01692    }
<a name="l01693"></a>01693 
<a name="l01694"></a>01694    <span class="comment">/* LPTx */</span>
<a name="l01695"></a>01695    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#aecbad4f0c6c72f0f88c16c11dec81768">strieq</a>(dev3, <span class="stringliteral">&quot;LPT&quot;</span>)) {
<a name="l01696"></a>01696       <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].<a class="code" href="structMSCB__FD.html#ae427fc239f83f01f7a3d8a128cb9b2a3">type</a> = <a class="code" href="mscb_8h.html#a4fb1beb5d116c3a7d04f422bdaf33262">MSCB_TYPE_LPT</a>;
<a name="l01697"></a>01697    }
<a name="l01698"></a>01698 
<a name="l01699"></a>01699    <span class="comment">/* /dev/parportx */</span>
<a name="l01700"></a>01700    <span class="keywordflow">if</span> (strstr(device, <span class="stringliteral">&quot;parport&quot;</span>)) {
<a name="l01701"></a>01701       <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].<a class="code" href="structMSCB__FD.html#ae427fc239f83f01f7a3d8a128cb9b2a3">type</a> = <a class="code" href="mscb_8h.html#a4fb1beb5d116c3a7d04f422bdaf33262">MSCB_TYPE_LPT</a>;
<a name="l01702"></a>01702    }
<a name="l01703"></a>01703 
<a name="l01704"></a>01704    <span class="comment">/* USBx */</span>
<a name="l01705"></a>01705    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#aecbad4f0c6c72f0f88c16c11dec81768">strieq</a>(dev3, <span class="stringliteral">&quot;usb&quot;</span>))
<a name="l01706"></a>01706       <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].<a class="code" href="structMSCB__FD.html#ae427fc239f83f01f7a3d8a128cb9b2a3">type</a> = <a class="code" href="mscb_8h.html#a6543e1aedd1d4ca2ce5d964979fa8c5c">MSCB_TYPE_USB</a>;
<a name="l01707"></a>01707 
<a name="l01708"></a>01708    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> == 0)
<a name="l01709"></a>01709       <span class="keywordflow">return</span> -1;
<a name="l01710"></a>01710 
<a name="l01711"></a>01711    <span class="comment">/*---- initialize submaster ----*/</span>
<a name="l01712"></a>01712 
<a name="l01713"></a>01713    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> == <a class="code" href="mscb_8h.html#a4fb1beb5d116c3a7d04f422bdaf33262">MSCB_TYPE_LPT</a>) {
<a name="l01714"></a>01714 
<a name="l01715"></a>01715       status = <a class="code" href="mscb_8c.html#a0e5e695349a0e95873a34db09d5b6383">lpt_init</a>(device, index);
<a name="l01716"></a>01716       <span class="keywordflow">if</span> (status &lt; 0)
<a name="l01717"></a>01717          <span class="keywordflow">return</span> status;
<a name="l01718"></a>01718    }
<a name="l01719"></a>01719 
<a name="l01720"></a>01720    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> == <a class="code" href="mscb_8h.html#a6543e1aedd1d4ca2ce5d964979fa8c5c">MSCB_TYPE_USB</a>) {
<a name="l01721"></a>01721 
<a name="l01722"></a>01722       status = <a class="code" href="mscb_8c.html#aca3f3982b04c5e7e5884b831f886a333">musb_init</a>(atoi(device + 3), &amp;<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].hr, &amp;<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].hw);
<a name="l01723"></a>01723       <span class="keywordflow">if</span> (status &lt; 0)
<a name="l01724"></a>01724          <span class="keywordflow">return</span> status;
<a name="l01725"></a>01725 
<a name="l01726"></a>01726       <span class="comment">/* linux needs some time to start-up ...??? */</span>
<a name="l01727"></a>01727       <span class="keywordflow">for</span> (i = 0; i &lt; 10; i++) {
<a name="l01728"></a>01728          <a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(index + 1);
<a name="l01729"></a>01729 
<a name="l01730"></a>01730          <span class="comment">/* check if submaster alive */</span>
<a name="l01731"></a>01731          buf[0] = <a class="code" href="subm__250_8c.html#a0048a6147b28406019a88cd5509e7acf">MCMD_ECHO</a>;
<a name="l01732"></a>01732          <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(index + 1, buf, 1, <a class="code" href="subm__250_8c.html#a23b3240a4ffbe66e078cb0e6a2aa5ba7">RS485_FLAG_CMD</a>);
<a name="l01733"></a>01733 
<a name="l01734"></a>01734          n = <a class="code" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a>(index + 1, buf, 2, 10000);
<a name="l01735"></a>01735          <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(index + 1);
<a name="l01736"></a>01736 
<a name="l01737"></a>01737          <span class="keywordflow">if</span> (n == 2 &amp;&amp; buf[0] == <a class="code" href="subm__250_8c.html#a796320244ecb94c4814f6d480f55e0be">MCMD_ACK</a>)
<a name="l01738"></a>01738             <span class="keywordflow">break</span>;
<a name="l01739"></a>01739       }
<a name="l01740"></a>01740 
<a name="l01741"></a>01741       <span class="keywordflow">if</span> (n != 2 || buf[0] != <a class="code" href="subm__250_8c.html#a796320244ecb94c4814f6d480f55e0be">MCMD_ACK</a>)
<a name="l01742"></a>01742          <span class="keywordflow">return</span> -4;
<a name="l01743"></a>01743    }
<a name="l01744"></a>01744 
<a name="l01745"></a>01745    <span class="keywordflow">return</span> index + 1;
<a name="l01746"></a>01746 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad3902f3005c1e5391f548c78c30bfa2b"></a><!-- doxytag: member="mscb.c::mscb_link" ref="ad3902f3005c1e5391f548c78c30bfa2b" args="(int fd, int adr, unsigned char index, void *data, int size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_link </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l03334">3334</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="mscb_8c_source.html#l00377">CACHE_ENTRY::adr</a>, <a class="el" href="mscb_8c_source.html#l00387">CACHE_PERIOD</a>, <a class="el" href="mscb_8c_source.html#l00379">CACHE_ENTRY::data</a>, <a class="el" href="rpc_8c_source.html#l00298">debug_log()</a>, <a class="el" href="mscb_8c_source.html#l00376">CACHE_ENTRY::fd</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mscb_8c_source.html#l00378">CACHE_ENTRY::index</a>, <a class="el" href="mscb_8c_source.html#l00381">CACHE_ENTRY::last</a>, <a class="el" href="MFastSlowCorrelator_8cpp_source.html#l00063">last</a>, <a class="el" href="mscb_8c_source.html#l03317">millitime()</a>, <a class="el" href="mscb_8c_source.html#l02221">mscb_info_variable()</a>, <a class="el" href="mscb_8h_source.html#l00285">MSCB_NO_MEM</a>, <a class="el" href="mscb_8c_source.html#l02939">mscb_read()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8c_source.html#l02461">mscb_write()</a>, <a class="el" href="mscb_8c_source.html#l00385">n_cache</a>, <a class="el" href="mscb_8c_source.html#l00380">CACHE_ENTRY::size</a>, and <a class="el" href="embedded_2mscb_8h_source.html#l00387">MSCB_INFO_VAR::width</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03337"></a>03337          : <a class="code" href="mscb_8c.html#ad3902f3005c1e5391f548c78c30bfa2b">mscb_link</a>
<a name="l03338"></a>03338 
<a name="l03339"></a>03339   Purpose: Used <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> LabView to link controls to MSCB <a class="code" href="hvr__200_8c.html#a900ff3a8ccab65692c28b012e3824819">variables</a>
<a name="l03340"></a>03340 
<a name="l03341"></a>03341   Input:
<a name="l03342"></a>03342     <span class="keywordtype">int</span>  fd                 File descriptor <span class="keywordflow">for</span> connection
<a name="l03343"></a>03343     <span class="keywordtype">int</span>  adr                Node <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l03344"></a>03344     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>     Variable <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>
<a name="l03345"></a>03345     <span class="keywordtype">void</span> *<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>              Pointer to <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>
<a name="l03346"></a>03346     <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>                Size of <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>
<a name="l03347"></a>03347 
<a name="l03348"></a>03348   Output:
<a name="l03349"></a>03349     <span class="keywordtype">void</span> *<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>              Readback <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>
<a name="l03350"></a>03350 
<a name="l03351"></a>03351   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l03352"></a>03352     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l03353"></a>03353     <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>            Timeout receiving <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>
<a name="l03354"></a>03354     <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>          CRC error
<a name="l03355"></a>03355     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l03356"></a>03356     <a class="code" href="mscb_8h.html#a5ecd90d1b7379da125d75b5f579a3496">MSCB_FORMAT_ERROR</a>       <span class="stringliteral">&quot;size&quot;</span> <a class="code" href="HITS_8h.html#a4f188184523d527be63ee6079f182f17">parameter</a> too large
<a name="l03357"></a>03357     <a class="code" href="mscb_8h.html#a66e207e27dbfb8c1055534b286e3eadd">MSCB_NO_MEM</a>             Out of memory
<a name="l03358"></a>03358 
<a name="l03359"></a>03359 \********************************************************************/
<a name="l03360"></a>03360 {
<a name="l03361"></a>03361    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, s, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l03362"></a>03362    <a class="code" href="structMSCB__INFO__VAR.html">MSCB_INFO_VAR</a> info;
<a name="l03363"></a>03363 
<a name="l03364"></a>03364    <a class="code" href="mscb_8c.html#a3f9b1b1b3b2ee5719d9ed7c7fc26638d">debug_log</a>(<span class="stringliteral">&quot;mscb_link( %d %d %d * %d)\n&quot;</span>, fd, adr, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l03365"></a>03365 
<a name="l03366"></a>03366    <span class="comment">/* check if variable in cache */</span>
<a name="l03367"></a>03367    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="mscb_8c.html#aaeaf6cad3f72c74f6b0e5a08fba8a8ae">n_cache</a>; i++)
<a name="l03368"></a>03368       <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].fd == fd &amp;&amp; <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].adr == adr &amp;&amp; <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> == <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>)
<a name="l03369"></a>03369          <span class="keywordflow">break</span>;
<a name="l03370"></a>03370 
<a name="l03371"></a>03371    <span class="keywordflow">if</span> (i &lt; n_cache) {
<a name="l03372"></a>03372       <span class="keywordflow">if</span> (memcmp(<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>) != 0) {
<a name="l03373"></a>03373          <span class="comment">/* data has changed, send update */</span>
<a name="l03374"></a>03374          memcpy(<a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].data, data, <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].size);
<a name="l03375"></a>03375          <a class="code" href="mscb_8c.html#aa1058914021cc7101577223568c918d5">mscb_write</a>(fd, adr, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, data, <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].size);
<a name="l03376"></a>03376       } <span class="keywordflow">else</span> {
<a name="l03377"></a>03377          <span class="comment">/* retrieve data from node */</span>
<a name="l03378"></a>03378          <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#aa817cdaa652eda2c117296107a14cacc">millitime</a>() &gt; <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].<a class="code" href="MFastSlowCorrelator_8cpp.html#a3579fbbede9d99d8d4aafc118b3abed3">last</a> + <a class="code" href="mscb_8c.html#a2bac5c4ef464fd0b474abc62f97ac8fa">CACHE_PERIOD</a>) {
<a name="l03379"></a>03379             <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].<a class="code" href="structCACHE__ENTRY.html#ac1f5cc3c0a1ad3a62457585f37b74d50">last</a> = <a class="code" href="mscb_8c.html#aa817cdaa652eda2c117296107a14cacc">millitime</a>();
<a name="l03380"></a>03380 
<a name="l03381"></a>03381             s = <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].<a class="code" href="structCACHE__ENTRY.html#ac8a6d684aab86062f634e7586c611f8b">size</a>;
<a name="l03382"></a>03382             status = <a class="code" href="mscb_8c.html#a69d5b26c572cc81cb271a272ce778f14">mscb_read</a>(fd, adr, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].data, &amp;s);
<a name="l03383"></a>03383             <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l03384"></a>03384                <span class="keywordflow">return</span> status;
<a name="l03385"></a>03385 
<a name="l03386"></a>03386             memcpy(data, <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].data, size);
<a name="l03387"></a>03387          }
<a name="l03388"></a>03388       }
<a name="l03389"></a>03389    } <span class="keywordflow">else</span> {
<a name="l03390"></a>03390       <span class="comment">/* add new entry in cache */</span>
<a name="l03391"></a>03391       <span class="keywordflow">if</span> (n_cache == 0)
<a name="l03392"></a>03392          <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a> = (<a class="code" href="structCACHE__ENTRY.html">CACHE_ENTRY</a> *) malloc(<span class="keyword">sizeof</span>(<a class="code" href="structCACHE__ENTRY.html">CACHE_ENTRY</a>));
<a name="l03393"></a>03393       <span class="keywordflow">else</span>
<a name="l03394"></a>03394          <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a> = (<a class="code" href="structCACHE__ENTRY.html">CACHE_ENTRY</a> *) realloc(<a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>, <span class="keyword">sizeof</span>(<a class="code" href="structCACHE__ENTRY.html">CACHE_ENTRY</a>) * (n_cache + 1));
<a name="l03395"></a>03395 
<a name="l03396"></a>03396       <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a> == NULL)
<a name="l03397"></a>03397          <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a66e207e27dbfb8c1055534b286e3eadd">MSCB_NO_MEM</a>;
<a name="l03398"></a>03398 
<a name="l03399"></a>03399       <span class="comment">/* get variable size from node */</span>
<a name="l03400"></a>03400       status = <a class="code" href="mscb_8c.html#aa3f8e123ff427b0f372c5195b44f76fb">mscb_info_variable</a>(fd, adr, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, &amp;info);
<a name="l03401"></a>03401       <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l03402"></a>03402          <span class="keywordflow">return</span> status;
<a name="l03403"></a>03403 
<a name="l03404"></a>03404       <span class="comment">/* setup cache entry */</span>
<a name="l03405"></a>03405       i = n_cache;
<a name="l03406"></a>03406       n_cache++;
<a name="l03407"></a>03407 
<a name="l03408"></a>03408       <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].<a class="code" href="structCACHE__ENTRY.html#adac6e936ddaeafaca9d22fffa1728031">fd</a> = fd;
<a name="l03409"></a>03409       <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].<a class="code" href="structCACHE__ENTRY.html#a1eec418dc9f05c76b71ebcf62c6c1e0c">adr</a> = adr;
<a name="l03410"></a>03410       <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].<a class="code" href="structCACHE__ENTRY.html#a9df2ea1c7bb40097f5f3dc2b05659af1">index</a> = <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>;
<a name="l03411"></a>03411       <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].<a class="code" href="structCACHE__ENTRY.html#ac1f5cc3c0a1ad3a62457585f37b74d50">last</a> = 0;
<a name="l03412"></a>03412       <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].<a class="code" href="structCACHE__ENTRY.html#ac8a6d684aab86062f634e7586c611f8b">size</a> = info.<a class="code" href="structMSCB__INFO__VAR.html#ac30ec9a942c12fb886c2bd550d053c28">width</a>;
<a name="l03413"></a>03413 
<a name="l03414"></a>03414       <span class="comment">/* allocate at least 4 bytes */</span>
<a name="l03415"></a>03415       s = info.<a class="code" href="structMSCB__INFO__VAR.html#ac30ec9a942c12fb886c2bd550d053c28">width</a>;
<a name="l03416"></a>03416       <span class="keywordflow">if</span> (s &lt; 4)
<a name="l03417"></a>03417          s = 4;
<a name="l03418"></a>03418       <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].<a class="code" href="structCACHE__ENTRY.html#a923107df554baf3cd9946bbce8ce3d45">data</a> = malloc(s);
<a name="l03419"></a>03419       <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].data == NULL)
<a name="l03420"></a>03420          <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a66e207e27dbfb8c1055534b286e3eadd">MSCB_NO_MEM</a>;
<a name="l03421"></a>03421       memset(<a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].data, 0, s);
<a name="l03422"></a>03422 
<a name="l03423"></a>03423       <span class="comment">/* read initial value */</span>
<a name="l03424"></a>03424       s = <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].<a class="code" href="structCACHE__ENTRY.html#ac8a6d684aab86062f634e7586c611f8b">size</a>;
<a name="l03425"></a>03425       status = <a class="code" href="mscb_8c.html#a69d5b26c572cc81cb271a272ce778f14">mscb_read</a>(fd, adr, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].data, &amp;s);
<a name="l03426"></a>03426       <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l03427"></a>03427          <span class="keywordflow">return</span> status;
<a name="l03428"></a>03428 
<a name="l03429"></a>03429       memcpy(data, <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>[i].data, size);
<a name="l03430"></a>03430    }
<a name="l03431"></a>03431 
<a name="l03432"></a>03432    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l03433"></a>03433 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7cce7d06b8fd1da29090561ba9613fbb"></a><!-- doxytag: member="mscb.c::mscb_lock" ref="a7cce7d06b8fd1da29090561ba9613fbb" args="(int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_lock </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00567">567</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00262">MSCB_TYPE_LPT</a>, <a class="el" href="mscb_8h_source.html#l00263">MSCB_TYPE_USB</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01112">lpt_init()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8c_source.html#l01833">mscb_check()</a>, <a class="el" href="mscb_8c_source.html#l03243">mscb_echo()</a>, <a class="el" href="mscb_8c_source.html#l02626">mscb_flash()</a>, <a class="el" href="mscb_8c_source.html#l02156">mscb_info()</a>, <a class="el" href="mscb_8c_source.html#l02221">mscb_info_variable()</a>, <a class="el" href="mscb_8c_source.html#l01593">mscb_init()</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l02116">mscb_ping()</a>, <a class="el" href="mscb_8c_source.html#l02939">mscb_read()</a>, <a class="el" href="mscb_8c_source.html#l03060">mscb_read_range()</a>, <a class="el" href="mscb_8c_source.html#l02021">mscb_reboot()</a>, <a class="el" href="mscb_8c_source.html#l02068">mscb_reset()</a>, <a class="el" href="mscb_8c_source.html#l02286">mscb_set_addr()</a>, <a class="el" href="mscb_8c_source.html#l02345">mscb_set_name()</a>, <a class="el" href="mscb_8c_source.html#l02686">mscb_upload()</a>, <a class="el" href="mscb_8c_source.html#l03154">mscb_user()</a>, <a class="el" href="mscb_8c_source.html#l02461">mscb_write()</a>, <a class="el" href="mscb_8c_source.html#l02549">mscb_write_block()</a>, and <a class="el" href="mscb_8c_source.html#l02401">mscb_write_group()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00568"></a>00568 {
<a name="l00569"></a>00569 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00570"></a>00570 <span class="preprocessor"></span>   <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l00571"></a>00571    <span class="keywordflow">if</span> (mutex_handle == 0)
<a name="l00572"></a>00572       mutex_handle = CreateMutex(NULL, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <span class="stringliteral">&quot;mscb&quot;</span>);
<a name="l00573"></a>00573 
<a name="l00574"></a>00574    <span class="keywordflow">if</span> (mutex_handle == 0)
<a name="l00575"></a>00575       <span class="keywordflow">return</span> 0;
<a name="l00576"></a>00576 
<a name="l00577"></a>00577    status = WaitForSingleObject(mutex_handle, 1000);
<a name="l00578"></a>00578 
<a name="l00579"></a>00579    <span class="keywordflow">if</span> (status == WAIT_FAILED)
<a name="l00580"></a>00580       <span class="keywordflow">return</span> 0;
<a name="l00581"></a>00581    <span class="keywordflow">if</span> (status == WAIT_TIMEOUT)
<a name="l00582"></a>00582       <span class="keywordflow">return</span> 0;
<a name="l00583"></a>00583 
<a name="l00584"></a>00584 <span class="preprocessor">#elif defined(OS_LINUX)</span>
<a name="l00585"></a>00585 <span class="preprocessor"></span>
<a name="l00586"></a>00586    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> == <a class="code" href="mscb_8h.html#a4fb1beb5d116c3a7d04f422bdaf33262">MSCB_TYPE_LPT</a>) {
<a name="l00587"></a>00587       <span class="keywordflow">if</span> (ioctl(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, PPCLAIM))
<a name="l00588"></a>00588          <span class="keywordflow">return</span> 0;
<a name="l00589"></a>00589    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> == <a class="code" href="mscb_8h.html#a6543e1aedd1d4ca2ce5d964979fa8c5c">MSCB_TYPE_USB</a>) {
<a name="l00590"></a>00590       <span class="keywordflow">if</span> (usb_claim_interface((usb_dev_handle *) <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].hr, 0) &lt; 0)
<a name="l00591"></a>00591          <span class="keywordflow">return</span> 0;
<a name="l00592"></a>00592    }
<a name="l00593"></a>00593 <span class="preprocessor">#endif</span>
<a name="l00594"></a>00594 <span class="preprocessor"></span>   <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l00595"></a>00595 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aadf1cbda47cc7bc93ea97b0270792906"></a><!-- doxytag: member="mscb.c::mscb_out" ref="aadf1cbda47cc7bc93ea97b0270792906" args="(int index, unsigned char *buffer, int len, int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_out </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00805">805</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mscb_8c_source.html#l00322">LPT_BIT9</a>, <a class="el" href="mscb_8c_source.html#l00325">LPT_BUSY</a>, <a class="el" href="mscb_8c_source.html#l00319">LPT_STROBE</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8c_source.html#l02068">mscb_reset()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00281">MSCB_TIMEOUT</a>, <a class="el" href="mscb_8h_source.html#l00263">MSCB_TYPE_USB</a>, <a class="el" href="mscb_8c_source.html#l00726">msend_usb()</a>, <a class="el" href="mscb_8c_source.html#l01564">musb_close()</a>, <a class="el" href="mscb_8c.html#aca3f3982b04c5e7e5884b831f886a333">musb_init()</a>, <a class="el" href="mscb_8c_source.html#l00655">pp_rstatus()</a>, <a class="el" href="mscb_8c_source.html#l00621">pp_wcontrol()</a>, <a class="el" href="mscb_8c_source.html#l00695">pp_wdata()</a>, <a class="el" href="subm__250_8c_source.html#l00091">RS485_FLAG_BIT9</a>, <a class="el" href="getHist_8cpp_source.html#l00057">timeout</a>, <a class="el" href="mscb_8c_source.html#l00353">TIMEOUT_OUT</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8c_source.html#l03243">mscb_echo()</a>, <a class="el" href="mscb_8c_source.html#l02626">mscb_flash()</a>, <a class="el" href="mscb_8c_source.html#l02156">mscb_info()</a>, <a class="el" href="mscb_8c_source.html#l02221">mscb_info_variable()</a>, <a class="el" href="mscb_8c_source.html#l01593">mscb_init()</a>, <a class="el" href="mscb_8c_source.html#l02939">mscb_read()</a>, <a class="el" href="mscb_8c_source.html#l03060">mscb_read_range()</a>, <a class="el" href="mscb_8c_source.html#l02021">mscb_reboot()</a>, <a class="el" href="mscb_8c_source.html#l02068">mscb_reset()</a>, <a class="el" href="mscb_8c_source.html#l02286">mscb_set_addr()</a>, <a class="el" href="mscb_8c_source.html#l02345">mscb_set_name()</a>, <a class="el" href="mscb_8c_source.html#l02686">mscb_upload()</a>, <a class="el" href="mscb_8c_source.html#l03154">mscb_user()</a>, <a class="el" href="mscb_8c_source.html#l02461">mscb_write()</a>, <a class="el" href="mscb_8c_source.html#l02549">mscb_write_block()</a>, and <a class="el" href="mscb_8c_source.html#l02401">mscb_write_group()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00808"></a>00808          : <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>
<a name="l00809"></a>00809 
<a name="l00810"></a>00810   Purpose: Write number of bytes to SM via parallel port <a class="code" href="examples_2macro_2midas__macro_8h.html#a339a611d7f9dc3a59c359f0da7beaf3c">or</a> USB
<a name="l00811"></a>00811 
<a name="l00812"></a>00812   Input:
<a name="l00813"></a>00813     <span class="keywordtype">int</span>  <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>              <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> to file descriptor table
<a name="l00814"></a>00814     <span class="keywordtype">char</span> *<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>            <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l00815"></a>00815     <span class="keywordtype">int</span>  len                number of bytes <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l00816"></a>00816     <span class="keywordtype">int</span>  bit9               <span class="keyword">set</span> bit9 <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> communication, used <span class="keywordflow">for</span>
<a name="l00817"></a>00817                             node addressing
<a name="l00818"></a>00818 
<a name="l00819"></a>00819   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l00820"></a>00820     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l00821"></a>00821     <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>            Timeout
<a name="l00822"></a>00822 
<a name="l00823"></a>00823 \********************************************************************/
<a name="l00824"></a>00824 {
<a name="l00825"></a>00825    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>;
<a name="l00826"></a>00826    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> usb_buf[65];
<a name="l00827"></a>00827 
<a name="l00828"></a>00828    <span class="keywordflow">if</span> (<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l00829"></a>00829       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l00830"></a>00830 
<a name="l00831"></a>00831    <span class="comment">/*---- USB code ----*/</span>
<a name="l00832"></a>00832    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> == <a class="code" href="mscb_8h.html#a6543e1aedd1d4ca2ce5d964979fa8c5c">MSCB_TYPE_USB</a>) {
<a name="l00833"></a>00833 
<a name="l00834"></a>00834       <span class="keywordflow">if</span> (len &gt;= 64 || len &lt; 1)
<a name="l00835"></a>00835          <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l00836"></a>00836 
<a name="l00837"></a>00837       <span class="comment">/* add flags in first byte of USB buffer */</span>
<a name="l00838"></a>00838       usb_buf[0] = flags;
<a name="l00839"></a>00839       memcpy(usb_buf + 1, <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, len);
<a name="l00840"></a>00840 
<a name="l00841"></a>00841       <span class="comment">/* send on OUT pipe */</span>
<a name="l00842"></a>00842       i = <a class="code" href="mscb_8c.html#a6536ba92ef823b92fdc1f68537b6b942">msend_usb</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> - 1].hw, usb_buf, len + 1);
<a name="l00843"></a>00843 
<a name="l00844"></a>00844       <span class="keywordflow">if</span> (i == 0) {
<a name="l00845"></a>00845          <span class="comment">/* USB submaster might have been dis- and reconnected, so reinit */</span>
<a name="l00846"></a>00846          <a class="code" href="mscb_8c.html#aa518f900dd243fca1f06fc3ca2f0974e">musb_close</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> - 1].hr, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> - 1].hw);
<a name="l00847"></a>00847 
<a name="l00848"></a>00848          i = <a class="code" href="mscb_8c.html#aca3f3982b04c5e7e5884b831f886a333">musb_init</a>(atoi(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> - 1].device+3), &amp;<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> - 1].hr, &amp;<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> - 1].hw);
<a name="l00849"></a>00849          <span class="keywordflow">if</span> (i &lt; 0)
<a name="l00850"></a>00850             <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l00851"></a>00851 
<a name="l00852"></a>00852          i = <a class="code" href="mscb_8c.html#a6536ba92ef823b92fdc1f68537b6b942">msend_usb</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> - 1].hw, usb_buf, len + 1);
<a name="l00853"></a>00853       }
<a name="l00854"></a>00854 
<a name="l00855"></a>00855       <span class="keywordflow">if</span> (i != len + 1) {
<a name="l00856"></a>00856          <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l00857"></a>00857       }
<a name="l00858"></a>00858 
<a name="l00859"></a>00859    } <span class="keywordflow">else</span> {
<a name="l00860"></a>00860 
<a name="l00861"></a>00861    <span class="comment">/*---- LPT code ----*/</span>
<a name="l00862"></a>00862 
<a name="l00863"></a>00863       <span class="comment">/* remove accidental strobe */</span>
<a name="l00864"></a>00864       <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="mscb_8c.html#aa7b693ad182550b835a69b0fbd6bd2db">LPT_STROBE</a>, 0);
<a name="l00865"></a>00865 
<a name="l00866"></a>00866       <span class="keywordflow">for</span> (i = 0; i &lt; len; i++) {
<a name="l00867"></a>00867          <span class="comment">/* wait for SM ready */</span>
<a name="l00868"></a>00868          <span class="keywordflow">for</span> (timeout = 0; timeout &lt; <a class="code" href="mscb_8c.html#a25c6eabcf221b9af262fe35eaf2704f1">TIMEOUT_OUT</a>; timeout++) {
<a name="l00869"></a>00869             <span class="keywordflow">if</span> (!<a class="code" href="mscb_8c.html#a6723dd6a26fb9c562657955556b67f9a">pp_rstatus</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="mscb_8c.html#a9e6f01a3d42fa39fe5ce37f50beea147">LPT_BUSY</a>))
<a name="l00870"></a>00870                <span class="keywordflow">break</span>;
<a name="l00871"></a>00871          }
<a name="l00872"></a>00872          <span class="keywordflow">if</span> (timeout == TIMEOUT_OUT) {
<a name="l00873"></a>00873 <span class="preprocessor">#ifndef _USRDLL</span>
<a name="l00874"></a>00874 <span class="preprocessor"></span>            printf(<span class="stringliteral">&quot;Automatic submaster reset.\n&quot;</span>);
<a name="l00875"></a>00875 <span class="preprocessor">#endif</span>
<a name="l00876"></a>00876 <span class="preprocessor"></span>
<a name="l00877"></a>00877             <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>);
<a name="l00878"></a>00878             <a class="code" href="mscb_8c.html#ac1aae2c6055ae4bdbb8ec9c7eeae6e2e">mscb_reset</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>);
<a name="l00879"></a>00879             <a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>);
<a name="l00880"></a>00880 
<a name="l00881"></a>00881             Sleep(100);
<a name="l00882"></a>00882 
<a name="l00883"></a>00883             <span class="comment">/* wait for SM ready */</span>
<a name="l00884"></a>00884             <span class="keywordflow">for</span> (timeout = 0; timeout &lt; TIMEOUT_OUT; timeout++) {
<a name="l00885"></a>00885                <span class="keywordflow">if</span> (!<a class="code" href="mscb_8c.html#a6723dd6a26fb9c562657955556b67f9a">pp_rstatus</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="mscb_8c.html#a9e6f01a3d42fa39fe5ce37f50beea147">LPT_BUSY</a>))
<a name="l00886"></a>00886                   <span class="keywordflow">break</span>;
<a name="l00887"></a>00887             }
<a name="l00888"></a>00888 
<a name="l00889"></a>00889             <span class="keywordflow">if</span> (timeout == TIMEOUT_OUT)
<a name="l00890"></a>00890                <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l00891"></a>00891          }
<a name="l00892"></a>00892 
<a name="l00893"></a>00893          <span class="comment">/* output data byte */</span>
<a name="l00894"></a>00894          <a class="code" href="mscb_8c.html#a55a9e966b6acd75d76b6a9fb2e8e3c05">pp_wdata</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>[i]);
<a name="l00895"></a>00895 
<a name="l00896"></a>00896          <span class="comment">/* set bit 9 */</span>
<a name="l00897"></a>00897          <span class="keywordflow">if</span> (flags &amp; <a class="code" href="subm__250_8c.html#ace34d48b78d719270743b9cca5b2ab8c">RS485_FLAG_BIT9</a>)
<a name="l00898"></a>00898             <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="mscb_8c.html#aafc451f66099eadd66b93da2201893b8">LPT_BIT9</a>, 1);
<a name="l00899"></a>00899          <span class="keywordflow">else</span>
<a name="l00900"></a>00900             <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="mscb_8c.html#aafc451f66099eadd66b93da2201893b8">LPT_BIT9</a>, 0);
<a name="l00901"></a>00901 
<a name="l00902"></a>00902          <span class="comment">/* set strobe */</span>
<a name="l00903"></a>00903          <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="mscb_8c.html#aa7b693ad182550b835a69b0fbd6bd2db">LPT_STROBE</a>, 1);
<a name="l00904"></a>00904 
<a name="l00905"></a>00905          <span class="comment">/* wait for busy to become active */</span>
<a name="l00906"></a>00906          <span class="keywordflow">for</span> (timeout = 0; timeout &lt; TIMEOUT_OUT; timeout++) {
<a name="l00907"></a>00907             <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a6723dd6a26fb9c562657955556b67f9a">pp_rstatus</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="mscb_8c.html#a9e6f01a3d42fa39fe5ce37f50beea147">LPT_BUSY</a>))
<a name="l00908"></a>00908                <span class="keywordflow">break</span>;
<a name="l00909"></a>00909          }
<a name="l00910"></a>00910 
<a name="l00911"></a>00911          <span class="keywordflow">if</span> (timeout == TIMEOUT_OUT) {
<a name="l00912"></a>00912 <span class="preprocessor">#ifndef _USRDLL</span>
<a name="l00913"></a>00913 <span class="preprocessor"></span>            printf(<span class="stringliteral">&quot;Automatic submaster reset.\n&quot;</span>);
<a name="l00914"></a>00914 <span class="preprocessor">#endif</span>
<a name="l00915"></a>00915 <span class="preprocessor"></span>
<a name="l00916"></a>00916             <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>);
<a name="l00917"></a>00917             <a class="code" href="mscb_8c.html#ac1aae2c6055ae4bdbb8ec9c7eeae6e2e">mscb_reset</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>);
<a name="l00918"></a>00918             <a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>);
<a name="l00919"></a>00919 
<a name="l00920"></a>00920             Sleep(100);
<a name="l00921"></a>00921 
<a name="l00922"></a>00922             <span class="comment">/* try again */</span>
<a name="l00923"></a>00923             <span class="keywordflow">return</span> <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, len, flags);
<a name="l00924"></a>00924          }
<a name="l00925"></a>00925 
<a name="l00926"></a>00926          <span class="keywordflow">if</span> (timeout == TIMEOUT_OUT) {
<a name="l00927"></a>00927             <a class="code" href="mscb_8c.html#a55a9e966b6acd75d76b6a9fb2e8e3c05">pp_wdata</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, 0xFF);
<a name="l00928"></a>00928             <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="mscb_8c.html#aa7b693ad182550b835a69b0fbd6bd2db">LPT_STROBE</a>, 0);
<a name="l00929"></a>00929             <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l00930"></a>00930          }
<a name="l00931"></a>00931 
<a name="l00932"></a>00932          <span class="comment">/* remove data, make port available for input */</span>
<a name="l00933"></a>00933          <a class="code" href="mscb_8c.html#a55a9e966b6acd75d76b6a9fb2e8e3c05">pp_wdata</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, 0xFF);
<a name="l00934"></a>00934 
<a name="l00935"></a>00935          <span class="comment">/* remove strobe */</span>
<a name="l00936"></a>00936          <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="mscb_8c.html#aa7b693ad182550b835a69b0fbd6bd2db">LPT_STROBE</a>, 0);
<a name="l00937"></a>00937       }
<a name="l00938"></a>00938    }
<a name="l00939"></a>00939 
<a name="l00940"></a>00940    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l00941"></a>00941 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9a9f11687252d151809f046874b3355f"></a><!-- doxytag: member="mscb.c::mscb_ping" ref="a9a9f11687252d151809f046874b3355f" args="(int fd, int adr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_ping </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l02116">2116</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="subm__250_8c_source.html#l00058">MCMD_PING16</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="rpc_8h_source.html#l00147">RPC_MSCB_PING</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>, <a class="el" href="calib__520_8c_source.html#l00036">main()</a>, and <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02119"></a>02119          : <a class="code" href="mscb_8c.html#a9a9f11687252d151809f046874b3355f">mscb_ping</a>
<a name="l02120"></a>02120 
<a name="l02121"></a>02121   Purpose: Ping node to see <span class="keywordflow">if</span> it<span class="stringliteral">&apos;s alive</span>
<a name="l02122"></a>02122 <span class="stringliteral"></span>
<a name="l02123"></a>02123 <span class="stringliteral">  Input:</span>
<a name="l02124"></a>02124 <span class="stringliteral">    int fd                  File descriptor for connection</span>
<a name="l02125"></a>02125 <span class="stringliteral">    int adr                 Node address</span>
<a name="l02126"></a>02126 <span class="stringliteral"></span>
<a name="l02127"></a>02127 <span class="stringliteral">  Output:</span>
<a name="l02128"></a>02128 <span class="stringliteral">    none</span>
<a name="l02129"></a>02129 <span class="stringliteral"></span>
<a name="l02130"></a>02130 <span class="stringliteral">  Function value:</span>
<a name="l02131"></a>02131 <span class="stringliteral">    MSCB_SUCCESS            Successful completion</span>
<a name="l02132"></a>02132 <span class="stringliteral">    MSCB_TIMEOUT            Timeout receiving data</span>
<a name="l02133"></a>02133 <span class="stringliteral">    MSCB_MUTEX              Cannot obtain mutex for mscb</span>
<a name="l02134"></a>02134 <span class="stringliteral"></span>
<a name="l02135"></a>02135 <span class="stringliteral">\********************************************************************/</span>
<a name="l02136"></a>02136 <span class="stringliteral">{</span>
<a name="l02137"></a>02137 <span class="stringliteral">   int status;</span>
<a name="l02138"></a>02138 <span class="stringliteral"></span>
<a name="l02139"></a>02139 <span class="stringliteral">   if (fd &gt; MSCB_MAX_FD || fd &lt; 1 || !mscb_fd[fd - 1].type)</span>
<a name="l02140"></a>02140 <span class="stringliteral">      return MSCB_INVAL_PARAM;</span>
<a name="l02141"></a>02141 <span class="stringliteral"></span>
<a name="l02142"></a>02142 <span class="stringliteral">   if (mrpc_connected(fd))</span>
<a name="l02143"></a>02143 <span class="stringliteral">      return mrpc_call(mscb_fd[fd - 1].fd, RPC_MSCB_PING, mscb_fd[fd - 1].remote_fd, adr);</span>
<a name="l02144"></a>02144 <span class="stringliteral"></span>
<a name="l02145"></a>02145 <span class="stringliteral">   if (mscb_lock(fd) != MSCB_SUCCESS)</span>
<a name="l02146"></a>02146 <span class="stringliteral">      return MSCB_MUTEX;</span>
<a name="l02147"></a>02147 <span class="stringliteral"></span>
<a name="l02148"></a>02148 <span class="stringliteral">   status = mscb_addr(fd, MCMD_PING16, adr, 1, 0);</span>
<a name="l02149"></a>02149 <span class="stringliteral"></span>
<a name="l02150"></a>02150 <span class="stringliteral">   mscb_release(fd);</span>
<a name="l02151"></a>02151 <span class="stringliteral">   return status;</span>
<a name="l02152"></a>02152 <span class="stringliteral">}</span>
</pre></div></p>

</div>
</div>
<a class="anchor" id="a69d5b26c572cc81cb271a272ce778f14"></a><!-- doxytag: member="mscb.c::mscb_read" ref="a69d5b26c572cc81cb271a272ce778f14" args="(int fd, int adr, unsigned char index, void *data, int *size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_read </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l02939">2939</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="mscbutil_8c_source.html#l00187">crc8()</a>, <a class="el" href="msystem_8h_source.html#l00221">DWORD_SWAP</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="subm__250_8c_source.html#l00074">MCMD_ACK</a>, <a class="el" href="subm__250_8c_source.html#l00058">MCMD_PING16</a>, <a class="el" href="subm__250_8c_source.html#l00081">MCMD_READ</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8h_source.html#l00280">MSCB_CRC_ERROR</a>, <a class="el" href="mscb_8c_source.html#l01027">mscb_in()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8h_source.html#l00285">MSCB_NO_MEM</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8c_source.html#l02068">mscb_reset()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00281">MSCB_TIMEOUT</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="rpc_8h_source.html#l00155">RPC_MSCB_READ</a>, <a class="el" href="mana_8cpp_source.html#l00675">type</a>, and <a class="el" href="msystem_8h_source.html#l00214">WORD_SWAP</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>, <a class="el" href="calib__520_8c_source.html#l00036">main()</a>, <a class="el" href="mscb_8c_source.html#l03334">mscb_link()</a>, <a class="el" href="mscbdev_8c_source.html#l00186">mscbdev_get()</a>, and <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02942"></a>02942          : <a class="code" href="mscb_8c.html#a69d5b26c572cc81cb271a272ce778f14">mscb_read</a>
<a name="l02943"></a>02943 
<a name="l02944"></a>02944   Purpose: Read <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> from <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a> on node
<a name="l02945"></a>02945 
<a name="l02946"></a>02946   Input:
<a name="l02947"></a>02947     <span class="keywordtype">int</span> fd                  File descriptor <span class="keywordflow">for</span> connection
<a name="l02948"></a>02948     <span class="keywordtype">int</span> adr                 Node <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l02949"></a>02949     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>     Variable <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> 0..255
<a name="l02950"></a>02950     <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>                Buffer <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> <span class="keywordflow">for</span> <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>
<a name="l02951"></a>02951 
<a name="l02952"></a>02952   Output:
<a name="l02953"></a>02953     <span class="keywordtype">void</span> *<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>              Received <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>
<a name="l02954"></a>02954     <span class="keywordtype">int</span>  *<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>              Number of received bytes
<a name="l02955"></a>02955 
<a name="l02956"></a>02956   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l02957"></a>02957     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l02958"></a>02958     <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>            Timeout receiving acknowledge
<a name="l02959"></a>02959     <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>          CRC error
<a name="l02960"></a>02960     <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>        Parameter <span class="stringliteral">&quot;size&quot;</span> has invalid <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>
<a name="l02961"></a>02961     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l02962"></a>02962 
<a name="l02963"></a>02963 \********************************************************************/
<a name="l02964"></a>02964 {
<a name="l02965"></a>02965    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l02966"></a>02966    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[256], crc;
<a name="l02967"></a>02967 
<a name="l02968"></a>02968    memset(<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, 0, *<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l02969"></a>02969 
<a name="l02970"></a>02970    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l02971"></a>02971       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l02972"></a>02972 
<a name="l02973"></a>02973    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd))
<a name="l02974"></a>02974       <span class="keywordflow">return</span> <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#a4ef285641e20dd9783f38724955e35d9">RPC_MSCB_READ</a>, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd, adr, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l02975"></a>02975 
<a name="l02976"></a>02976    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd) != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l02977"></a>02977       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>;
<a name="l02978"></a>02978 
<a name="l02979"></a>02979    status = <a class="code" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a>(fd, <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>, adr, 10, 0);
<a name="l02980"></a>02980    <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l02981"></a>02981       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02982"></a>02982       <span class="keywordflow">return</span> status;
<a name="l02983"></a>02983    }
<a name="l02984"></a>02984 
<a name="l02985"></a>02985    <span class="comment">/* try ten times */</span>
<a name="l02986"></a>02986    <span class="keywordflow">for</span> (n = 0; n &lt; 10; n++) {
<a name="l02987"></a>02987       <span class="comment">/* after five times, reset submaster */</span>
<a name="l02988"></a>02988       <span class="keywordflow">if</span> (n == 5) {
<a name="l02989"></a>02989 <span class="preprocessor">#ifndef _USRDLL</span>
<a name="l02990"></a>02990 <span class="preprocessor"></span>         printf(<span class="stringliteral">&quot;Automatic submaster reset.\n&quot;</span>);
<a name="l02991"></a>02991 <span class="preprocessor">#endif</span>
<a name="l02992"></a>02992 <span class="preprocessor"></span>
<a name="l02993"></a>02993          <a class="code" href="mscb_8c.html#ac1aae2c6055ae4bdbb8ec9c7eeae6e2e">mscb_reset</a>(fd);
<a name="l02994"></a>02994          Sleep(100);
<a name="l02995"></a>02995       }
<a name="l02996"></a>02996 
<a name="l02997"></a>02997       buf[0] = <a class="code" href="subm__250_8c.html#adcaa72088508faa536a02c9332a04e09">MCMD_READ</a> + 1;
<a name="l02998"></a>02998       buf[1] = <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>;
<a name="l02999"></a>02999       buf[2] = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 2);
<a name="l03000"></a>03000       <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 3, 0);
<a name="l03001"></a>03001 
<a name="l03002"></a>03002       <span class="comment">/* read data */</span>
<a name="l03003"></a>03003       i = <a class="code" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a>(fd, buf, <span class="keyword">sizeof</span>(buf), 10000);
<a name="l03004"></a>03004 
<a name="l03005"></a>03005       <span class="keywordflow">if</span> (i == 1 &amp;&amp; buf[0] == 0xFF) {
<a name="l03006"></a>03006 <span class="preprocessor">#ifndef _USRDLL</span>
<a name="l03007"></a>03007 <span class="preprocessor"></span>         printf(<span class="stringliteral">&quot;Timeout from RS485 bus.\n&quot;</span>);
<a name="l03008"></a>03008 <span class="preprocessor">#endif</span>
<a name="l03009"></a>03009 <span class="preprocessor"></span>         <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l03010"></a>03010       }
<a name="l03011"></a>03011 
<a name="l03012"></a>03012       <span class="keywordflow">if</span> (i &lt; 2)
<a name="l03013"></a>03013          <span class="keywordflow">continue</span>;
<a name="l03014"></a>03014 
<a name="l03015"></a>03015       crc = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, i - 1);
<a name="l03016"></a>03016 
<a name="l03017"></a>03017       <span class="keywordflow">if</span> ((buf[0] != <a class="code" href="subm__250_8c.html#a796320244ecb94c4814f6d480f55e0be">MCMD_ACK</a> + i - 2 &amp;&amp; buf[0] != <a class="code" href="subm__250_8c.html#a796320244ecb94c4814f6d480f55e0be">MCMD_ACK</a> + 7)
<a name="l03018"></a>03018           || buf[i - 1] != crc)
<a name="l03019"></a>03019          <span class="keywordflow">continue</span>;
<a name="l03020"></a>03020 
<a name="l03021"></a>03021       <span class="keywordflow">if</span> (buf[0] == <a class="code" href="subm__250_8c.html#a796320244ecb94c4814f6d480f55e0be">MCMD_ACK</a> + 7) {
<a name="l03022"></a>03022          <span class="keywordflow">if</span> (i - 3 &gt; *<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>) {
<a name="l03023"></a>03023             <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l03024"></a>03024             *<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> = 0;
<a name="l03025"></a>03025             <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a66e207e27dbfb8c1055534b286e3eadd">MSCB_NO_MEM</a>;
<a name="l03026"></a>03026          }
<a name="l03027"></a>03027 
<a name="l03028"></a>03028          memcpy(<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, buf + 2, i - 3);  <span class="comment">// variable length</span>
<a name="l03029"></a>03029          *<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> = i - 3;
<a name="l03030"></a>03030       } <span class="keywordflow">else</span> {
<a name="l03031"></a>03031          <span class="keywordflow">if</span> (i - 2 &gt; *<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>) {
<a name="l03032"></a>03032             <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l03033"></a>03033             *<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> = 0;
<a name="l03034"></a>03034             <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a66e207e27dbfb8c1055534b286e3eadd">MSCB_NO_MEM</a>;
<a name="l03035"></a>03035          }
<a name="l03036"></a>03036 
<a name="l03037"></a>03037          memcpy(<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, buf + 1, i - 2);
<a name="l03038"></a>03038          *<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> = i - 2;
<a name="l03039"></a>03039       }
<a name="l03040"></a>03040 
<a name="l03041"></a>03041       <span class="keywordflow">if</span> (i - 2 == 2)
<a name="l03042"></a>03042          <a class="code" href="group__msmacroh.html#ga4670ac841b4b8e3c3141a91a743bc61d">WORD_SWAP</a>(<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>);
<a name="l03043"></a>03043       <span class="keywordflow">if</span> (i - 2 == 4)
<a name="l03044"></a>03044          <a class="code" href="group__msmacroh.html#gadb40ea04e4e009bbde68c027a8f95039">DWORD_SWAP</a>(<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>);
<a name="l03045"></a>03045 
<a name="l03046"></a>03046       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l03047"></a>03047       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l03048"></a>03048    }
<a name="l03049"></a>03049 
<a name="l03050"></a>03050    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l03051"></a>03051 
<a name="l03052"></a>03052    <span class="keywordflow">if</span> (i &lt; 2)
<a name="l03053"></a>03053       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l03054"></a>03054 
<a name="l03055"></a>03055    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>;
<a name="l03056"></a>03056 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a201e82083822cbb032f0e0b1eeab53a1"></a><!-- doxytag: member="mscb.c::mscb_read_range" ref="a201e82083822cbb032f0e0b1eeab53a1" args="(int fd, int adr, unsigned char index1, unsigned char index2, void *data, int *size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_read_range </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&nbsp;</td>
          <td class="paramname"> <em>index1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&nbsp;</td>
          <td class="paramname"> <em>index2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l03060">3060</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="mscbutil_8c_source.html#l00187">crc8()</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="subm__250_8c_source.html#l00074">MCMD_ACK</a>, <a class="el" href="subm__250_8c_source.html#l00058">MCMD_PING16</a>, <a class="el" href="subm__250_8c_source.html#l00081">MCMD_READ</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8h_source.html#l00280">MSCB_CRC_ERROR</a>, <a class="el" href="mscb_8c_source.html#l01027">mscb_in()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8c_source.html#l02068">mscb_reset()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00281">MSCB_TIMEOUT</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="rpc_8h_source.html#l00156">RPC_MSCB_READ_RANGE</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03063"></a>03063          : <a class="code" href="mscb_8c.html#a69d5b26c572cc81cb271a272ce778f14">mscb_read</a>
<a name="l03064"></a>03064 
<a name="l03065"></a>03065   Purpose: Read <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> from <a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> on node
<a name="l03066"></a>03066 
<a name="l03067"></a>03067   Input:
<a name="l03068"></a>03068     <span class="keywordtype">int</span> fd                  File descriptor <span class="keywordflow">for</span> connection
<a name="l03069"></a>03069     <span class="keywordtype">int</span> adr                 Node <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l03070"></a>03070     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> index1    First <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> to <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>
<a name="l03071"></a>03071     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> index2    Last <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> to <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>
<a name="l03072"></a>03072     <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>                Buffer <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> <span class="keywordflow">for</span> <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>
<a name="l03073"></a>03073 
<a name="l03074"></a>03074   Output:
<a name="l03075"></a>03075     <span class="keywordtype">void</span> *<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>              Received <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>
<a name="l03076"></a>03076     <span class="keywordtype">int</span>  *<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>              Number of received bytes
<a name="l03077"></a>03077 
<a name="l03078"></a>03078   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l03079"></a>03079     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l03080"></a>03080     <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>            Timeout receiving acknowledge
<a name="l03081"></a>03081     <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>          CRC error
<a name="l03082"></a>03082     <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>        Parameter <span class="stringliteral">&quot;size&quot;</span> has invalid <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>
<a name="l03083"></a>03083     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l03084"></a>03084 
<a name="l03085"></a>03085 \********************************************************************/
<a name="l03086"></a>03086 {
<a name="l03087"></a>03087    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l03088"></a>03088    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[256], crc;
<a name="l03089"></a>03089 
<a name="l03090"></a>03090    memset(<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, 0, *<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l03091"></a>03091 
<a name="l03092"></a>03092    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l03093"></a>03093       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l03094"></a>03094 
<a name="l03095"></a>03095    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd))
<a name="l03096"></a>03096       <span class="keywordflow">return</span> <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#a1967331ab0b89d2b41410bdee44e2623">RPC_MSCB_READ_RANGE</a>,
<a name="l03097"></a>03097                        <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd, adr, index1, index2, <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l03098"></a>03098 
<a name="l03099"></a>03099    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd) != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l03100"></a>03100       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>;
<a name="l03101"></a>03101 
<a name="l03102"></a>03102    status = <a class="code" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a>(fd, <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>, adr, 10, 0);
<a name="l03103"></a>03103    <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l03104"></a>03104       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l03105"></a>03105       <span class="keywordflow">return</span> status;
<a name="l03106"></a>03106    }
<a name="l03107"></a>03107 
<a name="l03108"></a>03108    <span class="comment">/* try ten times */</span>
<a name="l03109"></a>03109    <span class="keywordflow">for</span> (n = 0; n &lt; 10; n++) {
<a name="l03110"></a>03110       <span class="comment">/* after five times, reset submaster */</span>
<a name="l03111"></a>03111       <span class="keywordflow">if</span> (n == 5) {
<a name="l03112"></a>03112 <span class="preprocessor">#ifndef _USRDLL</span>
<a name="l03113"></a>03113 <span class="preprocessor"></span>         printf(<span class="stringliteral">&quot;Automatic submaster reset.\n&quot;</span>);
<a name="l03114"></a>03114 <span class="preprocessor">#endif</span>
<a name="l03115"></a>03115 <span class="preprocessor"></span>
<a name="l03116"></a>03116          <a class="code" href="mscb_8c.html#ac1aae2c6055ae4bdbb8ec9c7eeae6e2e">mscb_reset</a>(fd);
<a name="l03117"></a>03117          Sleep(100);
<a name="l03118"></a>03118       }
<a name="l03119"></a>03119 
<a name="l03120"></a>03120       buf[0] = <a class="code" href="subm__250_8c.html#adcaa72088508faa536a02c9332a04e09">MCMD_READ</a> + 2;
<a name="l03121"></a>03121       buf[1] = index1;
<a name="l03122"></a>03122       buf[2] = index2;
<a name="l03123"></a>03123       buf[3] = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 3);
<a name="l03124"></a>03124       <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 4, 0);
<a name="l03125"></a>03125 
<a name="l03126"></a>03126       <span class="comment">/* read data */</span>
<a name="l03127"></a>03127       i = <a class="code" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a>(fd, buf, 256, 10000);
<a name="l03128"></a>03128 
<a name="l03129"></a>03129       <span class="keywordflow">if</span> (i &lt; 2)
<a name="l03130"></a>03130          <span class="keywordflow">continue</span>;
<a name="l03131"></a>03131 
<a name="l03132"></a>03132       crc = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, i - 1);
<a name="l03133"></a>03133 
<a name="l03134"></a>03134       <span class="keywordflow">if</span> (buf[0] != <a class="code" href="subm__250_8c.html#a796320244ecb94c4814f6d480f55e0be">MCMD_ACK</a> + 7 || buf[i - 1] != crc)
<a name="l03135"></a>03135          <span class="keywordflow">continue</span>;
<a name="l03136"></a>03136 
<a name="l03137"></a>03137       memcpy(<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, buf + 2, i - 3);
<a name="l03138"></a>03138       *<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> = i - 3;
<a name="l03139"></a>03139 
<a name="l03140"></a>03140       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l03141"></a>03141       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l03142"></a>03142    }
<a name="l03143"></a>03143 
<a name="l03144"></a>03144    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l03145"></a>03145 
<a name="l03146"></a>03146    <span class="keywordflow">if</span> (i &lt; 2)
<a name="l03147"></a>03147       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l03148"></a>03148 
<a name="l03149"></a>03149    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>;
<a name="l03150"></a>03150 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a32959634b103e904401d46c8b96ec53f"></a><!-- doxytag: member="mscb.c::mscb_reboot" ref="a32959634b103e904401d46c8b96ec53f" args="(int fd, int adr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_reboot </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l02021">2021</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="mscbutil_8c_source.html#l00187">crc8()</a>, <a class="el" href="subm__250_8c_source.html#l00060">MCMD_INIT</a>, <a class="el" href="subm__250_8c_source.html#l00058">MCMD_PING16</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="rpc_8h_source.html#l00146">RPC_MSCB_REBOOT</a>, <a class="el" href="subm__250_8c_source.html#l00092">RS485_FLAG_NO_ACK</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>, and <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02024"></a>02024          : <a class="code" href="mscb_8c.html#a32959634b103e904401d46c8b96ec53f">mscb_reboot</a>
<a name="l02025"></a>02025 
<a name="l02026"></a>02026   Purpose: Reboot node <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> sending <a class="code" href="subm__250_8c.html#abe2abef2420e9abc8660cf7b5a463f28">MCMD_INIT</a>
<a name="l02027"></a>02027 
<a name="l02028"></a>02028   Input:
<a name="l02029"></a>02029     <span class="keywordtype">int</span> fd                  File descriptor <span class="keywordflow">for</span> connection
<a name="l02030"></a>02030     <span class="keywordtype">int</span> adr                 Node <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l02031"></a>02031 
<a name="l02032"></a>02032   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l02033"></a>02033     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l02034"></a>02034     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l02035"></a>02035     <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>            Timeout receiving ping acknowledge
<a name="l02036"></a>02036 
<a name="l02037"></a>02037 \********************************************************************/
<a name="l02038"></a>02038 {
<a name="l02039"></a>02039    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[10];
<a name="l02040"></a>02040    <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l02041"></a>02041 
<a name="l02042"></a>02042    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l02043"></a>02043       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l02044"></a>02044 
<a name="l02045"></a>02045    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd))
<a name="l02046"></a>02046       <span class="keywordflow">return</span> <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#a58d499237e057b69babe61bef68ba055">RPC_MSCB_REBOOT</a>, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd, adr);
<a name="l02047"></a>02047 
<a name="l02048"></a>02048    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd) != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l02049"></a>02049       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>;
<a name="l02050"></a>02050 
<a name="l02051"></a>02051    status = <a class="code" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a>(fd, <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>, adr, 10, 0);
<a name="l02052"></a>02052    <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l02053"></a>02053       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02054"></a>02054       <span class="keywordflow">return</span> status;
<a name="l02055"></a>02055    }
<a name="l02056"></a>02056 
<a name="l02057"></a>02057    buf[0] = <a class="code" href="subm__250_8c.html#abe2abef2420e9abc8660cf7b5a463f28">MCMD_INIT</a>;
<a name="l02058"></a>02058    buf[1] = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 1);
<a name="l02059"></a>02059    <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 2, <a class="code" href="subm__250_8c.html#a1265f1c3f2fdd44625d8392cc53d49e1">RS485_FLAG_NO_ACK</a>);
<a name="l02060"></a>02060 
<a name="l02061"></a>02061    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02062"></a>02062 
<a name="l02063"></a>02063    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l02064"></a>02064 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5296ed7a23f4b24dc6e4d9607e67ce5e"></a><!-- doxytag: member="mscb.c::mscb_release" ref="a5296ed7a23f4b24dc6e4d9607e67ce5e" args="(int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_release </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00597">597</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00262">MSCB_TYPE_LPT</a>, <a class="el" href="mscb_8h_source.html#l00263">MSCB_TYPE_USB</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01112">lpt_init()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8c_source.html#l01833">mscb_check()</a>, <a class="el" href="mscb_8c_source.html#l03243">mscb_echo()</a>, <a class="el" href="mscb_8c_source.html#l02626">mscb_flash()</a>, <a class="el" href="mscb_8c_source.html#l02156">mscb_info()</a>, <a class="el" href="mscb_8c_source.html#l02221">mscb_info_variable()</a>, <a class="el" href="mscb_8c_source.html#l01593">mscb_init()</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l02116">mscb_ping()</a>, <a class="el" href="mscb_8c_source.html#l02939">mscb_read()</a>, <a class="el" href="mscb_8c_source.html#l03060">mscb_read_range()</a>, <a class="el" href="mscb_8c_source.html#l02021">mscb_reboot()</a>, <a class="el" href="mscb_8c_source.html#l02068">mscb_reset()</a>, <a class="el" href="mscb_8c_source.html#l02286">mscb_set_addr()</a>, <a class="el" href="mscb_8c_source.html#l02345">mscb_set_name()</a>, <a class="el" href="mscb_8c_source.html#l02686">mscb_upload()</a>, <a class="el" href="mscb_8c_source.html#l03154">mscb_user()</a>, <a class="el" href="mscb_8c_source.html#l02461">mscb_write()</a>, <a class="el" href="mscb_8c_source.html#l02549">mscb_write_block()</a>, and <a class="el" href="mscb_8c_source.html#l02401">mscb_write_group()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00598"></a>00598 {
<a name="l00599"></a>00599 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00600"></a>00600 <span class="preprocessor"></span>   <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l00601"></a>00601 
<a name="l00602"></a>00602    status = ReleaseMutex(mutex_handle);
<a name="l00603"></a>00603    <span class="keywordflow">if</span> (status == <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l00604"></a>00604       <span class="keywordflow">return</span> 0;
<a name="l00605"></a>00605 
<a name="l00606"></a>00606 <span class="preprocessor">#elif defined(OS_LINUX)</span>
<a name="l00607"></a>00607 <span class="preprocessor"></span>
<a name="l00608"></a>00608    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> == <a class="code" href="mscb_8h.html#a4fb1beb5d116c3a7d04f422bdaf33262">MSCB_TYPE_LPT</a>) {
<a name="l00609"></a>00609       <span class="keywordflow">if</span> (ioctl(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, PPRELEASE))
<a name="l00610"></a>00610          <span class="keywordflow">return</span> 0;
<a name="l00611"></a>00611    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> == <a class="code" href="mscb_8h.html#a6543e1aedd1d4ca2ce5d964979fa8c5c">MSCB_TYPE_USB</a>) {
<a name="l00612"></a>00612       <span class="keywordflow">if</span> (usb_release_interface((usb_dev_handle *) <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].hr, 0) &lt; 0)
<a name="l00613"></a>00613          <span class="keywordflow">return</span> 0;
<a name="l00614"></a>00614    }
<a name="l00615"></a>00615 <span class="preprocessor">#endif</span>
<a name="l00616"></a>00616 <span class="preprocessor"></span>   <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l00617"></a>00617 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac1aae2c6055ae4bdbb8ec9c7eeae6e2e"></a><!-- doxytag: member="mscb.c::mscb_reset" ref="ac1aae2c6055ae4bdbb8ec9c7eeae6e2e" args="(int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_reset </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l02068">2068</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="mscb_8c_source.html#l00321">LPT_RESET</a>, <a class="el" href="subm__250_8c_source.html#l00060">MCMD_INIT</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00262">MSCB_TYPE_LPT</a>, <a class="el" href="mscb_8h_source.html#l00263">MSCB_TYPE_USB</a>, <a class="el" href="mscb_8c_source.html#l01564">musb_close()</a>, <a class="el" href="mscb_8c.html#aca3f3982b04c5e7e5884b831f886a333">musb_init()</a>, <a class="el" href="mscb_8c_source.html#l00621">pp_wcontrol()</a>, <a class="el" href="rpc_8h_source.html#l00145">RPC_MSCB_RESET</a>, <a class="el" href="subm__250_8c_source.html#l00095">RS485_FLAG_CMD</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l02939">mscb_read()</a>, <a class="el" href="mscb_8c_source.html#l03060">mscb_read_range()</a>, and <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02071"></a>02071          : <a class="code" href="mscb_8c.html#ac1aae2c6055ae4bdbb8ec9c7eeae6e2e">mscb_reset</a>
<a name="l02072"></a>02072 
<a name="l02073"></a>02073   Purpose: Reset submaster via hardware reset
<a name="l02074"></a>02074 
<a name="l02075"></a>02075   Input:
<a name="l02076"></a>02076     <span class="keywordtype">int</span> fd                  File descriptor <span class="keywordflow">for</span> connection
<a name="l02077"></a>02077 
<a name="l02078"></a>02078   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l02079"></a>02079     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l02080"></a>02080     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l02081"></a>02081 
<a name="l02082"></a>02082 \********************************************************************/
<a name="l02083"></a>02083 {
<a name="l02084"></a>02084    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l02085"></a>02085       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l02086"></a>02086 
<a name="l02087"></a>02087    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd))
<a name="l02088"></a>02088       <span class="keywordflow">return</span> <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#a280740afb5814b3f37478fd973a235d2">RPC_MSCB_RESET</a>, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd);
<a name="l02089"></a>02089 
<a name="l02090"></a>02090    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd) != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l02091"></a>02091       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>;
<a name="l02092"></a>02092 
<a name="l02093"></a>02093    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> == <a class="code" href="mscb_8h.html#a4fb1beb5d116c3a7d04f422bdaf33262">MSCB_TYPE_LPT</a>) {
<a name="l02094"></a>02094       <span class="comment">/* toggle reset */</span>
<a name="l02095"></a>02095       <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(fd, <a class="code" href="mscb_8c.html#add1804fb4ed8a17464e7c516b51ac72b">LPT_RESET</a>, 1);
<a name="l02096"></a>02096       Sleep(100);               <span class="comment">// for elko</span>
<a name="l02097"></a>02097       <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(fd, <a class="code" href="mscb_8c.html#add1804fb4ed8a17464e7c516b51ac72b">LPT_RESET</a>, 0);
<a name="l02098"></a>02098    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> == <a class="code" href="mscb_8h.html#a6543e1aedd1d4ca2ce5d964979fa8c5c">MSCB_TYPE_USB</a>) {
<a name="l02099"></a>02099 
<a name="l02100"></a>02100       <span class="keywordtype">char</span> <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[10];
<a name="l02101"></a>02101 
<a name="l02102"></a>02102       buf[0] = <a class="code" href="subm__250_8c.html#abe2abef2420e9abc8660cf7b5a463f28">MCMD_INIT</a>;
<a name="l02103"></a>02103       <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 1, <a class="code" href="subm__250_8c.html#a23b3240a4ffbe66e078cb0e6a2aa5ba7">RS485_FLAG_CMD</a>);
<a name="l02104"></a>02104       <a class="code" href="mscb_8c.html#aa518f900dd243fca1f06fc3ca2f0974e">musb_close</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].hr, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].hw);
<a name="l02105"></a>02105       Sleep(1000);
<a name="l02106"></a>02106       <a class="code" href="mscb_8c.html#aca3f3982b04c5e7e5884b831f886a333">musb_init</a>(atoi(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].device + 3), &amp;<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].hr, &amp;<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].hw);
<a name="l02107"></a>02107    }
<a name="l02108"></a>02108 
<a name="l02109"></a>02109    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02110"></a>02110 
<a name="l02111"></a>02111    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l02112"></a>02112 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac1c6cabb70727474ecfd7f1e98cc193f"></a><!-- doxytag: member="mscb.c::mscb_select_device" ref="ac1c6cabb70727474ecfd7f1e98cc193f" args="(char *device, int size, int select)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_select_device </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>select</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l03438">3438</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mscb_8c_source.html#l01247">lpt_close()</a>, <a class="el" href="mscb_8c_source.html#l01112">lpt_init()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00262">MSCB_TYPE_LPT</a>, <a class="el" href="mscb_8c.html#aca3f3982b04c5e7e5884b831f886a333">musb_init()</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="mscb_8c_source.html#l00414">strlcpy()</a>, and <a class="el" href="mscb_8h_source.html#l00269">MSCB_FD::type</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01593">mscb_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03441"></a>03441          : <a class="code" href="mscb_8c.html#ac1c6cabb70727474ecfd7f1e98cc193f">mscb_select_device</a>
<a name="l03442"></a>03442 
<a name="l03443"></a>03443   Purpose: Select MSCB submaster device. Show dialog <span class="keywordflow">if</span> sevral
<a name="l03444"></a>03444            possibilities
<a name="l03445"></a>03445 
<a name="l03446"></a>03446   Input:
<a name="l03447"></a>03447     none
<a name="l03448"></a>03448 
<a name="l03449"></a>03449   Output:
<a name="l03450"></a>03450     <span class="keywordtype">char</span> *device            Device <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>
<a name="l03451"></a>03451     <span class="keywordtype">int</span>  <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>               Size of device <span class="keywordtype">string</span> <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> bytes
<a name="l03452"></a>03452     <span class="keywordtype">int</span>  select             If 1, ask user which device to select,
<a name="l03453"></a>03453                             <span class="keywordflow">if</span> zero, use first device (<span class="keywordflow">for</span> Labview)
<a name="l03454"></a>03454 
<a name="l03455"></a>03455   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l03456"></a>03456     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l03457"></a>03457     0                       No submaster <a class="code" href="patch__mevb_8cpp.html#a408216eef095a35ba3963fc6f4f4d7a8">found</a>
<a name="l03458"></a>03458 
<a name="l03459"></a>03459 \********************************************************************/
<a name="l03460"></a>03460 {
<a name="l03461"></a>03461    <span class="keywordtype">char</span> <a class="code" href="namespacemodules.html#a12afb64f27b8a4e356d665de83e78ad3">list</a>[10][256], <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l03462"></a>03462    <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, error_code;
<a name="l03463"></a>03463 
<a name="l03464"></a>03464    n = 0;
<a name="l03465"></a>03465    *device = 0;
<a name="l03466"></a>03466    error_code = 0;
<a name="l03467"></a>03467 
<a name="l03468"></a>03468    <span class="comment">/* search for temporary file descriptor */</span>
<a name="l03469"></a>03469    <span class="keywordflow">for</span> (index = 0; index &lt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a>; index++)
<a name="l03470"></a>03470       <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].fd == 0)
<a name="l03471"></a>03471          <span class="keywordflow">break</span>;
<a name="l03472"></a>03472 
<a name="l03473"></a>03473    <span class="keywordflow">if</span> (index == MSCB_MAX_FD)
<a name="l03474"></a>03474       <span class="keywordflow">return</span> -1;
<a name="l03475"></a>03475 
<a name="l03476"></a>03476    <span class="comment">/* check USB devices */</span>
<a name="l03477"></a>03477    <span class="keywordflow">for</span> (i = 0; i &lt; 127; i++) {
<a name="l03478"></a>03478       status = <a class="code" href="mscb_8c.html#aca3f3982b04c5e7e5884b831f886a333">musb_init</a>(i, NULL, NULL);
<a name="l03479"></a>03479       <span class="keywordflow">if</span> (status != -1)
<a name="l03480"></a>03480          sprintf(list[n++], <span class="stringliteral">&quot;usb%d&quot;</span>, i);
<a name="l03481"></a>03481       <span class="keywordflow">else</span>
<a name="l03482"></a>03482          <span class="keywordflow">break</span>;
<a name="l03483"></a>03483    }
<a name="l03484"></a>03484 
<a name="l03485"></a>03485    <span class="comment">/* check LPT devices */</span>
<a name="l03486"></a>03486    <span class="keywordflow">for</span> (i = 0; i &lt; 1; i++) {
<a name="l03487"></a>03487 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l03488"></a>03488 <span class="preprocessor"></span>      sprintf(str, <span class="stringliteral">&quot;lpt%d&quot;</span>, i + 1);
<a name="l03489"></a>03489 <span class="preprocessor">#else</span>
<a name="l03490"></a>03490 <span class="preprocessor"></span>      sprintf(str, <span class="stringliteral">&quot;/dev/parport%d&quot;</span>, i);
<a name="l03491"></a>03491 <span class="preprocessor">#endif</span>
<a name="l03492"></a>03492 <span class="preprocessor"></span>
<a name="l03493"></a>03493       <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].<a class="code" href="structMSCB__FD.html#ae427fc239f83f01f7a3d8a128cb9b2a3">type</a> = <a class="code" href="mscb_8h.html#a4fb1beb5d116c3a7d04f422bdaf33262">MSCB_TYPE_LPT</a>;
<a name="l03494"></a>03494 
<a name="l03495"></a>03495       status = <a class="code" href="mscb_8c.html#a0e5e695349a0e95873a34db09d5b6383">lpt_init</a>(str, index);
<a name="l03496"></a>03496       <span class="keywordflow">if</span> (status &lt; 0)
<a name="l03497"></a>03497          error_code = status;
<a name="l03498"></a>03498       <span class="keywordflow">else</span>
<a name="l03499"></a>03499          <a class="code" href="mscb_8c.html#a42fe0df05ae6c2f64bbea26021a4d5ce">lpt_close</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index].fd);
<a name="l03500"></a>03500       memset(&amp;<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[index], 0, <span class="keyword">sizeof</span>(<a class="code" href="structMSCB__FD.html">MSCB_FD</a>));
<a name="l03501"></a>03501       <span class="keywordflow">if</span> (status == 0)
<a name="l03502"></a>03502          sprintf(list[n++], str);
<a name="l03503"></a>03503       <span class="keywordflow">else</span>
<a name="l03504"></a>03504          <span class="keywordflow">break</span>;
<a name="l03505"></a>03505    }
<a name="l03506"></a>03506 
<a name="l03507"></a>03507    <span class="keywordflow">if</span> (n == 0) {
<a name="l03508"></a>03508       <span class="keywordflow">if</span> (error_code == -3)
<a name="l03509"></a>03509          printf(<span class="stringliteral">&quot;mscb.c: Cannot access parallel port (No DirectIO driver installed)\n&quot;</span>);
<a name="l03510"></a>03510       <span class="keywordflow">if</span> (error_code == -4)
<a name="l03511"></a>03511          printf(<span class="stringliteral">&quot;mscb.c: Cannot access parallel port, locked by other application\n&quot;</span>);
<a name="l03512"></a>03512       <span class="keywordflow">return</span> 0;
<a name="l03513"></a>03513    }
<a name="l03514"></a>03514 
<a name="l03515"></a>03515    <span class="comment">/* if only one device, return it */</span>
<a name="l03516"></a>03516    <span class="keywordflow">if</span> (n == 1 || select == 0) {
<a name="l03517"></a>03517       <a class="code" href="mscb_8c.html#a4637af6f79bac4043e1064f0837d0ddc">strlcpy</a>(device, list[0], <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l03518"></a>03518       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l03519"></a>03519    }
<a name="l03520"></a>03520 
<a name="l03521"></a>03521    <span class="keywordflow">do</span> {
<a name="l03522"></a>03522       printf(<span class="stringliteral">&quot;Found several submasters, please select one:\n\n&quot;</span>);
<a name="l03523"></a>03523       <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l03524"></a>03524          printf(<span class="stringliteral">&quot;%d: %s\n&quot;</span>, i + 1, list[i]);
<a name="l03525"></a>03525 
<a name="l03526"></a>03526       printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03527"></a>03527       fgets(str, <span class="keyword">sizeof</span>(str), stdin);
<a name="l03528"></a>03528       i = atoi(str);
<a name="l03529"></a>03529       <span class="keywordflow">if</span> (i &gt; 0 &amp;&amp; i &lt;= n) {
<a name="l03530"></a>03530          <a class="code" href="mscb_8c.html#a4637af6f79bac4043e1064f0837d0ddc">strlcpy</a>(device, list[i - 1], <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l03531"></a>03531          <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l03532"></a>03532       }
<a name="l03533"></a>03533 
<a name="l03534"></a>03534       printf(<span class="stringliteral">&quot;Invalid selection, please enter again\n&quot;</span>);
<a name="l03535"></a>03535    } <span class="keywordflow">while</span> (1);
<a name="l03536"></a>03536 
<a name="l03537"></a>03537    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l03538"></a>03538 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a93968d67e92a88d97ea06783bc391ffa"></a><!-- doxytag: member="mscb.c::mscb_set_addr" ref="a93968d67e92a88d97ea06783bc391ffa" args="(int fd, int adr, int node, int group)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_set_addr </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>group</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l02286">2286</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="mscbutil_8c_source.html#l00187">crc8()</a>, <a class="el" href="subm__250_8c_source.html#l00058">MCMD_PING16</a>, <a class="el" href="subm__250_8c_source.html#l00062">MCMD_SET_ADDR</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8h_source.html#l00287">MSCB_ADDR_EXISTS</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="rpc_8h_source.html#l00150">RPC_MSCB_SET_ADDR</a>, <a class="el" href="subm__250_8c_source.html#l00092">RS485_FLAG_NO_ACK</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>, and <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02289"></a>02289          : <a class="code" href="mscb_8c.html#a93968d67e92a88d97ea06783bc391ffa">mscb_set_addr</a>
<a name="l02290"></a>02290 
<a name="l02291"></a>02291   Purpose: Set node <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> group <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a> of an node
<a name="l02292"></a>02292 
<a name="l02293"></a>02293   Input:
<a name="l02294"></a>02294     <span class="keywordtype">int</span> fd                  File descriptor <span class="keywordflow">for</span> connection
<a name="l02295"></a>02295     <span class="keywordtype">int</span> adr                 Node <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l02296"></a>02296     <span class="keywordtype">int</span> node                16-bit node <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l02297"></a>02297     <span class="keywordtype">int</span> group               16-bit group <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l02298"></a>02298 
<a name="l02299"></a>02299   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l02300"></a>02300     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l02301"></a>02301     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l02302"></a>02302 
<a name="l02303"></a>02303 \********************************************************************/
<a name="l02304"></a>02304 {
<a name="l02305"></a>02305    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[8];
<a name="l02306"></a>02306    <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l02307"></a>02307 
<a name="l02308"></a>02308    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l02309"></a>02309       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l02310"></a>02310 
<a name="l02311"></a>02311    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd))
<a name="l02312"></a>02312       <span class="keywordflow">return</span> <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#af0b345076fbe3e681df331db8cea9fa5">RPC_MSCB_SET_ADDR</a>, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd, adr, node, group);
<a name="l02313"></a>02313 
<a name="l02314"></a>02314    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd) != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l02315"></a>02315       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>;
<a name="l02316"></a>02316 
<a name="l02317"></a>02317    <span class="comment">/* check if destination address is alive */</span>
<a name="l02318"></a>02318    status = <a class="code" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a>(fd, <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>, node, 10, 0);
<a name="l02319"></a>02319    <span class="keywordflow">if</span> (status == <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l02320"></a>02320       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02321"></a>02321       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeebc083b23cf05d956306b197fb6e6da">MSCB_ADDR_EXISTS</a>;
<a name="l02322"></a>02322    }
<a name="l02323"></a>02323 
<a name="l02324"></a>02324    status = <a class="code" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a>(fd, <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>, adr, 10, 0);
<a name="l02325"></a>02325    <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l02326"></a>02326       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02327"></a>02327       <span class="keywordflow">return</span> status;
<a name="l02328"></a>02328    }
<a name="l02329"></a>02329 
<a name="l02330"></a>02330    buf[0] = <a class="code" href="subm__250_8c.html#ac92907e11e65bbb9593cbe59df07659a">MCMD_SET_ADDR</a>;
<a name="l02331"></a>02331    buf[1] = (<span class="keywordtype">unsigned</span> char) (node &gt;&gt; 8);
<a name="l02332"></a>02332    buf[2] = (<span class="keywordtype">unsigned</span> char) (node &amp; 0xFF);
<a name="l02333"></a>02333    buf[3] = (<span class="keywordtype">unsigned</span> char) (group &gt;&gt; 8);
<a name="l02334"></a>02334    buf[4] = (<span class="keywordtype">unsigned</span> char) (group &amp; 0xFF);
<a name="l02335"></a>02335    buf[5] = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 5);
<a name="l02336"></a>02336    <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 6, <a class="code" href="subm__250_8c.html#a1265f1c3f2fdd44625d8392cc53d49e1">RS485_FLAG_NO_ACK</a>);
<a name="l02337"></a>02337 
<a name="l02338"></a>02338    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02339"></a>02339 
<a name="l02340"></a>02340    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l02341"></a>02341 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7c4b7c89e256c181677ab43cfc3a5fd4"></a><!-- doxytag: member="mscb.c::mscb_set_name" ref="a7c4b7c89e256c181677ab43cfc3a5fd4" args="(int fd, int adr, char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_set_name </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l02345">2345</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="mscbutil_8c_source.html#l00187">crc8()</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="subm__250_8c_source.html#l00058">MCMD_PING16</a>, <a class="el" href="subm__250_8c_source.html#l00062">MCMD_SET_ADDR</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="rpc_8h_source.html#l00159">RPC_MSCB_SET_NAME</a>, <a class="el" href="subm__250_8c_source.html#l00092">RS485_FLAG_NO_ACK</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>, and <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02348"></a>02348          : <a class="code" href="mscb_8c.html#a7c4b7c89e256c181677ab43cfc3a5fd4">mscb_set_name</a>
<a name="l02349"></a>02349 
<a name="l02350"></a>02350   Purpose: Set node <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>
<a name="l02351"></a>02351 
<a name="l02352"></a>02352   Input:
<a name="l02353"></a>02353     <span class="keywordtype">int</span> fd                  File descriptor <span class="keywordflow">for</span> connection
<a name="l02354"></a>02354     <span class="keywordtype">int</span> adr                 Node <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l02355"></a>02355     <span class="keywordtype">char</span> *<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>              New node <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>, up to 16 characters
<a name="l02356"></a>02356 
<a name="l02357"></a>02357   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l02358"></a>02358     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l02359"></a>02359     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l02360"></a>02360 
<a name="l02361"></a>02361 \********************************************************************/
<a name="l02362"></a>02362 {
<a name="l02363"></a>02363    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[256];
<a name="l02364"></a>02364    <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l02365"></a>02365 
<a name="l02366"></a>02366    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l02367"></a>02367       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l02368"></a>02368 
<a name="l02369"></a>02369    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd))
<a name="l02370"></a>02370       <span class="keywordflow">return</span> <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#a1c46dd0cde00c49bb27267e2dcb35064">RPC_MSCB_SET_NAME</a>, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd, adr, <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>);
<a name="l02371"></a>02371 
<a name="l02372"></a>02372    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd) != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l02373"></a>02373       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>;
<a name="l02374"></a>02374 
<a name="l02375"></a>02375    status = <a class="code" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a>(fd, <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>, adr, 10, 0);
<a name="l02376"></a>02376    <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l02377"></a>02377 
<a name="l02378"></a>02378       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02379"></a>02379       <span class="keywordflow">return</span> status;
<a name="l02380"></a>02380    }
<a name="l02381"></a>02381 
<a name="l02382"></a>02382    buf[0] = <a class="code" href="subm__250_8c.html#ac92907e11e65bbb9593cbe59df07659a">MCMD_SET_ADDR</a> | 0x07;
<a name="l02383"></a>02383    <span class="keywordflow">for</span> (i = 0; i &lt; 16 &amp;&amp; <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>[i]; i++)
<a name="l02384"></a>02384       buf[2 + i] = name[i];
<a name="l02385"></a>02385 
<a name="l02386"></a>02386    <span class="keywordflow">if</span> (i &lt; 16)
<a name="l02387"></a>02387       buf[2 + (i++)] = 0;
<a name="l02388"></a>02388 
<a name="l02389"></a>02389    buf[1] = i;                  <span class="comment">/* varibale buffer length */</span>
<a name="l02390"></a>02390 
<a name="l02391"></a>02391    buf[2 + i] = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 2 + i);
<a name="l02392"></a>02392    <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 3 + i, <a class="code" href="subm__250_8c.html#a1265f1c3f2fdd44625d8392cc53d49e1">RS485_FLAG_NO_ACK</a>);
<a name="l02393"></a>02393 
<a name="l02394"></a>02394    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02395"></a>02395 
<a name="l02396"></a>02396    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l02397"></a>02397 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3037b604bf35bf8a5b1530ccc388e83e"></a><!-- doxytag: member="mscb.c::mscb_upload" ref="a3037b604bf35bf8a5b1530ccc388e83e" args="(int fd, int adr, char *buffer, int size, int debug)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_upload </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>debug</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l02686">2686</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="mscbutil_8c_source.html#l00187">crc8()</a>, <a class="el" href="system_8c_source.html#l00966">d</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="subm__250_8c_source.html#l00074">MCMD_ACK</a>, <a class="el" href="subm__250_8c_source.html#l00058">MCMD_PING16</a>, <a class="el" href="subm__250_8c_source.html#l00067">MCMD_UPGRADE</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8h_source.html#l00284">MSCB_FORMAT_ERROR</a>, <a class="el" href="mscb_8c_source.html#l01027">mscb_in()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00281">MSCB_TIMEOUT</a>, <a class="el" href="scs__400_8c_source.html#l00153">ofs</a>, <a class="el" href="rpc_8h_source.html#l00154">RPC_MSCB_UPLOAD</a>, <a class="el" href="subm__250_8c_source.html#l00094">RS485_FLAG_LONG_TO</a>, <a class="el" href="subm__250_8c_source.html#l00092">RS485_FLAG_NO_ACK</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>, and <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02689"></a>02689          : <a class="code" href="mscb_8c.html#a3037b604bf35bf8a5b1530ccc388e83e">mscb_upload</a>
<a name="l02690"></a>02690 
<a name="l02691"></a>02691   Purpose: Upload <span class="keyword">new</span> firmware to node
<a name="l02692"></a>02692 
<a name="l02693"></a>02693 
<a name="l02694"></a>02694   Input:
<a name="l02695"></a>02695     <span class="keywordtype">int</span> fd                  File descriptor <span class="keywordflow">for</span> connection
<a name="l02696"></a>02696     <span class="keywordtype">int</span> adr                 Node <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l02697"></a>02697     <span class="keywordtype">char</span> *<a class="code" href="fal_8c.html#a258adbf16b88a7db88c7d8bce9708c50">filename</a>          File <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a> <span class="keywordflow">for</span> Intel HEX file
<a name="l02698"></a>02698     <span class="keywordtype">int</span> <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>               If <span class="keyword">true</span>, produce detailed debugging <a class="code" href="scs__210_8c.html#a859e9f68c1c035565d6729c59fd894ae">output</a>
<a name="l02699"></a>02699 
<a name="l02700"></a>02700   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l02701"></a>02701     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l02702"></a>02702     <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>            Timeout receiving acknowledge
<a name="l02703"></a>02703     <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>          CRC error
<a name="l02704"></a>02704     <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>        Parameter <span class="stringliteral">&quot;size&quot;</span> has invalid <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>
<a name="l02705"></a>02705     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l02706"></a>02706     <a class="code" href="mscb_8h.html#a5ecd90d1b7379da125d75b5f579a3496">MSCB_FORMAT_ERROR</a>       Error <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> HEX file <a class="code" href="webpaw_8c.html#a6113855b8e5965f1e91ee407b4026ab7">format</a>
<a name="l02707"></a>02707 
<a name="l02708"></a>02708 \********************************************************************/
<a name="l02709"></a>02709 {
<a name="l02710"></a>02710    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[512], crc, ack[2], image[0x10000], *line;
<a name="l02711"></a>02711    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len, ofh, ofl, <a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>, <a class="code" href="system_8c.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>;
<a name="l02712"></a>02712    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, page, flash_size, n_page, last_page, retry;
<a name="l02713"></a>02713    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="scs__400_8c.html#a04fe355a80e85e9f62a55b0a7cec6100">ofs</a>;
<a name="l02714"></a>02714 
<a name="l02715"></a>02715    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].type)
<a name="l02716"></a>02716       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l02717"></a>02717 
<a name="l02718"></a>02718    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd))
<a name="l02719"></a>02719       <span class="keywordflow">return</span> <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#a2f7375d1f241cbec99eea689f1415c71">RPC_MSCB_UPLOAD</a>, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd, adr, <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l02720"></a>02720 
<a name="l02721"></a>02721    <span class="comment">/* interprete HEX file */</span>
<a name="l02722"></a>02722    memset(image, 0xFF, <span class="keyword">sizeof</span>(image));
<a name="l02723"></a>02723    line = <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>;
<a name="l02724"></a>02724    flash_size = 0;
<a name="l02725"></a>02725    <span class="keywordflow">do</span> {
<a name="l02726"></a>02726       <span class="keywordflow">if</span> (line[0] == <span class="charliteral">&apos;:&apos;</span>) {
<a name="l02727"></a>02727          sscanf(line + 1, <span class="stringliteral">&quot;%02x%02x%02x%02x&quot;</span>, &amp;len, &amp;ofh, &amp;ofl, &amp;type);
<a name="l02728"></a>02728          ofs = (ofh &lt;&lt; 8) | ofl;
<a name="l02729"></a>02729 
<a name="l02730"></a>02730          <span class="keywordflow">for</span> (i = 0; i &lt; (int) len; i++) {
<a name="l02731"></a>02731             sscanf(line + 9 + i * 2, <span class="stringliteral">&quot;%02x&quot;</span>, &amp;d);
<a name="l02732"></a>02732             image[ofs + i] = d;
<a name="l02733"></a>02733          }
<a name="l02734"></a>02734          
<a name="l02735"></a>02735          flash_size += len;
<a name="l02736"></a>02736          line = strchr(line, <span class="charliteral">&apos;\r&apos;</span>) + 1;
<a name="l02737"></a>02737          <span class="keywordflow">if</span> (line &amp;&amp; *line == <span class="charliteral">&apos;\n&apos;</span>)
<a name="l02738"></a>02738             line++;
<a name="l02739"></a>02739       } <span class="keywordflow">else</span>
<a name="l02740"></a>02740          <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a5ecd90d1b7379da125d75b5f579a3496">MSCB_FORMAT_ERROR</a>;
<a name="l02741"></a>02741 
<a name="l02742"></a>02742    } <span class="keywordflow">while</span> (*line);
<a name="l02743"></a>02743 
<a name="l02744"></a>02744    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>) {
<a name="l02745"></a>02745       <span class="comment">/* count pages and byes */</span>
<a name="l02746"></a>02746       n_page = 0;
<a name="l02747"></a>02747       last_page = -1;
<a name="l02748"></a>02748       <span class="keywordflow">for</span> (page = 0; page &lt; 128; page++) {
<a name="l02749"></a>02749          <span class="comment">/* check if page contains data */</span>
<a name="l02750"></a>02750          <span class="keywordflow">for</span> (i = 0; i &lt; 512; i++) {
<a name="l02751"></a>02751             <span class="keywordflow">if</span> (image[page * 512 + i] != 0xFF) {
<a name="l02752"></a>02752                <span class="keywordflow">if</span> (page != last_page) {
<a name="l02753"></a>02753                   last_page = page;
<a name="l02754"></a>02754                   n_page++;
<a name="l02755"></a>02755                }
<a name="l02756"></a>02756             }
<a name="l02757"></a>02757          }
<a name="l02758"></a>02758       }
<a name="l02759"></a>02759 
<a name="l02760"></a>02760       printf(<span class="stringliteral">&quot;Found %d valid pages (%d bytes) in HEX file\n&quot;</span>, n_page, flash_size);
<a name="l02761"></a>02761    }
<a name="l02762"></a>02762 
<a name="l02763"></a>02763    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd) != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l02764"></a>02764       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>;
<a name="l02765"></a>02765 
<a name="l02766"></a>02766    status = <a class="code" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a>(fd, <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>, adr, 10, 0);
<a name="l02767"></a>02767    <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l02768"></a>02768       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02769"></a>02769       <span class="keywordflow">return</span> status;
<a name="l02770"></a>02770    }
<a name="l02771"></a>02771 
<a name="l02772"></a>02772    <span class="comment">/* send upgrade command */</span>
<a name="l02773"></a>02773    buf[0] = <a class="code" href="subm__250_8c.html#a345f9fa632df1d2d07bdbed7a618a493">MCMD_UPGRADE</a>;
<a name="l02774"></a>02774    crc = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 1);
<a name="l02775"></a>02775    buf[1] = crc;
<a name="l02776"></a>02776    <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 2, <a class="code" href="subm__250_8c.html#a86c0efa95b2455cd26b8629d32bd0a36">RS485_FLAG_LONG_TO</a>);
<a name="l02777"></a>02777 
<a name="l02778"></a>02778    <span class="comment">/* wait for ready, 1 sec timeout */</span>
<a name="l02779"></a>02779    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a>(fd, ack, 2, 1000000) != 2) {
<a name="l02780"></a>02780       printf(<span class="stringliteral">&quot;Error: timeout receiving upgrade acknowledge from remote node\n&quot;</span>);
<a name="l02781"></a>02781 
<a name="l02782"></a>02782       <span class="comment">/* send exit upgrade command, in case node gets to upgrade routine later */</span>
<a name="l02783"></a>02783       buf[0] = 6;
<a name="l02784"></a>02784       <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 1, <a class="code" href="subm__250_8c.html#a86c0efa95b2455cd26b8629d32bd0a36">RS485_FLAG_LONG_TO</a>);
<a name="l02785"></a>02785 
<a name="l02786"></a>02786       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02787"></a>02787       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l02788"></a>02788    }
<a name="l02789"></a>02789 
<a name="l02790"></a>02790    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>)
<a name="l02791"></a>02791       printf(<span class="stringliteral">&quot;Received acknowledge for upgrade command\n&quot;</span>);
<a name="l02792"></a>02792 
<a name="l02793"></a>02793    <span class="comment">/* program pages up to 64k */</span>
<a name="l02794"></a>02794    <span class="keywordflow">for</span> (page = 0; page &lt; 128; page++) {
<a name="l02795"></a>02795       <span class="comment">/* check if page contains data */</span>
<a name="l02796"></a>02796       <span class="keywordflow">for</span> (i = 0; i &lt; 512; i++)
<a name="l02797"></a>02797          <span class="keywordflow">if</span> (image[page * 512 + i] != 0xFF)
<a name="l02798"></a>02798             <span class="keywordflow">break</span>;
<a name="l02799"></a>02799 
<a name="l02800"></a>02800       retry = 0;
<a name="l02801"></a>02801 
<a name="l02802"></a>02802       <span class="keywordflow">if</span> (i &lt; 512) {
<a name="l02803"></a>02803          <span class="keywordflow">do</span> {
<a name="l02804"></a>02804             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>)
<a name="l02805"></a>02805                printf(<span class="stringliteral">&quot;Erase page   0x%04X - &quot;</span>, page * 512);
<a name="l02806"></a>02806             <span class="keywordflow">else</span>
<a name="l02807"></a>02807                printf(<span class="stringliteral">&quot;E&quot;</span>);
<a name="l02808"></a>02808             fflush(stdout);
<a name="l02809"></a>02809 
<a name="l02810"></a>02810             <span class="comment">/* erase page */</span>
<a name="l02811"></a>02811             buf[0] = 2;
<a name="l02812"></a>02812             buf[1] = page;
<a name="l02813"></a>02813             <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 2, <a class="code" href="subm__250_8c.html#a86c0efa95b2455cd26b8629d32bd0a36">RS485_FLAG_LONG_TO</a>);
<a name="l02814"></a>02814 
<a name="l02815"></a>02815             <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a>(fd, ack, 2, 100000) != 2) {
<a name="l02816"></a>02816                printf(<span class="stringliteral">&quot;\nError: timeout from remote node for erase page 0x%04X\n&quot;</span>, page * 512);
<a name="l02817"></a>02817                <span class="keywordflow">goto</span> prog_error;
<a name="l02818"></a>02818             }
<a name="l02819"></a>02819 
<a name="l02820"></a>02820             <span class="keywordflow">if</span> (ack[1] == 0xFF) {
<a name="l02821"></a>02821                <span class="comment">/* protected page, so finish */</span>
<a name="l02822"></a>02822                <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>)
<a name="l02823"></a>02823                   printf(<span class="stringliteral">&quot;found protected page, exit\n&quot;</span>);
<a name="l02824"></a>02824                <span class="keywordflow">else</span>
<a name="l02825"></a>02825                   printf(<span class="stringliteral">&quot;\bX&quot;</span>);
<a name="l02826"></a>02826                fflush(stdout);
<a name="l02827"></a>02827                <span class="keywordflow">goto</span> prog_error;
<a name="l02828"></a>02828             }
<a name="l02829"></a>02829 
<a name="l02830"></a>02830             <span class="keywordflow">if</span> (ack[0] != <a class="code" href="subm__250_8c.html#a796320244ecb94c4814f6d480f55e0be">MCMD_ACK</a>) {
<a name="l02831"></a>02831                printf(<span class="stringliteral">&quot;\nError: received wrong acknowledge for erase page 0x%04X\n&quot;</span>, page * 512);
<a name="l02832"></a>02832                <span class="keywordflow">goto</span> prog_error;
<a name="l02833"></a>02833             }
<a name="l02834"></a>02834 
<a name="l02835"></a>02835             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>)
<a name="l02836"></a>02836                printf(<span class="stringliteral">&quot;ok\n&quot;</span>);
<a name="l02837"></a>02837 
<a name="l02838"></a>02838             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>)
<a name="l02839"></a>02839                printf(<span class="stringliteral">&quot;Program page 0x%04X - &quot;</span>, page * 512);
<a name="l02840"></a>02840             <span class="keywordflow">else</span>
<a name="l02841"></a>02841                printf(<span class="stringliteral">&quot;\bP&quot;</span>);
<a name="l02842"></a>02842             fflush(stdout);
<a name="l02843"></a>02843 
<a name="l02844"></a>02844             <span class="comment">/* program page */</span>
<a name="l02845"></a>02845             buf[0] = 3;
<a name="l02846"></a>02846             buf[1] = page;
<a name="l02847"></a>02847             <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 2, <a class="code" href="subm__250_8c.html#a1265f1c3f2fdd44625d8392cc53d49e1">RS485_FLAG_NO_ACK</a>);
<a name="l02848"></a>02848 
<a name="l02849"></a>02849 
<a name="l02850"></a>02850             <span class="keywordflow">for</span> (i = crc = 0; i &lt; 512; i++) {
<a name="l02851"></a>02851                buf[i] = image[page * 512 + i];
<a name="l02852"></a>02852                crc += buf[i];
<a name="l02853"></a>02853             }
<a name="l02854"></a>02854 
<a name="l02855"></a>02855             <span class="comment">/* chop down page in 60 byte segments (-&gt;USB) */</span>
<a name="l02856"></a>02856             <span class="keywordflow">for</span> (i = 0; i &lt; 8; i++) {
<a name="l02857"></a>02857                <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf + i * 60, 60, <a class="code" href="subm__250_8c.html#a86c0efa95b2455cd26b8629d32bd0a36">RS485_FLAG_LONG_TO</a>);
<a name="l02858"></a>02858 
<a name="l02859"></a>02859                <span class="comment">/* read acknowledge */</span>
<a name="l02860"></a>02860                <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a>(fd, ack, 2, 100000) != 2) {
<a name="l02861"></a>02861                   printf(<span class="stringliteral">&quot;\nError: timeout from remote node for program page 0x%04X\n&quot;</span>, page * 512);
<a name="l02862"></a>02862                   <span class="keywordflow">goto</span> prog_error;
<a name="l02863"></a>02863                }
<a name="l02864"></a>02864             }
<a name="l02865"></a>02865 
<a name="l02866"></a>02866             <span class="comment">/* send remaining 32 bytes */</span>
<a name="l02867"></a>02867             <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf + i * 60, 32, <a class="code" href="subm__250_8c.html#a86c0efa95b2455cd26b8629d32bd0a36">RS485_FLAG_LONG_TO</a>);
<a name="l02868"></a>02868 
<a name="l02869"></a>02869             <span class="comment">/* read acknowledge */</span>
<a name="l02870"></a>02870             <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a>(fd, ack, 2, 100000) != 2) {
<a name="l02871"></a>02871                printf(<span class="stringliteral">&quot;\nError: timeout from remote node for program page 0x%04X\n&quot;</span>, page * 512);
<a name="l02872"></a>02872                <span class="keywordflow">goto</span> prog_error;
<a name="l02873"></a>02873             }
<a name="l02874"></a>02874 
<a name="l02875"></a>02875             <span class="keywordflow">if</span> (ack[0] != <a class="code" href="subm__250_8c.html#a796320244ecb94c4814f6d480f55e0be">MCMD_ACK</a>) {
<a name="l02876"></a>02876                printf(<span class="stringliteral">&quot;\nError: received wrong acknowledge for program page 0x%04X\n&quot;</span>, page * 512);
<a name="l02877"></a>02877                <span class="keywordflow">goto</span> prog_error;
<a name="l02878"></a>02878             }
<a name="l02879"></a>02879 
<a name="l02880"></a>02880             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>)
<a name="l02881"></a>02881                printf(<span class="stringliteral">&quot;ok\n&quot;</span>);
<a name="l02882"></a>02882 
<a name="l02883"></a>02883             <span class="comment">/* verify page */</span>
<a name="l02884"></a>02884             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>)
<a name="l02885"></a>02885                printf(<span class="stringliteral">&quot;Verify page  0x%04X - &quot;</span>, page * 512);
<a name="l02886"></a>02886             <span class="keywordflow">else</span>
<a name="l02887"></a>02887                printf(<span class="stringliteral">&quot;\bV&quot;</span>);
<a name="l02888"></a>02888             fflush(stdout);
<a name="l02889"></a>02889 
<a name="l02890"></a>02890             <span class="comment">/* verify page */</span>
<a name="l02891"></a>02891             buf[0] = 4;
<a name="l02892"></a>02892             buf[1] = page;
<a name="l02893"></a>02893             <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 2, <a class="code" href="subm__250_8c.html#a86c0efa95b2455cd26b8629d32bd0a36">RS485_FLAG_LONG_TO</a>);
<a name="l02894"></a>02894 
<a name="l02895"></a>02895             <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a>(fd, ack, 2, 100000) != 2) {
<a name="l02896"></a>02896                printf(<span class="stringliteral">&quot;\nError: timeout from remote node for verify page 0x%04X\n&quot;</span>, page * 512);
<a name="l02897"></a>02897                <span class="keywordflow">goto</span> prog_error;
<a name="l02898"></a>02898             }
<a name="l02899"></a>02899 
<a name="l02900"></a>02900             <span class="comment">/* compare CRCs */</span>
<a name="l02901"></a>02901             <span class="keywordflow">if</span> (ack[1] == crc) {
<a name="l02902"></a>02902                <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>)
<a name="l02903"></a>02903                   printf(<span class="stringliteral">&quot;ok (CRC = 0x%02X)\n&quot;</span>, crc);
<a name="l02904"></a>02904                <span class="keywordflow">break</span>;
<a name="l02905"></a>02905             }
<a name="l02906"></a>02906 
<a name="l02907"></a>02907             <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>)
<a name="l02908"></a>02908                printf(<span class="stringliteral">&quot;CRC error (0x%02X != 0x%02X)\n&quot;</span>, crc, ack[1]);
<a name="l02909"></a>02909 
<a name="l02910"></a>02910             <span class="comment">/* reprogram page until verified */</span>
<a name="l02911"></a>02911             retry++;
<a name="l02912"></a>02912             <span class="keywordflow">if</span> (retry == 10) {
<a name="l02913"></a>02913                printf(<span class="stringliteral">&quot;\nToo many retries, aborting\n&quot;</span>);
<a name="l02914"></a>02914                <span class="keywordflow">goto</span> prog_error;
<a name="l02915"></a>02915                <span class="keywordflow">break</span>;
<a name="l02916"></a>02916             }
<a name="l02917"></a>02917 
<a name="l02918"></a>02918          } <span class="keywordflow">while</span> (1);
<a name="l02919"></a>02919 
<a name="l02920"></a>02920          <span class="keywordflow">if</span> (!<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>)
<a name="l02921"></a>02921             printf(<span class="stringliteral">&quot;\b=&quot;</span>);
<a name="l02922"></a>02922          fflush(stdout);
<a name="l02923"></a>02923       }
<a name="l02924"></a>02924    }
<a name="l02925"></a>02925 
<a name="l02926"></a>02926  prog_error:
<a name="l02927"></a>02927    printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02928"></a>02928 
<a name="l02929"></a>02929    <span class="comment">/* reboot node */</span>
<a name="l02930"></a>02930    buf[0] = 5;
<a name="l02931"></a>02931    <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 1, <a class="code" href="subm__250_8c.html#a1265f1c3f2fdd44625d8392cc53d49e1">RS485_FLAG_NO_ACK</a>);
<a name="l02932"></a>02932 
<a name="l02933"></a>02933    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02934"></a>02934    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l02935"></a>02935 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7605e8b75cb7689ba8dfcec04f59c464"></a><!-- doxytag: member="mscb.c::mscb_user" ref="a7605e8b75cb7689ba8dfcec04f59c464" args="(int fd, int adr, void *param, int size, void *result, int *rsize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_user </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>result</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>rsize</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l03154">3154</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="mscbutil_8c_source.html#l00187">crc8()</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="subm__250_8c_source.html#l00058">MCMD_PING16</a>, <a class="el" href="subm__250_8c_source.html#l00068">MCMD_USER</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8h_source.html#l00280">MSCB_CRC_ERROR</a>, <a class="el" href="mscb_8h_source.html#l00284">MSCB_FORMAT_ERROR</a>, <a class="el" href="mscb_8c_source.html#l01027">mscb_in()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00281">MSCB_TIMEOUT</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="rpc_8h_source.html#l00157">RPC_MSCB_USER</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03157"></a>03157          : <a class="code" href="mscb_8c.html#a7605e8b75cb7689ba8dfcec04f59c464">mscb_user</a>
<a name="l03158"></a>03158 
<a name="l03159"></a>03159   Purpose: Call user function on node
<a name="l03160"></a>03160 
<a name="l03161"></a>03161   Input:
<a name="l03162"></a>03162     <span class="keywordtype">int</span>  fd                 File descriptor <span class="keywordflow">for</span> connection
<a name="l03163"></a>03163     <span class="keywordtype">int</span> adr                 Node <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l03164"></a>03164     <span class="keywordtype">char</span> *<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>             Parameters passed to user function, no CRC code
<a name="l03165"></a>03165     <span class="keywordtype">int</span>  <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>               Size of parameters <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> bytes
<a name="l03166"></a>03166     <span class="keywordtype">int</span>  *rsize             Size of result <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l03167"></a>03167 
<a name="l03168"></a>03168   Output:
<a name="l03169"></a>03169     <span class="keywordtype">char</span> *result            Optional <span class="keywordflow">return</span> parameters
<a name="l03170"></a>03170     <span class="keywordtype">int</span>  *rsize             Number of returned <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>
<a name="l03171"></a>03171 
<a name="l03172"></a>03172   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l03173"></a>03173     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l03174"></a>03174     <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>            Timeout receiving <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>
<a name="l03175"></a>03175     <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>          CRC error
<a name="l03176"></a>03176     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l03177"></a>03177     <a class="code" href="mscb_8h.html#a5ecd90d1b7379da125d75b5f579a3496">MSCB_FORMAT_ERROR</a>       <span class="stringliteral">&quot;size&quot;</span> <a class="code" href="HITS_8h.html#a4f188184523d527be63ee6079f182f17">parameter</a> too large
<a name="l03178"></a>03178 
<a name="l03179"></a>03179 \********************************************************************/
<a name="l03180"></a>03180 {
<a name="l03181"></a>03181    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l03182"></a>03182    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[80];
<a name="l03183"></a>03183 
<a name="l03184"></a>03184    memset(result, 0, *rsize);
<a name="l03185"></a>03185 
<a name="l03186"></a>03186    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l03187"></a>03187       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l03188"></a>03188 
<a name="l03189"></a>03189    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd))
<a name="l03190"></a>03190       <span class="keywordflow">return</span> <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#af1a893fae4ac9470eed7ed5e98c74ce0">RPC_MSCB_USER</a>,
<a name="l03191"></a>03191                        <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd, adr, <a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, result, rsize);
<a name="l03192"></a>03192 
<a name="l03193"></a>03193    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd) != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l03194"></a>03194       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>;
<a name="l03195"></a>03195 
<a name="l03196"></a>03196    status = <a class="code" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a>(fd, <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>, adr, 10, 0);
<a name="l03197"></a>03197    <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l03198"></a>03198       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l03199"></a>03199       <span class="keywordflow">return</span> status;
<a name="l03200"></a>03200    }
<a name="l03201"></a>03201 
<a name="l03202"></a>03202    <span class="keywordflow">if</span> (<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> &gt; 4 || <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> &lt; 0)
<a name="l03203"></a>03203       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a5ecd90d1b7379da125d75b5f579a3496">MSCB_FORMAT_ERROR</a>;
<a name="l03204"></a>03204 
<a name="l03205"></a>03205    buf[0] = <a class="code" href="subm__250_8c.html#a25d902cc8366b174a78eebd969be2dae">MCMD_USER</a> + <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l03206"></a>03206 
<a name="l03207"></a>03207    <span class="keywordflow">for</span> (i = 0; i &lt; size; i++)
<a name="l03208"></a>03208       buf[1 + i] = ((<span class="keywordtype">char</span> *) <a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>)[i];
<a name="l03209"></a>03209 
<a name="l03210"></a>03210    <span class="comment">/* add CRC code and send data */</span>
<a name="l03211"></a>03211    buf[1 + i] = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 1 + i);
<a name="l03212"></a>03212    status = <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 2 + i, 0);
<a name="l03213"></a>03213    <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l03214"></a>03214       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l03215"></a>03215       <span class="keywordflow">return</span> status;
<a name="l03216"></a>03216    }
<a name="l03217"></a>03217 
<a name="l03218"></a>03218    <span class="keywordflow">if</span> (result == NULL) {
<a name="l03219"></a>03219       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l03220"></a>03220       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l03221"></a>03221    }
<a name="l03222"></a>03222 
<a name="l03223"></a>03223    <span class="comment">/* read result */</span>
<a name="l03224"></a>03224    n = <a class="code" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a>(fd, buf, <span class="keyword">sizeof</span>(buf), 10000);
<a name="l03225"></a>03225    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l03226"></a>03226 
<a name="l03227"></a>03227    <span class="keywordflow">if</span> (n &lt; 0)
<a name="l03228"></a>03228       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l03229"></a>03229 
<a name="l03230"></a>03230    <span class="keywordflow">if</span> (rsize)
<a name="l03231"></a>03231       *rsize = n - 2;
<a name="l03232"></a>03232    <span class="keywordflow">for</span> (i = 0; i &lt; n - 2; i++)
<a name="l03233"></a>03233       ((<span class="keywordtype">char</span> *) result)[i] = buf[1 + i];
<a name="l03234"></a>03234 
<a name="l03235"></a>03235    <span class="keywordflow">if</span> (buf[n - 1] != <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, n - 1))
<a name="l03236"></a>03236       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>;
<a name="l03237"></a>03237 
<a name="l03238"></a>03238    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l03239"></a>03239 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa1058914021cc7101577223568c918d5"></a><!-- doxytag: member="mscb.c::mscb_write" ref="aa1058914021cc7101577223568c918d5" args="(int fd, int adr, unsigned char index, void *data, int size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_write </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l02461">2461</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="mscbutil_8c_source.html#l00187">crc8()</a>, <a class="el" href="system_8c_source.html#l00966">d</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="subm__250_8c_source.html#l00074">MCMD_ACK</a>, <a class="el" href="subm__250_8c_source.html#l00058">MCMD_PING16</a>, <a class="el" href="subm__250_8c_source.html#l00077">MCMD_WRITE_ACK</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8h_source.html#l00280">MSCB_CRC_ERROR</a>, <a class="el" href="mscb_8c_source.html#l01027">mscb_in()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="mscb_8h_source.html#l00281">MSCB_TIMEOUT</a>, <a class="el" href="rpc_8h_source.html#l00151">RPC_MSCB_WRITE</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>, <a class="el" href="calib__520_8c_source.html#l00036">main()</a>, <a class="el" href="mscb_8c_source.html#l03334">mscb_link()</a>, <a class="el" href="mscbdev_8c_source.html#l00165">mscbdev_set()</a>, and <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02464"></a>02464          : <a class="code" href="mscb_8c.html#aa1058914021cc7101577223568c918d5">mscb_write</a>
<a name="l02465"></a>02465 
<a name="l02466"></a>02466   Purpose: Write <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> to <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a> on single node
<a name="l02467"></a>02467 
<a name="l02468"></a>02468   Input:
<a name="l02469"></a>02469     <span class="keywordtype">int</span> fd                  File descriptor <span class="keywordflow">for</span> connection
<a name="l02470"></a>02470     <span class="keywordtype">int</span> adr                 Node <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l02471"></a>02471     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>     Variable <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> 0..255
<a name="l02472"></a>02472     <span class="keywordtype">void</span> *<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>              Data to <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>
<a name="l02473"></a>02473     <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>                Data <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> bytes 1..4 <span class="keywordflow">for</span> byte, word,
<a name="l02474"></a>02474                             <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> dword
<a name="l02475"></a>02475 
<a name="l02476"></a>02476   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l02477"></a>02477     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l02478"></a>02478     <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>            Timeout receiving acknowledge
<a name="l02479"></a>02479     <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>          CRC error
<a name="l02480"></a>02480     <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>        Parameter <span class="stringliteral">&quot;size&quot;</span> has invalid <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>
<a name="l02481"></a>02481     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l02482"></a>02482 
<a name="l02483"></a>02483 \********************************************************************/
<a name="l02484"></a>02484 {
<a name="l02485"></a>02485    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l02486"></a>02486    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[256], crc, ack[2];
<a name="l02487"></a>02487    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="system_8c.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>;
<a name="l02488"></a>02488 
<a name="l02489"></a>02489    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l02490"></a>02490       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l02491"></a>02491 
<a name="l02492"></a>02492    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd))
<a name="l02493"></a>02493       <span class="keywordflow">return</span> <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#ac40e690d0eb2c31c8a425f9c81dc6514">RPC_MSCB_WRITE</a>, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd, adr, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l02494"></a>02494 
<a name="l02495"></a>02495    <span class="keywordflow">if</span> (<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> &lt; 1)
<a name="l02496"></a>02496       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l02497"></a>02497 
<a name="l02498"></a>02498    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd) != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l02499"></a>02499       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>;
<a name="l02500"></a>02500 
<a name="l02501"></a>02501    status = <a class="code" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a>(fd, <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>, adr, 10, 0);
<a name="l02502"></a>02502    <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l02503"></a>02503       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02504"></a>02504       <span class="keywordflow">return</span> status;
<a name="l02505"></a>02505    }
<a name="l02506"></a>02506 
<a name="l02507"></a>02507    <span class="keywordflow">if</span> (<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> &lt; 6) {
<a name="l02508"></a>02508       buf[0] = <a class="code" href="subm__250_8c.html#a861e80d99b7a44392c653ee9434914bd">MCMD_WRITE_ACK</a> + <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> + 1;
<a name="l02509"></a>02509       buf[1] = <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>;
<a name="l02510"></a>02510 
<a name="l02511"></a>02511       <span class="comment">/* reverse order for WORD &amp; DWORD */</span>
<a name="l02512"></a>02512       <span class="keywordflow">if</span> (size &lt; 5)
<a name="l02513"></a>02513          <span class="keywordflow">for</span> (i = 0, d = <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>; i &lt; size; i++)
<a name="l02514"></a>02514             buf[2 + size - 1 - i] = *d++;
<a name="l02515"></a>02515       <span class="keywordflow">else</span>
<a name="l02516"></a>02516          <span class="keywordflow">for</span> (i = 0, d = <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>; i &lt; size; i++)
<a name="l02517"></a>02517             buf[2 + i] = *d++;
<a name="l02518"></a>02518 
<a name="l02519"></a>02519       crc = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 2 + i);
<a name="l02520"></a>02520       buf[2 + i] = crc;
<a name="l02521"></a>02521       <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 3 + i, 0);
<a name="l02522"></a>02522    } <span class="keywordflow">else</span> {
<a name="l02523"></a>02523       buf[0] = <a class="code" href="subm__250_8c.html#a861e80d99b7a44392c653ee9434914bd">MCMD_WRITE_ACK</a> + 7;
<a name="l02524"></a>02524       buf[1] = size + 1;
<a name="l02525"></a>02525       buf[2] = <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>;
<a name="l02526"></a>02526 
<a name="l02527"></a>02527       <span class="keywordflow">for</span> (i = 0, d = <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>; i &lt; size; i++)
<a name="l02528"></a>02528          buf[3 + i] = *d++;
<a name="l02529"></a>02529 
<a name="l02530"></a>02530       crc = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 3 + i);
<a name="l02531"></a>02531       buf[3 + i] = crc;
<a name="l02532"></a>02532       <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 4 + i, 0);
<a name="l02533"></a>02533    }
<a name="l02534"></a>02534 
<a name="l02535"></a>02535    <span class="comment">/* read acknowledge */</span>
<a name="l02536"></a>02536    i = <a class="code" href="mscb_8c.html#a479d3aa010c4d570f7fecec8263da987">mscb_in</a>(fd, ack, 2, 10000);
<a name="l02537"></a>02537    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02538"></a>02538    <span class="keywordflow">if</span> (i &lt; 2)
<a name="l02539"></a>02539       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>;
<a name="l02540"></a>02540 
<a name="l02541"></a>02541    <span class="keywordflow">if</span> (ack[0] != <a class="code" href="subm__250_8c.html#a796320244ecb94c4814f6d480f55e0be">MCMD_ACK</a> || ack[1] != crc)
<a name="l02542"></a>02542       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>;
<a name="l02543"></a>02543 
<a name="l02544"></a>02544    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l02545"></a>02545 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8e70bd17d7c75a9d5a1611632c4eaf71"></a><!-- doxytag: member="mscb.c::mscb_write_block" ref="a8e70bd17d7c75a9d5a1611632c4eaf71" args="(int fd, int adr, unsigned char index, void *data, int size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_write_block </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l02549">2549</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="subm__250_8c_source.html#l00058">MCMD_PING16</a>, <a class="el" href="subm__250_8c_source.html#l00083">MCMD_WRITE_BLOCK</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="rpc_8h_source.html#l00151">RPC_MSCB_WRITE</a>, <a class="el" href="subm__250_8c_source.html#l00095">RS485_FLAG_CMD</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02552"></a>02552          : <a class="code" href="mscb_8c.html#a8e70bd17d7c75a9d5a1611632c4eaf71">mscb_write_block</a>
<a name="l02553"></a>02553 
<a name="l02554"></a>02554   Purpose: Write block of <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> to single node
<a name="l02555"></a>02555 
<a name="l02556"></a>02556   Input:
<a name="l02557"></a>02557     <span class="keywordtype">int</span> fd                  File descriptor <span class="keywordflow">for</span> connection
<a name="l02558"></a>02558     <span class="keywordtype">int</span> adr                 Node <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l02559"></a>02559     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>     Variable <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> 0..255
<a name="l02560"></a>02560     <span class="keywordtype">void</span> *<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>              Data to <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>
<a name="l02561"></a>02561     <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>                Data <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> bytes
<a name="l02562"></a>02562 
<a name="l02563"></a>02563   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l02564"></a>02564     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l02565"></a>02565     <a class="code" href="mscb_8h.html#a77aebb8876100bc48d6ecad6503a2509">MSCB_TIMEOUT</a>            Timeout receiving acknowledge
<a name="l02566"></a>02566     <a class="code" href="mscb_8h.html#a7cd085dd5effd102e9a86bef8aca70bd">MSCB_CRC_ERROR</a>          CRC error
<a name="l02567"></a>02567     <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>        Parameter <span class="stringliteral">&quot;size&quot;</span> has invalid <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>
<a name="l02568"></a>02568     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l02569"></a>02569 
<a name="l02570"></a>02570 \********************************************************************/
<a name="l02571"></a>02571 {
<a name="l02572"></a>02572    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l02573"></a>02573    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[1024];
<a name="l02574"></a>02574 
<a name="l02575"></a>02575    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l02576"></a>02576       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l02577"></a>02577 
<a name="l02578"></a>02578    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd))
<a name="l02579"></a>02579       <span class="keywordflow">return</span> <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#ac40e690d0eb2c31c8a425f9c81dc6514">RPC_MSCB_WRITE</a>, <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd, adr, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l02580"></a>02580 
<a name="l02581"></a>02581    <span class="keywordflow">if</span> (<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> &lt; 1)
<a name="l02582"></a>02582       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l02583"></a>02583 
<a name="l02584"></a>02584    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd) != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l02585"></a>02585       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>;
<a name="l02586"></a>02586 
<a name="l02587"></a>02587    status = <a class="code" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a>(fd, <a class="code" href="subm__250_8c.html#abf513a0baf0b72d14d181068b3ea6468">MCMD_PING16</a>, adr, 10, 0);
<a name="l02588"></a>02588    <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l02589"></a>02589       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02590"></a>02590       <span class="keywordflow">return</span> status;
<a name="l02591"></a>02591    }
<a name="l02592"></a>02592 
<a name="l02593"></a>02593    <span class="comment">/*</span>
<a name="l02594"></a>02594 <span class="comment">   Bulk test gave 128kb/sec, 10.3.04, SR</span>
<a name="l02595"></a>02595 <span class="comment"></span>
<a name="l02596"></a>02596 <span class="comment">   for (i=0 ; i&lt;1024 ; i++)</span>
<a name="l02597"></a>02597 <span class="comment">      buf[i] = RS485_FLAG_CMD;</span>
<a name="l02598"></a>02598 <span class="comment">   </span>
<a name="l02599"></a>02599 <span class="comment">   i = msend_usb(mscb_fd[fd - 1].hw, buf, 1024);</span>
<a name="l02600"></a>02600 <span class="comment">   mscb_release(fd);</span>
<a name="l02601"></a>02601 <span class="comment">   return MSCB_SUCCESS;</span>
<a name="l02602"></a>02602 <span class="comment">   */</span>
<a name="l02603"></a>02603 
<a name="l02604"></a>02604    <span class="comment">/* slice data in 60 byte blocks */</span>
<a name="l02605"></a>02605    <span class="keywordflow">for</span> (i=0 ; i&lt;=<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>/60 ; i++) {
<a name="l02606"></a>02606       buf[0] = <a class="code" href="subm__250_8c.html#a51d650dadd2c8b2a4a8b165f98bf42f8">MCMD_WRITE_BLOCK</a>;
<a name="l02607"></a>02607 
<a name="l02608"></a>02608       n = 60;
<a name="l02609"></a>02609       <span class="keywordflow">if</span> (<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> &lt; (i+1)*60)
<a name="l02610"></a>02610          n = <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> - i*60;
<a name="l02611"></a>02611 
<a name="l02612"></a>02612       <span class="keywordflow">if</span> (n == 0)
<a name="l02613"></a>02613          <span class="keywordflow">break</span>;
<a name="l02614"></a>02614 
<a name="l02615"></a>02615       memcpy(buf+1, (<span class="keywordtype">char</span> *)<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>+i*60, n);
<a name="l02616"></a>02616       <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, n+1, <a class="code" href="subm__250_8c.html#a23b3240a4ffbe66e078cb0e6a2aa5ba7">RS485_FLAG_CMD</a>);
<a name="l02617"></a>02617    }
<a name="l02618"></a>02618 
<a name="l02619"></a>02619    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02620"></a>02620 
<a name="l02621"></a>02621    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l02622"></a>02622 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a490b50468ada5e1bcf8749210d12888c"></a><!-- doxytag: member="mscb.c::mscb_write_group" ref="a490b50468ada5e1bcf8749210d12888c" args="(int fd, int adr, unsigned char index, void *data, int size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mscb_write_group </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>adr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l02401">2401</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="mscbutil_8c_source.html#l00187">crc8()</a>, <a class="el" href="system_8c_source.html#l00966">d</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="subm__250_8c_source.html#l00056">MCMD_ADDR_GRP16</a>, <a class="el" href="subm__250_8c_source.html#l00076">MCMD_WRITE_NA</a>, <a class="el" href="rpc_8c_source.html#l00756">mrpc_call()</a>, <a class="el" href="mscb_8c_source.html#l01586">mrpc_connected()</a>, <a class="el" href="mscb_8c_source.html#l01909">mscb_addr()</a>, <a class="el" href="mscb_8h_source.html#l00282">MSCB_INVAL_PARAM</a>, <a class="el" href="mscb_8c_source.html#l00567">mscb_lock()</a>, <a class="el" href="mscb_8h_source.html#l00260">MSCB_MAX_FD</a>, <a class="el" href="mscb_8h_source.html#l00283">MSCB_MUTEX</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l00597">mscb_release()</a>, <a class="el" href="mscb_8h_source.html#l00279">MSCB_SUCCESS</a>, <a class="el" href="rpc_8h_source.html#l00152">RPC_MSCB_WRITE_GROUP</a>, <a class="el" href="subm__250_8c_source.html#l00092">RS485_FLAG_NO_ACK</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="msc_8c_source.html#l00462">cmd_loop()</a>, and <a class="el" href="rpc_8c_source.html#l00400">server_execute()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02404"></a>02404          : mscb_write_na
<a name="l02405"></a>02405 
<a name="l02406"></a>02406   Purpose: Write <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> to <a class="code" href="plot__max_8c.html#ad49ec371d0c77a469cc14aa6f44b232e">channels</a> on group of nodes
<a name="l02407"></a>02407 
<a name="l02408"></a>02408   Input:
<a name="l02409"></a>02409     <span class="keywordtype">int</span> fd                  File descriptor <span class="keywordflow">for</span> connection
<a name="l02410"></a>02410     <span class="keywordtype">int</span> adr                 Group <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a>
<a name="l02411"></a>02411     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>     Variable <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> 0..255
<a name="l02412"></a>02412     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>      Data to <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>
<a name="l02413"></a>02413     <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>                Data <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> bytes 1..4 <span class="keywordflow">for</span> byte, word,
<a name="l02414"></a>02414                             <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> dword
<a name="l02415"></a>02415 
<a name="l02416"></a>02416   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l02417"></a>02417     <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>            Successful completion
<a name="l02418"></a>02418     <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>              Cannot obtain mutex <span class="keywordflow">for</span> mscb
<a name="l02419"></a>02419 
<a name="l02420"></a>02420 \********************************************************************/
<a name="l02421"></a>02421 {
<a name="l02422"></a>02422    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l02423"></a>02423    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="system_8c.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>;
<a name="l02424"></a>02424    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[256];
<a name="l02425"></a>02425 
<a name="l02426"></a>02426    <span class="keywordflow">if</span> (fd &gt; <a class="code" href="mscb_8h.html#ab9a675b3baa10be4122c6defc7bca8af">MSCB_MAX_FD</a> || fd &lt; 1 || !<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>)
<a name="l02427"></a>02427       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l02428"></a>02428 
<a name="l02429"></a>02429    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a0cbd83332d5f06ae34a67a4bf83a75a9">mrpc_connected</a>(fd))
<a name="l02430"></a>02430       <span class="keywordflow">return</span> <a class="code" href="rpc_8c.html#a3b548a0138f41d3e0a88094463af6e9d">mrpc_call</a>(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="rpc_8h.html#ac7c0fe58748da975c8e8decfdf8bff57">RPC_MSCB_WRITE_GROUP</a>,
<a name="l02431"></a>02431                        <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].remote_fd, adr, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l02432"></a>02432 
<a name="l02433"></a>02433    <span class="keywordflow">if</span> (<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> &gt; 4 || <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> &lt; 1)
<a name="l02434"></a>02434       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#aeaee585f827b1dc1223ff4cdc6e7253d">MSCB_INVAL_PARAM</a>;
<a name="l02435"></a>02435 
<a name="l02436"></a>02436    <span class="keywordflow">if</span> (<a class="code" href="mscb_8c.html#a7cce7d06b8fd1da29090561ba9613fbb">mscb_lock</a>(fd) != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>)
<a name="l02437"></a>02437       <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a4ef921ef511a896c3019d28db43cf212">MSCB_MUTEX</a>;
<a name="l02438"></a>02438 
<a name="l02439"></a>02439    status = <a class="code" href="mscb_8c.html#af52e5d2a32748856cc0490ae3e905ea5">mscb_addr</a>(fd, <a class="code" href="subm__250_8c.html#aa06f6457d8f01d5edcfd640bc6c51d09">MCMD_ADDR_GRP16</a>, adr, 10, 0);
<a name="l02440"></a>02440    <span class="keywordflow">if</span> (status != <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>) {
<a name="l02441"></a>02441       <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02442"></a>02442       <span class="keywordflow">return</span> status;
<a name="l02443"></a>02443    }
<a name="l02444"></a>02444 
<a name="l02445"></a>02445    buf[0] = <a class="code" href="subm__250_8c.html#a304d6d74ea8c43c42300d1237b03f3a0">MCMD_WRITE_NA</a> + <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> + 1;
<a name="l02446"></a>02446    buf[1] = <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>;
<a name="l02447"></a>02447 
<a name="l02448"></a>02448    <span class="keywordflow">for</span> (i = 0, d = <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>; i &lt; size; i++)
<a name="l02449"></a>02449       buf[2 + size - 1 - i] = *d++;
<a name="l02450"></a>02450 
<a name="l02451"></a>02451    buf[2 + i] = <a class="code" href="embedded_2mscb_8h.html#a92317b8fbef36cb36421636cd1287520">crc8</a>(buf, 2 + i);
<a name="l02452"></a>02452    <a class="code" href="mscb_8c.html#aadf1cbda47cc7bc93ea97b0270792906">mscb_out</a>(fd, buf, 3 + i, <a class="code" href="subm__250_8c.html#a1265f1c3f2fdd44625d8392cc53d49e1">RS485_FLAG_NO_ACK</a>);
<a name="l02453"></a>02453 
<a name="l02454"></a>02454    <a class="code" href="mscb_8c.html#a5296ed7a23f4b24dc6e4d9607e67ce5e">mscb_release</a>(fd);
<a name="l02455"></a>02455 
<a name="l02456"></a>02456    <span class="keywordflow">return</span> <a class="code" href="mscb_8h.html#a29db66de46994533ec6c17acd1ce5d1b">MSCB_SUCCESS</a>;
<a name="l02457"></a>02457 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6536ba92ef823b92fdc1f68537b6b942"></a><!-- doxytag: member="mscb.c::msend_usb" ref="a6536ba92ef823b92fdc1f68537b6b942" args="(int fd, void *buf, int size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int msend_usb </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00726">726</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00727"></a>00727 {
<a name="l00728"></a>00728    <span class="keywordtype">int</span> n_written;
<a name="l00729"></a>00729 
<a name="l00730"></a>00730 <span class="preprocessor">#if defined(_MSC_VER)</span>
<a name="l00731"></a>00731 <span class="preprocessor"></span>   WriteFile((HANDLE) fd, <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, &amp;n_written, NULL);
<a name="l00732"></a>00732 <span class="preprocessor">#elif defined(OS_LINUX)</span>
<a name="l00733"></a>00733 <span class="preprocessor"></span>   n_written = usb_bulk_write((usb_dev_handle *) fd, 2, <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, 100);
<a name="l00734"></a>00734    usleep(0); <span class="comment">// needed for linux not to crash !!!!</span>
<a name="l00735"></a>00735 <span class="preprocessor">#elif defined(OS_DARWIN)</span>
<a name="l00736"></a>00736 <span class="preprocessor"></span>   IOReturn <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l00737"></a>00737    IOUSBInterfaceInterface** device = (IOUSBInterfaceInterface**)fd;
<a name="l00738"></a>00738    status = (*device)-&gt;WritePipe(device,2,<a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>,<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l00739"></a>00739    <span class="keywordflow">if</span> (status != 0) printf(<span class="stringliteral">&quot;msend_usb: WritePipe() status %d 0x%x\n&quot;</span>,status,status);
<a name="l00740"></a>00740    n_written = <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l00741"></a>00741 <span class="preprocessor">#endif</span>
<a name="l00742"></a>00742 <span class="preprocessor"></span>   <span class="keywordflow">return</span> n_written;
<a name="l00743"></a>00743 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa518f900dd243fca1f06fc3ca2f0974e"></a><!-- doxytag: member="mscb.c::musb_close" ref="aa518f900dd243fca1f06fc3ca2f0974e" args="(int fdr, int fdw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void musb_close </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fdw</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l01564">1564</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01750">mscb_exit()</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, and <a class="el" href="mscb_8c_source.html#l02068">mscb_reset()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01565"></a>01565 {
<a name="l01566"></a>01566 <span class="preprocessor">#if defined(_MSC_VER)</span>
<a name="l01567"></a>01567 <span class="preprocessor"></span>   CloseHandle((HANDLE) fdr);
<a name="l01568"></a>01568    CloseHandle((HANDLE) fdw);
<a name="l01569"></a>01569 <span class="preprocessor">#elif defined(HAVE_LIBUSB)</span>
<a name="l01570"></a>01570 <span class="preprocessor"></span>   usb_close((usb_dev_handle *) fdr);
<a name="l01571"></a>01571 <span class="preprocessor">#else</span>
<a name="l01572"></a>01572 <span class="preprocessor"></span>   <span class="comment">/* FIXME */</span>
<a name="l01573"></a>01573 <span class="preprocessor">#endif</span>
<a name="l01574"></a>01574 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="aca3f3982b04c5e7e5884b831f886a333"></a><!-- doxytag: member="mscb.c::musb_init" ref="aca3f3982b04c5e7e5884b831f886a333" args="(int index, int *hr, int *hw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int musb_init </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>hr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>hw</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01593">mscb_init()</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l02068">mscb_reset()</a>, and <a class="el" href="mscb_8c_source.html#l03438">mscb_select_device()</a>.</p>

</div>
</div>
<a class="anchor" id="a937c66c4867e67cd9446bdd6dc9c1b22"></a><!-- doxytag: member="mscb.c::pp_rdata" ref="a937c66c4867e67cd9446bdd6dc9c1b22" args="(int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char pp_rdata </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00709">709</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="lrs1821_8c_source.html#l00038">data</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01833">mscb_check()</a>, and <a class="el" href="mscb_8c_source.html#l00945">mscb_in1()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00711"></a>00711 {
<a name="l00712"></a>00712 <span class="preprocessor">#if defined(_MSC_VER)</span>
<a name="l00713"></a>00713 <span class="preprocessor"></span>   <span class="keywordflow">return</span> _inp((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>) <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd);
<a name="l00714"></a>00714 <span class="preprocessor">#elif defined(OS_LINUX)</span>
<a name="l00715"></a>00715 <span class="preprocessor"></span>   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>;
<a name="l00716"></a>00716    <span class="keywordflow">if</span> (ioctl(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, PPRDATA, &amp;data))
<a name="l00717"></a>00717       perror(<span class="stringliteral">&quot;PPRDATA&quot;</span>);
<a name="l00718"></a>00718    <span class="keywordflow">return</span> data;
<a name="l00719"></a>00719 <span class="preprocessor">#else</span>
<a name="l00720"></a>00720 <span class="preprocessor"></span>   <span class="comment">/* no-op unsupported operation */</span>
<a name="l00721"></a>00721 <span class="preprocessor">#endif</span>
<a name="l00722"></a>00722 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6723dd6a26fb9c562657955556b67f9a"></a><!-- doxytag: member="mscb.c::pp_rstatus" ref="a6723dd6a26fb9c562657955556b67f9a" args="(int fd, int signal)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pp_rstatus </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>signal</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00655">655</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="mscb_8c_source.html#l00325">LPT_BUSY</a>, <a class="el" href="mscb_8c_source.html#l00326">LPT_DATAREADY</a>, and <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00069">mask</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01112">lpt_init()</a>, <a class="el" href="mscb_8c_source.html#l01833">mscb_check()</a>, <a class="el" href="mscb_8c_source.html#l00945">mscb_in1()</a>, and <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00656"></a>00656 {
<a name="l00657"></a>00657 <span class="comment">/* read status signal */</span>
<a name="l00658"></a>00658    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="examples_2macro_2midas__macro_8h.html#aa27501f113ff6d3171689e27cebfcf47">mask</a> = 0;
<a name="l00659"></a>00659 
<a name="l00660"></a>00660 <span class="preprocessor">#if defined(_MSC_VER)</span>
<a name="l00661"></a>00661 <span class="preprocessor"></span>   mask = _inp((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>) (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd + 1));
<a name="l00662"></a>00662 <span class="preprocessor">#elif defined(OS_LINUX)</span>
<a name="l00663"></a>00663 <span class="preprocessor"></span>   ioctl(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, PPRSTATUS, &amp;mask);
<a name="l00664"></a>00664 <span class="preprocessor">#else</span>
<a name="l00665"></a>00665 <span class="preprocessor"></span>   <span class="comment">/* no-op unsupported operation */</span>
<a name="l00666"></a>00666 <span class="preprocessor">#endif</span>
<a name="l00667"></a>00667 <span class="preprocessor"></span>
<a name="l00668"></a>00668    <span class="keywordflow">switch</span> (signal) {
<a name="l00669"></a>00669    <span class="keywordflow">case</span> <a class="code" href="mscb_8c.html#a9e6f01a3d42fa39fe5ce37f50beea147">LPT_BUSY</a>:
<a name="l00670"></a>00670       <span class="keywordflow">return</span> (mask &amp; (1 &lt;&lt; 7)) == 0;
<a name="l00671"></a>00671    <span class="keywordflow">case</span> <a class="code" href="mscb_8c.html#a70d318d8a0062dc4b32ebb8775c53653">LPT_DATAREADY</a>:
<a name="l00672"></a>00672       <span class="keywordflow">return</span> (mask &amp; (1 &lt;&lt; 6)) == 0;
<a name="l00673"></a>00673    }
<a name="l00674"></a>00674 
<a name="l00675"></a>00675    <span class="keywordflow">return</span> 0;
<a name="l00676"></a>00676 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af3238ffb136b143d8b080523c2f0cee5"></a><!-- doxytag: member="mscb.c::pp_setdir" ref="af3238ffb136b143d8b080523c2f0cee5" args="(int fd, unsigned int r)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pp_setdir </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>r</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00680">680</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="mscb_8c_source.html#l00323">LPT_READMODE</a>, and <a class="el" href="mscb_8c_source.html#l00621">pp_wcontrol()</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01112">lpt_init()</a>, and <a class="el" href="mscb_8c_source.html#l00945">mscb_in1()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00681"></a>00681 {
<a name="l00682"></a>00682 <span class="comment">/* set port direction: r==0:write mode;  r==1:read mode */</span>
<a name="l00683"></a>00683 <span class="preprocessor">#if defined(_MSC_VER)</span>
<a name="l00684"></a>00684 <span class="preprocessor"></span>   <a class="code" href="mscb_8c.html#a45bcdb1bae7f148b0fa1dd14001ffd02">pp_wcontrol</a>(fd, <a class="code" href="mscb_8c.html#a86391e262670a0332b41754452fbdd7b">LPT_READMODE</a>, r);
<a name="l00685"></a>00685 <span class="preprocessor">#elif defined(OS_LINUX)</span>
<a name="l00686"></a>00686 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (ioctl(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, PPDATADIR, &amp;r))
<a name="l00687"></a>00687       perror(<span class="stringliteral">&quot;PPDATADIR&quot;</span>);
<a name="l00688"></a>00688 <span class="preprocessor">#else</span>
<a name="l00689"></a>00689 <span class="preprocessor"></span>   <span class="comment">/* no-op unsupported operation */</span>
<a name="l00690"></a>00690 <span class="preprocessor">#endif</span>
<a name="l00691"></a>00691 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a45bcdb1bae7f148b0fa1dd14001ffd02"></a><!-- doxytag: member="mscb.c::pp_wcontrol" ref="a45bcdb1bae7f148b0fa1dd14001ffd02" args="(int fd, int signal, int flag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pp_wcontrol </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>signal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00621">621</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>References <a class="el" href="mscb_8c_source.html#l00320">LPT_ACK</a>, <a class="el" href="mscb_8c_source.html#l00322">LPT_BIT9</a>, <a class="el" href="mscb_8c_source.html#l00323">LPT_READMODE</a>, <a class="el" href="mscb_8c_source.html#l00321">LPT_RESET</a>, <a class="el" href="mscb_8c_source.html#l00319">LPT_STROBE</a>, and <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00069">mask</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01112">lpt_init()</a>, <a class="el" href="mscb_8c_source.html#l01833">mscb_check()</a>, <a class="el" href="mscb_8c_source.html#l00945">mscb_in1()</a>, <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>, <a class="el" href="mscb_8c_source.html#l02068">mscb_reset()</a>, and <a class="el" href="mscb_8c_source.html#l00680">pp_setdir()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00623"></a>00623 {
<a name="l00624"></a>00624    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="examples_2macro_2midas__macro_8h.html#aa27501f113ff6d3171689e27cebfcf47">mask</a> = 0;
<a name="l00625"></a>00625 
<a name="l00626"></a>00626    <span class="keywordflow">switch</span> (signal) {
<a name="l00627"></a>00627    <span class="keywordflow">case</span> <a class="code" href="mscb_8c.html#aa7b693ad182550b835a69b0fbd6bd2db">LPT_STROBE</a>:            <span class="comment">// negative port, negative MSCB usage</span>
<a name="l00628"></a>00628       mask = <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a> ? mask | (1 &lt;&lt; 0) : mask &amp; ~(1 &lt;&lt; 0);
<a name="l00629"></a>00629       <span class="keywordflow">break</span>;
<a name="l00630"></a>00630    <span class="keywordflow">case</span> <a class="code" href="mscb_8c.html#add1804fb4ed8a17464e7c516b51ac72b">LPT_RESET</a>:             <span class="comment">// negative port, negative MSCB usage</span>
<a name="l00631"></a>00631       mask = <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a> ? mask | (1 &lt;&lt; 1) : mask &amp; ~(1 &lt;&lt; 1);
<a name="l00632"></a>00632       <span class="keywordflow">break</span>;
<a name="l00633"></a>00633    <span class="keywordflow">case</span> <a class="code" href="mscb_8c.html#aafc451f66099eadd66b93da2201893b8">LPT_BIT9</a>:              <span class="comment">// positive</span>
<a name="l00634"></a>00634       mask = <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a> ? mask | (1 &lt;&lt; 2) : mask &amp; ~(1 &lt;&lt; 2);
<a name="l00635"></a>00635       <span class="keywordflow">break</span>;
<a name="l00636"></a>00636    <span class="keywordflow">case</span> <a class="code" href="mscb_8c.html#abf3d598389a18a54466f7aa8ffed86fc">LPT_ACK</a>:               <span class="comment">// negative port, negative MSCB usage</span>
<a name="l00637"></a>00637       mask = <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a> ? mask | (1 &lt;&lt; 3) : mask &amp; ~(1 &lt;&lt; 3);
<a name="l00638"></a>00638       <span class="keywordflow">break</span>;
<a name="l00639"></a>00639    <span class="keywordflow">case</span> <a class="code" href="mscb_8c.html#a86391e262670a0332b41754452fbdd7b">LPT_READMODE</a>:          <span class="comment">// positive</span>
<a name="l00640"></a>00640       mask = <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a> ? mask | (1 &lt;&lt; 5) : mask &amp; ~(1 &lt;&lt; 5);
<a name="l00641"></a>00641       <span class="keywordflow">break</span>;
<a name="l00642"></a>00642    }
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 <span class="preprocessor">#if defined(_MSC_VER)</span>
<a name="l00645"></a>00645 <span class="preprocessor"></span>   _outp((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>) (<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd + 2), mask);
<a name="l00646"></a>00646 <span class="preprocessor">#elif defined(OS_LINUX)</span>
<a name="l00647"></a>00647 <span class="preprocessor"></span>   ioctl(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, PPWCONTROL, &amp;mask);
<a name="l00648"></a>00648 <span class="preprocessor">#else</span>
<a name="l00649"></a>00649 <span class="preprocessor"></span>   <span class="comment">/* no-op unsupported operation */</span>
<a name="l00650"></a>00650 <span class="preprocessor">#endif</span>
<a name="l00651"></a>00651 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a55a9e966b6acd75d76b6a9fb2e8e3c05"></a><!-- doxytag: member="mscb.c::pp_wdata" ref="a55a9e966b6acd75d76b6a9fb2e8e3c05" args="(int fd, unsigned int data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pp_wdata </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00695">695</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01833">mscb_check()</a>, and <a class="el" href="mscb_8c_source.html#l00805">mscb_out()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00697"></a>00697 {
<a name="l00698"></a>00698 <span class="preprocessor">#if defined(_MSC_VER)</span>
<a name="l00699"></a>00699 <span class="preprocessor"></span>   _outp((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>) <a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>);
<a name="l00700"></a>00700 <span class="preprocessor">#elif defined(OS_LINUX)</span>
<a name="l00701"></a>00701 <span class="preprocessor"></span>   ioctl(<a class="code" href="mscb_8c.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[fd - 1].fd, PPWDATA, &amp;<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>);
<a name="l00702"></a>00702 <span class="preprocessor">#else</span>
<a name="l00703"></a>00703 <span class="preprocessor"></span>   <span class="comment">/* no-op unsupported operation */</span>
<a name="l00704"></a>00704 <span class="preprocessor">#endif</span>
<a name="l00705"></a>00705 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="aecbad4f0c6c72f0f88c16c11dec81768"></a><!-- doxytag: member="mscb.c::strieq" ref="aecbad4f0c6c72f0f88c16c11dec81768" args="(const char *str1, const char *str2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int strieq </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>str1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>str2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00542">542</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="mscb_8c_source.html#l01593">mscb_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00543"></a>00543 {
<a name="l00544"></a>00544    <span class="keywordflow">if</span> (str1 == NULL &amp;&amp; str2 != NULL)
<a name="l00545"></a>00545       <span class="keywordflow">return</span> 0;
<a name="l00546"></a>00546    <span class="keywordflow">if</span> (str1 != NULL &amp;&amp; str2 == NULL)
<a name="l00547"></a>00547       <span class="keywordflow">return</span> 0;
<a name="l00548"></a>00548    <span class="keywordflow">if</span> (str1 == NULL &amp;&amp; str2 == NULL)
<a name="l00549"></a>00549       <span class="keywordflow">return</span> 1;
<a name="l00550"></a>00550 
<a name="l00551"></a>00551    <span class="keywordflow">while</span> (*str1)
<a name="l00552"></a>00552       <span class="keywordflow">if</span> (toupper(*str1++) != toupper(*str2++))
<a name="l00553"></a>00553          <span class="keywordflow">return</span> 0;
<a name="l00554"></a>00554 
<a name="l00555"></a>00555    <span class="keywordflow">if</span> (*str2)
<a name="l00556"></a>00556       <span class="keywordflow">return</span> 0;
<a name="l00557"></a>00557 
<a name="l00558"></a>00558    <span class="keywordflow">return</span> 1;
<a name="l00559"></a>00559 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a08a3fda60543c77e368c74b10f3d9799"></a><!-- doxytag: member="mscb.c::strlcat" ref="a08a3fda60543c77e368c74b10f3d9799" args="(char *dst, const char *src, size_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t strlcat </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00445">445</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="odb_8c_source.html#l05976">db_save_xml_key()</a>, <a class="el" href="mserver_8c_source.html#l00207">debug_print()</a>, <a class="el" href="mhttpd_8c_source.html#l01185">receive_message()</a>, <a class="el" href="mhttpd_8c_source.html#l01203">sendmail()</a>, <a class="el" href="mhttpd_8c_source.html#l03805">submit_elog()</a>, and <a class="el" href="odb_8c_source.html#l05933">xml_encode()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00446"></a>00446 {
<a name="l00447"></a>00447    <span class="keywordtype">char</span> *<a class="code" href="system_8c.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> = dst;
<a name="l00448"></a>00448    <span class="keyword">const</span> <span class="keywordtype">char</span> *s = src;
<a name="l00449"></a>00449    <span class="keywordtype">size_t</span> <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l00450"></a>00450    <span class="keywordtype">size_t</span> dlen;
<a name="l00451"></a>00451 
<a name="l00452"></a>00452    <span class="comment">/* Find the end of dst and adjust bytes left but don&apos;t go past end */</span>
<a name="l00453"></a>00453    <span class="keywordflow">while</span> (n-- != 0 &amp;&amp; *d != <span class="charliteral">&apos;\0&apos;</span>)
<a name="l00454"></a>00454       d++;
<a name="l00455"></a>00455    dlen = d - dst;
<a name="l00456"></a>00456    n = <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> - dlen;
<a name="l00457"></a>00457 
<a name="l00458"></a>00458    <span class="keywordflow">if</span> (n == 0)
<a name="l00459"></a>00459       <span class="keywordflow">return</span> (dlen + strlen(s));
<a name="l00460"></a>00460    <span class="keywordflow">while</span> (*s != <span class="charliteral">&apos;\0&apos;</span>) {
<a name="l00461"></a>00461       <span class="keywordflow">if</span> (n != 1) {
<a name="l00462"></a>00462          *d++ = *s;
<a name="l00463"></a>00463          n--;
<a name="l00464"></a>00464       }
<a name="l00465"></a>00465       s++;
<a name="l00466"></a>00466    }
<a name="l00467"></a>00467    *d = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00468"></a>00468 
<a name="l00469"></a>00469    <span class="keywordflow">return</span> (dlen + (s - src));   <span class="comment">/* count does not include NUL */</span>
<a name="l00470"></a>00470 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4637af6f79bac4043e1064f0837d0ddc"></a><!-- doxytag: member="mscb.c::strlcpy" ref="a4637af6f79bac4043e1064f0837d0ddc" args="(char *dst, const char *src, size_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t strlcpy </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00414">414</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l02229">cm_get_environment()</a>, <a class="el" href="midas_8c_source.html#l01771">cm_scan_experiments()</a>, <a class="el" href="odb_8c_source.html#l07266">db_create_record()</a>, <a class="el" href="odb_8c_source.html#l06308">db_sprintf()</a>, <a class="el" href="mhttpd_8c_source.html#l09841">decode_post()</a>, <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>, <a class="el" href="mscb_8c_source.html#l01593">mscb_init()</a>, <a class="el" href="mscb_8c_source.html#l03438">mscb_select_device()</a>, <a class="el" href="mhttpd_8c_source.html#l01203">sendmail()</a>, <a class="el" href="mhttpd_8c_source.html#l01042">setparam()</a>, <a class="el" href="system_8c_source.html#l01232">ss_shell()</a>, and <a class="el" href="odb_8c_source.html#l05933">xml_encode()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00415"></a>00415 {
<a name="l00416"></a>00416    <span class="keywordtype">char</span> *<a class="code" href="system_8c.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> = dst;
<a name="l00417"></a>00417    <span class="keyword">const</span> <span class="keywordtype">char</span> *s = src;
<a name="l00418"></a>00418    <span class="keywordtype">size_t</span> <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l00419"></a>00419 
<a name="l00420"></a>00420    <span class="comment">/* Copy as many bytes as will fit */</span>
<a name="l00421"></a>00421    <span class="keywordflow">if</span> (n != 0 &amp;&amp; --n != 0) {
<a name="l00422"></a>00422       <span class="keywordflow">do</span> {
<a name="l00423"></a>00423          <span class="keywordflow">if</span> ((*d++ = *s++) == 0)
<a name="l00424"></a>00424             <span class="keywordflow">break</span>;
<a name="l00425"></a>00425       } <span class="keywordflow">while</span> (--n != 0);
<a name="l00426"></a>00426    }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428    <span class="comment">/* Not enough room in dst, add NUL and traverse rest of src */</span>
<a name="l00429"></a>00429    <span class="keywordflow">if</span> (n == 0) {
<a name="l00430"></a>00430       <span class="keywordflow">if</span> (<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> != 0)
<a name="l00431"></a>00431          *d = <span class="charliteral">&apos;\0&apos;</span>;             <span class="comment">/* NUL-terminate dst */</span>
<a name="l00432"></a>00432       <span class="keywordflow">while</span> (*s++);
<a name="l00433"></a>00433    }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435    <span class="keywordflow">return</span> (s - src - 1);        <span class="comment">/* count does not include NUL */</span>
<a name="l00436"></a>00436 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a4112ca82bbeb36f213b9aeee78a70627"></a><!-- doxytag: member="mscb.c::_debug_flag" ref="a4112ca82bbeb36f213b9aeee78a70627" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="rpc_8c.html#a4112ca82bbeb36f213b9aeee78a70627">_debug_flag</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="rpc_8c_source.html#l00118">118</a> of file <a class="el" href="rpc_8c_source.html">rpc.c</a>.</p>

<p>Referenced by <a class="el" href="rpc_8c_source.html#l00298">debug_log()</a>, and <a class="el" href="mscb_8c_source.html#l01593">mscb_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a16d7212079e4dda3b5f56b05051ad7b4"></a><!-- doxytag: member="mscb.c::cache" ref="a16d7212079e4dda3b5f56b05051ad7b4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structCACHE__ENTRY.html">CACHE_ENTRY</a>* <a class="el" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00384">384</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l14339">hs_read()</a>.</p>

</div>
</div>
<a class="anchor" id="a29a5bc733da811e1a7a9002c882a5b35"></a><!-- doxytag: member="mscb.c::crc8_data" ref="a29a5bc733da811e1a7a9002c882a5b35" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char <a class="el" href="mscb_8c.html#a29a5bc733da811e1a7a9002c882a5b35">crc8_data</a>[]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00476">476</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1c1583e306a1688dccce81a7085ac15a"></a><!-- doxytag: member="mscb.c::mscb_fd" ref="a1c1583e306a1688dccce81a7085ac15a" args="[MSCB_MAX_FD]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structMSCB__FD.html">MSCB_FD</a> <a class="el" href="mscb_8h.html#a1c1583e306a1688dccce81a7085ac15a">mscb_fd</a>[MSCB_MAX_FD]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00286">286</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

</div>
</div>
<a class="anchor" id="aaeaf6cad3f72c74f6b0e5a08fba8a8ae"></a><!-- doxytag: member="mscb.c::n_cache" ref="aaeaf6cad3f72c74f6b0e5a08fba8a8ae" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="mscb_8c.html#aaeaf6cad3f72c74f6b0e5a08fba8a8ae">n_cache</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mscb_8c_source.html#l00385">385</a> of file <a class="el" href="mscb_8c_source.html">mscb.c</a>.</p>

<p>Referenced by <a class="el" href="mana__orig_8c_source.html#l00920">db_get_event_definition()</a>, <a class="el" href="mscb_8c_source.html#l01593">mscb_init()</a>, and <a class="el" href="mscb_8c_source.html#l03334">mscb_link()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 6 Jun 2014 for AlcapDAQ by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
