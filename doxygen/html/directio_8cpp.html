<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>AlcapDAQ:Rootana: midas/NT/directio/directio.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>midas/NT/directio/directio.cpp File Reference</h1><code>#include &lt;ntddk.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;devioctl.h&gt;</code><br/>
<code>#include &lt;conio.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="directio_8h_source.html">directio.h</a>&quot;</code><br/>

<p><a href="directio_8cpp_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structTLocalDevInfo.html">TLocalDevInfo</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structTDirectIOInfo.html">TDirectIOInfo</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#aeee0b04ba7ae605889816180dea6b5e1">DIRECTIO_DEVICE_NAME</a>&nbsp;&nbsp;&nbsp;L&quot;\\Device\\DirectIO&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#a5fdfdac1c84d60a295f17a77c86e2aaf">DOS_DEVICE_NAME</a>&nbsp;&nbsp;&nbsp;L&quot;\\DosDevices\\DirectIO&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#a3db0df1165fd78ebd0af2184562f090c">IOPM_SIZE</a>&nbsp;&nbsp;&nbsp;0x2000</td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="jorway73a_8h.html#a4f4bb67531a9bf6f0b9c6ad76aeba587">UCHAR</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#a991e7b733595d596e6135412fee2fb9e">IOPMTYP</a> [IOPM_SIZE]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structTLocalDevInfo.html">TLocalDevInfo</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#a2439b9dc4e37d01529751a5bf78fdf39">PLocalDevInfo</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structTDirectIOInfo.html">TDirectIOInfo</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#a913fd46ea86f6c63aa5b0b7fe4ff4239">PDirectIOInfo</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#a3a5bebbfbed2de85811efafee942cda0">Ke386SetIoAccessMap</a> (int, <a class="el" href="directio_8cpp.html#a991e7b733595d596e6135412fee2fb9e">IOPMTYP</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#af1237e786d64eba11e72e4972cbc9a3e">Ke386QueryIoAccessMap</a> (int, <a class="el" href="directio_8cpp.html#a991e7b733595d596e6135412fee2fb9e">IOPMTYP</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#a20b32873ea8719ed16343a7babb67b39">Ke386IoSetAccessProcess</a> (PEPROCESS, int)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#af2111fd920a760622ff0dddd8dd7e06f">__declspec</a> (dllimport) <a class="el" href="directio_8cpp.html#aec7e62084419d7857ae740a4c68241cf">BOOLEAN</a> MmIsAddressValid(IN <a class="el" href="PciTypes_8h.html#a2d95e4cb2ea675bb0e310e44cb81c549">PVOID</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">NTSTATUS&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#aff3daf378b9c7c0c98ad3013fe3dd2a6">DirectIO_CreateDevice</a> (IN PWSTR PrototypeName, IN DEVICE_TYPE DeviceType, IN PDRIVER_OBJECT DriverObject, OUT PDEVICE_OBJECT *ppDevObj)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#a027b6c3dbe3c7bb4c01d5dff22fc9730">SetIOPermissionFree</a> (int OnFlag, int pstart, int pend, <a class="el" href="directio_8cpp.html#a991e7b733595d596e6135412fee2fb9e">IOPMTYP</a> iopm)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#a58534199ea4e9902e1fc9f89479aba25">SetIOPermissionLock</a> (int OnFlag, int pstart, int pend, <a class="el" href="directio_8cpp.html#a991e7b733595d596e6135412fee2fb9e">IOPMTYP</a> iopm)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static NTSTATUS&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#a5b487bafca9f2254363e80cf430bc59b">ProbePCI</a> (<a class="el" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a> VendorID, <a class="el" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a> DeviceID, <a class="el" href="jorway73a_8h.html#a4f4bb67531a9bf6f0b9c6ad76aeba587">UCHAR</a> *Irq, <a class="el" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a> *BaseAdr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">NTSTATUS&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#a253cf0c19d0efce7cd03e96d6c2790b4">DirectIO_Control</a> (IN <a class="el" href="structTLocalDevInfo.html">PLocalDevInfo</a> pLDI, IN PIRP pIrp, IN PIO_STACK_LOCATION IrpStack, IN <a class="el" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a> IoctlCode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">NTSTATUS&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#a85c8204286603adc8bd1a7f45703ecda">DirectIO_Dispatch</a> (IN PDEVICE_OBJECT pDO, IN PIRP pIrp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="PciTypes_8h.html#a7927e087749615dae3114cc27b91c86d">VOID</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#a19cc6b8c85320e70003bca4b5827e334">DirectIO_Unload</a> (PDRIVER_OBJECT DriverObject)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">NTSTATUS&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#a6502d781bd20234a06710b92d540baba">DriverEntry</a> (IN PDRIVER_OBJECT DriverObject, IN PUNICODE_STRING RegistryPath)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="directio_8cpp.html#aec7e62084419d7857ae740a4c68241cf">BOOLEAN</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="aeee0b04ba7ae605889816180dea6b5e1"></a><!-- doxytag: member="directio.cpp::DIRECTIO_DEVICE_NAME" ref="aeee0b04ba7ae605889816180dea6b5e1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DIRECTIO_DEVICE_NAME&nbsp;&nbsp;&nbsp;L&quot;\\Device\\DirectIO&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="directio_8cpp_source.html#l00015">15</a> of file <a class="el" href="directio_8cpp_source.html">directio.cpp</a>.</p>

<p>Referenced by <a class="el" href="directio_8cpp_source.html#l00267">DriverEntry()</a>.</p>

</div>
</div>
<a class="anchor" id="a5fdfdac1c84d60a295f17a77c86e2aaf"></a><!-- doxytag: member="directio.cpp::DOS_DEVICE_NAME" ref="a5fdfdac1c84d60a295f17a77c86e2aaf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DOS_DEVICE_NAME&nbsp;&nbsp;&nbsp;L&quot;\\DosDevices\\DirectIO&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="directio_8cpp_source.html#l00016">16</a> of file <a class="el" href="directio_8cpp_source.html">directio.cpp</a>.</p>

<p>Referenced by <a class="el" href="directio_8cpp_source.html#l00041">DirectIO_CreateDevice()</a>, and <a class="el" href="directio_8cpp_source.html#l00259">DirectIO_Unload()</a>.</p>

</div>
</div>
<a class="anchor" id="a3db0df1165fd78ebd0af2184562f090c"></a><!-- doxytag: member="directio.cpp::IOPM_SIZE" ref="a3db0df1165fd78ebd0af2184562f090c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IOPM_SIZE&nbsp;&nbsp;&nbsp;0x2000</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="directio_8cpp_source.html#l00017">17</a> of file <a class="el" href="directio_8cpp_source.html">directio.cpp</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="a991e7b733595d596e6135412fee2fb9e"></a><!-- doxytag: member="directio.cpp::IOPMTYP" ref="a991e7b733595d596e6135412fee2fb9e" args="[IOPM_SIZE]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="jorway73a_8h.html#a4f4bb67531a9bf6f0b9c6ad76aeba587">UCHAR</a> <a class="el" href="directio_8cpp.html#a991e7b733595d596e6135412fee2fb9e">IOPMTYP</a>[IOPM_SIZE]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="directio_8cpp_source.html#l00019">19</a> of file <a class="el" href="directio_8cpp_source.html">directio.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a913fd46ea86f6c63aa5b0b7fe4ff4239"></a><!-- doxytag: member="directio.cpp::PDirectIOInfo" ref="a913fd46ea86f6c63aa5b0b7fe4ff4239" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef  struct <a class="el" href="structTDirectIOInfo.html">TDirectIOInfo</a>*  <a class="el" href="structTDirectIOInfo.html">PDirectIOInfo</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a2439b9dc4e37d01529751a5bf78fdf39"></a><!-- doxytag: member="directio.cpp::PLocalDevInfo" ref="a2439b9dc4e37d01529751a5bf78fdf39" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef  struct <a class="el" href="structTLocalDevInfo.html">TLocalDevInfo</a>*  <a class="el" href="structTLocalDevInfo.html">PLocalDevInfo</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="af2111fd920a760622ff0dddd8dd7e06f"></a><!-- doxytag: member="directio.cpp::__declspec" ref="af2111fd920a760622ff0dddd8dd7e06f" args="(dllimport) BOOLEAN MmIsAddressValid(IN PVOID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__declspec </td>
          <td>(</td>
          <td class="paramtype">dllimport&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a253cf0c19d0efce7cd03e96d6c2790b4"></a><!-- doxytag: member="directio.cpp::DirectIO_Control" ref="a253cf0c19d0efce7cd03e96d6c2790b4" args="(IN PLocalDevInfo pLDI, IN PIRP pIrp, IN PIO_STACK_LOCATION IrpStack, IN ULONG IoctlCode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">NTSTATUS DirectIO_Control </td>
          <td>(</td>
          <td class="paramtype">IN <a class="el" href="structTLocalDevInfo.html">PLocalDevInfo</a>&nbsp;</td>
          <td class="paramname"> <em>pLDI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN PIRP&nbsp;</td>
          <td class="paramname"> <em>pIrp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN PIO_STACK_LOCATION&nbsp;</td>
          <td class="paramname"> <em>IrpStack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN <a class="el" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a>&nbsp;</td>
          <td class="paramname"> <em>IoctlCode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="directio_8cpp_source.html#l00135">135</a> of file <a class="el" href="directio_8cpp_source.html">directio.cpp</a>.</p>

<p>References <a class="el" href="directio_8h_source.html#l00006">OP_Check</a>, <a class="el" href="directio_8h_source.html#l00011">OP_GiveIO</a>, <a class="el" href="directio_8h_source.html#l00012">OP_LockIO</a>, <a class="el" href="directio_8h_source.html#l00013">OP_PCIInfo</a>, <a class="el" href="directio_8h_source.html#l00009">OP_ReadPhysMemDword</a>, <a class="el" href="directio_8h_source.html#l00007">OP_ReadPortByte</a>, <a class="el" href="directio_8h_source.html#l00010">OP_WritePhysMemDword</a>, <a class="el" href="directio_8h_source.html#l00008">OP_WritePortByte</a>, <a class="el" href="directio_8cpp_source.html#l00027">TDirectIOInfo::OpCode</a>, <a class="el" href="directio_8cpp_source.html#l00028">TDirectIOInfo::Par1</a>, <a class="el" href="directio_8cpp_source.html#l00029">TDirectIOInfo::Par2</a>, <a class="el" href="directio_8cpp_source.html#l00078">ProbePCI()</a>, <a class="el" href="directio_8cpp_source.html#l00059">SetIOPermissionFree()</a>, <a class="el" href="directio_8cpp_source.html#l00068">SetIOPermissionLock()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, and <a class="el" href="directio_8cpp_source.html#l00038">ULONG</a>.</p>

<p>Referenced by <a class="el" href="directio_8cpp_source.html#l00233">DirectIO_Dispatch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00137"></a>00137 {
<a name="l00138"></a>00138   <a class="code" href="structTDirectIOInfo.html">PDirectIOInfo</a> InBuf=(<a class="code" href="structTDirectIOInfo.html">PDirectIOInfo</a>)pIrp-&gt;AssociatedIrp.SystemBuffer;
<a name="l00139"></a>00139   <a class="code" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a> InBufSize=IrpStack-&gt;Parameters.DeviceIoControl.InputBufferLength;
<a name="l00140"></a>00140   <a class="code" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a> OpCode=InBuf-&gt;<a class="code" href="structTDirectIOInfo.html#a5649c5d707185f5f0be5c972ae79d5cb">OpCode</a>;
<a name="l00141"></a>00141   <a class="code" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, BaseAdr[6];
<a name="l00142"></a>00142   <a class="code" href="jorway73a_8h.html#a4f4bb67531a9bf6f0b9c6ad76aeba587">UCHAR</a> Irq;
<a name="l00143"></a>00143   <span class="keywordtype">void</span> *OutBuf=(<span class="keywordtype">void</span> *)pIrp-&gt;AssociatedIrp.SystemBuffer;
<a name="l00144"></a>00144   <a class="code" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a> OutBufSize=IrpStack-&gt;Parameters.DeviceIoControl.OutputBufferLength;
<a name="l00145"></a>00145   <a class="code" href="PciTypes_8h.html#a2d95e4cb2ea675bb0e310e44cb81c549">PVOID</a> Linadr;
<a name="l00146"></a>00146   PHYSICAL_ADDRESS PADDR;
<a name="l00147"></a>00147 
<a name="l00148"></a>00148   <span class="keywordflow">switch</span>(OpCode) {
<a name="l00149"></a>00149 
<a name="l00150"></a>00150   <span class="keywordflow">case</span> <a class="code" href="directio_8h.html#a9d7851c437f4f392064226d6755bdafc">OP_Check</a>:
<a name="l00151"></a>00151     *(PULONG)OutBuf = 0x12345678;
<a name="l00152"></a>00152     pIrp-&gt;IoStatus.Information = <span class="keyword">sizeof</span>(<a class="code" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a>);
<a name="l00153"></a>00153     <span class="keywordflow">return</span> STATUS_SUCCESS;
<a name="l00154"></a>00154 
<a name="l00155"></a>00155   <span class="keywordflow">case</span> <a class="code" href="directio_8h.html#acdad785de1175169763340d6a1b8c6f7">OP_GiveIO</a>:
<a name="l00156"></a>00156     <a class="code" href="directio_8cpp.html#a027b6c3dbe3c7bb4c01d5dff22fc9730">SetIOPermissionFree</a>(1,InBuf-&gt;<a class="code" href="structTDirectIOInfo.html#aca7a5b63412d7271b53f1dfc682eac82">Par1</a>,InBuf-&gt;<a class="code" href="structTDirectIOInfo.html#aeff0991bb10a44b3c3650e12843f9363">Par2</a>,pLDI-&gt;iopm);
<a name="l00157"></a>00157     pIrp-&gt;IoStatus.Information = 0;
<a name="l00158"></a>00158     <span class="keywordflow">return</span> STATUS_SUCCESS;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160   <span class="keywordflow">case</span> <a class="code" href="directio_8h.html#a200ed8721ca37137176f545d20af475f">OP_LockIO</a>:
<a name="l00161"></a>00161     <a class="code" href="directio_8cpp.html#a58534199ea4e9902e1fc9f89479aba25">SetIOPermissionLock</a>(1,InBuf-&gt;<a class="code" href="structTDirectIOInfo.html#aca7a5b63412d7271b53f1dfc682eac82">Par1</a>,InBuf-&gt;<a class="code" href="structTDirectIOInfo.html#aeff0991bb10a44b3c3650e12843f9363">Par2</a>,pLDI-&gt;iopm);
<a name="l00162"></a>00162     pIrp-&gt;IoStatus.Information = 0;
<a name="l00163"></a>00163     <span class="keywordflow">return</span> STATUS_SUCCESS;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165   <span class="keywordflow">case</span> <a class="code" href="directio_8h.html#ae9cc0d7e162cb602395d94b4e7909333">OP_ReadPortByte</a>:
<a name="l00166"></a>00166     *(PUCHAR)OutBuf = READ_PORT_UCHAR((PUCHAR)InBuf-&gt;<a class="code" href="structTDirectIOInfo.html#aca7a5b63412d7271b53f1dfc682eac82">Par1</a>);
<a name="l00167"></a>00167     pIrp-&gt;IoStatus.Information = <span class="keyword">sizeof</span>(<a class="code" href="jorway73a_8h.html#a4f4bb67531a9bf6f0b9c6ad76aeba587">UCHAR</a>);
<a name="l00168"></a>00168     <span class="keywordflow">return</span> STATUS_SUCCESS;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170   <span class="keywordflow">case</span> <a class="code" href="directio_8h.html#a9c215b3034f0042d9afe33544f2bdc89">OP_WritePortByte</a>:
<a name="l00171"></a>00171     WRITE_PORT_UCHAR((PUCHAR)InBuf-&gt;<a class="code" href="structTDirectIOInfo.html#aca7a5b63412d7271b53f1dfc682eac82">Par1</a>,(<a class="code" href="jorway73a_8h.html#a4f4bb67531a9bf6f0b9c6ad76aeba587">UCHAR</a>)InBuf-&gt;<a class="code" href="structTDirectIOInfo.html#aeff0991bb10a44b3c3650e12843f9363">Par2</a>);
<a name="l00172"></a>00172     pIrp-&gt;IoStatus.Information = 0;
<a name="l00173"></a>00173     <span class="keywordflow">return</span> STATUS_SUCCESS;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 <span class="comment">/*  case OP_ReadMemDword:</span>
<a name="l00176"></a>00176 <span class="comment"></span>
<a name="l00177"></a>00177 <span class="comment">  if (MmIsAddressValid)</span>
<a name="l00178"></a>00178 <span class="comment">     {</span>
<a name="l00179"></a>00179 <span class="comment">     *(PULONG)OutBuf = *(ULONG*) (InBuf-&gt;Par1);</span>
<a name="l00180"></a>00180 <span class="comment">     pIrp-&gt;IoStatus.Information = sizeof(ULONG);</span>
<a name="l00181"></a>00181 <span class="comment">     return STATUS_SUCCESS;</span>
<a name="l00182"></a>00182 <span class="comment">   }</span>
<a name="l00183"></a>00183 <span class="comment">  else</span>
<a name="l00184"></a>00184 <span class="comment">   {</span>
<a name="l00185"></a>00185 <span class="comment">   pIrp-&gt;IoStatus.Information = 0;</span>
<a name="l00186"></a>00186 <span class="comment">     return STATUS_ACCESS_VIOLATION;</span>
<a name="l00187"></a>00187 <span class="comment">     }</span>
<a name="l00188"></a>00188 <span class="comment">*/</span>
<a name="l00189"></a>00189   <span class="keywordflow">case</span> <a class="code" href="directio_8h.html#a2fdb728769578c0f15f945c51650f4f0">OP_ReadPhysMemDword</a>:
<a name="l00190"></a>00190     PADDR.LowPart=(<a class="code" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a>) (InBuf-&gt;<a class="code" href="structTDirectIOInfo.html#aca7a5b63412d7271b53f1dfc682eac82">Par1</a>);
<a name="l00191"></a>00191     PADDR.HighPart=0;         <span class="comment">// Reserve für &gt; 4GByte</span>
<a name="l00192"></a>00192     Linadr=MmMapIoSpace (PADDR,4,MmNonCached);
<a name="l00193"></a>00193     *(PULONG)OutBuf = *(<a class="code" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a>*) Linadr;
<a name="l00194"></a>00194     MmUnmapIoSpace (Linadr,4);
<a name="l00195"></a>00195     pIrp-&gt;IoStatus.Information = <span class="keyword">sizeof</span>(<a class="code" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a>);
<a name="l00196"></a>00196     <span class="keywordflow">return</span> STATUS_SUCCESS;
<a name="l00197"></a>00197 
<a name="l00198"></a>00198   <span class="keywordflow">case</span> <a class="code" href="directio_8h.html#a04e863bc82c2083259b246547c54e393">OP_WritePhysMemDword</a>:
<a name="l00199"></a>00199     PADDR.LowPart=(<a class="code" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a>) (InBuf-&gt;<a class="code" href="structTDirectIOInfo.html#aca7a5b63412d7271b53f1dfc682eac82">Par1</a>);
<a name="l00200"></a>00200     PADDR.HighPart=0;         <span class="comment">// Reserve für &gt; 4GByte</span>
<a name="l00201"></a>00201     Linadr=MmMapIoSpace (PADDR,4,MmNonCached);
<a name="l00202"></a>00202     *(<a class="code" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a>*) Linadr = *(PULONG)InBuf-&gt;<a class="code" href="structTDirectIOInfo.html#aeff0991bb10a44b3c3650e12843f9363">Par2</a>;
<a name="l00203"></a>00203     MmUnmapIoSpace (Linadr,4);
<a name="l00204"></a>00204     pIrp-&gt;IoStatus.Information = <span class="keyword">sizeof</span>(<a class="code" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a>);
<a name="l00205"></a>00205     <span class="keywordflow">return</span> STATUS_SUCCESS;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207   <span class="keywordflow">case</span> <a class="code" href="directio_8h.html#a473606b2a0ac0d1938260da1faf25f7b">OP_PCIInfo</a>:
<a name="l00208"></a>00208     status = <a class="code" href="directio_8cpp.html#a5b487bafca9f2254363e80cf430bc59b">ProbePCI</a>(InBuf-&gt;<a class="code" href="structTDirectIOInfo.html#aca7a5b63412d7271b53f1dfc682eac82">Par1</a>, InBuf-&gt;<a class="code" href="structTDirectIOInfo.html#aeff0991bb10a44b3c3650e12843f9363">Par2</a>, &amp;Irq, BaseAdr);
<a name="l00209"></a>00209     <span class="keywordflow">if</span> (status == STATUS_NO_SUCH_DEVICE)
<a name="l00210"></a>00210       pIrp-&gt;IoStatus.Information = 0;
<a name="l00211"></a>00211     <span class="keywordflow">else</span>
<a name="l00212"></a>00212       {
<a name="l00213"></a>00213       DbgPrint(<span class="stringliteral">&quot;DirectIO: BaseAdr0 = %X\n&quot;</span>, BaseAdr[0]);
<a name="l00214"></a>00214       DbgPrint(<span class="stringliteral">&quot;DirectIO: BaseAdr1 = %X\n&quot;</span>, BaseAdr[1]);
<a name="l00215"></a>00215       *(PULONG)OutBuf = (<a class="code" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a>)Irq;
<a name="l00216"></a>00216       *((PULONG)OutBuf+1) = BaseAdr[0];
<a name="l00217"></a>00217       *((PULONG)OutBuf+2) = BaseAdr[1];
<a name="l00218"></a>00218       *((PULONG)OutBuf+3) = BaseAdr[2];
<a name="l00219"></a>00219       *((PULONG)OutBuf+4) = BaseAdr[3];
<a name="l00220"></a>00220       *((PULONG)OutBuf+5) = BaseAdr[4];
<a name="l00221"></a>00221       *((PULONG)OutBuf+6) = BaseAdr[5];
<a name="l00222"></a>00222       pIrp-&gt;IoStatus.Information = 7*<span class="keyword">sizeof</span>(<a class="code" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a>);
<a name="l00223"></a>00223       }
<a name="l00224"></a>00224     <span class="keywordflow">return</span> STATUS_SUCCESS;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 
<a name="l00227"></a>00227   }
<a name="l00228"></a>00228   <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
<a name="l00229"></a>00229 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aff3daf378b9c7c0c98ad3013fe3dd2a6"></a><!-- doxytag: member="directio.cpp::DirectIO_CreateDevice" ref="aff3daf378b9c7c0c98ad3013fe3dd2a6" args="(IN PWSTR PrototypeName, IN DEVICE_TYPE DeviceType, IN PDRIVER_OBJECT DriverObject, OUT PDEVICE_OBJECT *ppDevObj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">NTSTATUS DirectIO_CreateDevice </td>
          <td>(</td>
          <td class="paramtype">IN PWSTR&nbsp;</td>
          <td class="paramname"> <em>PrototypeName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN DEVICE_TYPE&nbsp;</td>
          <td class="paramname"> <em>DeviceType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN PDRIVER_OBJECT&nbsp;</td>
          <td class="paramname"> <em>DriverObject</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OUT PDEVICE_OBJECT *&nbsp;</td>
          <td class="paramname"> <em>ppDevObj</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="directio_8cpp_source.html#l00041">41</a> of file <a class="el" href="directio_8cpp_source.html">directio.cpp</a>.</p>

<p>References <a class="el" href="directio_8cpp_source.html#l00016">DOS_DEVICE_NAME</a>, and <a class="el" href="p30_8h_source.html#l00042">FALSE</a>.</p>

<p>Referenced by <a class="el" href="directio_8cpp_source.html#l00267">DriverEntry()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00044"></a>00044 {
<a name="l00045"></a>00045   UNICODE_STRING NtDeviceName;
<a name="l00046"></a>00046   UNICODE_STRING Win32DeviceName;
<a name="l00047"></a>00047   RtlInitUnicodeString(&amp;NtDeviceName,PrototypeName);
<a name="l00048"></a>00048   NTSTATUS Status = IoCreateDevice(DriverObject,<span class="keyword">sizeof</span>(<a class="code" href="structTLocalDevInfo.html">TLocalDevInfo</a>),
<a name="l00049"></a>00049                             &amp;NtDeviceName,DeviceType,0,<a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>,ppDevObj);
<a name="l00050"></a>00050   <span class="keywordflow">if</span> (!NT_SUCCESS(Status)) <span class="keywordflow">return</span> Status;
<a name="l00051"></a>00051   RtlZeroMemory((*ppDevObj)-&gt;DeviceExtension,<span class="keyword">sizeof</span>(<a class="code" href="structTLocalDevInfo.html">TLocalDevInfo</a>));
<a name="l00052"></a>00052   RtlInitUnicodeString(&amp;Win32DeviceName,<a class="code" href="directio_8cpp.html#a5fdfdac1c84d60a295f17a77c86e2aaf">DOS_DEVICE_NAME</a>);
<a name="l00053"></a>00053   Status = IoCreateSymbolicLink(&amp;Win32DeviceName,&amp;NtDeviceName);
<a name="l00054"></a>00054   <span class="keywordflow">if</span> (!NT_SUCCESS(Status))
<a name="l00055"></a>00055     IoDeleteDevice(*ppDevObj);
<a name="l00056"></a>00056   <span class="keywordflow">return</span> Status;
<a name="l00057"></a>00057 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a85c8204286603adc8bd1a7f45703ecda"></a><!-- doxytag: member="directio.cpp::DirectIO_Dispatch" ref="a85c8204286603adc8bd1a7f45703ecda" args="(IN PDEVICE_OBJECT pDO, IN PIRP pIrp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">NTSTATUS DirectIO_Dispatch </td>
          <td>(</td>
          <td class="paramtype">IN PDEVICE_OBJECT&nbsp;</td>
          <td class="paramname"> <em>pDO</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN PIRP&nbsp;</td>
          <td class="paramname"> <em>pIrp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="directio_8cpp_source.html#l00233">233</a> of file <a class="el" href="directio_8cpp_source.html">directio.cpp</a>.</p>

<p>References <a class="el" href="directio_8cpp_source.html#l00135">DirectIO_Control()</a>, and <a class="el" href="directio_8h_source.html#l00003">IOCTL_DIRECTIO_CONTROL</a>.</p>

<p>Referenced by <a class="el" href="directio_8cpp_source.html#l00267">DriverEntry()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00234"></a>00234 {
<a name="l00235"></a>00235   pIrp-&gt;IoStatus.Information = 0;  <span class="comment">// Anzahl Rückgabe-Bytes</span>
<a name="l00236"></a>00236   <a class="code" href="structTLocalDevInfo.html">PLocalDevInfo</a>      pLDI      = (<a class="code" href="structTLocalDevInfo.html">PLocalDevInfo</a>)pDO-&gt;DeviceExtension;
<a name="l00237"></a>00237   PIO_STACK_LOCATION pIrpStack = IoGetCurrentIrpStackLocation(pIrp);
<a name="l00238"></a>00238   NTSTATUS           Status    = STATUS_NOT_IMPLEMENTED;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240   <span class="keywordflow">switch</span>(pIrpStack-&gt;MajorFunction) {
<a name="l00241"></a>00241   <span class="keywordflow">case</span> IRP_MJ_CREATE:
<a name="l00242"></a>00242   <span class="keywordflow">case</span> IRP_MJ_CLOSE:
<a name="l00243"></a>00243     Status = STATUS_SUCCESS;
<a name="l00244"></a>00244     <span class="keywordflow">break</span>;
<a name="l00245"></a>00245   <span class="keywordflow">case</span> IRP_MJ_DEVICE_CONTROL:
<a name="l00246"></a>00246     <span class="keywordflow">switch</span>(pIrpStack-&gt;Parameters.DeviceIoControl.IoControlCode) {
<a name="l00247"></a>00247       <span class="keywordflow">case</span> <a class="code" href="directio_8h.html#aa2d8015f5c619bdfce5b8fff9b135e2a">IOCTL_DIRECTIO_CONTROL</a>:
<a name="l00248"></a>00248         Status = <a class="code" href="directio_8cpp.html#a253cf0c19d0efce7cd03e96d6c2790b4">DirectIO_Control</a>(pLDI,pIrp,pIrpStack,
<a name="l00249"></a>00249           pIrpStack-&gt;Parameters.DeviceIoControl.IoControlCode);
<a name="l00250"></a>00250         <span class="keywordflow">break</span>;
<a name="l00251"></a>00251       }
<a name="l00252"></a>00252     <span class="keywordflow">break</span>;
<a name="l00253"></a>00253   }
<a name="l00254"></a>00254   pIrp-&gt;IoStatus.Status = Status;
<a name="l00255"></a>00255   IoCompleteRequest(pIrp,IO_NO_INCREMENT);
<a name="l00256"></a>00256   <span class="keywordflow">return</span> Status;
<a name="l00257"></a>00257 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a19cc6b8c85320e70003bca4b5827e334"></a><!-- doxytag: member="directio.cpp::DirectIO_Unload" ref="a19cc6b8c85320e70003bca4b5827e334" args="(PDRIVER_OBJECT DriverObject)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="PciTypes_8h.html#a7927e087749615dae3114cc27b91c86d">VOID</a> DirectIO_Unload </td>
          <td>(</td>
          <td class="paramtype">PDRIVER_OBJECT&nbsp;</td>
          <td class="paramname"> <em>DriverObject</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="directio_8cpp_source.html#l00259">259</a> of file <a class="el" href="directio_8cpp_source.html">directio.cpp</a>.</p>

<p>References <a class="el" href="directio_8cpp_source.html#l00016">DOS_DEVICE_NAME</a>.</p>

<p>Referenced by <a class="el" href="directio_8cpp_source.html#l00267">DriverEntry()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00260"></a>00260 { <span class="comment">// Symbolischen Link wieder auflösen</span>
<a name="l00261"></a>00261   UNICODE_STRING Win32DeviceName;
<a name="l00262"></a>00262   RtlInitUnicodeString(&amp;Win32DeviceName,<a class="code" href="directio_8cpp.html#a5fdfdac1c84d60a295f17a77c86e2aaf">DOS_DEVICE_NAME</a>);
<a name="l00263"></a>00263   IoDeleteSymbolicLink(&amp;Win32DeviceName);
<a name="l00264"></a>00264   IoDeleteDevice(DriverObject-&gt;DeviceObject);
<a name="l00265"></a>00265 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6502d781bd20234a06710b92d540baba"></a><!-- doxytag: member="directio.cpp::DriverEntry" ref="a6502d781bd20234a06710b92d540baba" args="(IN PDRIVER_OBJECT DriverObject, IN PUNICODE_STRING RegistryPath)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">NTSTATUS DriverEntry </td>
          <td>(</td>
          <td class="paramtype">IN PDRIVER_OBJECT&nbsp;</td>
          <td class="paramname"> <em>DriverObject</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN PUNICODE_STRING&nbsp;</td>
          <td class="paramname"> <em>RegistryPath</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="directio_8cpp_source.html#l00267">267</a> of file <a class="el" href="directio_8cpp_source.html">directio.cpp</a>.</p>

<p>References <a class="el" href="directio_8cpp_source.html#l00041">DirectIO_CreateDevice()</a>, <a class="el" href="directio_8cpp_source.html#l00015">DIRECTIO_DEVICE_NAME</a>, <a class="el" href="directio_8cpp_source.html#l00233">DirectIO_Dispatch()</a>, <a class="el" href="directio_8h_source.html#l00002">DIRECTIO_TYPE</a>, and <a class="el" href="directio_8cpp_source.html#l00259">DirectIO_Unload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00269"></a>00269 { <span class="comment">// Symbolischen Link erzeugen, so daß Win32 darauf zugreifen kann</span>
<a name="l00270"></a>00270   DriverObject-&gt;MajorFunction[IRP_MJ_CREATE]         = <a class="code" href="directio_8cpp.html#a85c8204286603adc8bd1a7f45703ecda">DirectIO_Dispatch</a>;
<a name="l00271"></a>00271   DriverObject-&gt;MajorFunction[IRP_MJ_CLOSE]          = <a class="code" href="directio_8cpp.html#a85c8204286603adc8bd1a7f45703ecda">DirectIO_Dispatch</a>;
<a name="l00272"></a>00272   DriverObject-&gt;MajorFunction[IRP_MJ_DEVICE_CONTROL] = <a class="code" href="directio_8cpp.html#a85c8204286603adc8bd1a7f45703ecda">DirectIO_Dispatch</a>;
<a name="l00273"></a>00273   DriverObject-&gt;DriverUnload                         = <a class="code" href="directio_8cpp.html#a19cc6b8c85320e70003bca4b5827e334">DirectIO_Unload</a>;
<a name="l00274"></a>00274   PDEVICE_OBJECT DeviceObject;
<a name="l00275"></a>00275   <span class="keywordflow">return</span> <a class="code" href="directio_8cpp.html#aff3daf378b9c7c0c98ad3013fe3dd2a6">DirectIO_CreateDevice</a>(<a class="code" href="directio_8cpp.html#aeee0b04ba7ae605889816180dea6b5e1">DIRECTIO_DEVICE_NAME</a>, <a class="code" href="directio_8h.html#aa15ecb3ad0a15ee7906597fed4ba25bf">DIRECTIO_TYPE</a>,
<a name="l00276"></a>00276                                DriverObject,&amp;DeviceObject);
<a name="l00277"></a>00277 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a20b32873ea8719ed16343a7babb67b39"></a><!-- doxytag: member="directio.cpp::Ke386IoSetAccessProcess" ref="a20b32873ea8719ed16343a7babb67b39" args="(PEPROCESS, int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Ke386IoSetAccessProcess </td>
          <td>(</td>
          <td class="paramtype">PEPROCESS&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="directio_8cpp_source.html#l00059">SetIOPermissionFree()</a>, and <a class="el" href="directio_8cpp_source.html#l00068">SetIOPermissionLock()</a>.</p>

</div>
</div>
<a class="anchor" id="af1237e786d64eba11e72e4972cbc9a3e"></a><!-- doxytag: member="directio.cpp::Ke386QueryIoAccessMap" ref="af1237e786d64eba11e72e4972cbc9a3e" args="(int, IOPMTYP)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Ke386QueryIoAccessMap </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="directio_8cpp.html#a991e7b733595d596e6135412fee2fb9e">IOPMTYP</a>&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="directio_8cpp_source.html#l00059">SetIOPermissionFree()</a>, and <a class="el" href="directio_8cpp_source.html#l00068">SetIOPermissionLock()</a>.</p>

</div>
</div>
<a class="anchor" id="a3a5bebbfbed2de85811efafee942cda0"></a><!-- doxytag: member="directio.cpp::Ke386SetIoAccessMap" ref="a3a5bebbfbed2de85811efafee942cda0" args="(int, IOPMTYP)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Ke386SetIoAccessMap </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="directio_8cpp.html#a991e7b733595d596e6135412fee2fb9e">IOPMTYP</a>&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="directio_8cpp_source.html#l00059">SetIOPermissionFree()</a>, and <a class="el" href="directio_8cpp_source.html#l00068">SetIOPermissionLock()</a>.</p>

</div>
</div>
<a class="anchor" id="a5b487bafca9f2254363e80cf430bc59b"></a><!-- doxytag: member="directio.cpp::ProbePCI" ref="a5b487bafca9f2254363e80cf430bc59b" args="(ULONG VendorID, ULONG DeviceID, UCHAR *Irq, ULONG *BaseAdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static NTSTATUS ProbePCI </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a>&nbsp;</td>
          <td class="paramname"> <em>VendorID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a>&nbsp;</td>
          <td class="paramname"> <em>DeviceID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="jorway73a_8h.html#a4f4bb67531a9bf6f0b9c6ad76aeba587">UCHAR</a> *&nbsp;</td>
          <td class="paramname"> <em>Irq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a> *&nbsp;</td>
          <td class="paramname"> <em>BaseAdr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="directio_8cpp_source.html#l00078">78</a> of file <a class="el" href="directio_8cpp_source.html">directio.cpp</a>.</p>

<p>References <a class="el" href="directio_8cpp_source.html#l00038">BOOLEAN</a>, <a class="el" href="new__fadc0_8cpp_source.html#l00078">buf</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="scs__310__ql355p_8c_source.html#l00055">flag</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, and <a class="el" href="directio_8cpp_source.html#l00038">ULONG</a>.</p>

<p>Referenced by <a class="el" href="directio_8cpp_source.html#l00135">DirectIO_Control()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00079"></a>00079 {
<a name="l00080"></a>00080 PCI_SLOT_NUMBER     slotNumber;
<a name="l00081"></a>00081 PPCI_COMMON_CONFIG  pciData;
<a name="l00082"></a>00082 <a class="code" href="jorway73a_8h.html#a4f4bb67531a9bf6f0b9c6ad76aeba587">UCHAR</a>               <a class="code" href="new__fadc0_8cpp.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>[PCI_COMMON_HDR_LENGTH];
<a name="l00083"></a>00083 <a class="code" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a>               <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, f, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, bus;
<a name="l00084"></a>00084 <a class="code" href="directio_8cpp.html#aec7e62084419d7857ae740a4c68241cf">BOOLEAN</a>             <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a>;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086   pciData = (PPCI_COMMON_CONFIG) buf;
<a name="l00087"></a>00087   slotNumber.u.bits.Reserved = 0;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089   flag = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00090"></a>00090   <span class="keywordflow">for</span> (bus = 0; flag; bus++)
<a name="l00091"></a>00091     {
<a name="l00092"></a>00092     <span class="keywordflow">for</span> (i = 0; i &lt; PCI_MAX_DEVICES  &amp;&amp;  flag; i++)
<a name="l00093"></a>00093       {
<a name="l00094"></a>00094       slotNumber.u.bits.DeviceNumber = i;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096       <span class="keywordflow">for</span> (f = 0; f &lt; PCI_MAX_FUNCTION; f++)
<a name="l00097"></a>00097         {
<a name="l00098"></a>00098         slotNumber.u.bits.FunctionNumber = f;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100         j = HalGetBusData(PCIConfiguration, bus, slotNumber.u.AsULONG,
<a name="l00101"></a>00101                           pciData, PCI_COMMON_HDR_LENGTH);
<a name="l00102"></a>00102 
<a name="l00103"></a>00103         <span class="keywordflow">if</span> (j == 0)
<a name="l00104"></a>00104           {
<a name="l00105"></a>00105           <span class="comment">/* out of buses */</span>
<a name="l00106"></a>00106           flag = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00107"></a>00107           <span class="keywordflow">break</span>;
<a name="l00108"></a>00108           }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110         <span class="keywordflow">if</span> (pciData-&gt;VendorID == PCI_INVALID_VENDORID)
<a name="l00111"></a>00111           {
<a name="l00112"></a>00112           <span class="comment">/* skip to next slot */</span>
<a name="l00113"></a>00113           <span class="keywordflow">break</span>;
<a name="l00114"></a>00114           }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116         <span class="comment">/* check for vendor and device id, return base address */</span>
<a name="l00117"></a>00117         <span class="keywordflow">if</span> (pciData-&gt;VendorID == VendorID &amp;&amp; pciData-&gt;DeviceID == DeviceID)
<a name="l00118"></a>00118           {
<a name="l00119"></a>00119           *Irq       = pciData-&gt;u.type0.InterruptLine;
<a name="l00120"></a>00120           BaseAdr[0] = pciData-&gt;u.type0.BaseAddresses[0];
<a name="l00121"></a>00121           BaseAdr[1] = pciData-&gt;u.type0.BaseAddresses[1];
<a name="l00122"></a>00122           BaseAdr[2] = pciData-&gt;u.type0.BaseAddresses[2];
<a name="l00123"></a>00123           BaseAdr[3] = pciData-&gt;u.type0.BaseAddresses[3];
<a name="l00124"></a>00124           BaseAdr[4] = pciData-&gt;u.type0.BaseAddresses[4];
<a name="l00125"></a>00125           BaseAdr[5] = pciData-&gt;u.type0.BaseAddresses[5];
<a name="l00126"></a>00126           <span class="keywordflow">return</span> STATUS_SUCCESS;
<a name="l00127"></a>00127           }
<a name="l00128"></a>00128         }
<a name="l00129"></a>00129       }
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131 
<a name="l00132"></a>00132   <span class="keywordflow">return</span> STATUS_NO_SUCH_DEVICE;
<a name="l00133"></a>00133 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a027b6c3dbe3c7bb4c01d5dff22fc9730"></a><!-- doxytag: member="directio.cpp::SetIOPermissionFree" ref="a027b6c3dbe3c7bb4c01d5dff22fc9730" args="(int OnFlag, int pstart, int pend, IOPMTYP iopm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SetIOPermissionFree </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>OnFlag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pstart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pend</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="directio_8cpp.html#a991e7b733595d596e6135412fee2fb9e">IOPMTYP</a>&nbsp;</td>
          <td class="paramname"> <em>iopm</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="directio_8cpp_source.html#l00059">59</a> of file <a class="el" href="directio_8cpp_source.html">directio.cpp</a>.</p>

<p>References <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="directio_8cpp.html#a20b32873ea8719ed16343a7babb67b39">Ke386IoSetAccessProcess()</a>, <a class="el" href="directio_8cpp.html#af1237e786d64eba11e72e4972cbc9a3e">Ke386QueryIoAccessMap()</a>, and <a class="el" href="directio_8cpp.html#a3a5bebbfbed2de85811efafee942cda0">Ke386SetIoAccessMap()</a>.</p>

<p>Referenced by <a class="el" href="directio_8cpp_source.html#l00135">DirectIO_Control()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00060"></a>00060 {
<a name="l00061"></a>00061   <a class="code" href="directio_8cpp.html#af1237e786d64eba11e72e4972cbc9a3e">Ke386QueryIoAccessMap</a>(1,iopm);
<a name="l00062"></a>00062   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>=pstart; <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>&lt;=pend; <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>++)
<a name="l00063"></a>00063     iopm[<a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>/8] &amp;= ~(1 &lt;&lt; (<a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>%8));
<a name="l00064"></a>00064   <a class="code" href="directio_8cpp.html#a20b32873ea8719ed16343a7babb67b39">Ke386IoSetAccessProcess</a>(PsGetCurrentProcess(), OnFlag);
<a name="l00065"></a>00065   <a class="code" href="directio_8cpp.html#a3a5bebbfbed2de85811efafee942cda0">Ke386SetIoAccessMap</a> (1,iopm);
<a name="l00066"></a>00066 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a58534199ea4e9902e1fc9f89479aba25"></a><!-- doxytag: member="directio.cpp::SetIOPermissionLock" ref="a58534199ea4e9902e1fc9f89479aba25" args="(int OnFlag, int pstart, int pend, IOPMTYP iopm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SetIOPermissionLock </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>OnFlag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pstart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pend</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="directio_8cpp.html#a991e7b733595d596e6135412fee2fb9e">IOPMTYP</a>&nbsp;</td>
          <td class="paramname"> <em>iopm</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="directio_8cpp_source.html#l00068">68</a> of file <a class="el" href="directio_8cpp_source.html">directio.cpp</a>.</p>

<p>References <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="directio_8cpp.html#a20b32873ea8719ed16343a7babb67b39">Ke386IoSetAccessProcess()</a>, <a class="el" href="directio_8cpp.html#af1237e786d64eba11e72e4972cbc9a3e">Ke386QueryIoAccessMap()</a>, and <a class="el" href="directio_8cpp.html#a3a5bebbfbed2de85811efafee942cda0">Ke386SetIoAccessMap()</a>.</p>

<p>Referenced by <a class="el" href="directio_8cpp_source.html#l00135">DirectIO_Control()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00069"></a>00069 {
<a name="l00070"></a>00070   <a class="code" href="directio_8cpp.html#af1237e786d64eba11e72e4972cbc9a3e">Ke386QueryIoAccessMap</a>(1,iopm);
<a name="l00071"></a>00071   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>=pstart; <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>&lt;=pend; <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>++)
<a name="l00072"></a>00072     iopm[<a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>/8] |= (1 &lt;&lt; (<a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>%8));
<a name="l00073"></a>00073   <a class="code" href="directio_8cpp.html#a20b32873ea8719ed16343a7babb67b39">Ke386IoSetAccessProcess</a>(PsGetCurrentProcess(), OnFlag);
<a name="l00074"></a>00074   <a class="code" href="directio_8cpp.html#a3a5bebbfbed2de85811efafee942cda0">Ke386SetIoAccessMap</a> (1,iopm);
<a name="l00075"></a>00075 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="aec7e62084419d7857ae740a4c68241cf"></a><!-- doxytag: member="directio.cpp::BOOLEAN" ref="aec7e62084419d7857ae740a4c68241cf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="directio_8cpp.html#aec7e62084419d7857ae740a4c68241cf">BOOLEAN</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="directio_8cpp_source.html#l00038">38</a> of file <a class="el" href="directio_8cpp_source.html">directio.cpp</a>.</p>

<p>Referenced by <a class="el" href="directio_8cpp_source.html#l00078">ProbePCI()</a>.</p>

</div>
</div>
<a class="anchor" id="a6b1d94bcd9123a6d01d2d28b8ec5e25e"></a><!-- doxytag: member="directio.cpp::ULONG" ref="a6b1d94bcd9123a6d01d2d28b8ec5e25e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="directio_8cpp.html#a6b1d94bcd9123a6d01d2d28b8ec5e25e">ULONG</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="directio_8cpp_source.html#l00038">38</a> of file <a class="el" href="directio_8cpp_source.html">directio.cpp</a>.</p>

<p>Referenced by <a class="el" href="directio_8cpp_source.html#l00135">DirectIO_Control()</a>, and <a class="el" href="directio_8cpp_source.html#l00078">ProbePCI()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 6 Jun 2014 for AlcapDAQ:Rootana by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
