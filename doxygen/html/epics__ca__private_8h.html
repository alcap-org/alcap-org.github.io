<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>AlcapDAQ:Rootana: slowcontrol/epics_beamline_frontend/epics_ca_private.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>slowcontrol/epics_beamline_frontend/epics_ca_private.h File Reference</h1><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="cadef_8h_source.html">cadef.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="midas_8h_source.html">midas.h</a>&quot;</code><br/>

<p><a href="epics__ca__private_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCA__SETTINGS.html">CA_SETTINGS</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCA__INFO.html">CA_INFO</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="epics__ca__private_8h.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>&nbsp;&nbsp;&nbsp;32</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="epics__ca__private_8h.html#ad04721c5bd2539cfc2e4cd3dc858bf85">CHNFLAGS_LENGTH</a>&nbsp;&nbsp;&nbsp;16</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="epics__ca__private_8h.html#ae64359068e9a0100561ba45faed6837a">DTYPE_LENGTH</a>&nbsp;&nbsp;&nbsp;40</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="epics__ca__private_8h.html#ab0272122b93a9dacfb979f1c277228d7">DSEC_LENGTH</a>&nbsp;&nbsp;&nbsp;40</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="epics__ca__private_8h.html#a08c60fdeb4c4d04e92d2af32d7527982">epics_ca</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a>,...)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="epics__ca__private_8h.html#a5bbff59bfc195ba6fcfbeb97191343dd">epics_ca_init</a> (<a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a>, void **, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="epics__ca__private_8h.html#ab517c3d9884a69d36e0761bdcbe683c8">epics_ca_exit</a> (<a class="el" href="structCA__INFO.html">CA_INFO</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="epics__ca__private_8h.html#acf64cdaca044edd1e24ef8ea5aa3d080">epics_ca_set</a> (<a class="el" href="structCA__INFO.html">CA_INFO</a> *, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>, float, <a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>, <a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="epics__ca__private_8h.html#af6b6f79619a17afc1b5866c53c389aa5">epics_ca_set_all</a> (<a class="el" href="structCA__INFO.html">CA_INFO</a> *, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>, float)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="epics__ca__private_8h.html#a53eb16584e782098780bfb4213201f0e">epics_ca_set_label</a> (<a class="el" href="structCA__INFO.html">CA_INFO</a> *, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>, char *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="epics__ca__private_8h.html#a57fb460dbfc4333b90d38db4e95199f4">epics_ca_get</a> (<a class="el" href="structCA__INFO.html">CA_INFO</a> *, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>, float *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="epics__ca__private_8h.html#a5f44ed812149fe155d201809521e014a">epics_ca_get_demand</a> (<a class="el" href="structCA__INFO.html">CA_INFO</a> *, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>, float *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="epics__ca__private_8h.html#a1de86e1c04908cfcee8ea66406f6dec0">epics_ca_get_all</a> (<a class="el" href="structCA__INFO.html">CA_INFO</a> *, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>, float *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="epics__ca__private_8h.html#af82d2378c00649c756a7502b65b0d57a">epics_ca_set_pending</a> (<a class="el" href="structCA__INFO.html">CA_INFO</a> *, <a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="epics__ca__private_8h.html#a670a395b55b713656d96c8da5d5152cd">epics_ca_get_default_name</a> (<a class="el" href="structCA__INFO.html">CA_INFO</a> *, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>, char *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="epics__ca__private_8h.html#a547abc54f80df2efece01028e4bf23d8">epics_ca_get_default_threshold</a> (<a class="el" href="structCA__INFO.html">CA_INFO</a> *, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>, float *)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ada84bade215a652f4fd8d6af2295c272"></a><!-- doxytag: member="epics_ca_private.h::CHN_NAME_LENGTH" ref="ada84bade215a652f4fd8d6af2295c272" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CHN_NAME_LENGTH&nbsp;&nbsp;&nbsp;32</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="epics__ca__private_8h_source.html#l00030">30</a> of file <a class="el" href="epics__ca__private_8h_source.html">epics_ca_private.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad04721c5bd2539cfc2e4cd3dc858bf85"></a><!-- doxytag: member="epics_ca_private.h::CHNFLAGS_LENGTH" ref="ad04721c5bd2539cfc2e4cd3dc858bf85" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CHNFLAGS_LENGTH&nbsp;&nbsp;&nbsp;16</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="epics__ca__private_8h_source.html#l00031">31</a> of file <a class="el" href="epics__ca__private_8h_source.html">epics_ca_private.h</a>.</p>

<p>Referenced by <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00453">epics_ca_connection_handler()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00567">epics_ca_event_handler()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l02384">epics_ca_get()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l02812">epics_ca_get_demand()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00777">epics_ca_init()</a>, and <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l01936">epics_ca_set()</a>.</p>

</div>
</div>
<a class="anchor" id="ab0272122b93a9dacfb979f1c277228d7"></a><!-- doxytag: member="epics_ca_private.h::DSEC_LENGTH" ref="ab0272122b93a9dacfb979f1c277228d7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DSEC_LENGTH&nbsp;&nbsp;&nbsp;40</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="epics__ca__private_8h_source.html#l00038">38</a> of file <a class="el" href="epics__ca__private_8h_source.html">epics_ca_private.h</a>.</p>

<p>Referenced by <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00777">epics_ca_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ae64359068e9a0100561ba45faed6837a"></a><!-- doxytag: member="epics_ca_private.h::DTYPE_LENGTH" ref="ae64359068e9a0100561ba45faed6837a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DTYPE_LENGTH&nbsp;&nbsp;&nbsp;40</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="epics__ca__private_8h_source.html#l00037">37</a> of file <a class="el" href="epics__ca__private_8h_source.html">epics_ca_private.h</a>.</p>

<p>Referenced by <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00567">epics_ca_event_handler()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l02384">epics_ca_get()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l02812">epics_ca_get_demand()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00777">epics_ca_init()</a>, and <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l01936">epics_ca_set()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a08c60fdeb4c4d04e92d2af32d7527982"></a><!-- doxytag: member="epics_ca_private.h::epics_ca" ref="a08c60fdeb4c4d04e92d2af32d7527982" args="(INT cmd,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> epics_ca </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00264">264</a> of file <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html">epics_ca.c</a>.</p>

<p>References <a class="el" href="ADCS_8h_source.html#l00003">channel</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="epics__ca__ori_8c_source.html#l00036">CA_INFO::cmd_disabled</a>, <a class="el" href="midas_8h_source.html#l01127">CMD_EXIT</a>, <a class="el" href="midas_8h_source.html#l01131">CMD_GET</a>, <a class="el" href="midas_8h_source.html#l01132">CMD_GET_ALL</a>, <a class="el" href="midas_8h_source.html#l01138">CMD_GET_DEFAULT_NAME</a>, <a class="el" href="midas_8h_source.html#l01139">CMD_GET_DEFAULT_THRESHOLD</a>, <a class="el" href="midas_8h_source.html#l01137">CMD_GET_DEMAND</a>, <a class="el" href="midas_8h_source.html#l01126">CMD_INIT</a>, <a class="el" href="midas_8h_source.html#l01129">CMD_SET</a>, <a class="el" href="midas_8h_source.html#l01130">CMD_SET_ALL</a>, <a class="el" href="midas_8h_source.html#l01140">CMD_SET_LABEL</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00176">epics_ca_exit()</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00242">epics_ca_get()</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00252">epics_ca_get_all()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l03099">epics_ca_get_default_name()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l03114">epics_ca_get_default_threshold()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l02812">epics_ca_get_demand()</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00098">epics_ca_init()</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00200">epics_ca_set()</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00209">epics_ca_set_all()</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00221">epics_ca_set_label()</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="midas_8h_source.html#l01087">FE_ERR_DISABLED</a>, <a class="el" href="midas_8h_source.html#l01084">FE_SUCCESS</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00076">CA_INFO::flags</a>, <a class="el" href="mevb_8cpp_source.html#l00100">hKey</a>, <a class="el" href="midas_8h_source.html#l00937">MLOG</a>, <a class="el" href="system_8c_source.html#l02491">ss_sleep()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, and <a class="el" href="ADCS_8h_source.html#l00004">value</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00265"></a>00265 {
<a name="l00266"></a>00266    va_list argptr;
<a name="l00267"></a>00267    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mevb_8cpp.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>;
<a name="l00268"></a>00268    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l00269"></a>00269    <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> flags;
<a name="l00270"></a>00270    <span class="keywordtype">float</span> <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, *pvalue;
<a name="l00271"></a>00271    <a class="code" href="structCA__INFO.html">CA_INFO</a> *info;
<a name="l00272"></a>00272    <span class="keywordtype">char</span> *label;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274    va_start(argptr, <a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a>);
<a name="l00275"></a>00275    status = <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>;
<a name="l00276"></a>00276 
<a name="l00277"></a>00277    <span class="keywordflow">if</span> (<a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a> == <a class="code" href="group__err26.html#ga2677fc43f8393bcf3bafc8bbface003f">CMD_INIT</a>) {
<a name="l00278"></a>00278       <span class="keywordtype">void</span> *pinfo;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280       hKey = va_arg(argptr, <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a>);
<a name="l00281"></a>00281       pinfo = va_arg(argptr, <span class="keywordtype">void</span> *);
<a name="l00282"></a>00282       channel = va_arg(argptr, <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>);
<a name="l00283"></a>00283       flags = va_arg(argptr, <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>);
<a name="l00284"></a>00284       status = <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#a3e90398e3f2bd3779336b00b30330164">epics_ca_init</a>(hKey, pinfo, channel);
<a name="l00285"></a>00285       info = *(<a class="code" href="structCA__INFO.html">CA_INFO</a> **) pinfo;
<a name="l00286"></a>00286       info-&gt;<a class="code" href="structCA__INFO.html#ac943fd0ba005886849273e996697564e">flags</a> = flags;
<a name="l00287"></a>00287    } <span class="keywordflow">else</span> {
<a name="l00288"></a>00288       info = va_arg(argptr, <span class="keywordtype">void</span> *);
<a name="l00289"></a>00289 
<a name="l00290"></a>00290       <span class="comment">/* only execute command if enabled */</span>
<a name="l00291"></a>00291       <span class="keywordflow">if</span> (<a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a> &amp; info-&gt;<a class="code" href="structCA__INFO.html#a3f0103827dc76e28303dd8e96f04b9e3">cmd_disabled</a>)
<a name="l00292"></a>00292          status = <a class="code" href="group__err26.html#gae7f0996583000c6c16916cdc846b753a">FE_ERR_DISABLED</a>;
<a name="l00293"></a>00293       <span class="keywordflow">else</span>
<a name="l00294"></a>00294          <span class="keywordflow">switch</span> (<a class="code" href="jorway73a_8c.html#a11d3b696651733f98e58d14ad8fa7a1d">cmd</a>) {
<a name="l00295"></a>00295          <span class="keywordflow">case</span> <a class="code" href="group__err26.html#ga2677fc43f8393bcf3bafc8bbface003f">CMD_INIT</a>:
<a name="l00296"></a>00296             <span class="keywordflow">break</span>;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298          <span class="keywordflow">case</span> <a class="code" href="group__err26.html#gacfa1d482ab47b3ceebb9717007111649">CMD_EXIT</a>:
<a name="l00299"></a>00299             status = <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#abdefe55bb7fb98f075dd4196155d7760">epics_ca_exit</a>(info);
<a name="l00300"></a>00300             <span class="keywordflow">break</span>;
<a name="l00301"></a>00301 
<a name="l00302"></a>00302          <span class="keywordflow">case</span> <a class="code" href="group__err26.html#gabb268d264836b9443ef23350814c0f68">CMD_SET</a>:
<a name="l00303"></a>00303             channel = va_arg(argptr, <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>);
<a name="l00304"></a>00304             value = (float) va_arg(argptr, <span class="keywordtype">double</span>);
<a name="l00305"></a>00305             status = <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#a6db7064a7b5ba8ceb82aed57f2bc307f">epics_ca_set</a>(info, channel, value);
<a name="l00306"></a>00306             <span class="keywordflow">break</span>;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308          <span class="keywordflow">case</span> <a class="code" href="group__err26.html#ga2dbd9bdafc041a3111a57efc43a0d6a5">CMD_SET_ALL</a>:
<a name="l00309"></a>00309             channel = va_arg(argptr, <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>);
<a name="l00310"></a>00310             value = (float) va_arg(argptr, <span class="keywordtype">double</span>);
<a name="l00311"></a>00311             status = <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ac9f4e474d0d40762929cc647f1307ad6">epics_ca_set_all</a>(info, channel, value);
<a name="l00312"></a>00312             <span class="keywordflow">break</span>;
<a name="l00313"></a>00313 
<a name="l00314"></a>00314          <span class="keywordflow">case</span> <a class="code" href="group__err26.html#gaa0706cd66be2ae6e198adc217c2ad9bf">CMD_SET_LABEL</a>:
<a name="l00315"></a>00315             channel = va_arg(argptr, <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>);
<a name="l00316"></a>00316             label = va_arg(argptr, <span class="keywordtype">char</span> *);
<a name="l00317"></a>00317             status = <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#afb48f86510f1105b18ac732af4b22b8a">epics_ca_set_label</a>(info, channel, label);
<a name="l00318"></a>00318             <span class="keywordflow">break</span>;
<a name="l00319"></a>00319 
<a name="l00320"></a>00320          <span class="keywordflow">case</span> <a class="code" href="group__err26.html#ga39f82f93564bba7925fd849ce7967a2b">CMD_GET</a>:
<a name="l00321"></a>00321             channel = va_arg(argptr, <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>);
<a name="l00322"></a>00322             pvalue = va_arg(argptr, <span class="keywordtype">float</span> *);
<a name="l00323"></a>00323             status = <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#a997b1dcbbd34eba5f9091bda9209025d">epics_ca_get</a>(info, channel, pvalue);
<a name="l00324"></a>00324             <span class="keywordflow">break</span>;
<a name="l00325"></a>00325 
<a name="l00326"></a>00326          <span class="keywordflow">case</span> <a class="code" href="group__err26.html#gaca221e20a52137998a67389609ee0f1d">CMD_GET_ALL</a>:
<a name="l00327"></a>00327             channel = va_arg(argptr, <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>);
<a name="l00328"></a>00328             pvalue = va_arg(argptr, <span class="keywordtype">float</span> *);
<a name="l00329"></a>00329             status = <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ae696280dfcd231121c0a68c97b12f911">epics_ca_get_all</a>(info, channel, pvalue);
<a name="l00330"></a>00330             <span class="keywordflow">break</span>;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332          <span class="keywordflow">default</span>:
<a name="l00333"></a>00333             <span class="keywordflow">break</span>;
<a name="l00334"></a>00334          }
<a name="l00335"></a>00335    }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337    va_end(argptr);
<a name="l00338"></a>00338 
<a name="l00339"></a>00339    <span class="keywordflow">return</span> status;
<a name="l00340"></a>00340 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab517c3d9884a69d36e0761bdcbe683c8"></a><!-- doxytag: member="epics_ca_private.h::epics_ca_exit" ref="ab517c3d9884a69d36e0761bdcbe683c8" args="(CA_INFO *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> epics_ca_exit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCA__INFO.html">CA_INFO</a> *&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00176">176</a> of file <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html">epics_ca.c</a>.</p>

<p>References <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00074">CA_INFO::array</a>, <a class="el" href="epics__ca__private_8h_source.html#l00222">CA_INFO::array_m</a>, <a class="el" href="cadef_8h.html#a91dafbf5e94f8b8e2bcbe3782404963c">ca_clear_channel()</a>, <a class="el" href="caerr_8h.html#ae80bb12bd8d4bf956c015591d3aaa52a">ca_message()</a>, <a class="el" href="cadef_8h_source.html#l00697">ca_pend_event</a>, <a class="el" href="cadef_8h_source.html#l00698">ca_pend_io</a>, <a class="el" href="cadef_8h.html#a86e286fad73ee4572c175c5624b4d952">ca_task_exit()</a>, <a class="el" href="epics__ca__private_8h_source.html#l00205">CA_SETTINGS::channel_names</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00072">CA_INFO::channel_names</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00069">CHN_NAME_LENGTH</a>, <a class="el" href="epics__ca__private_8h_source.html#l00210">CA_SETTINGS::chnflags</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="epics__ca__private_8h_source.html#l00223">CA_INFO::demand</a>, <a class="el" href="epics__ca__private_8h_source.html#l00231">CA_INFO::down</a>, <a class="el" href="epics__ca__private_8h_source.html#l00208">CA_SETTINGS::dsec</a>, <a class="el" href="epics__ca__private_8h_source.html#l00207">CA_SETTINGS::dtype</a>, <a class="el" href="caerr_8h_source.html#l00091">ECA_NORMAL</a>, <a class="el" href="midas_8h_source.html#l01084">FE_SUCCESS</a>, <a class="el" href="epics__ca__private_8h_source.html#l00232">CA_INFO::firstread</a>, <a class="el" href="epics__ca__private_8h_source.html#l00228">CA_INFO::found</a>, <a class="el" href="mlxspeaker_8c_source.html#l00061">fp</a>, <a class="el" href="epics__ca__private_8h_source.html#l00236">CA_INFO::gchan</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="epics__ca__private_8h_source.html#l00237">CA_INFO::intol</a>, <a class="el" href="epics__ca__private_8h_source.html#l00229">CA_INFO::iscmd</a>, <a class="el" href="epics__ca__private_8h_source.html#l00226">CA_INFO::lastget</a>, <a class="el" href="epics__ca__private_8h_source.html#l00225">CA_INFO::lastset</a>, <a class="el" href="epics__ca__private_8h_source.html#l00212">CA_SETTINGS::maxval</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="epics__ca__private_8h_source.html#l00211">CA_SETTINGS::minval</a>, <a class="el" href="midas_8h_source.html#l00937">MLOG</a>, <a class="el" href="epics__ca__private_8h_source.html#l00233">CA_INFO::nerr</a>, <a class="el" href="epics__ca__private_8h_source.html#l00234">CA_INFO::nmsg</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00075">CA_INFO::num_channels</a>, <a class="el" href="epics__ca__private_8h_source.html#l00220">CA_INFO::pchid</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00073">CA_INFO::pv_handles</a>, <a class="el" href="epics__ca__private_8h_source.html#l00215">CA_SETTINGS::readonly</a>, <a class="el" href="epics__ca__private_8h_source.html#l00219">CA_INFO::settings</a>, <a class="el" href="system_8c_source.html#l02332">ss_time()</a>, <a class="el" href="epics__ca__private_8h_source.html#l00227">CA_INFO::status</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="epics__ca__private_8h_source.html#l00230">CA_INFO::subscribed</a>, <a class="el" href="epics__ca__private_8h_source.html#l00224">CA_INFO::threshold</a>, <a class="el" href="epics__ca__private_8h_source.html#l00235">CA_INFO::tolchan</a>, <a class="el" href="epics__ca__private_8h_source.html#l00213">CA_SETTINGS::tolerance</a>, and <a class="el" href="epics__ca__private_8h_source.html#l00214">CA_SETTINGS::used</a>.</p>

<p>Referenced by <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00264">epics_ca()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00177"></a>00177 {
<a name="l00178"></a>00178    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l00179"></a>00179 
<a name="l00180"></a>00180    <a class="code" href="cadef_8h.html#a86e286fad73ee4572c175c5624b4d952">ca_task_exit</a>();
<a name="l00181"></a>00181 
<a name="l00182"></a>00182    <span class="keywordflow">if</span> (info-&gt;pv_handles) {
<a name="l00183"></a>00183       <span class="keywordflow">for</span> (i = 0; i &lt; info-&gt;num_channels; i++)
<a name="l00184"></a>00184          info-&gt;pv_handles[i] = calloc(1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structchannel__in__use.html">channel_in_use</a>));
<a name="l00185"></a>00185       free(info-&gt;pv_handles);
<a name="l00186"></a>00186    }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188    <span class="keywordflow">if</span> (info-&gt;array)
<a name="l00189"></a>00189       free(info-&gt;array);
<a name="l00190"></a>00190    <span class="keywordflow">if</span> (info-&gt;channel_names)
<a name="l00191"></a>00191       free(info-&gt;channel_names);
<a name="l00192"></a>00192 
<a name="l00193"></a>00193    free(info);
<a name="l00194"></a>00194 
<a name="l00195"></a>00195    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>;
<a name="l00196"></a>00196 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a57fb460dbfc4333b90d38db4e95199f4"></a><!-- doxytag: member="epics_ca_private.h::epics_ca_get" ref="a57fb460dbfc4333b90d38db4e95199f4" args="(CA_INFO *, INT, float *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> epics_ca_get </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCA__INFO.html">CA_INFO</a> *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00242">242</a> of file <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html">epics_ca.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l16313">al_reset_alarm()</a>, <a class="el" href="epics__ca__private_8h_source.html#l00201">CA_SETTINGS::AlarmWhenNOTConnected</a>, <a class="el" href="epics__ca__private_8h_source.html#l00203">CA_SETTINGS::AlarmWhenNOTinTolerance</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00074">CA_INFO::array</a>, <a class="el" href="epics__ca__private_8h_source.html#l00222">CA_INFO::array_m</a>, <a class="el" href="caerr_8h.html#ae80bb12bd8d4bf956c015591d3aaa52a">ca_message()</a>, <a class="el" href="cadef_8h_source.html#l00697">ca_pend_event</a>, <a class="el" href="cadef_8h_source.html#l00698">ca_pend_io</a>, <a class="el" href="cadef_8h_source.html#l00121">ca_read_access</a>, <a class="el" href="cadef_8h_source.html#l00132">ca_state</a>, <a class="el" href="epics__ca__private_8h_source.html#l00205">CA_SETTINGS::channel_names</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00069">CHN_NAME_LENGTH</a>, <a class="el" href="epics__ca__private_8h_source.html#l00210">CA_SETTINGS::chnflags</a>, <a class="el" href="epics__ca__private_8h_source.html#l00031">CHNFLAGS_LENGTH</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="cadef_8h_source.html#l00131">cs_conn</a>, <a class="el" href="odb_8c_source.html#l04503">db_set_data()</a>, <a class="el" href="odb_8c_source.html#l04727">db_set_data_index()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="epics__ca__private_8h_source.html#l00223">CA_INFO::demand</a>, <a class="el" href="epics__ca__private_8h_source.html#l00231">CA_INFO::down</a>, <a class="el" href="epics__ca__private_8h_source.html#l00207">CA_SETTINGS::dtype</a>, <a class="el" href="epics__ca__private_8h_source.html#l00037">DTYPE_LENGTH</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l02812">epics_ca_get_demand()</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00200">epics_ca_set()</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="midas_8h_source.html#l01084">FE_SUCCESS</a>, <a class="el" href="epics__ca__private_8h_source.html#l00228">CA_INFO::found</a>, <a class="el" href="mlxspeaker_8c_source.html#l00061">fp</a>, <a class="el" href="epics__ca__private_8h_source.html#l00236">CA_INFO::gchan</a>, <a class="el" href="epics__ca__private_8h_source.html#l00243">CA_INFO::handling_disabled</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="epics__ca__private_8h_source.html#l00246">CA_INFO::hkeyDemand</a>, <a class="el" href="epics__ca__private_8h_source.html#l00248">CA_INFO::hkeySNC</a>, <a class="el" href="epics__ca__private_8h_source.html#l00249">CA_INFO::hkeySNT</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="epics__ca__private_8h_source.html#l00237">CA_INFO::intol</a>, <a class="el" href="epics__ca__private_8h_source.html#l00229">CA_INFO::iscmd</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="epics__ca__private_8h_source.html#l00225">CA_INFO::lastset</a>, <a class="el" href="epics__ca__private_8h_source.html#l00250">CA_INFO::lastSNC</a>, <a class="el" href="epics__ca__private_8h_source.html#l00251">CA_INFO::lastSNT</a>, <a class="el" href="midas_8h_source.html#l00937">MLOG</a>, <a class="el" href="epics__ca__private_8h_source.html#l00234">CA_INFO::nmsg</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00075">CA_INFO::num_channels</a>, <a class="el" href="epics__ca__private_8h_source.html#l00220">CA_INFO::pchid</a>, <a class="el" href="epics__ca__private_8h_source.html#l00252">CA_INFO::pending</a>, <a class="el" href="epics__ca__private_8h_source.html#l00219">CA_INFO::settings</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="system_8c_source.html#l02491">ss_sleep()</a>, <a class="el" href="system_8c_source.html#l02332">ss_time()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="epics__ca__private_8h_source.html#l00202">CA_SETTINGS::Sum_NOT_Connected</a>, <a class="el" href="epics__ca__private_8h_source.html#l00204">CA_SETTINGS::Sum_NOT_in_Tolerance</a>, <a class="el" href="midas_8h_source.html#l00743">TID_FLOAT</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="epics__ca__private_8h_source.html#l00235">CA_INFO::tolchan</a>, <a class="el" href="epics__ca__private_8h_source.html#l00213">CA_SETTINGS::tolerance</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, and <a class="el" href="epics__ca__private_8h_source.html#l00214">CA_SETTINGS::used</a>.</p>

<p>Referenced by <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00264">epics_ca()</a>, and <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00252">epics_ca_get_all()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00243"></a>00243 {
<a name="l00244"></a>00244    <a class="code" href="cadef_8h.html#a05a137b370d6733ce3d41a411b8e3f59">ca_pend_event</a>(0.0001);
<a name="l00245"></a>00245    *pvalue = info-&gt;array[<a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>];
<a name="l00246"></a>00246 
<a name="l00247"></a>00247    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>;
<a name="l00248"></a>00248 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1de86e1c04908cfcee8ea66406f6dec0"></a><!-- doxytag: member="epics_ca_private.h::epics_ca_get_all" ref="a1de86e1c04908cfcee8ea66406f6dec0" args="(CA_INFO *, INT, float *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> epics_ca_get_all </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCA__INFO.html">CA_INFO</a> *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00252">252</a> of file <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html">epics_ca.c</a>.</p>

<p>References <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00242">epics_ca_get()</a>, <a class="el" href="midas_8h_source.html#l01084">FE_SUCCESS</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="Mql_8h_source.html#l00007">MIN</a>, <a class="el" href="midas_8h_source.html#l00937">MLOG</a>, and <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00075">CA_INFO::num_channels</a>.</p>

<p>Referenced by <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00264">epics_ca()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00253"></a>00253 {
<a name="l00254"></a>00254    <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Mql_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(info-&gt;num_channels, <a class="code" href="plot__max_8c.html#ad49ec371d0c77a469cc14aa6f44b232e">channels</a>); i++)
<a name="l00257"></a>00257       <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#a997b1dcbbd34eba5f9091bda9209025d">epics_ca_get</a>(info, i, pvalue + i);
<a name="l00258"></a>00258 
<a name="l00259"></a>00259    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>;
<a name="l00260"></a>00260 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a670a395b55b713656d96c8da5d5152cd"></a><!-- doxytag: member="epics_ca_private.h::epics_ca_get_default_name" ref="a670a395b55b713656d96c8da5d5152cd" args="(CA_INFO *, INT, char *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> epics_ca_get_default_name </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCA__INFO.html">CA_INFO</a> *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l03099">3099</a> of file <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html">epics_ca.c</a>.</p>

<p>References <a class="el" href="epics__ca__private_8h_source.html#l00205">CA_SETTINGS::channel_names</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00069">CHN_NAME_LENGTH</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l01084">FE_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l00937">MLOG</a>, and <a class="el" href="epics__ca__private_8h_source.html#l00219">CA_INFO::settings</a>.</p>

<p>Referenced by <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l03134">epics_ca()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03099"></a>03099                                                                       {
<a name="l03100"></a>03100 <span class="preprocessor">#ifdef MIDEBUG1</span>
<a name="l03101"></a>03101 <span class="preprocessor"></span>   <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;  ++epics_ca_get_default_name(channel %d, name %s)&quot;</span>, <a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>);
<a name="l03102"></a>03102 <span class="preprocessor">#endif</span>
<a name="l03103"></a>03103 <span class="preprocessor"></span>   <span class="keywordflow">if</span> ((<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a> != NULL) &amp;&amp; (<a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> &gt;= 0) &amp;&amp; (channel&lt; info-&gt;num_channels)) {
<a name="l03104"></a>03104      strcpy(<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>, info-&gt;settings.channel_names + <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a> * <a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l03105"></a>03105    }
<a name="l03106"></a>03106 <span class="preprocessor">#ifdef MIDEBUG1</span>
<a name="l03107"></a>03107 <span class="preprocessor"></span>   <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;  --epics_ca_get_default_name(channel %d, name %s)&quot;</span>, <a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>);
<a name="l03108"></a>03108 <span class="preprocessor">#endif</span>
<a name="l03109"></a>03109 <span class="preprocessor"></span>   <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>;
<a name="l03110"></a>03110 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a547abc54f80df2efece01028e4bf23d8"></a><!-- doxytag: member="epics_ca_private.h::epics_ca_get_default_threshold" ref="a547abc54f80df2efece01028e4bf23d8" args="(CA_INFO *, INT, float *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> epics_ca_get_default_threshold </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCA__INFO.html">CA_INFO</a> *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l03114">3114</a> of file <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html">epics_ca.c</a>.</p>

<p>References <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l01084">FE_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l00937">MLOG</a>, and <a class="el" href="epics__ca__private_8h_source.html#l00224">CA_INFO::threshold</a>.</p>

<p>Referenced by <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l03134">epics_ca()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03114"></a>03114                                                                               {
<a name="l03115"></a>03115 
<a name="l03116"></a>03116 <span class="preprocessor">#ifdef MIDEBUG1</span>
<a name="l03117"></a>03117 <span class="preprocessor"></span>   <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;  ++epics_ca_get_default_threshold(channel %d)&quot;</span>, <a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l03118"></a>03118 <span class="preprocessor">#endif</span>
<a name="l03119"></a>03119 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (pvalue != NULL) {
<a name="l03120"></a>03120      *pvalue = 0.1f;
<a name="l03121"></a>03121      <span class="keywordflow">if</span> (info-&gt;threshold &amp;&amp; (<a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> &gt;= 0) &amp;&amp; (channel &lt; info-&gt;num_channels))
<a name="l03122"></a>03122        *pvalue = *(info-&gt;threshold+<a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l03123"></a>03123    }
<a name="l03124"></a>03124 <span class="preprocessor">#ifdef MIDEBUG1</span>
<a name="l03125"></a>03125 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (pvalue)
<a name="l03126"></a>03126      <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;  --epics_ca_get_default_threshold(channel %d, threshold %f)&quot;</span>, 
<a name="l03127"></a>03127                     <a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, *pvalue);
<a name="l03128"></a>03128 <span class="preprocessor">#endif</span>
<a name="l03129"></a>03129 <span class="preprocessor"></span>   <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>;
<a name="l03130"></a>03130 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5f44ed812149fe155d201809521e014a"></a><!-- doxytag: member="epics_ca_private.h::epics_ca_get_demand" ref="a5f44ed812149fe155d201809521e014a" args="(CA_INFO *, INT, float *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> epics_ca_get_demand </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCA__INFO.html">CA_INFO</a> *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l02812">2812</a> of file <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html">epics_ca.c</a>.</p>

<p>References <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00074">CA_INFO::array</a>, <a class="el" href="epics__ca__private_8h_source.html#l00222">CA_INFO::array_m</a>, <a class="el" href="epics__ca__private_8h_source.html#l00205">CA_SETTINGS::channel_names</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00069">CHN_NAME_LENGTH</a>, <a class="el" href="epics__ca__private_8h_source.html#l00210">CA_SETTINGS::chnflags</a>, <a class="el" href="epics__ca__private_8h_source.html#l00031">CHNFLAGS_LENGTH</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="epics__ca__private_8h_source.html#l00207">CA_SETTINGS::dtype</a>, <a class="el" href="epics__ca__private_8h_source.html#l00037">DTYPE_LENGTH</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="midas_8h_source.html#l01084">FE_SUCCESS</a>, <a class="el" href="mlxspeaker_8c_source.html#l00061">fp</a>, <a class="el" href="epics__ca__private_8h_source.html#l00236">CA_INFO::gchan</a>, <a class="el" href="epics__ca__private_8h_source.html#l00229">CA_INFO::iscmd</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="midas_8h_source.html#l00937">MLOG</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00075">CA_INFO::num_channels</a>, <a class="el" href="epics__ca__private_8h_source.html#l00219">CA_INFO::settings</a>, <a class="el" href="system_8c_source.html#l02332">ss_time()</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l03134">epics_ca()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l02384">epics_ca_get()</a>, and <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00777">epics_ca_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02812"></a>02812                                                                    {
<a name="l02813"></a>02813 <span class="preprocessor">#ifdef MIDEBUGF</span>
<a name="l02814"></a>02814 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>) fprintf(<a class="code" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>,<span class="stringliteral">&quot;%u : ++epics_ca_get_demand(channel=%d(%s))\n&quot;</span>, <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>(), <a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>,
<a name="l02815"></a>02815                   info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*<a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l02816"></a>02816 <span class="preprocessor">#endif</span>
<a name="l02817"></a>02817 <span class="preprocessor"></span><span class="preprocessor">#ifdef MIDEBUG1</span>
<a name="l02818"></a>02818 <span class="preprocessor"></span>   <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;  ++epics_ca_get_demand(channel %d)&quot;</span>,<a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l02819"></a>02819 <span class="preprocessor">#endif</span>
<a name="l02820"></a>02820 <span class="preprocessor"></span>
<a name="l02821"></a>02821    <span class="keywordflow">if</span> (info) {
<a name="l02822"></a>02822      <span class="keywordflow">if</span> (channel &lt; info-&gt;num_channels) {
<a name="l02823"></a>02823 
<a name="l02824"></a>02824        <span class="comment">// channel number of dependent channel is not initialized yet</span>
<a name="l02825"></a>02825        <span class="comment">// search for channel</span>
<a name="l02826"></a>02826        <span class="keywordflow">if</span> (*(info-&gt;gchan+<a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>) == -1.f) {
<a name="l02827"></a>02827          <span class="keywordtype">char</span> tename[<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>];
<a name="l02828"></a>02828          <span class="keywordtype">int</span>  <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>;
<a name="l02829"></a>02829          <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> findrefchan;
<a name="l02830"></a>02830          <span class="keywordtype">char</span> *ds;
<a name="l02831"></a>02831          <span class="keywordtype">char</span> *tpos;
<a name="l02832"></a>02832 
<a name="l02833"></a>02833          findrefchan = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02834"></a>02834          strcpy(tename,info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*<a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l02835"></a>02835 
<a name="l02836"></a>02836          ds = info-&gt;settings.dtype+<a class="code" href="epics__ca__private_8h.html#ae64359068e9a0100561ba45faed6837a">DTYPE_LENGTH</a>*<a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>;
<a name="l02837"></a>02837 <span class="preprocessor">#ifdef MIDEBUG2</span>
<a name="l02838"></a>02838 <span class="preprocessor"></span>         <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;G-flag: search Looking for device specific handling of Device &quot;</span>
<a name="l02839"></a>02839                         <span class="stringliteral">&quot;type %s&quot;</span>, ds);
<a name="l02840"></a>02840 <span class="preprocessor">#endif</span>
<a name="l02841"></a>02841 <span class="preprocessor"></span>         <span class="keywordflow">if</span> ((strcmp(ds,<span class="stringliteral">&quot;BEND&quot;</span>)==0) || (strcmp(ds,<span class="stringliteral">&quot;QUAD&quot;</span>)==0) || 
<a name="l02842"></a>02842              (strcmp(ds,<span class="stringliteral">&quot;SEPT&quot;</span>)==0) || (strcmp(ds,<span class="stringliteral">&quot;STER&quot;</span>)==0) || 
<a name="l02843"></a>02843              (strcmp(ds,<span class="stringliteral">&quot;PS&quot;</span>  )==0) || (strcmp(ds,<span class="stringliteral">&quot;TS&quot;</span>  )==0) ||
<a name="l02844"></a>02844              (strcmp(ds,<span class="stringliteral">&quot;KICKER&quot;</span>)==0)                             ) {
<a name="l02845"></a>02845 
<a name="l02846"></a>02846 <span class="preprocessor">#ifdef MIDEBUG2</span>
<a name="l02847"></a>02847 <span class="preprocessor"></span>           <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;G-flag: Device type %s found&quot;</span>,ds);
<a name="l02848"></a>02848 <span class="preprocessor">#endif</span>
<a name="l02849"></a>02849 <span class="preprocessor"></span>           <span class="comment">// assign corresponding channel</span>
<a name="l02850"></a>02850            <span class="keywordflow">if</span> ((tpos = strstr(tename,<span class="stringliteral">&quot;:COM:2&quot;</span>)) != NULL) {
<a name="l02851"></a>02851              strcpy(tpos,<span class="stringliteral">&quot;:STA:1&quot;</span>);
<a name="l02852"></a>02852            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tpos = strstr(tename,<span class="stringliteral">&quot;:STA:1&quot;</span>)) != NULL) {
<a name="l02853"></a>02853              strcpy(tpos,<span class="stringliteral">&quot;:COM:2&quot;</span>);
<a name="l02854"></a>02854            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tpos = strstr(tename,<span class="stringliteral">&quot;:SOL:2&quot;</span>)) != NULL) {
<a name="l02855"></a>02855              findrefchan = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02856"></a>02856            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tpos = strstr(tename,<span class="stringliteral">&quot;:IST:2&quot;</span>)) != NULL) {
<a name="l02857"></a>02857              findrefchan = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02858"></a>02858            } <span class="keywordflow">else</span> {
<a name="l02859"></a>02859              <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;G-flag: search Channel %d (%s) not handled for type %s&quot;</span>, 
<a name="l02860"></a>02860                channel, info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,ds);
<a name="l02861"></a>02861              findrefchan = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02862"></a>02862            }
<a name="l02863"></a>02863 
<a name="l02864"></a>02864          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(ds,<span class="stringliteral">&quot;FENTE&quot;</span>)==0) {
<a name="l02865"></a>02865            <span class="comment">// assign corresponding channel</span>
<a name="l02866"></a>02866            <span class="keywordflow">if</span>        ((tpos = strstr(tename,<span class="stringliteral">&quot;:COM:2&quot;</span>)) != NULL) {
<a name="l02867"></a>02867              strcpy(tpos,<span class="stringliteral">&quot;:STA:1&quot;</span>);
<a name="l02868"></a>02868            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tpos = strstr(tename,<span class="stringliteral">&quot;:STA:1&quot;</span>)) != NULL) {
<a name="l02869"></a>02869              strcpy(tpos,<span class="stringliteral">&quot;:COM:2&quot;</span>);
<a name="l02870"></a>02870            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tpos = strstr(tename,<span class="stringliteral">&quot;:SOL:2&quot;</span>)) != NULL) {
<a name="l02871"></a>02871              strcpy(tpos,<span class="stringliteral">&quot;:IST1:2&quot;</span>);
<a name="l02872"></a>02872            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tpos = strstr(tename,<span class="stringliteral">&quot;:IST1:2&quot;</span>)) != NULL) {
<a name="l02873"></a>02873              strcpy(tpos,<span class="stringliteral">&quot;:SOL:2&quot;</span>);
<a name="l02874"></a>02874            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tpos = strstr(tename,<span class="stringliteral">&quot;:POSA:2&quot;</span>)) != NULL) {
<a name="l02875"></a>02875              strcpy(tpos,<span class="stringliteral">&quot;:SOL:2&quot;</span>);
<a name="l02876"></a>02876            } <span class="keywordflow">else</span> {
<a name="l02877"></a>02877              <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;G-flag: search Channel %d (%s) not handled for type %s&quot;</span>, 
<a name="l02878"></a>02878                channel, info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,ds);
<a name="l02879"></a>02879              findrefchan = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02880"></a>02880            }
<a name="l02881"></a>02881 
<a name="l02882"></a>02882          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(ds,<span class="stringliteral">&quot;BX&quot;</span>)==0) {
<a name="l02883"></a>02883            <span class="keywordflow">if</span>        ((tpos = strstr(tename,<span class="stringliteral">&quot;:COM:2&quot;</span>)) != NULL) {
<a name="l02884"></a>02884              strcpy(tpos,<span class="stringliteral">&quot;:STA:1&quot;</span>);
<a name="l02885"></a>02885            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((tpos = strstr(tename,<span class="stringliteral">&quot;:STA:1&quot;</span>)) != NULL) {
<a name="l02886"></a>02886              strcpy(tpos,<span class="stringliteral">&quot;:COM:2&quot;</span>);
<a name="l02887"></a>02887            } <span class="keywordflow">else</span> {
<a name="l02888"></a>02888              <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;G-flag: search Channel %d (%s) not handled for type %s&quot;</span>, 
<a name="l02889"></a>02889                channel, info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,ds);
<a name="l02890"></a>02890              findrefchan = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02891"></a>02891            }
<a name="l02892"></a>02892 
<a name="l02893"></a>02893          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(ds,<span class="stringliteral">&quot;HVPS&quot;</span>)==0) {
<a name="l02894"></a>02894            <span class="comment">// DO NOTHING (no G-flags)</span>
<a name="l02895"></a>02895            findrefchan = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02896"></a>02896          } <span class="keywordflow">else</span> {
<a name="l02897"></a>02897            <span class="keywordflow">if</span> (strncmp(ds,<span class="stringliteral">&quot;**&quot;</span>,2) != 0)
<a name="l02898"></a>02898              <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;G-flag: search Channel %d (%s) type %s is not handled&quot;</span>, 
<a name="l02899"></a>02899                channel, info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,ds);
<a name="l02900"></a>02900            findrefchan = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02901"></a>02901          }
<a name="l02902"></a>02902 
<a name="l02903"></a>02903          <span class="keywordflow">if</span> (findrefchan) {
<a name="l02904"></a>02904 <span class="preprocessor">#ifdef MIDEBUG1</span>
<a name="l02905"></a>02905 <span class="preprocessor"></span>           <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;G-flag: search Searching for channel %s&quot;</span>,tename);
<a name="l02906"></a>02906 <span class="preprocessor">#endif</span>
<a name="l02907"></a>02907 <span class="preprocessor"></span>           <span class="keywordflow">for</span> (j=0; j &lt; info-&gt;num_channels; j++) {
<a name="l02908"></a>02908              <span class="keywordflow">if</span> (channel != j) {
<a name="l02909"></a>02909                <span class="keywordflow">if</span> (strcmp(tename,info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*j)==0){
<a name="l02910"></a>02910                  <span class="keywordflow">if</span> (strchr(info-&gt;settings.chnflags+<a class="code" href="epics__ca__private_8h.html#ad04721c5bd2539cfc2e4cd3dc858bf85">CHNFLAGS_LENGTH</a>*channel,<span class="charliteral">&apos;G&apos;</span>) ||
<a name="l02911"></a>02911                      strchr(info-&gt;settings.chnflags+<a class="code" href="epics__ca__private_8h.html#ad04721c5bd2539cfc2e4cd3dc858bf85">CHNFLAGS_LENGTH</a>*j,<span class="charliteral">&apos;G&apos;</span>)) {
<a name="l02912"></a>02912                    *(info-&gt;gchan+channel) = j;
<a name="l02913"></a>02913                    <span class="comment">// NIY if (*(info-&gt;gchan+j) &gt; 0) warning channel was already</span>
<a name="l02914"></a>02914                    <span class="comment">//                               assigned to channel ...</span>
<a name="l02915"></a>02915                    *(info-&gt;gchan+j) = channel;
<a name="l02916"></a>02916                    <span class="keywordflow">break</span>;
<a name="l02917"></a>02917                  }
<a name="l02918"></a>02918                }
<a name="l02919"></a>02919              }
<a name="l02920"></a>02920            } <span class="comment">// for all (other) channels</span>
<a name="l02921"></a>02921 
<a name="l02922"></a>02922            <span class="keywordflow">if</span> (*(info-&gt;gchan+channel) &lt; 0) {
<a name="l02923"></a>02923              <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;G-flag: search Channel corresponding to %d (%s) NOT found!&quot;</span>,
<a name="l02924"></a>02924                         channel, info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel);
<a name="l02925"></a>02925              *(info-&gt;gchan+channel) = -2.f; <span class="comment">// mark as already processed</span>
<a name="l02926"></a>02926            } 
<a name="l02927"></a>02927          } <span class="keywordflow">else</span> {
<a name="l02928"></a>02928            *(info-&gt;gchan+channel) = -2.f; <span class="comment">// mark as already processed</span>
<a name="l02929"></a>02929          }
<a name="l02930"></a>02930        } <span class="comment">// search for corresponding channels</span>
<a name="l02931"></a>02931 
<a name="l02932"></a>02932        <span class="comment">// command/setpoint channel?</span>
<a name="l02933"></a>02933        <span class="keywordflow">if</span> (*(info-&gt;iscmd+channel)) {
<a name="l02934"></a>02934          <span class="keywordflow">if</span> (*(info-&gt;gchan+channel) &gt; 0) {
<a name="l02935"></a>02935            <span class="keywordtype">char</span> *ds;
<a name="l02936"></a>02936            <span class="keywordtype">char</span> *tpos;
<a name="l02937"></a>02937            <span class="keywordtype">int</span>  gchan;
<a name="l02938"></a>02938 
<a name="l02939"></a>02939            gchan = *(info-&gt;gchan+channel);
<a name="l02940"></a>02940            ds = info-&gt;settings.dtype+<a class="code" href="epics__ca__private_8h.html#ae64359068e9a0100561ba45faed6837a">DTYPE_LENGTH</a>*channel;
<a name="l02941"></a>02941 <span class="preprocessor">#ifdef MIDEBUG2</span>
<a name="l02942"></a>02942 <span class="preprocessor"></span>           <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;G-flag: command/setpoint channel: Looking for device &quot;</span>
<a name="l02943"></a>02943                           <span class="stringliteral">&quot;specific handling of Device type %s&quot;</span>,ds);
<a name="l02944"></a>02944 <span class="preprocessor">#endif</span>
<a name="l02945"></a>02945 <span class="preprocessor"></span>           <span class="keywordflow">if</span> ((strcmp(ds,<span class="stringliteral">&quot;BEND&quot;</span>)==0) || (strcmp(ds,<span class="stringliteral">&quot;QUAD&quot;</span>)==0) || 
<a name="l02946"></a>02946                (strcmp(ds,<span class="stringliteral">&quot;SEPT&quot;</span>)==0) || (strcmp(ds,<span class="stringliteral">&quot;STER&quot;</span>)==0) || 
<a name="l02947"></a>02947                (strcmp(ds,<span class="stringliteral">&quot;PS&quot;</span>  )==0) ||
<a name="l02948"></a>02948                (strcmp(ds,<span class="stringliteral">&quot;TS&quot;</span>  )==0) || (strcmp(ds,<span class="stringliteral">&quot;KICKER&quot;</span>)==0)) {
<a name="l02949"></a>02949 
<a name="l02950"></a>02950              <span class="comment">// update COM:2 reading STA:1 for KombiPS1 or MultiIO</span>
<a name="l02951"></a>02951              <span class="keywordflow">if</span> (strstr(info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,<span class="stringliteral">&quot;:COM:2&quot;</span>)) {
<a name="l02952"></a>02952                <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> tval;
<a name="l02953"></a>02953                tval = (int) *(info-&gt;array+gchan);
<a name="l02954"></a>02954                <span class="comment">// Status is ON : 0x0005 (&quot;Soll ON&quot; : 0x0001 and (|) &quot;Ist ON&quot; : 0x0004)</span>
<a name="l02955"></a>02955                <span class="keywordflow">if</span> ((tval &amp; 0x0005) == 0x0005) {
<a name="l02956"></a>02956                  <span class="keywordflow">if</span> (*(info-&gt;array_m+channel) != 0.f) {
<a name="l02957"></a>02957                    <span class="keywordflow">if</span> (*(info-&gt;array_m+channel) != -2.f)
<a name="l02958"></a>02958                      <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;%d(%s): Command changed to \&quot;ON\&quot;&quot;</span>, channel,
<a name="l02959"></a>02959                              info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel); 
<a name="l02960"></a>02960                    <span class="keywordflow">else</span>
<a name="l02961"></a>02961                      <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;%d(%s): Current Command is \&quot;ON\&quot;&quot;</span>, channel,
<a name="l02962"></a>02962                              info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel); 
<a name="l02963"></a>02963                    *(info-&gt;array_m+channel) = 0.f; <span class="comment">// command ON</span>
<a name="l02964"></a>02964                  }
<a name="l02965"></a>02965                } <span class="keywordflow">else</span> { <span class="comment">// everything NOT ON is OFF</span>
<a name="l02966"></a>02966                  <span class="keywordflow">if</span> (*(info-&gt;array_m+channel) != 1.f) {
<a name="l02967"></a>02967                    <span class="keywordflow">if</span> (*(info-&gt;array_m+channel) != -2.f)
<a name="l02968"></a>02968                      <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;%d(%s): Command changed to \&quot;OFF\&quot;&quot;</span>, channel,
<a name="l02969"></a>02969                              info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel); 
<a name="l02970"></a>02970                    <span class="keywordflow">else</span>
<a name="l02971"></a>02971                      <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;%d(%s): Current Command is \&quot;OFF\&quot;&quot;</span>, channel,
<a name="l02972"></a>02972                              info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel); 
<a name="l02973"></a>02973                    *(info-&gt;array_m+channel) = 1.f; <span class="comment">// command OFF</span>
<a name="l02974"></a>02974                  }
<a name="l02975"></a>02975                }
<a name="l02976"></a>02976                *(info-&gt;array_m+gchan) = *(info-&gt;array+gchan);  <span class="comment">// update :STA:1</span>
<a name="l02977"></a>02977              }
<a name="l02978"></a>02978 
<a name="l02979"></a>02979            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(ds,<span class="stringliteral">&quot;FENTE&quot;</span>)==0) {
<a name="l02980"></a>02980              <span class="keywordflow">if</span> (strstr(info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,<span class="stringliteral">&quot;:COM:2&quot;</span>)) {
<a name="l02981"></a>02981                <span class="keywordtype">int</span> cur, prev;
<a name="l02982"></a>02982                cur  = (int) *(info-&gt;array  +gchan);
<a name="l02983"></a>02983                prev = (int) *(info-&gt;array_m+gchan);
<a name="l02984"></a>02984                <span class="comment">// when status changed maybe update COM:2 with info from STA:1</span>
<a name="l02985"></a>02985                <span class="keywordflow">if</span> ((cur != prev)||(*(info-&gt;array_m+channel) == -2.f)) {
<a name="l02986"></a>02986                  <span class="comment">// not moving anymore</span>
<a name="l02987"></a>02987                  <span class="keywordflow">if</span> (((cur &amp; 0x0100) != 0x0100) &amp;&amp; ((cur &amp; 0x0200) != 0x0200)) {
<a name="l02988"></a>02988                    <span class="comment">// stopped and NOT error</span>
<a name="l02989"></a>02989                    <span class="keywordflow">if</span> ((cur &amp; 0x0004) &amp;&amp; ((cur &amp; 0x0003) != 0x0003)) {
<a name="l02990"></a>02990                      <span class="comment">// not command STOP and not MOVE_TO_SOL?</span>
<a name="l02991"></a>02991                      <span class="keywordflow">if</span> ((*(info-&gt;array_m+channel) != (float) 0x0002) &amp;&amp;
<a name="l02992"></a>02992                          (*(info-&gt;array_m+channel) != (<span class="keywordtype">float</span>) 0x0003)) {
<a name="l02993"></a>02993                        <span class="keywordflow">if</span> (*(info-&gt;array_m+channel) != -2.f)
<a name="l02994"></a>02994                          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;%d(%s): Command changed to \&quot;STOP\&quot;&quot;</span>, channel,
<a name="l02995"></a>02995                                 info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel); 
<a name="l02996"></a>02996                        <span class="keywordflow">else</span>
<a name="l02997"></a>02997                          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;%d(%s): Current Command is \&quot;STOP\&quot;&quot;</span>, channel,
<a name="l02998"></a>02998                                 info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel); 
<a name="l02999"></a>02999                        *(info-&gt;array_m+channel) = (<span class="keywordtype">float</span>) 0x0002; <span class="comment">// command STOP</span>
<a name="l03000"></a>03000                      }
<a name="l03001"></a>03001                    }
<a name="l03002"></a>03002                  }
<a name="l03003"></a>03003                } 
<a name="l03004"></a>03004                *(info-&gt;array_m+gchan) = *(info-&gt;array+gchan);     <span class="comment">// update :STA:1</span>
<a name="l03005"></a>03005              } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strstr(info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,
<a name="l03006"></a>03006                                <span class="stringliteral">&quot;:SOL:2&quot;</span>)) {
<a name="l03007"></a>03007                <span class="comment">// NIY G-flag described in epics_ca_private.h should be handled here</span>
<a name="l03008"></a>03008                <span class="comment">//</span>
<a name="l03009"></a>03009                <span class="comment">// NIY SOL:2 and IST1 or POLA and :STA:1 - &gt; maybe set SOL:2</span>
<a name="l03010"></a>03010                *(info-&gt;array_m+channel) = *(info-&gt;array+channel); <span class="comment">// update :SOL:2</span>
<a name="l03011"></a>03011                *(info-&gt;array_m+gchan) = *(info-&gt;array+gchan);     <span class="comment">// update IST1 or POLA</span>
<a name="l03012"></a>03012              }
<a name="l03013"></a>03013 
<a name="l03014"></a>03014            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(ds,<span class="stringliteral">&quot;BX&quot;</span>) == 0) {
<a name="l03015"></a>03015              <span class="comment">// update COM:2 reading STA:1 for BX</span>
<a name="l03016"></a>03016              <span class="keywordflow">if</span> (strstr(info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,<span class="stringliteral">&quot;:COM:2&quot;</span>)) {
<a name="l03017"></a>03017                <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> tval;
<a name="l03018"></a>03018                tval = (int) *(info-&gt;array+gchan);
<a name="l03019"></a>03019                <span class="comment">// Status is Open : 0x0001 or Closed : 0x0002</span>
<a name="l03020"></a>03020                <span class="keywordflow">if</span> ((tval &amp; 0x0001) == 0x0001) {
<a name="l03021"></a>03021                  <span class="keywordflow">if</span> (*(info-&gt;array_m+channel) != 0.f) {
<a name="l03022"></a>03022                    <span class="keywordflow">if</span> (*(info-&gt;array_m+channel) != -2.f)
<a name="l03023"></a>03023                      <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;%d(%s): Command changed to \&quot;OPEN\&quot;&quot;</span>, channel,
<a name="l03024"></a>03024                              info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel); 
<a name="l03025"></a>03025                    <span class="keywordflow">else</span>
<a name="l03026"></a>03026                      <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;%d(%s): Current Command is \&quot;OPEN\&quot;&quot;</span>, channel,
<a name="l03027"></a>03027                              info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel); 
<a name="l03028"></a>03028                    *(info-&gt;array_m+channel) = 0.f; <span class="comment">// command OPEN</span>
<a name="l03029"></a>03029                  } 
<a name="l03030"></a>03030                } <span class="keywordflow">else</span> { <span class="comment">// NOT OPEN -&gt; CLOSE</span>
<a name="l03031"></a>03031                  <span class="keywordflow">if</span> (*(info-&gt;array_m+channel) != 1.f) {
<a name="l03032"></a>03032                    <span class="keywordflow">if</span> (*(info-&gt;array_m+channel) != -2.f)
<a name="l03033"></a>03033                      <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;%d(%s): Command changed to \&quot;CLOSE\&quot;&quot;</span>, channel,
<a name="l03034"></a>03034                              info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel); 
<a name="l03035"></a>03035                    <span class="keywordflow">else</span>
<a name="l03036"></a>03036                      <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;%d(%s): Current Command is \&quot;CLOSE\&quot;&quot;</span>, channel,
<a name="l03037"></a>03037                              info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel); 
<a name="l03038"></a>03038                    *(info-&gt;array_m+channel) = 1.f; <span class="comment">// command CLOSE</span>
<a name="l03039"></a>03039                  } 
<a name="l03040"></a>03040                }
<a name="l03041"></a>03041                *(info-&gt;array_m+gchan) = *(info-&gt;array+gchan);  <span class="comment">// update :STA:1</span>
<a name="l03042"></a>03042              }
<a name="l03043"></a>03043            } <span class="keywordflow">else</span> {
<a name="l03044"></a>03044              <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;G-flag: command/setpoint Channel %d (%s) type %s is not han&quot;</span>
<a name="l03045"></a>03045                <span class="stringliteral">&quot;dled&quot;</span>, channel, info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,ds);
<a name="l03046"></a>03046            }
<a name="l03047"></a>03047          } <span class="keywordflow">else</span> {
<a name="l03048"></a>03048            <span class="comment">// no corresponding &quot;status&quot; channel -&gt; mirror demand readout of channel</span>
<a name="l03049"></a>03049            *(info-&gt;array_m+channel) = *(info-&gt;array+channel);
<a name="l03050"></a>03050          }
<a name="l03051"></a>03051 
<a name="l03052"></a>03052          <span class="keywordflow">if</span> (pvalue) *pvalue = *(info-&gt;array_m+channel);
<a name="l03053"></a>03053 
<a name="l03054"></a>03054        <span class="comment">// not a command channel</span>
<a name="l03055"></a>03055        } <span class="keywordflow">else</span> {
<a name="l03056"></a>03056          <span class="comment">// and no corresponding command channel -&gt; mirror readout of channel</span>
<a name="l03057"></a>03057          <span class="keywordflow">if</span> (*(info-&gt;gchan+channel) &lt; -1.f)
<a name="l03058"></a>03058            *(info-&gt;array_m+channel) = *(info-&gt;array+channel);
<a name="l03059"></a>03059          <span class="keywordflow">if</span> (pvalue) *pvalue = 0.f; <span class="comment">// NO demand value to return</span>
<a name="l03060"></a>03060        }
<a name="l03061"></a>03061      }
<a name="l03062"></a>03062    }
<a name="l03063"></a>03063 <span class="preprocessor">#ifdef MIDEBUG1</span>
<a name="l03064"></a>03064 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (pvalue)
<a name="l03065"></a>03065      <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;  --epics_ca_get_demand(value = %f)&quot;</span>,*pvalue);
<a name="l03066"></a>03066    <span class="keywordflow">else</span>
<a name="l03067"></a>03067      <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;  --epics_ca_get_demand(NULL pointer to return)&quot;</span>);
<a name="l03068"></a>03068 <span class="preprocessor">#endif</span>
<a name="l03069"></a>03069 <span class="preprocessor"></span><span class="preprocessor">#ifdef MIDEBUGF</span>
<a name="l03070"></a>03070 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>) {
<a name="l03071"></a>03071     <span class="keywordflow">if</span> (pvalue)
<a name="l03072"></a>03072       fprintf(<a class="code" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>,<span class="stringliteral">&quot;%u : --epics_ca_get_demand(channel=%d(%s), value=%f)\n&quot;</span>, <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>(),
<a name="l03073"></a>03073                  channel, info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel, *pvalue);
<a name="l03074"></a>03074     <span class="keywordflow">else</span>
<a name="l03075"></a>03075       fprintf(<a class="code" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>,<span class="stringliteral">&quot;%u : --epics_ca_get_demand(channel=%d,NULL pointer to return demand)\n&quot;</span>
<a name="l03076"></a>03076               ,<a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>(), channel);
<a name="l03077"></a>03077   }
<a name="l03078"></a>03078 <span class="preprocessor">#endif</span>
<a name="l03079"></a>03079 <span class="preprocessor"></span>   <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>;
<a name="l03080"></a>03080 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5bbff59bfc195ba6fcfbeb97191343dd"></a><!-- doxytag: member="epics_ca_private.h::epics_ca_init" ref="a5bbff59bfc195ba6fcfbeb97191343dd" args="(HNDLE, void **, INT)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> epics_ca_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00098">98</a> of file <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html">epics_ca.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l16313">al_reset_alarm()</a>, <a class="el" href="epics__ca__private_8h_source.html#l00201">CA_SETTINGS::AlarmWhenNOTConnected</a>, <a class="el" href="epics__ca__private_8h_source.html#l00203">CA_SETTINGS::AlarmWhenNOTinTolerance</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00074">CA_INFO::array</a>, <a class="el" href="epics__ca__private_8h_source.html#l00222">CA_INFO::array_m</a>, <a class="el" href="cadef_8h_source.html#l00578">ca_add_event</a>, <a class="el" href="cadef_8h.html#a5ff4c53e8f66c5080f3dc7d9acd8c651">ca_add_exception_event()</a>, <a class="el" href="cadef_8h.html#a91dafbf5e94f8b8e2bcbe3782404963c">ca_clear_channel()</a>, <a class="el" href="cadef_8h_source.html#l00492">ca_get</a>, <a class="el" href="caerr_8h_source.html#l00068">CA_M_SUCCESS</a>, <a class="el" href="caerr_8h.html#ae80bb12bd8d4bf956c015591d3aaa52a">ca_message()</a>, <a class="el" href="cadef_8h_source.html#l00697">ca_pend_event</a>, <a class="el" href="cadef_8h_source.html#l00698">ca_pend_io</a>, <a class="el" href="cadef_8h_source.html#l00305">ca_search</a>, <a class="el" href="cadef_8h_source.html#l00132">ca_state</a>, <a class="el" href="cadef_8h.html#a7b90bbc1f766b552b3483c8c14e59acb">ca_task_initialize()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00362">castatestr()</a>, <a class="el" href="epics__ca__private_8h_source.html#l00205">CA_SETTINGS::channel_names</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00072">CA_INFO::channel_names</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00069">CHN_NAME_LENGTH</a>, <a class="el" href="epics__ca__private_8h_source.html#l00210">CA_SETTINGS::chnflags</a>, <a class="el" href="epics__ca__private_8h_source.html#l00031">CHNFLAGS_LENGTH</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="epics__ca__ori_8c_source.html#l00036">CA_INFO::cmd_disabled</a>, <a class="el" href="cadef_8h_source.html#l00131">cs_conn</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l02907">db_get_path()</a>, <a class="el" href="odb_8c_source.html#l04971">db_merge_data()</a>, <a class="el" href="midas_8h_source.html#l01012">DB_NO_KEY</a>, <a class="el" href="odb_8c_source.html#l04503">db_set_data()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="caeventmask_8h_source.html#l00032">DBE_VALUE</a>, <a class="el" href="db__access_8h_source.html#l00176">DBR_CTRL_FLOAT</a>, <a class="el" href="db__access_8h_source.html#l00144">DBR_FLOAT</a>, <a class="el" href="db__access_8h_source.html#l00141">DBR_STRING</a>, <a class="el" href="epics__ca__private_8h_source.html#l00223">CA_INFO::demand</a>, <a class="el" href="epics__ca__private_8h_source.html#l00231">CA_INFO::down</a>, <a class="el" href="epics__ca__private_8h_source.html#l00208">CA_SETTINGS::dsec</a>, <a class="el" href="epics__ca__private_8h_source.html#l00038">DSEC_LENGTH</a>, <a class="el" href="epics__ca__private_8h_source.html#l00207">CA_SETTINGS::dtype</a>, <a class="el" href="epics__ca__private_8h_source.html#l00037">DTYPE_LENGTH</a>, <a class="el" href="caerr_8h_source.html#l00091">ECA_NORMAL</a>, <a class="el" href="caerr_8h_source.html#l00101">ECA_TIMEOUT</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00080">epics_ca_callback()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00453">epics_ca_connection_handler()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00567">epics_ca_event_handler()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00421">epics_ca_exception_handler()</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l02812">epics_ca_get_demand()</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="midas_8h_source.html#l01086">FE_ERR_HW</a>, <a class="el" href="midas_8h_source.html#l01084">FE_SUCCESS</a>, <a class="el" href="epics__ca__private_8h_source.html#l00232">CA_INFO::firstread</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00075">found</a>, <a class="el" href="epics__ca__private_8h_source.html#l00228">CA_INFO::found</a>, <a class="el" href="mlxspeaker_8c_source.html#l00061">fp</a>, <a class="el" href="epics__ca__private_8h_source.html#l00236">CA_INFO::gchan</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00023">GFA_SPECIFIC</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="epics__ca__private_8h_source.html#l00246">CA_INFO::hkeyDemand</a>, <a class="el" href="epics__ca__private_8h_source.html#l00248">CA_INFO::hkeySNC</a>, <a class="el" href="epics__ca__private_8h_source.html#l00249">CA_INFO::hkeySNT</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="epics__ca__private_8h_source.html#l00237">CA_INFO::intol</a>, <a class="el" href="epics__ca__private_8h_source.html#l00229">CA_INFO::iscmd</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="odbhist_8c_source.html#l00058">k</a>, <a class="el" href="epics__ca__private_8h_source.html#l00226">CA_INFO::lastget</a>, <a class="el" href="epics__ca__private_8h_source.html#l00225">CA_INFO::lastset</a>, <a class="el" href="epics__ca__private_8h_source.html#l00200">CA_SETTINGS::loadfile</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00069">mask</a>, <a class="el" href="midas_8h_source.html#l00686">MAX_ODB_PATH</a>, <a class="el" href="epics__ca__private_8h_source.html#l00212">CA_SETTINGS::maxval</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="lrs1821_8h_source.html#l00221">MINFO</a>, <a class="el" href="epics__ca__private_8h_source.html#l00211">CA_SETTINGS::minval</a>, <a class="el" href="midas_8h_source.html#l00937">MLOG</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00334">N_GFA_TYPES</a>, <a class="el" href="epics__ca__private_8h_source.html#l00245">CA_INFO::name</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00073">_GFA_type::nc</a>, <a class="el" href="epics__ca__private_8h_source.html#l00233">CA_INFO::nerr</a>, <a class="el" href="epics__ca__private_8h_source.html#l00234">CA_INFO::nmsg</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00075">CA_INFO::num_channels</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="epics__ca__private_8h_source.html#l00220">CA_INFO::pchid</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00073">CA_INFO::pv_handles</a>, <a class="el" href="epics__ca__private_8h_source.html#l00215">CA_SETTINGS::readonly</a>, <a class="el" href="epics__ca__private_8h_source.html#l00219">CA_INFO::settings</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00043">smsg</a>, <a class="el" href="system_8c_source.html#l02491">ss_sleep()</a>, <a class="el" href="system_8c_source.html#l02332">ss_time()</a>, <a class="el" href="cadef_8h_source.html#l00175">channel_in_use::state</a>, <a class="el" href="epics__ca__private_8h_source.html#l00227">CA_INFO::status</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="epics__ca__private_8h_source.html#l00241">CA_INFO::subscribe_disabled</a>, <a class="el" href="epics__ca__private_8h_source.html#l00230">CA_INFO::subscribed</a>, <a class="el" href="epics__ca__private_8h_source.html#l00202">CA_SETTINGS::Sum_NOT_Connected</a>, <a class="el" href="epics__ca__private_8h_source.html#l00204">CA_SETTINGS::Sum_NOT_in_Tolerance</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00072">_GFA_type::tc</a>, <a class="el" href="epics__ca__private_8h_source.html#l00224">CA_INFO::threshold</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, <a class="el" href="midas_8h_source.html#l00743">TID_FLOAT</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="epics__ca__private_8h_source.html#l00235">CA_INFO::tolchan</a>, <a class="el" href="epics__ca__private_8h_source.html#l00213">CA_SETTINGS::tolerance</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, <a class="el" href="mana_8cpp_source.html#l00675">type</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00070">_GFA_type::type</a>, <a class="el" href="epics__ca__private_8h_source.html#l00214">CA_SETTINGS::used</a>, and <a class="el" href="ADCS_8h_source.html#l00004">value</a>.</p>

<p>Referenced by <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00264">epics_ca()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00099"></a>00099 {
<a name="l00100"></a>00100    <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l00101"></a>00101    <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>;
<a name="l00102"></a>00102    <a class="code" href="structCA__INFO.html">CA_INFO</a> *info;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104    <span class="comment">/* allocate info structure */</span>
<a name="l00105"></a>00105    info = calloc(1, <span class="keyword">sizeof</span>(<a class="code" href="structCA__INFO.html">CA_INFO</a>));
<a name="l00106"></a>00106    *pinfo = info;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108    <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l00109"></a>00109 
<a name="l00110"></a>00110    <span class="comment">/* get channel names */</span>
<a name="l00111"></a>00111    info-&gt;<a class="code" href="structCA__INFO.html#ac9d799fd09fe9de58b75bd1b9fc53720">channel_names</a> = calloc(<a class="code" href="plot__max_8c.html#ad49ec371d0c77a469cc14aa6f44b232e">channels</a>, <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>);
<a name="l00112"></a>00112    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="plot__max_8c.html#ad49ec371d0c77a469cc14aa6f44b232e">channels</a>; i++)
<a name="l00113"></a>00113       sprintf(info-&gt;<a class="code" href="structCA__INFO.html#ac9d799fd09fe9de58b75bd1b9fc53720">channel_names</a> + <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a> * i, <span class="stringliteral">&quot;Channel%d&quot;</span>, i);
<a name="l00114"></a>00114    <a class="code" href="group__msectionh.html#ga7f9e910e062dad9ac20ab6c8bebfaab0">db_merge_data</a>(hDB, <a class="code" href="mevb_8cpp.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>, <span class="stringliteral">&quot;Channel name&quot;</span>,
<a name="l00115"></a>00115                  info-&gt;<a class="code" href="structCA__INFO.html#ac9d799fd09fe9de58b75bd1b9fc53720">channel_names</a>, <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a> * channels, channels, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117    <span class="comment">/* initialize driver */</span>
<a name="l00118"></a>00118    status = <a class="code" href="cadef_8h.html#a7b90bbc1f766b552b3483c8c14e59acb">ca_task_initialize</a>();
<a name="l00119"></a>00119    <span class="keywordflow">if</span> (!(status &amp; <a class="code" href="caerr_8h.html#a29dc20e7ebf0943a3032167789da0157">CA_M_SUCCESS</a>)) {
<a name="l00120"></a>00120       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;epics_ca_init&quot;</span>, <span class="stringliteral">&quot;unable to initialize&quot;</span>);
<a name="l00121"></a>00121       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga9fea053c26a278026fa0d7501c300c4f">FE_ERR_HW</a>;
<a name="l00122"></a>00122    }
<a name="l00123"></a>00123 
<a name="l00124"></a>00124    <span class="comment">/* allocate arrays */</span>
<a name="l00125"></a>00125    info-&gt;<a class="code" href="structCA__INFO.html#ad12a34a1004e3acb98a480073d7c3b2b">array</a> = calloc(channels, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00126"></a>00126    info-&gt;<a class="code" href="structCA__INFO.html#afc22390a336756f18daaadf701da3523">pv_handles</a> = calloc(channels, <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *));
<a name="l00127"></a>00127    <span class="keywordflow">for</span> (i = 0; i &lt; channels; i++)
<a name="l00128"></a>00128       info-&gt;<a class="code" href="structCA__INFO.html#afc22390a336756f18daaadf701da3523">pv_handles</a>[i] = calloc(1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structchannel__in__use.html">channel_in_use</a>));
<a name="l00129"></a>00129 
<a name="l00130"></a>00130    <span class="comment">/* search channels */</span>
<a name="l00131"></a>00131    info-&gt;<a class="code" href="structCA__INFO.html#a66b31c91a82a8e9eba3f56634c6b6716">num_channels</a> = channels;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133    <span class="keywordflow">for</span> (i = 0; i &lt; channels; i++) {
<a name="l00134"></a>00134       status = <a class="code" href="cadef_8h.html#a9211a285a02b6dcb798801b61cc3c8ac">ca_search</a>(info-&gt;<a class="code" href="structCA__INFO.html#ac9d799fd09fe9de58b75bd1b9fc53720">channel_names</a> + <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a> * i, &amp;info-&gt;<a class="code" href="structCA__INFO.html#afc22390a336756f18daaadf701da3523">pv_handles</a>[i]);
<a name="l00135"></a>00135       <span class="keywordflow">if</span> (!(status &amp; CA_M_SUCCESS))
<a name="l00136"></a>00136          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;epics_ca_init&quot;</span>, <span class="stringliteral">&quot;cannot find tag %s&quot;</span>,
<a name="l00137"></a>00137                 info-&gt;<a class="code" href="structCA__INFO.html#ac9d799fd09fe9de58b75bd1b9fc53720">channel_names</a> + <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a> * i);
<a name="l00138"></a>00138    }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140    <span class="keywordflow">if</span> (<a class="code" href="cadef_8h.html#a25dde53a1e5191d169db4eb7947686b7">ca_pend_io</a>(5.0) == <a class="code" href="caerr_8h.html#ae3e21082e4abb53f28d811ee8860debc">ECA_TIMEOUT</a>) {
<a name="l00141"></a>00141       <span class="keywordflow">for</span> (i = 0; i &lt; channels; i++)
<a name="l00142"></a>00142          <span class="keywordflow">if</span> (info-&gt;<a class="code" href="structCA__INFO.html#afc22390a336756f18daaadf701da3523">pv_handles</a>[i]-&gt;<a class="code" href="structchannel__in__use.html#a75e2e96811b71774986756f21a3a1b52">state</a> != 2)
<a name="l00143"></a>00143             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;epics_ca_init&quot;</span>, <span class="stringliteral">&quot;cannot connect to %s&quot;</span>,
<a name="l00144"></a>00144                    info-&gt;<a class="code" href="structCA__INFO.html#ac9d799fd09fe9de58b75bd1b9fc53720">channel_names</a> + <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a> * i);
<a name="l00145"></a>00145    }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147    <span class="comment">/* add change notifications */</span>
<a name="l00148"></a>00148    <span class="keywordflow">for</span> (i = 0; i &lt; channels; i++) {
<a name="l00149"></a>00149       <span class="comment">/* ignore unconnected channels */</span>
<a name="l00150"></a>00150       <span class="keywordflow">if</span> (info-&gt;<a class="code" href="structCA__INFO.html#afc22390a336756f18daaadf701da3523">pv_handles</a>[i]-&gt;<a class="code" href="structchannel__in__use.html#a75e2e96811b71774986756f21a3a1b52">state</a> != 2)
<a name="l00151"></a>00151          <span class="keywordflow">continue</span>;
<a name="l00152"></a>00152 
<a name="l00153"></a>00153       status = <a class="code" href="cadef_8h.html#af7687bac60a9917dda2f18fe91f514ae">ca_add_event</a>(<a class="code" href="db__access_8h.html#a1863ad4a27d5b02ab4b549d0424b035a">DBR_FLOAT</a>, info-&gt;<a class="code" href="structCA__INFO.html#afc22390a336756f18daaadf701da3523">pv_handles</a>[i], <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#a408d9fa4f2e99214c4ddd1002c3dc742">epics_ca_callback</a>,
<a name="l00154"></a>00154                             info, NULL);
<a name="l00155"></a>00155 
<a name="l00156"></a>00156       <span class="keywordflow">if</span> (!(status &amp; CA_M_SUCCESS))
<a name="l00157"></a>00157          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;epics_ca_init&quot;</span>, <span class="stringliteral">&quot;cannot add event to channel %s&quot;</span>,
<a name="l00158"></a>00158                 info-&gt;<a class="code" href="structCA__INFO.html#ac9d799fd09fe9de58b75bd1b9fc53720">channel_names</a> + <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a> * i);
<a name="l00159"></a>00159    }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161    <span class="keywordflow">if</span> (<a class="code" href="cadef_8h.html#a25dde53a1e5191d169db4eb7947686b7">ca_pend_io</a>(5.0) == <a class="code" href="caerr_8h.html#ae3e21082e4abb53f28d811ee8860debc">ECA_TIMEOUT</a>) {
<a name="l00162"></a>00162       <span class="keywordflow">for</span> (i = 0; i &lt; channels; i++)
<a name="l00163"></a>00163          <span class="keywordflow">if</span> (info-&gt;<a class="code" href="structCA__INFO.html#afc22390a336756f18daaadf701da3523">pv_handles</a>[i]-&gt;<a class="code" href="structchannel__in__use.html#a75e2e96811b71774986756f21a3a1b52">state</a> != 2)
<a name="l00164"></a>00164             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;epics_ca_init&quot;</span>, <span class="stringliteral">&quot;cannot add event to channel %s&quot;</span>,
<a name="l00165"></a>00165                    info-&gt;<a class="code" href="structCA__INFO.html#ac9d799fd09fe9de58b75bd1b9fc53720">channel_names</a> + <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a> * i);
<a name="l00166"></a>00166    }
<a name="l00167"></a>00167 
<a name="l00168"></a>00168    <span class="comment">/* enable all commands by default */</span>
<a name="l00169"></a>00169    info-&gt;<a class="code" href="structCA__INFO.html#a3f0103827dc76e28303dd8e96f04b9e3">cmd_disabled</a> = 0;
<a name="l00170"></a>00170 
<a name="l00171"></a>00171    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>;
<a name="l00172"></a>00172 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acf64cdaca044edd1e24ef8ea5aa3d080"></a><!-- doxytag: member="epics_ca_private.h::epics_ca_set" ref="acf64cdaca044edd1e24ef8ea5aa3d080" args="(CA_INFO *, INT, float, BOOL, BOOL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> epics_ca_set </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCA__INFO.html">CA_INFO</a> *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l01936">1936</a> of file <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html">epics_ca.c</a>.</p>

<p>References <a class="el" href="epics__ca__private_8h_source.html#l00222">CA_INFO::array_m</a>, <a class="el" href="caerr_8h.html#ae80bb12bd8d4bf956c015591d3aaa52a">ca_message()</a>, <a class="el" href="cadef_8h_source.html#l00698">ca_pend_io</a>, <a class="el" href="cadef_8h_source.html#l00422">ca_put</a>, <a class="el" href="cadef_8h_source.html#l00132">ca_state</a>, <a class="el" href="cadef_8h_source.html#l00122">ca_write_access</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00362">castatestr()</a>, <a class="el" href="epics__ca__private_8h_source.html#l00205">CA_SETTINGS::channel_names</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00069">CHN_NAME_LENGTH</a>, <a class="el" href="epics__ca__private_8h_source.html#l00210">CA_SETTINGS::chnflags</a>, <a class="el" href="epics__ca__private_8h_source.html#l00031">CHNFLAGS_LENGTH</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="cadef_8h_source.html#l00131">cs_conn</a>, <a class="el" href="odb_8c_source.html#l04727">db_set_data_index()</a>, <a class="el" href="midas_8h_source.html#l01001">DB_SUCCESS</a>, <a class="el" href="db__access_8h_source.html#l00144">DBR_FLOAT</a>, <a class="el" href="epics__ca__private_8h_source.html#l00223">CA_INFO::demand</a>, <a class="el" href="epics__ca__private_8h_source.html#l00207">CA_SETTINGS::dtype</a>, <a class="el" href="epics__ca__private_8h_source.html#l00037">DTYPE_LENGTH</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00200">epics_ca_set()</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="midas_8h_source.html#l01084">FE_SUCCESS</a>, <a class="el" href="epics__ca__private_8h_source.html#l00228">CA_INFO::found</a>, <a class="el" href="mlxspeaker_8c_source.html#l00061">fp</a>, <a class="el" href="epics__ca__private_8h_source.html#l00243">CA_INFO::handling_disabled</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="epics__ca__private_8h_source.html#l00246">CA_INFO::hkeyDemand</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="epics__ca__private_8h_source.html#l00229">CA_INFO::iscmd</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="odbhist_8c_source.html#l00058">k</a>, <a class="el" href="epics__ca__private_8h_source.html#l00225">CA_INFO::lastset</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00069">mask</a>, <a class="el" href="epics__ca__private_8h_source.html#l00212">CA_SETTINGS::maxval</a>, <a class="el" href="epics__ca__private_8h_source.html#l00211">CA_SETTINGS::minval</a>, <a class="el" href="midas_8h_source.html#l00937">MLOG</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00334">N_GFA_TYPES</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00073">_GFA_type::nc</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00075">CA_INFO::num_channels</a>, <a class="el" href="epics__ca__private_8h_source.html#l00220">CA_INFO::pchid</a>, <a class="el" href="epics__ca__private_8h_source.html#l00215">CA_SETTINGS::readonly</a>, <a class="el" href="epics__ca__private_8h_source.html#l00219">CA_INFO::settings</a>, <a class="el" href="system_8c_source.html#l02332">ss_time()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00072">_GFA_type::tc</a>, <a class="el" href="midas_8h_source.html#l00743">TID_FLOAT</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, <a class="el" href="mana_8cpp_source.html#l00675">type</a>, and <a class="el" href="epics__ca__private_8h_source.html#l00214">CA_SETTINGS::used</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01936"></a>01936                                                                                         {
<a name="l01937"></a>01937 <span class="preprocessor">#ifdef MIDEBUGF</span>
<a name="l01938"></a>01938 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>) fprintf(<a class="code" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>,<span class="stringliteral">&quot;%u : ++epics_ca_set(channel=%d(%s), value=%f, flush=%d, force_upd&quot;</span>
<a name="l01939"></a>01939                   <span class="stringliteral">&quot;=%d)\n&quot;</span>, <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>(), <a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, 
<a name="l01940"></a>01940                   info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*<a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, 
<a name="l01941"></a>01941                   <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <a class="code" href="embedded_2mscb_8h.html#a0a9e9396972b76c5947592479860020d">flush</a>, forced_update);
<a name="l01942"></a>01942 <span class="preprocessor">#endif</span>
<a name="l01943"></a>01943 <span class="preprocessor"></span><span class="preprocessor">#ifdef MIDEBUG1</span>
<a name="l01944"></a>01944 <span class="preprocessor"></span>  <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;  ++epics_ca_set(channel=%d, value=%f, flush=%d,force_upd=%d)&quot;</span>,
<a name="l01945"></a>01945                  <a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>,<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>,<a class="code" href="embedded_2mscb_8h.html#a0a9e9396972b76c5947592479860020d">flush</a>,forced_update);
<a name="l01946"></a>01946 <span class="preprocessor">#endif</span>
<a name="l01947"></a>01947 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (info) {
<a name="l01948"></a>01948      <span class="keywordflow">if</span> (channel &lt; info-&gt;num_channels) {
<a name="l01949"></a>01949        <span class="keywordflow">if</span> (strchr(info-&gt;settings.chnflags+<a class="code" href="epics__ca__private_8h.html#ad04721c5bd2539cfc2e4cd3dc858bf85">CHNFLAGS_LENGTH</a>*<a class="code" href="ADCS_8h.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>,<span class="charliteral">&apos;U&apos;</span>) == NULL) {
<a name="l01950"></a>01950          <span class="keywordflow">if</span> (strchr(info-&gt;settings.chnflags+<a class="code" href="epics__ca__private_8h.html#ad04721c5bd2539cfc2e4cd3dc858bf85">CHNFLAGS_LENGTH</a>*channel,<span class="charliteral">&apos;S&apos;</span>) == NULL) {
<a name="l01951"></a>01951            <span class="keywordflow">if</span> (strchr(info-&gt;settings.chnflags+<a class="code" href="epics__ca__private_8h.html#ad04721c5bd2539cfc2e4cd3dc858bf85">CHNFLAGS_LENGTH</a>*channel,<span class="charliteral">&apos;M&apos;</span>) != NULL) {
<a name="l01952"></a>01952              <span class="keywordflow">if</span> ((*(info-&gt;settings.minval+channel) != 0.f) ||
<a name="l01953"></a>01953                  (*(info-&gt;settings.maxval+channel) != 0.f)) {
<a name="l01954"></a>01954                <span class="keywordflow">if</span> (*(info-&gt;found+channel) &amp;&amp; *(info-&gt;settings.used+channel) &amp;&amp;
<a name="l01955"></a>01955                    !*(info-&gt;settings.readonly+channel) &amp;&amp; *(info-&gt;iscmd+channel)) {
<a name="l01956"></a>01956                  <span class="keywordflow">if</span> (<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> &lt; *(info-&gt;settings.minval+channel)) {
<a name="l01957"></a>01957                    <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Channel %d (%s): New demand value (%f) lower than &quot;</span>
<a name="l01958"></a>01958                                   <span class="stringliteral">&quot;min value (%f)! - Setting min value&quot;</span>, channel,
<a name="l01959"></a>01959                                   info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,
<a name="l01960"></a>01960                                   <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, *(info-&gt;settings.minval+channel));
<a name="l01961"></a>01961                    <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> = *(info-&gt;settings.minval+channel);
<a name="l01962"></a>01962                    <span class="comment">// NOTE: demand in ODB is not (re)set!</span>
<a name="l01963"></a>01963                  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> &gt; *(info-&gt;settings.maxval+channel)) {
<a name="l01964"></a>01964                    <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Channel %d (%s): New demand value (%f) larger than &quot;</span>
<a name="l01965"></a>01965                                   <span class="stringliteral">&quot;max value (%f)! - Setting max value&quot;</span>, channel,
<a name="l01966"></a>01966                                   info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,
<a name="l01967"></a>01967                                   <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, *(info-&gt;settings.maxval+channel));
<a name="l01968"></a>01968                    <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> = *(info-&gt;settings.maxval+channel);
<a name="l01969"></a>01969                    <span class="comment">// NOTE: demand in ODB is not (re)set!</span>
<a name="l01970"></a>01970                  }
<a name="l01971"></a>01971                }
<a name="l01972"></a>01972              }
<a name="l01973"></a>01973            }
<a name="l01974"></a>01974          }
<a name="l01975"></a>01975        }
<a name="l01976"></a>01976 
<a name="l01977"></a>01977        <span class="keywordflow">if</span> ((<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> != *(info-&gt;demand+channel))||forced_update) {
<a name="l01978"></a>01978          <span class="keywordflow">if</span> (*(info-&gt;found+channel) &amp;&amp; *(info-&gt;settings.used+channel) &amp;&amp;
<a name="l01979"></a>01979             !*(info-&gt;settings.readonly+channel) &amp;&amp; *(info-&gt;iscmd+channel)) {
<a name="l01980"></a>01980            <span class="keyword">enum</span> <a class="code" href="cadef_8h.html#a9b0449541fc31d44d6e9731ab82d5eb3">channel_state</a> castate;
<a name="l01981"></a>01981            <span class="keywordflow">if</span> ((castate=<a class="code" href="cadef_8h.html#a521d6067080e16529c52d8d1f524000b">ca_state</a>(*(info-&gt;pchid+channel)))== <a class="code" href="cadef_8h.html#a9b0449541fc31d44d6e9731ab82d5eb3a03c3c6113618f13aa988d7f09dc3c12e">cs_conn</a>) {
<a name="l01982"></a>01982              <span class="keywordflow">if</span> (<a class="code" href="cadef_8h.html#a2122df461fd91f50b1bcc958d3b2a4fb">ca_write_access</a>(*(info-&gt;pchid+channel))) {
<a name="l01983"></a>01983                <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l01984"></a>01984 
<a name="l01985"></a>01985 <span class="preprocessor">#ifdef GFA_SPECIFIC</span>
<a name="l01986"></a>01986 <span class="preprocessor"></span>               {
<a name="l01987"></a>01987                  <span class="keywordtype">char</span> *tpos;
<a name="l01988"></a>01988 
<a name="l01989"></a>01989                  <span class="comment">// channel has &lt;device&gt;:&lt;spec&gt;</span>
<a name="l01990"></a>01990                  <span class="keywordflow">if</span> ((tpos=strchr(info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,
<a name="l01991"></a>01991                                   <span class="charliteral">&apos;:&apos;</span>)) != NULL) {
<a name="l01992"></a>01992                    <span class="keywordtype">int</span> <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>;
<a name="l01993"></a>01993 
<a name="l01994"></a>01994                    <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c.html#ae2b8999b3e9983529edf418e9b0667d6">N_GFA_TYPES</a>; j++) {
<a name="l01995"></a>01995                      <span class="comment">// find type</span>
<a name="l01996"></a>01996                     <span class="keywordflow">if</span> (strcmp(<a class="code" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c.html#a62860a96744c55ca76576ebd5105f898">gfatype</a>[j].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>,info-&gt;settings.dtype+<a class="code" href="epics__ca__private_8h.html#ae64359068e9a0100561ba45faed6837a">DTYPE_LENGTH</a>*channel)
<a name="l01997"></a>01997                        ==0){
<a name="l01998"></a>01998                        <a class="code" href="struct__GFA__channel.html">GFA_channel</a> *tc;
<a name="l01999"></a>01999                        <span class="keywordtype">int</span> <a class="code" href="odbhist_8c.html#a43fa990200c3ddd47c35f151bd4d66bf">k</a>;
<a name="l02000"></a>02000 <span class="preprocessor">#ifdef MIDEBUGE</span>
<a name="l02001"></a>02001 <span class="preprocessor"></span>                       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Found type %s&quot;</span>, <a class="code" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c.html#a62860a96744c55ca76576ebd5105f898">gfatype</a>[j].type);
<a name="l02002"></a>02002 <span class="preprocessor">#endif</span>
<a name="l02003"></a>02003 <span class="preprocessor"></span>                       tc = <a class="code" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c.html#a62860a96744c55ca76576ebd5105f898">gfatype</a>[j].<a class="code" href="struct__GFA__type.html#a5d06503b3710d510accec90d4f67c2eb">tc</a>;
<a name="l02004"></a>02004                        <span class="keywordflow">for</span> (k=0; k &lt; <a class="code" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c.html#a62860a96744c55ca76576ebd5105f898">gfatype</a>[j].<a class="code" href="struct__GFA__type.html#a5627926dee2063f03c1d2b8668b63637">nc</a>; k++) {  <span class="comment">// channels of this type</span>
<a name="l02005"></a>02005 
<a name="l02006"></a>02006                          <span class="keywordflow">if</span> (!(tc+k)) <span class="keywordflow">continue</span>;
<a name="l02007"></a>02007 
<a name="l02008"></a>02008                          <span class="keywordflow">if</span> (strcmp(tpos,(tc+k)-&gt;spec ) == 0) { <span class="comment">// matching :&lt;spec&gt;</span>
<a name="l02009"></a>02009                            <span class="keywordtype">int</span> l;
<a name="l02010"></a>02010                            <a class="code" href="struct__GFA__mask.html">GFA_mask</a> *cm;
<a name="l02011"></a>02011 <span class="preprocessor">#ifdef MIDEBUGE</span>
<a name="l02012"></a>02012 <span class="preprocessor"></span>                           <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Found spec %s NS=%d&quot;</span>,(tc+k)-&gt;spec,(tc+k)-&gt;ns);
<a name="l02013"></a>02013 <span class="preprocessor">#endif</span>
<a name="l02014"></a>02014 <span class="preprocessor"></span>                           cm = (tc+k)-&gt;cm;
<a name="l02015"></a>02015                            <span class="keywordflow">for</span> (l = 0; l &lt; (tc+k)-&gt;ns; l++) { <span class="comment">// for all masks</span>
<a name="l02016"></a>02016                              <span class="keywordtype">int</span> m;
<a name="l02017"></a>02017                              <span class="keywordtype">int</span> ttval, tdem;
<a name="l02018"></a>02018                              <a class="code" href="struct__GFA__msg.html">GFA_msg</a>  *sm;
<a name="l02019"></a>02019 
<a name="l02020"></a>02020                              <span class="keywordflow">if</span> (!(cm+l)) <span class="keywordflow">continue</span>;
<a name="l02021"></a>02021 <span class="preprocessor">#ifdef MIDEBUGE</span>
<a name="l02022"></a>02022 <span class="preprocessor"></span>                             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Checking Mask 0x%4.4X&quot;</span>,(cm+l)-&gt;<a class="code" href="examples_2macro_2midas__macro_8h.html#aa27501f113ff6d3171689e27cebfcf47">mask</a>);
<a name="l02023"></a>02023 <span class="preprocessor">#endif</span>
<a name="l02024"></a>02024 <span class="preprocessor"></span>                             ttval = (int)<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> &amp; (cm+l)-&gt;mask; 
<a name="l02025"></a>02025                              tdem  = (int) *(info-&gt;demand+channel) &amp; (cm+l)-&gt;<a class="code" href="examples_2macro_2midas__macro_8h.html#aa27501f113ff6d3171689e27cebfcf47">mask</a>;
<a name="l02026"></a>02026                              <span class="keywordflow">if</span> (*(info-&gt;demand+channel) == -2.f) tdem = 0; <span class="comment">// hide setup</span>
<a name="l02027"></a>02027                              <span class="keywordflow">if</span> (( ttval != tdem)||(*(info-&gt;demand+channel) == -2.f)) {
<a name="l02028"></a>02028                                <span class="keywordtype">char</span> *tpost,*tposa;
<a name="l02029"></a>02029                                tpost = tposa = NULL;
<a name="l02030"></a>02030 
<a name="l02031"></a>02031                                sm = (cm+l)-&gt;sm;
<a name="l02032"></a>02032                                <span class="keywordflow">for</span> (m = 0; m &lt; (cm+l)-&gt;nm; m++) {
<a name="l02033"></a>02033                                  <span class="keywordflow">if</span> (!(sm+m)) <span class="keywordflow">continue</span>;
<a name="l02034"></a>02034                            <span class="comment">//    cm_msg(MLOG,&quot;&quot;,&quot;check Value 0x%4.4X : \&quot;%s\&quot;&quot;,</span>
<a name="l02035"></a>02035                            <span class="comment">//                   (sm+m)-&gt;value, (sm+m)-&gt;msg);</span>
<a name="l02036"></a>02036                                  <span class="keywordflow">if</span> ((sm+m)-&gt;value == ttval) {
<a name="l02037"></a>02037                                    <span class="keywordflow">if</span> (tpost) <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;New value: %s overwritten&quot;</span>
<a name="l02038"></a>02038                                                 <span class="stringliteral">&quot; by %s&quot;</span>, tpost, (sm+m)-&gt;msg);
<a name="l02039"></a>02039                                    tpost = (sm+m)-&gt;msg;
<a name="l02040"></a>02040                                  }
<a name="l02041"></a>02041                                  <span class="keywordflow">if</span> ((sm+m)-&gt;value == tdem)  {
<a name="l02042"></a>02042                                    <span class="keywordflow">if</span> (tposa) <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Prev value: %s overwritten&quot;</span>
<a name="l02043"></a>02043                                                 <span class="stringliteral">&quot; by %s&quot;</span>, tposa, (sm+m)-&gt;msg);
<a name="l02044"></a>02044                                    tposa = (sm+m)-&gt;msg;
<a name="l02045"></a>02045                                  }
<a name="l02046"></a>02046                                } <span class="comment">// for all values</span>
<a name="l02047"></a>02047 
<a name="l02048"></a>02048                                <span class="keywordflow">if</span> (tpost) {
<a name="l02049"></a>02049                                  <span class="keywordflow">if</span> (*(info-&gt;demand+channel) == -2.f) tposa = NULL;<span class="comment">//hide</span>
<a name="l02050"></a>02050                                  <span class="keywordflow">if</span> (tposa) {
<a name="l02051"></a>02051                                    <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;%s: \&quot;%s\&quot; changed to \&quot;%s\&quot;&quot;</span>,
<a name="l02052"></a>02052                                     info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,
<a name="l02053"></a>02053                                      tposa, tpost);
<a name="l02054"></a>02054                                  } <span class="keywordflow">else</span> {
<a name="l02055"></a>02055                                    <span class="keywordflow">if</span> (strstr(info-&gt;settings.channel_names+
<a name="l02056"></a>02056                                                      <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,<span class="stringliteral">&quot;:COM:&quot;</span>)) {
<a name="l02057"></a>02057 
<a name="l02058"></a>02058                                      <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;%s: Command is \&quot;%s\&quot;&quot;</span>,
<a name="l02059"></a>02059                                    info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,
<a name="l02060"></a>02060                                        tpost);
<a name="l02061"></a>02061                                    } <span class="keywordflow">else</span> {
<a name="l02062"></a>02062                                      <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;%s: \&quot;%s\&quot; is currently set&quot;</span>,
<a name="l02063"></a>02063                                     info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,
<a name="l02064"></a>02064                                        tpost);
<a name="l02065"></a>02065                                    }
<a name="l02066"></a>02066                                  }
<a name="l02067"></a>02067                                <span class="comment">// nothing assigned to mask</span>
<a name="l02068"></a>02068                                } <span class="keywordflow">else</span> {
<a name="l02069"></a>02069                                  <span class="keywordflow">if</span> (*(info-&gt;demand+channel) != -2.f)
<a name="l02070"></a>02070                                    <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Channel %d(%s) %f set to %f&quot;</span>,channel, 
<a name="l02071"></a>02071                                     info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,
<a name="l02072"></a>02072                                           *(info-&gt;demand+channel),<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l02073"></a>02073                                  <span class="keywordflow">else</span>
<a name="l02074"></a>02074                                    <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Channel %d(%s) set to %f&quot;</span>, channel, 
<a name="l02075"></a>02075                                     info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,
<a name="l02076"></a>02076                                           <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l02077"></a>02077                                }
<a name="l02078"></a>02078                              }
<a name="l02079"></a>02079                            } <span class="comment">// for all masks</span>
<a name="l02080"></a>02080                            <span class="keywordflow">if</span> ((tc+k)-&gt;ns &lt;= 0) {
<a name="l02081"></a>02081                              <span class="keywordflow">if</span> (*(info-&gt;demand+channel) != -2.f)
<a name="l02082"></a>02082                                <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Channel %d(%s) %f set to %f&quot;</span>,channel, 
<a name="l02083"></a>02083                                   info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,
<a name="l02084"></a>02084                                       *(info-&gt;demand+channel),<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l02085"></a>02085                              <span class="keywordflow">else</span>
<a name="l02086"></a>02086                                <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Channel %d(%s) set to %f&quot;</span>, channel, 
<a name="l02087"></a>02087                                   info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,
<a name="l02088"></a>02088                                       <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l02089"></a>02089                            }
<a name="l02090"></a>02090                            <span class="keywordflow">break</span>;
<a name="l02091"></a>02091                          }
<a name="l02092"></a>02092                        } <span class="comment">// for all channels of this type</span>
<a name="l02093"></a>02093                        <span class="keywordflow">if</span> (<a class="code" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c.html#a62860a96744c55ca76576ebd5105f898">gfatype</a>[j].nc &lt;= 0) {
<a name="l02094"></a>02094                          <span class="keywordflow">if</span> (*(info-&gt;demand+channel) != -2.f)
<a name="l02095"></a>02095                            <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Channel %d(%s) %f set to %f&quot;</span>,channel, 
<a name="l02096"></a>02096                                   info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,
<a name="l02097"></a>02097                                   *(info-&gt;demand+channel),<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l02098"></a>02098                          <span class="keywordflow">else</span>
<a name="l02099"></a>02099                            <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Channel %d(%s) set to %f&quot;</span>, channel, 
<a name="l02100"></a>02100                                   info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,
<a name="l02101"></a>02101                                   <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l02102"></a>02102                        }
<a name="l02103"></a>02103                        <span class="keywordflow">break</span>;
<a name="l02104"></a>02104                      } 
<a name="l02105"></a>02105                    } <span class="comment">// for all GFA types</span>
<a name="l02106"></a>02106                  }
<a name="l02107"></a>02107                }
<a name="l02108"></a>02108 <span class="preprocessor">#else</span>
<a name="l02109"></a>02109 <span class="preprocessor"></span>               <span class="keywordflow">if</span> (*(info-&gt;demand+channel) != -2.f)
<a name="l02110"></a>02110                  <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Channel %d(%s) %f set to %f&quot;</span>,channel, 
<a name="l02111"></a>02111                         info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,
<a name="l02112"></a>02112                         *(info-&gt;demand+channel),<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l02113"></a>02113                <span class="keywordflow">else</span>
<a name="l02114"></a>02114                  <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Channel %d(%s) set to %f&quot;</span>, channel, 
<a name="l02115"></a>02115                         info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,
<a name="l02116"></a>02116                         <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l02117"></a>02117 <span class="preprocessor">#endif</span>
<a name="l02118"></a>02118 <span class="preprocessor"></span>
<a name="l02119"></a>02119                <span class="comment">// no :COM:2 readout therefore simulate readout of :COM:2 channel</span>
<a name="l02120"></a>02120                <span class="keywordflow">if</span> (strstr(info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel,<span class="stringliteral">&quot;:COM:2&quot;</span>))
<a name="l02121"></a>02121                  *(info-&gt;array_m+channel) = <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;
<a name="l02122"></a>02122 
<a name="l02123"></a>02123                <a class="code" href="cadef_8h.html#a3c5bfc00b00a193db6cc0c060d5d959f">ca_put</a>(<a class="code" href="db__access_8h.html#a1863ad4a27d5b02ab4b549d0424b035a">DBR_FLOAT</a>, info-&gt;pchid[channel], &amp;<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l02124"></a>02124 <span class="preprocessor">#ifdef GFA_SPECIFIC</span>
<a name="l02125"></a>02125 <span class="preprocessor"></span>               <span class="comment">// GFA specific handling : maybe post pending command</span>
<a name="l02126"></a>02126                <span class="keywordflow">if</span> (!info-&gt;handling_disabled) {
<a name="l02127"></a>02127                  <span class="keywordtype">char</span> *ds;
<a name="l02128"></a>02128 
<a name="l02129"></a>02129                  <span class="comment">//   disable GFA specific handling</span>
<a name="l02130"></a>02130                  info-&gt;handling_disabled = <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02131"></a>02131 
<a name="l02132"></a>02132                  <span class="comment">// type and channel specific changes of other channel(s)</span>
<a name="l02133"></a>02133                  <span class="comment">// when specific flags of this channel set and apply rule to new value</span>
<a name="l02134"></a>02134                  <span class="comment">//  e.g. Z flag : Turn power off when new value is zero  </span>
<a name="l02135"></a>02135                  ds = info-&gt;settings.dtype+<a class="code" href="epics__ca__private_8h.html#ae64359068e9a0100561ba45faed6837a">DTYPE_LENGTH</a>*channel;
<a name="l02136"></a>02136 <span class="preprocessor">#ifdef MIDEBUG2</span>
<a name="l02137"></a>02137 <span class="preprocessor"></span>                 <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Looking for device specific handling of Device type %s&quot;</span>,ds);
<a name="l02138"></a>02138 <span class="preprocessor">#endif</span>
<a name="l02139"></a>02139 <span class="preprocessor"></span>                 <span class="keywordflow">if</span> ((strcmp(ds,<span class="stringliteral">&quot;BEND&quot;</span>)==0) || (strcmp(ds,<span class="stringliteral">&quot;QUAD&quot;</span>)==0) || 
<a name="l02140"></a>02140                      (strcmp(ds,<span class="stringliteral">&quot;SEPT&quot;</span>)==0) || (strcmp(ds,<span class="stringliteral">&quot;STER&quot;</span>)==0) ||
<a name="l02141"></a>02141                      (strcmp(ds,<span class="stringliteral">&quot;PS&quot;</span>  )==0) || 
<a name="l02142"></a>02142                      (strcmp(ds,<span class="stringliteral">&quot;TS&quot;</span>  )==0) || (strcmp(ds,<span class="stringliteral">&quot;KICKER&quot;</span>)==0)) {
<a name="l02143"></a>02143                    <span class="keywordtype">char</span> chname[<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>];
<a name="l02144"></a>02144                    <span class="keywordtype">char</span> *tpos;
<a name="l02145"></a>02145 
<a name="l02146"></a>02146 <span class="preprocessor">#ifdef MIDEBUG2</span>
<a name="l02147"></a>02147 <span class="preprocessor"></span>                   <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Device type %s found&quot;</span>,ds);
<a name="l02148"></a>02148 <span class="preprocessor">#endif</span>
<a name="l02149"></a>02149 <span class="preprocessor"></span>                   strcpy(chname,info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel);
<a name="l02150"></a>02150 
<a name="l02151"></a>02151                    <span class="keywordflow">if</span> ((tpos = strstr(chname,<span class="stringliteral">&quot;:SOL:2&quot;</span>)) != NULL) {
<a name="l02152"></a>02152                      <span class="keywordtype">int</span> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l02153"></a>02153 
<a name="l02154"></a>02154                      strcpy(tpos,<span class="stringliteral">&quot;:COM:2&quot;</span>);
<a name="l02155"></a>02155 <span class="preprocessor">#ifdef MIDEBUG2</span>
<a name="l02156"></a>02156 <span class="preprocessor"></span>                     <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Looking for channel %s&quot;</span>,chname);
<a name="l02157"></a>02157 <span class="preprocessor">#endif</span>
<a name="l02158"></a>02158 <span class="preprocessor"></span>                     <span class="keywordflow">for</span> (i = 0; i &lt; info-&gt;num_channels; i++) {
<a name="l02159"></a>02159                        <span class="keywordflow">if</span> (i==channel) <span class="keywordflow">continue</span>;
<a name="l02160"></a>02160                        <span class="keywordflow">if</span> (strcmp(info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*i,chname)
<a name="l02161"></a>02161                            == 0) {
<a name="l02162"></a>02162                          <span class="keywordtype">float</span> tval;
<a name="l02163"></a>02163                          <span class="keywordtype">char</span> *chflgs;
<a name="l02164"></a>02164 
<a name="l02165"></a>02165                          tval = (*info-&gt;demand+i); <span class="comment">// current value of other</span>
<a name="l02166"></a>02166                          <span class="comment">// evaluate channel flags of channel</span>
<a name="l02167"></a>02167                          chflgs = info-&gt;settings.chnflags+<a class="code" href="epics__ca__private_8h.html#ad04721c5bd2539cfc2e4cd3dc858bf85">CHNFLAGS_LENGTH</a>*channel;
<a name="l02168"></a>02168                          <span class="keywordflow">if</span> (strchr(chflgs,<span class="charliteral">&apos;P&apos;</span>)) {
<a name="l02169"></a>02169                            tval = 0.f;   <span class="comment">// ON</span>
<a name="l02170"></a>02170                          }
<a name="l02171"></a>02171                          <span class="keywordflow">if</span> (strchr(chflgs,<span class="charliteral">&apos;Z&apos;</span>)) {
<a name="l02172"></a>02172                            <span class="keywordflow">if</span> (<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> == 0.f)
<a name="l02173"></a>02173                              tval = 1.f; <span class="comment">// OFF</span>
<a name="l02174"></a>02174                            <span class="keywordflow">else</span>
<a name="l02175"></a>02175                              tval = 0.f; <span class="comment">// ON</span>
<a name="l02176"></a>02176                          }    
<a name="l02177"></a>02177                          <span class="keywordflow">if</span> (strchr(chflgs,<span class="charliteral">&apos;N&apos;</span>)) {
<a name="l02178"></a>02178                            <span class="keywordflow">if</span> (<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> &gt; 0.f)
<a name="l02179"></a>02179                              tval = 0.f; <span class="comment">// ON</span>
<a name="l02180"></a>02180                            <span class="keywordflow">else</span>
<a name="l02181"></a>02181                              tval = 1.f; <span class="comment">// OFF</span>
<a name="l02182"></a>02182                          }    
<a name="l02183"></a>02183                          <span class="keywordflow">if</span> (tval != *(info-&gt;demand+i)) {
<a name="l02184"></a>02184                            <span class="keywordflow">if</span> (*(info-&gt;found+i) &amp;&amp; *(info-&gt;settings.used+i) &amp;&amp;
<a name="l02185"></a>02185                                !*(info-&gt;settings.readonly+i)) {
<a name="l02186"></a>02186                              <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>;
<a name="l02187"></a>02187                              <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#a6db7064a7b5ba8ceb82aed57f2bc307f">epics_ca_set</a>(info, i, tval, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, forced_update);
<a name="l02188"></a>02188 <span class="preprocessor">#ifndef OMIT_ODBUPDATE</span>
<a name="l02189"></a>02189 <span class="preprocessor"></span>                             <span class="comment">// update ODB</span>
<a name="l02190"></a>02190                              <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l02191"></a>02191                              <span class="keywordflow">if</span> (info-&gt;hkeyDemand != 0) {
<a name="l02192"></a>02192                                <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> mstatus;
<a name="l02193"></a>02193                                mstatus = <a class="code" href="group__msectionh.html#ga18f5e7743545b06fca4f3d5ce9889034">db_set_data_index</a>(hDB, info-&gt;hkeyDemand, &amp;tval, 
<a name="l02194"></a>02194                                                            <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), i, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l02195"></a>02195                                <span class="keywordflow">if</span> (mstatus != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) ; <span class="comment">// NIY message</span>
<a name="l02196"></a>02196                                  
<a name="l02197"></a>02197                              }
<a name="l02198"></a>02198 <span class="preprocessor">#endif</span>
<a name="l02199"></a>02199 <span class="preprocessor"></span>                           }
<a name="l02200"></a>02200                          }
<a name="l02201"></a>02201                          <span class="keywordflow">break</span>;  <span class="comment">// channel found</span>
<a name="l02202"></a>02202                        }
<a name="l02203"></a>02203                      }
<a name="l02204"></a>02204                    }
<a name="l02205"></a>02205 
<a name="l02206"></a>02206                  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(ds,<span class="stringliteral">&quot;FENTE&quot;</span>)==0) {
<a name="l02207"></a>02207                    <span class="keywordtype">char</span> chname[<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>];
<a name="l02208"></a>02208                    <span class="keywordtype">char</span> *tpos;
<a name="l02209"></a>02209 
<a name="l02210"></a>02210 <span class="preprocessor">#ifdef MIDEBUG2</span>
<a name="l02211"></a>02211 <span class="preprocessor"></span>                   <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Device type %s found&quot;</span>,ds);
<a name="l02212"></a>02212 <span class="preprocessor">#endif</span>
<a name="l02213"></a>02213 <span class="preprocessor"></span>                   strcpy(chname,info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel);
<a name="l02214"></a>02214 
<a name="l02215"></a>02215                    <span class="keywordflow">if</span> ((tpos = strstr(chname,<span class="stringliteral">&quot;:SOL:2&quot;</span>)) != NULL) {
<a name="l02216"></a>02216                      <span class="keywordtype">int</span> i;
<a name="l02217"></a>02217 
<a name="l02218"></a>02218                      strcpy(tpos,<span class="stringliteral">&quot;:COM:2&quot;</span>);
<a name="l02219"></a>02219 <span class="preprocessor">#ifdef MIDEBUG2</span>
<a name="l02220"></a>02220 <span class="preprocessor"></span>                     <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Looking for channel %s&quot;</span>,chname);
<a name="l02221"></a>02221 <span class="preprocessor">#endif</span>
<a name="l02222"></a>02222 <span class="preprocessor"></span>                     <span class="keywordflow">for</span> (i = 0; i &lt; info-&gt;num_channels; i++) {
<a name="l02223"></a>02223                        <span class="keywordflow">if</span> (i==channel) <span class="keywordflow">continue</span>;
<a name="l02224"></a>02224                        <span class="keywordflow">if</span> (strcmp(info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*i,chname)
<a name="l02225"></a>02225                            == 0) {
<a name="l02226"></a>02226                          <span class="keywordtype">float</span> tval;
<a name="l02227"></a>02227                          <span class="keywordtype">char</span> *chflgs;
<a name="l02228"></a>02228 
<a name="l02229"></a>02229                          tval = (*info-&gt;demand+i); <span class="comment">// current value of other</span>
<a name="l02230"></a>02230                          <span class="comment">// evaluate channel flags of channel</span>
<a name="l02231"></a>02231                          chflgs = info-&gt;settings.chnflags+<a class="code" href="epics__ca__private_8h.html#ad04721c5bd2539cfc2e4cd3dc858bf85">CHNFLAGS_LENGTH</a>*channel;
<a name="l02232"></a>02232                          <span class="keywordflow">if</span> (strchr(chflgs,<span class="charliteral">&apos;V&apos;</span>)) {
<a name="l02233"></a>02233                            tval = 3.f;   <span class="comment">// 3 MOVE_TO_SOL</span>
<a name="l02234"></a>02234                          }    
<a name="l02235"></a>02235                          <span class="keywordflow">if</span> (tval != *(info-&gt;demand+i)) {
<a name="l02236"></a>02236                            <span class="keywordflow">if</span> (*(info-&gt;found+i) &amp;&amp; *(info-&gt;settings.used+i) &amp;&amp;
<a name="l02237"></a>02237                                !*(info-&gt;settings.readonly+i)) {
<a name="l02238"></a>02238                              <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>;
<a name="l02239"></a>02239 
<a name="l02240"></a>02240                              <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#a6db7064a7b5ba8ceb82aed57f2bc307f">epics_ca_set</a>(info, i, tval, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, forced_update);
<a name="l02241"></a>02241                              <span class="comment">// update ODB</span>
<a name="l02242"></a>02242                              <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l02243"></a>02243                              <span class="keywordflow">if</span> (info-&gt;hkeyDemand != 0) {
<a name="l02244"></a>02244                                <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> mstatus;
<a name="l02245"></a>02245                                mstatus = <a class="code" href="group__msectionh.html#ga18f5e7743545b06fca4f3d5ce9889034">db_set_data_index</a>(hDB, info-&gt;hkeyDemand, &amp;tval, 
<a name="l02246"></a>02246                                                            <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), i, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l02247"></a>02247                                <span class="keywordflow">if</span> (mstatus != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) ; <span class="comment">// NIY message</span>
<a name="l02248"></a>02248                              }
<a name="l02249"></a>02249                            }
<a name="l02250"></a>02250                          }
<a name="l02251"></a>02251                          <span class="keywordflow">break</span>;
<a name="l02252"></a>02252                        }
<a name="l02253"></a>02253                      }
<a name="l02254"></a>02254                    }
<a name="l02255"></a>02255                  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(ds,<span class="stringliteral">&quot;BX&quot;</span>)==0) {
<a name="l02256"></a>02256                    <span class="comment">// DO NOTHING</span>
<a name="l02257"></a>02257                  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(ds,<span class="stringliteral">&quot;HVPS&quot;</span>)==0) {
<a name="l02258"></a>02258                    <span class="comment">// DO NOTHING (too complicated to be handled correctly) </span>
<a name="l02259"></a>02259                  } <span class="keywordflow">else</span> {
<a name="l02260"></a>02260                    <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;epics_ca_set: GFA type %s is currently not handled&quot;</span>,
<a name="l02261"></a>02261                                   ds);
<a name="l02262"></a>02262                  }
<a name="l02263"></a>02263                  <span class="comment">//   enable GFA specific handling</span>
<a name="l02264"></a>02264                  info-&gt;handling_disabled = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; 
<a name="l02265"></a>02265                }
<a name="l02266"></a>02266 <span class="preprocessor">#endif  </span><span class="comment">/* #ifdef GFA_SPECIFIC */</span>
<a name="l02267"></a>02267                <span class="keywordflow">if</span> (<a class="code" href="embedded_2mscb_8h.html#a0a9e9396972b76c5947592479860020d">flush</a>) {
<a name="l02268"></a>02268                  status = <a class="code" href="cadef_8h.html#a25dde53a1e5191d169db4eb7947686b7">ca_pend_io</a>(0.01);
<a name="l02269"></a>02269 <span class="preprocessor">#ifdef MIDEBUGP</span>
<a name="l02270"></a>02270 <span class="preprocessor"></span>                 <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;ca_pend_io(0.01) status 0X%x = \&quot;%s\&quot;&quot;</span>, status, 
<a name="l02271"></a>02271                                 <a class="code" href="caerr_8h.html#ae80bb12bd8d4bf956c015591d3aaa52a">ca_message</a>(status));
<a name="l02272"></a>02272 <span class="preprocessor">#endif</span>
<a name="l02273"></a>02273 <span class="preprocessor"></span>               }
<a name="l02274"></a>02274              } <span class="keywordflow">else</span> {
<a name="l02275"></a>02275                <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;SET: channel %d(%s) NO WRITE ACCESS!&quot;</span>,
<a name="l02276"></a>02276                          channel,info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel); 
<a name="l02277"></a>02277              }
<a name="l02278"></a>02278            } <span class="keywordflow">else</span> {
<a name="l02279"></a>02279              <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;SET: channel %d(%s) is (currently?) not connected! &quot;</span>
<a name="l02280"></a>02280                     <span class="stringliteral">&quot;Channel state is %d = \&quot;%s\&quot;&quot;</span>, channel, 
<a name="l02281"></a>02281                     info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel, castate, 
<a name="l02282"></a>02282                     <a class="code" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c.html#a83acca8fab55af9343db12eb562e7a0d">castatestr</a>(castate)); 
<a name="l02283"></a>02283            }
<a name="l02284"></a>02284          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!*(info-&gt;found+channel)){
<a name="l02285"></a>02285            <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;SET: channel %d(%s) is (currently?) not enabled!&quot;</span>,
<a name="l02286"></a>02286                           channel,info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel); 
<a name="l02287"></a>02287          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!*(info-&gt;settings.used+channel)) {
<a name="l02288"></a>02288            <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;SET: channel %d(%s) is not used!&quot;</span>,
<a name="l02289"></a>02289                           channel,info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel); 
<a name="l02290"></a>02290          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*(info-&gt;settings.readonly+channel)) {
<a name="l02291"></a>02291            <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;SET: channel %d(%s) is set read ONLY!&quot;</span>,
<a name="l02292"></a>02292                           channel,info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel); 
<a name="l02293"></a>02293          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!*(info-&gt;iscmd+channel)){
<a name="l02294"></a>02294            <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;SET: channel %d(%s) is not a channel to be set!&quot;</span>,
<a name="l02295"></a>02295                           channel,info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel); 
<a name="l02296"></a>02296          }
<a name="l02297"></a>02297        } <span class="keywordflow">else</span> {
<a name="l02298"></a>02298 <span class="preprocessor">#ifdef MIDEBUG</span>
<a name="l02299"></a>02299 <span class="preprocessor"></span>         <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;Demand and readout (%f) did not change -&gt; not updating channel&quot;</span>
<a name="l02300"></a>02300                          <span class="stringliteral">&quot; %d(%s)&quot;</span>, <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, channel, 
<a name="l02301"></a>02301                          info-&gt;settings.channel_names+<a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a>*channel);
<a name="l02302"></a>02302 <span class="preprocessor">#endif</span>
<a name="l02303"></a>02303 <span class="preprocessor"></span>       }
<a name="l02304"></a>02304        <span class="keywordflow">if</span> (info-&gt;lastset) *(info-&gt;lastset+channel) = <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>();
<a name="l02305"></a>02305        <span class="keywordflow">if</span> (info-&gt;demand)  *(info-&gt;demand+channel)  = <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;
<a name="l02306"></a>02306      }
<a name="l02307"></a>02307    }
<a name="l02308"></a>02308 <span class="preprocessor">#ifdef MIDEBUG1</span>
<a name="l02309"></a>02309 <span class="preprocessor"></span>   <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;  --epics_ca_set()&quot;</span>);
<a name="l02310"></a>02310 <span class="preprocessor">#endif</span>
<a name="l02311"></a>02311 <span class="preprocessor"></span><span class="preprocessor">#ifdef MIDEBUGF</span>
<a name="l02312"></a>02312 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>) fprintf(<a class="code" href="mlxspeaker_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a>,<span class="stringliteral">&quot;%u : --epics_ca_set(channel=%d, value=%f)\n&quot;</span>, <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>(),
<a name="l02313"></a>02313                   channel,<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l02314"></a>02314 <span class="preprocessor">#endif</span>
<a name="l02315"></a>02315 <span class="preprocessor"></span>   <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>;
<a name="l02316"></a>02316 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af6b6f79619a17afc1b5866c53c389aa5"></a><!-- doxytag: member="epics_ca_private.h::epics_ca_set_all" ref="af6b6f79619a17afc1b5866c53c389aa5" args="(CA_INFO *, INT, float)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> epics_ca_set_all </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCA__INFO.html">CA_INFO</a> *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00209">209</a> of file <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html">epics_ca.c</a>.</p>

<p>References <a class="el" href="caerr_8h.html#ae80bb12bd8d4bf956c015591d3aaa52a">ca_message()</a>, <a class="el" href="cadef_8h_source.html#l00698">ca_pend_io</a>, <a class="el" href="cadef_8h_source.html#l00422">ca_put</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="db__access_8h_source.html#l00144">DBR_FLOAT</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00200">epics_ca_set()</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="midas_8h_source.html#l01084">FE_SUCCESS</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="Mql_8h_source.html#l00007">MIN</a>, <a class="el" href="midas_8h_source.html#l00937">MLOG</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00075">CA_INFO::num_channels</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00073">CA_INFO::pv_handles</a>, and <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>.</p>

<p>Referenced by <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00264">epics_ca()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00210"></a>00210 {
<a name="l00211"></a>00211    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l00212"></a>00212 
<a name="l00213"></a>00213    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="Mql_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(info-&gt;num_channels, <a class="code" href="plot__max_8c.html#ad49ec371d0c77a469cc14aa6f44b232e">channels</a>); i++)
<a name="l00214"></a>00214       <a class="code" href="cadef_8h.html#a3c5bfc00b00a193db6cc0c060d5d959f">ca_put</a>(<a class="code" href="db__access_8h.html#a1863ad4a27d5b02ab4b549d0424b035a">DBR_FLOAT</a>, info-&gt;pv_handles[i], &amp;<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l00215"></a>00215 
<a name="l00216"></a>00216    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>;
<a name="l00217"></a>00217 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a53eb16584e782098780bfb4213201f0e"></a><!-- doxytag: member="epics_ca_private.h::epics_ca_set_label" ref="a53eb16584e782098780bfb4213201f0e" args="(CA_INFO *, INT, char *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> epics_ca_set_label </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCA__INFO.html">CA_INFO</a> *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00221">221</a> of file <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html">epics_ca.c</a>.</p>

<p>References <a class="el" href="cadef_8h.html#a91dafbf5e94f8b8e2bcbe3782404963c">ca_clear_channel()</a>, <a class="el" href="cadef_8h_source.html#l00116">ca_field_type</a>, <a class="el" href="caerr_8h.html#ae80bb12bd8d4bf956c015591d3aaa52a">ca_message()</a>, <a class="el" href="cadef_8h_source.html#l00697">ca_pend_event</a>, <a class="el" href="cadef_8h_source.html#l00698">ca_pend_io</a>, <a class="el" href="cadef_8h_source.html#l00422">ca_put</a>, <a class="el" href="cadef_8h_source.html#l00305">ca_search</a>, <a class="el" href="cadef_8h_source.html#l00132">ca_state</a>, <a class="el" href="epics__ca__private_8h_source.html#l00205">CA_SETTINGS::channel_names</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00072">CA_INFO::channel_names</a>, <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00069">CHN_NAME_LENGTH</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="cadef_8h_source.html#l00131">cs_conn</a>, <a class="el" href="caerr_8h_source.html#l00091">ECA_NORMAL</a>, <a class="el" href="midas_8h_source.html#l01084">FE_SUCCESS</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l00937">MLOG</a>, <a class="el" href="epics__ca__private_8h_source.html#l00219">CA_INFO::settings</a>, and <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>.</p>

<p>Referenced by <a class="el" href="midas_2drivers_2device_2epics__ca_8c_source.html#l00264">epics_ca()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00222"></a>00222 {
<a name="l00223"></a>00223    <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l00224"></a>00224    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l00225"></a>00225    <a class="code" href="structchannel__in__use.html">chid</a> chan_id;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227    sprintf(str, <span class="stringliteral">&quot;%s.DESC&quot;</span>, info-&gt;channel_names + <a class="code" href="midas_2drivers_2device_2epics__ca_8c.html#ada84bade215a652f4fd8d6af2295c272">CHN_NAME_LENGTH</a> * <a class="code" href="plot__max_8c.html#ad49ec371d0c77a469cc14aa6f44b232e">channels</a>);
<a name="l00228"></a>00228    status = <a class="code" href="cadef_8h.html#a9211a285a02b6dcb798801b61cc3c8ac">ca_search</a>(str, &amp;chan_id);
<a name="l00229"></a>00229 
<a name="l00230"></a>00230    status = <a class="code" href="cadef_8h.html#a25dde53a1e5191d169db4eb7947686b7">ca_pend_io</a>(2.0);
<a name="l00231"></a>00231    <span class="keywordflow">if</span> (status != <a class="code" href="caerr_8h.html#adf6b44e1db88cbf1bc1463be5083839b">ECA_NORMAL</a>)
<a name="l00232"></a>00232       printf(<span class="stringliteral">&quot;%s not found\n&quot;</span>, str);
<a name="l00233"></a>00233 
<a name="l00234"></a>00234    status = <a class="code" href="cadef_8h.html#a3c5bfc00b00a193db6cc0c060d5d959f">ca_put</a>(<a class="code" href="cadef_8h.html#a2ddbb327f52c15f1671eb1710ba983cc">ca_field_type</a>(chan_id), chan_id, label);
<a name="l00235"></a>00235    <a class="code" href="cadef_8h.html#a05a137b370d6733ce3d41a411b8e3f59">ca_pend_event</a>(0.01);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>;
<a name="l00238"></a>00238 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af82d2378c00649c756a7502b65b0d57a"></a><!-- doxytag: member="epics_ca_private.h::epics_ca_set_pending" ref="af82d2378c00649c756a7502b65b0d57a" args="(CA_INFO *, BOOL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> epics_ca_set_pending </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCA__INFO.html">CA_INFO</a> *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html#l00396">396</a> of file <a class="el" href="slowcontrol_2epics__beamline__frontend_2epics__ca_8c_source.html">epics_ca.c</a>.</p>

<p>References <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l01084">FE_SUCCESS</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l00937">MLOG</a>, <a class="el" href="epics__ca__private_8h_source.html#l00252">CA_INFO::pending</a>, and <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00396"></a>00396                                                        {
<a name="l00397"></a>00397    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l00398"></a>00398 
<a name="l00399"></a>00399    status = <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>;
<a name="l00400"></a>00400    <span class="keywordflow">if</span> (info) {
<a name="l00401"></a>00401      <span class="keywordflow">if</span> (pending) {
<a name="l00402"></a>00402        <span class="keywordflow">if</span> (info-&gt;pending == 0) <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;*** Blocking Tolerance InRange checking&quot;</span>);
<a name="l00403"></a>00403        info-&gt;pending++;
<a name="l00404"></a>00404      } <span class="keywordflow">else</span> {
<a name="l00405"></a>00405        <span class="keywordflow">if</span> (info-&gt;pending &gt; 0) {
<a name="l00406"></a>00406          info-&gt;pending--;
<a name="l00407"></a>00407          <span class="keywordflow">if</span> (info-&gt;pending == 0) 
<a name="l00408"></a>00408             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;*** Tolerance InRange checking not blocked anymore&quot;</span>);
<a name="l00409"></a>00409        } <span class="keywordflow">else</span> {
<a name="l00410"></a>00410          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>,<span class="stringliteral">&quot;epics_ca_set_pending&quot;</span>,<span class="stringliteral">&quot;PROGRAMMING ERROR releasing pending &quot;</span>
<a name="l00411"></a>00411                                               <span class="stringliteral">&quot;AND info-&gt;pending == 0&quot;</span>);
<a name="l00412"></a>00412        }
<a name="l00413"></a>00413      }
<a name="l00414"></a>00414    }
<a name="l00415"></a>00415    <span class="keywordflow">return</span> status;
<a name="l00416"></a>00416 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 6 Jun 2014 for AlcapDAQ:Rootana by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
