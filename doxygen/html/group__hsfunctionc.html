<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>AlcapDAQ:Rootana: Midas History Functions (hs_xxx)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Midas History Functions (hs_xxx)<br/>
<small>
[<a class="el" href="group__midasincludecode.html">The midas.h &amp; midas.c</a>]</small>
</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#gadd381765666fd1aa3395b63b86d44887">hs_set_path</a> (char *path)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a> (<a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> ltime, char *suffix, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="mscbutil_8c.html#a74b654271a172a244c844fb86277cd8a">mode</a>, int *fh)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#ga0e7b43f0ca043d04fb5716b8da02d41f">hs_gen_index</a> (<a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> ltime)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#ga1ebb4cc3c2f54b895e14c665db26531d">hs_search_file</a> (<a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *ltime, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> direction)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#gaa6099af227b2f2a528321720d4564d2c">hs_define_event</a> (<a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="mzdump_8c.html#ac6d03005c20c7feabe0b6be6902f0a5e">event_id</a>, char *name, <a class="el" href="structTAG.html">TAG</a> *<a class="el" href="mhist_8c.html#a27ce05f73a16e6abc070da1007833b9b">tag</a>, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#ga4ff8aeb548c6c3ace16fa8e9ec77a5d5">hs_write_event</a> (<a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="mzdump_8c.html#ac6d03005c20c7feabe0b6be6902f0a5e">event_id</a>, void *<a class="el" href="odbedit_8c.html#a8c6d6f90e1d6932f65c6f43d2f9d49a7">data</a>, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#ga318b7fb581951de4e22c1e905cff8253">hs_enum_events</a> (<a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> ltime, char *event_name, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *name_size, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="mzdump_8c.html#ac6d03005c20c7feabe0b6be6902f0a5e">event_id</a>[], <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *id_size)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#ga36161ee70c89cf501e9602da23db96f1">hs_count_events</a> (<a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> ltime, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *<a class="el" href="mzdump_8c.html#a3d42cdd395a9c14f809d2fe53748c620">count</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#ga54d9839f9719570bca40a419827d5ade">hs_get_event_id</a> (<a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> ltime, char *name, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#gabe133ec8805614034d77453ab7d64a77">hs_count_vars</a> (<a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> ltime, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="mzdump_8c.html#ac6d03005c20c7feabe0b6be6902f0a5e">event_id</a>, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *<a class="el" href="mzdump_8c.html#a3d42cdd395a9c14f809d2fe53748c620">count</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#ga7e10a97aa15121bf1337e1bd6ad20bc6">hs_enum_vars</a> (<a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> ltime, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="mzdump_8c.html#ac6d03005c20c7feabe0b6be6902f0a5e">event_id</a>, char *<a class="el" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a>, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *<a class="el" href="slowcontrol_2vacuum__sensor_2frontend_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *var_n, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *n_size)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#ga221c5c291ec83af5f621cce3893af06e">hs_get_var</a> (<a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> ltime, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="mzdump_8c.html#ac6d03005c20c7feabe0b6be6902f0a5e">event_id</a>, char *<a class="el" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a>, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *<a class="el" href="ybos_8c.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> *n_data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#ga2d209407f1f672eb2642d63ae5ce9a03">hs_read</a> (<a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="mzdump_8c.html#ac6d03005c20c7feabe0b6be6902f0a5e">event_id</a>, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> end_time, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="mscbutil_8c.html#ad856acfe9ce335571b00a73df5e23e6b">interval</a>, char *tag_name, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="lcd__menu_8c.html#a13b219e0dd828c9f136b7bb99d8afc34">var_index</a>, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *time_buffer, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *tbsize, void *<a class="el" href="dt5720__module_8c.html#a947a5d3c6344d9b851f60f91d2a8222f">data_buffer</a>, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *dbsize, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *<a class="el" href="ybos_8c.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *<a class="el" href="mana__orig_8c.html#a228a29e4d9ddfb6bc4994455a321bdc4">n</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#gaa0adfd626d570a1e37a01f2f8b8afdfd">hs_dump</a> (<a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="mzdump_8c.html#ac6d03005c20c7feabe0b6be6902f0a5e">event_id</a>, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> end_time, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="mscbutil_8c.html#ad856acfe9ce335571b00a73df5e23e6b">interval</a>, <a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> <a class="el" href="mhist_8c.html#ab8807066c6d3cac932af3c18621e04d0">binary_time</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#ga477235c506afd964bdc741b688179ff8">hs_fdump</a> (char *<a class="el" href="odbhist_8c.html#a4da1fcf44864d811e793f03bf36e6e17">file_name</a>, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> id, <a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> <a class="el" href="mhist_8c.html#ab8807066c6d3cac932af3c18621e04d0">binary_time</a>)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structHISTORY.html">HISTORY</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#gac4638da3ec6d22fed1de595a7b7533eb">_history_entries</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hsfunctionc.html#ga6bfae86238964396b88c3d62aa3e0e3b">_hs_path_name</a> [MAX_STRING_LENGTH]</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>dox dox </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga36161ee70c89cf501e9602da23db96f1"></a><!-- doxytag: member="midas.c::hs_count_events" ref="ga36161ee70c89cf501e9602da23db96f1" args="(DWORD ltime, DWORD *count)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> hs_count_events </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>ltime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&nbsp;</td>
          <td class="paramname"> <em>count</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l13907">13907</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l01093">HS_FILE_ERROR</a>, <a class="el" href="midas_8c_source.html#l13271">hs_open_file()</a>, <a class="el" href="midas_8c_source.html#l13394">hs_search_file()</a>, <a class="el" href="midas_8h_source.html#l01092">HS_SUCCESS</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="midas_8h_source.html#l01755">M_FREE</a>, <a class="el" href="midas_8h_source.html#l01753">M_MALLOC</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00256">read</a>, <a class="el" href="midas_8c_source.html#l09810">rpc_call()</a>, <a class="el" href="mrpc_8h_source.html#l00175">RPC_HS_COUNT_EVENTS</a>, <a class="el" href="midas_8c_source.html#l09022">rpc_is_remote()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="msystem_8h_source.html#l00369">TELL</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="mhist_8c_source.html#l00238">display_vars()</a>, <a class="el" href="mhist_8c_source.html#l00158">query_params()</a>, and <a class="el" href="mserver_8c_source.html#l00534">rpc_server_dispatch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l13910"></a>13910          : <a class="code" href="group__msectionh.html#ga8e4e2004af1da6f95ccf8227cf0b2004">hs_count_events</a>
<a name="l13911"></a>13911 
<a name="l13912"></a>13912   Purpose: Count number of different events <span class="keywordflow">for</span> a given date
<a name="l13913"></a>13913 
<a name="l13914"></a>13914   Input:
<a name="l13915"></a>13915     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  ltime            Date at which events should be counted
<a name="l13916"></a>13916 
<a name="l13917"></a>13917   Output:
<a name="l13918"></a>13918     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  *<a class="code" href="mdump_8c.html#a3d42cdd395a9c14f809d2fe53748c620">count</a>           Number of different events <a class="code" href="patch__mevb_8cpp.html#a408216eef095a35ba3963fc6f4f4d7a8">found</a>
<a name="l13919"></a>13919 
<a name="l13920"></a>13920   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l13921"></a>13921     <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>              Successful completion
<a name="l13922"></a>13922     <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>           Cannot open <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file
<a name="l13923"></a>13923 
<a name="l13924"></a>13924 \********************************************************************/
<a name="l13925"></a>13925 {
<a name="l13926"></a>13926    <span class="keywordtype">int</span> fh, fhd;
<a name="l13927"></a>13927    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>;
<a name="l13928"></a>13928    <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> *id;
<a name="l13929"></a>13929    <a class="code" href="structDEF__RECORD.html">DEF_RECORD</a> def_rec;
<a name="l13930"></a>13930 
<a name="l13931"></a>13931    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga0090933001e7e1ddd52ed3f321bea957">rpc_is_remote</a>())
<a name="l13932"></a>13932       <span class="keywordflow">return</span> <a class="code" href="group__msectionh.html#ga6bf1d13a0c49a3f7a02650885937b5e7">rpc_call</a>(<a class="code" href="group__mrpcdefineh.html#gaa8cdf659ab08fa5857d82b73e20bf47b">RPC_HS_COUNT_EVENTS</a>, ltime, <a class="code" href="mdump_8c.html#a3d42cdd395a9c14f809d2fe53748c620">count</a>);
<a name="l13933"></a>13933 
<a name="l13934"></a>13934    <span class="comment">/* search latest history file */</span>
<a name="l13935"></a>13935    status = <a class="code" href="group__hsfunctionc.html#ga1ebb4cc3c2f54b895e14c665db26531d">hs_search_file</a>(&amp;ltime, -1);
<a name="l13936"></a>13936    <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>) {
<a name="l13937"></a>13937       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_count_events&quot;</span>, <span class="stringliteral">&quot;cannot find recent history file&quot;</span>);
<a name="l13938"></a>13938       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l13939"></a>13939    }
<a name="l13940"></a>13940 
<a name="l13941"></a>13941    <span class="comment">/* open history and definition files */</span>
<a name="l13942"></a>13942    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(ltime, <span class="stringliteral">&quot;hst&quot;</span>, O_RDONLY, &amp;fh);
<a name="l13943"></a>13943    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(ltime, <span class="stringliteral">&quot;idf&quot;</span>, O_RDONLY, &amp;fhd);
<a name="l13944"></a>13944    <span class="keywordflow">if</span> (fh &lt; 0 || fhd &lt; 0) {
<a name="l13945"></a>13945       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_count_events&quot;</span>, <span class="stringliteral">&quot;cannot open index files&quot;</span>);
<a name="l13946"></a>13946       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l13947"></a>13947    }
<a name="l13948"></a>13948 
<a name="l13949"></a>13949    <span class="comment">/* allocate event id array */</span>
<a name="l13950"></a>13950    lseek(fhd, 0, SEEK_END);
<a name="l13951"></a>13951    <span class="keywordtype">id</span> = (<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(<a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fhd) / <span class="keyword">sizeof</span>(def_rec) * <span class="keyword">sizeof</span>(<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>));
<a name="l13952"></a>13952    lseek(fhd, 0, SEEK_SET);
<a name="l13953"></a>13953 
<a name="l13954"></a>13954    <span class="comment">/* loop over index file */</span>
<a name="l13955"></a>13955    n = 0;
<a name="l13956"></a>13956    <span class="keywordflow">do</span> {
<a name="l13957"></a>13957       <span class="comment">/* read definition index record */</span>
<a name="l13958"></a>13958       j = <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhd, (<span class="keywordtype">char</span> *) &amp;def_rec, <span class="keyword">sizeof</span>(def_rec));
<a name="l13959"></a>13959       <span class="keywordflow">if</span> (j &lt; (<span class="keywordtype">int</span>) <span class="keyword">sizeof</span>(def_rec))
<a name="l13960"></a>13960          <span class="keywordflow">break</span>;
<a name="l13961"></a>13961 
<a name="l13962"></a>13962       <span class="comment">/* look for existing entries */</span>
<a name="l13963"></a>13963       <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l13964"></a>13964          <span class="keywordflow">if</span> (<span class="keywordtype">id</span>[i] == def_rec.event_id)
<a name="l13965"></a>13965             <span class="keywordflow">break</span>;
<a name="l13966"></a>13966 
<a name="l13967"></a>13967       <span class="comment">/* new entry found */</span>
<a name="l13968"></a>13968       <span class="keywordflow">if</span> (i == n) {
<a name="l13969"></a>13969          <span class="keywordtype">id</span>[i] = def_rec.event_id;
<a name="l13970"></a>13970          n++;
<a name="l13971"></a>13971       }
<a name="l13972"></a>13972    } <span class="keywordflow">while</span> (<a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l13973"></a>13973 
<a name="l13974"></a>13974 
<a name="l13975"></a>13975    <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(<span class="keywordtype">id</span>);
<a name="l13976"></a>13976    close(fh);
<a name="l13977"></a>13977    close(fhd);
<a name="l13978"></a>13978    *<a class="code" href="mdump_8c.html#a3d42cdd395a9c14f809d2fe53748c620">count</a> = n;
<a name="l13979"></a>13979 
<a name="l13980"></a>13980    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>;
<a name="l13981"></a>13981 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gabe133ec8805614034d77453ab7d64a77"></a><!-- doxytag: member="midas.c::hs_count_vars" ref="gabe133ec8805614034d77453ab7d64a77" args="(DWORD ltime, DWORD event_id, DWORD *count)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> hs_count_vars </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>ltime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>event_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&nbsp;</td>
          <td class="paramname"> <em>count</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l14064">14064</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l01564">DEF_RECORD::def_offset</a>, <a class="el" href="midas_8h_source.html#l01562">DEF_RECORD::event_id</a>, <a class="el" href="midas_8h_source.html#l01093">HS_FILE_ERROR</a>, <a class="el" href="midas_8c_source.html#l13271">hs_open_file()</a>, <a class="el" href="midas_8c_source.html#l13394">hs_search_file()</a>, <a class="el" href="midas_8h_source.html#l01092">HS_SUCCESS</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00256">read</a>, <a class="el" href="midas_8c_source.html#l09810">rpc_call()</a>, <a class="el" href="mrpc_8h_source.html#l00177">RPC_HS_COUNT_VARS</a>, <a class="el" href="midas_8c_source.html#l09022">rpc_is_remote()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, and <a class="el" href="msystem_8h_source.html#l00369">TELL</a>.</p>

<p>Referenced by <a class="el" href="mhist_8c_source.html#l00238">display_vars()</a>, <a class="el" href="mhist_8c_source.html#l00158">query_params()</a>, and <a class="el" href="mserver_8c_source.html#l00534">rpc_server_dispatch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14067"></a>14067          : <a class="code" href="group__msectionh.html#gac798dee41f652e183de1e1c044b62f49">hs_count_vars</a>
<a name="l14068"></a>14068 
<a name="l14069"></a>14069   Purpose: Count number of <a class="code" href="hvr__200_8c.html#a900ff3a8ccab65692c28b012e3824819">variables</a> <span class="keywordflow">for</span> a given date <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> <span class="keyword">event</span> <span class="keywordtype">id</span>
<a name="l14070"></a>14070 
<a name="l14071"></a>14071   Input:
<a name="l14072"></a>14072     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  ltime            Date at which tags should be counted
<a name="l14073"></a>14073 
<a name="l14074"></a>14074   Output:
<a name="l14075"></a>14075     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  *<a class="code" href="mdump_8c.html#a3d42cdd395a9c14f809d2fe53748c620">count</a>           Number of tags
<a name="l14076"></a>14076 
<a name="l14077"></a>14077   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l14078"></a>14078     <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>              Successful completion
<a name="l14079"></a>14079     <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>           Cannot open <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file
<a name="l14080"></a>14080 
<a name="l14081"></a>14081 \********************************************************************/
<a name="l14082"></a>14082 {
<a name="l14083"></a>14083    <span class="keywordtype">int</span> fh, fhd;
<a name="l14084"></a>14084    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l14085"></a>14085    <a class="code" href="structDEF__RECORD.html">DEF_RECORD</a> def_rec;
<a name="l14086"></a>14086    <a class="code" href="structHIST__RECORD.html">HIST_RECORD</a> rec;
<a name="l14087"></a>14087 
<a name="l14088"></a>14088    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga0090933001e7e1ddd52ed3f321bea957">rpc_is_remote</a>())
<a name="l14089"></a>14089       <span class="keywordflow">return</span> <a class="code" href="group__msectionh.html#ga6bf1d13a0c49a3f7a02650885937b5e7">rpc_call</a>(<a class="code" href="group__mrpcdefineh.html#ga17a4f1c2652c0b2c77d1aee2cbad0ce3">RPC_HS_COUNT_VARS</a>, ltime, <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>, <a class="code" href="mdump_8c.html#a3d42cdd395a9c14f809d2fe53748c620">count</a>);
<a name="l14090"></a>14090 
<a name="l14091"></a>14091    <span class="comment">/* search latest history file */</span>
<a name="l14092"></a>14092    status = <a class="code" href="group__hsfunctionc.html#ga1ebb4cc3c2f54b895e14c665db26531d">hs_search_file</a>(&amp;ltime, -1);
<a name="l14093"></a>14093    <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>) {
<a name="l14094"></a>14094       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_count_tags&quot;</span>, <span class="stringliteral">&quot;cannot find recent history file&quot;</span>);
<a name="l14095"></a>14095       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14096"></a>14096    }
<a name="l14097"></a>14097 
<a name="l14098"></a>14098    <span class="comment">/* open history and definition files */</span>
<a name="l14099"></a>14099    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(ltime, <span class="stringliteral">&quot;hst&quot;</span>, O_RDONLY, &amp;fh);
<a name="l14100"></a>14100    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(ltime, <span class="stringliteral">&quot;idf&quot;</span>, O_RDONLY, &amp;fhd);
<a name="l14101"></a>14101    <span class="keywordflow">if</span> (fh &lt; 0 || fhd &lt; 0) {
<a name="l14102"></a>14102       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_count_tags&quot;</span>, <span class="stringliteral">&quot;cannot open index files&quot;</span>);
<a name="l14103"></a>14103       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14104"></a>14104    }
<a name="l14105"></a>14105 
<a name="l14106"></a>14106    <span class="comment">/* search last definition */</span>
<a name="l14107"></a>14107    lseek(fhd, 0, SEEK_END);
<a name="l14108"></a>14108    n = <a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fhd) / <span class="keyword">sizeof</span>(def_rec);
<a name="l14109"></a>14109    def_rec.<a class="code" href="structDEF__RECORD.html#a9d9787264de717f2512af5e7d48e5a32">event_id</a> = 0;
<a name="l14110"></a>14110    <span class="keywordflow">for</span> (i = n - 1; i &gt;= 0; i--) {
<a name="l14111"></a>14111       lseek(fhd, i * <span class="keyword">sizeof</span>(def_rec), SEEK_SET);
<a name="l14112"></a>14112       <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhd, (<span class="keywordtype">char</span> *) &amp;def_rec, <span class="keyword">sizeof</span>(def_rec));
<a name="l14113"></a>14113       <span class="keywordflow">if</span> (def_rec.event_id == <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>)
<a name="l14114"></a>14114          <span class="keywordflow">break</span>;
<a name="l14115"></a>14115    }
<a name="l14116"></a>14116    <span class="keywordflow">if</span> (def_rec.event_id != <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>) {
<a name="l14117"></a>14117       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_count_tags&quot;</span>, <span class="stringliteral">&quot;event %d not found in index file&quot;</span>, <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>);
<a name="l14118"></a>14118       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14119"></a>14119    }
<a name="l14120"></a>14120 
<a name="l14121"></a>14121    <span class="comment">/* read definition */</span>
<a name="l14122"></a>14122    lseek(fh, def_rec.def_offset, SEEK_SET);
<a name="l14123"></a>14123    <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, (<span class="keywordtype">char</span> *) &amp;rec, <span class="keyword">sizeof</span>(rec));
<a name="l14124"></a>14124    *<a class="code" href="mdump_8c.html#a3d42cdd395a9c14f809d2fe53748c620">count</a> = rec.data_size / <span class="keyword">sizeof</span>(<a class="code" href="structTAG.html">TAG</a>);
<a name="l14125"></a>14125 
<a name="l14126"></a>14126    close(fh);
<a name="l14127"></a>14127    close(fhd);
<a name="l14128"></a>14128 
<a name="l14129"></a>14129    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>;
<a name="l14130"></a>14130 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaa6099af227b2f2a528321720d4564d2c"></a><!-- doxytag: member="midas.c::hs_define_event" ref="gaa6099af227b2f2a528321720d4564d2c" args="(DWORD event_id, char *name, TAG *tag, DWORD size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> hs_define_event </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>event_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structTAG.html">TAG</a> *&nbsp;</td>
          <td class="paramname"> <em>tag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l13463">13463</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l01581">HISTORY::base_time</a>, <a class="el" href="fal_8c_source.html#l00201">buffer</a>, <a class="el" href="midas_8h_source.html#l01558">HIST_RECORD::data_size</a>, <a class="el" href="midas_8h_source.html#l01580">HISTORY::def_fh</a>, <a class="el" href="midas_8h_source.html#l01564">DEF_RECORD::def_offset</a>, <a class="el" href="midas_8h_source.html#l01582">HISTORY::def_offset</a>, <a class="el" href="midas_8h_source.html#l01562">DEF_RECORD::event_id</a>, <a class="el" href="midas_8h_source.html#l01574">HISTORY::event_id</a>, <a class="el" href="midas_8h_source.html#l01555">HIST_RECORD::event_id</a>, <a class="el" href="midas_8h_source.html#l01563">DEF_RECORD::event_name</a>, <a class="el" href="midas_8h_source.html#l01578">HISTORY::hist_fh</a>, <a class="el" href="midas_8h_source.html#l01093">HS_FILE_ERROR</a>, <a class="el" href="midas_8c_source.html#l13299">hs_gen_index()</a>, <a class="el" href="midas_8h_source.html#l01094">HS_NO_MEMORY</a>, <a class="el" href="midas_8c_source.html#l13271">hs_open_file()</a>, <a class="el" href="midas_8h_source.html#l01092">HS_SUCCESS</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="midas_8h_source.html#l01579">HISTORY::index_fh</a>, <a class="el" href="midas_8h_source.html#l01755">M_FREE</a>, <a class="el" href="midas_8h_source.html#l01753">M_MALLOC</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="midas_8h_source.html#l01576">HISTORY::n_tag</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00256">read</a>, <a class="el" href="midas_8h_source.html#l01554">HIST_RECORD::record_type</a>, <a class="el" href="midas_8h_source.html#l01551">RT_DEF</a>, <a class="el" href="midas_8h_source.html#l01577">HISTORY::tag</a>, <a class="el" href="msystem_8h_source.html#l00369">TELL</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, <a class="el" href="midas_8h_source.html#l01556">HIST_RECORD::time</a>, and <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00259">write</a>.</p>

<p>Referenced by <a class="el" href="mhist_8c_source.html#l00133">generate_hist()</a>, <a class="el" href="fal_8c_source.html#l01573">open_history()</a>, <a class="el" href="mserver_8c_source.html#l00534">rpc_server_dispatch()</a>, and <a class="el" href="mhist_8c_source.html#l00103">write_hist_speed()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l13466"></a>13466          : hs_define_evnet
<a name="l13467"></a>13467 
<a name="l13468"></a>13468   Purpose: Define a <span class="keyword">new</span> <span class="keyword">event</span> <span class="keywordflow">for</span> which a <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> should be recorded.
<a name="l13469"></a>13469            This routine must be called before any <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a> to
<a name="l13470"></a>13470            <a class="code" href="group__msectionh.html#ga607ef6f6ef2f547c09f05a5a7fe4c3d6">hs_write_event</a>. It also should be called <span class="keywordflow">if</span> the definition
<a name="l13471"></a>13471            of the <span class="keyword">event</span> has changed.
<a name="l13472"></a>13472 
<a name="l13473"></a>13473            The <span class="keyword">event</span> definition is written directly to the <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a>
<a name="l13474"></a>13474            file. If the definition is identical to a previous
<a name="l13475"></a>13475            definition, it is not written to the file.
<a name="l13476"></a>13476 
<a name="l13477"></a>13477 
<a name="l13478"></a>13478   Input:
<a name="l13479"></a>13479     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>         <a class="code" href="jorway73a_8h.html#a4bfe115debc7f472dd7dfe4ef9679ca0">ID</a> <span class="keywordflow">for</span> <span class="keyword">this</span> <span class="keyword">event</span>. Must be unique.
<a name="l13480"></a>13480     <span class="keywordtype">char</span>   <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>             Name of <span class="keyword">this</span> <span class="keyword">event</span>
<a name="l13481"></a>13481     <a class="code" href="structTAG.html">TAG</a>    tag              Tag <a class="code" href="namespacemodules.html#a12afb64f27b8a4e356d665de83e78ad3">list</a> containing names <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> types of
<a name="l13482"></a>13482                             <a class="code" href="hvr__200_8c.html#a900ff3a8ccab65692c28b012e3824819">variables</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> <span class="keyword">this</span> <span class="keyword">event</span>.
<a name="l13483"></a>13483     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>             Size of tag array
<a name="l13484"></a>13484 
<a name="l13485"></a>13485   Output:
<a name="l13486"></a>13486     &lt;none&gt;
<a name="l13487"></a>13487 
<a name="l13488"></a>13488   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l13489"></a>13489     <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>              Successful completion
<a name="l13490"></a>13490     HS_NO_MEMEORY           Out of memory
<a name="l13491"></a>13491     <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>           Cannot open <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file
<a name="l13492"></a>13492 
<a name="l13493"></a>13493 \********************************************************************/
<a name="l13494"></a>13494 {
<a name="l13495"></a>13495 <span class="comment">/* History events are only written locally (?)</span>
<a name="l13496"></a>13496 <span class="comment"></span>
<a name="l13497"></a>13497 <span class="comment">  if (rpc_is_remote())</span>
<a name="l13498"></a>13498 <span class="comment">    return rpc_call(RPC_HS_DEFINE_EVENT, event_id, name, tag, size);</span>
<a name="l13499"></a>13499 <span class="comment">*/</span>
<a name="l13500"></a>13500    {
<a name="l13501"></a>13501       <a class="code" href="structHIST__RECORD.html">HIST_RECORD</a> rec, prev_rec;
<a name="l13502"></a>13502       <a class="code" href="structDEF__RECORD.html">DEF_RECORD</a> def_rec;
<a name="l13503"></a>13503       <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256], event_name[<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>], *<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>;
<a name="l13504"></a>13504       <span class="keywordtype">int</span> fh, fhi, fhd;
<a name="l13505"></a>13505       <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, len, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>;
<a name="l13506"></a>13506       <span class="keyword">struct </span>tm *tmb;
<a name="l13507"></a>13507 
<a name="l13508"></a>13508       <span class="comment">/* allocate new space for the new history descriptor */</span>
<a name="l13509"></a>13509       <span class="keywordflow">if</span> (<a class="code" href="group__hsfunctionc.html#gac4638da3ec6d22fed1de595a7b7533eb">_history_entries</a> == 0) {
<a name="l13510"></a>13510          <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a> = (<a class="code" href="structHISTORY.html">HISTORY</a> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(<span class="keyword">sizeof</span>(<a class="code" href="structHISTORY.html">HISTORY</a>));
<a name="l13511"></a>13511          memset(<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="structHISTORY.html">HISTORY</a>));
<a name="l13512"></a>13512          <span class="keywordflow">if</span> (<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a> == NULL)
<a name="l13513"></a>13513             <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga8d2556d6b5d8902646a36e3aa7e71dc5">HS_NO_MEMORY</a>;
<a name="l13514"></a>13514 
<a name="l13515"></a>13515          <a class="code" href="group__hsfunctionc.html#gac4638da3ec6d22fed1de595a7b7533eb">_history_entries</a> = 1;
<a name="l13516"></a>13516          index = 0;
<a name="l13517"></a>13517       } <span class="keywordflow">else</span> {
<a name="l13518"></a>13518          <span class="comment">/* check if history already open */</span>
<a name="l13519"></a>13519          <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__hsfunctionc.html#gac4638da3ec6d22fed1de595a7b7533eb">_history_entries</a>; i++)
<a name="l13520"></a>13520             <span class="keywordflow">if</span> (<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[i].<a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a> == <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>)
<a name="l13521"></a>13521                <span class="keywordflow">break</span>;
<a name="l13522"></a>13522 
<a name="l13523"></a>13523          <span class="comment">/* if not found, create new one */</span>
<a name="l13524"></a>13524          <span class="keywordflow">if</span> (i == _history_entries) {
<a name="l13525"></a>13525             <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a> =
<a name="l13526"></a>13526                 (<a class="code" href="structHISTORY.html">HISTORY</a> *) realloc(<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>, <span class="keyword">sizeof</span>(<a class="code" href="structHISTORY.html">HISTORY</a>) * (_history_entries + 1));
<a name="l13527"></a>13527             memset(&amp;<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[_history_entries], 0, <span class="keyword">sizeof</span>(<a class="code" href="structHISTORY.html">HISTORY</a>));
<a name="l13528"></a>13528 
<a name="l13529"></a>13529             _history_entries++;
<a name="l13530"></a>13530             <span class="keywordflow">if</span> (<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a> == NULL) {
<a name="l13531"></a>13531                _history_entries--;
<a name="l13532"></a>13532                <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga8d2556d6b5d8902646a36e3aa7e71dc5">HS_NO_MEMORY</a>;
<a name="l13533"></a>13533             }
<a name="l13534"></a>13534          }
<a name="l13535"></a>13535          index = i;
<a name="l13536"></a>13536       }
<a name="l13537"></a>13537 
<a name="l13538"></a>13538       <span class="comment">/* assemble definition record header */</span>
<a name="l13539"></a>13539       rec.<a class="code" href="structHIST__RECORD.html#a455da5efe0b4d3844e387e440b86302d">record_type</a> = <a class="code" href="group__mhistoryh.html#ga53bf0d0c21b64cf42e4355c3919f6fa2">RT_DEF</a>;
<a name="l13540"></a>13540       rec.<a class="code" href="group__midasincludecode.html#gaf0b5331f4cf74267721acd101a7cdfef">event_id</a> = <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>;
<a name="l13541"></a>13541       rec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a> = <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(NULL);
<a name="l13542"></a>13542       rec.<a class="code" href="group__midasincludecode.html#ga93cecf8007191fbee0ec012e0eced9c1">data_size</a> = <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l13543"></a>13543       strncpy(event_name, <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>);
<a name="l13544"></a>13544 
<a name="l13545"></a>13545       <span class="comment">/* pad tag names with zeos */</span>
<a name="l13546"></a>13546       <span class="keywordflow">for</span> (i = 0; (<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>) i &lt; <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> / <span class="keyword">sizeof</span>(<a class="code" href="structTAG.html">TAG</a>); i++) {
<a name="l13547"></a>13547          len = strlen(tag[i].<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>);
<a name="l13548"></a>13548          memset(tag[i].<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a> + len, 0, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a> - len);
<a name="l13549"></a>13549       }
<a name="l13550"></a>13550 
<a name="l13551"></a>13551       <span class="comment">/* if history structure not set up, do so now */</span>
<a name="l13552"></a>13552       <span class="keywordflow">if</span> (!<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].hist_fh) {
<a name="l13553"></a>13553          <span class="comment">/* open history file */</span>
<a name="l13554"></a>13554          <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(rec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a>, <span class="stringliteral">&quot;hst&quot;</span>, O_CREAT | O_RDWR, &amp;fh);
<a name="l13555"></a>13555          <span class="keywordflow">if</span> (fh &lt; 0)
<a name="l13556"></a>13556             <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l13557"></a>13557 
<a name="l13558"></a>13558          <span class="comment">/* open index files */</span>
<a name="l13559"></a>13559          <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(rec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a>, <span class="stringliteral">&quot;idf&quot;</span>, O_CREAT | O_RDWR, &amp;fhd);
<a name="l13560"></a>13560          <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(rec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a>, <span class="stringliteral">&quot;idx&quot;</span>, O_CREAT | O_RDWR, &amp;fhi);
<a name="l13561"></a>13561          lseek(fh, 0, SEEK_END);
<a name="l13562"></a>13562          lseek(fhi, 0, SEEK_END);
<a name="l13563"></a>13563          lseek(fhd, 0, SEEK_END);
<a name="l13564"></a>13564 
<a name="l13565"></a>13565          <span class="comment">/* regenerate index if missing */</span>
<a name="l13566"></a>13566          <span class="keywordflow">if</span> (<a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fh) &gt; 0 &amp;&amp; <a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fhd) == 0) {
<a name="l13567"></a>13567             close(fh);
<a name="l13568"></a>13568             close(fhi);
<a name="l13569"></a>13569             close(fhd);
<a name="l13570"></a>13570             <a class="code" href="group__hsfunctionc.html#ga0e7b43f0ca043d04fb5716b8da02d41f">hs_gen_index</a>(rec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a>);
<a name="l13571"></a>13571             <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(rec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a>, <span class="stringliteral">&quot;hst&quot;</span>, O_RDWR, &amp;fh);
<a name="l13572"></a>13572             <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(rec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a>, <span class="stringliteral">&quot;idx&quot;</span>, O_RDWR, &amp;fhi);
<a name="l13573"></a>13573             <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(rec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a>, <span class="stringliteral">&quot;idf&quot;</span>, O_RDWR, &amp;fhd);
<a name="l13574"></a>13574             lseek(fh, 0, SEEK_END);
<a name="l13575"></a>13575             lseek(fhi, 0, SEEK_END);
<a name="l13576"></a>13576             lseek(fhd, 0, SEEK_END);
<a name="l13577"></a>13577          }
<a name="l13578"></a>13578 
<a name="l13579"></a>13579          tmb = localtime((<span class="keyword">const</span> time_t *) &amp;rec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a>);
<a name="l13580"></a>13580          tmb-&gt;tm_hour = tmb-&gt;tm_min = tmb-&gt;tm_sec = 0;
<a name="l13581"></a>13581 
<a name="l13582"></a>13582          <span class="comment">/* setup history structure */</span>
<a name="l13583"></a>13583          <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga79a69e6f7ee9000ef228992c63fa1b17">hist_fh</a> = fh;
<a name="l13584"></a>13584          <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga09233da06a1c7e441bd32f6230e80657">index_fh</a> = fhi;
<a name="l13585"></a>13585          <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#gacbcd08fbd4a1a660d097850b410d80ac">def_fh</a> = fhd;
<a name="l13586"></a>13586          <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga321719dd05a884e2bca6cba8ca5b47ea">def_offset</a> = <a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fh);
<a name="l13587"></a>13587          <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="structHISTORY.html#a322ce5ffb593fad70e8c2057d3835b5a">event_id</a> = <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>;
<a name="l13588"></a>13588          strcpy(<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].event_name, event_name);
<a name="l13589"></a>13589          <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga7bc815860465a4962450eb181ab6a6e3">base_time</a> = mktime(tmb);
<a name="l13590"></a>13590          <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#gaa4e80312dae8b75b2c05c697e6ee5951">n_tag</a> = <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> / <span class="keyword">sizeof</span>(<a class="code" href="structTAG.html">TAG</a>);
<a name="l13591"></a>13591          <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#gabef679759fcdaa44b47213a6ad972a77">tag</a> = (<a class="code" href="structTAG.html">TAG</a> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l13592"></a>13592          memcpy(<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].tag, tag, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l13593"></a>13593 
<a name="l13594"></a>13594          <span class="comment">/* search previous definition */</span>
<a name="l13595"></a>13595          n = <a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fhd) / <span class="keyword">sizeof</span>(def_rec);
<a name="l13596"></a>13596          def_rec.<a class="code" href="structDEF__RECORD.html#a9d9787264de717f2512af5e7d48e5a32">event_id</a> = 0;
<a name="l13597"></a>13597          <span class="keywordflow">for</span> (i = n - 1; i &gt;= 0; i--) {
<a name="l13598"></a>13598             lseek(fhd, i * <span class="keyword">sizeof</span>(def_rec), SEEK_SET);
<a name="l13599"></a>13599             <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhd, (<span class="keywordtype">char</span> *) &amp;def_rec, <span class="keyword">sizeof</span>(def_rec));
<a name="l13600"></a>13600             <span class="keywordflow">if</span> (def_rec.event_id == <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>)
<a name="l13601"></a>13601                <span class="keywordflow">break</span>;
<a name="l13602"></a>13602          }
<a name="l13603"></a>13603          lseek(fhd, 0, SEEK_END);
<a name="l13604"></a>13604 
<a name="l13605"></a>13605          <span class="comment">/* if definition found, compare it with new one */</span>
<a name="l13606"></a>13606          <span class="keywordflow">if</span> (def_rec.event_id == <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>) {
<a name="l13607"></a>13607             buffer = (<span class="keywordtype">char</span> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l13608"></a>13608             memset(buffer, 0, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l13609"></a>13609 
<a name="l13610"></a>13610             lseek(fh, def_rec.def_offset, SEEK_SET);
<a name="l13611"></a>13611             <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, (<span class="keywordtype">char</span> *) &amp;prev_rec, <span class="keyword">sizeof</span>(prev_rec));
<a name="l13612"></a>13612             <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, str, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>);
<a name="l13613"></a>13613             <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, buffer, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l13614"></a>13614             lseek(fh, 0, SEEK_END);
<a name="l13615"></a>13615 
<a name="l13616"></a>13616             <span class="keywordflow">if</span> (prev_rec.data_size != <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> ||
<a name="l13617"></a>13617                 strcmp(str, event_name) != 0 || memcmp(buffer, tag, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>) != 0) {
<a name="l13618"></a>13618                <span class="comment">/* write definition to history file */</span>
<a name="l13619"></a>13619                <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fh, (<span class="keywordtype">char</span> *) &amp;rec, <span class="keyword">sizeof</span>(rec));
<a name="l13620"></a>13620                <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fh, event_name, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>);
<a name="l13621"></a>13621                <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fh, (<span class="keywordtype">char</span> *) tag, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l13622"></a>13622 
<a name="l13623"></a>13623                <span class="comment">/* write index record */</span>
<a name="l13624"></a>13624                def_rec.event_id = <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>;
<a name="l13625"></a>13625                memcpy(def_rec.event_name, event_name, <span class="keyword">sizeof</span>(event_name));
<a name="l13626"></a>13626                def_rec.def_offset = <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga321719dd05a884e2bca6cba8ca5b47ea">def_offset</a>;
<a name="l13627"></a>13627                <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fhd, (<span class="keywordtype">char</span> *) &amp;def_rec, <span class="keyword">sizeof</span>(def_rec));
<a name="l13628"></a>13628             } <span class="keywordflow">else</span>
<a name="l13629"></a>13629                <span class="comment">/* definition identical, just remember old offset */</span>
<a name="l13630"></a>13630                <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga321719dd05a884e2bca6cba8ca5b47ea">def_offset</a> = def_rec.def_offset;
<a name="l13631"></a>13631 
<a name="l13632"></a>13632             <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(buffer);
<a name="l13633"></a>13633          } <span class="keywordflow">else</span> {
<a name="l13634"></a>13634             <span class="comment">/* write definition to history file */</span>
<a name="l13635"></a>13635             <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fh, (<span class="keywordtype">char</span> *) &amp;rec, <span class="keyword">sizeof</span>(rec));
<a name="l13636"></a>13636             <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fh, event_name, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>);
<a name="l13637"></a>13637             <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fh, (<span class="keywordtype">char</span> *) tag, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l13638"></a>13638 
<a name="l13639"></a>13639             <span class="comment">/* write definition index record */</span>
<a name="l13640"></a>13640             def_rec.event_id = <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>;
<a name="l13641"></a>13641             memcpy(def_rec.event_name, event_name, <span class="keyword">sizeof</span>(event_name));
<a name="l13642"></a>13642             def_rec.def_offset = <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga321719dd05a884e2bca6cba8ca5b47ea">def_offset</a>;
<a name="l13643"></a>13643             <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fhd, (<span class="keywordtype">char</span> *) &amp;def_rec, <span class="keyword">sizeof</span>(def_rec));
<a name="l13644"></a>13644          }
<a name="l13645"></a>13645       } <span class="keywordflow">else</span> {
<a name="l13646"></a>13646          fh = <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga79a69e6f7ee9000ef228992c63fa1b17">hist_fh</a>;
<a name="l13647"></a>13647          fhd = <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#gacbcd08fbd4a1a660d097850b410d80ac">def_fh</a>;
<a name="l13648"></a>13648 
<a name="l13649"></a>13649          <span class="comment">/* compare definition with previous definition */</span>
<a name="l13650"></a>13650          buffer = (<span class="keywordtype">char</span> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l13651"></a>13651          memset(buffer, 0, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l13652"></a>13652 
<a name="l13653"></a>13653          lseek(fh, <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].def_offset, SEEK_SET);
<a name="l13654"></a>13654          <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, (<span class="keywordtype">char</span> *) &amp;prev_rec, <span class="keyword">sizeof</span>(prev_rec));
<a name="l13655"></a>13655          <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, str, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>);
<a name="l13656"></a>13656          <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, buffer, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l13657"></a>13657 
<a name="l13658"></a>13658          lseek(fh, 0, SEEK_END);
<a name="l13659"></a>13659          lseek(fhd, 0, SEEK_END);
<a name="l13660"></a>13660 
<a name="l13661"></a>13661          <span class="keywordflow">if</span> (prev_rec.data_size != <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> ||
<a name="l13662"></a>13662              strcmp(str, event_name) != 0 || memcmp(buffer, tag, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>) != 0) {
<a name="l13663"></a>13663             <span class="comment">/* save new definition offset */</span>
<a name="l13664"></a>13664             <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga321719dd05a884e2bca6cba8ca5b47ea">def_offset</a> = <a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fh);
<a name="l13665"></a>13665 
<a name="l13666"></a>13666             <span class="comment">/* write definition to history file */</span>
<a name="l13667"></a>13667             <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fh, (<span class="keywordtype">char</span> *) &amp;rec, <span class="keyword">sizeof</span>(rec));
<a name="l13668"></a>13668             <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fh, event_name, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>);
<a name="l13669"></a>13669             <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fh, (<span class="keywordtype">char</span> *) tag, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l13670"></a>13670 
<a name="l13671"></a>13671             <span class="comment">/* write index record */</span>
<a name="l13672"></a>13672             def_rec.event_id = <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>;
<a name="l13673"></a>13673             memcpy(def_rec.event_name, event_name, <span class="keyword">sizeof</span>(event_name));
<a name="l13674"></a>13674             def_rec.def_offset = <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga321719dd05a884e2bca6cba8ca5b47ea">def_offset</a>;
<a name="l13675"></a>13675             <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fhd, (<span class="keywordtype">char</span> *) &amp;def_rec, <span class="keyword">sizeof</span>(def_rec));
<a name="l13676"></a>13676          }
<a name="l13677"></a>13677 
<a name="l13678"></a>13678          <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(buffer);
<a name="l13679"></a>13679       }
<a name="l13680"></a>13680 
<a name="l13681"></a>13681    }
<a name="l13682"></a>13682 
<a name="l13683"></a>13683    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>;
<a name="l13684"></a>13684 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaa0adfd626d570a1e37a01f2f8b8afdfd"></a><!-- doxytag: member="midas.c::hs_dump" ref="gaa0adfd626d570a1e37a01f2f8b8afdfd" args="(DWORD event_id, DWORD start_time, DWORD end_time, DWORD interval, BOOL binary_time)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> hs_dump </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>event_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>start_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>end_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>interval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td>
          <td class="paramname"> <em>binary_time</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l14695">14695</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="generic_8c_source.html#l00091">abs</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="v1724__module_8c_source.html#l00025">data_buffer</a>, <a class="el" href="odb_8c_source.html#l06308">db_sprintf()</a>, <a class="el" href="midas_8h_source.html#l01093">HS_FILE_ERROR</a>, <a class="el" href="midas_8h_source.html#l01094">HS_NO_MEMORY</a>, <a class="el" href="midas_8c_source.html#l13271">hs_open_file()</a>, <a class="el" href="midas_8c_source.html#l13394">hs_search_file()</a>, <a class="el" href="midas_8h_source.html#l01092">HS_SUCCESS</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="midas_8h_source.html#l01755">M_FREE</a>, <a class="el" href="midas_8h_source.html#l01753">M_MALLOC</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l01444">TAG::n_data</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="mgd_8c_source.html#l01505">offset</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00256">read</a>, <a class="el" href="midas_8c_source.html#l08162">rpc_tid_size()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="mhist_8c_source.html#l00102">tag</a>, <a class="el" href="msystem_8h_source.html#l00369">TELL</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="midas_8h_source.html#l01569">INDEX_RECORD::time</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, and <a class="el" href="mana_8cpp_source.html#l00675">type</a>.</p>

<p>Referenced by <a class="el" href="mhist_8c_source.html#l00455">main()</a>, and <a class="el" href="mhist_8c_source.html#l00078">tmp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14699"></a>14699          : <a class="code" href="group__msectionh.html#ga8b0e0772782f2f934897ad72847bb438">hs_dump</a>
<a name="l14700"></a>14700 
<a name="l14701"></a>14701   Purpose: Display <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> <span class="keywordflow">for</span> a given <span class="keyword">event</span> at stdout. The <a class="code" href="scs__210_8c.html#a859e9f68c1c035565d6729c59fd894ae">output</a>
<a name="l14702"></a>14702            can be redirected to be <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a> <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> Excel <span class="keywordflow">for</span> example.
<a name="l14703"></a>14703 
<a name="l14704"></a>14704   Input:
<a name="l14705"></a>14705     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>         Event <a class="code" href="jorway73a_8h.html#a4bfe115debc7f472dd7dfe4ef9679ca0">ID</a>
<a name="l14706"></a>14706     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>       Starting Date/Time
<a name="l14707"></a>14707     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  end_time         End Date/Time
<a name="l14708"></a>14708     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  <a class="code" href="mscbutil_8c.html#ad856acfe9ce335571b00a73df5e23e6b">interval</a>         Minimum <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> seconds between reported
<a name="l14709"></a>14709                             events. Can be used to skip events
<a name="l14710"></a>14710     <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>   <a class="code" href="mhist_8c.html#ab8807066c6d3cac932af3c18621e04d0">binary_time</a>      Display <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a> stamp
<a name="l14711"></a>14711   Output:
<a name="l14712"></a>14712     &lt;screen <a class="code" href="scs__210_8c.html#a859e9f68c1c035565d6729c59fd894ae">output</a>&gt;
<a name="l14713"></a>14713 
<a name="l14714"></a>14714   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l14715"></a>14715     <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>              Successful completion
<a name="l14716"></a>14716     <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>           Cannot open <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file
<a name="l14717"></a>14717 
<a name="l14718"></a>14718 \********************************************************************/
<a name="l14719"></a>14719 {
<a name="l14720"></a>14720    <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> prev_time, last_irec_time;
<a name="l14721"></a>14721    <span class="keywordtype">int</span> fh, fhd, fhi;
<a name="l14722"></a>14722    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, delta, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, n_tag = 0, old_n_tag = 0;
<a name="l14723"></a>14723    <a class="code" href="structINDEX__RECORD.html">INDEX_RECORD</a> irec;
<a name="l14724"></a>14724    <a class="code" href="structHIST__RECORD.html">HIST_RECORD</a> rec, drec;
<a name="l14725"></a>14725    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> old_def_offset, <a class="code" href="mgd_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a>;
<a name="l14726"></a>14726    <a class="code" href="structTAG.html">TAG</a> *<a class="code" href="mhist_8c.html#a27ce05f73a16e6abc070da1007833b9b">tag</a> = NULL, *old_tag = NULL;
<a name="l14727"></a>14727    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>], <a class="code" href="v1724__module_8c.html#ab4c1e3e1d0abf76b1eef9c2841ee27cd">data_buffer</a>[10000];
<a name="l14728"></a>14728    <span class="keyword">struct </span>tm *tms;
<a name="l14729"></a>14729 
<a name="l14730"></a>14730    <span class="comment">/* if not time given, use present to one hour in past */</span>
<a name="l14731"></a>14731    <span class="keywordflow">if</span> (<a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a> == 0)
<a name="l14732"></a>14732       <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a> = <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(NULL) - 3600;
<a name="l14733"></a>14733    <span class="keywordflow">if</span> (end_time == 0)
<a name="l14734"></a>14734       end_time = <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(NULL);
<a name="l14735"></a>14735 
<a name="l14736"></a>14736    <span class="comment">/* search history file for start_time */</span>
<a name="l14737"></a>14737    status = <a class="code" href="group__hsfunctionc.html#ga1ebb4cc3c2f54b895e14c665db26531d">hs_search_file</a>(&amp;<a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>, 1);
<a name="l14738"></a>14738    <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>) {
<a name="l14739"></a>14739       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_dump&quot;</span>, <span class="stringliteral">&quot;cannot find recent history file&quot;</span>);
<a name="l14740"></a>14740       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14741"></a>14741    }
<a name="l14742"></a>14742 
<a name="l14743"></a>14743    <span class="comment">/* open history and definition files */</span>
<a name="l14744"></a>14744    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(<a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>, <span class="stringliteral">&quot;hst&quot;</span>, O_RDONLY, &amp;fh);
<a name="l14745"></a>14745    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(<a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>, <span class="stringliteral">&quot;idf&quot;</span>, O_RDONLY, &amp;fhd);
<a name="l14746"></a>14746    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(<a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>, <span class="stringliteral">&quot;idx&quot;</span>, O_RDONLY, &amp;fhi);
<a name="l14747"></a>14747    <span class="keywordflow">if</span> (fh &lt; 0 || fhd &lt; 0 || fhi &lt; 0) {
<a name="l14748"></a>14748       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_dump&quot;</span>, <span class="stringliteral">&quot;cannot open index files&quot;</span>);
<a name="l14749"></a>14749       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14750"></a>14750    }
<a name="l14751"></a>14751 
<a name="l14752"></a>14752    <span class="comment">/* search record closest to start time */</span>
<a name="l14753"></a>14753    lseek(fhi, 0, SEEK_END);
<a name="l14754"></a>14754    delta = (<a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fhi) / <span class="keyword">sizeof</span>(irec)) / 2;
<a name="l14755"></a>14755    lseek(fhi, delta * <span class="keyword">sizeof</span>(irec), SEEK_SET);
<a name="l14756"></a>14756    <span class="keywordflow">do</span> {
<a name="l14757"></a>14757       delta = (int) (<a class="code" href="generic_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(delta) / 2.0 + 0.5);
<a name="l14758"></a>14758       <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhi, (<span class="keywordtype">char</span> *) &amp;irec, <span class="keyword">sizeof</span>(irec));
<a name="l14759"></a>14759       <span class="keywordflow">if</span> (irec.time &gt; <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>)
<a name="l14760"></a>14760          delta = -delta;
<a name="l14761"></a>14761 
<a name="l14762"></a>14762       i = lseek(fhi, (delta - 1) * <span class="keyword">sizeof</span>(irec), SEEK_CUR);
<a name="l14763"></a>14763    } <span class="keywordflow">while</span> (<a class="code" href="generic_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(delta) &gt; 1 &amp;&amp; irec.time != <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>);
<a name="l14764"></a>14764    <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhi, (<span class="keywordtype">char</span> *) &amp;irec, <span class="keyword">sizeof</span>(irec));
<a name="l14765"></a>14765    <span class="keywordflow">if</span> (irec.time &gt; <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>)
<a name="l14766"></a>14766       delta = -<a class="code" href="generic_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(delta);
<a name="l14767"></a>14767 
<a name="l14768"></a>14768    i = <a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fhi) + (delta - 1) * <span class="keyword">sizeof</span>(irec);
<a name="l14769"></a>14769    <span class="keywordflow">if</span> (i &lt;= 0)
<a name="l14770"></a>14770       lseek(fhi, 0, SEEK_SET);
<a name="l14771"></a>14771    <span class="keywordflow">else</span>
<a name="l14772"></a>14772       lseek(fhi, (delta - 1) * <span class="keyword">sizeof</span>(irec), SEEK_CUR);
<a name="l14773"></a>14773    <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhi, (<span class="keywordtype">char</span> *) &amp;irec, <span class="keyword">sizeof</span>(irec));
<a name="l14774"></a>14774 
<a name="l14775"></a>14775    <span class="comment">/* read records, skip wrong IDs */</span>
<a name="l14776"></a>14776    old_def_offset = -1;
<a name="l14777"></a>14777    prev_time = 0;
<a name="l14778"></a>14778    last_irec_time = 0;
<a name="l14779"></a>14779    <span class="keywordflow">do</span> {
<a name="l14780"></a>14780       <span class="keywordflow">if</span> (irec.time &lt; last_irec_time) {
<a name="l14781"></a>14781          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_dump&quot;</span>,
<a name="l14782"></a>14782                 <span class="stringliteral">&quot;corrupted history data: time does not increase: %d -&gt; %d&quot;</span>,
<a name="l14783"></a>14783                 last_irec_time, irec.time);
<a name="l14784"></a>14784          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14785"></a>14785       }
<a name="l14786"></a>14786       last_irec_time = irec.time;
<a name="l14787"></a>14787       <span class="keywordflow">if</span> (irec.event_id == <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a> &amp;&amp; irec.time &lt;= end_time &amp;&amp; irec.time &gt;= <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>) {
<a name="l14788"></a>14788          <span class="keywordflow">if</span> (irec.time &gt;= prev_time + <a class="code" href="mscbutil_8c.html#ad856acfe9ce335571b00a73df5e23e6b">interval</a>) {
<a name="l14789"></a>14789             prev_time = irec.time;
<a name="l14790"></a>14790             lseek(fh, irec.offset, SEEK_SET);
<a name="l14791"></a>14791             <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, (<span class="keywordtype">char</span> *) &amp;rec, <span class="keyword">sizeof</span>(rec));
<a name="l14792"></a>14792 
<a name="l14793"></a>14793             <span class="comment">/* if definition changed, read new definition */</span>
<a name="l14794"></a>14794             <span class="keywordflow">if</span> ((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) rec.def_offset != old_def_offset) {
<a name="l14795"></a>14795                lseek(fh, rec.def_offset, SEEK_SET);
<a name="l14796"></a>14796                <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, (<span class="keywordtype">char</span> *) &amp;drec, <span class="keyword">sizeof</span>(drec));
<a name="l14797"></a>14797                <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, str, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>);
<a name="l14798"></a>14798 
<a name="l14799"></a>14799                <span class="keywordflow">if</span> (tag == NULL)
<a name="l14800"></a>14800                   tag = (<a class="code" href="structTAG.html">TAG</a> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(drec.data_size);
<a name="l14801"></a>14801                <span class="keywordflow">else</span>
<a name="l14802"></a>14802                   tag = (<a class="code" href="structTAG.html">TAG</a> *) realloc(tag, drec.data_size);
<a name="l14803"></a>14803                <span class="keywordflow">if</span> (tag == NULL)
<a name="l14804"></a>14804                   <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga8d2556d6b5d8902646a36e3aa7e71dc5">HS_NO_MEMORY</a>;
<a name="l14805"></a>14805                <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, (<span class="keywordtype">char</span> *) tag, drec.data_size);
<a name="l14806"></a>14806                n_tag = drec.data_size / <span class="keyword">sizeof</span>(<a class="code" href="structTAG.html">TAG</a>);
<a name="l14807"></a>14807 
<a name="l14808"></a>14808                <span class="comment">/* print tag names if definition has changed */</span>
<a name="l14809"></a>14809                <span class="keywordflow">if</span> (old_tag == NULL || old_n_tag != n_tag ||
<a name="l14810"></a>14810                    memcmp(old_tag, tag, drec.data_size) != 0) {
<a name="l14811"></a>14811                   printf(<span class="stringliteral">&quot;Date\t&quot;</span>);
<a name="l14812"></a>14812                   <span class="keywordflow">for</span> (i = 0; i &lt; n_tag; i++) {
<a name="l14813"></a>14813                      <span class="keywordflow">if</span> (tag[i].n_data == 1 || tag[i].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>)
<a name="l14814"></a>14814                         printf(<span class="stringliteral">&quot;%s\t&quot;</span>, tag[i].<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>);
<a name="l14815"></a>14815                      <span class="keywordflow">else</span>
<a name="l14816"></a>14816                         <span class="keywordflow">for</span> (j = 0; j &lt; (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) tag[i].n_data; j++)
<a name="l14817"></a>14817                            printf(<span class="stringliteral">&quot;%s%d\t&quot;</span>, tag[i].<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>, j);
<a name="l14818"></a>14818                   }
<a name="l14819"></a>14819                   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l14820"></a>14820 
<a name="l14821"></a>14821                   <span class="keywordflow">if</span> (old_tag == NULL)
<a name="l14822"></a>14822                      old_tag = (<a class="code" href="structTAG.html">TAG</a> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(drec.data_size);
<a name="l14823"></a>14823                   <span class="keywordflow">else</span>
<a name="l14824"></a>14824                      old_tag = (<a class="code" href="structTAG.html">TAG</a> *) realloc(old_tag, drec.data_size);
<a name="l14825"></a>14825                   memcpy(old_tag, tag, drec.data_size);
<a name="l14826"></a>14826                   old_n_tag = n_tag;
<a name="l14827"></a>14827                }
<a name="l14828"></a>14828 
<a name="l14829"></a>14829                old_def_offset = rec.def_offset;
<a name="l14830"></a>14830                lseek(fh, irec.offset + <span class="keyword">sizeof</span>(rec), SEEK_SET);
<a name="l14831"></a>14831             }
<a name="l14832"></a>14832 
<a name="l14833"></a>14833             <span class="comment">/* print time from header */</span>
<a name="l14834"></a>14834             <span class="keywordflow">if</span> (<a class="code" href="mhist_8c.html#ab8807066c6d3cac932af3c18621e04d0">binary_time</a>)
<a name="l14835"></a>14835                printf(<span class="stringliteral">&quot;%li &quot;</span>, irec.time);
<a name="l14836"></a>14836             <span class="keywordflow">else</span> {
<a name="l14837"></a>14837                sprintf(str, <span class="stringliteral">&quot;%s&quot;</span>, ctime((<span class="keyword">const</span> time_t *) &amp;irec.time) + 4);
<a name="l14838"></a>14838                str[20] = <span class="charliteral">&apos;\t&apos;</span>;
<a name="l14839"></a>14839                printf(str);
<a name="l14840"></a>14840             }
<a name="l14841"></a>14841 
<a name="l14842"></a>14842             <span class="comment">/* read data */</span>
<a name="l14843"></a>14843             <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, data_buffer, rec.data_size);
<a name="l14844"></a>14844 
<a name="l14845"></a>14845             <span class="comment">/* interprete data from tag definition */</span>
<a name="l14846"></a>14846             offset = 0;
<a name="l14847"></a>14847             <span class="keywordflow">for</span> (i = 0; i &lt; n_tag; i++) {
<a name="l14848"></a>14848                <span class="comment">/* strings have a length of n_data */</span>
<a name="l14849"></a>14849                <span class="keywordflow">if</span> (tag[i].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>) {
<a name="l14850"></a>14850                   printf(<span class="stringliteral">&quot;%s\t&quot;</span>, data_buffer + offset);
<a name="l14851"></a>14851                   offset += tag[i].<a class="code" href="group__midasincludecode.html#gaec010a11e0792b46f71ba64fae6f44e8">n_data</a>;
<a name="l14852"></a>14852                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag[i].n_data == 1) {
<a name="l14853"></a>14853                   <span class="comment">/* non-array data */</span>
<a name="l14854"></a>14854                   <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(str, data_buffer + offset, <a class="code" href="group__msectionh.html#gaa0bf5cc257f83e9a7f3936738fe009f3">rpc_tid_size</a>(tag[i].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>), 0,
<a name="l14855"></a>14855                              tag[i].type);
<a name="l14856"></a>14856                   printf(<span class="stringliteral">&quot;%s\t&quot;</span>, str);
<a name="l14857"></a>14857                   offset += <a class="code" href="group__msectionh.html#gaa0bf5cc257f83e9a7f3936738fe009f3">rpc_tid_size</a>(tag[i].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>);
<a name="l14858"></a>14858                } <span class="keywordflow">else</span>
<a name="l14859"></a>14859                   <span class="comment">/* loop over array data */</span>
<a name="l14860"></a>14860                   <span class="keywordflow">for</span> (j = 0; j &lt; (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) tag[i].n_data; j++) {
<a name="l14861"></a>14861                      <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(str, data_buffer + offset, <a class="code" href="group__msectionh.html#gaa0bf5cc257f83e9a7f3936738fe009f3">rpc_tid_size</a>(tag[i].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>), 0,
<a name="l14862"></a>14862                                 tag[i].type);
<a name="l14863"></a>14863                      printf(<span class="stringliteral">&quot;%s\t&quot;</span>, str);
<a name="l14864"></a>14864                      offset += <a class="code" href="group__msectionh.html#gaa0bf5cc257f83e9a7f3936738fe009f3">rpc_tid_size</a>(tag[i].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>);
<a name="l14865"></a>14865                   }
<a name="l14866"></a>14866             }
<a name="l14867"></a>14867             printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l14868"></a>14868          }
<a name="l14869"></a>14869       }
<a name="l14870"></a>14870 
<a name="l14871"></a>14871       <span class="comment">/* read next index record */</span>
<a name="l14872"></a>14872       i = <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhi, (<span class="keywordtype">char</span> *) &amp;irec, <span class="keyword">sizeof</span>(irec));
<a name="l14873"></a>14873 
<a name="l14874"></a>14874       <span class="comment">/* end of file: search next history file */</span>
<a name="l14875"></a>14875       <span class="keywordflow">if</span> (i &lt;= 0) {
<a name="l14876"></a>14876          close(fh);
<a name="l14877"></a>14877          close(fhd);
<a name="l14878"></a>14878          close(fhi);
<a name="l14879"></a>14879 
<a name="l14880"></a>14880          <span class="comment">/* advance one day */</span>
<a name="l14881"></a>14881          tms = localtime((<span class="keyword">const</span> time_t *) &amp;last_irec_time);
<a name="l14882"></a>14882          tms-&gt;tm_hour = tms-&gt;tm_min = tms-&gt;tm_sec = 0;
<a name="l14883"></a>14883          last_irec_time = mktime(tms);
<a name="l14884"></a>14884 
<a name="l14885"></a>14885          last_irec_time += 3600 * 24;
<a name="l14886"></a>14886          <span class="keywordflow">if</span> (last_irec_time &gt; end_time)
<a name="l14887"></a>14887             <span class="keywordflow">break</span>;
<a name="l14888"></a>14888 
<a name="l14889"></a>14889          <span class="comment">/* search next file */</span>
<a name="l14890"></a>14890          status = <a class="code" href="group__hsfunctionc.html#ga1ebb4cc3c2f54b895e14c665db26531d">hs_search_file</a>(&amp;last_irec_time, 1);
<a name="l14891"></a>14891          <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>)
<a name="l14892"></a>14892             <span class="keywordflow">break</span>;
<a name="l14893"></a>14893 
<a name="l14894"></a>14894          <span class="comment">/* open history and definition files */</span>
<a name="l14895"></a>14895          <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(last_irec_time, <span class="stringliteral">&quot;hst&quot;</span>, O_RDONLY, &amp;fh);
<a name="l14896"></a>14896          <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(last_irec_time, <span class="stringliteral">&quot;idf&quot;</span>, O_RDONLY, &amp;fhd);
<a name="l14897"></a>14897          <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(last_irec_time, <span class="stringliteral">&quot;idx&quot;</span>, O_RDONLY, &amp;fhi);
<a name="l14898"></a>14898          <span class="keywordflow">if</span> (fh &lt; 0 || fhd &lt; 0 || fhi &lt; 0) {
<a name="l14899"></a>14899             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_dump&quot;</span>, <span class="stringliteral">&quot;cannot open index files&quot;</span>);
<a name="l14900"></a>14900             <span class="keywordflow">break</span>;
<a name="l14901"></a>14901          }
<a name="l14902"></a>14902 
<a name="l14903"></a>14903          <span class="comment">/* read first record */</span>
<a name="l14904"></a>14904          i = <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhi, (<span class="keywordtype">char</span> *) &amp;irec, <span class="keyword">sizeof</span>(irec));
<a name="l14905"></a>14905          <span class="keywordflow">if</span> (i &lt;= 0)
<a name="l14906"></a>14906             <span class="keywordflow">break</span>;
<a name="l14907"></a>14907 
<a name="l14908"></a>14908          <span class="comment">/* old definition becomes invalid */</span>
<a name="l14909"></a>14909          old_def_offset = -1;
<a name="l14910"></a>14910       }
<a name="l14911"></a>14911    } <span class="keywordflow">while</span> (irec.time &lt; end_time);
<a name="l14912"></a>14912 
<a name="l14913"></a>14913    <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(tag);
<a name="l14914"></a>14914    <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(old_tag);
<a name="l14915"></a>14915    close(fh);
<a name="l14916"></a>14916    close(fhd);
<a name="l14917"></a>14917    close(fhi);
<a name="l14918"></a>14918 
<a name="l14919"></a>14919    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>;
<a name="l14920"></a>14920 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga318b7fb581951de4e22c1e905cff8253"></a><!-- doxytag: member="midas.c::hs_enum_events" ref="ga318b7fb581951de4e22c1e905cff8253" args="(DWORD ltime, char *event_name, DWORD *name_size, INT event_id[], DWORD *id_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> hs_enum_events </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>ltime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>event_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&nbsp;</td>
          <td class="paramname"> <em>name_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>event_id</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&nbsp;</td>
          <td class="paramname"> <em>id_size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l13818">13818</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l01093">HS_FILE_ERROR</a>, <a class="el" href="midas_8h_source.html#l01094">HS_NO_MEMORY</a>, <a class="el" href="midas_8c_source.html#l13271">hs_open_file()</a>, <a class="el" href="midas_8c_source.html#l13394">hs_search_file()</a>, <a class="el" href="midas_8h_source.html#l01092">HS_SUCCESS</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00256">read</a>, <a class="el" href="midas_8c_source.html#l09810">rpc_call()</a>, <a class="el" href="mrpc_8h_source.html#l00176">RPC_HS_ENUM_EVENTS</a>, <a class="el" href="midas_8c_source.html#l09022">rpc_is_remote()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="mhist_8c_source.html#l00238">display_vars()</a>, <a class="el" href="mhist_8c_source.html#l00158">query_params()</a>, and <a class="el" href="mserver_8c_source.html#l00534">rpc_server_dispatch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l13822"></a>13822          : <a class="code" href="group__msectionh.html#ga30bdb0daec584d9ddea0af5e99c5ceb1">hs_enum_events</a>
<a name="l13823"></a>13823 
<a name="l13824"></a>13824   Purpose: Enumerate events <span class="keywordflow">for</span> a given date
<a name="l13825"></a>13825 
<a name="l13826"></a>13826   Input:
<a name="l13827"></a>13827     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  ltime            Date at which events should be enumerated
<a name="l13828"></a>13828 
<a name="l13829"></a>13829   Output:
<a name="l13830"></a>13830     <span class="keywordtype">char</span>   *event_name      Array containing <span class="keyword">event</span> names
<a name="l13831"></a>13831     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  *name_size       Size of <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a> array
<a name="l13832"></a>13832     <span class="keywordtype">char</span>   *<a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>        Array containing <span class="keyword">event</span> IDs
<a name="l13833"></a>13833     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  *id_size         Size of <a class="code" href="jorway73a_8h.html#a4bfe115debc7f472dd7dfe4ef9679ca0">ID</a> array
<a name="l13834"></a>13834 
<a name="l13835"></a>13835   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l13836"></a>13836     <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>              Successful completion
<a name="l13837"></a>13837     HS_NO_MEMEORY           Out of memory
<a name="l13838"></a>13838     <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>           Cannot open <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file
<a name="l13839"></a>13839 
<a name="l13840"></a>13840 \********************************************************************/
<a name="l13841"></a>13841 {
<a name="l13842"></a>13842    <span class="keywordtype">int</span> fh, fhd;
<a name="l13843"></a>13843    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>;
<a name="l13844"></a>13844    <a class="code" href="structDEF__RECORD.html">DEF_RECORD</a> def_rec;
<a name="l13845"></a>13845 
<a name="l13846"></a>13846    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga0090933001e7e1ddd52ed3f321bea957">rpc_is_remote</a>())
<a name="l13847"></a>13847       <span class="keywordflow">return</span> <a class="code" href="group__msectionh.html#ga6bf1d13a0c49a3f7a02650885937b5e7">rpc_call</a>(<a class="code" href="group__mrpcdefineh.html#gac43c0f6b242f855a6e30335913ef2de9">RPC_HS_ENUM_EVENTS</a>, ltime, event_name, name_size, <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>,
<a name="l13848"></a>13848                       id_size);
<a name="l13849"></a>13849 
<a name="l13850"></a>13850    <span class="comment">/* search latest history file */</span>
<a name="l13851"></a>13851    status = <a class="code" href="group__hsfunctionc.html#ga1ebb4cc3c2f54b895e14c665db26531d">hs_search_file</a>(&amp;ltime, -1);
<a name="l13852"></a>13852    <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>) {
<a name="l13853"></a>13853       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_enum_events&quot;</span>, <span class="stringliteral">&quot;cannot find recent history file&quot;</span>);
<a name="l13854"></a>13854       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l13855"></a>13855    }
<a name="l13856"></a>13856 
<a name="l13857"></a>13857    <span class="comment">/* open history and definition files */</span>
<a name="l13858"></a>13858    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(ltime, <span class="stringliteral">&quot;hst&quot;</span>, O_RDONLY, &amp;fh);
<a name="l13859"></a>13859    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(ltime, <span class="stringliteral">&quot;idf&quot;</span>, O_RDONLY, &amp;fhd);
<a name="l13860"></a>13860    <span class="keywordflow">if</span> (fh &lt; 0 || fhd &lt; 0) {
<a name="l13861"></a>13861       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_enum_events&quot;</span>, <span class="stringliteral">&quot;cannot open index files&quot;</span>);
<a name="l13862"></a>13862       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l13863"></a>13863    }
<a name="l13864"></a>13864    lseek(fhd, 0, SEEK_SET);
<a name="l13865"></a>13865 
<a name="l13866"></a>13866    <span class="comment">/* loop over definition index file */</span>
<a name="l13867"></a>13867    n = 0;
<a name="l13868"></a>13868    <span class="keywordflow">do</span> {
<a name="l13869"></a>13869       <span class="comment">/* read event definition */</span>
<a name="l13870"></a>13870       j = <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhd, (<span class="keywordtype">char</span> *) &amp;def_rec, <span class="keyword">sizeof</span>(def_rec));
<a name="l13871"></a>13871       <span class="keywordflow">if</span> (j &lt; (<span class="keywordtype">int</span>) <span class="keyword">sizeof</span>(def_rec))
<a name="l13872"></a>13872          <span class="keywordflow">break</span>;
<a name="l13873"></a>13873 
<a name="l13874"></a>13874       <span class="comment">/* look for existing entry for this event id */</span>
<a name="l13875"></a>13875       <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l13876"></a>13876          <span class="keywordflow">if</span> (<a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>[i] == (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) def_rec.event_id) {
<a name="l13877"></a>13877             strcpy(event_name + i * <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>, def_rec.event_name);
<a name="l13878"></a>13878             <span class="keywordflow">break</span>;
<a name="l13879"></a>13879          }
<a name="l13880"></a>13880 
<a name="l13881"></a>13881       <span class="comment">/* new entry found */</span>
<a name="l13882"></a>13882       <span class="keywordflow">if</span> (i == n) {
<a name="l13883"></a>13883          <span class="keywordflow">if</span> (i * <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a> &gt; (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) * name_size || i * <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) &gt; (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) * id_size) {
<a name="l13884"></a>13884             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_enum_events&quot;</span>, <span class="stringliteral">&quot;index buffer too small&quot;</span>);
<a name="l13885"></a>13885             close(fh);
<a name="l13886"></a>13886             close(fhd);
<a name="l13887"></a>13887             <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga8d2556d6b5d8902646a36e3aa7e71dc5">HS_NO_MEMORY</a>;
<a name="l13888"></a>13888          }
<a name="l13889"></a>13889 
<a name="l13890"></a>13890          <span class="comment">/* copy definition record */</span>
<a name="l13891"></a>13891          strcpy(event_name + i * <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>, def_rec.event_name);
<a name="l13892"></a>13892          <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>[i] = def_rec.event_id;
<a name="l13893"></a>13893          n++;
<a name="l13894"></a>13894       }
<a name="l13895"></a>13895    } <span class="keywordflow">while</span> (<a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l13896"></a>13896 
<a name="l13897"></a>13897    close(fh);
<a name="l13898"></a>13898    close(fhd);
<a name="l13899"></a>13899    *name_size = n * <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>;
<a name="l13900"></a>13900    *id_size = n * <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>);
<a name="l13901"></a>13901 
<a name="l13902"></a>13902    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>;
<a name="l13903"></a>13903 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga7e10a97aa15121bf1337e1bd6ad20bc6"></a><!-- doxytag: member="midas.c::hs_enum_vars" ref="ga7e10a97aa15121bf1337e1bd6ad20bc6" args="(DWORD ltime, DWORD event_id, char *var_name, DWORD *size, DWORD *var_n, DWORD *n_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> hs_enum_vars </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>ltime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>event_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>var_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&nbsp;</td>
          <td class="paramname"> <em>var_n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&nbsp;</td>
          <td class="paramname"> <em>n_size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l14134">14134</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l01564">DEF_RECORD::def_offset</a>, <a class="el" href="midas_8h_source.html#l01562">DEF_RECORD::event_id</a>, <a class="el" href="midas_8h_source.html#l01093">HS_FILE_ERROR</a>, <a class="el" href="midas_8h_source.html#l01094">HS_NO_MEMORY</a>, <a class="el" href="midas_8c_source.html#l13271">hs_open_file()</a>, <a class="el" href="midas_8c_source.html#l13394">hs_search_file()</a>, <a class="el" href="midas_8h_source.html#l01092">HS_SUCCESS</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="midas_8h_source.html#l01755">M_FREE</a>, <a class="el" href="midas_8h_source.html#l01753">M_MALLOC</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00256">read</a>, <a class="el" href="midas_8c_source.html#l09810">rpc_call()</a>, <a class="el" href="mrpc_8h_source.html#l00178">RPC_HS_ENUM_VARS</a>, <a class="el" href="midas_8c_source.html#l09022">rpc_is_remote()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="mhist_8c_source.html#l00102">tag</a>, and <a class="el" href="msystem_8h_source.html#l00369">TELL</a>.</p>

<p>Referenced by <a class="el" href="mhist_8c_source.html#l00238">display_vars()</a>, <a class="el" href="mhist_8c_source.html#l00158">query_params()</a>, and <a class="el" href="mserver_8c_source.html#l00534">rpc_server_dispatch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14138"></a>14138          : <a class="code" href="group__msectionh.html#ga0e2ab7218eaffd8953bccf70ecb29fa4">hs_enum_vars</a>
<a name="l14139"></a>14139 
<a name="l14140"></a>14140   Purpose: Enumerate <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a> tags <span class="keywordflow">for</span> a given date <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> <span class="keyword">event</span> <span class="keywordtype">id</span>
<a name="l14141"></a>14141 
<a name="l14142"></a>14142   Input:
<a name="l14143"></a>14143     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  ltime            Date at which tags should be enumerated
<a name="l14144"></a>14144     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>         Event <a class="code" href="jorway73a_8h.html#a4bfe115debc7f472dd7dfe4ef9679ca0">ID</a>
<a name="l14145"></a>14145 
<a name="l14146"></a>14146   Output:
<a name="l14147"></a>14147     <span class="keywordtype">char</span>   *<a class="code" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a>        Array containing <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a> names
<a name="l14148"></a>14148     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  *<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>            Size of <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a> array
<a name="l14149"></a>14149     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  *var_n           Array <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> of <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a>
<a name="l14150"></a>14150     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  *n_size          Size of <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> array
<a name="l14151"></a>14151 
<a name="l14152"></a>14152   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l14153"></a>14153     <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>              Successful completion
<a name="l14154"></a>14154     HS_NO_MEMEORY           Out of memory
<a name="l14155"></a>14155     <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>           Cannot open <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file
<a name="l14156"></a>14156 
<a name="l14157"></a>14157 \********************************************************************/
<a name="l14158"></a>14158 {
<a name="l14159"></a>14159    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l14160"></a>14160    <span class="keywordtype">int</span> fh, fhd;
<a name="l14161"></a>14161    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l14162"></a>14162    <a class="code" href="structDEF__RECORD.html">DEF_RECORD</a> def_rec;
<a name="l14163"></a>14163    <a class="code" href="structHIST__RECORD.html">HIST_RECORD</a> rec;
<a name="l14164"></a>14164    <a class="code" href="structTAG.html">TAG</a> *<a class="code" href="mhist_8c.html#a27ce05f73a16e6abc070da1007833b9b">tag</a>;
<a name="l14165"></a>14165 
<a name="l14166"></a>14166    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga0090933001e7e1ddd52ed3f321bea957">rpc_is_remote</a>())
<a name="l14167"></a>14167       <span class="keywordflow">return</span> <a class="code" href="group__msectionh.html#ga6bf1d13a0c49a3f7a02650885937b5e7">rpc_call</a>(<a class="code" href="group__mrpcdefineh.html#ga03b69c70087647cbea450ba968bcec9b">RPC_HS_ENUM_VARS</a>, ltime, <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>, <a class="code" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l14168"></a>14168 
<a name="l14169"></a>14169    <span class="comment">/* search latest history file */</span>
<a name="l14170"></a>14170    status = <a class="code" href="group__hsfunctionc.html#ga1ebb4cc3c2f54b895e14c665db26531d">hs_search_file</a>(&amp;ltime, -1);
<a name="l14171"></a>14171    <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>) {
<a name="l14172"></a>14172       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_enum_vars&quot;</span>, <span class="stringliteral">&quot;cannot find recent history file&quot;</span>);
<a name="l14173"></a>14173       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14174"></a>14174    }
<a name="l14175"></a>14175 
<a name="l14176"></a>14176    <span class="comment">/* open history and definition files */</span>
<a name="l14177"></a>14177    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(ltime, <span class="stringliteral">&quot;hst&quot;</span>, O_RDONLY, &amp;fh);
<a name="l14178"></a>14178    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(ltime, <span class="stringliteral">&quot;idf&quot;</span>, O_RDONLY, &amp;fhd);
<a name="l14179"></a>14179    <span class="keywordflow">if</span> (fh &lt; 0 || fhd &lt; 0) {
<a name="l14180"></a>14180       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_enum_vars&quot;</span>, <span class="stringliteral">&quot;cannot open index files&quot;</span>);
<a name="l14181"></a>14181       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14182"></a>14182    }
<a name="l14183"></a>14183 
<a name="l14184"></a>14184    <span class="comment">/* search last definition */</span>
<a name="l14185"></a>14185    lseek(fhd, 0, SEEK_END);
<a name="l14186"></a>14186    n = <a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fhd) / <span class="keyword">sizeof</span>(def_rec);
<a name="l14187"></a>14187    def_rec.<a class="code" href="structDEF__RECORD.html#a9d9787264de717f2512af5e7d48e5a32">event_id</a> = 0;
<a name="l14188"></a>14188    <span class="keywordflow">for</span> (i = n - 1; i &gt;= 0; i--) {
<a name="l14189"></a>14189       lseek(fhd, i * <span class="keyword">sizeof</span>(def_rec), SEEK_SET);
<a name="l14190"></a>14190       <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhd, (<span class="keywordtype">char</span> *) &amp;def_rec, <span class="keyword">sizeof</span>(def_rec));
<a name="l14191"></a>14191       <span class="keywordflow">if</span> (def_rec.event_id == <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>)
<a name="l14192"></a>14192          <span class="keywordflow">break</span>;
<a name="l14193"></a>14193    }
<a name="l14194"></a>14194    <span class="keywordflow">if</span> (def_rec.event_id != <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>) {
<a name="l14195"></a>14195       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_enum_vars&quot;</span>, <span class="stringliteral">&quot;event %d not found in index file&quot;</span>, <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>);
<a name="l14196"></a>14196       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14197"></a>14197    }
<a name="l14198"></a>14198 
<a name="l14199"></a>14199    <span class="comment">/* read definition header */</span>
<a name="l14200"></a>14200    lseek(fh, def_rec.def_offset, SEEK_SET);
<a name="l14201"></a>14201    <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, (<span class="keywordtype">char</span> *) &amp;rec, <span class="keyword">sizeof</span>(rec));
<a name="l14202"></a>14202    <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, str, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>);
<a name="l14203"></a>14203 
<a name="l14204"></a>14204    <span class="comment">/* read event definition */</span>
<a name="l14205"></a>14205    n = rec.data_size / <span class="keyword">sizeof</span>(<a class="code" href="structTAG.html">TAG</a>);
<a name="l14206"></a>14206    tag = (<a class="code" href="structTAG.html">TAG</a> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(rec.data_size);
<a name="l14207"></a>14207    <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, (<span class="keywordtype">char</span> *) tag, rec.data_size);
<a name="l14208"></a>14208 
<a name="l14209"></a>14209    <span class="keywordflow">if</span> (n * <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a> &gt; (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) *<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> || n * <span class="keyword">sizeof</span>(<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>) &gt; *n_size) {
<a name="l14210"></a>14210       
<a name="l14211"></a>14211       <span class="comment">/* store partial definition */</span>
<a name="l14212"></a>14212       <span class="keywordflow">for</span> (i = 0; i &lt; (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) *<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> / <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>; i++) {
<a name="l14213"></a>14213          strcpy(<a class="code" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a> + i * <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>, tag[i].<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>);
<a name="l14214"></a>14214          var_n[i] = tag[i].<a class="code" href="group__midasincludecode.html#gaec010a11e0792b46f71ba64fae6f44e8">n_data</a>;
<a name="l14215"></a>14215       }
<a name="l14216"></a>14216 
<a name="l14217"></a>14217       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_enum_vars&quot;</span>, <span class="stringliteral">&quot;tag buffer too small&quot;</span>);
<a name="l14218"></a>14218       <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(tag);
<a name="l14219"></a>14219       close(fh);
<a name="l14220"></a>14220       close(fhd);
<a name="l14221"></a>14221       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga8d2556d6b5d8902646a36e3aa7e71dc5">HS_NO_MEMORY</a>;
<a name="l14222"></a>14222    }
<a name="l14223"></a>14223 
<a name="l14224"></a>14224    <span class="comment">/* store full definition */</span>
<a name="l14225"></a>14225    <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
<a name="l14226"></a>14226       strcpy(<a class="code" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a> + i * <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>, tag[i].<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>);
<a name="l14227"></a>14227       var_n[i] = tag[i].<a class="code" href="group__midasincludecode.html#gaec010a11e0792b46f71ba64fae6f44e8">n_data</a>;
<a name="l14228"></a>14228    }
<a name="l14229"></a>14229    *<a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> = n * <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>;
<a name="l14230"></a>14230    *n_size = n * <span class="keyword">sizeof</span>(<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>);
<a name="l14231"></a>14231 
<a name="l14232"></a>14232    <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(tag);
<a name="l14233"></a>14233    close(fh);
<a name="l14234"></a>14234    close(fhd);
<a name="l14235"></a>14235 
<a name="l14236"></a>14236    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>;
<a name="l14237"></a>14237 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga477235c506afd964bdc741b688179ff8"></a><!-- doxytag: member="midas.c::hs_fdump" ref="ga477235c506afd964bdc741b688179ff8" args="(char *file_name, DWORD id, BOOL binary_time)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> hs_fdump </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>file_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td>
          <td class="paramname"> <em>binary_time</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l14924">14924</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l01093">HS_FILE_ERROR</a>, <a class="el" href="midas_8h_source.html#l01092">HS_SUCCESS</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="msystem_8h_source.html#l00351">O_BINARY</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00256">read</a>, <a class="el" href="midas_8h_source.html#l01551">RT_DEF</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="mhist_8c_source.html#l00455">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14927"></a>14927          : <a class="code" href="group__msectionh.html#gac8eea470972ac14b4dec0732475d9e0a">hs_fdump</a>
<a name="l14928"></a>14928 
<a name="l14929"></a>14929   Purpose: Display <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> <span class="keywordflow">for</span> a given <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file
<a name="l14930"></a>14930 
<a name="l14931"></a>14931   Input:
<a name="l14932"></a>14932     <span class="keywordtype">char</span>   *<a class="code" href="odbhist_8c.html#a4da1fcf44864d811e793f03bf36e6e17">file_name</a>       Name of file to dump
<a name="l14933"></a>14933     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>         Event <a class="code" href="jorway73a_8h.html#a4bfe115debc7f472dd7dfe4ef9679ca0">ID</a>
<a name="l14934"></a>14934     <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>   <a class="code" href="mhist_8c.html#ab8807066c6d3cac932af3c18621e04d0">binary_time</a>      Display <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a> stamp
<a name="l14935"></a>14935 
<a name="l14936"></a>14936   Output:
<a name="l14937"></a>14937     &lt;screen <a class="code" href="scs__210_8c.html#a859e9f68c1c035565d6729c59fd894ae">output</a>&gt;
<a name="l14938"></a>14938 
<a name="l14939"></a>14939   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l14940"></a>14940     <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>              Successful completion
<a name="l14941"></a>14941     <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>           Cannot open <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file
<a name="l14942"></a>14942 
<a name="l14943"></a>14943 \********************************************************************/
<a name="l14944"></a>14944 {
<a name="l14945"></a>14945    <span class="keywordtype">int</span> fh;
<a name="l14946"></a>14946    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>;
<a name="l14947"></a>14947    <a class="code" href="structHIST__RECORD.html">HIST_RECORD</a> rec;
<a name="l14948"></a>14948    <span class="keywordtype">char</span> event_name[<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>];
<a name="l14949"></a>14949    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[80];
<a name="l14950"></a>14950 
<a name="l14951"></a>14951    <span class="comment">/* open file, add O_BINARY flag for Windows NT */</span>
<a name="l14952"></a>14952    fh = open(<a class="code" href="odbhist_8c.html#a4da1fcf44864d811e793f03bf36e6e17">file_name</a>, O_RDONLY | <a class="code" href="group__msystemincludecode.html#ga36fa9b2e726512bc17a7a6d3e39002be">O_BINARY</a>, 0644);
<a name="l14953"></a>14953    <span class="keywordflow">if</span> (fh &lt; 0) {
<a name="l14954"></a>14954       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_fdump&quot;</span>, <span class="stringliteral">&quot;cannot open file %s&quot;</span>, <a class="code" href="odbhist_8c.html#a4da1fcf44864d811e793f03bf36e6e17">file_name</a>);
<a name="l14955"></a>14955       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14956"></a>14956    }
<a name="l14957"></a>14957 
<a name="l14958"></a>14958    <span class="comment">/* loop over file records in .hst file */</span>
<a name="l14959"></a>14959    <span class="keywordflow">do</span> {
<a name="l14960"></a>14960       n = <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, (<span class="keywordtype">char</span> *) &amp;rec, <span class="keyword">sizeof</span>(rec));
<a name="l14961"></a>14961       <span class="keywordflow">if</span> (n &lt; <span class="keyword">sizeof</span>(rec))
<a name="l14962"></a>14962          <span class="keywordflow">break</span>;
<a name="l14963"></a>14963 
<a name="l14964"></a>14964       <span class="comment">/* check if record type is definition */</span>
<a name="l14965"></a>14965       <span class="keywordflow">if</span> (rec.record_type == <a class="code" href="group__mhistoryh.html#ga53bf0d0c21b64cf42e4355c3919f6fa2">RT_DEF</a>) {
<a name="l14966"></a>14966          <span class="comment">/* read name */</span>
<a name="l14967"></a>14967          <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, event_name, <span class="keyword">sizeof</span>(event_name));
<a name="l14968"></a>14968 
<a name="l14969"></a>14969          <span class="keywordflow">if</span> (rec.event_id == <span class="keywordtype">id</span> || <span class="keywordtype">id</span> == 0)
<a name="l14970"></a>14970             printf(<span class="stringliteral">&quot;Event definition %s, ID %ld\n&quot;</span>, event_name, rec.event_id);
<a name="l14971"></a>14971 
<a name="l14972"></a>14972          <span class="comment">/* skip tags */</span>
<a name="l14973"></a>14973          lseek(fh, rec.data_size, SEEK_CUR);
<a name="l14974"></a>14974       } <span class="keywordflow">else</span> {
<a name="l14975"></a>14975          <span class="comment">/* print data record */</span>
<a name="l14976"></a>14976          <span class="keywordflow">if</span> (<a class="code" href="mhist_8c.html#ab8807066c6d3cac932af3c18621e04d0">binary_time</a>)
<a name="l14977"></a>14977             sprintf(str, <span class="stringliteral">&quot;%li &quot;</span>, rec.time);
<a name="l14978"></a>14978          <span class="keywordflow">else</span> {
<a name="l14979"></a>14979             strcpy(str, ctime((<span class="keyword">const</span> time_t *) &amp;rec.time) + 4);
<a name="l14980"></a>14980             str[15] = 0;
<a name="l14981"></a>14981          }
<a name="l14982"></a>14982          <span class="keywordflow">if</span> (rec.event_id == <span class="keywordtype">id</span> || <span class="keywordtype">id</span> == 0)
<a name="l14983"></a>14983             printf(<span class="stringliteral">&quot;ID %ld, %s, size %ld\n&quot;</span>, rec.event_id, str, rec.data_size);
<a name="l14984"></a>14984 
<a name="l14985"></a>14985          <span class="comment">/* skip data */</span>
<a name="l14986"></a>14986          lseek(fh, rec.data_size, SEEK_CUR);
<a name="l14987"></a>14987       }
<a name="l14988"></a>14988 
<a name="l14989"></a>14989    } <span class="keywordflow">while</span> (<a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l14990"></a>14990 
<a name="l14991"></a>14991    close(fh);
<a name="l14992"></a>14992 
<a name="l14993"></a>14993    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>;
<a name="l14994"></a>14994 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga0e7b43f0ca043d04fb5716b8da02d41f"></a><!-- doxytag: member="midas.c::hs_gen_index" ref="ga0e7b43f0ca043d04fb5716b8da02d41f" args="(DWORD ltime)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> hs_gen_index </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>ltime</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox </p>

<p>Definition at line <a class="el" href="midas_8c_source.html#l13299">13299</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l01564">DEF_RECORD::def_offset</a>, <a class="el" href="midas_8h_source.html#l01568">INDEX_RECORD::event_id</a>, <a class="el" href="midas_8h_source.html#l01562">DEF_RECORD::event_id</a>, <a class="el" href="midas_8h_source.html#l01563">DEF_RECORD::event_name</a>, <a class="el" href="midas_8h_source.html#l01093">HS_FILE_ERROR</a>, <a class="el" href="midas_8c_source.html#l13271">hs_open_file()</a>, <a class="el" href="midas_8h_source.html#l01092">HS_SUCCESS</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="midas_8h_source.html#l01570">INDEX_RECORD::offset</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00256">read</a>, <a class="el" href="midas_8h_source.html#l01551">RT_DEF</a>, <a class="el" href="msystem_8h_source.html#l00369">TELL</a>, <a class="el" href="midas_8h_source.html#l01569">INDEX_RECORD::time</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, and <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00259">write</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l13463">hs_define_event()</a>, and <a class="el" href="midas_8c_source.html#l13394">hs_search_file()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l13302"></a>13302          : <a class="code" href="group__hsfunctionc.html#ga0e7b43f0ca043d04fb5716b8da02d41f">hs_gen_index</a>
<a name="l13303"></a>13303 
<a name="l13304"></a>13304   Purpose: Regenerate <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> files (<span class="stringliteral">&quot;idx&quot;</span> <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> <span class="stringliteral">&quot;idf&quot;</span> files) <span class="keywordflow">for</span> a given
<a name="l13305"></a>13305            <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file (<span class="stringliteral">&quot;hst&quot;</span>). Interal use only.
<a name="l13306"></a>13306 
<a name="l13307"></a>13307   Input:
<a name="l13308"></a>13308     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  ltime            Date <span class="keywordflow">for</span> which a <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file should
<a name="l13309"></a>13309                             be analyzed.
<a name="l13310"></a>13310 
<a name="l13311"></a>13311   Output:
<a name="l13312"></a>13312     none
<a name="l13313"></a>13313 
<a name="l13314"></a>13314   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l13315"></a>13315     <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>              Successful completion
<a name="l13316"></a>13316     <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>           Index files cannot be created
<a name="l13317"></a>13317 
<a name="l13318"></a>13318 \********************************************************************/
<a name="l13319"></a>13319 {
<a name="l13320"></a>13320    <span class="keywordtype">char</span> event_name[<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>];
<a name="l13321"></a>13321    <span class="keywordtype">int</span> fh, fhd, fhi;
<a name="l13322"></a>13322    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>;
<a name="l13323"></a>13323    <a class="code" href="structHIST__RECORD.html">HIST_RECORD</a> rec;
<a name="l13324"></a>13324    <a class="code" href="structINDEX__RECORD.html">INDEX_RECORD</a> irec;
<a name="l13325"></a>13325    <a class="code" href="structDEF__RECORD.html">DEF_RECORD</a> def_rec;
<a name="l13326"></a>13326 
<a name="l13327"></a>13327    printf(<span class="stringliteral">&quot;Recovering index files...\n&quot;</span>);
<a name="l13328"></a>13328 
<a name="l13329"></a>13329    <span class="keywordflow">if</span> (ltime == 0)
<a name="l13330"></a>13330       ltime = <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(NULL);
<a name="l13331"></a>13331 
<a name="l13332"></a>13332    <span class="comment">/* open new index file */</span>
<a name="l13333"></a>13333    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(ltime, <span class="stringliteral">&quot;idx&quot;</span>, O_RDWR | O_CREAT | O_TRUNC, &amp;fhi);
<a name="l13334"></a>13334    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(ltime, <span class="stringliteral">&quot;idf&quot;</span>, O_RDWR | O_CREAT | O_TRUNC, &amp;fhd);
<a name="l13335"></a>13335 
<a name="l13336"></a>13336    <span class="keywordflow">if</span> (fhd &lt; 0 || fhi &lt; 0) {
<a name="l13337"></a>13337       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_gen_index&quot;</span>, <span class="stringliteral">&quot;cannot create index file&quot;</span>);
<a name="l13338"></a>13338       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l13339"></a>13339    }
<a name="l13340"></a>13340 
<a name="l13341"></a>13341    <span class="comment">/* open history file */</span>
<a name="l13342"></a>13342    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(ltime, <span class="stringliteral">&quot;hst&quot;</span>, O_RDONLY, &amp;fh);
<a name="l13343"></a>13343    <span class="keywordflow">if</span> (fh &lt; 0)
<a name="l13344"></a>13344       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l13345"></a>13345    lseek(fh, 0, SEEK_SET);
<a name="l13346"></a>13346 
<a name="l13347"></a>13347    <span class="comment">/* loop over file records in .hst file */</span>
<a name="l13348"></a>13348    <span class="keywordflow">do</span> {
<a name="l13349"></a>13349       n = <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, (<span class="keywordtype">char</span> *) &amp;rec, <span class="keyword">sizeof</span>(rec));
<a name="l13350"></a>13350       <span class="keywordflow">if</span> (n &lt; <span class="keyword">sizeof</span>(rec))
<a name="l13351"></a>13351          <span class="keywordflow">break</span>;
<a name="l13352"></a>13352 
<a name="l13353"></a>13353       <span class="comment">/* check if record type is definition */</span>
<a name="l13354"></a>13354       <span class="keywordflow">if</span> (rec.record_type == <a class="code" href="group__mhistoryh.html#ga53bf0d0c21b64cf42e4355c3919f6fa2">RT_DEF</a>) {
<a name="l13355"></a>13355          <span class="comment">/* read name */</span>
<a name="l13356"></a>13356          <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, event_name, <span class="keyword">sizeof</span>(event_name));
<a name="l13357"></a>13357 
<a name="l13358"></a>13358          printf(<span class="stringliteral">&quot;Event definition %s, ID %ld\n&quot;</span>, event_name, rec.event_id);
<a name="l13359"></a>13359 
<a name="l13360"></a>13360          <span class="comment">/* write definition index record */</span>
<a name="l13361"></a>13361          def_rec.<a class="code" href="structDEF__RECORD.html#a9d9787264de717f2512af5e7d48e5a32">event_id</a> = rec.event_id;
<a name="l13362"></a>13362          memcpy(def_rec.<a class="code" href="group__midasincludecode.html#gad4fdebc35644bab90bbe3164176690cf">event_name</a>, event_name, <span class="keyword">sizeof</span>(event_name));
<a name="l13363"></a>13363          def_rec.<a class="code" href="group__midasincludecode.html#ga3368ac2be8ed74559ed9ef115756f5e7">def_offset</a> = <a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fh) - <span class="keyword">sizeof</span>(event_name) - <span class="keyword">sizeof</span>(rec);
<a name="l13364"></a>13364          <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fhd, (<span class="keywordtype">char</span> *) &amp;def_rec, <span class="keyword">sizeof</span>(def_rec));
<a name="l13365"></a>13365 
<a name="l13366"></a>13366          <span class="comment">/* skip tags */</span>
<a name="l13367"></a>13367          lseek(fh, rec.data_size, SEEK_CUR);
<a name="l13368"></a>13368       } <span class="keywordflow">else</span> {
<a name="l13369"></a>13369          <span class="comment">/* write index record */</span>
<a name="l13370"></a>13370          irec.<a class="code" href="structINDEX__RECORD.html#ab893c0617053652c09947d7d24740f27">event_id</a> = rec.event_id;
<a name="l13371"></a>13371          irec.<a class="code" href="group__midasincludecode.html#ga729b9b6590da0af9a8c9984d0d58a8d7">time</a> = rec.time;
<a name="l13372"></a>13372          irec.<a class="code" href="group__midasincludecode.html#gaa5cd05f92f95ebccc6f2c7fdf3b3f1a9">offset</a> = <a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fh) - <span class="keyword">sizeof</span>(rec);
<a name="l13373"></a>13373          <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fhi, (<span class="keywordtype">char</span> *) &amp;irec, <span class="keyword">sizeof</span>(irec));
<a name="l13374"></a>13374 
<a name="l13375"></a>13375          <span class="comment">/* printf(&quot;ID %d, %s\n&quot;, rec.event_id, ctime((const time_t *)&amp;irec.time)+4); */</span>
<a name="l13376"></a>13376 
<a name="l13377"></a>13377          <span class="comment">/* skip data */</span>
<a name="l13378"></a>13378          lseek(fh, rec.data_size, SEEK_CUR);
<a name="l13379"></a>13379       }
<a name="l13380"></a>13380 
<a name="l13381"></a>13381    } <span class="keywordflow">while</span> (<a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l13382"></a>13382 
<a name="l13383"></a>13383    close(fh);
<a name="l13384"></a>13384    close(fhi);
<a name="l13385"></a>13385    close(fhd);
<a name="l13386"></a>13386 
<a name="l13387"></a>13387    printf(<span class="stringliteral">&quot;...done.\n&quot;</span>);
<a name="l13388"></a>13388 
<a name="l13389"></a>13389    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>;
<a name="l13390"></a>13390 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga54d9839f9719570bca40a419827d5ade"></a><!-- doxytag: member="midas.c::hs_get_event_id" ref="ga54d9839f9719570bca40a419827d5ade" args="(DWORD ltime, char *name, DWORD *id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> hs_get_event_id </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>ltime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&nbsp;</td>
          <td class="paramname"> <em>id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l13985">13985</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l01093">HS_FILE_ERROR</a>, <a class="el" href="midas_8c_source.html#l13271">hs_open_file()</a>, <a class="el" href="midas_8c_source.html#l13394">hs_search_file()</a>, <a class="el" href="midas_8h_source.html#l01092">HS_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l01097">HS_UNDEFINED_EVENT</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00256">read</a>, <a class="el" href="midas_8c_source.html#l09810">rpc_call()</a>, <a class="el" href="mrpc_8h_source.html#l00181">RPC_HS_GET_EVENT_ID</a>, <a class="el" href="midas_8c_source.html#l09022">rpc_is_remote()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l07289">generate_hist_graph()</a>, and <a class="el" href="mserver_8c_source.html#l00534">rpc_server_dispatch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l13988"></a>13988          : <a class="code" href="group__msectionh.html#ga613cde23ebe2d173ed146cc679a05260">hs_get_event_id</a>
<a name="l13989"></a>13989 
<a name="l13990"></a>13990   Purpose: Return <span class="keyword">event</span> <a class="code" href="jorway73a_8h.html#a4bfe115debc7f472dd7dfe4ef9679ca0">ID</a> <span class="keywordflow">for</span> a given <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>. If <span class="keyword">event</span> cannot be <a class="code" href="patch__mevb_8cpp.html#a408216eef095a35ba3963fc6f4f4d7a8">found</a>
<a name="l13991"></a>13991            <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> current definition file, go back <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a> until <a class="code" href="patch__mevb_8cpp.html#a408216eef095a35ba3963fc6f4f4d7a8">found</a>
<a name="l13992"></a>13992 
<a name="l13993"></a>13993   Input:
<a name="l13994"></a>13994     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  ltime            Date at which <span class="keyword">event</span> <a class="code" href="jorway73a_8h.html#a4bfe115debc7f472dd7dfe4ef9679ca0">ID</a> should be looked <span class="keywordflow">for</span>
<a name="l13995"></a>13995 
<a name="l13996"></a>13996   Output:
<a name="l13997"></a>13997     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  *<span class="keywordtype">id</span>              Event <a class="code" href="jorway73a_8h.html#a4bfe115debc7f472dd7dfe4ef9679ca0">ID</a>
<a name="l13998"></a>13998 
<a name="l13999"></a>13999   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l14000"></a>14000     <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>              Successful completion
<a name="l14001"></a>14001     <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>           Cannot open <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file
<a name="l14002"></a>14002     <a class="code" href="group__err26.html#gad7b85d13f7ee77c6d195ed38380bbc27">HS_UNDEFINED_EVENT</a>      Event <span class="stringliteral">&quot;name&quot;</span> not <a class="code" href="patch__mevb_8cpp.html#a408216eef095a35ba3963fc6f4f4d7a8">found</a>
<a name="l14003"></a>14003 
<a name="l14004"></a>14004 \********************************************************************/
<a name="l14005"></a>14005 {
<a name="l14006"></a>14006    <span class="keywordtype">int</span> fh, fhd;
<a name="l14007"></a>14007    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l14008"></a>14008    <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> lt;
<a name="l14009"></a>14009    <a class="code" href="structDEF__RECORD.html">DEF_RECORD</a> def_rec;
<a name="l14010"></a>14010 
<a name="l14011"></a>14011    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga0090933001e7e1ddd52ed3f321bea957">rpc_is_remote</a>())
<a name="l14012"></a>14012       <span class="keywordflow">return</span> <a class="code" href="group__msectionh.html#ga6bf1d13a0c49a3f7a02650885937b5e7">rpc_call</a>(<a class="code" href="group__mrpcdefineh.html#ga4f8ad9ec49e28393516bd2c909463c6c">RPC_HS_GET_EVENT_ID</a>, ltime, <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>, <span class="keywordtype">id</span>);
<a name="l14013"></a>14013 
<a name="l14014"></a>14014    <span class="comment">/* search latest history file */</span>
<a name="l14015"></a>14015    <span class="keywordflow">if</span> (ltime == 0)
<a name="l14016"></a>14016       ltime = <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(NULL);
<a name="l14017"></a>14017 
<a name="l14018"></a>14018    lt = ltime;
<a name="l14019"></a>14019 
<a name="l14020"></a>14020    <span class="keywordflow">do</span> {
<a name="l14021"></a>14021       status = <a class="code" href="group__hsfunctionc.html#ga1ebb4cc3c2f54b895e14c665db26531d">hs_search_file</a>(&amp;lt, -1);
<a name="l14022"></a>14022       <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>) {
<a name="l14023"></a>14023          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_count_events&quot;</span>, <span class="stringliteral">&quot;cannot find recent history file&quot;</span>);
<a name="l14024"></a>14024          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14025"></a>14025       }
<a name="l14026"></a>14026 
<a name="l14027"></a>14027       <span class="comment">/* open history and definition files */</span>
<a name="l14028"></a>14028       <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(lt, <span class="stringliteral">&quot;hst&quot;</span>, O_RDONLY, &amp;fh);
<a name="l14029"></a>14029       <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(lt, <span class="stringliteral">&quot;idf&quot;</span>, O_RDONLY, &amp;fhd);
<a name="l14030"></a>14030       <span class="keywordflow">if</span> (fh &lt; 0 || fhd &lt; 0) {
<a name="l14031"></a>14031          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_count_events&quot;</span>, <span class="stringliteral">&quot;cannot open index files&quot;</span>);
<a name="l14032"></a>14032          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14033"></a>14033       }
<a name="l14034"></a>14034 
<a name="l14035"></a>14035       <span class="comment">/* loop over index file */</span>
<a name="l14036"></a>14036       *<span class="keywordtype">id</span> = 0;
<a name="l14037"></a>14037       <span class="keywordflow">do</span> {
<a name="l14038"></a>14038          <span class="comment">/* read definition index record */</span>
<a name="l14039"></a>14039          i = <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhd, (<span class="keywordtype">char</span> *) &amp;def_rec, <span class="keyword">sizeof</span>(def_rec));
<a name="l14040"></a>14040          <span class="keywordflow">if</span> (i &lt; (<span class="keywordtype">int</span>) <span class="keyword">sizeof</span>(def_rec))
<a name="l14041"></a>14041             <span class="keywordflow">break</span>;
<a name="l14042"></a>14042 
<a name="l14043"></a>14043          <span class="keywordflow">if</span> (strcmp(<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>, def_rec.event_name) == 0) {
<a name="l14044"></a>14044             *<span class="keywordtype">id</span> = def_rec.event_id;
<a name="l14045"></a>14045             close(fh);
<a name="l14046"></a>14046             close(fhd);
<a name="l14047"></a>14047             <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>;
<a name="l14048"></a>14048          }
<a name="l14049"></a>14049       } <span class="keywordflow">while</span> (<a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l14050"></a>14050 
<a name="l14051"></a>14051       close(fh);
<a name="l14052"></a>14052       close(fhd);
<a name="l14053"></a>14053 
<a name="l14054"></a>14054       <span class="comment">/* not found -&gt; go back one day */</span>
<a name="l14055"></a>14055       lt -= 3600 * 24;
<a name="l14056"></a>14056 
<a name="l14057"></a>14057    } <span class="keywordflow">while</span> (lt &gt; ltime - 3600 * 24 * 365 * 10); <span class="comment">/* maximum 10 years */</span>
<a name="l14058"></a>14058 
<a name="l14059"></a>14059    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gad7b85d13f7ee77c6d195ed38380bbc27">HS_UNDEFINED_EVENT</a>;
<a name="l14060"></a>14060 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga221c5c291ec83af5f621cce3893af06e"></a><!-- doxytag: member="midas.c::hs_get_var" ref="ga221c5c291ec83af5f621cce3893af06e" args="(DWORD ltime, DWORD event_id, char *var_name, DWORD *type, INT *n_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> hs_get_var </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>ltime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>event_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>var_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> *&nbsp;</td>
          <td class="paramname"> <em>n_data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l14241">14241</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l01564">DEF_RECORD::def_offset</a>, <a class="el" href="midas_8h_source.html#l01562">DEF_RECORD::event_id</a>, <a class="el" href="midas_8h_source.html#l01093">HS_FILE_ERROR</a>, <a class="el" href="midas_8c_source.html#l13271">hs_open_file()</a>, <a class="el" href="midas_8c_source.html#l13394">hs_search_file()</a>, <a class="el" href="midas_8h_source.html#l01092">HS_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l01098">HS_UNDEFINED_VAR</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="midas_8h_source.html#l01755">M_FREE</a>, <a class="el" href="midas_8h_source.html#l01753">M_MALLOC</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00256">read</a>, <a class="el" href="midas_8c_source.html#l09810">rpc_call()</a>, <a class="el" href="mrpc_8h_source.html#l00180">RPC_HS_GET_VAR</a>, <a class="el" href="midas_8c_source.html#l09022">rpc_is_remote()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="mhist_8c_source.html#l00102">tag</a>, and <a class="el" href="msystem_8h_source.html#l00369">TELL</a>.</p>

<p>Referenced by <a class="el" href="mhist_8c_source.html#l00158">query_params()</a>, and <a class="el" href="mserver_8c_source.html#l00534">rpc_server_dispatch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14244"></a>14244          : <a class="code" href="group__msectionh.html#ga829bc6030bb73a6df3639f67a818fc57">hs_get_var</a>
<a name="l14245"></a>14245 
<a name="l14246"></a>14246   Purpose: Get definition <span class="keywordflow">for</span> certain <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a>
<a name="l14247"></a>14247 
<a name="l14248"></a>14248   Input:
<a name="l14249"></a>14249     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  ltime            Date at which <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a> definition should
<a name="l14250"></a>14250                             be returned
<a name="l14251"></a>14251     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>         Event <a class="code" href="jorway73a_8h.html#a4bfe115debc7f472dd7dfe4ef9679ca0">ID</a>
<a name="l14252"></a>14252     <span class="keywordtype">char</span>   *<a class="code" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a>        Name of <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a>
<a name="l14253"></a>14253 
<a name="l14254"></a>14254   Output:
<a name="l14255"></a>14255     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>    *<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>            Type of <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a>
<a name="l14256"></a>14256     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>    *n_data          Number of items <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a>
<a name="l14257"></a>14257 
<a name="l14258"></a>14258   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l14259"></a>14259     <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>              Successful completion
<a name="l14260"></a>14260     HS_NO_MEMEORY           Out of memory
<a name="l14261"></a>14261     <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>           Cannot open <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file
<a name="l14262"></a>14262 
<a name="l14263"></a>14263 \********************************************************************/
<a name="l14264"></a>14264 {
<a name="l14265"></a>14265    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[256];
<a name="l14266"></a>14266    <span class="keywordtype">int</span> fh, fhd;
<a name="l14267"></a>14267    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l14268"></a>14268    <a class="code" href="structDEF__RECORD.html">DEF_RECORD</a> def_rec;
<a name="l14269"></a>14269    <a class="code" href="structHIST__RECORD.html">HIST_RECORD</a> rec;
<a name="l14270"></a>14270    <a class="code" href="structTAG.html">TAG</a> *<a class="code" href="mhist_8c.html#a27ce05f73a16e6abc070da1007833b9b">tag</a>;
<a name="l14271"></a>14271 
<a name="l14272"></a>14272    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga0090933001e7e1ddd52ed3f321bea957">rpc_is_remote</a>())
<a name="l14273"></a>14273       <span class="keywordflow">return</span> <a class="code" href="group__msectionh.html#ga6bf1d13a0c49a3f7a02650885937b5e7">rpc_call</a>(<a class="code" href="group__mrpcdefineh.html#ga80424615873f6deec4b651d65133a241">RPC_HS_GET_VAR</a>, ltime, <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>, <a class="code" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a>, <a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>, n_data);
<a name="l14274"></a>14274 
<a name="l14275"></a>14275    <span class="comment">/* search latest history file */</span>
<a name="l14276"></a>14276    status = <a class="code" href="group__hsfunctionc.html#ga1ebb4cc3c2f54b895e14c665db26531d">hs_search_file</a>(&amp;ltime, -1);
<a name="l14277"></a>14277    <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>) {
<a name="l14278"></a>14278       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_get_var&quot;</span>, <span class="stringliteral">&quot;cannot find recent history file&quot;</span>);
<a name="l14279"></a>14279       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14280"></a>14280    }
<a name="l14281"></a>14281 
<a name="l14282"></a>14282    <span class="comment">/* open history and definition files */</span>
<a name="l14283"></a>14283    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(ltime, <span class="stringliteral">&quot;hst&quot;</span>, O_RDONLY, &amp;fh);
<a name="l14284"></a>14284    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(ltime, <span class="stringliteral">&quot;idf&quot;</span>, O_RDONLY, &amp;fhd);
<a name="l14285"></a>14285    <span class="keywordflow">if</span> (fh &lt; 0 || fhd &lt; 0) {
<a name="l14286"></a>14286       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_get_var&quot;</span>, <span class="stringliteral">&quot;cannot open index files&quot;</span>);
<a name="l14287"></a>14287       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14288"></a>14288    }
<a name="l14289"></a>14289 
<a name="l14290"></a>14290    <span class="comment">/* search last definition */</span>
<a name="l14291"></a>14291    lseek(fhd, 0, SEEK_END);
<a name="l14292"></a>14292    n = <a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fhd) / <span class="keyword">sizeof</span>(def_rec);
<a name="l14293"></a>14293    def_rec.<a class="code" href="structDEF__RECORD.html#a9d9787264de717f2512af5e7d48e5a32">event_id</a> = 0;
<a name="l14294"></a>14294    <span class="keywordflow">for</span> (i = n - 1; i &gt;= 0; i--) {
<a name="l14295"></a>14295       lseek(fhd, i * <span class="keyword">sizeof</span>(def_rec), SEEK_SET);
<a name="l14296"></a>14296       <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhd, (<span class="keywordtype">char</span> *) &amp;def_rec, <span class="keyword">sizeof</span>(def_rec));
<a name="l14297"></a>14297       <span class="keywordflow">if</span> (def_rec.event_id == <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>)
<a name="l14298"></a>14298          <span class="keywordflow">break</span>;
<a name="l14299"></a>14299    }
<a name="l14300"></a>14300    <span class="keywordflow">if</span> (def_rec.event_id != <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>) {
<a name="l14301"></a>14301       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_get_var&quot;</span>, <span class="stringliteral">&quot;event %d not found in index file&quot;</span>, <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>);
<a name="l14302"></a>14302       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14303"></a>14303    }
<a name="l14304"></a>14304 
<a name="l14305"></a>14305    <span class="comment">/* read definition header */</span>
<a name="l14306"></a>14306    lseek(fh, def_rec.def_offset, SEEK_SET);
<a name="l14307"></a>14307    <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, (<span class="keywordtype">char</span> *) &amp;rec, <span class="keyword">sizeof</span>(rec));
<a name="l14308"></a>14308    <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, str, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>);
<a name="l14309"></a>14309 
<a name="l14310"></a>14310    <span class="comment">/* read event definition */</span>
<a name="l14311"></a>14311    n = rec.data_size / <span class="keyword">sizeof</span>(<a class="code" href="structTAG.html">TAG</a>);
<a name="l14312"></a>14312    tag = (<a class="code" href="structTAG.html">TAG</a> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(rec.data_size);
<a name="l14313"></a>14313    <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, (<span class="keywordtype">char</span> *) tag, rec.data_size);
<a name="l14314"></a>14314 
<a name="l14315"></a>14315    <span class="comment">/* search variable */</span>
<a name="l14316"></a>14316    <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
<a name="l14317"></a>14317       <span class="keywordflow">if</span> (strcmp(tag[i].<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>, <a class="code" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a>) == 0)
<a name="l14318"></a>14318          <span class="keywordflow">break</span>;
<a name="l14319"></a>14319 
<a name="l14320"></a>14320    close(fh);
<a name="l14321"></a>14321    close(fhd);
<a name="l14322"></a>14322 
<a name="l14323"></a>14323    <span class="keywordflow">if</span> (i &lt; n) {
<a name="l14324"></a>14324       *<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> = tag[i].<a class="code" href="group__midasincludecode.html#ga3fdedadca645679ef114cc651a978d17">type</a>;
<a name="l14325"></a>14325       *n_data = tag[i].<a class="code" href="group__midasincludecode.html#gaec010a11e0792b46f71ba64fae6f44e8">n_data</a>;
<a name="l14326"></a>14326    } <span class="keywordflow">else</span> {
<a name="l14327"></a>14327       *<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> = *n_data = 0;
<a name="l14328"></a>14328       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_get_var&quot;</span>, <span class="stringliteral">&quot;variable %s not found&quot;</span>, <a class="code" href="odbhist_8c.html#afb511f623cd68ee7526e819a11155abf">var_name</a>);
<a name="l14329"></a>14329       <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(tag);
<a name="l14330"></a>14330       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga1b25c77e3145468cf83f8e88bf1e0804">HS_UNDEFINED_VAR</a>;
<a name="l14331"></a>14331    }
<a name="l14332"></a>14332 
<a name="l14333"></a>14333    <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(tag);
<a name="l14334"></a>14334    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>;
<a name="l14335"></a>14335 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga129bb4df742fb66b63d6b2a8253023e9"></a><!-- doxytag: member="midas.c::hs_open_file" ref="ga129bb4df742fb66b63d6b2a8253023e9" args="(DWORD ltime, char *suffix, INT mode, int *fh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> hs_open_file </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>ltime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>suffix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>fh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Open history file belonging to certain date. Internal use only. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ltime</em>&nbsp;</td><td>Date for which a history file should be opened. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>suffix</em>&nbsp;</td><td>File name suffix like "hst", "idx", "idf" </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td>R/W access mode </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fh</em>&nbsp;</td><td>File handle </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>HS_SUCCESS </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l13271">13271</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="odbhist_8c_source.html#l00059">file_name</a>, <a class="el" href="midas_8h_source.html#l01092">HS_SUCCESS</a>, and <a class="el" href="msystem_8h_source.html#l00351">O_BINARY</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l13907">hs_count_events()</a>, <a class="el" href="midas_8c_source.html#l14064">hs_count_vars()</a>, <a class="el" href="midas_8c_source.html#l13463">hs_define_event()</a>, <a class="el" href="midas_8c_source.html#l14695">hs_dump()</a>, <a class="el" href="midas_8c_source.html#l13818">hs_enum_events()</a>, <a class="el" href="midas_8c_source.html#l14134">hs_enum_vars()</a>, <a class="el" href="midas_8c_source.html#l13299">hs_gen_index()</a>, <a class="el" href="midas_8c_source.html#l13985">hs_get_event_id()</a>, <a class="el" href="midas_8c_source.html#l14241">hs_get_var()</a>, <a class="el" href="midas_8c_source.html#l14339">hs_read()</a>, <a class="el" href="midas_8c_source.html#l13394">hs_search_file()</a>, and <a class="el" href="midas_8c_source.html#l13688">hs_write_event()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l13272"></a>13272 {
<a name="l13273"></a>13273    time_t tt;
<a name="l13274"></a>13274    <span class="keyword">struct </span>tm *tms;
<a name="l13275"></a>13275    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a4da1fcf44864d811e793f03bf36e6e17">file_name</a>[256];
<a name="l13276"></a>13276 
<a name="l13277"></a>13277    <span class="comment">/* generate new file name YYMMDD.xxx */</span>
<a name="l13278"></a>13278 <span class="preprocessor">#if !defined(OS_VXWORKS)</span>
<a name="l13279"></a>13279 <span class="preprocessor"></span><span class="preprocessor">#if !defined(OS_VMS)</span>
<a name="l13280"></a>13280 <span class="preprocessor"></span>   tzset();
<a name="l13281"></a>13281 <span class="preprocessor">#endif</span>
<a name="l13282"></a>13282 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l13283"></a>13283 <span class="preprocessor"></span>   tt = (time_t) ltime;
<a name="l13284"></a>13284    tms = localtime(&amp;tt);
<a name="l13285"></a>13285 
<a name="l13286"></a>13286    sprintf(file_name, <span class="stringliteral">&quot;%s%02d%02d%02d.%s&quot;</span>, <a class="code" href="group__hsfunctionc.html#ga6bfae86238964396b88c3d62aa3e0e3b">_hs_path_name</a>,
<a name="l13287"></a>13287            tms-&gt;tm_year % 100, tms-&gt;tm_mon + 1, tms-&gt;tm_mday, suffix);
<a name="l13288"></a>13288 
<a name="l13289"></a>13289    <span class="comment">/* open file, add O_BINARY flag for Windows NT */</span>
<a name="l13290"></a>13290    *fh = open(file_name, <a class="code" href="mscbutil_8c.html#a74b654271a172a244c844fb86277cd8a">mode</a> | <a class="code" href="group__msystemincludecode.html#ga36fa9b2e726512bc17a7a6d3e39002be">O_BINARY</a>, 0644);
<a name="l13291"></a>13291 
<a name="l13292"></a>13292    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>;
<a name="l13293"></a>13293 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga2d209407f1f672eb2642d63ae5ce9a03"></a><!-- doxytag: member="midas.c::hs_read" ref="ga2d209407f1f672eb2642d63ae5ce9a03" args="(DWORD event_id, DWORD start_time, DWORD end_time, DWORD interval, char *tag_name, DWORD var_index, DWORD *time_buffer, DWORD *tbsize, void *data_buffer, DWORD *dbsize, DWORD *type, DWORD *n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> hs_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>event_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>start_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>end_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>interval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>tag_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>var_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&nbsp;</td>
          <td class="paramname"> <em>time_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&nbsp;</td>
          <td class="paramname"> <em>tbsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&nbsp;</td>
          <td class="paramname"> <em>dbsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&nbsp;</td>
          <td class="paramname"> <em>n</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l14339">14339</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="generic_8c_source.html#l00091">abs</a>, <a class="el" href="mscb_8c_source.html#l00384">cache</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="midas_8h_source.html#l01568">INDEX_RECORD::event_id</a>, <a class="el" href="midas_8h_source.html#l01093">HS_FILE_ERROR</a>, <a class="el" href="midas_8h_source.html#l01094">HS_NO_MEMORY</a>, <a class="el" href="midas_8c_source.html#l13271">hs_open_file()</a>, <a class="el" href="midas_8c_source.html#l13394">hs_search_file()</a>, <a class="el" href="midas_8h_source.html#l01092">HS_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l01095">HS_TRUNCATED</a>, <a class="el" href="midas_8h_source.html#l01096">HS_WRONG_INDEX</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="midas_8h_source.html#l01755">M_FREE</a>, <a class="el" href="midas_8h_source.html#l01753">M_MALLOC</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="midas_8h_source.html#l01570">INDEX_RECORD::offset</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00256">read</a>, <a class="el" href="midas_8c_source.html#l09810">rpc_call()</a>, <a class="el" href="mrpc_8h_source.html#l00179">RPC_HS_READ</a>, <a class="el" href="midas_8c_source.html#l09022">rpc_is_remote()</a>, <a class="el" href="midas_8c_source.html#l08162">rpc_tid_size()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="mhist_8c_source.html#l00102">tag</a>, <a class="el" href="msystem_8h_source.html#l00369">TELL</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="midas_8h_source.html#l01569">INDEX_RECORD::time</a>, and <a class="el" href="CAET_8h_source.html#l00002">time</a>.</p>

<p>Referenced by <a class="el" href="mhist_8c_source.html#l00341">display_range_hist()</a>, <a class="el" href="mhist_8c_source.html#l00296">display_single_hist()</a>, <a class="el" href="mhttpd_8c_source.html#l07289">generate_hist_graph()</a>, and <a class="el" href="mserver_8c_source.html#l00534">rpc_server_dispatch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14345"></a>14345          : <a class="code" href="group__msectionh.html#ga1413cb517aa08a142a2028b0455fa924">hs_read</a>
<a name="l14346"></a>14346 
<a name="l14347"></a>14347   Purpose: Read <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> <span class="keywordflow">for</span> a <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a> at a certain <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a> <a class="code" href="mscbutil_8c.html#ad856acfe9ce335571b00a73df5e23e6b">interval</a>
<a name="l14348"></a>14348 
<a name="l14349"></a>14349   Input:
<a name="l14350"></a>14350     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>         Event <a class="code" href="jorway73a_8h.html#a4bfe115debc7f472dd7dfe4ef9679ca0">ID</a>
<a name="l14351"></a>14351     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>       Starting Date/Time
<a name="l14352"></a>14352     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  end_time         End Date/Time
<a name="l14353"></a>14353     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  <a class="code" href="mscbutil_8c.html#ad856acfe9ce335571b00a73df5e23e6b">interval</a>         Minimum <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> seconds between reported
<a name="l14354"></a>14354                             events. Can be used to skip events
<a name="l14355"></a>14355     <span class="keywordtype">char</span>   *tag_name        Variable <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a> inside <span class="keyword">event</span>
<a name="l14356"></a>14356     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  <a class="code" href="lcd__menu_8c.html#a13b219e0dd828c9f136b7bb99d8afc34">var_index</a>        Index <span class="keywordflow">if</span> <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a> is array
<a name="l14357"></a>14357 
<a name="l14358"></a>14358   Output:
<a name="l14359"></a>14359     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  *time_buffer     Buffer containing times <span class="keywordflow">for each</span> <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>
<a name="l14360"></a>14360     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  *tbsize          Size of <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a> <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l14361"></a>14361     <span class="keywordtype">void</span>   *<a class="code" href="v1724__module_8c.html#ab4c1e3e1d0abf76b1eef9c2841ee27cd">data_buffer</a>     Buffer containing <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a> values
<a name="l14362"></a>14362     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  *dbsize          Data <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>
<a name="l14363"></a>14363     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  *<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>            Type of <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a> (one of TID_xxx)
<a name="l14364"></a>14364     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  *<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>               Number of <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>/<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> pairs <a class="code" href="patch__mevb_8cpp.html#a408216eef095a35ba3963fc6f4f4d7a8">found</a>
<a name="l14365"></a>14365                             <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> specified <a class="code" href="mscbutil_8c.html#ad856acfe9ce335571b00a73df5e23e6b">interval</a> <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> placed into
<a name="l14366"></a>14366                             time_buffer <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> <a class="code" href="v1724__module_8c.html#ab4c1e3e1d0abf76b1eef9c2841ee27cd">data_buffer</a>
<a name="l14367"></a>14367 
<a name="l14368"></a>14368 
<a name="l14369"></a>14369   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l14370"></a>14370     <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>              Successful completion
<a name="l14371"></a>14371     HS_NO_MEMEORY           Out of memory
<a name="l14372"></a>14372     <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>           Cannot open <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file
<a name="l14373"></a>14373     <a class="code" href="group__err26.html#gab8c5289d12d853f0d8266cdf37c39b08">HS_WRONG_INDEX</a>          <a class="code" href="lcd__menu_8c.html#a13b219e0dd828c9f136b7bb99d8afc34">var_index</a> exceeds array <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> of <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a>
<a name="l14374"></a>14374     <a class="code" href="group__err26.html#ga1b25c77e3145468cf83f8e88bf1e0804">HS_UNDEFINED_VAR</a>        Variable <span class="stringliteral">&quot;tag_name&quot;</span> not <a class="code" href="patch__mevb_8cpp.html#a408216eef095a35ba3963fc6f4f4d7a8">found</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> <span class="keyword">event</span>
<a name="l14375"></a>14375     <a class="code" href="group__err26.html#ga8b8cfc047a951f9afe9f833484d7e814">HS_TRUNCATED</a>            Buffer too small, <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> has been truncated
<a name="l14376"></a>14376 
<a name="l14377"></a>14377 \********************************************************************/
<a name="l14378"></a>14378 {
<a name="l14379"></a>14379    <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> prev_time, last_irec_time;
<a name="l14380"></a>14380    <span class="keywordtype">int</span> fh, fhd, fhi, cp = 0;
<a name="l14381"></a>14381    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, delta, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> = 0, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, cache_size;
<a name="l14382"></a>14382    <a class="code" href="structINDEX__RECORD.html">INDEX_RECORD</a> irec, *pirec;
<a name="l14383"></a>14383    <a class="code" href="structHIST__RECORD.html">HIST_RECORD</a> rec, drec;
<a name="l14384"></a>14384    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> old_def_offset, var_size = 0, var_offset = 0;
<a name="l14385"></a>14385    <a class="code" href="structTAG.html">TAG</a> *<a class="code" href="mhist_8c.html#a27ce05f73a16e6abc070da1007833b9b">tag</a>;
<a name="l14386"></a>14386    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>];
<a name="l14387"></a>14387    <span class="keyword">struct </span>tm *tms;
<a name="l14388"></a>14388    <span class="keywordtype">char</span> *<a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>;
<a name="l14389"></a>14389 
<a name="l14390"></a>14390    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga0090933001e7e1ddd52ed3f321bea957">rpc_is_remote</a>())
<a name="l14391"></a>14391       <span class="keywordflow">return</span> <a class="code" href="group__msectionh.html#ga6bf1d13a0c49a3f7a02650885937b5e7">rpc_call</a>(<a class="code" href="group__mrpcdefineh.html#gae54df220cd65f15f7669bba8f031e6a6">RPC_HS_READ</a>, <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>, <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>, end_time, <a class="code" href="mscbutil_8c.html#ad856acfe9ce335571b00a73df5e23e6b">interval</a>,
<a name="l14392"></a>14392                       tag_name, <a class="code" href="lcd__menu_8c.html#a13b219e0dd828c9f136b7bb99d8afc34">var_index</a>, time_buffer, tbsize, <a class="code" href="v1724__module_8c.html#ab4c1e3e1d0abf76b1eef9c2841ee27cd">data_buffer</a>,
<a name="l14393"></a>14393                       dbsize, <a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l14394"></a>14394 
<a name="l14395"></a>14395    <span class="comment">/* if not time given, use present to one hour in past */</span>
<a name="l14396"></a>14396    <span class="keywordflow">if</span> (<a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a> == 0)
<a name="l14397"></a>14397       <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a> = <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(NULL) - 3600;
<a name="l14398"></a>14398    <span class="keywordflow">if</span> (end_time == 0)
<a name="l14399"></a>14399       end_time = <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(NULL);
<a name="l14400"></a>14400 
<a name="l14401"></a>14401    <span class="comment">/* search history file for start_time */</span>
<a name="l14402"></a>14402    <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a> = <a class="code" href="group__hsfunctionc.html#ga1ebb4cc3c2f54b895e14c665db26531d">hs_search_file</a>(&amp;<a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>, 1);
<a name="l14403"></a>14403    <span class="keywordflow">if</span> (<a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a> != <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>) {
<a name="l14404"></a>14404       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_read&quot;</span>, <span class="stringliteral">&quot;cannot find recent history file&quot;</span>);
<a name="l14405"></a>14405       *tbsize = *dbsize = *<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = 0;
<a name="l14406"></a>14406       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14407"></a>14407    }
<a name="l14408"></a>14408 
<a name="l14409"></a>14409    <span class="comment">/* open history and definition files */</span>
<a name="l14410"></a>14410    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(<a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>, <span class="stringliteral">&quot;hst&quot;</span>, O_RDONLY, &amp;fh);
<a name="l14411"></a>14411    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(<a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>, <span class="stringliteral">&quot;idf&quot;</span>, O_RDONLY, &amp;fhd);
<a name="l14412"></a>14412    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(<a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>, <span class="stringliteral">&quot;idx&quot;</span>, O_RDONLY, &amp;fhi);
<a name="l14413"></a>14413    <span class="keywordflow">if</span> (fh &lt; 0 || fhd &lt; 0 || fhi &lt; 0) {
<a name="l14414"></a>14414       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_read&quot;</span>, <span class="stringliteral">&quot;cannot open index files&quot;</span>);
<a name="l14415"></a>14415       *tbsize = *dbsize = *<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = 0;
<a name="l14416"></a>14416       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14417"></a>14417    }
<a name="l14418"></a>14418 
<a name="l14419"></a>14419    <span class="comment">/* try to read index file into cache */</span>
<a name="l14420"></a>14420    lseek(fhi, 0, SEEK_END);
<a name="l14421"></a>14421    cache_size = <a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fhi);
<a name="l14422"></a>14422 
<a name="l14423"></a>14423    <span class="keywordflow">if</span> (cache_size &gt; 0) {
<a name="l14424"></a>14424       cache = (<span class="keywordtype">char</span> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(cache_size);
<a name="l14425"></a>14425       <span class="keywordflow">if</span> (cache) {
<a name="l14426"></a>14426          lseek(fhi, 0, SEEK_SET);
<a name="l14427"></a>14427          i = <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhi, cache, cache_size);
<a name="l14428"></a>14428          <span class="keywordflow">if</span> (i &lt; cache_size) {
<a name="l14429"></a>14429             <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(cache);
<a name="l14430"></a>14430             close(fh);
<a name="l14431"></a>14431             close(fhd);
<a name="l14432"></a>14432             close(fhi);
<a name="l14433"></a>14433             <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14434"></a>14434          }
<a name="l14435"></a>14435       }
<a name="l14436"></a>14436 
<a name="l14437"></a>14437       <span class="comment">/* search record closest to start time */</span>
<a name="l14438"></a>14438       <span class="keywordflow">if</span> (cache == NULL) {
<a name="l14439"></a>14439          lseek(fhi, 0, SEEK_END);
<a name="l14440"></a>14440          delta = (<a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fhi) / <span class="keyword">sizeof</span>(irec)) / 2;
<a name="l14441"></a>14441          lseek(fhi, delta * <span class="keyword">sizeof</span>(irec), SEEK_SET);
<a name="l14442"></a>14442          <span class="keywordflow">do</span> {
<a name="l14443"></a>14443             delta = (int) (<a class="code" href="generic_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(delta) / 2.0 + 0.5);
<a name="l14444"></a>14444             <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhi, (<span class="keywordtype">char</span> *) &amp;irec, <span class="keyword">sizeof</span>(irec));
<a name="l14445"></a>14445             <span class="keywordflow">if</span> (irec.time &gt; <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>)
<a name="l14446"></a>14446                delta = -delta;
<a name="l14447"></a>14447 
<a name="l14448"></a>14448             lseek(fhi, (delta - 1) * <span class="keyword">sizeof</span>(irec), SEEK_CUR);
<a name="l14449"></a>14449          } <span class="keywordflow">while</span> (<a class="code" href="generic_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(delta) &gt; 1 &amp;&amp; irec.time != <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>);
<a name="l14450"></a>14450          <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhi, (<span class="keywordtype">char</span> *) &amp;irec, <span class="keyword">sizeof</span>(irec));
<a name="l14451"></a>14451          <span class="keywordflow">if</span> (irec.time &gt; <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>)
<a name="l14452"></a>14452             delta = -<a class="code" href="generic_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(delta);
<a name="l14453"></a>14453 
<a name="l14454"></a>14454          i = <a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fhi) + (delta - 1) * <span class="keyword">sizeof</span>(irec);
<a name="l14455"></a>14455          <span class="keywordflow">if</span> (i &lt;= 0)
<a name="l14456"></a>14456             lseek(fhi, 0, SEEK_SET);
<a name="l14457"></a>14457          <span class="keywordflow">else</span>
<a name="l14458"></a>14458             lseek(fhi, (delta - 1) * <span class="keyword">sizeof</span>(irec), SEEK_CUR);
<a name="l14459"></a>14459          <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhi, (<span class="keywordtype">char</span> *) &amp;irec, <span class="keyword">sizeof</span>(irec));
<a name="l14460"></a>14460       } <span class="keywordflow">else</span> {
<a name="l14461"></a>14461          delta = (cache_size / <span class="keyword">sizeof</span>(irec)) / 2;
<a name="l14462"></a>14462          cp = delta * <span class="keyword">sizeof</span>(irec);
<a name="l14463"></a>14463          <span class="keywordflow">do</span> {
<a name="l14464"></a>14464             delta = (int) (<a class="code" href="generic_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(delta) / 2.0 + 0.5);
<a name="l14465"></a>14465             pirec = (<a class="code" href="structINDEX__RECORD.html">INDEX_RECORD</a> *) (cache + cp);
<a name="l14466"></a>14466             <span class="keywordflow">if</span> (pirec-&gt;<a class="code" href="group__midasincludecode.html#ga729b9b6590da0af9a8c9984d0d58a8d7">time</a> &gt; <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>)
<a name="l14467"></a>14467                delta = -delta;
<a name="l14468"></a>14468 
<a name="l14469"></a>14469             cp = cp + delta * <span class="keyword">sizeof</span>(irec);
<a name="l14470"></a>14470          } <span class="keywordflow">while</span> (<a class="code" href="generic_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(delta) &gt; 1 &amp;&amp; pirec-&gt;<a class="code" href="group__midasincludecode.html#ga729b9b6590da0af9a8c9984d0d58a8d7">time</a> != <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>);
<a name="l14471"></a>14471          pirec = (<a class="code" href="structINDEX__RECORD.html">INDEX_RECORD</a> *) (cache + cp);
<a name="l14472"></a>14472          <span class="keywordflow">if</span> (pirec-&gt;<a class="code" href="group__midasincludecode.html#ga729b9b6590da0af9a8c9984d0d58a8d7">time</a> &gt; <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>)
<a name="l14473"></a>14473             delta = -<a class="code" href="generic_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(delta);
<a name="l14474"></a>14474 
<a name="l14475"></a>14475          <span class="keywordflow">if</span> (cp &lt;= delta * (<span class="keywordtype">int</span>) <span class="keyword">sizeof</span>(irec))
<a name="l14476"></a>14476             cp = 0;
<a name="l14477"></a>14477          <span class="keywordflow">else</span>
<a name="l14478"></a>14478             cp = cp + delta * <span class="keyword">sizeof</span>(irec);
<a name="l14479"></a>14479 
<a name="l14480"></a>14480          <span class="keywordflow">if</span> (cp &gt;= cache_size)
<a name="l14481"></a>14481             cp = cache_size - <span class="keyword">sizeof</span>(irec);
<a name="l14482"></a>14482          <span class="keywordflow">if</span> (cp &lt; 0)
<a name="l14483"></a>14483             cp = 0;
<a name="l14484"></a>14484 
<a name="l14485"></a>14485          memcpy(&amp;irec, (<a class="code" href="structINDEX__RECORD.html">INDEX_RECORD</a> *) (cache + cp), <span class="keyword">sizeof</span>(irec));
<a name="l14486"></a>14486          cp += <span class="keyword">sizeof</span>(irec);
<a name="l14487"></a>14487       }
<a name="l14488"></a>14488    } <span class="keywordflow">else</span> {                     <span class="comment">/* file size &gt; 0 */</span>
<a name="l14489"></a>14489 
<a name="l14490"></a>14490       cache = NULL;
<a name="l14491"></a>14491       irec.time = <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>;
<a name="l14492"></a>14492    }
<a name="l14493"></a>14493 
<a name="l14494"></a>14494    <span class="comment">/* read records, skip wrong IDs */</span>
<a name="l14495"></a>14495    old_def_offset = -1;
<a name="l14496"></a>14496    *<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = 0;
<a name="l14497"></a>14497    prev_time = 0;
<a name="l14498"></a>14498    last_irec_time = 0;
<a name="l14499"></a>14499    <span class="keywordflow">do</span> {
<a name="l14500"></a>14500       <span class="keywordflow">if</span> (irec.time &lt; last_irec_time) {
<a name="l14501"></a>14501          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_read&quot;</span>,
<a name="l14502"></a>14502                 <span class="stringliteral">&quot;corrupted history data: time does not increase: %d -&gt; %d&quot;</span>,
<a name="l14503"></a>14503                 last_irec_time, irec.time);
<a name="l14504"></a>14504          *tbsize = *dbsize = *<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = 0;
<a name="l14505"></a>14505          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l14506"></a>14506       }
<a name="l14507"></a>14507       last_irec_time = irec.time;
<a name="l14508"></a>14508       <span class="keywordflow">if</span> (irec.event_id == <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a> &amp;&amp; irec.time &lt;= end_time &amp;&amp; irec.time &gt;= <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>) {
<a name="l14509"></a>14509          <span class="comment">/* check if record time more than &quot;interval&quot; seconds after previous time */</span>
<a name="l14510"></a>14510          <span class="keywordflow">if</span> (irec.time &gt;= prev_time + <a class="code" href="mscbutil_8c.html#ad856acfe9ce335571b00a73df5e23e6b">interval</a>) {
<a name="l14511"></a>14511             prev_time = irec.time;
<a name="l14512"></a>14512             lseek(fh, irec.offset, SEEK_SET);
<a name="l14513"></a>14513             <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, (<span class="keywordtype">char</span> *) &amp;rec, <span class="keyword">sizeof</span>(rec));
<a name="l14514"></a>14514 
<a name="l14515"></a>14515             <span class="comment">/* if definition changed, read new definition */</span>
<a name="l14516"></a>14516             <span class="keywordflow">if</span> ((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) rec.def_offset != old_def_offset) {
<a name="l14517"></a>14517                lseek(fh, rec.def_offset, SEEK_SET);
<a name="l14518"></a>14518                <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, (<span class="keywordtype">char</span> *) &amp;drec, <span class="keyword">sizeof</span>(drec));
<a name="l14519"></a>14519                <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, str, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>);
<a name="l14520"></a>14520 
<a name="l14521"></a>14521                tag = (<a class="code" href="structTAG.html">TAG</a> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(drec.data_size);
<a name="l14522"></a>14522                <span class="keywordflow">if</span> (tag == NULL) {
<a name="l14523"></a>14523                   *<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = *tbsize = *dbsize = 0;
<a name="l14524"></a>14524                   <span class="keywordflow">if</span> (cache)
<a name="l14525"></a>14525                      <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(cache);
<a name="l14526"></a>14526                   close(fh);
<a name="l14527"></a>14527                   close(fhd);
<a name="l14528"></a>14528                   close(fhi);
<a name="l14529"></a>14529                   <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga8d2556d6b5d8902646a36e3aa7e71dc5">HS_NO_MEMORY</a>;
<a name="l14530"></a>14530                }
<a name="l14531"></a>14531                <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, (<span class="keywordtype">char</span> *) tag, drec.data_size);
<a name="l14532"></a>14532 
<a name="l14533"></a>14533                <span class="comment">/* find index of tag_name in new definition */</span>
<a name="l14534"></a>14534                index = -1;
<a name="l14535"></a>14535                <span class="keywordflow">for</span> (i = 0; (<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>) i &lt; drec.data_size / <span class="keyword">sizeof</span>(<a class="code" href="structTAG.html">TAG</a>); i++)
<a name="l14536"></a>14536                   <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(tag[i].<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>, tag_name)) {
<a name="l14537"></a>14537                      index = i;
<a name="l14538"></a>14538                      <span class="keywordflow">break</span>;
<a name="l14539"></a>14539                   }
<a name="l14540"></a>14540 
<a name="l14541"></a>14541                <span class="comment">/*</span>
<a name="l14542"></a>14542 <span class="comment">                  if ((DWORD) i == drec.data_size/sizeof(TAG))</span>
<a name="l14543"></a>14543 <span class="comment">                  {</span>
<a name="l14544"></a>14544 <span class="comment">                  *n = *tbsize = *dbsize = 0;</span>
<a name="l14545"></a>14545 <span class="comment">                  if (cache)</span>
<a name="l14546"></a>14546 <span class="comment">                  M_FREE(cache);</span>
<a name="l14547"></a>14547 <span class="comment"></span>
<a name="l14548"></a>14548 <span class="comment">                  return HS_UNDEFINED_VAR;</span>
<a name="l14549"></a>14549 <span class="comment">                  }</span>
<a name="l14550"></a>14550 <span class="comment">                */</span>
<a name="l14551"></a>14551 
<a name="l14552"></a>14552                <span class="keywordflow">if</span> (index &gt;= 0 &amp;&amp; <a class="code" href="lcd__menu_8c.html#a13b219e0dd828c9f136b7bb99d8afc34">var_index</a> &gt;= tag[i].n_data) {
<a name="l14553"></a>14553                   *<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = *tbsize = *dbsize = 0;
<a name="l14554"></a>14554                   <span class="keywordflow">if</span> (cache)
<a name="l14555"></a>14555                      <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(cache);
<a name="l14556"></a>14556                   <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(tag);
<a name="l14557"></a>14557                   close(fh);
<a name="l14558"></a>14558                   close(fhd);
<a name="l14559"></a>14559                   close(fhi);
<a name="l14560"></a>14560                   <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gab8c5289d12d853f0d8266cdf37c39b08">HS_WRONG_INDEX</a>;
<a name="l14561"></a>14561                }
<a name="l14562"></a>14562 
<a name="l14563"></a>14563                <span class="comment">/* calculate offset for variable */</span>
<a name="l14564"></a>14564                <span class="keywordflow">if</span> (index &gt;= 0) {
<a name="l14565"></a>14565                   *<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a> = tag[i].<a class="code" href="group__midasincludecode.html#ga3fdedadca645679ef114cc651a978d17">type</a>;
<a name="l14566"></a>14566 
<a name="l14567"></a>14567                   <span class="comment">/* loop over all previous variables */</span>
<a name="l14568"></a>14568                   <span class="keywordflow">for</span> (i = 0, var_offset = 0; i &lt; index; i++)
<a name="l14569"></a>14569                      var_offset += <a class="code" href="group__msectionh.html#gaa0bf5cc257f83e9a7f3936738fe009f3">rpc_tid_size</a>(tag[i].<a class="code" href="mana_8cpp.html#a9a59b4d9fa62abe25a78cc38137ffd8e">type</a>) * tag[i].<a class="code" href="group__midasincludecode.html#gaec010a11e0792b46f71ba64fae6f44e8">n_data</a>;
<a name="l14570"></a>14570 
<a name="l14571"></a>14571                   <span class="comment">/* strings have size n_data */</span>
<a name="l14572"></a>14572                   <span class="keywordflow">if</span> (tag[index].type == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>)
<a name="l14573"></a>14573                      var_size = tag[i].<a class="code" href="group__midasincludecode.html#gaec010a11e0792b46f71ba64fae6f44e8">n_data</a>;
<a name="l14574"></a>14574                   <span class="keywordflow">else</span>
<a name="l14575"></a>14575                      var_size = <a class="code" href="group__msectionh.html#gaa0bf5cc257f83e9a7f3936738fe009f3">rpc_tid_size</a>(tag[index].type);
<a name="l14576"></a>14576 
<a name="l14577"></a>14577                   var_offset += var_size * <a class="code" href="lcd__menu_8c.html#a13b219e0dd828c9f136b7bb99d8afc34">var_index</a>;
<a name="l14578"></a>14578                }
<a name="l14579"></a>14579 
<a name="l14580"></a>14580                <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(tag);
<a name="l14581"></a>14581                old_def_offset = rec.def_offset;
<a name="l14582"></a>14582                lseek(fh, irec.offset + <span class="keyword">sizeof</span>(rec), SEEK_SET);
<a name="l14583"></a>14583             }
<a name="l14584"></a>14584 
<a name="l14585"></a>14585             <span class="keywordflow">if</span> (index &gt;= 0) {
<a name="l14586"></a>14586                <span class="comment">/* check if data fits in buffers */</span>
<a name="l14587"></a>14587                <span class="keywordflow">if</span> ((*<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) * <span class="keyword">sizeof</span>(<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>) &gt;= *tbsize || (*<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) * var_size &gt;= *dbsize) {
<a name="l14588"></a>14588                   *dbsize = (*n) * var_size;
<a name="l14589"></a>14589                   *tbsize = (*n) * <span class="keyword">sizeof</span>(<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>);
<a name="l14590"></a>14590                   <span class="keywordflow">if</span> (cache)
<a name="l14591"></a>14591                      <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(cache);
<a name="l14592"></a>14592                   close(fh);
<a name="l14593"></a>14593                   close(fhd);
<a name="l14594"></a>14594                   close(fhi);
<a name="l14595"></a>14595                   <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga8b8cfc047a951f9afe9f833484d7e814">HS_TRUNCATED</a>;
<a name="l14596"></a>14596                }
<a name="l14597"></a>14597 
<a name="l14598"></a>14598                <span class="comment">/* copy time from header */</span>
<a name="l14599"></a>14599                time_buffer[*<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>] = irec.time;
<a name="l14600"></a>14600 
<a name="l14601"></a>14601                <span class="comment">/* copy data from record */</span>
<a name="l14602"></a>14602                lseek(fh, var_offset, SEEK_CUR);
<a name="l14603"></a>14603                <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fh, (<span class="keywordtype">char</span> *) <a class="code" href="v1724__module_8c.html#ab4c1e3e1d0abf76b1eef9c2841ee27cd">data_buffer</a> + (*<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) * var_size, var_size);
<a name="l14604"></a>14604 
<a name="l14605"></a>14605                <span class="comment">/* increment counter */</span>
<a name="l14606"></a>14606                (*n)++;
<a name="l14607"></a>14607             }
<a name="l14608"></a>14608          }
<a name="l14609"></a>14609       }
<a name="l14610"></a>14610 
<a name="l14611"></a>14611       <span class="comment">/* read next index record */</span>
<a name="l14612"></a>14612       <span class="keywordflow">if</span> (cache) {
<a name="l14613"></a>14613          <span class="keywordflow">if</span> (cp &gt;= cache_size) {
<a name="l14614"></a>14614             i = -1;
<a name="l14615"></a>14615             <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(cache);
<a name="l14616"></a>14616             cache = NULL;
<a name="l14617"></a>14617          } <span class="keywordflow">else</span>
<a name="l14618"></a>14618             i = <span class="keyword">sizeof</span>(irec);
<a name="l14619"></a>14619 
<a name="l14620"></a>14620          <span class="keywordflow">if</span> (cp &lt; cache_size) {
<a name="l14621"></a>14621             memcpy(&amp;irec, cache + cp, <span class="keyword">sizeof</span>(irec));
<a name="l14622"></a>14622             cp += <span class="keyword">sizeof</span>(irec);
<a name="l14623"></a>14623          }
<a name="l14624"></a>14624       } <span class="keywordflow">else</span>
<a name="l14625"></a>14625          i = <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhi, (<span class="keywordtype">char</span> *) &amp;irec, <span class="keyword">sizeof</span>(irec));
<a name="l14626"></a>14626 
<a name="l14627"></a>14627       <span class="comment">/* end of file: search next history file */</span>
<a name="l14628"></a>14628       <span class="keywordflow">if</span> (i &lt;= 0) {
<a name="l14629"></a>14629          close(fh);
<a name="l14630"></a>14630          close(fhd);
<a name="l14631"></a>14631          close(fhi);
<a name="l14632"></a>14632 
<a name="l14633"></a>14633          <span class="comment">/* advance one day */</span>
<a name="l14634"></a>14634          tms = localtime((<span class="keyword">const</span> time_t *) &amp;last_irec_time);
<a name="l14635"></a>14635          tms-&gt;tm_hour = tms-&gt;tm_min = tms-&gt;tm_sec = 0;
<a name="l14636"></a>14636          last_irec_time = mktime(tms);
<a name="l14637"></a>14637 
<a name="l14638"></a>14638          last_irec_time += 3600 * 24;
<a name="l14639"></a>14639 
<a name="l14640"></a>14640          <span class="keywordflow">if</span> (last_irec_time &gt; end_time)
<a name="l14641"></a>14641             <span class="keywordflow">break</span>;
<a name="l14642"></a>14642 
<a name="l14643"></a>14643          <span class="comment">/* search next file */</span>
<a name="l14644"></a>14644          <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a> = <a class="code" href="group__hsfunctionc.html#ga1ebb4cc3c2f54b895e14c665db26531d">hs_search_file</a>(&amp;last_irec_time, 1);
<a name="l14645"></a>14645          <span class="keywordflow">if</span> (<a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a> != <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>)
<a name="l14646"></a>14646             <span class="keywordflow">break</span>;
<a name="l14647"></a>14647 
<a name="l14648"></a>14648          <span class="comment">/* open history and definition files */</span>
<a name="l14649"></a>14649          <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(last_irec_time, <span class="stringliteral">&quot;hst&quot;</span>, O_RDONLY, &amp;fh);
<a name="l14650"></a>14650          <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(last_irec_time, <span class="stringliteral">&quot;idf&quot;</span>, O_RDONLY, &amp;fhd);
<a name="l14651"></a>14651          <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(last_irec_time, <span class="stringliteral">&quot;idx&quot;</span>, O_RDONLY, &amp;fhi);
<a name="l14652"></a>14652          <span class="keywordflow">if</span> (fh &lt; 0 || fhd &lt; 0 || fhi &lt; 0) {
<a name="l14653"></a>14653             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hs_read&quot;</span>, <span class="stringliteral">&quot;cannot open index files&quot;</span>);
<a name="l14654"></a>14654             <span class="keywordflow">break</span>;
<a name="l14655"></a>14655          }
<a name="l14656"></a>14656 
<a name="l14657"></a>14657          <span class="comment">/* try to read index file into cache */</span>
<a name="l14658"></a>14658          lseek(fhi, 0, SEEK_END);
<a name="l14659"></a>14659          cache_size = <a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fhi);
<a name="l14660"></a>14660          lseek(fhi, 0, SEEK_SET);
<a name="l14661"></a>14661          cache = (<span class="keywordtype">char</span> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(cache_size);
<a name="l14662"></a>14662          <span class="keywordflow">if</span> (cache) {
<a name="l14663"></a>14663             i = <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhi, cache, cache_size);
<a name="l14664"></a>14664             <span class="keywordflow">if</span> (i &lt; cache_size)
<a name="l14665"></a>14665                <span class="keywordflow">break</span>;
<a name="l14666"></a>14666             <span class="comment">/* read first record */</span>
<a name="l14667"></a>14667             cp = 0;
<a name="l14668"></a>14668             memcpy(&amp;irec, cache, <span class="keyword">sizeof</span>(irec));
<a name="l14669"></a>14669          } <span class="keywordflow">else</span> {
<a name="l14670"></a>14670             <span class="comment">/* read first record */</span>
<a name="l14671"></a>14671             i = <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a>(fhi, (<span class="keywordtype">char</span> *) &amp;irec, <span class="keyword">sizeof</span>(irec));
<a name="l14672"></a>14672             <span class="keywordflow">if</span> (i &lt;= 0)
<a name="l14673"></a>14673                <span class="keywordflow">break</span>;
<a name="l14674"></a>14674          }
<a name="l14675"></a>14675 
<a name="l14676"></a>14676          <span class="comment">/* old definition becomes invalid */</span>
<a name="l14677"></a>14677          old_def_offset = -1;
<a name="l14678"></a>14678       }
<a name="l14679"></a>14679    } <span class="keywordflow">while</span> (irec.time &lt; end_time);
<a name="l14680"></a>14680 
<a name="l14681"></a>14681    <span class="keywordflow">if</span> (cache)
<a name="l14682"></a>14682       <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(cache);
<a name="l14683"></a>14683    close(fh);
<a name="l14684"></a>14684    close(fhd);
<a name="l14685"></a>14685    close(fhi);
<a name="l14686"></a>14686 
<a name="l14687"></a>14687    *dbsize = *<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> * var_size;
<a name="l14688"></a>14688    *tbsize = *<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> * <span class="keyword">sizeof</span>(<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>);
<a name="l14689"></a>14689 
<a name="l14690"></a>14690    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>;
<a name="l14691"></a>14691 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga1ebb4cc3c2f54b895e14c665db26531d"></a><!-- doxytag: member="midas.c::hs_search_file" ref="ga1ebb4cc3c2f54b895e14c665db26531d" args="(DWORD *ltime, INT direction)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> hs_search_file </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> *&nbsp;</td>
          <td class="paramname"> <em>ltime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>direction</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l13394">13394</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l01093">HS_FILE_ERROR</a>, <a class="el" href="midas_8c_source.html#l13299">hs_gen_index()</a>, <a class="el" href="midas_8c_source.html#l13271">hs_open_file()</a>, <a class="el" href="midas_8h_source.html#l01092">HS_SUCCESS</a>, and <a class="el" href="CAET_8h_source.html#l00002">time</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l13907">hs_count_events()</a>, <a class="el" href="midas_8c_source.html#l14064">hs_count_vars()</a>, <a class="el" href="midas_8c_source.html#l14695">hs_dump()</a>, <a class="el" href="midas_8c_source.html#l13818">hs_enum_events()</a>, <a class="el" href="midas_8c_source.html#l14134">hs_enum_vars()</a>, <a class="el" href="midas_8c_source.html#l13985">hs_get_event_id()</a>, <a class="el" href="midas_8c_source.html#l14241">hs_get_var()</a>, and <a class="el" href="midas_8c_source.html#l14339">hs_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l13397"></a>13397          : <a class="code" href="group__hsfunctionc.html#ga1ebb4cc3c2f54b895e14c665db26531d">hs_search_file</a>
<a name="l13398"></a>13398 
<a name="l13399"></a>13399   Purpose: Search an <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file <span class="keywordflow">for</span> a given date. If not <a class="code" href="patch__mevb_8cpp.html#a408216eef095a35ba3963fc6f4f4d7a8">found</a>,
<a name="l13400"></a>13400            look <span class="keywordflow">for</span> files after date (direction==1) <a class="code" href="examples_2macro_2midas__macro_8h.html#a339a611d7f9dc3a59c359f0da7beaf3c">or</a> before date
<a name="l13401"></a>13401            (direction==-1) up to one year.
<a name="l13402"></a>13402 
<a name="l13403"></a>13403   Input:
<a name="l13404"></a>13404     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  *ltime           Date of <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file
<a name="l13405"></a>13405     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>    direction        Search direction
<a name="l13406"></a>13406 
<a name="l13407"></a>13407   Output:
<a name="l13408"></a>13408     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  *ltime           Date of <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file <a class="code" href="patch__mevb_8cpp.html#a408216eef095a35ba3963fc6f4f4d7a8">found</a>
<a name="l13409"></a>13409 
<a name="l13410"></a>13410   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l13411"></a>13411     <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>              Successful completion
<a name="l13412"></a>13412     <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>           No file <a class="code" href="patch__mevb_8cpp.html#a408216eef095a35ba3963fc6f4f4d7a8">found</a>
<a name="l13413"></a>13413 
<a name="l13414"></a>13414 \********************************************************************/
<a name="l13415"></a>13415 {
<a name="l13416"></a>13416    <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> lt;
<a name="l13417"></a>13417    <span class="keywordtype">int</span> fh, fhd, fhi;
<a name="l13418"></a>13418    <span class="keyword">struct </span>tm *tms;
<a name="l13419"></a>13419 
<a name="l13420"></a>13420    <span class="keywordflow">if</span> (*ltime == 0)
<a name="l13421"></a>13421       *ltime = <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(NULL);
<a name="l13422"></a>13422 
<a name="l13423"></a>13423    lt = *ltime;
<a name="l13424"></a>13424    <span class="keywordflow">do</span> {
<a name="l13425"></a>13425       <span class="comment">/* try to open history file for date &quot;lt&quot; */</span>
<a name="l13426"></a>13426       <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(lt, <span class="stringliteral">&quot;hst&quot;</span>, O_RDONLY, &amp;fh);
<a name="l13427"></a>13427 
<a name="l13428"></a>13428       <span class="comment">/* if not found, look for next day */</span>
<a name="l13429"></a>13429       <span class="keywordflow">if</span> (fh &lt; 0)
<a name="l13430"></a>13430          lt += direction * 3600 * 24;
<a name="l13431"></a>13431 
<a name="l13432"></a>13432       <span class="comment">/* stop if more than a year before starting point or in the future */</span>
<a name="l13433"></a>13433    } <span class="keywordflow">while</span> (fh &lt; 0 &amp;&amp; (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) * ltime - (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) lt &lt; 3600 * 24 * 365 &amp;&amp;
<a name="l13434"></a>13434             lt &lt; (<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>) <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(NULL));
<a name="l13435"></a>13435 
<a name="l13436"></a>13436    <span class="keywordflow">if</span> (fh &lt; 0)
<a name="l13437"></a>13437       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l13438"></a>13438 
<a name="l13439"></a>13439    <span class="keywordflow">if</span> (lt != *ltime) {
<a name="l13440"></a>13440       <span class="comment">/* if switched to new day, set start_time to 0:00 */</span>
<a name="l13441"></a>13441       tms = localtime((<span class="keyword">const</span> time_t *) &amp;lt);
<a name="l13442"></a>13442       tms-&gt;tm_hour = tms-&gt;tm_min = tms-&gt;tm_sec = 0;
<a name="l13443"></a>13443       *ltime = mktime(tms);
<a name="l13444"></a>13444    }
<a name="l13445"></a>13445 
<a name="l13446"></a>13446    <span class="comment">/* check if index files are there */</span>
<a name="l13447"></a>13447    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(*ltime, <span class="stringliteral">&quot;idf&quot;</span>, O_RDONLY, &amp;fhd);
<a name="l13448"></a>13448    <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(*ltime, <span class="stringliteral">&quot;idx&quot;</span>, O_RDONLY, &amp;fhi);
<a name="l13449"></a>13449 
<a name="l13450"></a>13450    close(fh);
<a name="l13451"></a>13451    close(fhd);
<a name="l13452"></a>13452    close(fhi);
<a name="l13453"></a>13453 
<a name="l13454"></a>13454    <span class="comment">/* generate them if not */</span>
<a name="l13455"></a>13455    <span class="keywordflow">if</span> (fhd &lt; 0 || fhi &lt; 0)
<a name="l13456"></a>13456       <a class="code" href="group__hsfunctionc.html#ga0e7b43f0ca043d04fb5716b8da02d41f">hs_gen_index</a>(*ltime);
<a name="l13457"></a>13457 
<a name="l13458"></a>13458    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>;
<a name="l13459"></a>13459 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gadd381765666fd1aa3395b63b86d44887"></a><!-- doxytag: member="midas.c::hs_set_path" ref="gadd381765666fd1aa3395b63b86d44887" args="(char *path)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> hs_set_path </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox Sets the path for future history file accesses. Should be called before any other history function is called. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>Directory where history files reside </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>HS_SUCCESS </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l13244">13244</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l00639">DIR_SEPARATOR</a>, <a class="el" href="midas_8h_source.html#l00640">DIR_SEPARATOR_STR</a>, <a class="el" href="midas_8h_source.html#l01092">HS_SUCCESS</a>, <a class="el" href="midas_8c_source.html#l09810">rpc_call()</a>, <a class="el" href="mrpc_8h_source.html#l00172">RPC_HS_SET_PATH</a>, and <a class="el" href="midas_8c_source.html#l09022">rpc_is_remote()</a>.</p>

<p>Referenced by <a class="el" href="mhttpd_8c_source.html#l07289">generate_hist_graph()</a>, <a class="el" href="mhist_8c_source.html#l00455">main()</a>, <a class="el" href="fal_8c_source.html#l01573">open_history()</a>, and <a class="el" href="mserver_8c_source.html#l00534">rpc_server_dispatch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l13245"></a>13245 {
<a name="l13246"></a>13246    <span class="comment">/* set path locally and remotely */</span>
<a name="l13247"></a>13247    <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga0090933001e7e1ddd52ed3f321bea957">rpc_is_remote</a>())
<a name="l13248"></a>13248       <a class="code" href="group__msectionh.html#ga6bf1d13a0c49a3f7a02650885937b5e7">rpc_call</a>(<a class="code" href="group__mrpcdefineh.html#gae96ac179fd36bfa722adab529b8d547e">RPC_HS_SET_PATH</a>, path);
<a name="l13249"></a>13249 
<a name="l13250"></a>13250    strcpy(<a class="code" href="group__hsfunctionc.html#ga6bfae86238964396b88c3d62aa3e0e3b">_hs_path_name</a>, path);
<a name="l13251"></a>13251 
<a name="l13252"></a>13252    <span class="comment">/* check for trailing directory seperator */</span>
<a name="l13253"></a>13253    <span class="keywordflow">if</span> (strlen(<a class="code" href="group__hsfunctionc.html#ga6bfae86238964396b88c3d62aa3e0e3b">_hs_path_name</a>) &gt; 0 &amp;&amp;
<a name="l13254"></a>13254        <a class="code" href="group__hsfunctionc.html#ga6bfae86238964396b88c3d62aa3e0e3b">_hs_path_name</a>[strlen(<a class="code" href="group__hsfunctionc.html#ga6bfae86238964396b88c3d62aa3e0e3b">_hs_path_name</a>) - 1] != <a class="code" href="group__midasincludecode.html#ga0920890c442b665b0c6609fa796e9047">DIR_SEPARATOR</a>)
<a name="l13255"></a>13255       strcat(<a class="code" href="group__hsfunctionc.html#ga6bfae86238964396b88c3d62aa3e0e3b">_hs_path_name</a>, <a class="code" href="group__midasincludecode.html#ga23e72ca2d8456a971c13441bdfc4586f">DIR_SEPARATOR_STR</a>);
<a name="l13256"></a>13256 
<a name="l13257"></a>13257    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>;
<a name="l13258"></a>13258 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga4ff8aeb548c6c3ace16fa8e9ec77a5d5"></a><!-- doxytag: member="midas.c::hs_write_event" ref="ga4ff8aeb548c6c3ace16fa8e9ec77a5d5" args="(DWORD event_id, void *data, DWORD size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> hs_write_event </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>event_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l13688">13688</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l01581">HISTORY::base_time</a>, <a class="el" href="midas_8h_source.html#l01558">HIST_RECORD::data_size</a>, <a class="el" href="midas_8h_source.html#l01580">HISTORY::def_fh</a>, <a class="el" href="midas_8h_source.html#l01564">DEF_RECORD::def_offset</a>, <a class="el" href="midas_8h_source.html#l01582">HISTORY::def_offset</a>, <a class="el" href="midas_8h_source.html#l01557">HIST_RECORD::def_offset</a>, <a class="el" href="midas_8h_source.html#l01562">DEF_RECORD::event_id</a>, <a class="el" href="midas_8h_source.html#l01568">INDEX_RECORD::event_id</a>, <a class="el" href="midas_8h_source.html#l01574">HISTORY::event_id</a>, <a class="el" href="midas_8h_source.html#l01555">HIST_RECORD::event_id</a>, <a class="el" href="midas_8h_source.html#l01575">HISTORY::event_name</a>, <a class="el" href="midas_8h_source.html#l01563">DEF_RECORD::event_name</a>, <a class="el" href="midas_8h_source.html#l01578">HISTORY::hist_fh</a>, <a class="el" href="midas_8h_source.html#l01093">HS_FILE_ERROR</a>, <a class="el" href="midas_8c_source.html#l13271">hs_open_file()</a>, <a class="el" href="midas_8h_source.html#l01092">HS_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l01097">HS_UNDEFINED_EVENT</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="midas_8h_source.html#l01579">HISTORY::index_fh</a>, <a class="el" href="midas_8h_source.html#l01576">HISTORY::n_tag</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="midas_8h_source.html#l01570">INDEX_RECORD::offset</a>, <a class="el" href="midas_8h_source.html#l01554">HIST_RECORD::record_type</a>, <a class="el" href="midas_8h_source.html#l01550">RT_DATA</a>, <a class="el" href="midas_8h_source.html#l01551">RT_DEF</a>, <a class="el" href="mhist_8c_source.html#l00102">tag</a>, <a class="el" href="msystem_8h_source.html#l00369">TELL</a>, <a class="el" href="midas_8h_source.html#l01569">INDEX_RECORD::time</a>, <a class="el" href="CAET_8h_source.html#l00002">time</a>, <a class="el" href="midas_8h_source.html#l01556">HIST_RECORD::time</a>, and <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00259">write</a>.</p>

<p>Referenced by <a class="el" href="mhist_8c_source.html#l00133">generate_hist()</a>, <a class="el" href="fal_8c_source.html#l01917">log_history()</a>, <a class="el" href="fal_8c_source.html#l01945">log_system_history()</a>, <a class="el" href="mserver_8c_source.html#l00534">rpc_server_dispatch()</a>, <a class="el" href="fal_8c_source.html#l02725">tr_pause()</a>, <a class="el" href="fal_8c_source.html#l02355">tr_poststop()</a>, <a class="el" href="fal_8c_source.html#l02754">tr_resume()</a>, <a class="el" href="mlogger_8c_source.html#l03140">tr_start()</a>, <a class="el" href="fal_8c_source.html#l02085">tr_start1()</a>, <a class="el" href="mlogger_8c_source.html#l03482">tr_stop()</a>, and <a class="el" href="mhist_8c_source.html#l00103">write_hist_speed()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l13691"></a>13691          : <a class="code" href="group__msectionh.html#ga607ef6f6ef2f547c09f05a5a7fe4c3d6">hs_write_event</a>
<a name="l13692"></a>13692 
<a name="l13693"></a>13693   Purpose: Write an <span class="keyword">event</span> to a <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file.
<a name="l13694"></a>13694 
<a name="l13695"></a>13695   Input:
<a name="l13696"></a>13696     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>         Event <a class="code" href="jorway73a_8h.html#a4bfe115debc7f472dd7dfe4ef9679ca0">ID</a>
<a name="l13697"></a>13697     <span class="keywordtype">void</span>   *<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>            Data <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> containing <span class="keyword">event</span>
<a name="l13698"></a>13698     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>  <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>             Data <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> bytes
<a name="l13699"></a>13699 
<a name="l13700"></a>13700   Output:
<a name="l13701"></a>13701     none
<a name="l13702"></a>13702                             future <a class="code" href="group__msectionh.html#ga607ef6f6ef2f547c09f05a5a7fe4c3d6">hs_write_event</a>
<a name="l13703"></a>13703 
<a name="l13704"></a>13704   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l13705"></a>13705     <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>              Successful completion
<a name="l13706"></a>13706     HS_NO_MEMEORY           Out of memory
<a name="l13707"></a>13707     <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>           Cannot <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a> to <a class="code" href="cmdedit_8c.html#a27cb7dcef6f2c86f4853a452f5cd2bf8">history</a> file
<a name="l13708"></a>13708     <a class="code" href="group__err26.html#gad7b85d13f7ee77c6d195ed38380bbc27">HS_UNDEFINED_EVENT</a>      Event was not defined via <a class="code" href="group__msectionh.html#ga45f115952fa24a5a71345f2b57821aec">hs_define_event</a>
<a name="l13709"></a>13709 
<a name="l13710"></a>13710 \********************************************************************/
<a name="l13711"></a>13711 {
<a name="l13712"></a>13712 <span class="comment">/* history events are only written locally (?)</span>
<a name="l13713"></a>13713 <span class="comment"></span>
<a name="l13714"></a>13714 <span class="comment">  if (rpc_is_remote())</span>
<a name="l13715"></a>13715 <span class="comment">    return rpc_call(RPC_HS_WRITE_EVENT, event_id, data, size);</span>
<a name="l13716"></a>13716 <span class="comment">*/</span>
<a name="l13717"></a>13717    <a class="code" href="structHIST__RECORD.html">HIST_RECORD</a> rec, drec;
<a name="l13718"></a>13718    <a class="code" href="structDEF__RECORD.html">DEF_RECORD</a> def_rec;
<a name="l13719"></a>13719    <a class="code" href="structINDEX__RECORD.html">INDEX_RECORD</a> irec;
<a name="l13720"></a>13720    <span class="keywordtype">int</span> fh, fhi, fhd;
<a name="l13721"></a>13721    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>;
<a name="l13722"></a>13722    <span class="keyword">struct </span>tm tmb, tmr;
<a name="l13723"></a>13723 
<a name="l13724"></a>13724    <span class="comment">/* find index to history structure */</span>
<a name="l13725"></a>13725    <span class="keywordflow">for</span> (index = 0; index &lt; <a class="code" href="group__hsfunctionc.html#gac4638da3ec6d22fed1de595a7b7533eb">_history_entries</a>; index++)
<a name="l13726"></a>13726       <span class="keywordflow">if</span> (<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a> == <a class="code" href="examples_2macro_2midas__macro_8h.html#a6bff0a5e8995a80f74212d31f551167a">event_id</a>)
<a name="l13727"></a>13727          <span class="keywordflow">break</span>;
<a name="l13728"></a>13728    <span class="keywordflow">if</span> (index == _history_entries)
<a name="l13729"></a>13729       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gad7b85d13f7ee77c6d195ed38380bbc27">HS_UNDEFINED_EVENT</a>;
<a name="l13730"></a>13730 
<a name="l13731"></a>13731    <span class="comment">/* assemble record header */</span>
<a name="l13732"></a>13732    rec.<a class="code" href="structHIST__RECORD.html#a455da5efe0b4d3844e387e440b86302d">record_type</a> = <a class="code" href="group__mhistoryh.html#gaa8c3f42edf394b6d0fd9f1c3e00fe948">RT_DATA</a>;
<a name="l13733"></a>13733    rec.<a class="code" href="group__midasincludecode.html#gaf0b5331f4cf74267721acd101a7cdfef">event_id</a> = <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="structHISTORY.html#a322ce5ffb593fad70e8c2057d3835b5a">event_id</a>;
<a name="l13734"></a>13734    rec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a> = <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>(NULL);
<a name="l13735"></a>13735    rec.<a class="code" href="group__midasincludecode.html#ga32da4099349d2a5a77a84e67301c9e56">def_offset</a> = <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga321719dd05a884e2bca6cba8ca5b47ea">def_offset</a>;
<a name="l13736"></a>13736    rec.<a class="code" href="group__midasincludecode.html#ga93cecf8007191fbee0ec012e0eced9c1">data_size</a> = <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l13737"></a>13737 
<a name="l13738"></a>13738    irec.<a class="code" href="structINDEX__RECORD.html#ab893c0617053652c09947d7d24740f27">event_id</a> = <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="structHISTORY.html#a322ce5ffb593fad70e8c2057d3835b5a">event_id</a>;
<a name="l13739"></a>13739    irec.<a class="code" href="group__midasincludecode.html#ga729b9b6590da0af9a8c9984d0d58a8d7">time</a> = rec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a>;
<a name="l13740"></a>13740 
<a name="l13741"></a>13741    <span class="comment">/* check if new day */</span>
<a name="l13742"></a>13742    memcpy(&amp;tmr, localtime((<span class="keyword">const</span> time_t *) &amp;rec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a>), <span class="keyword">sizeof</span>(tmr));
<a name="l13743"></a>13743    memcpy(&amp;tmb, localtime((<span class="keyword">const</span> time_t *) &amp;<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].base_time), <span class="keyword">sizeof</span>(tmb));
<a name="l13744"></a>13744 
<a name="l13745"></a>13745    <span class="keywordflow">if</span> (tmr.tm_yday != tmb.tm_yday) {
<a name="l13746"></a>13746       <span class="comment">/* close current history file */</span>
<a name="l13747"></a>13747       close(<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].hist_fh);
<a name="l13748"></a>13748       close(<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].def_fh);
<a name="l13749"></a>13749       close(<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].index_fh);
<a name="l13750"></a>13750 
<a name="l13751"></a>13751       <span class="comment">/* open new history file */</span>
<a name="l13752"></a>13752       <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(rec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a>, <span class="stringliteral">&quot;hst&quot;</span>, O_CREAT | O_RDWR, &amp;fh);
<a name="l13753"></a>13753       <span class="keywordflow">if</span> (fh &lt; 0)
<a name="l13754"></a>13754          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l13755"></a>13755 
<a name="l13756"></a>13756       <span class="comment">/* open new index file */</span>
<a name="l13757"></a>13757       <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(rec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a>, <span class="stringliteral">&quot;idx&quot;</span>, O_CREAT | O_RDWR, &amp;fhi);
<a name="l13758"></a>13758       <span class="keywordflow">if</span> (fhi &lt; 0)
<a name="l13759"></a>13759          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l13760"></a>13760 
<a name="l13761"></a>13761       <span class="comment">/* open new definition index file */</span>
<a name="l13762"></a>13762       <a class="code" href="group__hsfunctionc.html#ga129bb4df742fb66b63d6b2a8253023e9">hs_open_file</a>(rec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a>, <span class="stringliteral">&quot;idf&quot;</span>, O_CREAT | O_RDWR, &amp;fhd);
<a name="l13763"></a>13763       <span class="keywordflow">if</span> (fhd &lt; 0)
<a name="l13764"></a>13764          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l13765"></a>13765 
<a name="l13766"></a>13766       lseek(fh, 0, SEEK_END);
<a name="l13767"></a>13767       lseek(fhi, 0, SEEK_END);
<a name="l13768"></a>13768       lseek(fhd, 0, SEEK_END);
<a name="l13769"></a>13769 
<a name="l13770"></a>13770       <span class="comment">/* remember new file handles */</span>
<a name="l13771"></a>13771       <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga79a69e6f7ee9000ef228992c63fa1b17">hist_fh</a> = fh;
<a name="l13772"></a>13772       <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga09233da06a1c7e441bd32f6230e80657">index_fh</a> = fhi;
<a name="l13773"></a>13773       <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#gacbcd08fbd4a1a660d097850b410d80ac">def_fh</a> = fhd;
<a name="l13774"></a>13774 
<a name="l13775"></a>13775       <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga321719dd05a884e2bca6cba8ca5b47ea">def_offset</a> = <a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(fh);
<a name="l13776"></a>13776       rec.<a class="code" href="group__midasincludecode.html#ga32da4099349d2a5a77a84e67301c9e56">def_offset</a> = <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga321719dd05a884e2bca6cba8ca5b47ea">def_offset</a>;
<a name="l13777"></a>13777 
<a name="l13778"></a>13778       tmr.tm_hour = tmr.tm_min = tmr.tm_sec = 0;
<a name="l13779"></a>13779       <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga7bc815860465a4962450eb181ab6a6e3">base_time</a> = mktime(&amp;tmr);
<a name="l13780"></a>13780 
<a name="l13781"></a>13781       <span class="comment">/* write definition from _history structure */</span>
<a name="l13782"></a>13782       drec.<a class="code" href="structHIST__RECORD.html#a455da5efe0b4d3844e387e440b86302d">record_type</a> = <a class="code" href="group__mhistoryh.html#ga53bf0d0c21b64cf42e4355c3919f6fa2">RT_DEF</a>;
<a name="l13783"></a>13783       drec.<a class="code" href="group__midasincludecode.html#gaf0b5331f4cf74267721acd101a7cdfef">event_id</a> = <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="structHISTORY.html#a322ce5ffb593fad70e8c2057d3835b5a">event_id</a>;
<a name="l13784"></a>13784       drec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a> = rec.<a class="code" href="group__midasincludecode.html#ga82235a34fe6b068c106c608b3893aff7">time</a>;
<a name="l13785"></a>13785       drec.<a class="code" href="group__midasincludecode.html#ga93cecf8007191fbee0ec012e0eced9c1">data_size</a> = <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#gaa4e80312dae8b75b2c05c697e6ee5951">n_tag</a> * <span class="keyword">sizeof</span>(<a class="code" href="structTAG.html">TAG</a>);
<a name="l13786"></a>13786 
<a name="l13787"></a>13787       <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fh, (<span class="keywordtype">char</span> *) &amp;drec, <span class="keyword">sizeof</span>(drec));
<a name="l13788"></a>13788       <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fh, <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].event_name, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>);
<a name="l13789"></a>13789       <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fh, (<span class="keywordtype">char</span> *) <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="mhist_8c.html#a27ce05f73a16e6abc070da1007833b9b">tag</a>, drec.data_size);
<a name="l13790"></a>13790 
<a name="l13791"></a>13791       <span class="comment">/* write definition index record */</span>
<a name="l13792"></a>13792       def_rec.<a class="code" href="structDEF__RECORD.html#a9d9787264de717f2512af5e7d48e5a32">event_id</a> = <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="structHISTORY.html#a322ce5ffb593fad70e8c2057d3835b5a">event_id</a>;
<a name="l13793"></a>13793       memcpy(def_rec.<a class="code" href="group__midasincludecode.html#gad4fdebc35644bab90bbe3164176690cf">event_name</a>, <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#gaa1eb8e97074d13d85926b4c12eff22f4">event_name</a>, <span class="keyword">sizeof</span>(def_rec.<a class="code" href="group__midasincludecode.html#gad4fdebc35644bab90bbe3164176690cf">event_name</a>));
<a name="l13794"></a>13794       def_rec.<a class="code" href="group__midasincludecode.html#ga3368ac2be8ed74559ed9ef115756f5e7">def_offset</a> = <a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].<a class="code" href="group__midasincludecode.html#ga321719dd05a884e2bca6cba8ca5b47ea">def_offset</a>;
<a name="l13795"></a>13795       <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(fhd, (<span class="keywordtype">char</span> *) &amp;def_rec, <span class="keyword">sizeof</span>(def_rec));
<a name="l13796"></a>13796    }
<a name="l13797"></a>13797 
<a name="l13798"></a>13798    <span class="comment">/* got to end of file */</span>
<a name="l13799"></a>13799    lseek(<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].hist_fh, 0, SEEK_END);
<a name="l13800"></a>13800    irec.<a class="code" href="group__midasincludecode.html#gaa5cd05f92f95ebccc6f2c7fdf3b3f1a9">offset</a> = <a class="code" href="group__msystemincludecode.html#ga337ff93ab881892ee5854628ed184352">TELL</a>(<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].hist_fh);
<a name="l13801"></a>13801 
<a name="l13802"></a>13802    <span class="comment">/* write record header */</span>
<a name="l13803"></a>13803    <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].hist_fh, (<span class="keywordtype">char</span> *) &amp;rec, <span class="keyword">sizeof</span>(rec));
<a name="l13804"></a>13804 
<a name="l13805"></a>13805    <span class="comment">/* write data */</span>
<a name="l13806"></a>13806    <a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].hist_fh, (<span class="keywordtype">char</span> *) <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>);
<a name="l13807"></a>13807 
<a name="l13808"></a>13808    <span class="comment">/* write index record */</span>
<a name="l13809"></a>13809    lseek(<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].index_fh, 0, SEEK_END);
<a name="l13810"></a>13810    <span class="keywordflow">if</span> (<a class="code" href="examples_2macro_2midas__macro_8h.html#a6fbb683090a733152e51639d58b90cd6">write</a>(<a class="code" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a>[index].index_fh, (<span class="keywordtype">char</span> *) &amp;irec, <span class="keyword">sizeof</span>(irec)) &lt; <span class="keyword">sizeof</span>(irec))
<a name="l13811"></a>13811       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga564032fce62ccc4689bd3b5864ad0f9c">HS_FILE_ERROR</a>;
<a name="l13812"></a>13812 
<a name="l13813"></a>13813    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga2d533509db8628a7e0eb794e2b3e77b0">HS_SUCCESS</a>;
<a name="l13814"></a>13814 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="gaaddc6c914f5edeefe06881bd888436ea"></a><!-- doxytag: member="midas.c::_history" ref="gaaddc6c914f5edeefe06881bd888436ea" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structHISTORY.html">HISTORY</a>* <a class="el" href="group__hsfunctionc.html#gaaddc6c914f5edeefe06881bd888436ea">_history</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox </p>

<p>Definition at line <a class="el" href="midas_8c_source.html#l13230">13230</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<a class="anchor" id="gac4638da3ec6d22fed1de595a7b7533eb"></a><!-- doxytag: member="midas.c::_history_entries" ref="gac4638da3ec6d22fed1de595a7b7533eb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="group__hsfunctionc.html#gac4638da3ec6d22fed1de595a7b7533eb">_history_entries</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l13231">13231</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga6bfae86238964396b88c3d62aa3e0e3b"></a><!-- doxytag: member="midas.c::_hs_path_name" ref="ga6bfae86238964396b88c3d62aa3e0e3b" args="[MAX_STRING_LENGTH]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="group__hsfunctionc.html#ga6bfae86238964396b88c3d62aa3e0e3b">_hs_path_name</a>[MAX_STRING_LENGTH]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l13232">13232</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 6 Jun 2014 for AlcapDAQ:Rootana by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
