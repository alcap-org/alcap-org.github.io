<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>AlcapDAQ:Rootana: Midas RPC Functions (rpc_xxx)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Midas RPC Functions (rpc_xxx)<br/>
<small>
[<a class="el" href="group__midasincludecode.html">The midas.h &amp; midas.c</a>]</small>
</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structTR__FIFO.html">TR_FIFO</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga34b52a482a19eb8abcf8d84d888acbe0">rpc_calc_convert_flags</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> hw_type, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> remote_hw_type, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> *convert_flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga105b67e3b64c0220093e5ad5cce9c3b3">rpc_get_convert_flags</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> *convert_flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gaccde5f164efc9d339256b700a0e03021">rpc_ieee2vax_float</a> (float *var)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gaab3294efcbd42ae403a917e2adc78864">rpc_vax2ieee_float</a> (float *var)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gaf4231327adba822d2395cf45be5d92d1">rpc_vax2ieee_double</a> (double *var)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gaef4a2b3deceddb0aef68da17453cd163">rpc_ieee2vax_double</a> (double *var)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gafbacbf42add03b242abff91adda4fc3a">rpc_convert_single</a> (void *<a class="el" href="odbedit_8c.html#a8c6d6f90e1d6932f65c6f43d2f9d49a7">data</a>, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> tid, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> flags, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> convert_flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga07528ca8a8b1e4930ea9f3389c65c8b6">rpc_convert_data</a> (void *<a class="el" href="odbedit_8c.html#a8c6d6f90e1d6932f65c6f43d2f9d49a7">data</a>, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> tid, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> flags, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> total_size, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> convert_flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gafa95bfc034f148c327429236c1dbc9d5">rpc_tid_size</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga7a677a606e7764e1f234c9f01ad6d9a0">rpc_tid_name</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gab042f2574359fb87fb1a897b6d90fbfc">rpc_register_client</a> (char *name, <a class="el" href="structRPC__LIST.html">RPC_LIST</a> *list)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga0a28efa56a72e033207e5cb158740e1e">rpc_register_functions</a> (<a class="el" href="structRPC__LIST.html">RPC_LIST</a> *new_list, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>(*func)(<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>, void **))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga6857fd6fbef63525ce0c4510983471b8">rpc_deregister_functions</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gad79effdbfb43919e9d51a2067b389b13">rpc_register_function</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> id, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>(*func)(<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>, void **))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gaddfad24a27898f83c9d51e41dd208bc6">rpc_client_dispatch</a> (int sock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga2daf176f4376f5a41d68007d32e079a0">rpc_client_connect</a> (char *<a class="el" href="webpaw_8c.html#af30d16605d5c80183cd199983a653081">host_name</a>, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> port, char *client_name, <a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> *hConnection)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga7e43be3195a7f7580eb0b981b8d83c86">rpc_client_check</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga682dee81e5366fdb8fcee44b480ce1b9">rpc_server_connect</a> (char *<a class="el" href="webpaw_8c.html#af30d16605d5c80183cd199983a653081">host_name</a>, char *<a class="el" href="mhttpd_8c.html#a2f66ab590c0bf6aa5385f2c964eef5fe">exp_name</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga1b5b830d23f4d5456d616fd1713db126">rpc_client_disconnect</a> (<a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="el" href="mcnaf_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a>, <a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> bShutdown)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gaa174e89a3826f4387d4d02469e51bd1b">rpc_server_disconnect</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga4f5a265bf646406b57ad16e6f11ce598">rpc_is_remote</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga55167513ac1295a246d69f378fc9d459">rpc_get_server_acception</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga6990e0eb5b97aeb6667ddd03d69b4065">rpc_set_server_acception</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gadd4af923e46041c84fe466a563f700ae">rpc_get_option</a> (<a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="el" href="mcnaf_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a>, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> item)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gaab360e4fd185439b0913c723581115ea">rpc_set_option</a> (<a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="el" href="mcnaf_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a>, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> item, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="odbhist_8c.html#a401da9cc2f96d4efd127de7463b69208">value</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">PTYPE&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga8c53d974d5f6fb301c6c7d58a1cf00d6">rpc_get_server_option</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> item)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga7c05b913a74075409ae5054feba51338">rpc_set_server_option</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> item, PTYPE <a class="el" href="odbhist_8c.html#a401da9cc2f96d4efd127de7463b69208">value</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gafe112287d4a9288ef3543e6048a48fc3">rpc_get_name</a> (char *name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gad8aeb762e203073e37c6c14c2a5e9567">rpc_set_name</a> (char *name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga9c3732bc3b6cbe75ddbbc7f5e2c78509">rpc_set_debug</a> (void(*func)(char *), <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="mscbutil_8c.html#a74b654271a172a244c844fb86277cd8a">mode</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga31870b58cfa0d18e70889e1373d8a807">rpc_debug_printf</a> (char *format,...)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga4c54bf7646af19000ed7892e294ad71f">rpc_va_arg</a> (va_list *arg_ptr, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> arg_type, void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga9869532482d88b0205bed74119862400">rpc_client_call</a> (<a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="el" href="mcnaf_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a>, const <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> routine_id,...)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga1fdbf5429728ed90c87e0ffcaa5c4d0a">rpc_call</a> (const <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> routine_id,...)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gab28fefb4196d9ae55f6010b683a59745">rpc_set_opt_tcp_size</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> tcp_size)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga1af6538c332bcca866e57cd040d54fb6">rpc_get_opt_tcp_size</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga7bd9c61bcbc2b20c32d0c6cd73865766">rpc_send_event</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> buffer_handle, void *source, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> buf_size, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> async_flag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gadad353c9f1fd0f6ee0a6a4c0576cbe10">rpc_get_send_sock</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga9891d5e14854f36015c9f47eab8b2dbb">rpc_get_event_sock</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga83d80e4f1e8d2a2d7f38e58dcfd3c711">rpc_flush_event</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga47e8ecaa138ce7e1fdc9ce91ed4b3d5f">cm_query_transition</a> (int *transition, int *<a class="el" href="mlogger_8c.html#a7515080fe161c8c4d6029c889f02564a">run_number</a>, int *trans_time)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga328db10bbb615c2e1ac895cf6e94d31c">recv_tcp_server</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, char *<a class="el" href="mlogger_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="mlogger_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a>, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> flags, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> *remaining)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga27b5c0fb4ca730c0f1503d34b42377e7">recv_tcp_check</a> (int sock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gacbce72f1a2b5db72b1fe517b06493282">recv_event_server</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, char *<a class="el" href="mlogger_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, <a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="mlogger_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a>, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> flags, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> *remaining)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gaef0a9552f5ba591961dca7e6ff556de7">recv_event_check</a> (int sock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga34bf3c9873a46b341ff78ea2328625f3">rpc_register_server</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> server_type, char *name, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> *port, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>(*func)(<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>, void **))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gaaececfb5cc7b4e302cc4f31dae7f773b">rpc_execute</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> sock, char *<a class="el" href="mlogger_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> convert_flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga30e35c5ffd03eb5084e63e04b50e3d60">rpc_execute_ascii</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> sock, char *<a class="el" href="mlogger_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gabe636d94f1b2a43d9dfb726317c39bfa">rpc_server_accept</a> (int lsock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gaa3090052a0110f67c4a27d52799bd526">rpc_client_accept</a> (int lsock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga22f1893212e009f54f9085634784b235">rpc_server_callback</a> (struct <a class="el" href="structcallback__addr.html">callback_addr</a> *pcallback)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gaab67c95f34e6244dea904f852b37ffce">rpc_server_thread</a> (void *pointer)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga8bad7cd9b75d3a9879745bbd61742ded">rpc_server_receive</a> (<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="mana__orig_8c.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, int sock, <a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> check)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga8db992c1518cf2e01bd9c4590babd8f1">rpc_server_shutdown</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gae04dcc2753aa274bcfe09835be8ddfb9">rpc_check_channels</a> (void)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structRPC__CLIENT__CONNECTION.html">RPC_CLIENT_CONNECTION</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a> [MAX_RPC_CONNECTION]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structRPC__SERVER__CONNECTION.html">RPC_SERVER_CONNECTION</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga697ab24f60fe31109c15eef59cb5546f">_lsock</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structRPC__SERVER__ACCEPTION.html">RPC_SERVER_ACCEPTION</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a> [MAX_RPC_CONNECTION]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga9ac2420c00b7dfb59718e71077d29568">_server_acception_index</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga71a7c9d97df5dbe0a62770034ae6757f">_server_type</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gaa16848418d977932c5cdf9e61f660e13">_server_name</a> [256]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structRPC__LIST.html">RPC_LIST</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga9938652e216f0f66f1eab2f26228089b">rpc_list</a> = NULL</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga20e63d0a316b30ec4fbd8766dd04c52d">_opt_tcp_size</a> = OPT_TCP_SIZE</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structTR__FIFO.html">TR_FIFO</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gad86eec219c3508ceb4474d780a00a104">tr_fifo</a> [10]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#gafd6bbb4ef7f8d3e1a9e05d0a84601641">trf_wp</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rpcfunctionc.html#ga38daa8c1581b7ae1460e02712cc63ff2">trf_rp</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>dox dox dox </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga47e8ecaa138ce7e1fdc9ce91ed4b3d5f"></a><!-- doxytag: member="midas.c::cm_query_transition" ref="ga47e8ecaa138ce7e1fdc9ce91ed4b3d5f" args="(int *transition, int *run_number, int *trans_time)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cm_query_transition </td>
          <td>(</td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>transition</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>run_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>trans_time</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l10405">10405</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="midas_8c_source.html#l10339">TR_FIFO::run_number</a>, <a class="el" href="midas_8c_source.html#l10338">TR_FIFO::transition</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="consume_8c_source.html#l00124">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10408"></a>10408          : <a class="code" href="group__msectionh.html#gabcf4eae43ac71e347eb6b7c36d58ae69">cm_query_transition</a>
<a name="l10409"></a>10409 
<a name="l10410"></a>10410   Purpose: Query system <span class="keywordflow">if</span> <a class="code" href="fal_8c.html#aed2a9a6c57de716dc564331cca8f0a85">transition</a> has occured. Normally, one 
<a name="l10411"></a>10411            registers callbacks <span class="keywordflow">for</span> transitions via 
<a name="l10412"></a>10412            <a class="code" href="group__msectionh.html#ga4cf8478a882b7dac40756a9549e9748b">cm_register_transition</a>. In some environments however,
<a name="l10413"></a>10413            callbacks are not possible. In that <span class="keywordflow">case</span> one spciefies
<a name="l10414"></a>10414            a NULL pointer as the <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a> routine <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> can query
<a name="l10415"></a>10415            transitions <span class="stringliteral">&quot;manually&quot;</span> <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> calling <span class="keyword">this</span> functions. A small
<a name="l10416"></a>10416            FIFO takes care that no <a class="code" href="fal_8c.html#aed2a9a6c57de716dc564331cca8f0a85">transition</a> is lost <span class="keywordflow">if</span> <span class="keyword">this</span> functions
<a name="l10417"></a>10417            did not <span class="keyword">get</span> called between some transitions.
<a name="l10418"></a>10418 
<a name="l10419"></a>10419   Output:
<a name="l10420"></a>10420     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   *<a class="code" href="fal_8c.html#aed2a9a6c57de716dc564331cca8f0a85">transition</a>        Type of <a class="code" href="fal_8c.html#aed2a9a6c57de716dc564331cca8f0a85">transition</a>, one of TR_xxx
<a name="l10421"></a>10421     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   *run_nuber         Run number <span class="keywordflow">for</span> <a class="code" href="fal_8c.html#aed2a9a6c57de716dc564331cca8f0a85">transition</a>
<a name="l10422"></a>10422     time_t *trans_time       Time (<a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> UNIX <a class="code" href="CAET_8h.html#ab2d5aa7fce1a14d8bddfb2c333ea9679">time</a>) of <a class="code" href="fal_8c.html#aed2a9a6c57de716dc564331cca8f0a85">transition</a>
<a name="l10423"></a>10423 
<a name="l10424"></a>10424   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l10425"></a>10425     <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>  No <a class="code" href="fal_8c.html#aed2a9a6c57de716dc564331cca8f0a85">transition</a> occured since <a class="code" href="MFastSlowCorrelator_8cpp.html#a3579fbbede9d99d8d4aafc118b3abed3">last</a> <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a>
<a name="l10426"></a>10426     <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>   Transition occured
<a name="l10427"></a>10427 
<a name="l10428"></a>10428 \********************************************************************/
<a name="l10429"></a>10429 {
<a name="l10430"></a>10430 
<a name="l10431"></a>10431    <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#gafd6bbb4ef7f8d3e1a9e05d0a84601641">trf_wp</a> == <a class="code" href="group__rpcfunctionc.html#ga38daa8c1581b7ae1460e02712cc63ff2">trf_rp</a>)
<a name="l10432"></a>10432       <span class="keywordflow">return</span> <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l10433"></a>10433 
<a name="l10434"></a>10434    <span class="keywordflow">if</span> (<a class="code" href="fal_8c.html#aed2a9a6c57de716dc564331cca8f0a85">transition</a>)
<a name="l10435"></a>10435       *<a class="code" href="fal_8c.html#aed2a9a6c57de716dc564331cca8f0a85">transition</a> = <a class="code" href="group__rpcfunctionc.html#gad86eec219c3508ceb4474d780a00a104">tr_fifo</a>[<a class="code" href="group__rpcfunctionc.html#ga38daa8c1581b7ae1460e02712cc63ff2">trf_rp</a>].<a class="code" href="structTR__FIFO.html#a26b1403918620a9f8ce66950167995b6">transition</a>;
<a name="l10436"></a>10436 
<a name="l10437"></a>10437    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a16695ea2bfd19f294afe066d6007ab36">run_number</a>)
<a name="l10438"></a>10438       *<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a16695ea2bfd19f294afe066d6007ab36">run_number</a> = <a class="code" href="group__rpcfunctionc.html#gad86eec219c3508ceb4474d780a00a104">tr_fifo</a>[<a class="code" href="group__rpcfunctionc.html#ga38daa8c1581b7ae1460e02712cc63ff2">trf_rp</a>].<a class="code" href="structTR__FIFO.html#a9e1cad6935e31399c7588c7663355031">run_number</a>;
<a name="l10439"></a>10439 
<a name="l10440"></a>10440    <span class="keywordflow">if</span> (trans_time)
<a name="l10441"></a>10441       *trans_time = (int)<a class="code" href="group__rpcfunctionc.html#gad86eec219c3508ceb4474d780a00a104">tr_fifo</a>[<a class="code" href="group__rpcfunctionc.html#ga38daa8c1581b7ae1460e02712cc63ff2">trf_rp</a>].trans_time;
<a name="l10442"></a>10442 
<a name="l10443"></a>10443    <a class="code" href="group__rpcfunctionc.html#ga38daa8c1581b7ae1460e02712cc63ff2">trf_rp</a> = (<a class="code" href="group__rpcfunctionc.html#ga38daa8c1581b7ae1460e02712cc63ff2">trf_rp</a> + 1) % 10;
<a name="l10444"></a>10444 
<a name="l10445"></a>10445    <span class="keywordflow">return</span> <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l10446"></a>10446 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaef0a9552f5ba591961dca7e6ff556de7"></a><!-- doxytag: member="midas.c::recv_event_check" ref="gaef0a9552f5ba591961dca7e6ff556de7" args="(int sock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> recv_event_check </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sock</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l10835">10835</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="msystem_8h_source.html#l00461">RPC_SERVER_ACCEPTION::ev_read_ptr</a>, <a class="el" href="msystem_8h_source.html#l00461">RPC_SERVER_ACCEPTION::ev_write_ptr</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, and <a class="el" href="msystem_8h_source.html#l00255">MAX_RPC_CONNECTION</a>.</p>

<p>Referenced by <a class="el" href="system_8c_source.html#l03283">ss_suspend()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10838"></a>10838          : <a class="code" href="group__msystemincludecode.html#gaef0a9552f5ba591961dca7e6ff556de7">recv_event_check</a>
<a name="l10839"></a>10839 
<a name="l10840"></a>10840   Purpose: Check <span class="keywordflow">if</span> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> TCP <span class="keyword">event</span> receive <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> associated with sock
<a name="l10841"></a>10841            is some <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>. Called <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> <a class="code" href="group__msystemincludecode.html#ga057bcc23c79e804679785d98b1223bd1">ss_suspend</a>.
<a name="l10842"></a>10842 
<a name="l10843"></a>10843   Input:
<a name="l10844"></a>10844     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   sock               TCP receive socket
<a name="l10845"></a>10845 
<a name="l10846"></a>10846   Output:
<a name="l10847"></a>10847     none
<a name="l10848"></a>10848 
<a name="l10849"></a>10849   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l10850"></a>10850     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   <a class="code" href="mdump_8c.html#a3d42cdd395a9c14f809d2fe53748c620">count</a>              Number of bytes remaining <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> TCP <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l10851"></a>10851 
<a name="l10852"></a>10852 \********************************************************************/
<a name="l10853"></a>10853 {
<a name="l10854"></a>10854    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>;
<a name="l10855"></a>10855 
<a name="l10856"></a>10856    <span class="comment">/* figure out to which connection socket belongs */</span>
<a name="l10857"></a>10857    <span class="keywordflow">for</span> (index = 0; index &lt; <a class="code" href="group__msystemincludecode.html#gab1e8a2a4c5dc40faf6f7c25b51a4562f">MAX_RPC_CONNECTION</a>; index++)
<a name="l10858"></a>10858       <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].event_sock == sock)
<a name="l10859"></a>10859          <span class="keywordflow">break</span>;
<a name="l10860"></a>10860 
<a name="l10861"></a>10861    <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#ab818540c0d7f2b65c68e240eac71e765">ev_write_ptr</a> - <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a328900a0b90adaad3e67154742a38c94">ev_read_ptr</a>;
<a name="l10862"></a>10862 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gacbce72f1a2b5db72b1fe517b06493282"></a><!-- doxytag: member="midas.c::recv_event_server" ref="gacbce72f1a2b5db72b1fe517b06493282" args="(INT index, char *buffer, DWORD buffer_size, INT flags, INT *remaining)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> recv_event_server </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>buffer_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> *&nbsp;</td>
          <td class="paramname"> <em>remaining</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l10655">10655</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l00904">ALIGN8</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="msystem_8h_source.html#l00456">RPC_SERVER_ACCEPTION::convert_flags</a>, <a class="el" href="midas_8h_source.html#l01195">EVENT_HEADER::data_size</a>, <a class="el" href="msystem_8h_source.html#l00461">RPC_SERVER_ACCEPTION::ev_misalign</a>, <a class="el" href="msystem_8h_source.html#l00458">RPC_SERVER_ACCEPTION::ev_net_buffer</a>, <a class="el" href="msystem_8h_source.html#l00461">RPC_SERVER_ACCEPTION::ev_read_ptr</a>, <a class="el" href="msystem_8h_source.html#l00461">RPC_SERVER_ACCEPTION::ev_write_ptr</a>, <a class="el" href="midas_8h_source.html#l01191">EVENT_HEADER::event_id</a>, <a class="el" href="msystem_8h_source.html#l00451">RPC_SERVER_ACCEPTION::event_sock</a>, <a class="el" href="midas_8h_source.html#l01753">M_MALLOC</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="rpc_8c_source.html#l00293">net_buffer</a>, <a class="el" href="msystem_8h_source.html#l00257">NET_BUFFER_SIZE</a>, <a class="el" href="msystem_8h_source.html#l00459">RPC_SERVER_ACCEPTION::net_buffer_size</a>, <a class="el" href="midas_8h_source.html#l00671">NET_TCP_SIZE</a>, <a class="el" href="midas_8c_source.html#l08079">rpc_convert_single()</a>, <a class="el" href="midas_8c_source.html#l09250">rpc_get_server_option()</a>, <a class="el" href="midas_8h_source.html#l00772">RPC_OSERVER_TYPE</a>, <a class="el" href="midas_8h_source.html#l01193">EVENT_HEADER::serial_number</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="midas_8h_source.html#l01795">ST_REMOTE</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="midas_8h_source.html#l00740">TID_DWORD</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="midas_8h_source.html#l00739">TID_SHORT</a>, <a class="el" href="midas_8h_source.html#l01194">EVENT_HEADER::time_stamp</a>, <a class="el" href="midas_8h_source.html#l01192">EVENT_HEADER::trigger_mask</a>, and <a class="el" href="p30_8h_source.html#l00043">TRUE</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l12223">rpc_server_receive()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10659"></a>10659          : <a class="code" href="group__rpcfunctionc.html#gacbce72f1a2b5db72b1fe517b06493282">recv_event_server</a>
<a name="l10660"></a>10660 
<a name="l10661"></a>10661   Purpose: TCP <span class="keyword">event</span> receive routine with local <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>. To <a class="code" href="mdump_8c.html#a26ac28c39604bf4cfdf8bfe62eee2d7f">speed</a> up
<a name="l10662"></a>10662            network performance, a 64<a class="code" href="odbhist_8c.html#a43fa990200c3ddd47c35f151bd4d66bf">k</a> <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> is <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> at once <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a>
<a name="l10663"></a>10663            split into several RPC command on successive calls to
<a name="l10664"></a>10664            <a class="code" href="group__rpcfunctionc.html#gacbce72f1a2b5db72b1fe517b06493282">recv_event_server</a>. Therefore, the number of recv() calls
<a name="l10665"></a>10665            is minimized.
<a name="l10666"></a>10666 
<a name="l10667"></a>10667            This routine is ment to be called <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> the server process.
<a name="l10668"></a>10668            Clients should <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a> <a class="code" href="group__msystemincludecode.html#ga89d1ae530ad0e4bf448c77b57399f357">recv_tcp</a> instead.
<a name="l10669"></a>10669 
<a name="l10670"></a>10670   Input:
<a name="l10671"></a>10671     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>              Index of server connection
<a name="l10672"></a>10672     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="code" href="fal_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a>        Size of the <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> bytes.
<a name="l10673"></a>10673     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   flags              Flags passed to recv()
<a name="l10674"></a>10674     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   convert_flags      Convert flags needed <a class="code" href="patch__mevb_8cpp.html#acf1ade676fe2e98c5ee44131e9f23abb">for</a> big/little
<a name="l10675"></a>10675                              endian conversion
<a name="l10676"></a>10676 
<a name="l10677"></a>10677   Output:
<a name="l10678"></a>10678     <span class="keywordtype">char</span>  *<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>            Network receive <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>.
<a name="l10679"></a>10679     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   *remaining         Remaining <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>
<a name="l10680"></a>10680 
<a name="l10681"></a>10681   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l10682"></a>10682     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>                      Same as recv()
<a name="l10683"></a>10683 
<a name="l10684"></a>10684 \********************************************************************/
<a name="l10685"></a>10685 {
<a name="l10686"></a>10686    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, event_size, aligned_event_size = 0, *pbh, header_size;
<a name="l10687"></a>10687    <a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *pevent;
<a name="l10688"></a>10688    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> write_ptr, read_ptr, misalign;
<a name="l10689"></a>10689    <span class="keywordtype">char</span> *<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>;
<a name="l10690"></a>10690    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> copied, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l10691"></a>10691    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> sock;
<a name="l10692"></a>10692    <a class="code" href="structRPC__SERVER__ACCEPTION.html">RPC_SERVER_ACCEPTION</a> *psa;
<a name="l10693"></a>10693 
<a name="l10694"></a>10694    psa = &amp;<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>];
<a name="l10695"></a>10695    sock = psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#ac770d0f286e0392201250d6d8c2f76eb">event_sock</a>;
<a name="l10696"></a>10696 
<a name="l10697"></a>10697    <span class="keywordflow">if</span> (flags &amp; MSG_PEEK) {
<a name="l10698"></a>10698       status = recv(sock, <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, <a class="code" href="fal_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a>, flags);
<a name="l10699"></a>10699       <span class="keywordflow">if</span> (status == -1)
<a name="l10700"></a>10700          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;recv_event_server&quot;</span>,
<a name="l10701"></a>10701                 <span class="stringliteral">&quot;recv(%d,MSG_PEEK) returned %d, errno: %d (%s)&quot;</span>, <a class="code" href="fal_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a>, status,
<a name="l10702"></a>10702                 errno, strerror(errno));
<a name="l10703"></a>10703       <span class="keywordflow">return</span> status;
<a name="l10704"></a>10704    }
<a name="l10705"></a>10705 
<a name="l10706"></a>10706    <span class="keywordflow">if</span> (!psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a50098af05de81e9946037b569518eb11">ev_net_buffer</a>) {
<a name="l10707"></a>10707       <span class="keywordflow">if</span> (<a class="code" href="group__msystemincludecode.html#ga500895b6f1fb39626453b56a20ed52df">rpc_get_server_option</a>(<a class="code" href="group__mdefineh.html#ga7f6354019d48c7beeb8f5bd5c2fac8bb">RPC_OSERVER_TYPE</a>) != <a class="code" href="group__msectionh.html#ga9c6b34250ccc696d64a6a0a572947be5">ST_REMOTE</a>)
<a name="l10708"></a>10708          psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a6c512ad1188d75c1c7d98fab3f7b126d">net_buffer_size</a> = <a class="code" href="group__midasincludecode.html#ga31190e25ed33be085ff0af476af2c029">NET_TCP_SIZE</a>;
<a name="l10709"></a>10709       <span class="keywordflow">else</span>
<a name="l10710"></a>10710          psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a6c512ad1188d75c1c7d98fab3f7b126d">net_buffer_size</a> = <a class="code" href="group__msystemincludecode.html#ga7554d698d310e57e1c933a8f952a4bf8">NET_BUFFER_SIZE</a>;
<a name="l10711"></a>10711 
<a name="l10712"></a>10712       psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a50098af05de81e9946037b569518eb11">ev_net_buffer</a> = (<span class="keywordtype">char</span> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a6c512ad1188d75c1c7d98fab3f7b126d">net_buffer_size</a>);
<a name="l10713"></a>10713       psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#ab818540c0d7f2b65c68e240eac71e765">ev_write_ptr</a> = 0;
<a name="l10714"></a>10714       psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a328900a0b90adaad3e67154742a38c94">ev_read_ptr</a> = 0;
<a name="l10715"></a>10715       psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a466544f6557e892cac715f647a23001a">ev_misalign</a> = 0;
<a name="l10716"></a>10716    }
<a name="l10717"></a>10717    <span class="keywordflow">if</span> (!psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a50098af05de81e9946037b569518eb11">ev_net_buffer</a>) {
<a name="l10718"></a>10718       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;recv_event_server&quot;</span>, <span class="stringliteral">&quot;not enough memory to allocate network buffer&quot;</span>);
<a name="l10719"></a>10719       <span class="keywordflow">return</span> -1;
<a name="l10720"></a>10720    }
<a name="l10721"></a>10721 
<a name="l10722"></a>10722    header_size = (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) (<span class="keyword">sizeof</span>(<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a>) + <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>));
<a name="l10723"></a>10723 
<a name="l10724"></a>10724    <span class="keywordflow">if</span> ((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <a class="code" href="fal_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a> &lt; header_size) {
<a name="l10725"></a>10725       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;recv_event_server&quot;</span>, <span class="stringliteral">&quot;parameters too large for network buffer&quot;</span>);
<a name="l10726"></a>10726       <span class="keywordflow">return</span> -1;
<a name="l10727"></a>10727    }
<a name="l10728"></a>10728 
<a name="l10729"></a>10729    copied = 0;
<a name="l10730"></a>10730    event_size = -1;
<a name="l10731"></a>10731 
<a name="l10732"></a>10732    write_ptr = psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#ab818540c0d7f2b65c68e240eac71e765">ev_write_ptr</a>;
<a name="l10733"></a>10733    read_ptr = psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a328900a0b90adaad3e67154742a38c94">ev_read_ptr</a>;
<a name="l10734"></a>10734    misalign = psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a466544f6557e892cac715f647a23001a">ev_misalign</a>;
<a name="l10735"></a>10735    net_buffer = psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a50098af05de81e9946037b569518eb11">ev_net_buffer</a>;
<a name="l10736"></a>10736 
<a name="l10737"></a>10737    <span class="keywordflow">do</span> {
<a name="l10738"></a>10738       <span class="keywordflow">if</span> (write_ptr - read_ptr &gt;= header_size - copied) {
<a name="l10739"></a>10739          <span class="keywordflow">if</span> (event_size == -1) {
<a name="l10740"></a>10740             <span class="keywordflow">if</span> (copied &gt; 0) {
<a name="l10741"></a>10741                <span class="comment">/* assemble split header */</span>
<a name="l10742"></a>10742                memcpy(<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> + copied, net_buffer + read_ptr, header_size - copied);
<a name="l10743"></a>10743                pbh = (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>;
<a name="l10744"></a>10744             } <span class="keywordflow">else</span>
<a name="l10745"></a>10745                pbh = (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) (net_buffer + read_ptr);
<a name="l10746"></a>10746 
<a name="l10747"></a>10747             pevent = (<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *) (pbh + 1);
<a name="l10748"></a>10748 
<a name="l10749"></a>10749             event_size = pevent-&gt;<a class="code" href="group__midasincludecode.html#ga194220c29419e01ef4cab6d3dd8daedb">data_size</a>;
<a name="l10750"></a>10750             <span class="keywordflow">if</span> (psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a9f2d73aafabf6b3ef45298739b8d2400">convert_flags</a>)
<a name="l10751"></a>10751                <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(&amp;event_size, <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a>, 0, psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a9f2d73aafabf6b3ef45298739b8d2400">convert_flags</a>);
<a name="l10752"></a>10752 
<a name="l10753"></a>10753             aligned_event_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(event_size);
<a name="l10754"></a>10754          }
<a name="l10755"></a>10755 
<a name="l10756"></a>10756          <span class="comment">/* check if data part fits in buffer */</span>
<a name="l10757"></a>10757          <span class="keywordflow">if</span> ((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <a class="code" href="fal_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a> &lt; aligned_event_size + header_size) {
<a name="l10758"></a>10758             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;recv_event_server&quot;</span>,
<a name="l10759"></a>10759                    <span class="stringliteral">&quot;parameters too large for network buffer&quot;</span>);
<a name="l10760"></a>10760             psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a328900a0b90adaad3e67154742a38c94">ev_read_ptr</a> = psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#ab818540c0d7f2b65c68e240eac71e765">ev_write_ptr</a> = 0;
<a name="l10761"></a>10761             <span class="keywordflow">return</span> -1;
<a name="l10762"></a>10762          }
<a name="l10763"></a>10763 
<a name="l10764"></a>10764          <span class="comment">/* check if we have whole event in buffer */</span>
<a name="l10765"></a>10765          <span class="keywordflow">if</span> (write_ptr - read_ptr &gt;= aligned_event_size + header_size - copied)
<a name="l10766"></a>10766             <span class="keywordflow">break</span>;
<a name="l10767"></a>10767       }
<a name="l10768"></a>10768 
<a name="l10769"></a>10769       <span class="comment">/* not enough data, so copy partially and get new */</span>
<a name="l10770"></a>10770       size = write_ptr - read_ptr;
<a name="l10771"></a>10771 
<a name="l10772"></a>10772       <span class="keywordflow">if</span> (size &gt; 0) {
<a name="l10773"></a>10773          memcpy(<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> + copied, net_buffer + read_ptr, size);
<a name="l10774"></a>10774          copied += size;
<a name="l10775"></a>10775          read_ptr = write_ptr;
<a name="l10776"></a>10776       }
<a name="l10777"></a>10777 <span class="preprocessor">#ifdef OS_UNIX</span>
<a name="l10778"></a>10778 <span class="preprocessor"></span>      <span class="keywordflow">do</span> {
<a name="l10779"></a>10779          write_ptr = recv(sock, net_buffer + misalign, psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a6c512ad1188d75c1c7d98fab3f7b126d">net_buffer_size</a> - 8, flags);
<a name="l10780"></a>10780 
<a name="l10781"></a>10781          <span class="comment">/* don&apos;t return if an alarm signal was cought */</span>
<a name="l10782"></a>10782       } <span class="keywordflow">while</span> (write_ptr == -1 &amp;&amp; errno == EINTR);
<a name="l10783"></a>10783 <span class="preprocessor">#else</span>
<a name="l10784"></a>10784 <span class="preprocessor"></span>      write_ptr = recv(sock, net_buffer + misalign, psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a6c512ad1188d75c1c7d98fab3f7b126d">net_buffer_size</a> - 8, flags);
<a name="l10785"></a>10785 <span class="preprocessor">#endif</span>
<a name="l10786"></a>10786 <span class="preprocessor"></span>
<a name="l10787"></a>10787       <span class="comment">/* abort if connection broken */</span>
<a name="l10788"></a>10788       <span class="keywordflow">if</span> (write_ptr &lt;= 0) {
<a name="l10789"></a>10789          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;recv_event_server&quot;</span>, <span class="stringliteral">&quot;recv() returned %d, errno: %d (%s)&quot;</span>,
<a name="l10790"></a>10790                 write_ptr, errno, strerror(errno));
<a name="l10791"></a>10791 
<a name="l10792"></a>10792          <span class="keywordflow">if</span> (remaining)
<a name="l10793"></a>10793             *remaining = 0;
<a name="l10794"></a>10794 
<a name="l10795"></a>10795          <span class="keywordflow">return</span> write_ptr;
<a name="l10796"></a>10796       }
<a name="l10797"></a>10797 
<a name="l10798"></a>10798       read_ptr = misalign;
<a name="l10799"></a>10799       write_ptr += misalign;
<a name="l10800"></a>10800 
<a name="l10801"></a>10801       misalign = write_ptr % 8;
<a name="l10802"></a>10802    } <span class="keywordflow">while</span> (<a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l10803"></a>10803 
<a name="l10804"></a>10804    <span class="comment">/* copy rest of event */</span>
<a name="l10805"></a>10805    size = aligned_event_size + header_size - copied;
<a name="l10806"></a>10806    <span class="keywordflow">if</span> (size &gt; 0) {
<a name="l10807"></a>10807       memcpy(<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> + copied, net_buffer + read_ptr, size);
<a name="l10808"></a>10808       read_ptr += size;
<a name="l10809"></a>10809    }
<a name="l10810"></a>10810 
<a name="l10811"></a>10811    <span class="keywordflow">if</span> (remaining)
<a name="l10812"></a>10812       *remaining = write_ptr - read_ptr;
<a name="l10813"></a>10813 
<a name="l10814"></a>10814    psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#ab818540c0d7f2b65c68e240eac71e765">ev_write_ptr</a> = write_ptr;
<a name="l10815"></a>10815    psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a328900a0b90adaad3e67154742a38c94">ev_read_ptr</a> = read_ptr;
<a name="l10816"></a>10816    psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a466544f6557e892cac715f647a23001a">ev_misalign</a> = misalign;
<a name="l10817"></a>10817 
<a name="l10818"></a>10818    <span class="comment">/* convert header little endian/big endian */</span>
<a name="l10819"></a>10819    <span class="keywordflow">if</span> (psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a9f2d73aafabf6b3ef45298739b8d2400">convert_flags</a>) {
<a name="l10820"></a>10820       pevent = (<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *) (((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>) + 1);
<a name="l10821"></a>10821 
<a name="l10822"></a>10822       <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(buffer, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, 0, psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a9f2d73aafabf6b3ef45298739b8d2400">convert_flags</a>);
<a name="l10823"></a>10823       <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(&amp;pevent-&gt;<a class="code" href="structEVENT__HEADER.html#a107bbb0fbe21582dc0f0e78f60b997b3">event_id</a>, <a class="code" href="group__mdefineh.html#ga4281dafac4285eae3e3c9be0a1d93c5a">TID_SHORT</a>, 0, psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a9f2d73aafabf6b3ef45298739b8d2400">convert_flags</a>);
<a name="l10824"></a>10824       <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(&amp;pevent-&gt;<a class="code" href="group__midasincludecode.html#ga9b4b94f41521f5c188655b7bb0f1ec1b">trigger_mask</a>, <a class="code" href="group__mdefineh.html#ga4281dafac4285eae3e3c9be0a1d93c5a">TID_SHORT</a>, 0, psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a9f2d73aafabf6b3ef45298739b8d2400">convert_flags</a>);
<a name="l10825"></a>10825       <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(&amp;pevent-&gt;<a class="code" href="group__midasincludecode.html#ga5ed07c075ebce619a8fa47e96f188440">serial_number</a>, <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a>, 0, psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a9f2d73aafabf6b3ef45298739b8d2400">convert_flags</a>);
<a name="l10826"></a>10826       <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(&amp;pevent-&gt;<a class="code" href="group__midasincludecode.html#ga989421ee804ab76a0e11ac1c9c3b0e7a">time_stamp</a>, <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a>, 0, psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a9f2d73aafabf6b3ef45298739b8d2400">convert_flags</a>);
<a name="l10827"></a>10827       <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(&amp;pevent-&gt;<a class="code" href="group__midasincludecode.html#ga194220c29419e01ef4cab6d3dd8daedb">data_size</a>, <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a>, 0, psa-&gt;<a class="code" href="structRPC__SERVER__ACCEPTION.html#a9f2d73aafabf6b3ef45298739b8d2400">convert_flags</a>);
<a name="l10828"></a>10828    }
<a name="l10829"></a>10829 
<a name="l10830"></a>10830    <span class="keywordflow">return</span> header_size + event_size;
<a name="l10831"></a>10831 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga27b5c0fb4ca730c0f1503d34b42377e7"></a><!-- doxytag: member="midas.c::recv_tcp_check" ref="ga27b5c0fb4ca730c0f1503d34b42377e7" args="(int sock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> recv_tcp_check </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sock</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l10624">10624</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="msystem_8h_source.html#l00255">MAX_RPC_CONNECTION</a>, <a class="el" href="msystem_8h_source.html#l00460">RPC_SERVER_ACCEPTION::read_ptr</a>, and <a class="el" href="msystem_8h_source.html#l00460">RPC_SERVER_ACCEPTION::write_ptr</a>.</p>

<p>Referenced by <a class="el" href="system_8c_source.html#l03283">ss_suspend()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10627"></a>10627          : <a class="code" href="group__msystemincludecode.html#ga27b5c0fb4ca730c0f1503d34b42377e7">recv_tcp_check</a>
<a name="l10628"></a>10628 
<a name="l10629"></a>10629   Purpose: Check <span class="keywordflow">if</span> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> TCP receive <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> associated with sock is
<a name="l10630"></a>10630            some <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>. Called <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> <a class="code" href="group__msystemincludecode.html#ga057bcc23c79e804679785d98b1223bd1">ss_suspend</a>.
<a name="l10631"></a>10631 
<a name="l10632"></a>10632   Input:
<a name="l10633"></a>10633     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   sock               TCP receive socket
<a name="l10634"></a>10634 
<a name="l10635"></a>10635   Output:
<a name="l10636"></a>10636     none
<a name="l10637"></a>10637 
<a name="l10638"></a>10638   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l10639"></a>10639     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   <a class="code" href="mdump_8c.html#a3d42cdd395a9c14f809d2fe53748c620">count</a>              Number of bytes remaining <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> TCP <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l10640"></a>10640 
<a name="l10641"></a>10641 \********************************************************************/
<a name="l10642"></a>10642 {
<a name="l10643"></a>10643    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>;
<a name="l10644"></a>10644 
<a name="l10645"></a>10645    <span class="comment">/* figure out to which connection socket belongs */</span>
<a name="l10646"></a>10646    <span class="keywordflow">for</span> (index = 0; index &lt; <a class="code" href="group__msystemincludecode.html#gab1e8a2a4c5dc40faf6f7c25b51a4562f">MAX_RPC_CONNECTION</a>; index++)
<a name="l10647"></a>10647       <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].recv_sock == sock)
<a name="l10648"></a>10648          <span class="keywordflow">break</span>;
<a name="l10649"></a>10649 
<a name="l10650"></a>10650    <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#accaa59acfaa48e20716049a4488769b9">write_ptr</a> - <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a521393acbafbdcee15fade0bb723be6d">read_ptr</a>;
<a name="l10651"></a>10651 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga328db10bbb615c2e1ac895cf6e94d31c"></a><!-- doxytag: member="midas.c::recv_tcp_server" ref="ga328db10bbb615c2e1ac895cf6e94d31c" args="(INT index, char *buffer, DWORD buffer_size, INT flags, INT *remaining)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> recv_tcp_server </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>buffer_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> *&nbsp;</td>
          <td class="paramname"> <em>remaining</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l10454">10454</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="msystem_8h_source.html#l00386">NET_COMMAND::header</a>, <a class="el" href="generate-MODULES_8h_source.html#l00003">if</a>, <a class="el" href="midas_8h_source.html#l01753">M_MALLOC</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="msystem_8h_source.html#l00460">RPC_SERVER_ACCEPTION::misalign</a>, <a class="el" href="msystem_8h_source.html#l00457">RPC_SERVER_ACCEPTION::net_buffer</a>, <a class="el" href="rpc_8c_source.html#l00293">net_buffer</a>, <a class="el" href="msystem_8h_source.html#l00257">NET_BUFFER_SIZE</a>, <a class="el" href="msystem_8h_source.html#l00459">RPC_SERVER_ACCEPTION::net_buffer_size</a>, <a class="el" href="midas_8h_source.html#l00671">NET_TCP_SIZE</a>, <a class="el" href="msystem_8h_source.html#l00382">NET_COMMAND_HEADER::param_size</a>, <a class="el" href="msystem_8h_source.html#l00460">RPC_SERVER_ACCEPTION::read_ptr</a>, <a class="el" href="msystem_8h_source.html#l00450">RPC_SERVER_ACCEPTION::recv_sock</a>, <a class="el" href="midas_8c_source.html#l08079">rpc_convert_single()</a>, <a class="el" href="midas_8c_source.html#l09250">rpc_get_server_option()</a>, <a class="el" href="midas_8h_source.html#l00772">RPC_OSERVER_TYPE</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="midas_8h_source.html#l01795">ST_REMOTE</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="midas_8h_source.html#l00740">TID_DWORD</a>, <a class="el" href="p30_8h_source.html#l00043">TRUE</a>, and <a class="el" href="msystem_8h_source.html#l00460">RPC_SERVER_ACCEPTION::write_ptr</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l12223">rpc_server_receive()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10458"></a>10458          : <a class="code" href="group__rpcfunctionc.html#ga328db10bbb615c2e1ac895cf6e94d31c">recv_tcp_server</a>
<a name="l10459"></a>10459 
<a name="l10460"></a>10460   Purpose: TCP receive routine with local <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>. To <a class="code" href="mdump_8c.html#a26ac28c39604bf4cfdf8bfe62eee2d7f">speed</a> up network
<a name="l10461"></a>10461            performance, a 64<a class="code" href="odbhist_8c.html#a43fa990200c3ddd47c35f151bd4d66bf">k</a> <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> is <a class="code" href="examples_2macro_2midas__macro_8h.html#a5b55880ce7d302ae13576e90584a63bb">read</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> at once <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> split into
<a name="l10462"></a>10462            several RPC command on successive calls to <a class="code" href="group__rpcfunctionc.html#ga328db10bbb615c2e1ac895cf6e94d31c">recv_tcp_server</a>.
<a name="l10463"></a>10463            Therefore, the number of recv() calls is minimized.
<a name="l10464"></a>10464 
<a name="l10465"></a>10465            This routine is ment to be called <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> the server process.
<a name="l10466"></a>10466            Clients should <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a> <a class="code" href="group__msystemincludecode.html#ga89d1ae530ad0e4bf448c77b57399f357">recv_tcp</a> instead.
<a name="l10467"></a>10467 
<a name="l10468"></a>10468   Input:
<a name="l10469"></a>10469     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>              Index of server connection
<a name="l10470"></a>10470     <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="code" href="fal_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a>        Size of the <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> bytes.
<a name="l10471"></a>10471     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   flags              Flags passed to recv()
<a name="l10472"></a>10472     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   convert_flags      Convert flags needed <a class="code" href="patch__mevb_8cpp.html#acf1ade676fe2e98c5ee44131e9f23abb">for</a> big/little
<a name="l10473"></a>10473                              endian conversion
<a name="l10474"></a>10474 
<a name="l10475"></a>10475   Output:
<a name="l10476"></a>10476     <span class="keywordtype">char</span>  *<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>            Network receive <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>.
<a name="l10477"></a>10477     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   *remaining         Remaining <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> <a class="code" href="mscb_8c.html#a16d7212079e4dda3b5f56b05051ad7b4">cache</a>
<a name="l10478"></a>10478 
<a name="l10479"></a>10479   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l10480"></a>10480     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>                      Same as recv()
<a name="l10481"></a>10481 
<a name="l10482"></a>10482 \********************************************************************/
<a name="l10483"></a>10483 {
<a name="l10484"></a>10484    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, param_size;
<a name="l10485"></a>10485    <a class="code" href="structNET__COMMAND.html">NET_COMMAND</a> *nc;
<a name="l10486"></a>10486    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> write_ptr, read_ptr, misalign;
<a name="l10487"></a>10487    <span class="keywordtype">char</span> *<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>;
<a name="l10488"></a>10488    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> copied, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l10489"></a>10489    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> sock;
<a name="l10490"></a>10490 
<a name="l10491"></a>10491    sock = <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a160df84318ca2158f9302af6fe95330e">recv_sock</a>;
<a name="l10492"></a>10492 
<a name="l10493"></a>10493    <span class="keywordflow">if</span> (flags &amp; MSG_PEEK) {
<a name="l10494"></a>10494       status = recv(sock, <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>, <a class="code" href="fal_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a>, flags);
<a name="l10495"></a>10495       <span class="keywordflow">if</span> (status == -1)
<a name="l10496"></a>10496          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;recv_tcp_server&quot;</span>,
<a name="l10497"></a>10497                 <span class="stringliteral">&quot;recv(%d,MSG_PEEK) returned %d, errno: %d (%s)&quot;</span>, <a class="code" href="fal_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a>, status,
<a name="l10498"></a>10498                 errno, strerror(errno));
<a name="l10499"></a>10499       <span class="keywordflow">return</span> status;
<a name="l10500"></a>10500    }
<a name="l10501"></a>10501 
<a name="l10502"></a>10502    <span class="keywordflow">if</span> (!<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].net_buffer) {
<a name="l10503"></a>10503       <span class="keywordflow">if</span> (<a class="code" href="group__msystemincludecode.html#ga500895b6f1fb39626453b56a20ed52df">rpc_get_server_option</a>(<a class="code" href="group__mdefineh.html#ga7f6354019d48c7beeb8f5bd5c2fac8bb">RPC_OSERVER_TYPE</a>) != <a class="code" href="group__msectionh.html#ga9c6b34250ccc696d64a6a0a572947be5">ST_REMOTE</a>)
<a name="l10504"></a>10504          <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a6c512ad1188d75c1c7d98fab3f7b126d">net_buffer_size</a> = <a class="code" href="group__midasincludecode.html#ga31190e25ed33be085ff0af476af2c029">NET_TCP_SIZE</a>;
<a name="l10505"></a>10505       <span class="keywordflow">else</span>
<a name="l10506"></a>10506          <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a6c512ad1188d75c1c7d98fab3f7b126d">net_buffer_size</a> = <a class="code" href="group__msystemincludecode.html#ga7554d698d310e57e1c933a8f952a4bf8">NET_BUFFER_SIZE</a>;
<a name="l10507"></a>10507 
<a name="l10508"></a>10508       <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a6400b37f1e31eb4bbaab7785f72497e4">net_buffer</a> =
<a name="l10509"></a>10509           (<span class="keywordtype">char</span> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].net_buffer_size);
<a name="l10510"></a>10510       <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#accaa59acfaa48e20716049a4488769b9">write_ptr</a> = 0;
<a name="l10511"></a>10511       <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a521393acbafbdcee15fade0bb723be6d">read_ptr</a> = 0;
<a name="l10512"></a>10512       <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a612d05d2c2d687e07223ceb954a14087">misalign</a> = 0;
<a name="l10513"></a>10513    }
<a name="l10514"></a>10514    <span class="keywordflow">if</span> (!<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].net_buffer) {
<a name="l10515"></a>10515       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;recv_tcp_server&quot;</span>, <span class="stringliteral">&quot;not enough memory to allocate network buffer&quot;</span>);
<a name="l10516"></a>10516       <span class="keywordflow">return</span> -1;
<a name="l10517"></a>10517    }
<a name="l10518"></a>10518 
<a name="l10519"></a>10519    <span class="keywordflow">if</span> (<a class="code" href="fal_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a> &lt; <span class="keyword">sizeof</span>(<a class="code" href="structNET__COMMAND__HEADER.html">NET_COMMAND_HEADER</a>)) {
<a name="l10520"></a>10520       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;recv_tcp_server&quot;</span>, <span class="stringliteral">&quot;parameters too large for network buffer&quot;</span>);
<a name="l10521"></a>10521       <span class="keywordflow">return</span> -1;
<a name="l10522"></a>10522    }
<a name="l10523"></a>10523 
<a name="l10524"></a>10524    copied = 0;
<a name="l10525"></a>10525    param_size = -1;
<a name="l10526"></a>10526 
<a name="l10527"></a>10527    write_ptr = <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#accaa59acfaa48e20716049a4488769b9">write_ptr</a>;
<a name="l10528"></a>10528    read_ptr = <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a521393acbafbdcee15fade0bb723be6d">read_ptr</a>;
<a name="l10529"></a>10529    misalign = <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a612d05d2c2d687e07223ceb954a14087">misalign</a>;
<a name="l10530"></a>10530    net_buffer = <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a6400b37f1e31eb4bbaab7785f72497e4">net_buffer</a>;
<a name="l10531"></a>10531 
<a name="l10532"></a>10532    <span class="keywordflow">do</span> {
<a name="l10533"></a>10533       <span class="keywordflow">if</span> (write_ptr - read_ptr &gt;= (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <span class="keyword">sizeof</span>(<a class="code" href="structNET__COMMAND__HEADER.html">NET_COMMAND_HEADER</a>) - copied) {
<a name="l10534"></a>10534          <span class="keywordflow">if</span> (param_size == -1) {
<a name="l10535"></a>10535             <span class="keywordflow">if</span> (copied &gt; 0) {
<a name="l10536"></a>10536                <span class="comment">/* assemble split header */</span>
<a name="l10537"></a>10537                memcpy(<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> + copied, net_buffer + read_ptr,
<a name="l10538"></a>10538                       (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <span class="keyword">sizeof</span>(<a class="code" href="structNET__COMMAND__HEADER.html">NET_COMMAND_HEADER</a>) - copied);
<a name="l10539"></a>10539                nc = (<a class="code" href="structNET__COMMAND.html">NET_COMMAND</a> *) (<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>);
<a name="l10540"></a>10540             } <span class="keywordflow">else</span>
<a name="l10541"></a>10541                nc = (<a class="code" href="structNET__COMMAND.html">NET_COMMAND</a> *) (net_buffer + read_ptr);
<a name="l10542"></a>10542 
<a name="l10543"></a>10543             param_size = (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) nc-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#ae0c91723d3f4843639e659ccde63dc5a">param_size</a>;
<a name="l10544"></a>10544 
<a name="l10545"></a>10545             <a class="code" href="generate-MODULES_8h.html#aaac43492f2954cc70dd9a286b2b3ab02">if</a> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].convert_flags)
<a name="l10546"></a>10546                <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(&amp;param_size, <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a>, 0,
<a name="l10547"></a>10547                                   <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].convert_flags);
<a name="l10548"></a>10548          }
<a name="l10549"></a>10549 
<a name="l10550"></a>10550          <span class="comment">/* check if parameters fit in buffer */</span>
<a name="l10551"></a>10551          <span class="keywordflow">if</span> (<a class="code" href="fal_8c.html#a72c9a6de0ddd97509a04d596e1886e80">buffer_size</a> &lt; param_size + <span class="keyword">sizeof</span>(<a class="code" href="structNET__COMMAND__HEADER.html">NET_COMMAND_HEADER</a>)) {
<a name="l10552"></a>10552             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;recv_tcp_server&quot;</span>, <span class="stringliteral">&quot;parameters too large for network buffer&quot;</span>);
<a name="l10553"></a>10553             <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a521393acbafbdcee15fade0bb723be6d">read_ptr</a> = <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#accaa59acfaa48e20716049a4488769b9">write_ptr</a> = 0;
<a name="l10554"></a>10554             <span class="keywordflow">return</span> -1;
<a name="l10555"></a>10555          }
<a name="l10556"></a>10556 
<a name="l10557"></a>10557          <span class="comment">/* check if we have all parameters in buffer */</span>
<a name="l10558"></a>10558          <span class="keywordflow">if</span> (write_ptr - read_ptr &gt;=
<a name="l10559"></a>10559              param_size + (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <span class="keyword">sizeof</span>(<a class="code" href="structNET__COMMAND__HEADER.html">NET_COMMAND_HEADER</a>) - copied)
<a name="l10560"></a>10560             <span class="keywordflow">break</span>;
<a name="l10561"></a>10561       }
<a name="l10562"></a>10562 
<a name="l10563"></a>10563       <span class="comment">/* not enough data, so copy partially and get new */</span>
<a name="l10564"></a>10564       size = write_ptr - read_ptr;
<a name="l10565"></a>10565 
<a name="l10566"></a>10566       <span class="keywordflow">if</span> (size &gt; 0) {
<a name="l10567"></a>10567          memcpy(<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> + copied, net_buffer + read_ptr, size);
<a name="l10568"></a>10568          copied += size;
<a name="l10569"></a>10569          read_ptr = write_ptr;
<a name="l10570"></a>10570       }
<a name="l10571"></a>10571 <span class="preprocessor">#ifdef OS_UNIX</span>
<a name="l10572"></a>10572 <span class="preprocessor"></span>      <span class="keywordflow">do</span> {
<a name="l10573"></a>10573          write_ptr =
<a name="l10574"></a>10574              recv(sock, net_buffer + misalign,
<a name="l10575"></a>10575                   <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].net_buffer_size - 8, flags);
<a name="l10576"></a>10576 
<a name="l10577"></a>10577          <span class="comment">/* don&apos;t return if an alarm signal was cought */</span>
<a name="l10578"></a>10578       } <span class="keywordflow">while</span> (write_ptr == -1 &amp;&amp; errno == EINTR);
<a name="l10579"></a>10579 <span class="preprocessor">#else</span>
<a name="l10580"></a>10580 <span class="preprocessor"></span>      write_ptr =
<a name="l10581"></a>10581           recv(sock, net_buffer + misalign, <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].net_buffer_size - 8,
<a name="l10582"></a>10582                flags);
<a name="l10583"></a>10583 <span class="preprocessor">#endif</span>
<a name="l10584"></a>10584 <span class="preprocessor"></span>
<a name="l10585"></a>10585       <span class="comment">/* abort if connection broken */</span>
<a name="l10586"></a>10586       <span class="keywordflow">if</span> (write_ptr &lt;= 0) {
<a name="l10587"></a>10587          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;recv_tcp_server&quot;</span>, <span class="stringliteral">&quot;recv() returned %d, errno: %d (%s)&quot;</span>,
<a name="l10588"></a>10588                 write_ptr, errno, strerror(errno));
<a name="l10589"></a>10589 
<a name="l10590"></a>10590          <span class="keywordflow">if</span> (remaining)
<a name="l10591"></a>10591             *remaining = 0;
<a name="l10592"></a>10592 
<a name="l10593"></a>10593          <span class="keywordflow">return</span> write_ptr;
<a name="l10594"></a>10594       }
<a name="l10595"></a>10595 
<a name="l10596"></a>10596       read_ptr = misalign;
<a name="l10597"></a>10597       write_ptr += misalign;
<a name="l10598"></a>10598 
<a name="l10599"></a>10599       misalign = write_ptr % 8;
<a name="l10600"></a>10600    } <span class="keywordflow">while</span> (<a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l10601"></a>10601 
<a name="l10602"></a>10602    <span class="comment">/* copy rest of parameters */</span>
<a name="l10603"></a>10603    size = param_size + <span class="keyword">sizeof</span>(<a class="code" href="structNET__COMMAND__HEADER.html">NET_COMMAND_HEADER</a>) - copied;
<a name="l10604"></a>10604    memcpy(<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a> + copied, net_buffer + read_ptr, size);
<a name="l10605"></a>10605    read_ptr += size;
<a name="l10606"></a>10606 
<a name="l10607"></a>10607    <span class="keywordflow">if</span> (remaining) {
<a name="l10608"></a>10608       <span class="comment">/* don&apos;t keep rpc_server_receive in an infinite loop */</span>
<a name="l10609"></a>10609       <span class="keywordflow">if</span> (write_ptr - read_ptr &lt; param_size)
<a name="l10610"></a>10610          *remaining = 0;
<a name="l10611"></a>10611       <span class="keywordflow">else</span>
<a name="l10612"></a>10612          *remaining = write_ptr - read_ptr;
<a name="l10613"></a>10613    }
<a name="l10614"></a>10614 
<a name="l10615"></a>10615    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#accaa59acfaa48e20716049a4488769b9">write_ptr</a> = write_ptr;
<a name="l10616"></a>10616    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a521393acbafbdcee15fade0bb723be6d">read_ptr</a> = read_ptr;
<a name="l10617"></a>10617    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a612d05d2c2d687e07223ceb954a14087">misalign</a> = misalign;
<a name="l10618"></a>10618 
<a name="l10619"></a>10619    <span class="keywordflow">return</span> size + copied;
<a name="l10620"></a>10620 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga34b52a482a19eb8abcf8d84d888acbe0"></a><!-- doxytag: member="midas.c::rpc_calc_convert_flags" ref="ga34b52a482a19eb8abcf8d84d888acbe0" args="(INT hw_type, INT remote_hw_type, INT *convert_flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rpc_calc_convert_flags </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>hw_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>remote_hw_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> *&nbsp;</td>
          <td class="paramname"> <em>convert_flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l07974">7974</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l01822">CF_ASCII</a>, <a class="el" href="midas_8h_source.html#l01819">CF_ENDIAN</a>, <a class="el" href="midas_8h_source.html#l01820">CF_IEEE2VAX</a>, <a class="el" href="midas_8h_source.html#l01821">CF_VAX2IEEE</a>, <a class="el" href="msystem_8h_source.html#l00201">DR_ASCII</a>, <a class="el" href="msystem_8h_source.html#l00200">DRF_G_FLOAT</a>, <a class="el" href="msystem_8h_source.html#l00199">DRF_IEEE</a>, <a class="el" href="msystem_8h_source.html#l00198">DRI_BIG_ENDIAN</a>, and <a class="el" href="msystem_8h_source.html#l00197">DRI_LITTLE_ENDIAN</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l11860">rpc_client_accept()</a>, <a class="el" href="midas_8c_source.html#l07998">rpc_get_convert_flags()</a>, and <a class="el" href="midas_8c_source.html#l11980">rpc_server_callback()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07975"></a>07975 {
<a name="l07976"></a>07976    *convert_flags = 0;
<a name="l07977"></a>07977 
<a name="l07978"></a>07978    <span class="comment">/* big/little endian conversion */</span>
<a name="l07979"></a>07979    <span class="keywordflow">if</span> (((remote_hw_type &amp; <a class="code" href="group__msdefineh.html#gab3ef6d21655a8a91a2fbc6866ae42823">DRI_BIG_ENDIAN</a>) &amp;&amp;
<a name="l07980"></a>07980         (hw_type &amp; <a class="code" href="group__msdefineh.html#ga488afc1213500e60d6dd9a2939fb3204">DRI_LITTLE_ENDIAN</a>)) ||
<a name="l07981"></a>07981        ((remote_hw_type &amp; DRI_LITTLE_ENDIAN) &amp;&amp; (hw_type &amp; DRI_BIG_ENDIAN)))
<a name="l07982"></a>07982       *convert_flags |= <a class="code" href="group__msectionh.html#ga12b8a1f069715d673e75f2c37d2ecfd9">CF_ENDIAN</a>;
<a name="l07983"></a>07983 
<a name="l07984"></a>07984    <span class="comment">/* float conversion between IEEE and VAX G */</span>
<a name="l07985"></a>07985    <span class="keywordflow">if</span> ((remote_hw_type &amp; <a class="code" href="group__msdefineh.html#ga4ad501f5c59d4db17df10859e7ee97de">DRF_G_FLOAT</a>) &amp;&amp; (hw_type &amp; <a class="code" href="group__msdefineh.html#gacf6c5a8ba75600af57eaab22a9e6f4a5">DRF_IEEE</a>))
<a name="l07986"></a>07986       *convert_flags |= <a class="code" href="group__msectionh.html#gadd937ef1d95887c8735e10999d823021">CF_VAX2IEEE</a>;
<a name="l07987"></a>07987 
<a name="l07988"></a>07988    <span class="comment">/* float conversion between VAX G and IEEE */</span>
<a name="l07989"></a>07989    <span class="keywordflow">if</span> ((remote_hw_type &amp; DRF_IEEE) &amp;&amp; (hw_type &amp; DRF_G_FLOAT))
<a name="l07990"></a>07990       *convert_flags |= <a class="code" href="group__msectionh.html#gab0626e80fbf607cae6f17364efff7ce8">CF_IEEE2VAX</a>;
<a name="l07991"></a>07991 
<a name="l07992"></a>07992    <span class="comment">/* ASCII format */</span>
<a name="l07993"></a>07993    <span class="keywordflow">if</span> (remote_hw_type &amp; <a class="code" href="group__msdefineh.html#ga0fd6c5fc5e2431d0fc11fc9ca12c6baa">DR_ASCII</a>)
<a name="l07994"></a>07994       *convert_flags |= <a class="code" href="group__msectionh.html#ga2db779b9189033ca4e2ffed4654be032">CF_ASCII</a>;
<a name="l07995"></a>07995 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga1fdbf5429728ed90c87e0ffcaa5c4d0a"></a><!-- doxytag: member="midas.c::rpc_call" ref="ga1fdbf5429728ed90c87e0ffcaa5c4d0a" args="(const INT routine_id,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_call </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>routine_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l09810">9810</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l00824">_net_send_buffer</a>, <a class="el" href="midas_8c_source.html#l00825">_net_send_buffer_size</a>, <a class="el" href="midas_8h_source.html#l00904">ALIGN8</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="msystem_8h_source.html#l00198">DRI_BIG_ENDIAN</a>, <a class="el" href="msystem_8h_source.html#l00336">FD_SETSIZE</a>, <a class="el" href="midas_8h_source.html#l01801">RPC_PARAM::flags</a>, <a class="el" href="msystem_8h_source.html#l00386">NET_COMMAND::header</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="midas_8h_source.html#l01753">M_MALLOC</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l01802">RPC_PARAM::n</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00039">name</a>, <a class="el" href="msystem_8h_source.html#l00257">NET_BUFFER_SIZE</a>, <a class="el" href="mana_8cpp_source.html#l00657">param</a>, <a class="el" href="midas_8h_source.html#l01808">RPC_LIST::param</a>, <a class="el" href="msystem_8h_source.html#l00387">NET_COMMAND::param</a>, <a class="el" href="msystem_8h_source.html#l00382">NET_COMMAND_HEADER::param_size</a>, <a class="el" href="midas_8h_source.html#l00615">PTYPE</a>, <a class="el" href="system_8c_source.html#l03731">recv_tcp()</a>, <a class="el" href="msystem_8h_source.html#l00381">NET_COMMAND_HEADER::routine_id</a>, <a class="el" href="midas_8h_source.html#l01071">RPC_EXCEED_BUFFER</a>, <a class="el" href="midas_8h_source.html#l01784">RPC_FIXARRAY</a>, <a class="el" href="midas_8h_source.html#l00782">RPC_FTCP</a>, <a class="el" href="midas_8c_source.html#l09092">rpc_get_option()</a>, <a class="el" href="midas_8h_source.html#l01781">RPC_IN</a>, <a class="el" href="midas_8h_source.html#l01074">RPC_INVALID_ID</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8h_source.html#l00771">RPC_OHW_TYPE</a>, <a class="el" href="midas_8h_source.html#l01782">RPC_OUT</a>, <a class="el" href="midas_8h_source.html#l01783">RPC_POINTER</a>, <a class="el" href="midas_8c_source.html#l08975">rpc_server_disconnect()</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l01070">RPC_TIMEOUT</a>, <a class="el" href="msystem_8h_source.html#l00441">RPC_SERVER_CONNECTION::rpc_timeout</a>, <a class="el" href="midas_8c_source.html#l09479">rpc_va_arg()</a>, <a class="el" href="midas_8h_source.html#l01785">RPC_VARARRAY</a>, <a class="el" href="msystem_8h_source.html#l00436">RPC_SERVER_CONNECTION::send_sock</a>, <a class="el" href="system_8c_source.html#l03606">send_tcp()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="msystem_8h_source.html#l00397">TCP_FAST</a>, <a class="el" href="midas_8h_source.html#l01800">RPC_PARAM::tid</a>, <a class="el" href="midas_8h_source.html#l00747">TID_ARRAY</a>, <a class="el" href="midas_8h_source.html#l00735">TID_BYTE</a>, <a class="el" href="midas_8h_source.html#l00737">TID_CHAR</a>, <a class="el" href="midas_8h_source.html#l00744">TID_DOUBLE</a>, <a class="el" href="midas_8h_source.html#l00743">TID_FLOAT</a>, <a class="el" href="midas_8h_source.html#l00750">TID_LINK</a>, <a class="el" href="midas_8h_source.html#l00736">TID_SBYTE</a>, <a class="el" href="midas_8h_source.html#l00739">TID_SHORT</a>, <a class="el" href="midas_8c_source.html#l00749">tid_size</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="midas_8h_source.html#l00748">TID_STRUCT</a>, <a class="el" href="midas_8h_source.html#l00738">TID_WORD</a>, <a class="el" href="msystem_8h_source.html#l00440">RPC_SERVER_CONNECTION::transport</a>, and <a class="el" href="midas_8h_source.html#l00697">WATCHDOG_INTERVAL</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l16417">al_check()</a>, <a class="el" href="midas_8c_source.html#l16104">al_trigger_alarm()</a>, <a class="el" href="midas_8c_source.html#l05703">bm_add_event_request()</a>, <a class="el" href="midas_8c_source.html#l04722">bm_close_all_buffers()</a>, <a class="el" href="midas_8c_source.html#l04611">bm_close_buffer()</a>, <a class="el" href="midas_8c_source.html#l07751">bm_empty_buffers()</a>, <a class="el" href="midas_8c_source.html#l06412">bm_flush_cache()</a>, <a class="el" href="midas_8c_source.html#l05335">bm_get_buffer_info()</a>, <a class="el" href="midas_8c_source.html#l05385">bm_get_buffer_level()</a>, <a class="el" href="midas_8c_source.html#l05509">bm_init_buffer_counters()</a>, <a class="el" href="midas_8c_source.html#l07495">bm_mark_read_waiting()</a>, <a class="el" href="midas_8c_source.html#l04389">bm_open_buffer()</a>, <a class="el" href="midas_8c_source.html#l06777">bm_receive_event()</a>, <a class="el" href="midas_8c_source.html#l05920">bm_remove_event_request()</a>, <a class="el" href="midas_8c_source.html#l06057">bm_send_event()</a>, <a class="el" href="midas_8c_source.html#l05589">bm_set_cache_size()</a>, <a class="el" href="midas_8c_source.html#l07109">bm_skip_event()</a>, <a class="el" href="midas_8c_source.html#l01646">cm_asctime()</a>, <a class="el" href="midas_8c_source.html#l05147">cm_cleanup()</a>, <a class="el" href="midas_8c_source.html#l04219">cm_execute()</a>, <a class="el" href="midas_8c_source.html#l05069">cm_exist()</a>, <a class="el" href="midas_8c_source.html#l03134">cm_get_watchdog_info()</a>, <a class="el" href="midas_8c_source.html#l01049">cm_msg_log()</a>, <a class="el" href="midas_8c_source.html#l01118">cm_msg_log1()</a>, <a class="el" href="midas_8c_source.html#l01507">cm_msg_retrieve()</a>, <a class="el" href="midas_8c_source.html#l01976">cm_set_client_info()</a>, <a class="el" href="midas_8c_source.html#l03000">cm_set_watchdog_params()</a>, <a class="el" href="midas_8c_source.html#l01618">cm_synchronize()</a>, <a class="el" href="midas_8c_source.html#l01664">cm_time()</a>, <a class="el" href="odb_8c_source.html#l06943">db_add_open_record()</a>, <a class="el" href="odb_8c_source.html#l07436">db_check_record()</a>, <a class="el" href="odb_8c_source.html#l01498">db_close_all_databases()</a>, <a class="el" href="odb_8c_source.html#l01305">db_close_database()</a>, <a class="el" href="odb_8c_source.html#l01721">db_create_key()</a>, <a class="el" href="odb_8c_source.html#l01960">db_create_link()</a>, <a class="el" href="odb_8c_source.html#l07266">db_create_record()</a>, <a class="el" href="odb_8c_source.html#l02160">db_delete_key()</a>, <a class="el" href="odb_8c_source.html#l03390">db_enum_key()</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l02344">db_find_key1()</a>, <a class="el" href="odb_8c_source.html#l02489">db_find_link()</a>, <a class="el" href="odb_8c_source.html#l02650">db_find_link1()</a>, <a class="el" href="odb_8c_source.html#l01422">db_flush_database()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l04244">db_get_data1()</a>, <a class="el" href="odb_8c_source.html#l04376">db_get_data_index()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l03840">db_get_key_info()</a>, <a class="el" href="odb_8c_source.html#l03782">db_get_key_time()</a>, <a class="el" href="odb_8c_source.html#l03567">db_get_next_link()</a>, <a class="el" href="odb_8c_source.html#l03064">db_get_open_records()</a>, <a class="el" href="odb_8c_source.html#l02907">db_get_path()</a>, <a class="el" href="odb_8c_source.html#l06770">db_get_record()</a>, <a class="el" href="odb_8c_source.html#l06684">db_get_record_size()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="odb_8c_source.html#l05138">db_load()</a>, <a class="el" href="odb_8c_source.html#l00993">db_open_database()</a>, <a class="el" href="odb_8c_source.html#l07025">db_remove_open_record()</a>, <a class="el" href="odb_8c_source.html#l03911">db_rename_key()</a>, <a class="el" href="odb_8c_source.html#l03984">db_reorder_key()</a>, <a class="el" href="odb_8c_source.html#l05878">db_save()</a>, <a class="el" href="odb_8c_source.html#l01536">db_set_client_name()</a>, <a class="el" href="odb_8c_source.html#l04503">db_set_data()</a>, <a class="el" href="odb_8c_source.html#l04727">db_set_data_index()</a>, <a class="el" href="odb_8c_source.html#l04836">db_set_data_index2()</a>, <a class="el" href="odb_8c_source.html#l05019">db_set_mode()</a>, <a class="el" href="odb_8c_source.html#l04607">db_set_num_values()</a>, <a class="el" href="odb_8c_source.html#l06874">db_set_record()</a>, <a class="el" href="odb_8c_source.html#l03128">db_set_value()</a>, <a class="el" href="midas_8c_source.html#l15064">el_submit()</a>, <a class="el" href="midas_8c_source.html#l13907">hs_count_events()</a>, <a class="el" href="midas_8c_source.html#l14064">hs_count_vars()</a>, <a class="el" href="midas_8c_source.html#l13818">hs_enum_events()</a>, <a class="el" href="midas_8c_source.html#l14134">hs_enum_vars()</a>, <a class="el" href="midas_8c_source.html#l13985">hs_get_event_id()</a>, <a class="el" href="midas_8c_source.html#l14241">hs_get_var()</a>, <a class="el" href="midas_8c_source.html#l14339">hs_read()</a>, <a class="el" href="midas_8c_source.html#l13244">hs_set_path()</a>, <a class="el" href="rpc__test_8c_source.html#l00037">main()</a>, and <a class="el" href="midas_8c_source.html#l08975">rpc_server_disconnect()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09813"></a>09813          : <a class="code" href="group__msectionh.html#ga6bf1d13a0c49a3f7a02650885937b5e7">rpc_call</a>
<a name="l09814"></a>09814 
<a name="l09815"></a>09815   Purpose: Call a function on a MIDAS server
<a name="l09816"></a>09816 
<a name="l09817"></a>09817   Input:
<a name="l09818"></a>09818     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>  routine_id         routine <a class="code" href="jorway73a_8h.html#a4bfe115debc7f472dd7dfe4ef9679ca0">ID</a> as defined <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> RPC.H (RPC_xxx)
<a name="l09819"></a>09819 
<a name="l09820"></a>09820     ...                     <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a> argument <a class="code" href="namespacemodules.html#a12afb64f27b8a4e356d665de83e78ad3">list</a>
<a name="l09821"></a>09821 
<a name="l09822"></a>09822   Output:
<a name="l09823"></a>09823     (depends on argument <a class="code" href="namespacemodules.html#a12afb64f27b8a4e356d665de83e78ad3">list</a>)
<a name="l09824"></a>09824 
<a name="l09825"></a>09825   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l09826"></a>09826     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l09827"></a>09827     <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>           Error <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> socket <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a>
<a name="l09828"></a>09828     <a class="code" href="group__err25.html#gad3a9f2a6b26ce5b987f6b2088fbb627c">RPC_NO_CONNECTION</a>       No active connection
<a name="l09829"></a>09829     <a class="code" href="group__err25.html#gad29d62bce98ff8494be9337cb1a0a1f1">RPC_TIMEOUT</a>             Timeout <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> RPC <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a>
<a name="l09830"></a>09830     <a class="code" href="group__err25.html#ga3cbff68ac5b5d52f692b8e880f9ef76c">RPC_INVALID_ID</a>          Invalid routine_id (not <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>)
<a name="l09831"></a>09831     <a class="code" href="group__err25.html#ga1a35d5e05d16d9040eaad41c4434a20a">RPC_EXCEED_BUFFER</a>       Paramters don<span class="stringliteral">&apos;t fit in network buffer</span>
<a name="l09832"></a>09832 <span class="stringliteral"></span>
<a name="l09833"></a>09833 <span class="stringliteral">\********************************************************************/</span>
<a name="l09834"></a>09834 <span class="stringliteral">{</span>
<a name="l09835"></a>09835 <span class="stringliteral">   va_list ap, aptmp;</span>
<a name="l09836"></a>09836 <span class="stringliteral">   char arg[8], arg_tmp[8];</span>
<a name="l09837"></a>09837 <span class="stringliteral">   INT arg_type, transport, rpc_timeout;</span>
<a name="l09838"></a>09838 <span class="stringliteral">   INT i, index, status;</span>
<a name="l09839"></a>09839 <span class="stringliteral">   INT param_size, arg_size, send_size;</span>
<a name="l09840"></a>09840 <span class="stringliteral">   INT tid, flags;</span>
<a name="l09841"></a>09841 <span class="stringliteral">   fd_set readfds;</span>
<a name="l09842"></a>09842 <span class="stringliteral">   struct timeval timeout;</span>
<a name="l09843"></a>09843 <span class="stringliteral">   char *param_ptr, str[80];</span>
<a name="l09844"></a>09844 <span class="stringliteral">   BOOL bpointer, bbig;</span>
<a name="l09845"></a>09845 <span class="stringliteral">   NET_COMMAND *nc;</span>
<a name="l09846"></a>09846 <span class="stringliteral">   int send_sock;</span>
<a name="l09847"></a>09847 <span class="stringliteral"></span>
<a name="l09848"></a>09848 <span class="stringliteral">   send_sock = _server_connection.send_sock;</span>
<a name="l09849"></a>09849 <span class="stringliteral">   transport = _server_connection.transport;</span>
<a name="l09850"></a>09850 <span class="stringliteral">   rpc_timeout = _server_connection.rpc_timeout;</span>
<a name="l09851"></a>09851 <span class="stringliteral"></span>
<a name="l09852"></a>09852 <span class="stringliteral">   /* init network buffer */</span>
<a name="l09853"></a>09853 <span class="stringliteral">   if (_net_send_buffer_size == 0) {</span>
<a name="l09854"></a>09854 <span class="stringliteral">      _net_send_buffer = (char *) M_MALLOC(NET_BUFFER_SIZE);</span>
<a name="l09855"></a>09855 <span class="stringliteral">      if (_net_send_buffer == NULL) {</span>
<a name="l09856"></a>09856 <span class="stringliteral">         cm_msg(MERROR, &quot;rpc_call&quot;, &quot;not enough memory to allocate network buffer&quot;);</span>
<a name="l09857"></a>09857 <span class="stringliteral">         return RPC_EXCEED_BUFFER;</span>
<a name="l09858"></a>09858 <span class="stringliteral">      }</span>
<a name="l09859"></a>09859 <span class="stringliteral">      _net_send_buffer_size = NET_BUFFER_SIZE;</span>
<a name="l09860"></a>09860 <span class="stringliteral">   }</span>
<a name="l09861"></a>09861 <span class="stringliteral"></span>
<a name="l09862"></a>09862 <span class="stringliteral">   nc = (NET_COMMAND *) _net_send_buffer;</span>
<a name="l09863"></a>09863 <span class="stringliteral">   nc-&gt;header.routine_id = routine_id;</span>
<a name="l09864"></a>09864 <span class="stringliteral"></span>
<a name="l09865"></a>09865 <span class="stringliteral">   if (transport == RPC_FTCP)</span>
<a name="l09866"></a>09866 <span class="stringliteral">      nc-&gt;header.routine_id |= TCP_FAST;</span>
<a name="l09867"></a>09867 <span class="stringliteral"></span>
<a name="l09868"></a>09868 <span class="stringliteral">   for (i = 0;; i++)</span>
<a name="l09869"></a>09869 <span class="stringliteral">      if (rpc_list[i].id == routine_id || rpc_list[i].id == 0)</span>
<a name="l09870"></a>09870 <span class="stringliteral">         break;</span>
<a name="l09871"></a>09871 <span class="stringliteral">   index = i;</span>
<a name="l09872"></a>09872 <span class="stringliteral">   if (rpc_list[i].id == 0) {</span>
<a name="l09873"></a>09873 <span class="stringliteral">      sprintf(str, &quot;invalid rpc ID (%d)&quot;, routine_id);</span>
<a name="l09874"></a>09874 <span class="stringliteral">      cm_msg(MERROR, &quot;rpc_call&quot;, str);</span>
<a name="l09875"></a>09875 <span class="stringliteral">      return RPC_INVALID_ID;</span>
<a name="l09876"></a>09876 <span class="stringliteral">   }</span>
<a name="l09877"></a>09877 <span class="stringliteral"></span>
<a name="l09878"></a>09878 <span class="stringliteral">   /* examine variable argument list and convert it to parameter array */</span>
<a name="l09879"></a>09879 <span class="stringliteral">   va_start(ap, routine_id);</span>
<a name="l09880"></a>09880 <span class="stringliteral"></span>
<a name="l09881"></a>09881 <span class="stringliteral">   /* find out if we are on a big endian system */</span>
<a name="l09882"></a>09882 <span class="stringliteral">   bbig = ((rpc_get_option(0, RPC_OHW_TYPE) &amp; DRI_BIG_ENDIAN) &gt; 0);</span>
<a name="l09883"></a>09883 <span class="stringliteral"></span>
<a name="l09884"></a>09884 <span class="stringliteral">   for (i = 0, param_ptr = nc-&gt;param; rpc_list[index].param[i].tid != 0; i++) {</span>
<a name="l09885"></a>09885 <span class="stringliteral">      tid = rpc_list[index].param[i].tid;</span>
<a name="l09886"></a>09886 <span class="stringliteral">      flags = rpc_list[index].param[i].flags;</span>
<a name="l09887"></a>09887 <span class="stringliteral"></span>
<a name="l09888"></a>09888 <span class="stringliteral">      bpointer = (flags &amp; RPC_POINTER) || (flags &amp; RPC_OUT) ||</span>
<a name="l09889"></a>09889 <span class="stringliteral">          (flags &amp; RPC_FIXARRAY) || (flags &amp; RPC_VARARRAY) ||</span>
<a name="l09890"></a>09890 <span class="stringliteral">          tid == TID_STRING || tid == TID_ARRAY || tid == TID_STRUCT || tid == TID_LINK;</span>
<a name="l09891"></a>09891 <span class="stringliteral"></span>
<a name="l09892"></a>09892 <span class="stringliteral">      if (bpointer)</span>
<a name="l09893"></a>09893 <span class="stringliteral">         arg_type = TID_ARRAY;</span>
<a name="l09894"></a>09894 <span class="stringliteral">      else</span>
<a name="l09895"></a>09895 <span class="stringliteral">         arg_type = tid;</span>
<a name="l09896"></a>09896 <span class="stringliteral"></span>
<a name="l09897"></a>09897 <span class="stringliteral">      /* floats are passed as doubles, at least under NT */</span>
<a name="l09898"></a>09898 <span class="stringliteral">      if (tid == TID_FLOAT &amp;&amp; !bpointer)</span>
<a name="l09899"></a>09899 <span class="stringliteral">         arg_type = TID_DOUBLE;</span>
<a name="l09900"></a>09900 <span class="stringliteral"></span>
<a name="l09901"></a>09901 <span class="stringliteral">      /* get pointer to argument */</span>
<a name="l09902"></a>09902 <span class="stringliteral">      rpc_va_arg(&amp;ap, arg_type, arg);</span>
<a name="l09903"></a>09903 <span class="stringliteral"></span>
<a name="l09904"></a>09904 <span class="stringliteral">      /* shift 1- and 2-byte parameters to the LSB on big endian systems */</span>
<a name="l09905"></a>09905 <span class="stringliteral">      if (bbig) {</span>
<a name="l09906"></a>09906 <span class="stringliteral">         if (tid == TID_BYTE || tid == TID_CHAR || tid == TID_SBYTE) {</span>
<a name="l09907"></a>09907 <span class="stringliteral">            arg[0] = arg[3];</span>
<a name="l09908"></a>09908 <span class="stringliteral">         }</span>
<a name="l09909"></a>09909 <span class="stringliteral">         if (tid == TID_WORD || tid == TID_SHORT) {</span>
<a name="l09910"></a>09910 <span class="stringliteral">            arg[0] = arg[2];</span>
<a name="l09911"></a>09911 <span class="stringliteral">            arg[1] = arg[3];</span>
<a name="l09912"></a>09912 <span class="stringliteral">         }</span>
<a name="l09913"></a>09913 <span class="stringliteral">      }</span>
<a name="l09914"></a>09914 <span class="stringliteral"></span>
<a name="l09915"></a>09915 <span class="stringliteral">      if (flags &amp; RPC_IN) {</span>
<a name="l09916"></a>09916 <span class="stringliteral">         if (bpointer)</span>
<a name="l09917"></a>09917 <span class="stringliteral">            arg_size = tid_size[tid];</span>
<a name="l09918"></a>09918 <span class="stringliteral">         else</span>
<a name="l09919"></a>09919 <span class="stringliteral">            arg_size = tid_size[arg_type];</span>
<a name="l09920"></a>09920 <span class="stringliteral"></span>
<a name="l09921"></a>09921 <span class="stringliteral">         /* for strings, the argument size depends on the string length */</span>
<a name="l09922"></a>09922 <span class="stringliteral">         if (tid == TID_STRING || tid == TID_LINK)</span>
<a name="l09923"></a>09923 <span class="stringliteral">            arg_size = 1 + strlen((char *) *((char **) arg));</span>
<a name="l09924"></a>09924 <span class="stringliteral"></span>
<a name="l09925"></a>09925 <span class="stringliteral">         /* for varibale length arrays, the size is given by</span>
<a name="l09926"></a>09926 <span class="stringliteral">            the next parameter on the stack */</span>
<a name="l09927"></a>09927 <span class="stringliteral">         if (flags &amp; RPC_VARARRAY) {</span>
<a name="l09928"></a>09928 <span class="stringliteral">            memcpy(&amp;aptmp, &amp;ap, sizeof(ap));</span>
<a name="l09929"></a>09929 <span class="stringliteral">            rpc_va_arg(&amp;aptmp, TID_ARRAY, arg_tmp);</span>
<a name="l09930"></a>09930 <span class="stringliteral"></span>
<a name="l09931"></a>09931 <span class="stringliteral">            if (flags &amp; RPC_OUT)</span>
<a name="l09932"></a>09932 <span class="stringliteral">               arg_size = *((INT *) * ((void **) arg_tmp));</span>
<a name="l09933"></a>09933 <span class="stringliteral">            else</span>
<a name="l09934"></a>09934 <span class="stringliteral">               arg_size = *((INT *) arg_tmp);</span>
<a name="l09935"></a>09935 <span class="stringliteral"></span>
<a name="l09936"></a>09936 <span class="stringliteral">            *((INT *) param_ptr) = ALIGN8(arg_size);</span>
<a name="l09937"></a>09937 <span class="stringliteral">            param_ptr += ALIGN8(sizeof(INT));</span>
<a name="l09938"></a>09938 <span class="stringliteral">         }</span>
<a name="l09939"></a>09939 <span class="stringliteral"></span>
<a name="l09940"></a>09940 <span class="stringliteral">         if (tid == TID_STRUCT || (flags &amp; RPC_FIXARRAY))</span>
<a name="l09941"></a>09941 <span class="stringliteral">            arg_size = rpc_list[index].param[i].n;</span>
<a name="l09942"></a>09942 <span class="stringliteral"></span>
<a name="l09943"></a>09943 <span class="stringliteral">         /* always align parameter size */</span>
<a name="l09944"></a>09944 <span class="stringliteral">         param_size = ALIGN8(arg_size);</span>
<a name="l09945"></a>09945 <span class="stringliteral"></span>
<a name="l09946"></a>09946 <span class="stringliteral">         if ((PTYPE) param_ptr - (PTYPE) nc + param_size &gt; NET_BUFFER_SIZE) {</span>
<a name="l09947"></a>09947 <span class="stringliteral">            cm_msg(MERROR, &quot;rpc_call&quot;,</span>
<a name="l09948"></a>09948 <span class="stringliteral">                   &quot;parameters (%d) too large for network buffer (%d)&quot;,</span>
<a name="l09949"></a>09949 <span class="stringliteral">                   (PTYPE) param_ptr - (PTYPE) nc + param_size, NET_BUFFER_SIZE);</span>
<a name="l09950"></a>09950 <span class="stringliteral">            return RPC_EXCEED_BUFFER;</span>
<a name="l09951"></a>09951 <span class="stringliteral">         }</span>
<a name="l09952"></a>09952 <span class="stringliteral"></span>
<a name="l09953"></a>09953 <span class="stringliteral">         if (bpointer)</span>
<a name="l09954"></a>09954 <span class="stringliteral">            memcpy(param_ptr, (void *) *((void **) arg), arg_size);</span>
<a name="l09955"></a>09955 <span class="stringliteral">         else {</span>
<a name="l09956"></a>09956 <span class="stringliteral">            /* floats are passed as doubles on most systems */</span>
<a name="l09957"></a>09957 <span class="stringliteral">            if (tid != TID_FLOAT)</span>
<a name="l09958"></a>09958 <span class="stringliteral">               memcpy(param_ptr, arg, arg_size);</span>
<a name="l09959"></a>09959 <span class="stringliteral">            else</span>
<a name="l09960"></a>09960 <span class="stringliteral">               *((float *) param_ptr) = (float) *((double *) arg);</span>
<a name="l09961"></a>09961 <span class="stringliteral">         }</span>
<a name="l09962"></a>09962 <span class="stringliteral"></span>
<a name="l09963"></a>09963 <span class="stringliteral">         param_ptr += param_size;</span>
<a name="l09964"></a>09964 <span class="stringliteral"></span>
<a name="l09965"></a>09965 <span class="stringliteral">      }</span>
<a name="l09966"></a>09966 <span class="stringliteral">   }</span>
<a name="l09967"></a>09967 <span class="stringliteral"></span>
<a name="l09968"></a>09968 <span class="stringliteral">   va_end(ap);</span>
<a name="l09969"></a>09969 <span class="stringliteral"></span>
<a name="l09970"></a>09970 <span class="stringliteral">   nc-&gt;header.param_size = (PTYPE) param_ptr - (PTYPE) nc-&gt;param;</span>
<a name="l09971"></a>09971 <span class="stringliteral"></span>
<a name="l09972"></a>09972 <span class="stringliteral">   send_size = nc-&gt;header.param_size + sizeof(NET_COMMAND_HEADER);</span>
<a name="l09973"></a>09973 <span class="stringliteral"></span>
<a name="l09974"></a>09974 <span class="stringliteral">   /* in FAST TCP mode, only send call and return immediately */</span>
<a name="l09975"></a>09975 <span class="stringliteral">   if (transport == RPC_FTCP) {</span>
<a name="l09976"></a>09976 <span class="stringliteral">      i = send_tcp(send_sock, (char *) nc, send_size, 0);</span>
<a name="l09977"></a>09977 <span class="stringliteral"></span>
<a name="l09978"></a>09978 <span class="stringliteral">      if (i != send_size) {</span>
<a name="l09979"></a>09979 <span class="stringliteral">         cm_msg(MERROR, &quot;rpc_call&quot;, &quot;send_tcp() failed&quot;);</span>
<a name="l09980"></a>09980 <span class="stringliteral">         return RPC_NET_ERROR;</span>
<a name="l09981"></a>09981 <span class="stringliteral">      }</span>
<a name="l09982"></a>09982 <span class="stringliteral"></span>
<a name="l09983"></a>09983 <span class="stringliteral">      return RPC_SUCCESS;</span>
<a name="l09984"></a>09984 <span class="stringliteral">   }</span>
<a name="l09985"></a>09985 <span class="stringliteral"></span>
<a name="l09986"></a>09986 <span class="stringliteral">   /* in TCP mode, send and wait for reply on send socket */</span>
<a name="l09987"></a>09987 <span class="stringliteral">   i = send_tcp(send_sock, (char *) nc, send_size, 0);</span>
<a name="l09988"></a>09988 <span class="stringliteral">   if (i != send_size) {</span>
<a name="l09989"></a>09989 <span class="stringliteral">      cm_msg(MERROR, &quot;rpc_call&quot;, &quot;send_tcp() failed&quot;);</span>
<a name="l09990"></a>09990 <span class="stringliteral">      return RPC_NET_ERROR;</span>
<a name="l09991"></a>09991 <span class="stringliteral">   }</span>
<a name="l09992"></a>09992 <span class="stringliteral"></span>
<a name="l09993"></a>09993 <span class="stringliteral">   /* make some timeout checking */</span>
<a name="l09994"></a>09994 <span class="stringliteral">   if (rpc_timeout &gt; 0) {</span>
<a name="l09995"></a>09995 <span class="stringliteral">      FD_ZERO(&amp;readfds);</span>
<a name="l09996"></a>09996 <span class="stringliteral">      FD_SET(send_sock, &amp;readfds);</span>
<a name="l09997"></a>09997 <span class="stringliteral"></span>
<a name="l09998"></a>09998 <span class="stringliteral">      timeout.tv_sec = rpc_timeout / 1000;</span>
<a name="l09999"></a>09999 <span class="stringliteral">      timeout.tv_usec = (rpc_timeout % 1000) * 1000;</span>
<a name="l10000"></a>10000 <span class="stringliteral"></span>
<a name="l10001"></a>10001 <span class="stringliteral">      do {</span>
<a name="l10002"></a>10002 <span class="stringliteral">         status = select(FD_SETSIZE, &amp;readfds, NULL, NULL, &amp;timeout);</span>
<a name="l10003"></a>10003 <span class="stringliteral"></span>
<a name="l10004"></a>10004 <span class="stringliteral">         /* if an alarm signal was cought, restart select with reduced timeout */</span>
<a name="l10005"></a>10005 <span class="stringliteral">         if (status == -1 &amp;&amp; timeout.tv_sec &gt;= WATCHDOG_INTERVAL / 1000)</span>
<a name="l10006"></a>10006 <span class="stringliteral">            timeout.tv_sec -= WATCHDOG_INTERVAL / 1000;</span>
<a name="l10007"></a>10007 <span class="stringliteral"></span>
<a name="l10008"></a>10008 <span class="stringliteral">      } while (status == -1);   /* dont return if an alarm signal was cought */</span>
<a name="l10009"></a>10009 <span class="stringliteral"></span>
<a name="l10010"></a>10010 <span class="stringliteral">      if (!FD_ISSET(send_sock, &amp;readfds)) {</span>
<a name="l10011"></a>10011 <span class="stringliteral">         cm_msg(MERROR, &quot;rpc_call&quot;, &quot;rpc timeout, routine = \&quot;%s\&quot;&quot;,</span>
<a name="l10012"></a>10012 <span class="stringliteral">                rpc_list[index].name);</span>
<a name="l10013"></a>10013 <span class="stringliteral"></span>
<a name="l10014"></a>10014 <span class="stringliteral">         /* disconnect to avoid that the reply to this rpc_call comes at</span>
<a name="l10015"></a>10015 <span class="stringliteral">            the next rpc_call */</span>
<a name="l10016"></a>10016 <span class="stringliteral">         rpc_server_disconnect();</span>
<a name="l10017"></a>10017 <span class="stringliteral"></span>
<a name="l10018"></a>10018 <span class="stringliteral">         return RPC_TIMEOUT;</span>
<a name="l10019"></a>10019 <span class="stringliteral">      }</span>
<a name="l10020"></a>10020 <span class="stringliteral">   }</span>
<a name="l10021"></a>10021 <span class="stringliteral"></span>
<a name="l10022"></a>10022 <span class="stringliteral">   /* receive result on send socket */</span>
<a name="l10023"></a>10023 <span class="stringliteral">   i = recv_tcp(send_sock, _net_send_buffer, NET_BUFFER_SIZE, 0);</span>
<a name="l10024"></a>10024 <span class="stringliteral"></span>
<a name="l10025"></a>10025 <span class="stringliteral">   if (i &lt;= 0) {</span>
<a name="l10026"></a>10026 <span class="stringliteral">      cm_msg(MERROR, &quot;rpc_call&quot;, &quot;recv_tcp() failed, routine = \&quot;%s\&quot;&quot;,</span>
<a name="l10027"></a>10027 <span class="stringliteral">             rpc_list[index].name);</span>
<a name="l10028"></a>10028 <span class="stringliteral">      return RPC_NET_ERROR;</span>
<a name="l10029"></a>10029 <span class="stringliteral">   }</span>
<a name="l10030"></a>10030 <span class="stringliteral"></span>
<a name="l10031"></a>10031 <span class="stringliteral">   /* extract result variables and place it to argument list */</span>
<a name="l10032"></a>10032 <span class="stringliteral">   status = nc-&gt;header.routine_id;</span>
<a name="l10033"></a>10033 <span class="stringliteral"></span>
<a name="l10034"></a>10034 <span class="stringliteral">   va_start(ap, routine_id);</span>
<a name="l10035"></a>10035 <span class="stringliteral"></span>
<a name="l10036"></a>10036 <span class="stringliteral">   for (i = 0, param_ptr = nc-&gt;param; rpc_list[index].param[i].tid != 0; i++) {</span>
<a name="l10037"></a>10037 <span class="stringliteral">      tid = rpc_list[index].param[i].tid;</span>
<a name="l10038"></a>10038 <span class="stringliteral">      flags = rpc_list[index].param[i].flags;</span>
<a name="l10039"></a>10039 <span class="stringliteral"></span>
<a name="l10040"></a>10040 <span class="stringliteral">      bpointer = (flags &amp; RPC_POINTER) || (flags &amp; RPC_OUT) ||</span>
<a name="l10041"></a>10041 <span class="stringliteral">          (flags &amp; RPC_FIXARRAY) || (flags &amp; RPC_VARARRAY) ||</span>
<a name="l10042"></a>10042 <span class="stringliteral">          tid == TID_STRING || tid == TID_ARRAY || tid == TID_STRUCT || tid == TID_LINK;</span>
<a name="l10043"></a>10043 <span class="stringliteral"></span>
<a name="l10044"></a>10044 <span class="stringliteral">      if (bpointer)</span>
<a name="l10045"></a>10045 <span class="stringliteral">         arg_type = TID_ARRAY;</span>
<a name="l10046"></a>10046 <span class="stringliteral">      else</span>
<a name="l10047"></a>10047 <span class="stringliteral">         arg_type = rpc_list[index].param[i].tid;</span>
<a name="l10048"></a>10048 <span class="stringliteral"></span>
<a name="l10049"></a>10049 <span class="stringliteral">      if (tid == TID_FLOAT &amp;&amp; !bpointer)</span>
<a name="l10050"></a>10050 <span class="stringliteral">         arg_type = TID_DOUBLE;</span>
<a name="l10051"></a>10051 <span class="stringliteral"></span>
<a name="l10052"></a>10052 <span class="stringliteral">      rpc_va_arg(&amp;ap, arg_type, arg);</span>
<a name="l10053"></a>10053 <span class="stringliteral"></span>
<a name="l10054"></a>10054 <span class="stringliteral">      if (rpc_list[index].param[i].flags &amp; RPC_OUT) {</span>
<a name="l10055"></a>10055 <span class="stringliteral">         tid = rpc_list[index].param[i].tid;</span>
<a name="l10056"></a>10056 <span class="stringliteral">         arg_size = tid_size[tid];</span>
<a name="l10057"></a>10057 <span class="stringliteral"></span>
<a name="l10058"></a>10058 <span class="stringliteral">         if (tid == TID_STRING || tid == TID_LINK)</span>
<a name="l10059"></a>10059 <span class="stringliteral">            arg_size = strlen((char *) (param_ptr)) + 1;</span>
<a name="l10060"></a>10060 <span class="stringliteral"></span>
<a name="l10061"></a>10061 <span class="stringliteral">         if (flags &amp; RPC_VARARRAY) {</span>
<a name="l10062"></a>10062 <span class="stringliteral">            arg_size = *((INT *) param_ptr);</span>
<a name="l10063"></a>10063 <span class="stringliteral">            param_ptr += ALIGN8(sizeof(INT));</span>
<a name="l10064"></a>10064 <span class="stringliteral">         }</span>
<a name="l10065"></a>10065 <span class="stringliteral"></span>
<a name="l10066"></a>10066 <span class="stringliteral">         if (tid == TID_STRUCT || (flags &amp; RPC_FIXARRAY))</span>
<a name="l10067"></a>10067 <span class="stringliteral">            arg_size = rpc_list[index].param[i].n;</span>
<a name="l10068"></a>10068 <span class="stringliteral"></span>
<a name="l10069"></a>10069 <span class="stringliteral">         /* return parameters are always pointers */</span>
<a name="l10070"></a>10070 <span class="stringliteral">         if (*((char **) arg))</span>
<a name="l10071"></a>10071 <span class="stringliteral">            memcpy((void *) *((char **) arg), param_ptr, arg_size);</span>
<a name="l10072"></a>10072 <span class="stringliteral"></span>
<a name="l10073"></a>10073 <span class="stringliteral">         /* parameter size is always aligned */</span>
<a name="l10074"></a>10074 <span class="stringliteral">         param_size = ALIGN8(arg_size);</span>
<a name="l10075"></a>10075 <span class="stringliteral"></span>
<a name="l10076"></a>10076 <span class="stringliteral">         param_ptr += param_size;</span>
<a name="l10077"></a>10077 <span class="stringliteral">      }</span>
<a name="l10078"></a>10078 <span class="stringliteral">   }</span>
<a name="l10079"></a>10079 <span class="stringliteral"></span>
<a name="l10080"></a>10080 <span class="stringliteral">   va_end(ap);</span>
<a name="l10081"></a>10081 <span class="stringliteral"></span>
<a name="l10082"></a>10082 <span class="stringliteral">   return status;</span>
<a name="l10083"></a>10083 <span class="stringliteral">}</span>
</pre></div></p>

</div>
</div>
<a class="anchor" id="gae04dcc2753aa274bcfe09835be8ddfb9"></a><!-- doxytag: member="midas.c::rpc_check_channels" ref="gae04dcc2753aa274bcfe09835be8ddfb9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_check_channels </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l12486">12486</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="melog_8c_source.html#l00085">closesocket</a>, <a class="el" href="midas_8c_source.html#l02768">cm_disconnect_experiment()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="msystem_8h_source.html#l00336">FD_SETSIZE</a>, <a class="el" href="msystem_8h_source.html#l00386">NET_COMMAND::header</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="midas_8h_source.html#l01755">M_FREE</a>, <a class="el" href="msystem_8h_source.html#l00255">MAX_RPC_CONNECTION</a>, <a class="el" href="lrs1821_8h_source.html#l00221">MINFO</a>, <a class="el" href="msystem_8h_source.html#l00404">MSG_WATCHDOG</a>, <a class="el" href="msystem_8h_source.html#l00457">RPC_SERVER_ACCEPTION::net_buffer</a>, <a class="el" href="rpc_8c_source.html#l00293">net_buffer</a>, <a class="el" href="msystem_8h_source.html#l00382">NET_COMMAND_HEADER::param_size</a>, <a class="el" href="system_8c_source.html#l03731">recv_tcp()</a>, <a class="el" href="msystem_8h_source.html#l00381">NET_COMMAND_HEADER::routine_id</a>, <a class="el" href="midas_8h_source.html#l00774">RPC_CONVERT_FLAGS</a>, <a class="el" href="midas_8c_source.html#l08079">rpc_convert_single()</a>, <a class="el" href="midas_8c_source.html#l09250">rpc_get_server_option()</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8h_source.html#l00772">RPC_OSERVER_TYPE</a>, <a class="el" href="midas_8h_source.html#l01786">RPC_OUTGOING</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="system_8c_source.html#l03606">send_tcp()</a>, <a class="el" href="system_8c_source.html#l01050">ss_gettid()</a>, <a class="el" href="system_8c_source.html#l02265">ss_millitime()</a>, <a class="el" href="midas_8h_source.html#l01795">ST_REMOTE</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="midas_8h_source.html#l00740">TID_DWORD</a>, <a class="el" href="midas_8h_source.html#l00697">WATCHDOG_INTERVAL</a>, and <a class="el" href="msystem_8h_source.html#l00454">RPC_SERVER_ACCEPTION::watchdog_timeout</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l12166">rpc_server_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l12489"></a>12489          : <a class="code" href="group__msystemincludecode.html#gae04dcc2753aa274bcfe09835be8ddfb9">rpc_check_channels</a>
<a name="l12490"></a>12490 
<a name="l12491"></a>12491   Purpose: Check open rpc <a class="code" href="plot__max_8c.html#ad49ec371d0c77a469cc14aa6f44b232e">channels</a> <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> sending watchdog messages
<a name="l12492"></a>12492 
<a name="l12493"></a>12493   Input:
<a name="l12494"></a>12494     none
<a name="l12495"></a>12495 
<a name="l12496"></a>12496   Output:
<a name="l12497"></a>12497     none
<a name="l12498"></a>12498 
<a name="l12499"></a>12499   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l12500"></a>12500     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Channel is still alive
<a name="l12501"></a>12501     <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>           Connection is broken
<a name="l12502"></a>12502 
<a name="l12503"></a>12503 \********************************************************************/
<a name="l12504"></a>12504 {
<a name="l12505"></a>12505    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, convert_flags;
<a name="l12506"></a>12506    <a class="code" href="structNET__COMMAND.html">NET_COMMAND</a> nc;
<a name="l12507"></a>12507    fd_set readfds;
<a name="l12508"></a>12508    <span class="keyword">struct </span>timeval <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>;
<a name="l12509"></a>12509 
<a name="l12510"></a>12510    <span class="keywordflow">for</span> (index = 0; index &lt; <a class="code" href="group__msystemincludecode.html#gab1e8a2a4c5dc40faf6f7c25b51a4562f">MAX_RPC_CONNECTION</a>; index++) {
<a name="l12511"></a>12511       <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].recv_sock &amp;&amp;
<a name="l12512"></a>12512           <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].tid == <a class="code" href="group__msystemincludecode.html#ga47dde62638a1a4e9f49534bff449ebcd">ss_gettid</a>() &amp;&amp;
<a name="l12513"></a>12513           <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].watchdog_timeout &amp;&amp;
<a name="l12514"></a>12514           (<a class="code" href="group__msectionh.html#gaeb8fc912d50c2360588c50782b9c916d">ss_millitime</a>() - <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].last_activity &gt;
<a name="l12515"></a>12515            (<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>) <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].watchdog_timeout)) {
<a name="l12516"></a>12516 <span class="comment">/* printf(&quot;Send watchdog message to %s on %s\n&quot;,</span>
<a name="l12517"></a>12517 <span class="comment">                _server_acception[index].prog_name,</span>
<a name="l12518"></a>12518 <span class="comment">                _server_acception[index].host_name); */</span>
<a name="l12519"></a>12519 
<a name="l12520"></a>12520          <span class="comment">/* send a watchdog message */</span>
<a name="l12521"></a>12521          nc.<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#a9805c951be630cb91f6cf5e5fd8a34f4">routine_id</a> = <a class="code" href="group__msystemincludecode.html#gae7e5d847a353f5b7ff0fe45d47fd253d">MSG_WATCHDOG</a>;
<a name="l12522"></a>12522          nc.<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#ae0c91723d3f4843639e659ccde63dc5a">param_size</a> = 0;
<a name="l12523"></a>12523 
<a name="l12524"></a>12524          convert_flags = <a class="code" href="group__msystemincludecode.html#ga500895b6f1fb39626453b56a20ed52df">rpc_get_server_option</a>(<a class="code" href="group__mdefineh.html#gaddb075d303a5903df6a7dabdad02defd">RPC_CONVERT_FLAGS</a>);
<a name="l12525"></a>12525          <span class="keywordflow">if</span> (convert_flags) {
<a name="l12526"></a>12526             <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(&amp;nc.<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#a9805c951be630cb91f6cf5e5fd8a34f4">routine_id</a>, <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a>, <a class="code" href="group__msectionh.html#ga5cf5e72e7cdd75567b08ef7b3bd9e182">RPC_OUTGOING</a>,
<a name="l12527"></a>12527                                convert_flags);
<a name="l12528"></a>12528             <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(&amp;nc.<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#ae0c91723d3f4843639e659ccde63dc5a">param_size</a>, <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a>, <a class="code" href="group__msectionh.html#ga5cf5e72e7cdd75567b08ef7b3bd9e182">RPC_OUTGOING</a>,
<a name="l12529"></a>12529                                convert_flags);
<a name="l12530"></a>12530          }
<a name="l12531"></a>12531 
<a name="l12532"></a>12532          <span class="comment">/* send the header to the client */</span>
<a name="l12533"></a>12533          i = <a class="code" href="group__msystemincludecode.html#gae657f73f38c098645aab383053478d59">send_tcp</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].send_sock,
<a name="l12534"></a>12534                       (<span class="keywordtype">char</span> *) &amp;nc, <span class="keyword">sizeof</span>(<a class="code" href="structNET__COMMAND__HEADER.html">NET_COMMAND_HEADER</a>), 0);
<a name="l12535"></a>12535 
<a name="l12536"></a>12536          <span class="keywordflow">if</span> (i &lt; 0)
<a name="l12537"></a>12537             <span class="keywordflow">goto</span> exit;
<a name="l12538"></a>12538 
<a name="l12539"></a>12539          <span class="comment">/* make some timeout checking */</span>
<a name="l12540"></a>12540          FD_ZERO(&amp;readfds);
<a name="l12541"></a>12541          FD_SET(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].send_sock, &amp;readfds);
<a name="l12542"></a>12542          FD_SET(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].recv_sock, &amp;readfds);
<a name="l12543"></a>12543 
<a name="l12544"></a>12544          <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>.tv_sec = <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#ab63d3134ce8331c26bb08d1bf585b617">watchdog_timeout</a> / 1000;
<a name="l12545"></a>12545          <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>.tv_usec = (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#ab63d3134ce8331c26bb08d1bf585b617">watchdog_timeout</a> % 1000) * 1000;
<a name="l12546"></a>12546 
<a name="l12547"></a>12547          <span class="keywordflow">do</span> {
<a name="l12548"></a>12548             status = select(<a class="code" href="group__msystemincludecode.html#ga86c5dbf5a99358e288f573d6a1e0873f">FD_SETSIZE</a>, &amp;readfds, NULL, NULL, &amp;<a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>);
<a name="l12549"></a>12549 
<a name="l12550"></a>12550             <span class="comment">/* if an alarm signal was cought, restart select with reduced timeout */</span>
<a name="l12551"></a>12551             <span class="keywordflow">if</span> (status == -1 &amp;&amp; <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>.tv_sec &gt;= <a class="code" href="group__midasincludecode.html#ga92353a0b223e78081b022d5a33870967">WATCHDOG_INTERVAL</a> / 1000)
<a name="l12552"></a>12552                <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>.tv_sec -= <a class="code" href="group__midasincludecode.html#ga92353a0b223e78081b022d5a33870967">WATCHDOG_INTERVAL</a> / 1000;
<a name="l12553"></a>12553 
<a name="l12554"></a>12554          } <span class="keywordflow">while</span> (status == -1);        <span class="comment">/* dont return if an alarm signal was cought */</span>
<a name="l12555"></a>12555 
<a name="l12556"></a>12556          <span class="keywordflow">if</span> (!FD_ISSET(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].send_sock, &amp;readfds) &amp;&amp;
<a name="l12557"></a>12557              !FD_ISSET(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].recv_sock, &amp;readfds))
<a name="l12558"></a>12558             <span class="keywordflow">goto</span> exit;
<a name="l12559"></a>12559 
<a name="l12560"></a>12560          <span class="comment">/* receive result on send socket */</span>
<a name="l12561"></a>12561          <span class="keywordflow">if</span> (FD_ISSET(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].send_sock, &amp;readfds)) {
<a name="l12562"></a>12562             i = <a class="code" href="group__msystemincludecode.html#ga89d1ae530ad0e4bf448c77b57399f357">recv_tcp</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].send_sock, (<span class="keywordtype">char</span> *) &amp;nc, <span class="keyword">sizeof</span>(nc), 0);
<a name="l12563"></a>12563             <span class="keywordflow">if</span> (i &lt;= 0)
<a name="l12564"></a>12564                <span class="keywordflow">goto</span> exit;
<a name="l12565"></a>12565          }
<a name="l12566"></a>12566       }
<a name="l12567"></a>12567    }
<a name="l12568"></a>12568 
<a name="l12569"></a>12569    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l12570"></a>12570 
<a name="l12571"></a>12571  exit:
<a name="l12572"></a>12572 
<a name="l12573"></a>12573    <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#a6e27d8876a43afce3ee4dd16527cbb9e">MINFO</a>, <span class="stringliteral">&quot;rpc_check_channels&quot;</span>, <span class="stringliteral">&quot;client [%s]%s failed watchdog test after %d sec&quot;</span>,
<a name="l12574"></a>12574           <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>,
<a name="l12575"></a>12575           <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].prog_name,
<a name="l12576"></a>12576           <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].watchdog_timeout / 1000);
<a name="l12577"></a>12577 
<a name="l12578"></a>12578    <span class="comment">/* disconnect from experiment */</span>
<a name="l12579"></a>12579    <span class="keywordflow">if</span> (<a class="code" href="group__msystemincludecode.html#ga500895b6f1fb39626453b56a20ed52df">rpc_get_server_option</a>(<a class="code" href="group__mdefineh.html#ga7f6354019d48c7beeb8f5bd5c2fac8bb">RPC_OSERVER_TYPE</a>) != <a class="code" href="group__msectionh.html#ga9c6b34250ccc696d64a6a0a572947be5">ST_REMOTE</a>)
<a name="l12580"></a>12580       <a class="code" href="group__msectionh.html#ga9792ed24b1150464250ac794067c9196">cm_disconnect_experiment</a>();
<a name="l12581"></a>12581 
<a name="l12582"></a>12582    <span class="comment">/* close server connection */</span>
<a name="l12583"></a>12583    <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].recv_sock)
<a name="l12584"></a>12584       <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].recv_sock);
<a name="l12585"></a>12585    <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].send_sock)
<a name="l12586"></a>12586       <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].send_sock);
<a name="l12587"></a>12587    <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].event_sock)
<a name="l12588"></a>12588       <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].event_sock);
<a name="l12589"></a>12589 
<a name="l12590"></a>12590    <span class="comment">/* free TCP cache */</span>
<a name="l12591"></a>12591    <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>);
<a name="l12592"></a>12592    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a6400b37f1e31eb4bbaab7785f72497e4">net_buffer</a> = NULL;
<a name="l12593"></a>12593 
<a name="l12594"></a>12594    <span class="comment">/* mark this entry as invalid */</span>
<a name="l12595"></a>12595    memset(&amp;<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index], 0, <span class="keyword">sizeof</span>(<a class="code" href="structRPC__SERVER__ACCEPTION.html">RPC_SERVER_ACCEPTION</a>));
<a name="l12596"></a>12596 
<a name="l12597"></a>12597    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l12598"></a>12598 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaa3090052a0110f67c4a27d52799bd526"></a><!-- doxytag: member="midas.c::rpc_client_accept" ref="gaa3090052a0110f67c4a27d52799bd526" args="(int lsock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_client_accept </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>lsock</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l11860">11860</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="msystem_8h_source.html#l00651">CH_SERVER</a>, <a class="el" href="melog_8c_source.html#l00085">closesocket</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="msystem_8h_source.html#l00451">RPC_SERVER_ACCEPTION::event_sock</a>, <a class="el" href="midas_8h_source.html#l00682">HOST_NAME_LENGTH</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="msystem_8h_source.html#l00455">RPC_SERVER_ACCEPTION::last_activity</a>, <a class="el" href="msystem_8h_source.html#l00255">MAX_RPC_CONNECTION</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="rpc_8c_source.html#l00293">net_buffer</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="msystem_8h_source.html#l00450">RPC_SERVER_ACCEPTION::recv_sock</a>, <a class="el" href="system_8c_source.html#l03660">recv_string()</a>, <a class="el" href="msystem_8h_source.html#l00452">RPC_SERVER_ACCEPTION::remote_hw_type</a>, <a class="el" href="midas_8c_source.html#l07974">rpc_calc_convert_flags()</a>, <a class="el" href="midas_8h_source.html#l00774">RPC_CONVERT_FLAGS</a>, <a class="el" href="midas_8c_source.html#l09092">rpc_get_option()</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8h_source.html#l00771">RPC_OHW_TYPE</a>, <a class="el" href="midas_8c_source.html#l12223">rpc_server_receive()</a>, <a class="el" href="midas_8c_source.html#l09068">rpc_set_server_acception()</a>, <a class="el" href="midas_8c_source.html#l09308">rpc_set_server_option()</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="scs__310_8c_source.html#l00266">send()</a>, <a class="el" href="msystem_8h_source.html#l00449">RPC_SERVER_ACCEPTION::send_sock</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="system_8c_source.html#l01050">ss_gettid()</a>, <a class="el" href="system_8c_source.html#l02265">ss_millitime()</a>, <a class="el" href="system_8c_source.html#l03182">ss_suspend_set_dispatch()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="msystem_8h_source.html#l00446">RPC_SERVER_ACCEPTION::tid</a>, and <a class="el" href="msystem_8h_source.html#l00454">RPC_SERVER_ACCEPTION::watchdog_timeout</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l10866">rpc_register_server()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l11863"></a>11863          : <a class="code" href="group__msystemincludecode.html#ga631be6fb4a9b1560261255f19eb123c0">rpc_client_accept</a>
<a name="l11864"></a>11864 
<a name="l11865"></a>11865   Purpose: Accept <span class="keyword">new</span> incoming connections as a client
<a name="l11866"></a>11866 
<a name="l11867"></a>11867   Input:
<a name="l11868"></a>11868     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>    lsock            Listen socket
<a name="l11869"></a>11869 
<a name="l11870"></a>11870   Output:
<a name="l11871"></a>11871     none
<a name="l11872"></a>11872 
<a name="l11873"></a>11873   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l11874"></a>11874     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l11875"></a>11875     <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>           Error <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> socket <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a>
<a name="l11876"></a>11876     <a class="code" href="group__err25.html#ga50c5b6ef0ae99ed578f9209fdd961ac1">RPC_CONNCLOSED</a>          Connection was closed
<a name="l11877"></a>11877     <a class="code" href="group__err25.html#ga0406ee07e8c5afbf8e46cb0eed698bcd">RPC_SHUTDOWN</a>            Listener shutdown
<a name="l11878"></a>11878     <a class="code" href="group__err25.html#ga1a35d5e05d16d9040eaad41c4434a20a">RPC_EXCEED_BUFFER</a>       Not enough memory <span class="keywordflow">for</span> network <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l11879"></a>11879 
<a name="l11880"></a>11880 \********************************************************************/
<a name="l11881"></a>11881 {
<a name="l11882"></a>11882    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, version, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l11883"></a>11883    <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, sock;
<a name="l11884"></a>11884    <span class="keyword">struct </span>sockaddr_in acc_addr;
<a name="l11885"></a>11885    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> client_hw_type = 0, hw_type;
<a name="l11886"></a>11886    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[100], client_program[<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>];
<a name="l11887"></a>11887    <span class="keywordtype">char</span> <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>[<a class="code" href="group__midasincludecode.html#ga2010c9ed4ef21c3171de778157b9c494">HOST_NAME_LENGTH</a>];
<a name="l11888"></a>11888    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> convert_flags;
<a name="l11889"></a>11889    <span class="keywordtype">char</span> <a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>[256], *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>;
<a name="l11890"></a>11890 
<a name="l11891"></a>11891    size = <span class="keyword">sizeof</span>(acc_addr);
<a name="l11892"></a>11892    sock = accept(lsock, (<span class="keyword">struct</span> sockaddr *) &amp;acc_addr, (<span class="keywordtype">int</span> *) &amp;size);
<a name="l11893"></a>11893 
<a name="l11894"></a>11894    <span class="keywordflow">if</span> (sock == -1)
<a name="l11895"></a>11895       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l11896"></a>11896 
<a name="l11897"></a>11897    <span class="comment">/* get the name of the calling host */</span>
<a name="l11898"></a>11898 <span class="comment">/* outcommented for speed reasons SR 7.10.98</span>
<a name="l11899"></a>11899 <span class="comment">#ifdef OS_VXWORKS</span>
<a name="l11900"></a>11900 <span class="comment">  {</span>
<a name="l11901"></a>11901 <span class="comment">  status = hostGetByAddr(acc_addr.sin_addr.s_addr, host_name);</span>
<a name="l11902"></a>11902 <span class="comment">  if (status != 0)</span>
<a name="l11903"></a>11903 <span class="comment">    strcpy(host_name, &quot;unknown&quot;);</span>
<a name="l11904"></a>11904 <span class="comment">  }</span>
<a name="l11905"></a>11905 <span class="comment">#else</span>
<a name="l11906"></a>11906 <span class="comment">  phe = gethostbyaddr((char *) &amp;acc_addr.sin_addr, 4, PF_INET);</span>
<a name="l11907"></a>11907 <span class="comment">  if (phe == NULL)</span>
<a name="l11908"></a>11908 <span class="comment">    strcpy(host_name, &quot;unknown&quot;);</span>
<a name="l11909"></a>11909 <span class="comment">  strcpy(host_name, phe-&gt;h_name);</span>
<a name="l11910"></a>11910 <span class="comment">#endif</span>
<a name="l11911"></a>11911 <span class="comment">*/</span>
<a name="l11912"></a>11912    strcpy(host_name, <span class="stringliteral">&quot;&quot;</span>);
<a name="l11913"></a>11913 
<a name="l11914"></a>11914    <span class="comment">/* look for next free entry */</span>
<a name="l11915"></a>11915    <span class="keywordflow">for</span> (index = 0; index &lt; <a class="code" href="group__msystemincludecode.html#gab1e8a2a4c5dc40faf6f7c25b51a4562f">MAX_RPC_CONNECTION</a>; index++)
<a name="l11916"></a>11916       <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].recv_sock == 0)
<a name="l11917"></a>11917          <span class="keywordflow">break</span>;
<a name="l11918"></a>11918    <span class="keywordflow">if</span> (index == MAX_RPC_CONNECTION) {
<a name="l11919"></a>11919       <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(sock);
<a name="l11920"></a>11920       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l11921"></a>11921    }
<a name="l11922"></a>11922 
<a name="l11923"></a>11923    <span class="comment">/* receive string with timeout */</span>
<a name="l11924"></a>11924    i = <a class="code" href="group__msystemincludecode.html#gaf9411818011b3b2bbc02a1db8340c77a">recv_string</a>(sock, net_buffer, <span class="keyword">sizeof</span>(net_buffer), 10000);
<a name="l11925"></a>11925    <span class="keywordflow">if</span> (i &lt;= 0) {
<a name="l11926"></a>11926       <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(sock);
<a name="l11927"></a>11927       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l11928"></a>11928    }
<a name="l11929"></a>11929 
<a name="l11930"></a>11930    <span class="comment">/* get remote computer info */</span>
<a name="l11931"></a>11931    p = strtok(net_buffer, <span class="stringliteral">&quot; &quot;</span>);
<a name="l11932"></a>11932    <span class="keywordflow">if</span> (p != NULL) {
<a name="l11933"></a>11933       client_hw_type = atoi(p);
<a name="l11934"></a>11934       p = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);
<a name="l11935"></a>11935    }
<a name="l11936"></a>11936    <span class="keywordflow">if</span> (p != NULL) {
<a name="l11937"></a>11937       version = atoi(p);
<a name="l11938"></a>11938       p = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);
<a name="l11939"></a>11939    }
<a name="l11940"></a>11940    <span class="keywordflow">if</span> (p != NULL) {
<a name="l11941"></a>11941       strcpy(client_program, p);
<a name="l11942"></a>11942       p = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);
<a name="l11943"></a>11943    }
<a name="l11944"></a>11944    <span class="keywordflow">if</span> (p != NULL) {
<a name="l11945"></a>11945       strcpy(host_name, p);
<a name="l11946"></a>11946       p = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);
<a name="l11947"></a>11947    }
<a name="l11948"></a>11948 
<a name="l11949"></a>11949    <span class="comment">/* save information in _server_acception structure */</span>
<a name="l11950"></a>11950    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a160df84318ca2158f9302af6fe95330e">recv_sock</a> = sock;
<a name="l11951"></a>11951    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a24df135a5376a4d0ec7acfc7bfd63bca">send_sock</a> = 0;
<a name="l11952"></a>11952    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#ac770d0f286e0392201250d6d8c2f76eb">event_sock</a> = 0;
<a name="l11953"></a>11953    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#ae663c27f2ba3f7d61eab16c819ba96c1">remote_hw_type</a> = client_hw_type;
<a name="l11954"></a>11954    strcpy(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].host_name, host_name);
<a name="l11955"></a>11955    strcpy(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].prog_name, client_program);
<a name="l11956"></a>11956    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#afce37f951099d5507a369c860cbcb36e">tid</a> = <a class="code" href="group__msystemincludecode.html#ga47dde62638a1a4e9f49534bff449ebcd">ss_gettid</a>();
<a name="l11957"></a>11957    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#aceb0db33c6b8db04ec595cdb174bd6d2">last_activity</a> = <a class="code" href="group__msectionh.html#gaeb8fc912d50c2360588c50782b9c916d">ss_millitime</a>();
<a name="l11958"></a>11958    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#ab63d3134ce8331c26bb08d1bf585b617">watchdog_timeout</a> = 0;
<a name="l11959"></a>11959 
<a name="l11960"></a>11960    <span class="comment">/* send my own computer id */</span>
<a name="l11961"></a>11961    hw_type = <a class="code" href="group__msectionh.html#gae3bca206872bae947c6e20c1aedfe4f5">rpc_get_option</a>(0, <a class="code" href="group__mdefineh.html#gaf716b122f115aca08e68391343145cb3">RPC_OHW_TYPE</a>);
<a name="l11962"></a>11962    sprintf(str, <span class="stringliteral">&quot;%d %s&quot;</span>, hw_type, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l11963"></a>11963    status = <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(sock, str, strlen(str) + 1, 0);
<a name="l11964"></a>11964    <span class="keywordflow">if</span> (status != (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) strlen(str) + 1)
<a name="l11965"></a>11965       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l11966"></a>11966 
<a name="l11967"></a>11967    <a class="code" href="group__msystemincludecode.html#ga6990e0eb5b97aeb6667ddd03d69b4065">rpc_set_server_acception</a>(index + 1);
<a name="l11968"></a>11968    <a class="code" href="group__rpcfunctionc.html#ga34b52a482a19eb8abcf8d84d888acbe0">rpc_calc_convert_flags</a>(hw_type, client_hw_type, &amp;convert_flags);
<a name="l11969"></a>11969    <a class="code" href="group__msystemincludecode.html#gaec24042a470eec42ec344d7fc552d4f5">rpc_set_server_option</a>(<a class="code" href="group__mdefineh.html#gaddb075d303a5903df6a7dabdad02defd">RPC_CONVERT_FLAGS</a>, convert_flags);
<a name="l11970"></a>11970 
<a name="l11971"></a>11971    <span class="comment">/* set callback function for ss_suspend */</span>
<a name="l11972"></a>11972    <a class="code" href="group__msystemincludecode.html#gac1b39a6f689a24e9aaf239ee73a81b15">ss_suspend_set_dispatch</a>(<a class="code" href="group__msystemincludecode.html#gad8b8b52bc186079c0cb5689eead00a03">CH_SERVER</a>, <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>,
<a name="l11973"></a>11973                            (<span class="keywordtype">int</span> (*)(<span class="keywordtype">void</span>)) <a class="code" href="group__msystemincludecode.html#ga8bad7cd9b75d3a9879745bbd61742ded">rpc_server_receive</a>);
<a name="l11974"></a>11974 
<a name="l11975"></a>11975    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l11976"></a>11976 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga9869532482d88b0205bed74119862400"></a><!-- doxytag: member="midas.c::rpc_client_call" ref="ga9869532482d88b0205bed74119862400" args="(HNDLE hConn, const INT routine_id,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_client_call </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a>&nbsp;</td>
          <td class="paramname"> <em>hConn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>routine_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l09519">9519</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l00824">_net_send_buffer</a>, <a class="el" href="midas_8c_source.html#l00825">_net_send_buffer_size</a>, <a class="el" href="midas_8h_source.html#l00904">ALIGN8</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="msystem_8h_source.html#l00198">DRI_BIG_ENDIAN</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="msystem_8h_source.html#l00336">FD_SETSIZE</a>, <a class="el" href="midas_8h_source.html#l01801">RPC_PARAM::flags</a>, <a class="el" href="msystem_8h_source.html#l00386">NET_COMMAND::header</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="midas_8h_source.html#l01753">M_MALLOC</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l01802">RPC_PARAM::n</a>, <a class="el" href="examples_2macro_2midas__macro_8h_source.html#l00039">name</a>, <a class="el" href="msystem_8h_source.html#l00257">NET_BUFFER_SIZE</a>, <a class="el" href="mana_8cpp_source.html#l00657">param</a>, <a class="el" href="midas_8h_source.html#l01808">RPC_LIST::param</a>, <a class="el" href="msystem_8h_source.html#l00387">NET_COMMAND::param</a>, <a class="el" href="msystem_8h_source.html#l00382">NET_COMMAND_HEADER::param_size</a>, <a class="el" href="midas_8h_source.html#l00615">PTYPE</a>, <a class="el" href="system_8c_source.html#l03731">recv_tcp()</a>, <a class="el" href="msystem_8h_source.html#l00381">NET_COMMAND_HEADER::routine_id</a>, <a class="el" href="midas_8c_source.html#l08923">rpc_client_disconnect()</a>, <a class="el" href="midas_8h_source.html#l01071">RPC_EXCEED_BUFFER</a>, <a class="el" href="midas_8h_source.html#l01784">RPC_FIXARRAY</a>, <a class="el" href="midas_8h_source.html#l00782">RPC_FTCP</a>, <a class="el" href="midas_8c_source.html#l09092">rpc_get_option()</a>, <a class="el" href="midas_8h_source.html#l01781">RPC_IN</a>, <a class="el" href="midas_8h_source.html#l01074">RPC_INVALID_ID</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8h_source.html#l01068">RPC_NO_CONNECTION</a>, <a class="el" href="midas_8h_source.html#l00771">RPC_OHW_TYPE</a>, <a class="el" href="midas_8h_source.html#l01782">RPC_OUT</a>, <a class="el" href="midas_8h_source.html#l01783">RPC_POINTER</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l01070">RPC_TIMEOUT</a>, <a class="el" href="msystem_8h_source.html#l00428">RPC_CLIENT_CONNECTION::rpc_timeout</a>, <a class="el" href="midas_8c_source.html#l09479">rpc_va_arg()</a>, <a class="el" href="midas_8h_source.html#l01785">RPC_VARARRAY</a>, <a class="el" href="msystem_8h_source.html#l00424">RPC_CLIENT_CONNECTION::send_sock</a>, <a class="el" href="system_8c_source.html#l03606">send_tcp()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="msystem_8h_source.html#l00397">TCP_FAST</a>, <a class="el" href="midas_8h_source.html#l01800">RPC_PARAM::tid</a>, <a class="el" href="midas_8h_source.html#l00747">TID_ARRAY</a>, <a class="el" href="midas_8h_source.html#l00735">TID_BYTE</a>, <a class="el" href="midas_8h_source.html#l00737">TID_CHAR</a>, <a class="el" href="midas_8h_source.html#l00744">TID_DOUBLE</a>, <a class="el" href="midas_8h_source.html#l00743">TID_FLOAT</a>, <a class="el" href="midas_8h_source.html#l00750">TID_LINK</a>, <a class="el" href="midas_8h_source.html#l00736">TID_SBYTE</a>, <a class="el" href="midas_8h_source.html#l00739">TID_SHORT</a>, <a class="el" href="midas_8c_source.html#l00749">tid_size</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, <a class="el" href="midas_8h_source.html#l00748">TID_STRUCT</a>, <a class="el" href="midas_8h_source.html#l00738">TID_WORD</a>, <a class="el" href="msystem_8h_source.html#l00427">RPC_CLIENT_CONNECTION::transport</a>, and <a class="el" href="midas_8h_source.html#l00697">WATCHDOG_INTERVAL</a>.</p>

<p>Referenced by <a class="el" href="camacrpc_8c_source.html#l00200">cam16i_q()</a>, <a class="el" href="camacrpc_8c_source.html#l00226">cam16i_r()</a>, <a class="el" href="camacrpc_8c_source.html#l00258">cam16i_rq()</a>, <a class="el" href="camacrpc_8c_source.html#l00287">cam16i_sa()</a>, <a class="el" href="camacrpc_8c_source.html#l00324">cam16i_sn()</a>, <a class="el" href="camacrpc_8c_source.html#l00392">cam16o_q()</a>, <a class="el" href="camacrpc_8c_source.html#l00416">cam16o_r()</a>, <a class="el" href="camacrpc_8c_source.html#l00188">cam24i()</a>, <a class="el" href="camacrpc_8c_source.html#l00213">cam24i_q()</a>, <a class="el" href="camacrpc_8c_source.html#l00242">cam24i_r()</a>, <a class="el" href="camacrpc_8c_source.html#l00272">cam24i_rq()</a>, <a class="el" href="camacrpc_8c_source.html#l00305">cam24i_sa()</a>, <a class="el" href="camacrpc_8c_source.html#l00342">cam24i_sn()</a>, <a class="el" href="camacrpc_8c_source.html#l00380">cam24o()</a>, <a class="el" href="camacrpc_8c_source.html#l00404">cam24o_q()</a>, <a class="el" href="camacrpc_8c_source.html#l00428">cam24o_r()</a>, <a class="el" href="camacrpc_8c_source.html#l00541">cam_crate_clear()</a>, <a class="el" href="camacrpc_8c_source.html#l00555">cam_crate_zinit()</a>, <a class="el" href="camacrpc_8c_source.html#l00527">cam_inhibit_clear()</a>, <a class="el" href="camacrpc_8c_source.html#l00513">cam_inhibit_set()</a>, <a class="el" href="camacrpc_8c_source.html#l00073">cam_init_rpc()</a>, <a class="el" href="camacrpc_8c_source.html#l00445">camc()</a>, <a class="el" href="camacrpc_8c_source.html#l00459">camc_q()</a>, <a class="el" href="camacrpc_8c_source.html#l00169">cami()</a>, <a class="el" href="camacrpc_8c_source.html#l00361">camo()</a>, <a class="el" href="midas_8c_source.html#l03579">cm_transition()</a>, <a class="el" href="odbedit_8c_source.html#l01415">command_loop()</a>, <a class="el" href="mhttpd_8c_source.html#l09142">interprete()</a>, <a class="el" href="rpc__clnt_8c_source.html#l00070">main()</a>, <a class="el" href="midas_8c_source.html#l08923">rpc_client_disconnect()</a>, <a class="el" href="crate3_2rpc__master_8cpp_source.html#l00207">rpc_master_read()</a>, <a class="el" href="crate3_2rpc__slave_8cpp_source.html#l00178">rpc_slave_stop_block()</a>, <a class="el" href="crate3_2rpc__slave_8cpp_source.html#l00214">send_ready_for_cycle()</a>, and <a class="el" href="mhttpd_8c_source.html#l05301">show_cnaf_page()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09522"></a>09522          : <a class="code" href="group__msectionh.html#ga6ade8c4e3d08c41fbeb3a98fe2808778">rpc_client_call</a>
<a name="l09523"></a>09523 
<a name="l09524"></a>09524   Purpose: Call a function on a MIDAS client
<a name="l09525"></a>09525 
<a name="l09526"></a>09526   Input:
<a name="l09527"></a>09527     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>  <a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a>              Client connection
<a name="l09528"></a>09528     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>  routine_id         routine <a class="code" href="jorway73a_8h.html#a4bfe115debc7f472dd7dfe4ef9679ca0">ID</a> as defined <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> RPC.H (RPC_xxx)
<a name="l09529"></a>09529 
<a name="l09530"></a>09530     ...                     <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a> argument <a class="code" href="namespacemodules.html#a12afb64f27b8a4e356d665de83e78ad3">list</a>
<a name="l09531"></a>09531 
<a name="l09532"></a>09532   Output:
<a name="l09533"></a>09533     (depends on argument <a class="code" href="namespacemodules.html#a12afb64f27b8a4e356d665de83e78ad3">list</a>)
<a name="l09534"></a>09534 
<a name="l09535"></a>09535   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l09536"></a>09536     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l09537"></a>09537     <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>           Error <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> socket <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a>
<a name="l09538"></a>09538     <a class="code" href="group__err25.html#gad3a9f2a6b26ce5b987f6b2088fbb627c">RPC_NO_CONNECTION</a>       No active connection
<a name="l09539"></a>09539     <a class="code" href="group__err25.html#gad29d62bce98ff8494be9337cb1a0a1f1">RPC_TIMEOUT</a>             Timeout <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> RPC <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a>
<a name="l09540"></a>09540     <a class="code" href="group__err25.html#ga3cbff68ac5b5d52f692b8e880f9ef76c">RPC_INVALID_ID</a>          Invalid routine_id (not <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>)
<a name="l09541"></a>09541     <a class="code" href="group__err25.html#ga1a35d5e05d16d9040eaad41c4434a20a">RPC_EXCEED_BUFFER</a>       Paramters don<span class="stringliteral">&apos;t fit in network buffer</span>
<a name="l09542"></a>09542 <span class="stringliteral"></span>
<a name="l09543"></a>09543 <span class="stringliteral">\********************************************************************/</span>
<a name="l09544"></a>09544 <span class="stringliteral">{</span>
<a name="l09545"></a>09545 <span class="stringliteral">   va_list ap, aptmp;</span>
<a name="l09546"></a>09546 <span class="stringliteral">   char arg[8], arg_tmp[8];</span>
<a name="l09547"></a>09547 <span class="stringliteral">   INT arg_type, transport, rpc_timeout;</span>
<a name="l09548"></a>09548 <span class="stringliteral">   INT i, index, status, rpc_index;</span>
<a name="l09549"></a>09549 <span class="stringliteral">   INT param_size, arg_size, send_size;</span>
<a name="l09550"></a>09550 <span class="stringliteral">   INT tid, flags;</span>
<a name="l09551"></a>09551 <span class="stringliteral">   fd_set readfds;</span>
<a name="l09552"></a>09552 <span class="stringliteral">   struct timeval timeout;</span>
<a name="l09553"></a>09553 <span class="stringliteral">   char *param_ptr, str[80];</span>
<a name="l09554"></a>09554 <span class="stringliteral">   BOOL bpointer, bbig;</span>
<a name="l09555"></a>09555 <span class="stringliteral">   NET_COMMAND *nc;</span>
<a name="l09556"></a>09556 <span class="stringliteral">   int send_sock;</span>
<a name="l09557"></a>09557 <span class="stringliteral"></span>
<a name="l09558"></a>09558 <span class="stringliteral">   index = hConn - 1;</span>
<a name="l09559"></a>09559 <span class="stringliteral"></span>
<a name="l09560"></a>09560 <span class="stringliteral">   if (_client_connection[index].send_sock == 0) {</span>
<a name="l09561"></a>09561 <span class="stringliteral">      cm_msg(MERROR, &quot;rpc_client_call&quot;, &quot;no rpc connection&quot;);</span>
<a name="l09562"></a>09562 <span class="stringliteral">      return RPC_NO_CONNECTION;</span>
<a name="l09563"></a>09563 <span class="stringliteral">   }</span>
<a name="l09564"></a>09564 <span class="stringliteral"></span>
<a name="l09565"></a>09565 <span class="stringliteral">   send_sock = _client_connection[index].send_sock;</span>
<a name="l09566"></a>09566 <span class="stringliteral">   rpc_timeout = _client_connection[index].rpc_timeout;</span>
<a name="l09567"></a>09567 <span class="stringliteral">   transport = _client_connection[index].transport;</span>
<a name="l09568"></a>09568 <span class="stringliteral"></span>
<a name="l09569"></a>09569 <span class="stringliteral">   /* init network buffer */</span>
<a name="l09570"></a>09570 <span class="stringliteral">   if (_net_send_buffer_size == 0) {</span>
<a name="l09571"></a>09571 <span class="stringliteral">      _net_send_buffer = (char *) M_MALLOC(NET_BUFFER_SIZE);</span>
<a name="l09572"></a>09572 <span class="stringliteral">      if (_net_send_buffer == NULL) {</span>
<a name="l09573"></a>09573 <span class="stringliteral">         cm_msg(MERROR, &quot;rpc_client_call&quot;,</span>
<a name="l09574"></a>09574 <span class="stringliteral">                &quot;not enough memory to allocate network buffer&quot;);</span>
<a name="l09575"></a>09575 <span class="stringliteral">         return RPC_EXCEED_BUFFER;</span>
<a name="l09576"></a>09576 <span class="stringliteral">      }</span>
<a name="l09577"></a>09577 <span class="stringliteral">      _net_send_buffer_size = NET_BUFFER_SIZE;</span>
<a name="l09578"></a>09578 <span class="stringliteral">   }</span>
<a name="l09579"></a>09579 <span class="stringliteral"></span>
<a name="l09580"></a>09580 <span class="stringliteral">   nc = (NET_COMMAND *) _net_send_buffer;</span>
<a name="l09581"></a>09581 <span class="stringliteral">   nc-&gt;header.routine_id = routine_id;</span>
<a name="l09582"></a>09582 <span class="stringliteral"></span>
<a name="l09583"></a>09583 <span class="stringliteral">   if (transport == RPC_FTCP)</span>
<a name="l09584"></a>09584 <span class="stringliteral">      nc-&gt;header.routine_id |= TCP_FAST;</span>
<a name="l09585"></a>09585 <span class="stringliteral"></span>
<a name="l09586"></a>09586 <span class="stringliteral">   for (i = 0;; i++)</span>
<a name="l09587"></a>09587 <span class="stringliteral">      if (rpc_list[i].id == routine_id || rpc_list[i].id == 0)</span>
<a name="l09588"></a>09588 <span class="stringliteral">         break;</span>
<a name="l09589"></a>09589 <span class="stringliteral">   rpc_index = i;</span>
<a name="l09590"></a>09590 <span class="stringliteral">   if (rpc_list[i].id == 0) {</span>
<a name="l09591"></a>09591 <span class="stringliteral">      sprintf(str, &quot;invalid rpc ID (%d)&quot;, routine_id);</span>
<a name="l09592"></a>09592 <span class="stringliteral">      cm_msg(MERROR, &quot;rpc_client_call&quot;, str);</span>
<a name="l09593"></a>09593 <span class="stringliteral">      return RPC_INVALID_ID;</span>
<a name="l09594"></a>09594 <span class="stringliteral">   }</span>
<a name="l09595"></a>09595 <span class="stringliteral"></span>
<a name="l09596"></a>09596 <span class="stringliteral">   /* examine variable argument list and convert it to parameter array */</span>
<a name="l09597"></a>09597 <span class="stringliteral">   va_start(ap, routine_id);</span>
<a name="l09598"></a>09598 <span class="stringliteral"></span>
<a name="l09599"></a>09599 <span class="stringliteral">   /* find out if we are on a big endian system */</span>
<a name="l09600"></a>09600 <span class="stringliteral">   bbig = ((rpc_get_option(0, RPC_OHW_TYPE) &amp; DRI_BIG_ENDIAN) &gt; 0);</span>
<a name="l09601"></a>09601 <span class="stringliteral"></span>
<a name="l09602"></a>09602 <span class="stringliteral">   for (i = 0, param_ptr = nc-&gt;param; rpc_list[rpc_index].param[i].tid != 0; i++) {</span>
<a name="l09603"></a>09603 <span class="stringliteral">      tid = rpc_list[rpc_index].param[i].tid;</span>
<a name="l09604"></a>09604 <span class="stringliteral">      flags = rpc_list[rpc_index].param[i].flags;</span>
<a name="l09605"></a>09605 <span class="stringliteral"></span>
<a name="l09606"></a>09606 <span class="stringliteral">      bpointer = (flags &amp; RPC_POINTER) || (flags &amp; RPC_OUT) ||</span>
<a name="l09607"></a>09607 <span class="stringliteral">          (flags &amp; RPC_FIXARRAY) || (flags &amp; RPC_VARARRAY) ||</span>
<a name="l09608"></a>09608 <span class="stringliteral">          tid == TID_STRING || tid == TID_ARRAY || tid == TID_STRUCT || tid == TID_LINK;</span>
<a name="l09609"></a>09609 <span class="stringliteral"></span>
<a name="l09610"></a>09610 <span class="stringliteral">      if (bpointer)</span>
<a name="l09611"></a>09611 <span class="stringliteral">         arg_type = TID_ARRAY;</span>
<a name="l09612"></a>09612 <span class="stringliteral">      else</span>
<a name="l09613"></a>09613 <span class="stringliteral">         arg_type = tid;</span>
<a name="l09614"></a>09614 <span class="stringliteral"></span>
<a name="l09615"></a>09615 <span class="stringliteral">      /* floats are passed as doubles, at least under NT */</span>
<a name="l09616"></a>09616 <span class="stringliteral">      if (tid == TID_FLOAT &amp;&amp; !bpointer)</span>
<a name="l09617"></a>09617 <span class="stringliteral">         arg_type = TID_DOUBLE;</span>
<a name="l09618"></a>09618 <span class="stringliteral"></span>
<a name="l09619"></a>09619 <span class="stringliteral">      /* get pointer to argument */</span>
<a name="l09620"></a>09620 <span class="stringliteral">      rpc_va_arg(&amp;ap, arg_type, arg);</span>
<a name="l09621"></a>09621 <span class="stringliteral"></span>
<a name="l09622"></a>09622 <span class="stringliteral">      /* shift 1- and 2-byte parameters to the LSB on big endian systems */</span>
<a name="l09623"></a>09623 <span class="stringliteral">      if (bbig) {</span>
<a name="l09624"></a>09624 <span class="stringliteral">         if (tid == TID_BYTE || tid == TID_CHAR || tid == TID_SBYTE) {</span>
<a name="l09625"></a>09625 <span class="stringliteral">            arg[0] = arg[3];</span>
<a name="l09626"></a>09626 <span class="stringliteral">         }</span>
<a name="l09627"></a>09627 <span class="stringliteral">         if (tid == TID_WORD || tid == TID_SHORT) {</span>
<a name="l09628"></a>09628 <span class="stringliteral">            arg[0] = arg[2];</span>
<a name="l09629"></a>09629 <span class="stringliteral">            arg[1] = arg[3];</span>
<a name="l09630"></a>09630 <span class="stringliteral">         }</span>
<a name="l09631"></a>09631 <span class="stringliteral">      }</span>
<a name="l09632"></a>09632 <span class="stringliteral"></span>
<a name="l09633"></a>09633 <span class="stringliteral">      if (flags &amp; RPC_IN) {</span>
<a name="l09634"></a>09634 <span class="stringliteral">         if (bpointer)</span>
<a name="l09635"></a>09635 <span class="stringliteral">            arg_size = tid_size[tid];</span>
<a name="l09636"></a>09636 <span class="stringliteral">         else</span>
<a name="l09637"></a>09637 <span class="stringliteral">            arg_size = tid_size[arg_type];</span>
<a name="l09638"></a>09638 <span class="stringliteral"></span>
<a name="l09639"></a>09639 <span class="stringliteral">         /* for strings, the argument size depends on the string length */</span>
<a name="l09640"></a>09640 <span class="stringliteral">         if (tid == TID_STRING || tid == TID_LINK)</span>
<a name="l09641"></a>09641 <span class="stringliteral">            arg_size = 1 + strlen((char *) *((char **) arg));</span>
<a name="l09642"></a>09642 <span class="stringliteral"></span>
<a name="l09643"></a>09643 <span class="stringliteral">         /* for varibale length arrays, the size is given by</span>
<a name="l09644"></a>09644 <span class="stringliteral">            the next parameter on the stack */</span>
<a name="l09645"></a>09645 <span class="stringliteral">         if (flags &amp; RPC_VARARRAY) {</span>
<a name="l09646"></a>09646 <span class="stringliteral">            memcpy(&amp;aptmp, &amp;ap, sizeof(ap));</span>
<a name="l09647"></a>09647 <span class="stringliteral">            rpc_va_arg(&amp;aptmp, TID_ARRAY, arg_tmp);</span>
<a name="l09648"></a>09648 <span class="stringliteral"></span>
<a name="l09649"></a>09649 <span class="stringliteral">            if (flags &amp; RPC_OUT)</span>
<a name="l09650"></a>09650 <span class="stringliteral">               arg_size = *((INT *) * ((void **) arg_tmp));</span>
<a name="l09651"></a>09651 <span class="stringliteral">            else</span>
<a name="l09652"></a>09652 <span class="stringliteral">               arg_size = *((INT *) arg_tmp);</span>
<a name="l09653"></a>09653 <span class="stringliteral"></span>
<a name="l09654"></a>09654 <span class="stringliteral">            *((INT *) param_ptr) = ALIGN8(arg_size);</span>
<a name="l09655"></a>09655 <span class="stringliteral">            param_ptr += ALIGN8(sizeof(INT));</span>
<a name="l09656"></a>09656 <span class="stringliteral">         }</span>
<a name="l09657"></a>09657 <span class="stringliteral"></span>
<a name="l09658"></a>09658 <span class="stringliteral">         if (tid == TID_STRUCT || (flags &amp; RPC_FIXARRAY))</span>
<a name="l09659"></a>09659 <span class="stringliteral">            arg_size = rpc_list[rpc_index].param[i].n;</span>
<a name="l09660"></a>09660 <span class="stringliteral"></span>
<a name="l09661"></a>09661 <span class="stringliteral">         /* always align parameter size */</span>
<a name="l09662"></a>09662 <span class="stringliteral">         param_size = ALIGN8(arg_size);</span>
<a name="l09663"></a>09663 <span class="stringliteral"></span>
<a name="l09664"></a>09664 <span class="stringliteral">         if ((PTYPE) param_ptr - (PTYPE) nc + param_size &gt; NET_BUFFER_SIZE) {</span>
<a name="l09665"></a>09665 <span class="stringliteral">            cm_msg(MERROR, &quot;rpc_client_call&quot;,</span>
<a name="l09666"></a>09666 <span class="stringliteral">                   &quot;parameters (%d) too large for network buffer (%d)&quot;,</span>
<a name="l09667"></a>09667 <span class="stringliteral">                   (PTYPE) param_ptr - (PTYPE) nc + param_size, NET_BUFFER_SIZE);</span>
<a name="l09668"></a>09668 <span class="stringliteral">            return RPC_EXCEED_BUFFER;</span>
<a name="l09669"></a>09669 <span class="stringliteral">         }</span>
<a name="l09670"></a>09670 <span class="stringliteral"></span>
<a name="l09671"></a>09671 <span class="stringliteral">         if (bpointer)</span>
<a name="l09672"></a>09672 <span class="stringliteral">            memcpy(param_ptr, (void *) *((void **) arg), arg_size);</span>
<a name="l09673"></a>09673 <span class="stringliteral">         else {</span>
<a name="l09674"></a>09674 <span class="stringliteral">            /* floats are passed as doubles on most systems */</span>
<a name="l09675"></a>09675 <span class="stringliteral">            if (tid != TID_FLOAT)</span>
<a name="l09676"></a>09676 <span class="stringliteral">               memcpy(param_ptr, arg, arg_size);</span>
<a name="l09677"></a>09677 <span class="stringliteral">            else</span>
<a name="l09678"></a>09678 <span class="stringliteral">               *((float *) param_ptr) = (float) *((double *) arg);</span>
<a name="l09679"></a>09679 <span class="stringliteral">         }</span>
<a name="l09680"></a>09680 <span class="stringliteral"></span>
<a name="l09681"></a>09681 <span class="stringliteral">         param_ptr += param_size;</span>
<a name="l09682"></a>09682 <span class="stringliteral"></span>
<a name="l09683"></a>09683 <span class="stringliteral">      }</span>
<a name="l09684"></a>09684 <span class="stringliteral">   }</span>
<a name="l09685"></a>09685 <span class="stringliteral"></span>
<a name="l09686"></a>09686 <span class="stringliteral">   va_end(ap);</span>
<a name="l09687"></a>09687 <span class="stringliteral"></span>
<a name="l09688"></a>09688 <span class="stringliteral">   nc-&gt;header.param_size = (PTYPE) param_ptr - (PTYPE) nc-&gt;param;</span>
<a name="l09689"></a>09689 <span class="stringliteral"></span>
<a name="l09690"></a>09690 <span class="stringliteral">   send_size = nc-&gt;header.param_size + sizeof(NET_COMMAND_HEADER);</span>
<a name="l09691"></a>09691 <span class="stringliteral"></span>
<a name="l09692"></a>09692 <span class="stringliteral">   /* in FAST TCP mode, only send call and return immediately */</span>
<a name="l09693"></a>09693 <span class="stringliteral">   if (transport == RPC_FTCP) {</span>
<a name="l09694"></a>09694 <span class="stringliteral">      i = send_tcp(send_sock, (char *) nc, send_size, 0);</span>
<a name="l09695"></a>09695 <span class="stringliteral"></span>
<a name="l09696"></a>09696 <span class="stringliteral">      if (i != send_size) {</span>
<a name="l09697"></a>09697 <span class="stringliteral">         cm_msg(MERROR, &quot;rpc_client_call&quot;, &quot;send_tcp() failed&quot;);</span>
<a name="l09698"></a>09698 <span class="stringliteral">         return RPC_NET_ERROR;</span>
<a name="l09699"></a>09699 <span class="stringliteral">      }</span>
<a name="l09700"></a>09700 <span class="stringliteral"></span>
<a name="l09701"></a>09701 <span class="stringliteral">      return RPC_SUCCESS;</span>
<a name="l09702"></a>09702 <span class="stringliteral">   }</span>
<a name="l09703"></a>09703 <span class="stringliteral"></span>
<a name="l09704"></a>09704 <span class="stringliteral">   /* in TCP mode, send and wait for reply on send socket */</span>
<a name="l09705"></a>09705 <span class="stringliteral">   i = send_tcp(send_sock, (char *) nc, send_size, 0);</span>
<a name="l09706"></a>09706 <span class="stringliteral">   if (i != send_size) {</span>
<a name="l09707"></a>09707 <span class="stringliteral">      cm_msg(MERROR, &quot;rpc_client_call&quot;,</span>
<a name="l09708"></a>09708 <span class="stringliteral">             &quot;send_tcp() failed, routine = \&quot;%s\&quot;, host = \&quot;%s\&quot;&quot;,</span>
<a name="l09709"></a>09709 <span class="stringliteral">             rpc_list[rpc_index].name, _client_connection[index].host_name);</span>
<a name="l09710"></a>09710 <span class="stringliteral">      return RPC_NET_ERROR;</span>
<a name="l09711"></a>09711 <span class="stringliteral">   }</span>
<a name="l09712"></a>09712 <span class="stringliteral"></span>
<a name="l09713"></a>09713 <span class="stringliteral">   /* make some timeout checking */</span>
<a name="l09714"></a>09714 <span class="stringliteral">   if (rpc_timeout &gt; 0) {</span>
<a name="l09715"></a>09715 <span class="stringliteral">      FD_ZERO(&amp;readfds);</span>
<a name="l09716"></a>09716 <span class="stringliteral">      FD_SET(send_sock, &amp;readfds);</span>
<a name="l09717"></a>09717 <span class="stringliteral"></span>
<a name="l09718"></a>09718 <span class="stringliteral">      timeout.tv_sec = rpc_timeout / 1000;</span>
<a name="l09719"></a>09719 <span class="stringliteral">      timeout.tv_usec = (rpc_timeout % 1000) * 1000;</span>
<a name="l09720"></a>09720 <span class="stringliteral"></span>
<a name="l09721"></a>09721 <span class="stringliteral">      do {</span>
<a name="l09722"></a>09722 <span class="stringliteral">         status = select(FD_SETSIZE, &amp;readfds, NULL, NULL, &amp;timeout);</span>
<a name="l09723"></a>09723 <span class="stringliteral"></span>
<a name="l09724"></a>09724 <span class="stringliteral">         /* if an alarm signal was cought, restart select with reduced timeout */</span>
<a name="l09725"></a>09725 <span class="stringliteral">         if (status == -1 &amp;&amp; timeout.tv_sec &gt;= WATCHDOG_INTERVAL / 1000)</span>
<a name="l09726"></a>09726 <span class="stringliteral">            timeout.tv_sec -= WATCHDOG_INTERVAL / 1000;</span>
<a name="l09727"></a>09727 <span class="stringliteral"></span>
<a name="l09728"></a>09728 <span class="stringliteral">      } while (status == -1);   /* dont return if an alarm signal was cought */</span>
<a name="l09729"></a>09729 <span class="stringliteral"></span>
<a name="l09730"></a>09730 <span class="stringliteral">      if (!FD_ISSET(send_sock, &amp;readfds)) {</span>
<a name="l09731"></a>09731 <span class="stringliteral">         cm_msg(MERROR, &quot;rpc_client_call&quot;, &quot;rpc timeout, routine = \&quot;%s\&quot;, host = \&quot;%s\&quot;&quot;,</span>
<a name="l09732"></a>09732 <span class="stringliteral">                rpc_list[rpc_index].name, _client_connection[index].host_name);</span>
<a name="l09733"></a>09733 <span class="stringliteral"></span>
<a name="l09734"></a>09734 <span class="stringliteral">         /* disconnect to avoid that the reply to this rpc_call comes at</span>
<a name="l09735"></a>09735 <span class="stringliteral">            the next rpc_call */</span>
<a name="l09736"></a>09736 <span class="stringliteral">         rpc_client_disconnect(hConn, FALSE);</span>
<a name="l09737"></a>09737 <span class="stringliteral"></span>
<a name="l09738"></a>09738 <span class="stringliteral">         return RPC_TIMEOUT;</span>
<a name="l09739"></a>09739 <span class="stringliteral">      }</span>
<a name="l09740"></a>09740 <span class="stringliteral">   }</span>
<a name="l09741"></a>09741 <span class="stringliteral"></span>
<a name="l09742"></a>09742 <span class="stringliteral">   /* receive result on send socket */</span>
<a name="l09743"></a>09743 <span class="stringliteral">   i = recv_tcp(send_sock, _net_send_buffer, NET_BUFFER_SIZE, 0);</span>
<a name="l09744"></a>09744 <span class="stringliteral"></span>
<a name="l09745"></a>09745 <span class="stringliteral">   if (i &lt;= 0) {</span>
<a name="l09746"></a>09746 <span class="stringliteral">      cm_msg(MERROR, &quot;rpc_client_call&quot;,</span>
<a name="l09747"></a>09747 <span class="stringliteral">             &quot;recv_tcp() failed, routine = \&quot;%s\&quot;, host = \&quot;%s\&quot;&quot;,</span>
<a name="l09748"></a>09748 <span class="stringliteral">             rpc_list[rpc_index].name, _client_connection[index].host_name);</span>
<a name="l09749"></a>09749 <span class="stringliteral">      return RPC_NET_ERROR;</span>
<a name="l09750"></a>09750 <span class="stringliteral">   }</span>
<a name="l09751"></a>09751 <span class="stringliteral"></span>
<a name="l09752"></a>09752 <span class="stringliteral">   /* extract result variables and place it to argument list */</span>
<a name="l09753"></a>09753 <span class="stringliteral">   status = nc-&gt;header.routine_id;</span>
<a name="l09754"></a>09754 <span class="stringliteral"></span>
<a name="l09755"></a>09755 <span class="stringliteral">   va_start(ap, routine_id);</span>
<a name="l09756"></a>09756 <span class="stringliteral"></span>
<a name="l09757"></a>09757 <span class="stringliteral">   for (i = 0, param_ptr = nc-&gt;param; rpc_list[rpc_index].param[i].tid != 0; i++) {</span>
<a name="l09758"></a>09758 <span class="stringliteral">      tid = rpc_list[rpc_index].param[i].tid;</span>
<a name="l09759"></a>09759 <span class="stringliteral">      flags = rpc_list[rpc_index].param[i].flags;</span>
<a name="l09760"></a>09760 <span class="stringliteral"></span>
<a name="l09761"></a>09761 <span class="stringliteral">      bpointer = (flags &amp; RPC_POINTER) || (flags &amp; RPC_OUT) ||</span>
<a name="l09762"></a>09762 <span class="stringliteral">          (flags &amp; RPC_FIXARRAY) || (flags &amp; RPC_VARARRAY) ||</span>
<a name="l09763"></a>09763 <span class="stringliteral">          tid == TID_STRING || tid == TID_ARRAY || tid == TID_STRUCT || tid == TID_LINK;</span>
<a name="l09764"></a>09764 <span class="stringliteral"></span>
<a name="l09765"></a>09765 <span class="stringliteral">      if (bpointer)</span>
<a name="l09766"></a>09766 <span class="stringliteral">         arg_type = TID_ARRAY;</span>
<a name="l09767"></a>09767 <span class="stringliteral">      else</span>
<a name="l09768"></a>09768 <span class="stringliteral">         arg_type = rpc_list[rpc_index].param[i].tid;</span>
<a name="l09769"></a>09769 <span class="stringliteral"></span>
<a name="l09770"></a>09770 <span class="stringliteral">      if (tid == TID_FLOAT &amp;&amp; !bpointer)</span>
<a name="l09771"></a>09771 <span class="stringliteral">         arg_type = TID_DOUBLE;</span>
<a name="l09772"></a>09772 <span class="stringliteral"></span>
<a name="l09773"></a>09773 <span class="stringliteral">      rpc_va_arg(&amp;ap, arg_type, arg);</span>
<a name="l09774"></a>09774 <span class="stringliteral"></span>
<a name="l09775"></a>09775 <span class="stringliteral">      if (rpc_list[rpc_index].param[i].flags &amp; RPC_OUT) {</span>
<a name="l09776"></a>09776 <span class="stringliteral">         tid = rpc_list[rpc_index].param[i].tid;</span>
<a name="l09777"></a>09777 <span class="stringliteral">         flags = rpc_list[rpc_index].param[i].flags;</span>
<a name="l09778"></a>09778 <span class="stringliteral"></span>
<a name="l09779"></a>09779 <span class="stringliteral">         arg_size = tid_size[tid];</span>
<a name="l09780"></a>09780 <span class="stringliteral"></span>
<a name="l09781"></a>09781 <span class="stringliteral">         if (tid == TID_STRING || tid == TID_LINK)</span>
<a name="l09782"></a>09782 <span class="stringliteral">            arg_size = strlen((char *) (param_ptr)) + 1;</span>
<a name="l09783"></a>09783 <span class="stringliteral"></span>
<a name="l09784"></a>09784 <span class="stringliteral">         if (flags &amp; RPC_VARARRAY) {</span>
<a name="l09785"></a>09785 <span class="stringliteral">            arg_size = *((INT *) param_ptr);</span>
<a name="l09786"></a>09786 <span class="stringliteral">            param_ptr += ALIGN8(sizeof(INT));</span>
<a name="l09787"></a>09787 <span class="stringliteral">         }</span>
<a name="l09788"></a>09788 <span class="stringliteral"></span>
<a name="l09789"></a>09789 <span class="stringliteral">         if (tid == TID_STRUCT || (flags &amp; RPC_FIXARRAY))</span>
<a name="l09790"></a>09790 <span class="stringliteral">            arg_size = rpc_list[rpc_index].param[i].n;</span>
<a name="l09791"></a>09791 <span class="stringliteral"></span>
<a name="l09792"></a>09792 <span class="stringliteral">         /* return parameters are always pointers */</span>
<a name="l09793"></a>09793 <span class="stringliteral">         if (*((char **) arg))</span>
<a name="l09794"></a>09794 <span class="stringliteral">            memcpy((void *) *((char **) arg), param_ptr, arg_size);</span>
<a name="l09795"></a>09795 <span class="stringliteral"></span>
<a name="l09796"></a>09796 <span class="stringliteral">         /* parameter size is always aligned */</span>
<a name="l09797"></a>09797 <span class="stringliteral">         param_size = ALIGN8(arg_size);</span>
<a name="l09798"></a>09798 <span class="stringliteral"></span>
<a name="l09799"></a>09799 <span class="stringliteral">         param_ptr += param_size;</span>
<a name="l09800"></a>09800 <span class="stringliteral">      }</span>
<a name="l09801"></a>09801 <span class="stringliteral">   }</span>
<a name="l09802"></a>09802 <span class="stringliteral"></span>
<a name="l09803"></a>09803 <span class="stringliteral">   va_end(ap);</span>
<a name="l09804"></a>09804 <span class="stringliteral"></span>
<a name="l09805"></a>09805 <span class="stringliteral">   return status;</span>
<a name="l09806"></a>09806 <span class="stringliteral">}</span>
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga7e43be3195a7f7580eb0b981b8d83c86"></a><!-- doxytag: member="midas.c::rpc_client_check" ref="ga7e43be3195a7f7580eb0b981b8d83c86" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rpc_client_check </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l08597">8597</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="fal_8c_source.html#l00201">buffer</a>, <a class="el" href="melog_8c_source.html#l00085">closesocket</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="msystem_8h_source.html#l00336">FD_SETSIZE</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="msystem_8h_source.html#l00255">MAX_RPC_CONNECTION</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="msystem_8h_source.html#l00424">RPC_CLIENT_CONNECTION::send_sock</a>, and <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>.</p>

<p>Referenced by <a class="el" href="odbedit_8c_source.html#l01301">cmd_idle()</a>, and <a class="el" href="midas_8c_source.html#l08416">rpc_client_connect()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08600"></a>08600          : <a class="code" href="group__msystemincludecode.html#ga27ea9d59a4ea083a780963eb308220dc">rpc_client_check</a>
<a name="l08601"></a>08601 
<a name="l08602"></a>08602   Purpose: Check all client connections <span class="keywordflow">if</span> remote client closed link
<a name="l08603"></a>08603 
<a name="l08604"></a>08604   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l08605"></a>08605     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>              Successful completion
<a name="l08606"></a>08606     <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>            Error <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> socket <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a>
<a name="l08607"></a>08607     <a class="code" href="group__err25.html#gad3a9f2a6b26ce5b987f6b2088fbb627c">RPC_NO_CONNECTION</a>        Maximum number of connections reached
<a name="l08608"></a>08608     <a class="code" href="group__err25.html#ga8e46f3de256d0dc247efd6386b5b5a39">RPC_NOT_REGISTERED</a>       <a class="code" href="group__msectionh.html#gae12b15703f10f41044e599520e665f5a">cm_connect_experiment</a> was not called properly
<a name="l08609"></a>08609 
<a name="l08610"></a>08610 \********************************************************************/
<a name="l08611"></a>08611 {
<a name="l08612"></a>08612    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l08613"></a>08613 
<a name="l08614"></a>08614    <span class="comment">/* check for broken connections */</span>
<a name="l08615"></a>08615    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__msystemincludecode.html#gab1e8a2a4c5dc40faf6f7c25b51a4562f">MAX_RPC_CONNECTION</a>; i++)
<a name="l08616"></a>08616       <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[i].send_sock != 0) {
<a name="l08617"></a>08617          <span class="keywordtype">int</span> sock;
<a name="l08618"></a>08618          fd_set readfds;
<a name="l08619"></a>08619          <span class="keyword">struct </span>timeval <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>;
<a name="l08620"></a>08620          <span class="keywordtype">char</span> <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>[64];
<a name="l08621"></a>08621 
<a name="l08622"></a>08622          sock = <a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[i].<a class="code" href="structRPC__CLIENT__CONNECTION.html#a8dd8d05a1b2096abfdffbd64272918e4">send_sock</a>;
<a name="l08623"></a>08623          FD_ZERO(&amp;readfds);
<a name="l08624"></a>08624          FD_SET(sock, &amp;readfds);
<a name="l08625"></a>08625 
<a name="l08626"></a>08626          <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>.tv_sec = 0;
<a name="l08627"></a>08627          <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>.tv_usec = 0;
<a name="l08628"></a>08628 
<a name="l08629"></a>08629          <span class="keywordflow">do</span> {
<a name="l08630"></a>08630             status = select(<a class="code" href="group__msystemincludecode.html#ga86c5dbf5a99358e288f573d6a1e0873f">FD_SETSIZE</a>, &amp;readfds, NULL, NULL, &amp;<a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>);
<a name="l08631"></a>08631          } <span class="keywordflow">while</span> (status == -1);        <span class="comment">/* dont return if an alarm signal was cought */</span>
<a name="l08632"></a>08632 
<a name="l08633"></a>08633          <span class="keywordflow">if</span> (FD_ISSET(sock, &amp;readfds)) {
<a name="l08634"></a>08634             status = recv(sock, (<span class="keywordtype">char</span> *) buffer, <span class="keyword">sizeof</span>(buffer), 0);
<a name="l08635"></a>08635 
<a name="l08636"></a>08636             <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(buffer, <span class="stringliteral">&quot;EXIT&quot;</span>)) {
<a name="l08637"></a>08637                <span class="comment">/* normal exit */</span>
<a name="l08638"></a>08638                <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(sock);
<a name="l08639"></a>08639                memset(&amp;<a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[i], 0, <span class="keyword">sizeof</span>(<a class="code" href="structRPC__CLIENT__CONNECTION.html">RPC_CLIENT_CONNECTION</a>));
<a name="l08640"></a>08640             }
<a name="l08641"></a>08641 
<a name="l08642"></a>08642             <span class="keywordflow">if</span> (status &lt;= 0) {
<a name="l08643"></a>08643                <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_client_check&quot;</span>,
<a name="l08644"></a>08644                       <span class="stringliteral">&quot;Connection broken to \&quot;%s\&quot; on host %s&quot;</span>,
<a name="l08645"></a>08645                       <a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[i].client_name, <a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[i].<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>);
<a name="l08646"></a>08646 
<a name="l08647"></a>08647                <span class="comment">/* connection broken -&gt; reset */</span>
<a name="l08648"></a>08648                <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(sock);
<a name="l08649"></a>08649                memset(&amp;<a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[i], 0, <span class="keyword">sizeof</span>(<a class="code" href="structRPC__CLIENT__CONNECTION.html">RPC_CLIENT_CONNECTION</a>));
<a name="l08650"></a>08650             }
<a name="l08651"></a>08651          }
<a name="l08652"></a>08652       }
<a name="l08653"></a>08653 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga2daf176f4376f5a41d68007d32e079a0"></a><!-- doxytag: member="midas.c::rpc_client_connect" ref="ga2daf176f4376f5a41d68007d32e079a0" args="(char *host_name, INT port, char *client_name, HNDLE *hConnection)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_client_connect </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>host_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>client_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> *&nbsp;</td>
          <td class="paramname"> <em>hConnection</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l08416">8416</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l00696">DEFAULT_RPC_TIMEOUT</a>, <a class="el" href="msystem_8h_source.html#l00423">RPC_CLIENT_CONNECTION::exp_name</a>, <a class="el" href="midas_8h_source.html#l00682">HOST_NAME_LENGTH</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="msystem_8h_source.html#l00255">MAX_RPC_CONNECTION</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="msystem_8h_source.html#l00422">RPC_CLIENT_CONNECTION::port</a>, <a class="el" href="system_8c_source.html#l03660">recv_string()</a>, <a class="el" href="msystem_8h_source.html#l00425">RPC_CLIENT_CONNECTION::remote_hw_type</a>, <a class="el" href="midas_8c_source.html#l08597">rpc_client_check()</a>, <a class="el" href="midas_8c_source.html#l09368">rpc_get_name()</a>, <a class="el" href="midas_8c_source.html#l09092">rpc_get_option()</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8h_source.html#l01068">RPC_NO_CONNECTION</a>, <a class="el" href="midas_8h_source.html#l01072">RPC_NOT_REGISTERED</a>, <a class="el" href="midas_8h_source.html#l00771">RPC_OHW_TYPE</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l00781">RPC_TCP</a>, <a class="el" href="msystem_8h_source.html#l00428">RPC_CLIENT_CONNECTION::rpc_timeout</a>, <a class="el" href="scs__310_8c_source.html#l00266">send()</a>, <a class="el" href="msystem_8h_source.html#l00424">RPC_CLIENT_CONNECTION::send_sock</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, and <a class="el" href="msystem_8h_source.html#l00427">RPC_CLIENT_CONNECTION::transport</a>.</p>

<p>Referenced by <a class="el" href="camacrpc_8c_source.html#l00073">cam_init_rpc()</a>, <a class="el" href="midas_8c_source.html#l02688">cm_connect_client()</a>, <a class="el" href="midas_8c_source.html#l04979">cm_shutdown()</a>, <a class="el" href="midas_8c_source.html#l03579">cm_transition()</a>, and <a class="el" href="rpc__clnt_8c_source.html#l00070">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08419"></a>08419          : <a class="code" href="group__msectionh.html#ga2de60561041ac7fba9cef6e8276b413d">rpc_client_connect</a>
<a name="l08420"></a>08420 
<a name="l08421"></a>08421   Purpose: Establish a network connection to a remote client
<a name="l08422"></a>08422 
<a name="l08423"></a>08423   Input:
<a name="l08424"></a>08424     <span class="keywordtype">char</span> *<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>          <a class="code" href="c8051F000_8h.html#a75c2c81467f6a78b910f937ffd7841e2">IP</a> <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a> of host to connect to.
<a name="l08425"></a>08425     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>  port                TPC port to connect to.
<a name="l08426"></a>08426     <span class="keywordtype">char</span> *clinet_name        Client program <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>
<a name="l08427"></a>08427 
<a name="l08428"></a>08428   Output:
<a name="l08429"></a>08429     <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> *hConnection       Handle <span class="keywordflow">for</span> <span class="keyword">new</span> connection which can be used
<a name="l08430"></a>08430                              <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> future <a class="code" href="group__msectionh.html#ga6bf1d13a0c49a3f7a02650885937b5e7">rpc_call</a>(hConnection....) calls
<a name="l08431"></a>08431 
<a name="l08432"></a>08432   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l08433"></a>08433     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>              Successful completion
<a name="l08434"></a>08434     <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>            Error <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> socket <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a>
<a name="l08435"></a>08435     <a class="code" href="group__err25.html#gad3a9f2a6b26ce5b987f6b2088fbb627c">RPC_NO_CONNECTION</a>        Maximum number of connections reached
<a name="l08436"></a>08436     <a class="code" href="group__err25.html#ga8e46f3de256d0dc247efd6386b5b5a39">RPC_NOT_REGISTERED</a>       <a class="code" href="group__msectionh.html#gae12b15703f10f41044e599520e665f5a">cm_connect_experiment</a> was not called properly
<a name="l08437"></a>08437 
<a name="l08438"></a>08438 \********************************************************************/
<a name="l08439"></a>08439 {
<a name="l08440"></a>08440    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>;
<a name="l08441"></a>08441    <span class="keyword">struct </span>sockaddr_in bind_addr;
<a name="l08442"></a>08442    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> sock;
<a name="l08443"></a>08443    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> remote_hw_type, hw_type;
<a name="l08444"></a>08444    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[200];
<a name="l08445"></a>08445    <span class="keywordtype">char</span> version[32], v1[32];
<a name="l08446"></a>08446    <span class="keywordtype">char</span> local_prog_name[<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>];
<a name="l08447"></a>08447    <span class="keywordtype">char</span> local_host_name[<a class="code" href="group__midasincludecode.html#ga2010c9ed4ef21c3171de778157b9c494">HOST_NAME_LENGTH</a>];
<a name="l08448"></a>08448    <span class="keyword">struct </span>hostent *phe;
<a name="l08449"></a>08449 
<a name="l08450"></a>08450 <span class="preprocessor">#ifdef OS_WINNT</span>
<a name="l08451"></a>08451 <span class="preprocessor"></span>   {
<a name="l08452"></a>08452       WSADATA WSAData;
<a name="l08453"></a>08453 
<a name="l08454"></a>08454       <span class="comment">/* Start windows sockets */</span>
<a name="l08455"></a>08455       <span class="keywordflow">if</span> (WSAStartup(MAKEWORD(1, 1), &amp;WSAData) != 0)
<a name="l08456"></a>08456          <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l08457"></a>08457    }
<a name="l08458"></a>08458 <span class="preprocessor">#endif</span>
<a name="l08459"></a>08459 <span class="preprocessor"></span>
<a name="l08460"></a>08460    <span class="comment">/* check if cm_connect_experiment was called */</span>
<a name="l08461"></a>08461    <span class="keywordflow">if</span> (<a class="code" href="group__midasincludecode.html#gab7fab72dace85185e6be68b79707a4ab">_client_name</a>[0] == 0) {
<a name="l08462"></a>08462       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_client_connect&quot;</span>,
<a name="l08463"></a>08463              <span class="stringliteral">&quot;cm_connect_experiment/rpc_set_name not called&quot;</span>);
<a name="l08464"></a>08464       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga8e46f3de256d0dc247efd6386b5b5a39">RPC_NOT_REGISTERED</a>;
<a name="l08465"></a>08465    }
<a name="l08466"></a>08466 
<a name="l08467"></a>08467    <span class="comment">/* check for broken connections */</span>
<a name="l08468"></a>08468    <a class="code" href="group__msystemincludecode.html#ga27ea9d59a4ea083a780963eb308220dc">rpc_client_check</a>();
<a name="l08469"></a>08469 
<a name="l08470"></a>08470    <span class="comment">/* check if connection already exists */</span>
<a name="l08471"></a>08471    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__msystemincludecode.html#gab1e8a2a4c5dc40faf6f7c25b51a4562f">MAX_RPC_CONNECTION</a>; i++)
<a name="l08472"></a>08472       <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[i].send_sock != 0 &amp;&amp;
<a name="l08473"></a>08473           strcmp(<a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[i].<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>, host_name) == 0 &amp;&amp;
<a name="l08474"></a>08474           <a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[i].port == port) {
<a name="l08475"></a>08475          *hConnection = i + 1;
<a name="l08476"></a>08476          <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l08477"></a>08477       }
<a name="l08478"></a>08478 
<a name="l08479"></a>08479    <span class="comment">/* search for free entry */</span>
<a name="l08480"></a>08480    <span class="keywordflow">for</span> (i = 0; i &lt; MAX_RPC_CONNECTION; i++)
<a name="l08481"></a>08481       <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[i].send_sock == 0)
<a name="l08482"></a>08482          <span class="keywordflow">break</span>;
<a name="l08483"></a>08483 
<a name="l08484"></a>08484    <span class="comment">/* open new network connection */</span>
<a name="l08485"></a>08485    <span class="keywordflow">if</span> (i == MAX_RPC_CONNECTION) {
<a name="l08486"></a>08486       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_client_connect&quot;</span>, <span class="stringliteral">&quot;maximum number of connections exceeded&quot;</span>);
<a name="l08487"></a>08487       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gad3a9f2a6b26ce5b987f6b2088fbb627c">RPC_NO_CONNECTION</a>;
<a name="l08488"></a>08488    }
<a name="l08489"></a>08489 
<a name="l08490"></a>08490    <span class="comment">/* create a new socket for connecting to remote server */</span>
<a name="l08491"></a>08491    sock = socket(AF_INET, SOCK_STREAM, 0);
<a name="l08492"></a>08492    <span class="keywordflow">if</span> (sock == -1) {
<a name="l08493"></a>08493       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_client_connect&quot;</span>, <span class="stringliteral">&quot;cannot create socket&quot;</span>);
<a name="l08494"></a>08494       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l08495"></a>08495    }
<a name="l08496"></a>08496 
<a name="l08497"></a>08497    index = i;
<a name="l08498"></a>08498    strcpy(<a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[index].host_name, host_name);
<a name="l08499"></a>08499    strcpy(<a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[index].client_name, client_name);
<a name="l08500"></a>08500    <a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[index].<a class="code" href="structRPC__CLIENT__CONNECTION.html#a4c1627f75cd2772bf9614a29f4db9430">port</a> = port;
<a name="l08501"></a>08501    <a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[index].<a class="code" href="structRPC__CLIENT__CONNECTION.html#a30894465e666eea3b7671c81f6d6b8ff">exp_name</a>[0] = 0;
<a name="l08502"></a>08502    <a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[index].<a class="code" href="structRPC__CLIENT__CONNECTION.html#a526ef7cf39ae237154b4725aafb2fd0b">transport</a> = <a class="code" href="group__mdefineh.html#ga9d0de5957c2c776323a0c74e668f544d">RPC_TCP</a>;
<a name="l08503"></a>08503    <a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[index].<a class="code" href="structRPC__CLIENT__CONNECTION.html#a63051393eedd1fca0e91c42c34f4441f">rpc_timeout</a> = <a class="code" href="group__midasincludecode.html#ga39d21da28bfcbf0caba6bd19ef551f36">DEFAULT_RPC_TIMEOUT</a>;
<a name="l08504"></a>08504    <a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[index].<a class="code" href="structRPC__CLIENT__CONNECTION.html#a63051393eedd1fca0e91c42c34f4441f">rpc_timeout</a> = <a class="code" href="group__midasincludecode.html#ga39d21da28bfcbf0caba6bd19ef551f36">DEFAULT_RPC_TIMEOUT</a>;
<a name="l08505"></a>08505 
<a name="l08506"></a>08506    <span class="comment">/* connect to remote node */</span>
<a name="l08507"></a>08507    memset(&amp;bind_addr, 0, <span class="keyword">sizeof</span>(bind_addr));
<a name="l08508"></a>08508    bind_addr.sin_family = AF_INET;
<a name="l08509"></a>08509    bind_addr.sin_addr.s_addr = 0;
<a name="l08510"></a>08510    bind_addr.sin_port = htons((<span class="keywordtype">short</span>) port);
<a name="l08511"></a>08511 
<a name="l08512"></a>08512 <span class="preprocessor">#ifdef OS_VXWORKS</span>
<a name="l08513"></a>08513 <span class="preprocessor"></span>   {
<a name="l08514"></a>08514       <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> host_addr;
<a name="l08515"></a>08515 
<a name="l08516"></a>08516       host_addr = hostGetByName(host_name);
<a name="l08517"></a>08517       memcpy((<span class="keywordtype">char</span> *) &amp;(bind_addr.sin_addr), &amp;host_addr, 4);
<a name="l08518"></a>08518    }
<a name="l08519"></a>08519 <span class="preprocessor">#else</span>
<a name="l08520"></a>08520 <span class="preprocessor"></span>   phe = gethostbyname(host_name);
<a name="l08521"></a>08521    <span class="keywordflow">if</span> (phe == NULL) {
<a name="l08522"></a>08522       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_client_connect&quot;</span>, <span class="stringliteral">&quot;cannot get host name&quot;</span>);
<a name="l08523"></a>08523       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l08524"></a>08524    }
<a name="l08525"></a>08525    memcpy((<span class="keywordtype">char</span> *) &amp;(bind_addr.sin_addr), phe-&gt;h_addr, phe-&gt;h_length);
<a name="l08526"></a>08526 <span class="preprocessor">#endif</span>
<a name="l08527"></a>08527 <span class="preprocessor"></span>
<a name="l08528"></a>08528 <span class="preprocessor">#ifdef OS_UNIX</span>
<a name="l08529"></a>08529 <span class="preprocessor"></span>   <span class="keywordflow">do</span> {
<a name="l08530"></a>08530       status = connect(sock, (<span class="keywordtype">void</span> *) &amp;bind_addr, <span class="keyword">sizeof</span>(bind_addr));
<a name="l08531"></a>08531 
<a name="l08532"></a>08532       <span class="comment">/* don&apos;t return if an alarm signal was cought */</span>
<a name="l08533"></a>08533    } <span class="keywordflow">while</span> (status == -1 &amp;&amp; errno == EINTR);
<a name="l08534"></a>08534 <span class="preprocessor">#else</span>
<a name="l08535"></a>08535 <span class="preprocessor"></span>   status = connect(sock, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, <span class="keyword">sizeof</span>(bind_addr));
<a name="l08536"></a>08536 <span class="preprocessor">#endif</span>
<a name="l08537"></a>08537 <span class="preprocessor"></span>
<a name="l08538"></a>08538    <span class="keywordflow">if</span> (status != 0) {
<a name="l08539"></a>08539       <span class="comment">/* cm_msg(MERROR, &quot;rpc_client_connect&quot;, &quot;cannot connect&quot;);</span>
<a name="l08540"></a>08540 <span class="comment">         message should be displayed by application */</span>
<a name="l08541"></a>08541       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l08542"></a>08542    }
<a name="l08543"></a>08543 
<a name="l08544"></a>08544    <span class="comment">/* set TCP_NODELAY option for better performance */</span>
<a name="l08545"></a>08545 <span class="preprocessor">#ifdef OS_VXWORKS</span>
<a name="l08546"></a>08546 <span class="preprocessor"></span>   i = 1;
<a name="l08547"></a>08547    setsockopt(sock, IPPROTO_TCP, TCP_NODELAY, (<span class="keywordtype">char</span> *) &amp;i, <span class="keyword">sizeof</span>(i));
<a name="l08548"></a>08548 <span class="preprocessor">#endif</span>
<a name="l08549"></a>08549 <span class="preprocessor"></span>
<a name="l08550"></a>08550    <span class="comment">/* send local computer info */</span>
<a name="l08551"></a>08551    <a class="code" href="group__msectionh.html#ga0fe26d0eebb34139d77a455e50246b26">rpc_get_name</a>(local_prog_name);
<a name="l08552"></a>08552    gethostname(local_host_name, <span class="keyword">sizeof</span>(local_host_name));
<a name="l08553"></a>08553 
<a name="l08554"></a>08554    hw_type = <a class="code" href="group__msectionh.html#gae3bca206872bae947c6e20c1aedfe4f5">rpc_get_option</a>(0, <a class="code" href="group__mdefineh.html#gaf716b122f115aca08e68391343145cb3">RPC_OHW_TYPE</a>);
<a name="l08555"></a>08555    sprintf(str, <span class="stringliteral">&quot;%d %s %s %s&quot;</span>, hw_type, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>(), local_prog_name,
<a name="l08556"></a>08556            local_host_name);
<a name="l08557"></a>08557 
<a name="l08558"></a>08558    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(sock, str, strlen(str) + 1, 0);
<a name="l08559"></a>08559 
<a name="l08560"></a>08560    <span class="comment">/* receive remote computer info */</span>
<a name="l08561"></a>08561    i = <a class="code" href="group__msystemincludecode.html#gaf9411818011b3b2bbc02a1db8340c77a">recv_string</a>(sock, str, <span class="keyword">sizeof</span>(str), 10000);
<a name="l08562"></a>08562    <span class="keywordflow">if</span> (i &lt;= 0) {
<a name="l08563"></a>08563       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_client_connect&quot;</span>, <span class="stringliteral">&quot;timeout on receive remote computer info: %s&quot;</span>,
<a name="l08564"></a>08564              str);
<a name="l08565"></a>08565       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l08566"></a>08566    }
<a name="l08567"></a>08567 
<a name="l08568"></a>08568    remote_hw_type = version[0] = 0;
<a name="l08569"></a>08569    sscanf(str, <span class="stringliteral">&quot;%d %s&quot;</span>, &amp;remote_hw_type, version);
<a name="l08570"></a>08570    <a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[index].<a class="code" href="structRPC__CLIENT__CONNECTION.html#a67a699ee3fef4afd8304ae3d451b5586">remote_hw_type</a> = remote_hw_type;
<a name="l08571"></a>08571    <a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[index].<a class="code" href="structRPC__CLIENT__CONNECTION.html#a8dd8d05a1b2096abfdffbd64272918e4">send_sock</a> = sock;
<a name="l08572"></a>08572 
<a name="l08573"></a>08573    <span class="comment">/* print warning if version patch level doesn&apos;t agree */</span>
<a name="l08574"></a>08574    strcpy(v1, version);
<a name="l08575"></a>08575    <span class="keywordflow">if</span> (strchr(v1, <span class="charliteral">&apos;.&apos;</span>))
<a name="l08576"></a>08576       <span class="keywordflow">if</span> (strchr(strchr(v1, <span class="charliteral">&apos;.&apos;</span>) + 1, <span class="charliteral">&apos;.&apos;</span>))
<a name="l08577"></a>08577          *strchr(strchr(v1, <span class="charliteral">&apos;.&apos;</span>) + 1, <span class="charliteral">&apos;.&apos;</span>) = 0;
<a name="l08578"></a>08578 
<a name="l08579"></a>08579    strcpy(str, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l08580"></a>08580    <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;.&apos;</span>))
<a name="l08581"></a>08581       <span class="keywordflow">if</span> (strchr(strchr(str, <span class="charliteral">&apos;.&apos;</span>) + 1, <span class="charliteral">&apos;.&apos;</span>))
<a name="l08582"></a>08582          *strchr(strchr(str, <span class="charliteral">&apos;.&apos;</span>) + 1, <span class="charliteral">&apos;.&apos;</span>) = 0;
<a name="l08583"></a>08583 
<a name="l08584"></a>08584    <span class="keywordflow">if</span> (strcmp(v1, str) != 0) {
<a name="l08585"></a>08585       sprintf(str, <span class="stringliteral">&quot;remote MIDAS version %s differs from local version %s&quot;</span>,
<a name="l08586"></a>08586               version, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l08587"></a>08587       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_client_connect&quot;</span>, str);
<a name="l08588"></a>08588    }
<a name="l08589"></a>08589 
<a name="l08590"></a>08590    *hConnection = index + 1;
<a name="l08591"></a>08591 
<a name="l08592"></a>08592    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l08593"></a>08593 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga1b5b830d23f4d5456d616fd1713db126"></a><!-- doxytag: member="midas.c::rpc_client_disconnect" ref="ga1b5b830d23f4d5456d616fd1713db126" args="(HNDLE hConn, BOOL bShutdown)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_client_disconnect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a>&nbsp;</td>
          <td class="paramname"> <em>hConn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td>
          <td class="paramname"> <em>bShutdown</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l08923">8923</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="melog_8c_source.html#l00085">closesocket</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="msystem_8h_source.html#l00255">MAX_RPC_CONNECTION</a>, <a class="el" href="midas_8c_source.html#l09519">rpc_client_call()</a>, <a class="el" href="midas_8c_source.html#l08923">rpc_client_disconnect()</a>, <a class="el" href="midas_8h_source.html#l00782">RPC_FTCP</a>, <a class="el" href="mrpc_8h_source.html#l00203">RPC_ID_EXIT</a>, <a class="el" href="mrpc_8h_source.html#l00202">RPC_ID_SHUTDOWN</a>, <a class="el" href="midas_8h_source.html#l00769">RPC_OTRANSPORT</a>, <a class="el" href="midas_8c_source.html#l09211">rpc_set_option()</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, and <a class="el" href="scs__310_8c_source.html#l00266">send()</a>.</p>

<p>Referenced by <a class="el" href="camacrpc_8c_source.html#l00500">cam_exit()</a>, <a class="el" href="midas_8c_source.html#l02754">cm_disconnect_client()</a>, <a class="el" href="midas_8c_source.html#l02768">cm_disconnect_experiment()</a>, <a class="el" href="midas_8c_source.html#l04979">cm_shutdown()</a>, <a class="el" href="rpc__clnt_8c_source.html#l00070">main()</a>, <a class="el" href="midas_8c_source.html#l09519">rpc_client_call()</a>, and <a class="el" href="midas_8c_source.html#l08923">rpc_client_disconnect()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08926"></a>08926          : <a class="code" href="group__msectionh.html#ga12d2a014754a8f5cc12a31ad60e8e4bc">rpc_client_disconnect</a>
<a name="l08927"></a>08927 
<a name="l08928"></a>08928   Purpose: Close a rpc connection to a MIDAS client
<a name="l08929"></a>08929 
<a name="l08930"></a>08930   Input:
<a name="l08931"></a>08931     <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a>  <a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a>           Handle of connection
<a name="l08932"></a>08932     <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>   bShutdown       Shut down remote server <span class="keywordflow">if</span> <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>
<a name="l08933"></a>08933 
<a name="l08934"></a>08934   Output:
<a name="l08935"></a>08935     none
<a name="l08936"></a>08936 
<a name="l08937"></a>08937   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l08938"></a>08938    <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l08939"></a>08939 
<a name="l08940"></a>08940 \********************************************************************/
<a name="l08941"></a>08941 {
<a name="l08942"></a>08942    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l08943"></a>08943 
<a name="l08944"></a>08944    <span class="keywordflow">if</span> (<a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a> == -1) {
<a name="l08945"></a>08945       <span class="comment">/* close all open connections */</span>
<a name="l08946"></a>08946       <span class="keywordflow">for</span> (i = <a class="code" href="group__msystemincludecode.html#gab1e8a2a4c5dc40faf6f7c25b51a4562f">MAX_RPC_CONNECTION</a> - 1; i &gt;= 0; i--)
<a name="l08947"></a>08947          <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[i].send_sock != 0)
<a name="l08948"></a>08948             <a class="code" href="group__msectionh.html#ga12d2a014754a8f5cc12a31ad60e8e4bc">rpc_client_disconnect</a>(i + 1, <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l08949"></a>08949 
<a name="l08950"></a>08950       <span class="comment">/* close server connection from other clients */</span>
<a name="l08951"></a>08951       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__msystemincludecode.html#gab1e8a2a4c5dc40faf6f7c25b51a4562f">MAX_RPC_CONNECTION</a>; i++)
<a name="l08952"></a>08952          <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].recv_sock) {
<a name="l08953"></a>08953             <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].recv_sock, <span class="stringliteral">&quot;EXIT&quot;</span>, 5, 0);
<a name="l08954"></a>08954             <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].recv_sock);
<a name="l08955"></a>08955          }
<a name="l08956"></a>08956    } <span class="keywordflow">else</span> {
<a name="l08957"></a>08957       <span class="comment">/* notify server about exit */</span>
<a name="l08958"></a>08958 
<a name="l08959"></a>08959       <span class="comment">/* set FTCP mode (helps for rebooted VxWorks nodes) */</span>
<a name="l08960"></a>08960       <a class="code" href="group__msectionh.html#ga3d863362443e54777f3e4033f1603980">rpc_set_option</a>(<a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a>, <a class="code" href="group__mdefineh.html#ga42ebe781b990fe561db5759b1ce9b633">RPC_OTRANSPORT</a>, <a class="code" href="group__mdefineh.html#gaf80a4b4b5569b25d6e8488a6bafeb347">RPC_FTCP</a>);
<a name="l08961"></a>08961       <a class="code" href="group__msectionh.html#ga6ade8c4e3d08c41fbeb3a98fe2808778">rpc_client_call</a>(<a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a>, bShutdown ? <a class="code" href="group__mrpcdefineh.html#ga758695700ff26f404eec79ecbeab4947">RPC_ID_SHUTDOWN</a> : <a class="code" href="group__mrpcdefineh.html#ga4fecef60778fda08ca026eaad345eca2">RPC_ID_EXIT</a>);
<a name="l08962"></a>08962 
<a name="l08963"></a>08963       <span class="comment">/* close socket */</span>
<a name="l08964"></a>08964       <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[<a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a> - 1].send_sock)
<a name="l08965"></a>08965          <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[<a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a> - 1].send_sock);
<a name="l08966"></a>08966 
<a name="l08967"></a>08967       memset(&amp;<a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[<a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a> - 1], 0, <span class="keyword">sizeof</span>(<a class="code" href="structRPC__CLIENT__CONNECTION.html">RPC_CLIENT_CONNECTION</a>));
<a name="l08968"></a>08968    }
<a name="l08969"></a>08969 
<a name="l08970"></a>08970    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l08971"></a>08971 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaddfad24a27898f83c9d51e41dd208bc6"></a><!-- doxytag: member="midas.c::rpc_client_dispatch" ref="gaddfad24a27898f83c9d51e41dd208bc6" args="(int sock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_client_dispatch </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sock</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l08336">8336</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l07616">bm_poll_event()</a>, <a class="el" href="odb_8c_source.html#l07947">db_update_record()</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="msystem_8h_source.html#l00336">FD_SETSIZE</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="msystem_8h_source.html#l00386">NET_COMMAND::header</a>, <a class="el" href="mevb_8cpp_source.html#l00100">hKey</a>, <a class="el" href="msystem_8h_source.html#l00399">MSG_BM</a>, <a class="el" href="msystem_8h_source.html#l00400">MSG_ODB</a>, <a class="el" href="msystem_8h_source.html#l00404">MSG_WATCHDOG</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="rpc_8c_source.html#l00293">net_buffer</a>, <a class="el" href="msystem_8h_source.html#l00387">NET_COMMAND::param</a>, <a class="el" href="msystem_8h_source.html#l00382">NET_COMMAND_HEADER::param_size</a>, <a class="el" href="system_8c_source.html#l03731">recv_tcp()</a>, <a class="el" href="msystem_8h_source.html#l00381">NET_COMMAND_HEADER::routine_id</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="system_8c_source.html#l03606">send_tcp()</a>, <a class="el" href="midas_8h_source.html#l01047">SS_ABORT</a>, and <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l08657">rpc_server_connect()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08339"></a>08339          : <a class="code" href="group__rpcfunctionc.html#gaddfad24a27898f83c9d51e41dd208bc6">rpc_client_dispatch</a>
<a name="l08340"></a>08340 
<a name="l08341"></a>08341   Purpose: Gets called whenever a client receives <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> from the
<a name="l08342"></a>08342            server. Get <span class="keyword">set</span> via rpc_connect. Internal use only.
<a name="l08343"></a>08343 
<a name="l08344"></a>08344 \********************************************************************/
<a name="l08345"></a>08345 {
<a name="l08346"></a>08346    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, <a class="code" href="mevb_8cpp.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>;
<a name="l08347"></a>08347    <a class="code" href="structNET__COMMAND.html">NET_COMMAND</a> *nc;
<a name="l08348"></a>08348    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a> = 0;
<a name="l08349"></a>08349    <span class="keywordtype">char</span> <a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>[256];
<a name="l08350"></a>08350 
<a name="l08351"></a>08351    nc = (<a class="code" href="structNET__COMMAND.html">NET_COMMAND</a> *) net_buffer;
<a name="l08352"></a>08352 
<a name="l08353"></a>08353    n = <a class="code" href="group__msystemincludecode.html#ga89d1ae530ad0e4bf448c77b57399f357">recv_tcp</a>(sock, net_buffer, <span class="keyword">sizeof</span>(net_buffer), 0);
<a name="l08354"></a>08354    <span class="keywordflow">if</span> (n &lt;= 0)
<a name="l08355"></a>08355       <span class="keywordflow">return</span> <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a>;
<a name="l08356"></a>08356 
<a name="l08357"></a>08357    <span class="keywordflow">if</span> (nc-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#a9805c951be630cb91f6cf5e5fd8a34f4">routine_id</a> == <a class="code" href="group__msystemincludecode.html#gaf7f3c34b1c2aaecf9b7e8af58bfd2d58">MSG_ODB</a>) {
<a name="l08358"></a>08358       <span class="comment">/* update a changed record */</span>
<a name="l08359"></a>08359       hDB = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) nc-&gt;<a class="code" href="structNET__COMMAND.html#a53f81d5350a50df99246d335dd703c63">param</a>);
<a name="l08360"></a>08360       hKey = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) nc-&gt;<a class="code" href="structNET__COMMAND.html#a53f81d5350a50df99246d335dd703c63">param</a> + 1);
<a name="l08361"></a>08361       status = <a class="code" href="group__msystemincludecode.html#gaaad8d8ddee74326c3a5b6590107a2f24">db_update_record</a>(hDB, hKey, 0);
<a name="l08362"></a>08362    }
<a name="l08363"></a>08363 
<a name="l08364"></a>08364    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nc-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#a9805c951be630cb91f6cf5e5fd8a34f4">routine_id</a> == <a class="code" href="group__msystemincludecode.html#gae7e5d847a353f5b7ff0fe45d47fd253d">MSG_WATCHDOG</a>) {
<a name="l08365"></a>08365       nc-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#a9805c951be630cb91f6cf5e5fd8a34f4">routine_id</a> = 1;
<a name="l08366"></a>08366       nc-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#ae0c91723d3f4843639e659ccde63dc5a">param_size</a> = 0;
<a name="l08367"></a>08367       <a class="code" href="group__msystemincludecode.html#gae657f73f38c098645aab383053478d59">send_tcp</a>(sock, net_buffer, <span class="keyword">sizeof</span>(<a class="code" href="structNET__COMMAND__HEADER.html">NET_COMMAND_HEADER</a>), 0);
<a name="l08368"></a>08368       status = <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l08369"></a>08369    }
<a name="l08370"></a>08370 
<a name="l08371"></a>08371    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nc-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#a9805c951be630cb91f6cf5e5fd8a34f4">routine_id</a> == <a class="code" href="group__msystemincludecode.html#ga6e9a9a9996cea71191a21fd2009efcd1">MSG_BM</a>) {
<a name="l08372"></a>08372       fd_set readfds;
<a name="l08373"></a>08373       <span class="keyword">struct </span>timeval <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>;
<a name="l08374"></a>08374 
<a name="l08375"></a>08375       <span class="comment">/* receive further messages to empty TCP queue */</span>
<a name="l08376"></a>08376       <span class="keywordflow">do</span> {
<a name="l08377"></a>08377          FD_ZERO(&amp;readfds);
<a name="l08378"></a>08378          FD_SET(sock, &amp;readfds);
<a name="l08379"></a>08379 
<a name="l08380"></a>08380          <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>.tv_sec = 0;
<a name="l08381"></a>08381          <a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>.tv_usec = 0;
<a name="l08382"></a>08382 
<a name="l08383"></a>08383          select(<a class="code" href="group__msystemincludecode.html#ga86c5dbf5a99358e288f573d6a1e0873f">FD_SETSIZE</a>, &amp;readfds, NULL, NULL, &amp;<a class="code" href="getHist_8cpp.html#a654210ae605a61110cf5a8a0c9f2d72c">timeout</a>);
<a name="l08384"></a>08384 
<a name="l08385"></a>08385          <span class="keywordflow">if</span> (FD_ISSET(sock, &amp;readfds)) {
<a name="l08386"></a>08386             n = <a class="code" href="group__msystemincludecode.html#ga89d1ae530ad0e4bf448c77b57399f357">recv_tcp</a>(sock, net_buffer, <span class="keyword">sizeof</span>(net_buffer), 0);
<a name="l08387"></a>08387             <span class="keywordflow">if</span> (n &lt;= 0)
<a name="l08388"></a>08388                <span class="keywordflow">return</span> <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a>;
<a name="l08389"></a>08389 
<a name="l08390"></a>08390             <span class="keywordflow">if</span> (nc-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#a9805c951be630cb91f6cf5e5fd8a34f4">routine_id</a> == <a class="code" href="group__msystemincludecode.html#gaf7f3c34b1c2aaecf9b7e8af58bfd2d58">MSG_ODB</a>) {
<a name="l08391"></a>08391                <span class="comment">/* update a changed record */</span>
<a name="l08392"></a>08392                hDB = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) nc-&gt;<a class="code" href="structNET__COMMAND.html#a53f81d5350a50df99246d335dd703c63">param</a>);
<a name="l08393"></a>08393                hKey = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) nc-&gt;<a class="code" href="structNET__COMMAND.html#a53f81d5350a50df99246d335dd703c63">param</a> + 1);
<a name="l08394"></a>08394                status = <a class="code" href="group__msystemincludecode.html#gaaad8d8ddee74326c3a5b6590107a2f24">db_update_record</a>(hDB, hKey, 0);
<a name="l08395"></a>08395             }
<a name="l08396"></a>08396 
<a name="l08397"></a>08397             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nc-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#a9805c951be630cb91f6cf5e5fd8a34f4">routine_id</a> == <a class="code" href="group__msystemincludecode.html#gae7e5d847a353f5b7ff0fe45d47fd253d">MSG_WATCHDOG</a>) {
<a name="l08398"></a>08398                nc-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#a9805c951be630cb91f6cf5e5fd8a34f4">routine_id</a> = 1;
<a name="l08399"></a>08399                nc-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#ae0c91723d3f4843639e659ccde63dc5a">param_size</a> = 0;
<a name="l08400"></a>08400                <a class="code" href="group__msystemincludecode.html#gae657f73f38c098645aab383053478d59">send_tcp</a>(sock, net_buffer, <span class="keyword">sizeof</span>(<a class="code" href="structNET__COMMAND__HEADER.html">NET_COMMAND_HEADER</a>), 0);
<a name="l08401"></a>08401                status = <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l08402"></a>08402             }
<a name="l08403"></a>08403          }
<a name="l08404"></a>08404 
<a name="l08405"></a>08405       } <span class="keywordflow">while</span> (FD_ISSET(sock, &amp;readfds));
<a name="l08406"></a>08406 
<a name="l08407"></a>08407       <span class="comment">/* poll event from server */</span>
<a name="l08408"></a>08408       status = <a class="code" href="group__msectionh.html#ga545449f5acb6b13f78b1194cb92b3d63">bm_poll_event</a>(<a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l08409"></a>08409    }
<a name="l08410"></a>08410 
<a name="l08411"></a>08411    <span class="keywordflow">return</span> status;
<a name="l08412"></a>08412 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga07528ca8a8b1e4930ea9f3389c65c8b6"></a><!-- doxytag: member="midas.c::rpc_convert_data" ref="ga07528ca8a8b1e4930ea9f3389c65c8b6" args="(void *data, INT tid, INT flags, INT total_size, INT convert_flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rpc_convert_data </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>tid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>total_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>convert_flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l08108">8108</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="midas_8c_source.html#l08079">rpc_convert_single()</a>, <a class="el" href="midas_8h_source.html#l01784">RPC_FIXARRAY</a>, <a class="el" href="midas_8h_source.html#l01785">RPC_VARARRAY</a>, and <a class="el" href="midas_8c_source.html#l00749">tid_size</a>.</p>

<p>Referenced by <a class="el" href="odb_8c_source.html#l06770">db_get_record()</a>, <a class="el" href="odb_8c_source.html#l06532">db_recurse_record_tree()</a>, <a class="el" href="odb_8c_source.html#l06874">db_set_record()</a>, <a class="el" href="midas_8c_source.html#l10990">rpc_execute()</a>, and <a class="el" href="mserver_8c_source.html#l00534">rpc_server_dispatch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08111"></a>08111          : <a class="code" href="group__msectionh.html#ga7cd1812fd2e76dcc55f736d22be9726c">rpc_convert_data</a>
<a name="l08112"></a>08112 
<a name="l08113"></a>08113   Purpose: Convert <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> <a class="code" href="webpaw_8c.html#a6113855b8e5965f1e91ee407b4026ab7">format</a> between differenct computers
<a name="l08114"></a>08114 
<a name="l08115"></a>08115   Input:
<a name="l08116"></a>08116     <span class="keywordtype">void</span>   *<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>            Pointer to <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>
<a name="l08117"></a>08117     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>    tid              Type <a class="code" href="jorway73a_8h.html#a4bfe115debc7f472dd7dfe4ef9679ca0">ID</a> of <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, one of TID_xxx
<a name="l08118"></a>08118     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>    flags            Combination of following flags:
<a name="l08119"></a>08119                               <a class="code" href="group__msectionh.html#ga26dfdb889f7bda38d3ad2336b4ff16ee">RPC_IN</a>: <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> is <a class="code" href="scs__210_8c.html#aa61c972cf27836eece635f64c459c512">input</a> <a class="code" href="HITS_8h.html#a4f188184523d527be63ee6079f182f17">parameter</a>
<a name="l08120"></a>08120                               <a class="code" href="group__msectionh.html#ga1cc93d6c9309b897244079eb8630ab23">RPC_OUT</a>: <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> is <a class="code" href="scs__210_8c.html#a859e9f68c1c035565d6729c59fd894ae">output</a> <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a>
<a name="l08121"></a>08121                               <a class="code" href="group__msectionh.html#gaede6b3bb560abaf2e83d1d6d0f6ce3f3">RPC_FIXARRAY</a>, <a class="code" href="group__msectionh.html#gac8fee151706080dfb104b55cbf0088b9">RPC_VARARRAY</a>: <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> is array
<a name="l08122"></a>08122                                 of <span class="stringliteral">&quot;size&quot;</span> bytes (see next <a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>.)
<a name="l08123"></a>08123                               <a class="code" href="group__msectionh.html#ga5cf5e72e7cdd75567b08ef7b3bd9e182">RPC_OUTGOING</a>: <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> is outgoing
<a name="l08124"></a>08124     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>    total_size       Size of bytes of <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>. Used <span class="keywordflow">for</span> <a class="code" href="examples_2macro_2midas__macro_8h.html#a38a90ca04f0b9e7dbcfeba0589268090">variable</a>
<a name="l08125"></a>08125                             <a class="code" href="FDCR_8h.html#a9f59b34b1f25fe00023291b678246bcc">length</a> arrays.
<a name="l08126"></a>08126     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>    convert_flags    Flags <span class="keywordflow">for</span> <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> conversion
<a name="l08127"></a>08127 
<a name="l08128"></a>08128   Output:
<a name="l08129"></a>08129     <span class="keywordtype">void</span>   *<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>            Is converted according to _convert_flag
<a name="l08130"></a>08130                             <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>
<a name="l08131"></a>08131 
<a name="l08132"></a>08132   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l08133"></a>08133     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l08134"></a>08134 
<a name="l08135"></a>08135 \********************************************************************/
<a name="l08136"></a>08136 {
<a name="l08137"></a>08137    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, single_size;
<a name="l08138"></a>08138    <span class="keywordtype">char</span> *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>;
<a name="l08139"></a>08139 
<a name="l08140"></a>08140    <span class="comment">/* convert array */</span>
<a name="l08141"></a>08141    <span class="keywordflow">if</span> (flags &amp; (<a class="code" href="group__msectionh.html#gaede6b3bb560abaf2e83d1d6d0f6ce3f3">RPC_FIXARRAY</a> | <a class="code" href="group__msectionh.html#gac8fee151706080dfb104b55cbf0088b9">RPC_VARARRAY</a>)) {
<a name="l08142"></a>08142       single_size = <a class="code" href="group__midasincludecode.html#ga97cc1898bd6240261b5418bcab5a6d35">tid_size</a>[tid];
<a name="l08143"></a>08143       <span class="comment">/* don&apos;t convert TID_ARRAY &amp; TID_STRUCT */</span>
<a name="l08144"></a>08144       <span class="keywordflow">if</span> (single_size == 0)
<a name="l08145"></a>08145          <span class="keywordflow">return</span>;
<a name="l08146"></a>08146 
<a name="l08147"></a>08147       n = total_size / single_size;
<a name="l08148"></a>08148 
<a name="l08149"></a>08149       <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
<a name="l08150"></a>08150          p = (<span class="keywordtype">char</span> *) <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> + (i * single_size);
<a name="l08151"></a>08151          <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(p, tid, flags, convert_flags);
<a name="l08152"></a>08152       }
<a name="l08153"></a>08153    } <span class="keywordflow">else</span> {
<a name="l08154"></a>08154       <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>, tid, flags, convert_flags);
<a name="l08155"></a>08155    }
<a name="l08156"></a>08156 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gafbacbf42add03b242abff91adda4fc3a"></a><!-- doxytag: member="midas.c::rpc_convert_single" ref="gafbacbf42add03b242abff91adda4fc3a" args="(void *data, INT tid, INT flags, INT convert_flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rpc_convert_single </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>tid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>convert_flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l08079">8079</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l01819">CF_ENDIAN</a>, <a class="el" href="midas_8h_source.html#l01820">CF_IEEE2VAX</a>, <a class="el" href="midas_8h_source.html#l01821">CF_VAX2IEEE</a>, <a class="el" href="msystem_8h_source.html#l00221">DWORD_SWAP</a>, <a class="el" href="msystem_8h_source.html#l00231">QWORD_SWAP</a>, <a class="el" href="midas_8c_source.html#l08058">rpc_ieee2vax_double()</a>, <a class="el" href="midas_8c_source.html#l08005">rpc_ieee2vax_float()</a>, <a class="el" href="midas_8h_source.html#l01786">RPC_OUTGOING</a>, <a class="el" href="midas_8c_source.html#l08038">rpc_vax2ieee_double()</a>, <a class="el" href="midas_8c_source.html#l08021">rpc_vax2ieee_float()</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, <a class="el" href="midas_8h_source.html#l00744">TID_DOUBLE</a>, <a class="el" href="midas_8h_source.html#l00740">TID_DWORD</a>, <a class="el" href="midas_8h_source.html#l00743">TID_FLOAT</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="midas_8h_source.html#l00739">TID_SHORT</a>, <a class="el" href="midas_8h_source.html#l00738">TID_WORD</a>, and <a class="el" href="msystem_8h_source.html#l00214">WORD_SWAP</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l07548">bm_notify_client()</a>, <a class="el" href="midas_8c_source.html#l06777">bm_receive_event()</a>, <a class="el" href="odb_8c_source.html#l06770">db_get_record()</a>, <a class="el" href="odb_8c_source.html#l06532">db_recurse_record_tree()</a>, <a class="el" href="odb_8c_source.html#l06874">db_set_record()</a>, <a class="el" href="odb_8c_source.html#l07947">db_update_record()</a>, <a class="el" href="minife_8c_source.html#l00065">main()</a>, <a class="el" href="midas_8c_source.html#l10655">recv_event_server()</a>, <a class="el" href="midas_8c_source.html#l10454">recv_tcp_server()</a>, <a class="el" href="midas_8c_source.html#l12486">rpc_check_channels()</a>, <a class="el" href="midas_8c_source.html#l08108">rpc_convert_data()</a>, <a class="el" href="midas_8c_source.html#l10990">rpc_execute()</a>, and <a class="el" href="mserver_8c_source.html#l00534">rpc_server_dispatch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08080"></a>08080 {
<a name="l08081"></a>08081 
<a name="l08082"></a>08082    <span class="keywordflow">if</span> (convert_flags &amp; <a class="code" href="group__msectionh.html#ga12b8a1f069715d673e75f2c37d2ecfd9">CF_ENDIAN</a>) {
<a name="l08083"></a>08083       <span class="keywordflow">if</span> (tid == <a class="code" href="group__mdefineh.html#ga681cbe2c114c62cecccb882544d2debb">TID_WORD</a> || tid == <a class="code" href="group__mdefineh.html#ga4281dafac4285eae3e3c9be0a1d93c5a">TID_SHORT</a>)
<a name="l08084"></a>08084          <a class="code" href="group__msmacroh.html#ga4670ac841b4b8e3c3141a91a743bc61d">WORD_SWAP</a>(<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>);
<a name="l08085"></a>08085       <span class="keywordflow">if</span> (tid == <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a> || tid == <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a> || tid == <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a> || tid == <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>)
<a name="l08086"></a>08086          <a class="code" href="group__msmacroh.html#gadb40ea04e4e009bbde68c027a8f95039">DWORD_SWAP</a>(<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>);
<a name="l08087"></a>08087       <span class="keywordflow">if</span> (tid == <a class="code" href="group__mdefineh.html#ga13378fa303cf601b4b491866a6688362">TID_DOUBLE</a>)
<a name="l08088"></a>08088          <a class="code" href="group__msmacroh.html#ga8c6db33e3f8af89e87556d9f7a9b32a8">QWORD_SWAP</a>(<a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>);
<a name="l08089"></a>08089    }
<a name="l08090"></a>08090 
<a name="l08091"></a>08091    <span class="keywordflow">if</span> (((convert_flags &amp; <a class="code" href="group__msectionh.html#gab0626e80fbf607cae6f17364efff7ce8">CF_IEEE2VAX</a>) &amp;&amp; !(flags &amp; <a class="code" href="group__msectionh.html#ga5cf5e72e7cdd75567b08ef7b3bd9e182">RPC_OUTGOING</a>)) ||
<a name="l08092"></a>08092        ((convert_flags &amp; <a class="code" href="group__msectionh.html#gadd937ef1d95887c8735e10999d823021">CF_VAX2IEEE</a>) &amp;&amp; (flags &amp; RPC_OUTGOING))) {
<a name="l08093"></a>08093       <span class="keywordflow">if</span> (tid == <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>)
<a name="l08094"></a>08094          <a class="code" href="group__rpcfunctionc.html#gaccde5f164efc9d339256b700a0e03021">rpc_ieee2vax_float</a>((<span class="keywordtype">float</span> *) <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>);
<a name="l08095"></a>08095       <span class="keywordflow">if</span> (tid == <a class="code" href="group__mdefineh.html#ga13378fa303cf601b4b491866a6688362">TID_DOUBLE</a>)
<a name="l08096"></a>08096          <a class="code" href="group__rpcfunctionc.html#gaef4a2b3deceddb0aef68da17453cd163">rpc_ieee2vax_double</a>((<span class="keywordtype">double</span> *) <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>);
<a name="l08097"></a>08097    }
<a name="l08098"></a>08098 
<a name="l08099"></a>08099    <span class="keywordflow">if</span> (((convert_flags &amp; CF_IEEE2VAX) &amp;&amp; (flags &amp; RPC_OUTGOING)) ||
<a name="l08100"></a>08100        ((convert_flags &amp; CF_VAX2IEEE) &amp;&amp; !(flags &amp; RPC_OUTGOING))) {
<a name="l08101"></a>08101       <span class="keywordflow">if</span> (tid == <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>)
<a name="l08102"></a>08102          <a class="code" href="group__rpcfunctionc.html#gaab3294efcbd42ae403a917e2adc78864">rpc_vax2ieee_float</a>((<span class="keywordtype">float</span> *) <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>);
<a name="l08103"></a>08103       <span class="keywordflow">if</span> (tid == <a class="code" href="group__mdefineh.html#ga13378fa303cf601b4b491866a6688362">TID_DOUBLE</a>)
<a name="l08104"></a>08104          <a class="code" href="group__rpcfunctionc.html#gaf4231327adba822d2395cf45be5d92d1">rpc_vax2ieee_double</a>((<span class="keywordtype">double</span> *) <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>);
<a name="l08105"></a>08105    }
<a name="l08106"></a>08106 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga31870b58cfa0d18e70889e1373d8a807"></a><!-- doxytag: member="midas.c::rpc_debug_printf" ref="ga31870b58cfa0d18e70889e1373d8a807" args="(char *format,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rpc_debug_printf </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l09447">9447</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l00834">_debug_mode</a>, and <a class="el" href="group__midasincludecode.html#ga61a5bec512ad6edef8384e4853a0eded">_debug_print</a>.</p>

<p>Referenced by <a class="el" href="mserver_8c_source.html#l00246">main()</a>, <a class="el" href="midas_8c_source.html#l10990">rpc_execute()</a>, <a class="el" href="midas_8c_source.html#l11292">rpc_execute_ascii()</a>, <a class="el" href="midas_8c_source.html#l11616">rpc_server_accept()</a>, <a class="el" href="midas_8c_source.html#l11980">rpc_server_callback()</a>, and <a class="el" href="midas_8c_source.html#l12223">rpc_server_receive()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09450"></a>09450          : rpc_debug_print
<a name="l09451"></a>09451 
<a name="l09452"></a>09452   Purpose: Calls function <span class="keyword">set</span> via <a class="code" href="group__msectionh.html#gace4f55535524757cfb1a0ace8ed264e6">rpc_set_debug</a> to <a class="code" href="scs__210_8c.html#a859e9f68c1c035565d6729c59fd894ae">output</a> a <span class="keywordtype">string</span>.
<a name="l09453"></a>09453 
<a name="l09454"></a>09454   Input:
<a name="l09455"></a>09455    <span class="keywordtype">char</span> *<a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>                Debug <span class="keywordtype">string</span>
<a name="l09456"></a>09456 
<a name="l09457"></a>09457   Output:
<a name="l09458"></a>09458     none
<a name="l09459"></a>09459 
<a name="l09460"></a>09460 \********************************************************************/
<a name="l09461"></a>09461 {
<a name="l09462"></a>09462    va_list argptr;
<a name="l09463"></a>09463    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[1000];
<a name="l09464"></a>09464 
<a name="l09465"></a>09465    <span class="keywordflow">if</span> (<a class="code" href="group__midasincludecode.html#ga8efe0542b4273b7863a8a4e1f16776fe">_debug_mode</a>) {
<a name="l09466"></a>09466       va_start(argptr, <a class="code" href="webpaw_8c.html#a6113855b8e5965f1e91ee407b4026ab7">format</a>);
<a name="l09467"></a>09467       vsprintf(str, (<span class="keywordtype">char</span> *) <a class="code" href="webpaw_8c.html#a6113855b8e5965f1e91ee407b4026ab7">format</a>, argptr);
<a name="l09468"></a>09468       va_end(argptr);
<a name="l09469"></a>09469 
<a name="l09470"></a>09470       <span class="keywordflow">if</span> (<a class="code" href="group__midasincludecode.html#ga61a5bec512ad6edef8384e4853a0eded">_debug_print</a>) {
<a name="l09471"></a>09471          strcat(str, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l09472"></a>09472          <a class="code" href="group__midasincludecode.html#ga61a5bec512ad6edef8384e4853a0eded">_debug_print</a>(str);
<a name="l09473"></a>09473       } <span class="keywordflow">else</span>
<a name="l09474"></a>09474          puts(str);
<a name="l09475"></a>09475    }
<a name="l09476"></a>09476 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga6857fd6fbef63525ce0c4510983471b8"></a><!-- doxytag: member="midas.c::rpc_deregister_functions" ref="ga6857fd6fbef63525ce0c4510983471b8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_deregister_functions </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox </p>

<p>Definition at line <a class="el" href="midas_8c_source.html#l08273">8273</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l01755">M_FREE</a>, and <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l02768">cm_disconnect_experiment()</a>, and <a class="el" href="midas_8c_source.html#l12223">rpc_server_receive()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08276"></a>08276          : <a class="code" href="group__msystemincludecode.html#ga4e6777649b4a4f2a75ac419bdffa27b2">rpc_deregister_functions</a>
<a name="l08277"></a>08277 
<a name="l08278"></a>08278   Purpose: Free memory of previously registered functions
<a name="l08279"></a>08279 
<a name="l08280"></a>08280   Input:
<a name="l08281"></a>08281     none
<a name="l08282"></a>08282 
<a name="l08283"></a>08283   Output:
<a name="l08284"></a>08284     none
<a name="l08285"></a>08285 
<a name="l08286"></a>08286   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l08287"></a>08287     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>              Successful completion
<a name="l08288"></a>08288 
<a name="l08289"></a>08289 \********************************************************************/
<a name="l08290"></a>08290 {
<a name="l08291"></a>08291    <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>)
<a name="l08292"></a>08292       <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>);
<a name="l08293"></a>08293    <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a> = NULL;
<a name="l08294"></a>08294 
<a name="l08295"></a>08295    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l08296"></a>08296 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaaececfb5cc7b4e302cc4f31dae7f773b"></a><!-- doxytag: member="midas.c::rpc_execute" ref="gaaececfb5cc7b4e302cc4f31dae7f773b" args="(INT sock, char *buffer, INT convert_flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_execute </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>convert_flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l10990">10990</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="group__midasincludecode.html#ga61a5bec512ad6edef8384e4853a0eded">_debug_print</a>, <a class="el" href="midas_8h_source.html#l00904">ALIGN8</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="odb_8c_source.html#l06308">db_sprintf()</a>, <a class="el" href="group__midasincludecode.html#gafdeeebdd58f83be10273ff95c6181462">RPC_LIST::dispatch</a>, <a class="el" href="midas_8h_source.html#l01801">RPC_PARAM::flags</a>, <a class="el" href="msystem_8h_source.html#l00386">NET_COMMAND::header</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="camac_8c_source.html#l00506">n</a>, <a class="el" href="msystem_8h_source.html#l00257">NET_BUFFER_SIZE</a>, <a class="el" href="mana_8cpp_source.html#l00657">param</a>, <a class="el" href="midas_8h_source.html#l01808">RPC_LIST::param</a>, <a class="el" href="msystem_8h_source.html#l00387">NET_COMMAND::param</a>, <a class="el" href="msystem_8h_source.html#l00382">NET_COMMAND_HEADER::param_size</a>, <a class="el" href="midas_8h_source.html#l00615">PTYPE</a>, <a class="el" href="mhttpd_8c_source.html#l00870">return_buffer</a>, <a class="el" href="msystem_8h_source.html#l00381">NET_COMMAND_HEADER::routine_id</a>, <a class="el" href="midas_8c_source.html#l08108">rpc_convert_data()</a>, <a class="el" href="midas_8c_source.html#l08079">rpc_convert_single()</a>, <a class="el" href="midas_8c_source.html#l09447">rpc_debug_printf()</a>, <a class="el" href="midas_8h_source.html#l01071">RPC_EXCEED_BUFFER</a>, <a class="el" href="mrpc_8h_source.html#l00203">RPC_ID_EXIT</a>, <a class="el" href="mrpc_8h_source.html#l00202">RPC_ID_SHUTDOWN</a>, <a class="el" href="mrpc_8h_source.html#l00201">RPC_ID_WATCHDOG</a>, <a class="el" href="midas_8h_source.html#l01781">RPC_IN</a>, <a class="el" href="midas_8h_source.html#l01074">RPC_INVALID_ID</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8h_source.html#l01782">RPC_OUT</a>, <a class="el" href="midas_8h_source.html#l01786">RPC_OUTGOING</a>, <a class="el" href="midas_8h_source.html#l01075">RPC_SHUTDOWN</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l01785">RPC_VARARRAY</a>, <a class="el" href="system_8c_source.html#l03606">send_tcp()</a>, <a class="el" href="midas_8h_source.html#l01047">SS_ABORT</a>, <a class="el" href="midas_8h_source.html#l01048">SS_EXIT</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="msystem_8h_source.html#l00397">TCP_FAST</a>, <a class="el" href="midas_8h_source.html#l01800">RPC_PARAM::tid</a>, <a class="el" href="midas_8h_source.html#l00740">TID_DWORD</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="midas_8h_source.html#l00750">TID_LINK</a>, <a class="el" href="midas_8c_source.html#l00749">tid_size</a>, <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>, and <a class="el" href="midas_8h_source.html#l00748">TID_STRUCT</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l12223">rpc_server_receive()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10993"></a>10993          : <a class="code" href="group__rpcfunctionc.html#gaaececfb5cc7b4e302cc4f31dae7f773b">rpc_execute</a>
<a name="l10994"></a>10994 
<a name="l10995"></a>10995   Purpose: Execute a RPC command received over the network
<a name="l10996"></a>10996 
<a name="l10997"></a>10997   Input:
<a name="l10998"></a>10998     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>  sock               TCP socket to which the result should be
<a name="l10999"></a>10999                             <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a> back
<a name="l11000"></a>11000 
<a name="l11001"></a>11001     <span class="keywordtype">char</span> *<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>            Command <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l11002"></a>11002     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>  convert_flags      Flags <span class="keywordflow">for</span> <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a> conversion
<a name="l11003"></a>11003 
<a name="l11004"></a>11004   Output:
<a name="l11005"></a>11005     none
<a name="l11006"></a>11006 
<a name="l11007"></a>11007   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l11008"></a>11008     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l11009"></a>11009     <a class="code" href="group__err25.html#ga3cbff68ac5b5d52f692b8e880f9ef76c">RPC_INVALID_ID</a>          Invalid routine_id received
<a name="l11010"></a>11010     <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>           Error <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> socket <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a>
<a name="l11011"></a>11011     <a class="code" href="group__err25.html#ga1a35d5e05d16d9040eaad41c4434a20a">RPC_EXCEED_BUFFER</a>       Not enough memory <span class="keywordflow">for</span> network <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l11012"></a>11012     <a class="code" href="group__err25.html#ga0406ee07e8c5afbf8e46cb0eed698bcd">RPC_SHUTDOWN</a>            Shutdown requested
<a name="l11013"></a>11013     <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a>                TCP connection broken
<a name="l11014"></a>11014     <a class="code" href="group__err24.html#ga8bdfd6ab89f9628d57174f8a4287bf9f">SS_EXIT</a>                 TCP connection closed
<a name="l11015"></a>11015 
<a name="l11016"></a>11016 \********************************************************************/
<a name="l11017"></a>11017 {
<a name="l11018"></a>11018    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, routine_id, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l11019"></a>11019    <span class="keywordtype">char</span> *in_param_ptr, *out_param_ptr, *last_param_ptr;
<a name="l11020"></a>11020    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> tid, flags;
<a name="l11021"></a>11021    <a class="code" href="structNET__COMMAND.html">NET_COMMAND</a> *nc_in, *nc_out;
<a name="l11022"></a>11022    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> param_size, max_size;
<a name="l11023"></a>11023    <span class="keywordtype">void</span> *prpc_param[20];
<a name="l11024"></a>11024    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[1024], debug_line[1024];
<a name="l11025"></a>11025 
<a name="l11026"></a>11026 <span class="comment">/* return buffer must be auto for multi-thread servers */</span>
<a name="l11027"></a>11027    <span class="keywordtype">char</span> <a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>[<a class="code" href="group__msystemincludecode.html#ga7554d698d310e57e1c933a8f952a4bf8">NET_BUFFER_SIZE</a>];
<a name="l11028"></a>11028 
<a name="l11029"></a>11029 
<a name="l11030"></a>11030    <span class="comment">/* extract pointer array to parameters */</span>
<a name="l11031"></a>11031    nc_in = (<a class="code" href="structNET__COMMAND.html">NET_COMMAND</a> *) <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>;
<a name="l11032"></a>11032    nc_out = (<a class="code" href="structNET__COMMAND.html">NET_COMMAND</a> *) return_buffer;
<a name="l11033"></a>11033 
<a name="l11034"></a>11034    <span class="comment">/* convert header format (byte swapping) */</span>
<a name="l11035"></a>11035    <span class="keywordflow">if</span> (convert_flags) {
<a name="l11036"></a>11036       <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(&amp;nc_in-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#a9805c951be630cb91f6cf5e5fd8a34f4">routine_id</a>, <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a>, 0, convert_flags);
<a name="l11037"></a>11037       <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(&amp;nc_in-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#ae0c91723d3f4843639e659ccde63dc5a">param_size</a>, <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a>, 0, convert_flags);
<a name="l11038"></a>11038    }
<a name="l11039"></a>11039 
<a name="l11040"></a>11040    <span class="comment">/* no result return in FAST TCP mode */</span>
<a name="l11041"></a>11041    <span class="keywordflow">if</span> (nc_in-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#a9805c951be630cb91f6cf5e5fd8a34f4">routine_id</a> &amp; <a class="code" href="group__msystemincludecode.html#gaf6ab4dadaddd91351342b1e81f73dedb">TCP_FAST</a>)
<a name="l11042"></a>11042       sock = 0;
<a name="l11043"></a>11043 
<a name="l11044"></a>11044    <span class="comment">/* find entry in rpc_list */</span>
<a name="l11045"></a>11045    routine_id = nc_in-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#a9805c951be630cb91f6cf5e5fd8a34f4">routine_id</a> &amp; ~<a class="code" href="group__msystemincludecode.html#gaf6ab4dadaddd91351342b1e81f73dedb">TCP_FAST</a>;
<a name="l11046"></a>11046 
<a name="l11047"></a>11047    <span class="keywordflow">for</span> (i = 0;; i++)
<a name="l11048"></a>11048       <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].<span class="keywordtype">id</span> == 0 || <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].<span class="keywordtype">id</span> == routine_id)
<a name="l11049"></a>11049          <span class="keywordflow">break</span>;
<a name="l11050"></a>11050    index = i;
<a name="l11051"></a>11051    <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].<span class="keywordtype">id</span> == 0) {
<a name="l11052"></a>11052       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_execute&quot;</span>, <span class="stringliteral">&quot;Invalid rpc ID (%d)&quot;</span>, routine_id);
<a name="l11053"></a>11053       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga3cbff68ac5b5d52f692b8e880f9ef76c">RPC_INVALID_ID</a>;
<a name="l11054"></a>11054    }
<a name="l11055"></a>11055 
<a name="l11056"></a>11056    in_param_ptr = nc_in-&gt;<a class="code" href="structNET__COMMAND.html#a53f81d5350a50df99246d335dd703c63">param</a>;
<a name="l11057"></a>11057    out_param_ptr = nc_out-&gt;<a class="code" href="structNET__COMMAND.html#a53f81d5350a50df99246d335dd703c63">param</a>;
<a name="l11058"></a>11058 
<a name="l11059"></a>11059    sprintf(debug_line, <span class="stringliteral">&quot;%s(&quot;</span>, <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>);
<a name="l11060"></a>11060 
<a name="l11061"></a>11061    <span class="keywordflow">for</span> (i = 0; <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="group__midasincludecode.html#ga9293ae60144cf99d2f5c8e4eaa30e3b0">param</a>[i].<a class="code" href="structRPC__PARAM.html#a7c0b23cc9ea8ef88c56b8ebcc2760be0">tid</a> != 0; i++) {
<a name="l11062"></a>11062       tid = <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="group__midasincludecode.html#ga9293ae60144cf99d2f5c8e4eaa30e3b0">param</a>[i].<a class="code" href="structRPC__PARAM.html#a7c0b23cc9ea8ef88c56b8ebcc2760be0">tid</a>;
<a name="l11063"></a>11063       flags = <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="group__midasincludecode.html#ga9293ae60144cf99d2f5c8e4eaa30e3b0">param</a>[i].<a class="code" href="group__midasincludecode.html#ga48fa8602fcb035305d1b87cf15354c2e">flags</a>;
<a name="l11064"></a>11064 
<a name="l11065"></a>11065       <span class="keywordflow">if</span> (flags &amp; <a class="code" href="group__msectionh.html#ga26dfdb889f7bda38d3ad2336b4ff16ee">RPC_IN</a>) {
<a name="l11066"></a>11066          param_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(<a class="code" href="group__midasincludecode.html#ga97cc1898bd6240261b5418bcab5a6d35">tid_size</a>[tid]);
<a name="l11067"></a>11067 
<a name="l11068"></a>11068          <span class="keywordflow">if</span> (tid == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a> || tid == <a class="code" href="group__mdefineh.html#gaa63f41f547c7f46f828aaf35073807ea">TID_LINK</a>)
<a name="l11069"></a>11069             param_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(1 + strlen((<span class="keywordtype">char</span> *) (in_param_ptr)));
<a name="l11070"></a>11070 
<a name="l11071"></a>11071          <span class="keywordflow">if</span> (flags &amp; <a class="code" href="group__msectionh.html#gac8fee151706080dfb104b55cbf0088b9">RPC_VARARRAY</a>) {
<a name="l11072"></a>11072             <span class="comment">/* for arrays, the size is stored as a INT in front of the array */</span>
<a name="l11073"></a>11073             param_size = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) in_param_ptr);
<a name="l11074"></a>11074             <span class="keywordflow">if</span> (convert_flags)
<a name="l11075"></a>11075                <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(&amp;param_size, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, 0, convert_flags);
<a name="l11076"></a>11076             param_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(param_size);
<a name="l11077"></a>11077 
<a name="l11078"></a>11078             in_param_ptr += <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(<span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>));
<a name="l11079"></a>11079          }
<a name="l11080"></a>11080 
<a name="l11081"></a>11081          <span class="keywordflow">if</span> (tid == <a class="code" href="group__mdefineh.html#ga8d82076a05b53876103e1c53d5878b75">TID_STRUCT</a>)
<a name="l11082"></a>11082             param_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i].<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l11083"></a>11083 
<a name="l11084"></a>11084          prpc_param[i] = in_param_ptr;
<a name="l11085"></a>11085 
<a name="l11086"></a>11086          <span class="comment">/* convert data format */</span>
<a name="l11087"></a>11087          <span class="keywordflow">if</span> (convert_flags) {
<a name="l11088"></a>11088             <span class="keywordflow">if</span> (flags &amp; RPC_VARARRAY)
<a name="l11089"></a>11089                <a class="code" href="group__msectionh.html#ga7cd1812fd2e76dcc55f736d22be9726c">rpc_convert_data</a>(in_param_ptr, tid, flags, param_size, convert_flags);
<a name="l11090"></a>11090             <span class="keywordflow">else</span>
<a name="l11091"></a>11091                <a class="code" href="group__msectionh.html#ga7cd1812fd2e76dcc55f736d22be9726c">rpc_convert_data</a>(in_param_ptr, tid, flags,
<a name="l11092"></a>11092                                 <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i].<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> * <a class="code" href="group__midasincludecode.html#ga97cc1898bd6240261b5418bcab5a6d35">tid_size</a>[tid],
<a name="l11093"></a>11093                                 convert_flags);
<a name="l11094"></a>11094          }
<a name="l11095"></a>11095 
<a name="l11096"></a>11096          <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(str, in_param_ptr, param_size, 0, <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i].tid);
<a name="l11097"></a>11097          <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i].tid == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>) {
<a name="l11098"></a>11098             <span class="comment">/* check for long strings (db_create_record...) */</span>
<a name="l11099"></a>11099             <span class="keywordflow">if</span> (strlen(debug_line) + strlen(str) + 2 &lt; <span class="keyword">sizeof</span>(debug_line)) {
<a name="l11100"></a>11100                strcat(debug_line, <span class="stringliteral">&quot;\&quot;&quot;</span>);
<a name="l11101"></a>11101                strcat(debug_line, str);
<a name="l11102"></a>11102                strcat(debug_line, <span class="stringliteral">&quot;\&quot;&quot;</span>);
<a name="l11103"></a>11103             } <span class="keywordflow">else</span>
<a name="l11104"></a>11104                strcat(debug_line, <span class="stringliteral">&quot;...&quot;</span>);
<a name="l11105"></a>11105          } <span class="keywordflow">else</span>
<a name="l11106"></a>11106             strcat(debug_line, str);
<a name="l11107"></a>11107 
<a name="l11108"></a>11108          in_param_ptr += param_size;
<a name="l11109"></a>11109       }
<a name="l11110"></a>11110 
<a name="l11111"></a>11111       <span class="keywordflow">if</span> (flags &amp; <a class="code" href="group__msectionh.html#ga1cc93d6c9309b897244079eb8630ab23">RPC_OUT</a>) {
<a name="l11112"></a>11112          param_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(<a class="code" href="group__midasincludecode.html#ga97cc1898bd6240261b5418bcab5a6d35">tid_size</a>[tid]);
<a name="l11113"></a>11113 
<a name="l11114"></a>11114          <span class="keywordflow">if</span> (flags &amp; RPC_VARARRAY || tid == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>) {
<a name="l11115"></a>11115             <span class="comment">/* save maximum array length */</span>
<a name="l11116"></a>11116             max_size = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) in_param_ptr);
<a name="l11117"></a>11117             <span class="keywordflow">if</span> (convert_flags)
<a name="l11118"></a>11118                <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(&amp;max_size, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, 0, convert_flags);
<a name="l11119"></a>11119             max_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(max_size);
<a name="l11120"></a>11120 
<a name="l11121"></a>11121             *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) out_param_ptr) = max_size;
<a name="l11122"></a>11122 
<a name="l11123"></a>11123             <span class="comment">/* save space for return array length */</span>
<a name="l11124"></a>11124             out_param_ptr += <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(<span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>));
<a name="l11125"></a>11125 
<a name="l11126"></a>11126             <span class="comment">/* use maximum array length from input */</span>
<a name="l11127"></a>11127             param_size += max_size;
<a name="l11128"></a>11128          }
<a name="l11129"></a>11129 
<a name="l11130"></a>11130          <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i].tid == <a class="code" href="group__mdefineh.html#ga8d82076a05b53876103e1c53d5878b75">TID_STRUCT</a>)
<a name="l11131"></a>11131             param_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i].<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l11132"></a>11132 
<a name="l11133"></a>11133          <span class="keywordflow">if</span> ((<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) out_param_ptr - (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) nc_out + param_size &gt; <a class="code" href="group__msystemincludecode.html#ga7554d698d310e57e1c933a8f952a4bf8">NET_BUFFER_SIZE</a>) {
<a name="l11134"></a>11134             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_execute&quot;</span>,
<a name="l11135"></a>11135                    <span class="stringliteral">&quot;return parameters (%d) too large for network buffer (%d)&quot;</span>,
<a name="l11136"></a>11136                    (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) out_param_ptr - (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) nc_out + param_size, <a class="code" href="group__msystemincludecode.html#ga7554d698d310e57e1c933a8f952a4bf8">NET_BUFFER_SIZE</a>);
<a name="l11137"></a>11137             <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga1a35d5e05d16d9040eaad41c4434a20a">RPC_EXCEED_BUFFER</a>;
<a name="l11138"></a>11138          }
<a name="l11139"></a>11139 
<a name="l11140"></a>11140          <span class="comment">/* if parameter goes both directions, copy input to output */</span>
<a name="l11141"></a>11141          <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i].flags &amp; RPC_IN)
<a name="l11142"></a>11142             memcpy(out_param_ptr, prpc_param[i], param_size);
<a name="l11143"></a>11143 
<a name="l11144"></a>11144          <span class="keywordflow">if</span> (<a class="code" href="group__midasincludecode.html#ga61a5bec512ad6edef8384e4853a0eded">_debug_print</a> &amp;&amp; !(flags &amp; RPC_IN))
<a name="l11145"></a>11145             strcat(debug_line, <span class="stringliteral">&quot;-&quot;</span>);
<a name="l11146"></a>11146 
<a name="l11147"></a>11147          prpc_param[i] = out_param_ptr;
<a name="l11148"></a>11148          out_param_ptr += param_size;
<a name="l11149"></a>11149       }
<a name="l11150"></a>11150 
<a name="l11151"></a>11151       <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i + 1].tid)
<a name="l11152"></a>11152          strcat(debug_line, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l11153"></a>11153    }
<a name="l11154"></a>11154 
<a name="l11155"></a>11155    strcat(debug_line, <span class="stringliteral">&quot;)&quot;</span>);
<a name="l11156"></a>11156    <a class="code" href="group__msectionh.html#ga5122c91743605847f8368e17758dedbf">rpc_debug_printf</a>(debug_line);
<a name="l11157"></a>11157 
<a name="l11158"></a>11158    last_param_ptr = out_param_ptr;
<a name="l11159"></a>11159 
<a name="l11160"></a>11160   <span class="comment">/*********************************\</span>
<a name="l11161"></a>11161 <span class="comment">  *   call dispatch function        *</span>
<a name="l11162"></a>11162 <span class="comment">  \*********************************/</span>
<a name="l11163"></a>11163    <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].dispatch)
<a name="l11164"></a>11164       status = <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="group__midasincludecode.html#gafdeeebdd58f83be10273ff95c6181462">dispatch</a>(routine_id, prpc_param);
<a name="l11165"></a>11165    <span class="keywordflow">else</span>
<a name="l11166"></a>11166       status = <a class="code" href="group__err25.html#ga3cbff68ac5b5d52f692b8e880f9ef76c">RPC_INVALID_ID</a>;
<a name="l11167"></a>11167 
<a name="l11168"></a>11168    <span class="keywordflow">if</span> (routine_id == <a class="code" href="group__mrpcdefineh.html#ga4fecef60778fda08ca026eaad345eca2">RPC_ID_EXIT</a> || routine_id == <a class="code" href="group__mrpcdefineh.html#ga758695700ff26f404eec79ecbeab4947">RPC_ID_SHUTDOWN</a> ||
<a name="l11169"></a>11169        routine_id == <a class="code" href="group__mrpcdefineh.html#ga3871ac0ea0fbdba943cb70c7cfad6780">RPC_ID_WATCHDOG</a>)
<a name="l11170"></a>11170       status = <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l11171"></a>11171 
<a name="l11172"></a>11172    <span class="comment">/* return immediately for closed down client connections */</span>
<a name="l11173"></a>11173    <span class="keywordflow">if</span> (!sock &amp;&amp; routine_id == <a class="code" href="group__mrpcdefineh.html#ga4fecef60778fda08ca026eaad345eca2">RPC_ID_EXIT</a>)
<a name="l11174"></a>11174       <span class="keywordflow">return</span> <a class="code" href="group__err24.html#ga8bdfd6ab89f9628d57174f8a4287bf9f">SS_EXIT</a>;
<a name="l11175"></a>11175 
<a name="l11176"></a>11176    <span class="keywordflow">if</span> (!sock &amp;&amp; routine_id == <a class="code" href="group__mrpcdefineh.html#ga758695700ff26f404eec79ecbeab4947">RPC_ID_SHUTDOWN</a>)
<a name="l11177"></a>11177       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga0406ee07e8c5afbf8e46cb0eed698bcd">RPC_SHUTDOWN</a>;
<a name="l11178"></a>11178 
<a name="l11179"></a>11179    <span class="comment">/* Return if TCP connection broken */</span>
<a name="l11180"></a>11180    <span class="keywordflow">if</span> (status == <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a>)
<a name="l11181"></a>11181       <span class="keywordflow">return</span> <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a>;
<a name="l11182"></a>11182 
<a name="l11183"></a>11183    <span class="comment">/* if sock == 0, we are in FTCP mode and may not sent results */</span>
<a name="l11184"></a>11184    <span class="keywordflow">if</span> (!sock)
<a name="l11185"></a>11185       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l11186"></a>11186 
<a name="l11187"></a>11187    <span class="comment">/* compress variable length arrays */</span>
<a name="l11188"></a>11188    out_param_ptr = nc_out-&gt;<a class="code" href="structNET__COMMAND.html#a53f81d5350a50df99246d335dd703c63">param</a>;
<a name="l11189"></a>11189    <span class="keywordflow">for</span> (i = 0; <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="group__midasincludecode.html#ga9293ae60144cf99d2f5c8e4eaa30e3b0">param</a>[i].<a class="code" href="structRPC__PARAM.html#a7c0b23cc9ea8ef88c56b8ebcc2760be0">tid</a> != 0; i++)
<a name="l11190"></a>11190       <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i].flags &amp; RPC_OUT) {
<a name="l11191"></a>11191          tid = <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="group__midasincludecode.html#ga9293ae60144cf99d2f5c8e4eaa30e3b0">param</a>[i].<a class="code" href="structRPC__PARAM.html#a7c0b23cc9ea8ef88c56b8ebcc2760be0">tid</a>;
<a name="l11192"></a>11192          flags = <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="group__midasincludecode.html#ga9293ae60144cf99d2f5c8e4eaa30e3b0">param</a>[i].<a class="code" href="group__midasincludecode.html#ga48fa8602fcb035305d1b87cf15354c2e">flags</a>;
<a name="l11193"></a>11193          param_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(<a class="code" href="group__midasincludecode.html#ga97cc1898bd6240261b5418bcab5a6d35">tid_size</a>[tid]);
<a name="l11194"></a>11194 
<a name="l11195"></a>11195          <span class="keywordflow">if</span> (tid == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>) {
<a name="l11196"></a>11196             max_size = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) out_param_ptr);
<a name="l11197"></a>11197             param_size = strlen((<span class="keywordtype">char</span> *) prpc_param[i]) + 1;
<a name="l11198"></a>11198             param_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(param_size);
<a name="l11199"></a>11199 
<a name="l11200"></a>11200             <span class="comment">/* move string ALIGN8(sizeof(INT)) left */</span>
<a name="l11201"></a>11201             memcpy(out_param_ptr, out_param_ptr + <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(<span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>)), param_size);
<a name="l11202"></a>11202 
<a name="l11203"></a>11203             <span class="comment">/* move remaining parameters to end of string */</span>
<a name="l11204"></a>11204             memcpy(out_param_ptr + param_size,
<a name="l11205"></a>11205                    out_param_ptr + max_size + <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(<span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>)),
<a name="l11206"></a>11206                    (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) last_param_ptr -
<a name="l11207"></a>11207                    ((<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) out_param_ptr + max_size + <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(<span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>))));
<a name="l11208"></a>11208          }
<a name="l11209"></a>11209 
<a name="l11210"></a>11210          <span class="keywordflow">if</span> (flags &amp; RPC_VARARRAY) {
<a name="l11211"></a>11211             <span class="comment">/* store array length at current out_param_ptr */</span>
<a name="l11212"></a>11212             max_size = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) out_param_ptr);
<a name="l11213"></a>11213             param_size = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) prpc_param[i + 1]);
<a name="l11214"></a>11214             *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) out_param_ptr) = param_size;
<a name="l11215"></a>11215             <span class="keywordflow">if</span> (convert_flags)
<a name="l11216"></a>11216                <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(out_param_ptr, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, <a class="code" href="group__msectionh.html#ga5cf5e72e7cdd75567b08ef7b3bd9e182">RPC_OUTGOING</a>, convert_flags);
<a name="l11217"></a>11217 
<a name="l11218"></a>11218             out_param_ptr += <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(<span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>));
<a name="l11219"></a>11219 
<a name="l11220"></a>11220             param_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(param_size);
<a name="l11221"></a>11221 
<a name="l11222"></a>11222             <span class="comment">/* move remaining parameters to end of array */</span>
<a name="l11223"></a>11223             memcpy(out_param_ptr + param_size,
<a name="l11224"></a>11224                    out_param_ptr + max_size + <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(<span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>)),
<a name="l11225"></a>11225                    (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) last_param_ptr -
<a name="l11226"></a>11226                    ((<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) out_param_ptr + max_size + <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(<span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>))));
<a name="l11227"></a>11227          }
<a name="l11228"></a>11228 
<a name="l11229"></a>11229          <span class="keywordflow">if</span> (tid == <a class="code" href="group__mdefineh.html#ga8d82076a05b53876103e1c53d5878b75">TID_STRUCT</a>)
<a name="l11230"></a>11230             param_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i].<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l11231"></a>11231 
<a name="l11232"></a>11232          <span class="comment">/* convert data format */</span>
<a name="l11233"></a>11233          <span class="keywordflow">if</span> (convert_flags) {
<a name="l11234"></a>11234             <span class="keywordflow">if</span> (flags &amp; RPC_VARARRAY)
<a name="l11235"></a>11235                <a class="code" href="group__msectionh.html#ga7cd1812fd2e76dcc55f736d22be9726c">rpc_convert_data</a>(out_param_ptr, tid,
<a name="l11236"></a>11236                                 <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i].flags | <a class="code" href="group__msectionh.html#ga5cf5e72e7cdd75567b08ef7b3bd9e182">RPC_OUTGOING</a>,
<a name="l11237"></a>11237                                 param_size, convert_flags);
<a name="l11238"></a>11238             <span class="keywordflow">else</span>
<a name="l11239"></a>11239                <a class="code" href="group__msectionh.html#ga7cd1812fd2e76dcc55f736d22be9726c">rpc_convert_data</a>(out_param_ptr, tid,
<a name="l11240"></a>11240                                 <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i].flags | <a class="code" href="group__msectionh.html#ga5cf5e72e7cdd75567b08ef7b3bd9e182">RPC_OUTGOING</a>,
<a name="l11241"></a>11241                                 <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i].<a class="code" href="camac_8c.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> * <a class="code" href="group__midasincludecode.html#ga97cc1898bd6240261b5418bcab5a6d35">tid_size</a>[tid],
<a name="l11242"></a>11242                                 convert_flags);
<a name="l11243"></a>11243          }
<a name="l11244"></a>11244 
<a name="l11245"></a>11245          out_param_ptr += param_size;
<a name="l11246"></a>11246       }
<a name="l11247"></a>11247 
<a name="l11248"></a>11248    <span class="comment">/* send return parameters */</span>
<a name="l11249"></a>11249    param_size = (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) out_param_ptr - (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) nc_out-&gt;<a class="code" href="structNET__COMMAND.html#a53f81d5350a50df99246d335dd703c63">param</a>;
<a name="l11250"></a>11250    nc_out-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#a9805c951be630cb91f6cf5e5fd8a34f4">routine_id</a> = status;
<a name="l11251"></a>11251    nc_out-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#ae0c91723d3f4843639e659ccde63dc5a">param_size</a> = param_size;
<a name="l11252"></a>11252 
<a name="l11253"></a>11253    <span class="comment">/* convert header format (byte swapping) if necessary */</span>
<a name="l11254"></a>11254    <span class="keywordflow">if</span> (convert_flags) {
<a name="l11255"></a>11255       <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(&amp;nc_out-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#a9805c951be630cb91f6cf5e5fd8a34f4">routine_id</a>, <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a>,
<a name="l11256"></a>11256                          <a class="code" href="group__msectionh.html#ga5cf5e72e7cdd75567b08ef7b3bd9e182">RPC_OUTGOING</a>, convert_flags);
<a name="l11257"></a>11257       <a class="code" href="group__msectionh.html#ga60b1a9cab1bd119ceb94ff84159cedd9">rpc_convert_single</a>(&amp;nc_out-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#ae0c91723d3f4843639e659ccde63dc5a">param_size</a>, <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a>,
<a name="l11258"></a>11258                          <a class="code" href="group__msectionh.html#ga5cf5e72e7cdd75567b08ef7b3bd9e182">RPC_OUTGOING</a>, convert_flags);
<a name="l11259"></a>11259    }
<a name="l11260"></a>11260 
<a name="l11261"></a>11261    status = <a class="code" href="group__msystemincludecode.html#gae657f73f38c098645aab383053478d59">send_tcp</a>(sock, return_buffer, <span class="keyword">sizeof</span>(<a class="code" href="structNET__COMMAND__HEADER.html">NET_COMMAND_HEADER</a>) + param_size, 0);
<a name="l11262"></a>11262 
<a name="l11263"></a>11263    <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l11264"></a>11264       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_execute&quot;</span>, <span class="stringliteral">&quot;send_tcp() failed&quot;</span>);
<a name="l11265"></a>11265       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l11266"></a>11266    }
<a name="l11267"></a>11267 
<a name="l11268"></a>11268    <span class="comment">/* print return buffer */</span>
<a name="l11269"></a>11269 <span class="comment">/*</span>
<a name="l11270"></a>11270 <span class="comment">  printf(&quot;Return buffer, ID %d:\n&quot;, routine_id);</span>
<a name="l11271"></a>11271 <span class="comment">  for (i=0; i&lt;param_size ; i++)</span>
<a name="l11272"></a>11272 <span class="comment">    {</span>
<a name="l11273"></a>11273 <span class="comment">    status = (char) nc_out-&gt;param[i];</span>
<a name="l11274"></a>11274 <span class="comment">    printf(&quot;%02X &quot;, status);</span>
<a name="l11275"></a>11275 <span class="comment">    if (i%8 == 7)</span>
<a name="l11276"></a>11276 <span class="comment">      printf(&quot;\n&quot;);</span>
<a name="l11277"></a>11277 <span class="comment">    }</span>
<a name="l11278"></a>11278 <span class="comment">*/</span>
<a name="l11279"></a>11279    <span class="comment">/* return SS_EXIT if RPC_EXIT is called */</span>
<a name="l11280"></a>11280    <span class="keywordflow">if</span> (routine_id == <a class="code" href="group__mrpcdefineh.html#ga4fecef60778fda08ca026eaad345eca2">RPC_ID_EXIT</a>)
<a name="l11281"></a>11281       <span class="keywordflow">return</span> <a class="code" href="group__err24.html#ga8bdfd6ab89f9628d57174f8a4287bf9f">SS_EXIT</a>;
<a name="l11282"></a>11282 
<a name="l11283"></a>11283    <span class="comment">/* return SS_SHUTDOWN if RPC_SHUTDOWN is called */</span>
<a name="l11284"></a>11284    <span class="keywordflow">if</span> (routine_id == <a class="code" href="group__mrpcdefineh.html#ga758695700ff26f404eec79ecbeab4947">RPC_ID_SHUTDOWN</a>)
<a name="l11285"></a>11285       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga0406ee07e8c5afbf8e46cb0eed698bcd">RPC_SHUTDOWN</a>;
<a name="l11286"></a>11286 
<a name="l11287"></a>11287    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l11288"></a>11288 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga30e35c5ffd03eb5084e63e04b50e3d60"></a><!-- doxytag: member="midas.c::rpc_execute_ascii" ref="ga30e35c5ffd03eb5084e63e04b50e3d60" args="(INT sock, char *buffer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_execute_ascii </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buffer</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l11292">11292</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l00904">ALIGN8</a>, <a class="el" href="midas_8c.html#a9a7b43f14b607e2520fc8a36f22543ec">ASCII_BUFFER_SIZE</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="odb_8c_source.html#l06308">db_sprintf()</a>, <a class="el" href="odb_8c_source.html#l06435">db_sscanf()</a>, <a class="el" href="group__midasincludecode.html#gafdeeebdd58f83be10273ff95c6181462">RPC_LIST::dispatch</a>, <a class="el" href="midas_8h_source.html#l01801">RPC_PARAM::flags</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="midas_8h_source.html#l01806">RPC_LIST::id</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8c.html#a9583702e3b4ce3104af6a280a92acfca">N_APARAM</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="mana_8cpp_source.html#l00657">param</a>, <a class="el" href="midas_8h_source.html#l01808">RPC_LIST::param</a>, <a class="el" href="midas_8h_source.html#l00615">PTYPE</a>, <a class="el" href="mhttpd_8c_source.html#l00870">return_buffer</a>, <a class="el" href="mrpc_8h_source.html#l00127">RPC_BM_RECEIVE_EVENT</a>, <a class="el" href="mrpc_8h_source.html#l00167">RPC_DB_GET_DATA1</a>, <a class="el" href="mrpc_8h_source.html#l00161">RPC_DB_GET_DATA_INDEX</a>, <a class="el" href="midas_8c_source.html#l09447">rpc_debug_printf()</a>, <a class="el" href="midas_8h_source.html#l01071">RPC_EXCEED_BUFFER</a>, <a class="el" href="mrpc_8h_source.html#l00179">RPC_HS_READ</a>, <a class="el" href="mrpc_8h_source.html#l00203">RPC_ID_EXIT</a>, <a class="el" href="mrpc_8h_source.html#l00202">RPC_ID_SHUTDOWN</a>, <a class="el" href="mrpc_8h_source.html#l00201">RPC_ID_WATCHDOG</a>, <a class="el" href="midas_8h_source.html#l01781">RPC_IN</a>, <a class="el" href="midas_8h_source.html#l01074">RPC_INVALID_ID</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8h_source.html#l01782">RPC_OUT</a>, <a class="el" href="midas_8h_source.html#l01075">RPC_SHUTDOWN</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l01785">RPC_VARARRAY</a>, <a class="el" href="system_8c_source.html#l03606">send_tcp()</a>, <a class="el" href="midas_8h_source.html#l01047">SS_ABORT</a>, <a class="el" href="midas_8h_source.html#l01048">SS_EXIT</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="midas_8h_source.html#l01800">RPC_PARAM::tid</a>, <a class="el" href="midas_8h_source.html#l00740">TID_DWORD</a>, <a class="el" href="midas_8h_source.html#l00750">TID_LINK</a>, <a class="el" href="midas_8c_source.html#l00749">tid_size</a>, and <a class="el" href="midas_8h_source.html#l00746">TID_STRING</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l12223">rpc_server_receive()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l11295"></a>11295          : <a class="code" href="group__rpcfunctionc.html#ga30e35c5ffd03eb5084e63e04b50e3d60">rpc_execute_ascii</a>
<a name="l11296"></a>11296 
<a name="l11297"></a>11297   Purpose: Execute a RPC command received over the network <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> ASCII
<a name="l11298"></a>11298            <a class="code" href="mscbutil_8c.html#a74b654271a172a244c844fb86277cd8a">mode</a>
<a name="l11299"></a>11299 
<a name="l11300"></a>11300   Input:
<a name="l11301"></a>11301     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>  sock               TCP socket to which the result should be
<a name="l11302"></a>11302                             <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a> back
<a name="l11303"></a>11303 
<a name="l11304"></a>11304     <span class="keywordtype">char</span> *<a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>            Command <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l11305"></a>11305 
<a name="l11306"></a>11306   Output:
<a name="l11307"></a>11307     none
<a name="l11308"></a>11308 
<a name="l11309"></a>11309   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l11310"></a>11310     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l11311"></a>11311     <a class="code" href="group__err25.html#ga3cbff68ac5b5d52f692b8e880f9ef76c">RPC_INVALID_ID</a>          Invalid routine_id received
<a name="l11312"></a>11312     <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>           Error <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> socket <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a>
<a name="l11313"></a>11313     <a class="code" href="group__err25.html#ga1a35d5e05d16d9040eaad41c4434a20a">RPC_EXCEED_BUFFER</a>       Not enough memory <span class="keywordflow">for</span> network <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l11314"></a>11314     <a class="code" href="group__err25.html#ga0406ee07e8c5afbf8e46cb0eed698bcd">RPC_SHUTDOWN</a>            Shutdown requested
<a name="l11315"></a>11315     <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a>                TCP connection broken
<a name="l11316"></a>11316     <a class="code" href="group__err24.html#ga8bdfd6ab89f9628d57174f8a4287bf9f">SS_EXIT</a>                 TCP connection closed
<a name="l11317"></a>11317 
<a name="l11318"></a>11318 \********************************************************************/
<a name="l11319"></a>11319 {
<a name="l11320"></a>11320 <span class="preprocessor">#define ASCII_BUFFER_SIZE 64500</span>
<a name="l11321"></a>11321 <span class="preprocessor"></span><span class="preprocessor">#define N_APARAM           1024</span>
<a name="l11322"></a>11322 <span class="preprocessor"></span>
<a name="l11323"></a>11323    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, index_in;
<a name="l11324"></a>11324    <span class="keywordtype">char</span> *in_param_ptr, *out_param_ptr, *last_param_ptr;
<a name="l11325"></a>11325    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> routine_id, tid, flags, array_tid, n_param;
<a name="l11326"></a>11326    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> param_size, item_size, num_values;
<a name="l11327"></a>11327    <span class="keywordtype">void</span> *prpc_param[20];
<a name="l11328"></a>11328    <span class="keywordtype">char</span> *arpc_param[<a class="code" href="midas_8c.html#a9583702e3b4ce3104af6a280a92acfca">N_APARAM</a>], *pc;
<a name="l11329"></a>11329    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[1024], debug_line[1024];
<a name="l11330"></a>11330    <span class="keywordtype">char</span> buffer1[<a class="code" href="midas_8c.html#a9a7b43f14b607e2520fc8a36f22543ec">ASCII_BUFFER_SIZE</a>];     <span class="comment">/* binary in */</span>
<a name="l11331"></a>11331    <span class="keywordtype">char</span> buffer2[<a class="code" href="midas_8c.html#a9a7b43f14b607e2520fc8a36f22543ec">ASCII_BUFFER_SIZE</a>];     <span class="comment">/* binary out */</span>
<a name="l11332"></a>11332    <span class="keywordtype">char</span> <a class="code" href="mhttpd_8c.html#a156f86e47f22882eb9855d44e63a464b">return_buffer</a>[<a class="code" href="midas_8c.html#a9a7b43f14b607e2520fc8a36f22543ec">ASCII_BUFFER_SIZE</a>];       <span class="comment">/* ASCII out */</span>
<a name="l11333"></a>11333 
<a name="l11334"></a>11334    <span class="comment">/* parse arguments */</span>
<a name="l11335"></a>11335    arpc_param[0] = <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>;
<a name="l11336"></a>11336    <span class="keywordflow">for</span> (i = 1; i &lt; <a class="code" href="midas_8c.html#a9583702e3b4ce3104af6a280a92acfca">N_APARAM</a>; i++) {
<a name="l11337"></a>11337       arpc_param[i] = strchr(arpc_param[i - 1], <span class="charliteral">&apos;&amp;&apos;</span>);
<a name="l11338"></a>11338       <span class="keywordflow">if</span> (arpc_param[i] == NULL)
<a name="l11339"></a>11339          <span class="keywordflow">break</span>;
<a name="l11340"></a>11340       *arpc_param[i] = 0;
<a name="l11341"></a>11341       arpc_param[i]++;
<a name="l11342"></a>11342    }
<a name="l11343"></a>11343 
<a name="l11344"></a>11344    <span class="comment">/* decode &apos;%&apos; */</span>
<a name="l11345"></a>11345    <span class="keywordflow">for</span> (i = 0; i &lt; N_APARAM &amp;&amp; arpc_param[i]; i++)
<a name="l11346"></a>11346       <span class="keywordflow">while</span> ((pc = strchr(arpc_param[i], <span class="charliteral">&apos;%&apos;</span>)) != NULL) {
<a name="l11347"></a>11347          <span class="keywordflow">if</span> (isxdigit(pc[1]) &amp;&amp; isxdigit(pc[2])) {
<a name="l11348"></a>11348             str[0] = pc[1];
<a name="l11349"></a>11349             str[1] = pc[2];
<a name="l11350"></a>11350             str[2] = 0;
<a name="l11351"></a>11351             sscanf(str, <span class="stringliteral">&quot;%02X&quot;</span>, &amp;i);
<a name="l11352"></a>11352 
<a name="l11353"></a>11353             *pc++ = i;
<a name="l11354"></a>11354             <span class="keywordflow">while</span> (pc[2]) {
<a name="l11355"></a>11355                pc[0] = pc[2];
<a name="l11356"></a>11356                pc++;
<a name="l11357"></a>11357             }
<a name="l11358"></a>11358          }
<a name="l11359"></a>11359       }
<a name="l11360"></a>11360 
<a name="l11361"></a>11361    <span class="comment">/* find entry in rpc_list */</span>
<a name="l11362"></a>11362    <span class="keywordflow">for</span> (i = 0;; i++)
<a name="l11363"></a>11363       <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].<span class="keywordtype">id</span> == 0 || strcmp(arpc_param[0], <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>) == 0)
<a name="l11364"></a>11364          <span class="keywordflow">break</span>;
<a name="l11365"></a>11365    index = i;
<a name="l11366"></a>11366    routine_id = <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].<a class="code" href="structRPC__LIST.html#a8d1379b84192a73bddbb9ed8e63b257a">id</a>;
<a name="l11367"></a>11367    <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].<span class="keywordtype">id</span> == 0) {
<a name="l11368"></a>11368       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_execute&quot;</span>, <span class="stringliteral">&quot;Invalid rpc name (%s)&quot;</span>, arpc_param[0]);
<a name="l11369"></a>11369       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga3cbff68ac5b5d52f692b8e880f9ef76c">RPC_INVALID_ID</a>;
<a name="l11370"></a>11370    }
<a name="l11371"></a>11371 
<a name="l11372"></a>11372    in_param_ptr = buffer1;
<a name="l11373"></a>11373    out_param_ptr = buffer2;
<a name="l11374"></a>11374    index_in = 1;
<a name="l11375"></a>11375 
<a name="l11376"></a>11376    sprintf(debug_line, <span class="stringliteral">&quot;%s(&quot;</span>, <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].name);
<a name="l11377"></a>11377 
<a name="l11378"></a>11378    <span class="keywordflow">for</span> (i = 0; <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="group__midasincludecode.html#ga9293ae60144cf99d2f5c8e4eaa30e3b0">param</a>[i].<a class="code" href="structRPC__PARAM.html#a7c0b23cc9ea8ef88c56b8ebcc2760be0">tid</a> != 0; i++) {
<a name="l11379"></a>11379       tid = <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="group__midasincludecode.html#ga9293ae60144cf99d2f5c8e4eaa30e3b0">param</a>[i].<a class="code" href="structRPC__PARAM.html#a7c0b23cc9ea8ef88c56b8ebcc2760be0">tid</a>;
<a name="l11380"></a>11380       flags = <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="group__midasincludecode.html#ga9293ae60144cf99d2f5c8e4eaa30e3b0">param</a>[i].<a class="code" href="group__midasincludecode.html#ga48fa8602fcb035305d1b87cf15354c2e">flags</a>;
<a name="l11381"></a>11381 
<a name="l11382"></a>11382       <span class="keywordflow">if</span> (flags &amp; <a class="code" href="group__msectionh.html#ga26dfdb889f7bda38d3ad2336b4ff16ee">RPC_IN</a>) {
<a name="l11383"></a>11383          <span class="keywordflow">if</span> (flags &amp; <a class="code" href="group__msectionh.html#gac8fee151706080dfb104b55cbf0088b9">RPC_VARARRAY</a>) {
<a name="l11384"></a>11384             sscanf(arpc_param[index_in++], <span class="stringliteral">&quot;%d %d&quot;</span>, &amp;n_param, &amp;array_tid);
<a name="l11385"></a>11385 
<a name="l11386"></a>11386             prpc_param[i] = in_param_ptr;
<a name="l11387"></a>11387             <span class="keywordflow">for</span> (j = 0; j &lt; n_param; j++) {
<a name="l11388"></a>11388                <a class="code" href="group__msectionh.html#ga7b3d26e7b258c093ad999bf1286bb871">db_sscanf</a>(arpc_param[index_in++], in_param_ptr, &amp;param_size, 0, array_tid);
<a name="l11389"></a>11389                in_param_ptr += param_size;
<a name="l11390"></a>11390             }
<a name="l11391"></a>11391             in_param_ptr = (<span class="keywordtype">char</span> *) <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(((<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) in_param_ptr));
<a name="l11392"></a>11392 
<a name="l11393"></a>11393             strcat(debug_line, <span class="stringliteral">&quot;&lt;array&gt;&quot;</span>);
<a name="l11394"></a>11394          } <span class="keywordflow">else</span> {
<a name="l11395"></a>11395             <a class="code" href="group__msectionh.html#ga7b3d26e7b258c093ad999bf1286bb871">db_sscanf</a>(arpc_param[index_in++], in_param_ptr, &amp;param_size, 0, tid);
<a name="l11396"></a>11396             param_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(param_size);
<a name="l11397"></a>11397 
<a name="l11398"></a>11398             <span class="keywordflow">if</span> (tid == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a> || tid == <a class="code" href="group__mdefineh.html#gaa63f41f547c7f46f828aaf35073807ea">TID_LINK</a>)
<a name="l11399"></a>11399                param_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(1 + strlen((<span class="keywordtype">char</span> *) (in_param_ptr)));
<a name="l11400"></a>11400 
<a name="l11401"></a>11401             <span class="comment">/*</span>
<a name="l11402"></a>11402 <span class="comment">               if (tid == TID_STRUCT)</span>
<a name="l11403"></a>11403 <span class="comment">               param_size = ALIGN8( rpc_list[index].param[i].n );</span>
<a name="l11404"></a>11404 <span class="comment">             */</span>
<a name="l11405"></a>11405             prpc_param[i] = in_param_ptr;
<a name="l11406"></a>11406 
<a name="l11407"></a>11407             <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(str, in_param_ptr, param_size, 0, <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i].tid);
<a name="l11408"></a>11408             <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i].tid == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>) {
<a name="l11409"></a>11409                <span class="comment">/* check for long strings (db_create_record...) */</span>
<a name="l11410"></a>11410                <span class="keywordflow">if</span> (strlen(debug_line) + strlen(str) + 2 &lt; <span class="keyword">sizeof</span>(debug_line)) {
<a name="l11411"></a>11411                   strcat(debug_line, <span class="stringliteral">&quot;\&quot;&quot;</span>);
<a name="l11412"></a>11412                   strcat(debug_line, str);
<a name="l11413"></a>11413                   strcat(debug_line, <span class="stringliteral">&quot;\&quot;&quot;</span>);
<a name="l11414"></a>11414                } <span class="keywordflow">else</span>
<a name="l11415"></a>11415                   strcat(debug_line, <span class="stringliteral">&quot;...&quot;</span>);
<a name="l11416"></a>11416             } <span class="keywordflow">else</span>
<a name="l11417"></a>11417                strcat(debug_line, str);
<a name="l11418"></a>11418 
<a name="l11419"></a>11419             in_param_ptr += param_size;
<a name="l11420"></a>11420          }
<a name="l11421"></a>11421 
<a name="l11422"></a>11422          <span class="keywordflow">if</span> ((<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) in_param_ptr - (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) buffer1 &gt; ASCII_BUFFER_SIZE) {
<a name="l11423"></a>11423             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_ascii_execute&quot;</span>,
<a name="l11424"></a>11424                    <span class="stringliteral">&quot;parameters (%d) too large for network buffer (%d)&quot;</span>, param_size,
<a name="l11425"></a>11425                    ASCII_BUFFER_SIZE);
<a name="l11426"></a>11426             <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga1a35d5e05d16d9040eaad41c4434a20a">RPC_EXCEED_BUFFER</a>;
<a name="l11427"></a>11427          }
<a name="l11428"></a>11428 
<a name="l11429"></a>11429       }
<a name="l11430"></a>11430 
<a name="l11431"></a>11431       <span class="keywordflow">if</span> (flags &amp; <a class="code" href="group__msectionh.html#ga1cc93d6c9309b897244079eb8630ab23">RPC_OUT</a>) {
<a name="l11432"></a>11432          param_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(<a class="code" href="group__midasincludecode.html#ga97cc1898bd6240261b5418bcab5a6d35">tid_size</a>[tid]);
<a name="l11433"></a>11433 
<a name="l11434"></a>11434          <span class="keywordflow">if</span> (flags &amp; RPC_VARARRAY || tid == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>) {
<a name="l11435"></a>11435             <span class="comment">/* reserve maximum array length */</span>
<a name="l11436"></a>11436             param_size = atoi(arpc_param[index_in]);
<a name="l11437"></a>11437             param_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(param_size);
<a name="l11438"></a>11438          }
<a name="l11439"></a>11439 
<a name="l11440"></a>11440 <span class="comment">/*</span>
<a name="l11441"></a>11441 <span class="comment">      if (rpc_list[index].param[i].tid == TID_STRUCT)</span>
<a name="l11442"></a>11442 <span class="comment">        param_size = ALIGN8( rpc_list[index].param[i].n );</span>
<a name="l11443"></a>11443 <span class="comment">*/</span>
<a name="l11444"></a>11444          <span class="keywordflow">if</span> ((<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) out_param_ptr - (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) buffer2 + param_size &gt; ASCII_BUFFER_SIZE) {
<a name="l11445"></a>11445             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_execute&quot;</span>,
<a name="l11446"></a>11446                    <span class="stringliteral">&quot;return parameters (%d) too large for network buffer (%d)&quot;</span>,
<a name="l11447"></a>11447                    (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) out_param_ptr - (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) buffer2 + param_size,
<a name="l11448"></a>11448                    ASCII_BUFFER_SIZE);
<a name="l11449"></a>11449             <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga1a35d5e05d16d9040eaad41c4434a20a">RPC_EXCEED_BUFFER</a>;
<a name="l11450"></a>11450          }
<a name="l11451"></a>11451 
<a name="l11452"></a>11452          <span class="comment">/* if parameter goes both directions, copy input to output */</span>
<a name="l11453"></a>11453          <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i].flags &amp; RPC_IN)
<a name="l11454"></a>11454             memcpy(out_param_ptr, prpc_param[i], param_size);
<a name="l11455"></a>11455 
<a name="l11456"></a>11456          <span class="keywordflow">if</span> (!(flags &amp; RPC_IN))
<a name="l11457"></a>11457             strcat(debug_line, <span class="stringliteral">&quot;-&quot;</span>);
<a name="l11458"></a>11458 
<a name="l11459"></a>11459          prpc_param[i] = out_param_ptr;
<a name="l11460"></a>11460          out_param_ptr += param_size;
<a name="l11461"></a>11461       }
<a name="l11462"></a>11462 
<a name="l11463"></a>11463       <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i + 1].tid)
<a name="l11464"></a>11464          strcat(debug_line, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l11465"></a>11465    }
<a name="l11466"></a>11466 
<a name="l11467"></a>11467    strcat(debug_line, <span class="stringliteral">&quot;)&quot;</span>);
<a name="l11468"></a>11468    <a class="code" href="group__msectionh.html#ga5122c91743605847f8368e17758dedbf">rpc_debug_printf</a>(debug_line);
<a name="l11469"></a>11469 
<a name="l11470"></a>11470    last_param_ptr = out_param_ptr;
<a name="l11471"></a>11471 
<a name="l11472"></a>11472    <span class="comment">/*********************************\</span>
<a name="l11473"></a>11473 <span class="comment">   *   call dispatch function        *</span>
<a name="l11474"></a>11474 <span class="comment">   \*********************************/</span>
<a name="l11475"></a>11475   
<a name="l11476"></a>11476    <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].dispatch)
<a name="l11477"></a>11477       status = <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="group__midasincludecode.html#gafdeeebdd58f83be10273ff95c6181462">dispatch</a>(routine_id, prpc_param);
<a name="l11478"></a>11478    <span class="keywordflow">else</span>
<a name="l11479"></a>11479       status = <a class="code" href="group__err25.html#ga3cbff68ac5b5d52f692b8e880f9ef76c">RPC_INVALID_ID</a>;
<a name="l11480"></a>11480 
<a name="l11481"></a>11481    <span class="keywordflow">if</span> (routine_id == <a class="code" href="group__mrpcdefineh.html#ga4fecef60778fda08ca026eaad345eca2">RPC_ID_EXIT</a> || routine_id == <a class="code" href="group__mrpcdefineh.html#ga758695700ff26f404eec79ecbeab4947">RPC_ID_SHUTDOWN</a> ||
<a name="l11482"></a>11482        routine_id == <a class="code" href="group__mrpcdefineh.html#ga3871ac0ea0fbdba943cb70c7cfad6780">RPC_ID_WATCHDOG</a>)
<a name="l11483"></a>11483       status = <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l11484"></a>11484 
<a name="l11485"></a>11485    <span class="comment">/* Return if TCP connection broken */</span>
<a name="l11486"></a>11486    <span class="keywordflow">if</span> (status == <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a>)
<a name="l11487"></a>11487       <span class="keywordflow">return</span> <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a>;
<a name="l11488"></a>11488 
<a name="l11489"></a>11489    <span class="comment">/* if sock == 0, we are in FTCP mode and may not sent results */</span>
<a name="l11490"></a>11490    <span class="keywordflow">if</span> (!sock)
<a name="l11491"></a>11491       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l11492"></a>11492 
<a name="l11493"></a>11493    <span class="comment">/* send return status */</span>
<a name="l11494"></a>11494    out_param_ptr = return_buffer;
<a name="l11495"></a>11495    sprintf(out_param_ptr, <span class="stringliteral">&quot;%d&quot;</span>, status);
<a name="l11496"></a>11496    out_param_ptr += strlen(out_param_ptr);
<a name="l11497"></a>11497 
<a name="l11498"></a>11498    <span class="comment">/* convert return parameters */</span>
<a name="l11499"></a>11499    <span class="keywordflow">for</span> (i = 0; <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="group__midasincludecode.html#ga9293ae60144cf99d2f5c8e4eaa30e3b0">param</a>[i].<a class="code" href="structRPC__PARAM.html#a7c0b23cc9ea8ef88c56b8ebcc2760be0">tid</a> != 0; i++)
<a name="l11500"></a>11500       <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="mana_8cpp.html#a6dadda9a6f1103026d1d128fe203aa9a">param</a>[i].flags &amp; RPC_OUT) {
<a name="l11501"></a>11501          *out_param_ptr++ = <span class="charliteral">&apos;&amp;&apos;</span>;
<a name="l11502"></a>11502 
<a name="l11503"></a>11503          tid = <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="group__midasincludecode.html#ga9293ae60144cf99d2f5c8e4eaa30e3b0">param</a>[i].<a class="code" href="structRPC__PARAM.html#a7c0b23cc9ea8ef88c56b8ebcc2760be0">tid</a>;
<a name="l11504"></a>11504          flags = <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<a class="code" href="group__midasincludecode.html#ga9293ae60144cf99d2f5c8e4eaa30e3b0">param</a>[i].<a class="code" href="group__midasincludecode.html#ga48fa8602fcb035305d1b87cf15354c2e">flags</a>;
<a name="l11505"></a>11505          param_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(<a class="code" href="group__midasincludecode.html#ga97cc1898bd6240261b5418bcab5a6d35">tid_size</a>[tid]);
<a name="l11506"></a>11506 
<a name="l11507"></a>11507          <span class="keywordflow">if</span> (tid == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a> &amp;&amp; !(flags &amp; RPC_VARARRAY)) {
<a name="l11508"></a>11508             strcpy(out_param_ptr, (<span class="keywordtype">char</span> *) prpc_param[i]);
<a name="l11509"></a>11509             param_size = strlen((<span class="keywordtype">char</span> *) prpc_param[i]);
<a name="l11510"></a>11510          }
<a name="l11511"></a>11511 
<a name="l11512"></a>11512          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags &amp; RPC_VARARRAY) {
<a name="l11513"></a>11513             <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<span class="keywordtype">id</span> == <a class="code" href="group__mrpcdefineh.html#gad0d0e115e7026f808f8df526ff5c77ee">RPC_BM_RECEIVE_EVENT</a>) {
<a name="l11514"></a>11514                param_size = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) prpc_param[i + 1]);
<a name="l11515"></a>11515                <span class="comment">/* write number of bytes to output */</span>
<a name="l11516"></a>11516                sprintf(out_param_ptr, <span class="stringliteral">&quot;%d&quot;</span>, param_size);
<a name="l11517"></a>11517                out_param_ptr += strlen(out_param_ptr) + 1;      <span class="comment">/* &apos;0&apos; finishes param */</span>
<a name="l11518"></a>11518                memcpy(out_param_ptr, prpc_param[i], param_size);
<a name="l11519"></a>11519                out_param_ptr += param_size;
<a name="l11520"></a>11520                *out_param_ptr = 0;
<a name="l11521"></a>11521             } <span class="keywordflow">else</span> {
<a name="l11522"></a>11522                <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<span class="keywordtype">id</span> == <a class="code" href="group__mrpcdefineh.html#ga62aeeff0128db0be59b11c0b7c731414">RPC_DB_GET_DATA1</a>) {
<a name="l11523"></a>11523                   param_size = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) prpc_param[i + 1]);
<a name="l11524"></a>11524                   array_tid = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) prpc_param[i + 2]);
<a name="l11525"></a>11525                   num_values = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) prpc_param[i + 3]);
<a name="l11526"></a>11526                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<span class="keywordtype">id</span> == <a class="code" href="group__mrpcdefineh.html#gab80c89111861b0429b50a67a90fc7ec8">RPC_DB_GET_DATA_INDEX</a>) {
<a name="l11527"></a>11527                   param_size = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) prpc_param[i + 1]);
<a name="l11528"></a>11528                   array_tid = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) prpc_param[i + 3]);
<a name="l11529"></a>11529                   num_values = 1;
<a name="l11530"></a>11530                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[index].<span class="keywordtype">id</span> == <a class="code" href="group__mrpcdefineh.html#gae54df220cd65f15f7669bba8f031e6a6">RPC_HS_READ</a>) {
<a name="l11531"></a>11531                   param_size = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) prpc_param[i + 1]);
<a name="l11532"></a>11532                   <span class="keywordflow">if</span> (i == 6) {
<a name="l11533"></a>11533                      array_tid = <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a>;
<a name="l11534"></a>11534                      num_values = param_size / <span class="keyword">sizeof</span>(<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>);
<a name="l11535"></a>11535                   } <span class="keywordflow">else</span> {
<a name="l11536"></a>11536                      array_tid = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) prpc_param[10]);
<a name="l11537"></a>11537                      num_values = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) prpc_param[11]);
<a name="l11538"></a>11538                   }
<a name="l11539"></a>11539                } <span class="keywordflow">else</span> {         <span class="comment">/* variable arrays of fixed type like hs_enum_events, hs_enum_vars */</span>
<a name="l11540"></a>11540 
<a name="l11541"></a>11541                   param_size = *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) prpc_param[i + 1]);
<a name="l11542"></a>11542                   array_tid = tid;
<a name="l11543"></a>11543                   <span class="keywordflow">if</span> (tid == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>)
<a name="l11544"></a>11544                      num_values = param_size / <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>;
<a name="l11545"></a>11545                   <span class="keywordflow">else</span>
<a name="l11546"></a>11546                      num_values = param_size / <a class="code" href="group__midasincludecode.html#ga97cc1898bd6240261b5418bcab5a6d35">tid_size</a>[tid];
<a name="l11547"></a>11547                }
<a name="l11548"></a>11548 
<a name="l11549"></a>11549                <span class="comment">/* derive size of individual item */</span>
<a name="l11550"></a>11550                <span class="keywordflow">if</span> (array_tid == <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>)
<a name="l11551"></a>11551                   item_size = param_size / num_values;
<a name="l11552"></a>11552                <span class="keywordflow">else</span>
<a name="l11553"></a>11553                   item_size = <a class="code" href="group__midasincludecode.html#ga97cc1898bd6240261b5418bcab5a6d35">tid_size</a>[array_tid];
<a name="l11554"></a>11554 
<a name="l11555"></a>11555                <span class="comment">/* write number of elements to output */</span>
<a name="l11556"></a>11556                sprintf(out_param_ptr, <span class="stringliteral">&quot;%d&quot;</span>, num_values);
<a name="l11557"></a>11557                out_param_ptr += strlen(out_param_ptr);
<a name="l11558"></a>11558 
<a name="l11559"></a>11559                <span class="comment">/* write array of values to output */</span>
<a name="l11560"></a>11560                <span class="keywordflow">for</span> (j = 0; j &lt; num_values; j++) {
<a name="l11561"></a>11561                   *out_param_ptr++ = <span class="charliteral">&apos;&amp;&apos;</span>;
<a name="l11562"></a>11562                   <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(out_param_ptr, prpc_param[i], item_size, j, array_tid);
<a name="l11563"></a>11563                   out_param_ptr += strlen(out_param_ptr);
<a name="l11564"></a>11564                }
<a name="l11565"></a>11565             }
<a name="l11566"></a>11566          }
<a name="l11567"></a>11567 
<a name="l11568"></a>11568 <span class="comment">/*</span>
<a name="l11569"></a>11569 <span class="comment">      else if (tid == TID_STRUCT)</span>
<a name="l11570"></a>11570 <span class="comment">        param_size = ALIGN8( rpc_list[index].param[i].n );</span>
<a name="l11571"></a>11571 <span class="comment">*/</span>
<a name="l11572"></a>11572          <span class="keywordflow">else</span>
<a name="l11573"></a>11573             <a class="code" href="group__msectionh.html#ga14e4b0190141d168b49e36178705552e">db_sprintf</a>(out_param_ptr, prpc_param[i], param_size, 0, tid);
<a name="l11574"></a>11574 
<a name="l11575"></a>11575          out_param_ptr += strlen(out_param_ptr);
<a name="l11576"></a>11576 
<a name="l11577"></a>11577          <span class="keywordflow">if</span> ((<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) out_param_ptr - (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) return_buffer &gt; ASCII_BUFFER_SIZE) {
<a name="l11578"></a>11578             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_execute&quot;</span>,
<a name="l11579"></a>11579                    <span class="stringliteral">&quot;return parameter (%d) too large for network buffer (%d)&quot;</span>, param_size,
<a name="l11580"></a>11580                    ASCII_BUFFER_SIZE);
<a name="l11581"></a>11581             <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga1a35d5e05d16d9040eaad41c4434a20a">RPC_EXCEED_BUFFER</a>;
<a name="l11582"></a>11582          }
<a name="l11583"></a>11583       }
<a name="l11584"></a>11584 
<a name="l11585"></a>11585    <span class="comment">/* send return parameters */</span>
<a name="l11586"></a>11586    param_size = (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) out_param_ptr - (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) return_buffer + 1;
<a name="l11587"></a>11587 
<a name="l11588"></a>11588    status = <a class="code" href="group__msystemincludecode.html#gae657f73f38c098645aab383053478d59">send_tcp</a>(sock, return_buffer, param_size, 0);
<a name="l11589"></a>11589 
<a name="l11590"></a>11590    <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l11591"></a>11591       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_execute&quot;</span>, <span class="stringliteral">&quot;send_tcp() failed&quot;</span>);
<a name="l11592"></a>11592       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l11593"></a>11593    }
<a name="l11594"></a>11594 
<a name="l11595"></a>11595    <span class="comment">/* print return buffer */</span>
<a name="l11596"></a>11596    <span class="keywordflow">if</span> (strlen(return_buffer) &gt; <span class="keyword">sizeof</span>(debug_line)) {
<a name="l11597"></a>11597       memcpy(debug_line, return_buffer, <span class="keyword">sizeof</span>(debug_line) - 10);
<a name="l11598"></a>11598       strcat(debug_line, <span class="stringliteral">&quot;...&quot;</span>);
<a name="l11599"></a>11599    } <span class="keywordflow">else</span>
<a name="l11600"></a>11600       sprintf(debug_line, <span class="stringliteral">&quot;-&gt; %s&quot;</span>, return_buffer);
<a name="l11601"></a>11601    <a class="code" href="group__msectionh.html#ga5122c91743605847f8368e17758dedbf">rpc_debug_printf</a>(debug_line);
<a name="l11602"></a>11602 
<a name="l11603"></a>11603    <span class="comment">/* return SS_EXIT if RPC_EXIT is called */</span>
<a name="l11604"></a>11604    <span class="keywordflow">if</span> (routine_id == <a class="code" href="group__mrpcdefineh.html#ga4fecef60778fda08ca026eaad345eca2">RPC_ID_EXIT</a>)
<a name="l11605"></a>11605       <span class="keywordflow">return</span> <a class="code" href="group__err24.html#ga8bdfd6ab89f9628d57174f8a4287bf9f">SS_EXIT</a>;
<a name="l11606"></a>11606 
<a name="l11607"></a>11607    <span class="comment">/* return SS_SHUTDOWN if RPC_SHUTDOWN is called */</span>
<a name="l11608"></a>11608    <span class="keywordflow">if</span> (routine_id == <a class="code" href="group__mrpcdefineh.html#ga758695700ff26f404eec79ecbeab4947">RPC_ID_SHUTDOWN</a>)
<a name="l11609"></a>11609       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga0406ee07e8c5afbf8e46cb0eed698bcd">RPC_SHUTDOWN</a>;
<a name="l11610"></a>11610 
<a name="l11611"></a>11611    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l11612"></a>11612 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga83d80e4f1e8d2a2d7f38e58dcfd3c711"></a><!-- doxytag: member="midas.c::rpc_flush_event" ref="ga83d80e4f1e8d2a2d7f38e58dcfd3c711" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_flush_event </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox Send event residing in the TCP cache buffer filled by rpc_send_event. This routine should be called when a run is stopped.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>RPC_SUCCESS, RPC_NET_ERROR </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l10305">10305</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l00827">_tcp_buffer</a>, <a class="el" href="midas_8c_source.html#l00829">_tcp_rp</a>, <a class="el" href="midas_8c_source.html#l00828">_tcp_wp</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8c_source.html#l09022">rpc_is_remote()</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="msystem_8h_source.html#l00436">RPC_SERVER_CONNECTION::send_sock</a>, and <a class="el" href="system_8c_source.html#l03606">send_tcp()</a>.</p>

<p>Referenced by <a class="el" href="old__mevb_8cpp_source.html#l00658">main()</a>, <a class="el" href="crate3_2rpc__slave_8cpp_source.html#l00049">rpc_end_of_cycle()</a>, <a class="el" href="midas_8c_source.html#l08975">rpc_server_disconnect()</a>, <a class="el" href="mevb_8cpp_source.html#l00370">scan_fragment()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l01446">scheduler()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l01003">send_event()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00442">tr_prestop()</a>, <a class="el" href="crate9_2mfe__mucap_8c_source.html#l00422">tr_stop()</a>, and <a class="el" href="ybos_8c_source.html#l00856">yb_file_fragment()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10306"></a>10306 {
<a name="l10307"></a>10307    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l10308"></a>10308 
<a name="l10309"></a>10309    <span class="keywordflow">if</span> (!<a class="code" href="group__msectionh.html#ga0090933001e7e1ddd52ed3f321bea957">rpc_is_remote</a>())
<a name="l10310"></a>10310       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l10311"></a>10311 
<a name="l10312"></a>10312    <span class="comment">/* return if rpc_send_event was not called */</span>
<a name="l10313"></a>10313    <span class="keywordflow">if</span> (!<a class="code" href="group__midasincludecode.html#gacd9469118baa2f8ab14235bace996e5a">_tcp_buffer</a> || <a class="code" href="group__midasincludecode.html#ga9f73f302a0b2c383713fff5762b00145">_tcp_wp</a> == 0)
<a name="l10314"></a>10314       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l10315"></a>10315 
<a name="l10316"></a>10316    <span class="comment">/* empty TCP buffer */</span>
<a name="l10317"></a>10317    <span class="keywordflow">if</span> (<a class="code" href="group__midasincludecode.html#ga9f73f302a0b2c383713fff5762b00145">_tcp_wp</a> &gt; 0) {
<a name="l10318"></a>10318       i = <a class="code" href="group__msystemincludecode.html#gae657f73f38c098645aab383053478d59">send_tcp</a>(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a>,
<a name="l10319"></a>10319                    <a class="code" href="group__midasincludecode.html#gacd9469118baa2f8ab14235bace996e5a">_tcp_buffer</a> + <a class="code" href="group__midasincludecode.html#ga1eceed672fe2ba3756951a772b4ae008">_tcp_rp</a>, <a class="code" href="group__midasincludecode.html#ga9f73f302a0b2c383713fff5762b00145">_tcp_wp</a> - <a class="code" href="group__midasincludecode.html#ga1eceed672fe2ba3756951a772b4ae008">_tcp_rp</a>, 0);
<a name="l10320"></a>10320 
<a name="l10321"></a>10321       <span class="keywordflow">if</span> (i != <a class="code" href="group__midasincludecode.html#ga9f73f302a0b2c383713fff5762b00145">_tcp_wp</a> - <a class="code" href="group__midasincludecode.html#ga1eceed672fe2ba3756951a772b4ae008">_tcp_rp</a>) {
<a name="l10322"></a>10322          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_flush_event&quot;</span>, <span class="stringliteral">&quot;send_tcp() failed&quot;</span>);
<a name="l10323"></a>10323          <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l10324"></a>10324       }
<a name="l10325"></a>10325    }
<a name="l10326"></a>10326 
<a name="l10327"></a>10327    <a class="code" href="group__midasincludecode.html#ga1eceed672fe2ba3756951a772b4ae008">_tcp_rp</a> = <a class="code" href="group__midasincludecode.html#ga9f73f302a0b2c383713fff5762b00145">_tcp_wp</a> = 0;
<a name="l10328"></a>10328 
<a name="l10329"></a>10329    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l10330"></a>10330 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga105b67e3b64c0220093e5ad5cce9c3b3"></a><!-- doxytag: member="midas.c::rpc_get_convert_flags" ref="ga105b67e3b64c0220093e5ad5cce9c3b3" args="(INT *convert_flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rpc_get_convert_flags </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> *&nbsp;</td>
          <td class="paramname"> <em>convert_flags</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l07998">7998</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="msystem_8h_source.html#l00439">RPC_SERVER_CONNECTION::remote_hw_type</a>, <a class="el" href="midas_8c_source.html#l07974">rpc_calc_convert_flags()</a>, <a class="el" href="midas_8c_source.html#l09092">rpc_get_option()</a>, and <a class="el" href="midas_8h_source.html#l00771">RPC_OHW_TYPE</a>.</p>

<p>Referenced by <a class="el" href="minife_8c_source.html#l00065">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07999"></a>07999 {
<a name="l08000"></a>08000    <a class="code" href="group__rpcfunctionc.html#ga34b52a482a19eb8abcf8d84d888acbe0">rpc_calc_convert_flags</a>(<a class="code" href="group__msectionh.html#gae3bca206872bae947c6e20c1aedfe4f5">rpc_get_option</a>(0, <a class="code" href="group__mdefineh.html#gaf716b122f115aca08e68391343145cb3">RPC_OHW_TYPE</a>),
<a name="l08001"></a>08001                           <a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a89249bd9355ce7f1342458c9805ad3b8">remote_hw_type</a>, convert_flags);
<a name="l08002"></a>08002 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga9891d5e14854f36015c9f47eab8b2dbb"></a><!-- doxytag: member="midas.c::rpc_get_event_sock" ref="ga9891d5e14854f36015c9f47eab8b2dbb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rpc_get_event_sock </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l10272">10272</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="msystem_8h_source.html#l00438">RPC_SERVER_CONNECTION::event_sock</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l17079">dm_buffer_create()</a>, and <a class="el" href="midas_8c_source.html#l16648">eb_create_buffer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10275"></a>10275          : <a class="code" href="group__msystemincludecode.html#ga799933a102e7261213fbc56b0f95a705">rpc_get_event_sock</a>
<a name="l10276"></a>10276 
<a name="l10277"></a>10277   Purpose: Return <span class="keyword">event</span> <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a> socket to MIDAS server. Used <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> MFE.C <span class="keywordflow">for</span>
<a name="l10278"></a>10278            optimized <span class="keyword">event</span> sending.
<a name="l10279"></a>10279 
<a name="l10280"></a>10280   Input:
<a name="l10281"></a>10281     none
<a name="l10282"></a>10282 
<a name="l10283"></a>10283   Output:
<a name="l10284"></a>10284     none
<a name="l10285"></a>10285 
<a name="l10286"></a>10286   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l10287"></a>10287     <span class="keywordtype">int</span>    socket
<a name="l10288"></a>10288 
<a name="l10289"></a>10289 \********************************************************************/
<a name="l10290"></a>10290 {
<a name="l10291"></a>10291    <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a2e03618197a1b05eed9d7d470ae62362">event_sock</a>;
<a name="l10292"></a>10292 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gafe112287d4a9288ef3543e6048a48fc3"></a><!-- doxytag: member="midas.c::rpc_get_name" ref="gafe112287d4a9288ef3543e6048a48fc3" args="(char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_get_name </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l09368">9368</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l16417">al_check()</a>, <a class="el" href="midas_8c_source.html#l02768">cm_disconnect_experiment()</a>, <a class="el" href="midas_8c_source.html#l01233">cm_msg()</a>, <a class="el" href="midas_8c_source.html#l01346">cm_msg1()</a>, <a class="el" href="midas_8c_source.html#l08416">rpc_client_connect()</a>, and <a class="el" href="midas_8c_source.html#l08657">rpc_server_connect()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09371"></a>09371          : <a class="code" href="group__msectionh.html#ga0fe26d0eebb34139d77a455e50246b26">rpc_get_name</a>
<a name="l09372"></a>09372 
<a name="l09373"></a>09373   Purpose: Get <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a> <span class="keyword">set</span> <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> <a class="code" href="group__msectionh.html#gaeeeea2e9156202fc493eef175b54b0f0">rpc_set_name</a>
<a name="l09374"></a>09374 
<a name="l09375"></a>09375   Input:
<a name="l09376"></a>09376     none
<a name="l09377"></a>09377 
<a name="l09378"></a>09378   Output:
<a name="l09379"></a>09379     <span class="keywordtype">char</span>*  <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>             The location pointed <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> *<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a> receives a
<a name="l09380"></a>09380                             copy of the _prog_name
<a name="l09381"></a>09381 
<a name="l09382"></a>09382   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l09383"></a>09383     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l09384"></a>09384 
<a name="l09385"></a>09385 \********************************************************************/
<a name="l09386"></a>09386 {
<a name="l09387"></a>09387    strcpy(<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>, <a class="code" href="group__midasincludecode.html#gab7fab72dace85185e6be68b79707a4ab">_client_name</a>);
<a name="l09388"></a>09388 
<a name="l09389"></a>09389    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l09390"></a>09390 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga1af6538c332bcca866e57cd040d54fb6"></a><!-- doxytag: member="midas.c::rpc_get_opt_tcp_size" ref="ga1af6538c332bcca866e57cd040d54fb6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_get_opt_tcp_size </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l10096">10096</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10097"></a>10097 {
<a name="l10098"></a>10098    <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#ga20e63d0a316b30ec4fbd8766dd04c52d">_opt_tcp_size</a>;
<a name="l10099"></a>10099 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gadd4af923e46041c84fe466a563f700ae"></a><!-- doxytag: member="midas.c::rpc_get_option" ref="gadd4af923e46041c84fe466a563f700ae" args="(HNDLE hConn, INT item)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_get_option </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a>&nbsp;</td>
          <td class="paramname"> <em>hConn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>item</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l09092">9092</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="system_8c_source.html#l00966">d</a>, <a class="el" href="msystem_8h_source.html#l00200">DRF_G_FLOAT</a>, <a class="el" href="msystem_8h_source.html#l00199">DRF_IEEE</a>, <a class="el" href="msystem_8h_source.html#l00194">DRI_16</a>, <a class="el" href="msystem_8h_source.html#l00195">DRI_32</a>, <a class="el" href="msystem_8h_source.html#l00196">DRI_64</a>, <a class="el" href="msystem_8h_source.html#l00198">DRI_BIG_ENDIAN</a>, <a class="el" href="msystem_8h_source.html#l00197">DRI_LITTLE_ENDIAN</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="sis3803_8c_source.html#l00925">p</a>, <a class="el" href="midas_8h_source.html#l00771">RPC_OHW_TYPE</a>, <a class="el" href="midas_8h_source.html#l00768">RPC_OTIMEOUT</a>, <a class="el" href="midas_8h_source.html#l00769">RPC_OTRANSPORT</a>, <a class="el" href="msystem_8h_source.html#l00428">RPC_CLIENT_CONNECTION::rpc_timeout</a>, <a class="el" href="msystem_8h_source.html#l00441">RPC_SERVER_CONNECTION::rpc_timeout</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="msystem_8h_source.html#l00427">RPC_CLIENT_CONNECTION::transport</a>, and <a class="el" href="msystem_8h_source.html#l00440">RPC_SERVER_CONNECTION::transport</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l02349">cm_connect_experiment1()</a>, <a class="el" href="midas_8c_source.html#l03579">cm_transition()</a>, <a class="el" href="midas_8c_source.html#l09810">rpc_call()</a>, <a class="el" href="midas_8c_source.html#l11860">rpc_client_accept()</a>, <a class="el" href="midas_8c_source.html#l09519">rpc_client_call()</a>, <a class="el" href="midas_8c_source.html#l08416">rpc_client_connect()</a>, <a class="el" href="midas_8c_source.html#l07998">rpc_get_convert_flags()</a>, <a class="el" href="midas_8c_source.html#l11980">rpc_server_callback()</a>, and <a class="el" href="midas_8c_source.html#l08657">rpc_server_connect()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09095"></a>09095          : <a class="code" href="group__msectionh.html#gae3bca206872bae947c6e20c1aedfe4f5">rpc_get_option</a>
<a name="l09096"></a>09096 
<a name="l09097"></a>09097   Purpose: Get actual RPC option
<a name="l09098"></a>09098 
<a name="l09099"></a>09099   Input:
<a name="l09100"></a>09100     <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a>             RPC connection <a class="code" href="v1724__module_8c.html#a0e640374bff58e788b18fbed8f89fe11">handle</a>
<a name="l09101"></a>09101     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   item              One of RPC_Oxxx
<a name="l09102"></a>09102 
<a name="l09103"></a>09103   Output:
<a name="l09104"></a>09104     none
<a name="l09105"></a>09105 
<a name="l09106"></a>09106   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l09107"></a>09107     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>                     Actual option
<a name="l09108"></a>09108 
<a name="l09109"></a>09109 \********************************************************************/
<a name="l09110"></a>09110 {
<a name="l09111"></a>09111    <span class="keywordflow">switch</span> (item) {
<a name="l09112"></a>09112    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga9d274f0e5944be5b429d6c1bacfe1db0">RPC_OTIMEOUT</a>:
<a name="l09113"></a>09113       <span class="keywordflow">if</span> (<a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a> == -1)
<a name="l09114"></a>09114          <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#aa34f2d90cd5dc1467abcc33b8f8f553e">rpc_timeout</a>;
<a name="l09115"></a>09115       <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[<a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a> - 1].<a class="code" href="structRPC__CLIENT__CONNECTION.html#a63051393eedd1fca0e91c42c34f4441f">rpc_timeout</a>;
<a name="l09116"></a>09116 
<a name="l09117"></a>09117    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga42ebe781b990fe561db5759b1ce9b633">RPC_OTRANSPORT</a>:
<a name="l09118"></a>09118       <span class="keywordflow">if</span> (<a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a> == -1)
<a name="l09119"></a>09119          <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#acb5e6cb7a6ec57b9121c438f305217e6">transport</a>;
<a name="l09120"></a>09120       <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[<a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a> - 1].<a class="code" href="structRPC__CLIENT__CONNECTION.html#a526ef7cf39ae237154b4725aafb2fd0b">transport</a>;
<a name="l09121"></a>09121 
<a name="l09122"></a>09122    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#gaf716b122f115aca08e68391343145cb3">RPC_OHW_TYPE</a>:
<a name="l09123"></a>09123       {
<a name="l09124"></a>09124          <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> tmp_type, <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l09125"></a>09125          <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> dummy;
<a name="l09126"></a>09126          <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>;
<a name="l09127"></a>09127          <span class="keywordtype">float</span> f;
<a name="l09128"></a>09128          <span class="keywordtype">double</span> <a class="code" href="system_8c.html#a873684cefeb665f3d5e6b495de57fc0d">d</a>;
<a name="l09129"></a>09129 
<a name="l09130"></a>09130          tmp_type = 0;
<a name="l09131"></a>09131 
<a name="l09132"></a>09132          <span class="comment">/* test pointer size */</span>
<a name="l09133"></a>09133          size = <span class="keyword">sizeof</span>(p);
<a name="l09134"></a>09134          <span class="keywordflow">if</span> (size == 2)
<a name="l09135"></a>09135             tmp_type |= <a class="code" href="group__msdefineh.html#ga6f24d57769829c6f7ba50fb583a6145a">DRI_16</a>;
<a name="l09136"></a>09136          <span class="keywordflow">if</span> (size == 4)
<a name="l09137"></a>09137             tmp_type |= <a class="code" href="group__msdefineh.html#ga23c1be975c22d964171147278528ec8a">DRI_32</a>;
<a name="l09138"></a>09138          <span class="keywordflow">if</span> (size == 8)
<a name="l09139"></a>09139             tmp_type |= <a class="code" href="group__msdefineh.html#gab190dd0e5439f0688e15c8b5312a7e4f">DRI_64</a>;
<a name="l09140"></a>09140 
<a name="l09141"></a>09141          <span class="comment">/* test if little or big endian machine */</span>
<a name="l09142"></a>09142          dummy = 0x12345678;
<a name="l09143"></a>09143          p = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) &amp;dummy;
<a name="l09144"></a>09144          <span class="keywordflow">if</span> (*p == 0x78)
<a name="l09145"></a>09145             tmp_type |= <a class="code" href="group__msdefineh.html#ga488afc1213500e60d6dd9a2939fb3204">DRI_LITTLE_ENDIAN</a>;
<a name="l09146"></a>09146          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*p == 0x12)
<a name="l09147"></a>09147             tmp_type |= <a class="code" href="group__msdefineh.html#gab3ef6d21655a8a91a2fbc6866ae42823">DRI_BIG_ENDIAN</a>;
<a name="l09148"></a>09148          <span class="keywordflow">else</span>
<a name="l09149"></a>09149             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_get_option&quot;</span>, <span class="stringliteral">&quot;unknown byte order format&quot;</span>);
<a name="l09150"></a>09150 
<a name="l09151"></a>09151          <span class="comment">/* floating point format */</span>
<a name="l09152"></a>09152          f = (float) 1.2345;
<a name="l09153"></a>09153          dummy = 0;
<a name="l09154"></a>09154          memcpy(&amp;dummy, &amp;f, <span class="keyword">sizeof</span>(f));
<a name="l09155"></a>09155          <span class="keywordflow">if</span> ((dummy &amp; 0xFF) == 0x19 &amp;&amp;
<a name="l09156"></a>09156              ((dummy &gt;&gt; 8) &amp; 0xFF) == 0x04 &amp;&amp;
<a name="l09157"></a>09157              ((dummy &gt;&gt; 16) &amp; 0xFF) == 0x9E &amp;&amp; ((dummy &gt;&gt; 24) &amp; 0xFF) == 0x3F)
<a name="l09158"></a>09158             tmp_type |= <a class="code" href="group__msdefineh.html#gacf6c5a8ba75600af57eaab22a9e6f4a5">DRF_IEEE</a>;
<a name="l09159"></a>09159          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((dummy &amp; 0xFF) == 0x9E &amp;&amp;
<a name="l09160"></a>09160                   ((dummy &gt;&gt; 8) &amp; 0xFF) == 0x40 &amp;&amp;
<a name="l09161"></a>09161                   ((dummy &gt;&gt; 16) &amp; 0xFF) == 0x19 &amp;&amp; ((dummy &gt;&gt; 24) &amp; 0xFF) == 0x04)
<a name="l09162"></a>09162             tmp_type |= <a class="code" href="group__msdefineh.html#ga4ad501f5c59d4db17df10859e7ee97de">DRF_G_FLOAT</a>;
<a name="l09163"></a>09163          <span class="keywordflow">else</span>
<a name="l09164"></a>09164             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_get_option&quot;</span>, <span class="stringliteral">&quot;unknown floating point format&quot;</span>);
<a name="l09165"></a>09165 
<a name="l09166"></a>09166          d = (double) 1.2345;
<a name="l09167"></a>09167          dummy = 0;
<a name="l09168"></a>09168          memcpy(&amp;dummy, &amp;d, <span class="keyword">sizeof</span>(f));
<a name="l09169"></a>09169          <span class="keywordflow">if</span> ((dummy &amp; 0xFF) == 0x8D &amp;&amp;  <span class="comment">/* little endian */</span>
<a name="l09170"></a>09170              ((dummy &gt;&gt; 8) &amp; 0xFF) == 0x97 &amp;&amp;
<a name="l09171"></a>09171              ((dummy &gt;&gt; 16) &amp; 0xFF) == 0x6E &amp;&amp; ((dummy &gt;&gt; 24) &amp; 0xFF) == 0x12)
<a name="l09172"></a>09172             tmp_type |= <a class="code" href="group__msdefineh.html#gacf6c5a8ba75600af57eaab22a9e6f4a5">DRF_IEEE</a>;
<a name="l09173"></a>09173          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((dummy &amp; 0xFF) == 0x83 &amp;&amp;     <span class="comment">/* big endian */</span>
<a name="l09174"></a>09174                   ((dummy &gt;&gt; 8) &amp; 0xFF) == 0xC0 &amp;&amp;
<a name="l09175"></a>09175                   ((dummy &gt;&gt; 16) &amp; 0xFF) == 0xF3 &amp;&amp; ((dummy &gt;&gt; 24) &amp; 0xFF) == 0x3F)
<a name="l09176"></a>09176             tmp_type |= <a class="code" href="group__msdefineh.html#gacf6c5a8ba75600af57eaab22a9e6f4a5">DRF_IEEE</a>;
<a name="l09177"></a>09177          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((dummy &amp; 0xFF) == 0x13 &amp;&amp;
<a name="l09178"></a>09178                   ((dummy &gt;&gt; 8) &amp; 0xFF) == 0x40 &amp;&amp;
<a name="l09179"></a>09179                   ((dummy &gt;&gt; 16) &amp; 0xFF) == 0x83 &amp;&amp; ((dummy &gt;&gt; 24) &amp; 0xFF) == 0xC0)
<a name="l09180"></a>09180             tmp_type |= <a class="code" href="group__msdefineh.html#ga4ad501f5c59d4db17df10859e7ee97de">DRF_G_FLOAT</a>;
<a name="l09181"></a>09181          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((dummy &amp; 0xFF) == 0x9E &amp;&amp;
<a name="l09182"></a>09182                   ((dummy &gt;&gt; 8) &amp; 0xFF) == 0x40 &amp;&amp;
<a name="l09183"></a>09183                   ((dummy &gt;&gt; 16) &amp; 0xFF) == 0x18 &amp;&amp; ((dummy &gt;&gt; 24) &amp; 0xFF) == 0x04)
<a name="l09184"></a>09184             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_get_option&quot;</span>,
<a name="l09185"></a>09185                    <span class="stringliteral">&quot;MIDAS cannot handle VAX D FLOAT format. Please compile with the /g_float flag&quot;</span>);
<a name="l09186"></a>09186          <span class="keywordflow">else</span>
<a name="l09187"></a>09187             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_get_option&quot;</span>, <span class="stringliteral">&quot;unknown floating point format&quot;</span>);
<a name="l09188"></a>09188 
<a name="l09189"></a>09189          <span class="keywordflow">return</span> tmp_type;
<a name="l09190"></a>09190       }
<a name="l09191"></a>09191 
<a name="l09192"></a>09192    <span class="keywordflow">default</span>:
<a name="l09193"></a>09193       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_get_option&quot;</span>, <span class="stringliteral">&quot;invalid argument&quot;</span>);
<a name="l09194"></a>09194       <span class="keywordflow">break</span>;
<a name="l09195"></a>09195    }
<a name="l09196"></a>09196 
<a name="l09197"></a>09197    <span class="keywordflow">return</span> 0;
<a name="l09198"></a>09198 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gadad353c9f1fd0f6ee0a6a4c0576cbe10"></a><!-- doxytag: member="midas.c::rpc_get_send_sock" ref="gadad353c9f1fd0f6ee0a6a4c0576cbe10" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rpc_get_send_sock </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox </p>

<p>Definition at line <a class="el" href="midas_8c_source.html#l10248">10248</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="msystem_8h_source.html#l00436">RPC_SERVER_CONNECTION::send_sock</a>.</p>

<p>Referenced by <a class="el" href="ybos_8c_source.html#l00856">yb_file_fragment()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10251"></a>10251          : <a class="code" href="group__msystemincludecode.html#ga5d066e344a512f5a12b8abd8c3c77607">rpc_get_send_sock</a>
<a name="l10252"></a>10252 
<a name="l10253"></a>10253   Purpose: Return <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a> socket to MIDAS server. Used <a class="code" href="patch__mevb_8cpp.html#a944cf20aa75177818af16fe394e984be">by</a> MFE.C <span class="keywordflow">for</span>
<a name="l10254"></a>10254            optimized <span class="keyword">event</span> sending.
<a name="l10255"></a>10255 
<a name="l10256"></a>10256   Input:
<a name="l10257"></a>10257     none
<a name="l10258"></a>10258 
<a name="l10259"></a>10259   Output:
<a name="l10260"></a>10260     none
<a name="l10261"></a>10261 
<a name="l10262"></a>10262   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l10263"></a>10263     <span class="keywordtype">int</span>    socket
<a name="l10264"></a>10264 
<a name="l10265"></a>10265 \********************************************************************/
<a name="l10266"></a>10266 {
<a name="l10267"></a>10267    <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a>;
<a name="l10268"></a>10268 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga55167513ac1295a246d69f378fc9d459"></a><!-- doxytag: member="midas.c::rpc_get_server_acception" ref="ga55167513ac1295a246d69f378fc9d459" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_get_server_acception </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l09045">9045</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l07429">bm_check_buffers()</a>, <a class="el" href="midas_8c_source.html#l04611">bm_close_buffer()</a>, <a class="el" href="midas_8c_source.html#l07751">bm_empty_buffers()</a>, <a class="el" href="midas_8c_source.html#l07495">bm_mark_read_waiting()</a>, <a class="el" href="midas_8c_source.html#l04389">bm_open_buffer()</a>, <a class="el" href="midas_8c_source.html#l03000">cm_set_watchdog_params()</a>, <a class="el" href="odb_8c_source.html#l01305">db_close_database()</a>, <a class="el" href="odb_8c_source.html#l01422">db_flush_database()</a>, and <a class="el" href="odb_8c_source.html#l00993">db_open_database()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09048"></a>09048          : <a class="code" href="group__msystemincludecode.html#ga55167513ac1295a246d69f378fc9d459">rpc_get_server_acception</a>
<a name="l09049"></a>09049 
<a name="l09050"></a>09050   Purpose: Return actual RPC server connection <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>
<a name="l09051"></a>09051 
<a name="l09052"></a>09052   Input:
<a name="l09053"></a>09053    none
<a name="l09054"></a>09054 
<a name="l09055"></a>09055   Output:
<a name="l09056"></a>09056     none
<a name="l09057"></a>09057 
<a name="l09058"></a>09058   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l09059"></a>09059     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>    RPC server connection <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>
<a name="l09060"></a>09060 
<a name="l09061"></a>09061 \********************************************************************/
<a name="l09062"></a>09062 {
<a name="l09063"></a>09063    <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#ga9ac2420c00b7dfb59718e71077d29568">_server_acception_index</a>;
<a name="l09064"></a>09064 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga8c53d974d5f6fb301c6c7d58a1cf00d6"></a><!-- doxytag: member="midas.c::rpc_get_server_option" ref="ga8c53d974d5f6fb301c6c7d58a1cf00d6" args="(INT item)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PTYPE rpc_get_server_option </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>item</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox </p>

<p>Definition at line <a class="el" href="midas_8c_source.html#l09250">9250</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="msystem_8h_source.html#l00463">RPC_SERVER_ACCEPTION::client_handle</a>, <a class="el" href="msystem_8h_source.html#l00456">RPC_SERVER_ACCEPTION::convert_flags</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="Mql_8h_source.html#l00011">MAX</a>, <a class="el" href="msystem_8h_source.html#l00255">MAX_RPC_CONNECTION</a>, <a class="el" href="msystem_8h_source.html#l00462">RPC_SERVER_ACCEPTION::odb_handle</a>, <a class="el" href="midas_8h_source.html#l00615">PTYPE</a>, <a class="el" href="midas_8h_source.html#l00776">RPC_CLIENT_HANDLE</a>, <a class="el" href="midas_8h_source.html#l00774">RPC_CONVERT_FLAGS</a>, <a class="el" href="midas_8h_source.html#l00775">RPC_ODB_HANDLE</a>, <a class="el" href="midas_8h_source.html#l00773">RPC_OSERVER_NAME</a>, <a class="el" href="midas_8h_source.html#l00772">RPC_OSERVER_TYPE</a>, <a class="el" href="midas_8h_source.html#l00777">RPC_SEND_SOCK</a>, <a class="el" href="midas_8h_source.html#l00778">RPC_WATCHDOG_TIMEOUT</a>, <a class="el" href="msystem_8h_source.html#l00449">RPC_SERVER_ACCEPTION::send_sock</a>, <a class="el" href="system_8c_source.html#l01050">ss_gettid()</a>, <a class="el" href="midas_8h_source.html#l01792">ST_MTHREAD</a>, <a class="el" href="midas_8h_source.html#l01790">ST_NONE</a>, <a class="el" href="midas_8h_source.html#l01795">ST_REMOTE</a>, <a class="el" href="midas_8h_source.html#l01791">ST_SINGLE</a>, and <a class="el" href="msystem_8h_source.html#l00454">RPC_SERVER_ACCEPTION::watchdog_timeout</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l07429">bm_check_buffers()</a>, <a class="el" href="midas_8c_source.html#l04611">bm_close_buffer()</a>, <a class="el" href="midas_8c_source.html#l07751">bm_empty_buffers()</a>, <a class="el" href="midas_8c_source.html#l07495">bm_mark_read_waiting()</a>, <a class="el" href="midas_8c_source.html#l07548">bm_notify_client()</a>, <a class="el" href="midas_8c_source.html#l04389">bm_open_buffer()</a>, <a class="el" href="midas_8c_source.html#l06777">bm_receive_event()</a>, <a class="el" href="midas_8c_source.html#l02768">cm_disconnect_experiment()</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l03000">cm_set_watchdog_params()</a>, <a class="el" href="odb_8c_source.html#l01305">db_close_database()</a>, <a class="el" href="odb_8c_source.html#l01422">db_flush_database()</a>, <a class="el" href="odb_8c_source.html#l06770">db_get_record()</a>, <a class="el" href="odb_8c_source.html#l00993">db_open_database()</a>, <a class="el" href="odb_8c_source.html#l06874">db_set_record()</a>, <a class="el" href="odb_8c_source.html#l07947">db_update_record()</a>, <a class="el" href="midas_8c_source.html#l10655">recv_event_server()</a>, <a class="el" href="midas_8c_source.html#l10454">recv_tcp_server()</a>, <a class="el" href="midas_8c_source.html#l12486">rpc_check_channels()</a>, <a class="el" href="midas_8c_source.html#l11616">rpc_server_accept()</a>, <a class="el" href="midas_8c_source.html#l11980">rpc_server_callback()</a>, <a class="el" href="mserver_8c_source.html#l00534">rpc_server_dispatch()</a>, <a class="el" href="midas_8c_source.html#l12223">rpc_server_receive()</a>, and <a class="el" href="system_8c_source.html#l03283">ss_suspend()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09253"></a>09253          : <a class="code" href="group__msystemincludecode.html#ga500895b6f1fb39626453b56a20ed52df">rpc_get_server_option</a>
<a name="l09254"></a>09254 
<a name="l09255"></a>09255   Purpose: Get actual RPC option <span class="keywordflow">for</span> server connection
<a name="l09256"></a>09256 
<a name="l09257"></a>09257   Input:
<a name="l09258"></a>09258     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>  item               One of RPC_Oxxx
<a name="l09259"></a>09259 
<a name="l09260"></a>09260   Output:
<a name="l09261"></a>09261     none
<a name="l09262"></a>09262 
<a name="l09263"></a>09263   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l09264"></a>09264     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>                     Actual option
<a name="l09265"></a>09265 
<a name="l09266"></a>09266 \********************************************************************/
<a name="l09267"></a>09267 {
<a name="l09268"></a>09268    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l09269"></a>09269 
<a name="l09270"></a>09270    <span class="keywordflow">if</span> (item == <a class="code" href="group__mdefineh.html#ga7f6354019d48c7beeb8f5bd5c2fac8bb">RPC_OSERVER_TYPE</a>)
<a name="l09271"></a>09271       <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#ga71a7c9d97df5dbe0a62770034ae6757f">_server_type</a>;
<a name="l09272"></a>09272 
<a name="l09273"></a>09273    <span class="keywordflow">if</span> (item == <a class="code" href="group__mdefineh.html#ga1caa8de36fbdd251b67fd4601d0e708f">RPC_OSERVER_NAME</a>)
<a name="l09274"></a>09274       <span class="keywordflow">return</span> (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) <a class="code" href="group__rpcfunctionc.html#gaa16848418d977932c5cdf9e61f660e13">_server_name</a>;
<a name="l09275"></a>09275 
<a name="l09276"></a>09276    <span class="comment">/* return 0 for local calls */</span>
<a name="l09277"></a>09277    <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a7c9d97df5dbe0a62770034ae6757f">_server_type</a> == <a class="code" href="group__msectionh.html#gabd99506c32547a70cb2b827e924e9d65">ST_NONE</a>)
<a name="l09278"></a>09278       <span class="keywordflow">return</span> 0;
<a name="l09279"></a>09279 
<a name="l09280"></a>09280    <span class="comment">/* check which connections belongs to caller */</span>
<a name="l09281"></a>09281    <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a7c9d97df5dbe0a62770034ae6757f">_server_type</a> == <a class="code" href="group__msectionh.html#ga88fcaca68212b5824a0b0f6c9507ebcb">ST_MTHREAD</a>) {
<a name="l09282"></a>09282       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__msystemincludecode.html#gab1e8a2a4c5dc40faf6f7c25b51a4562f">MAX_RPC_CONNECTION</a>; i++)
<a name="l09283"></a>09283          <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].tid == <a class="code" href="group__msystemincludecode.html#ga47dde62638a1a4e9f49534bff449ebcd">ss_gettid</a>())
<a name="l09284"></a>09284             <span class="keywordflow">break</span>;
<a name="l09285"></a>09285    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a7c9d97df5dbe0a62770034ae6757f">_server_type</a> == <a class="code" href="group__msectionh.html#gafd1f60d6275582530d610f3a599cb270">ST_SINGLE</a> || <a class="code" href="group__rpcfunctionc.html#ga71a7c9d97df5dbe0a62770034ae6757f">_server_type</a> == <a class="code" href="group__msectionh.html#ga9c6b34250ccc696d64a6a0a572947be5">ST_REMOTE</a>)
<a name="l09286"></a>09286       i = <a class="code" href="Mql_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(0, <a class="code" href="group__rpcfunctionc.html#ga9ac2420c00b7dfb59718e71077d29568">_server_acception_index</a> - 1);
<a name="l09287"></a>09287    <span class="keywordflow">else</span>
<a name="l09288"></a>09288       i = 0;
<a name="l09289"></a>09289 
<a name="l09290"></a>09290    <span class="keywordflow">switch</span> (item) {
<a name="l09291"></a>09291    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#gaddb075d303a5903df6a7dabdad02defd">RPC_CONVERT_FLAGS</a>:
<a name="l09292"></a>09292       <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a9f2d73aafabf6b3ef45298739b8d2400">convert_flags</a>;
<a name="l09293"></a>09293    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga26df61334e35fe4bba4ba7353dcbb66b">RPC_ODB_HANDLE</a>:
<a name="l09294"></a>09294       <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a95b7eaf4dc40c0c1ae8970d16807f33c">odb_handle</a>;
<a name="l09295"></a>09295    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga2ef5ce0b2c01e38ea5152abfc357dbad">RPC_CLIENT_HANDLE</a>:
<a name="l09296"></a>09296       <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].<a class="code" href="structRPC__SERVER__ACCEPTION.html#ac8d274baf533bead5daf48cf2de73501">client_handle</a>;
<a name="l09297"></a>09297    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#gaefa1ff29b841be454a632f5f3083d344">RPC_SEND_SOCK</a>:
<a name="l09298"></a>09298       <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a24df135a5376a4d0ec7acfc7bfd63bca">send_sock</a>;
<a name="l09299"></a>09299    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#gabc2142bbf1d961c3702ddcc8791388c0">RPC_WATCHDOG_TIMEOUT</a>:
<a name="l09300"></a>09300       <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].<a class="code" href="structRPC__SERVER__ACCEPTION.html#ab63d3134ce8331c26bb08d1bf585b617">watchdog_timeout</a>;
<a name="l09301"></a>09301    }
<a name="l09302"></a>09302 
<a name="l09303"></a>09303    <span class="keywordflow">return</span> 0;
<a name="l09304"></a>09304 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaef4a2b3deceddb0aef68da17453cd163"></a><!-- doxytag: member="midas.c::rpc_ieee2vax_double" ref="gaef4a2b3deceddb0aef68da17453cd163" args="(double *var)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rpc_ieee2vax_double </td>
          <td>(</td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>var</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l08058">8058</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l08079">rpc_convert_single()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08059"></a>08059 {
<a name="l08060"></a>08060    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> i1, i2, i3, i4;
<a name="l08061"></a>08061 
<a name="l08062"></a>08062    <span class="comment">/* swap words */</span>
<a name="l08063"></a>08063    i1 = *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var) + 3);
<a name="l08064"></a>08064    i2 = *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var) + 2);
<a name="l08065"></a>08065    i3 = *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var) + 1);
<a name="l08066"></a>08066    i4 = *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var));
<a name="l08067"></a>08067 
<a name="l08068"></a>08068    <span class="comment">/* correct exponent */</span>
<a name="l08069"></a>08069    <span class="keywordflow">if</span> (i1 != 0)
<a name="l08070"></a>08070       i1 += 0x20;
<a name="l08071"></a>08071 
<a name="l08072"></a>08072    *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var) + 3) = i4;
<a name="l08073"></a>08073    *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var) + 2) = i3;
<a name="l08074"></a>08074    *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var) + 1) = i2;
<a name="l08075"></a>08075    *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var)) = i1;
<a name="l08076"></a>08076 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaccde5f164efc9d339256b700a0e03021"></a><!-- doxytag: member="midas.c::rpc_ieee2vax_float" ref="gaccde5f164efc9d339256b700a0e03021" args="(float *var)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rpc_ieee2vax_float </td>
          <td>(</td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>var</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l08005">8005</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l08079">rpc_convert_single()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08006"></a>08006 {
<a name="l08007"></a>08007    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> lo, hi;
<a name="l08008"></a>08008 
<a name="l08009"></a>08009    <span class="comment">/* swap hi and lo word */</span>
<a name="l08010"></a>08010    lo = *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var) + 1);
<a name="l08011"></a>08011    hi = *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var));
<a name="l08012"></a>08012 
<a name="l08013"></a>08013    <span class="comment">/* correct exponent */</span>
<a name="l08014"></a>08014    <span class="keywordflow">if</span> (lo != 0)
<a name="l08015"></a>08015       lo += 0x100;
<a name="l08016"></a>08016 
<a name="l08017"></a>08017    *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var) + 1) = hi;
<a name="l08018"></a>08018    *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var)) = lo;
<a name="l08019"></a>08019 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga4f5a265bf646406b57ad16e6f11ce598"></a><!-- doxytag: member="midas.c::rpc_is_remote" ref="ga4f5a265bf646406b57ad16e6f11ce598" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_is_remote </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l09022">9022</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="msystem_8h_source.html#l00436">RPC_SERVER_CONNECTION::send_sock</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l16417">al_check()</a>, <a class="el" href="midas_8c_source.html#l16104">al_trigger_alarm()</a>, <a class="el" href="midas_8c_source.html#l05703">bm_add_event_request()</a>, <a class="el" href="midas_8c_source.html#l04722">bm_close_all_buffers()</a>, <a class="el" href="midas_8c_source.html#l04611">bm_close_buffer()</a>, <a class="el" href="midas_8c_source.html#l07751">bm_empty_buffers()</a>, <a class="el" href="midas_8c_source.html#l06412">bm_flush_cache()</a>, <a class="el" href="midas_8c_source.html#l05335">bm_get_buffer_info()</a>, <a class="el" href="midas_8c_source.html#l05385">bm_get_buffer_level()</a>, <a class="el" href="midas_8c_source.html#l05509">bm_init_buffer_counters()</a>, <a class="el" href="midas_8c_source.html#l07495">bm_mark_read_waiting()</a>, <a class="el" href="midas_8c_source.html#l04389">bm_open_buffer()</a>, <a class="el" href="midas_8c_source.html#l06777">bm_receive_event()</a>, <a class="el" href="midas_8c_source.html#l05920">bm_remove_event_request()</a>, <a class="el" href="midas_8c_source.html#l06057">bm_send_event()</a>, <a class="el" href="midas_8c_source.html#l05589">bm_set_cache_size()</a>, <a class="el" href="midas_8c_source.html#l07109">bm_skip_event()</a>, <a class="el" href="midas_8c_source.html#l01646">cm_asctime()</a>, <a class="el" href="midas_8c_source.html#l05147">cm_cleanup()</a>, <a class="el" href="midas_8c_source.html#l02349">cm_connect_experiment1()</a>, <a class="el" href="midas_8c_source.html#l01863">cm_delete_client_info()</a>, <a class="el" href="midas_8c_source.html#l02768">cm_disconnect_experiment()</a>, <a class="el" href="midas_8c_source.html#l04219">cm_execute()</a>, <a class="el" href="midas_8c_source.html#l05069">cm_exist()</a>, <a class="el" href="midas_8c_source.html#l03134">cm_get_watchdog_info()</a>, <a class="el" href="midas_8c_source.html#l01049">cm_msg_log()</a>, <a class="el" href="midas_8c_source.html#l01118">cm_msg_log1()</a>, <a class="el" href="midas_8c_source.html#l01507">cm_msg_retrieve()</a>, <a class="el" href="midas_8c_source.html#l01976">cm_set_client_info()</a>, <a class="el" href="midas_8c_source.html#l03000">cm_set_watchdog_params()</a>, <a class="el" href="midas_8c_source.html#l01618">cm_synchronize()</a>, <a class="el" href="midas_8c_source.html#l01664">cm_time()</a>, <a class="el" href="midas_8c_source.html#l04166">cm_yield()</a>, <a class="el" href="odbedit_8c_source.html#l01415">command_loop()</a>, <a class="el" href="odb_8c_source.html#l06943">db_add_open_record()</a>, <a class="el" href="odb_8c_source.html#l07436">db_check_record()</a>, <a class="el" href="odb_8c_source.html#l01498">db_close_all_databases()</a>, <a class="el" href="odb_8c_source.html#l01305">db_close_database()</a>, <a class="el" href="odb_8c_source.html#l01721">db_create_key()</a>, <a class="el" href="odb_8c_source.html#l01960">db_create_link()</a>, <a class="el" href="odb_8c_source.html#l07266">db_create_record()</a>, <a class="el" href="odb_8c_source.html#l02160">db_delete_key()</a>, <a class="el" href="odb_8c_source.html#l03390">db_enum_key()</a>, <a class="el" href="odb_8c_source.html#l03480">db_enum_link()</a>, <a class="el" href="odb_8c_source.html#l02193">db_find_key()</a>, <a class="el" href="odb_8c_source.html#l02344">db_find_key1()</a>, <a class="el" href="odb_8c_source.html#l02489">db_find_link()</a>, <a class="el" href="odb_8c_source.html#l02650">db_find_link1()</a>, <a class="el" href="odb_8c_source.html#l01422">db_flush_database()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l04244">db_get_data1()</a>, <a class="el" href="odb_8c_source.html#l04376">db_get_data_index()</a>, <a class="el" href="odb_8c_source.html#l03722">db_get_key()</a>, <a class="el" href="odb_8c_source.html#l03840">db_get_key_info()</a>, <a class="el" href="odb_8c_source.html#l03782">db_get_key_time()</a>, <a class="el" href="odb_8c_source.html#l03567">db_get_next_link()</a>, <a class="el" href="odb_8c_source.html#l03064">db_get_open_records()</a>, <a class="el" href="odb_8c_source.html#l02907">db_get_path()</a>, <a class="el" href="odb_8c_source.html#l06770">db_get_record()</a>, <a class="el" href="odb_8c_source.html#l06684">db_get_record_size()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="odb_8c_source.html#l05138">db_load()</a>, <a class="el" href="odb_8c_source.html#l00993">db_open_database()</a>, <a class="el" href="odb_8c_source.html#l07025">db_remove_open_record()</a>, <a class="el" href="odb_8c_source.html#l03911">db_rename_key()</a>, <a class="el" href="odb_8c_source.html#l03984">db_reorder_key()</a>, <a class="el" href="odb_8c_source.html#l05878">db_save()</a>, <a class="el" href="odb_8c_source.html#l08155">db_send_changed_records()</a>, <a class="el" href="odb_8c_source.html#l01536">db_set_client_name()</a>, <a class="el" href="odb_8c_source.html#l04503">db_set_data()</a>, <a class="el" href="odb_8c_source.html#l04727">db_set_data_index()</a>, <a class="el" href="odb_8c_source.html#l04836">db_set_data_index2()</a>, <a class="el" href="odb_8c_source.html#l05019">db_set_mode()</a>, <a class="el" href="odb_8c_source.html#l04607">db_set_num_values()</a>, <a class="el" href="odb_8c_source.html#l06874">db_set_record()</a>, <a class="el" href="odb_8c_source.html#l03128">db_set_value()</a>, <a class="el" href="midas_8c_source.html#l15064">el_submit()</a>, <a class="el" href="midas_8c_source.html#l13907">hs_count_events()</a>, <a class="el" href="midas_8c_source.html#l14064">hs_count_vars()</a>, <a class="el" href="midas_8c_source.html#l13818">hs_enum_events()</a>, <a class="el" href="midas_8c_source.html#l14134">hs_enum_vars()</a>, <a class="el" href="midas_8c_source.html#l13985">hs_get_event_id()</a>, <a class="el" href="midas_8c_source.html#l14241">hs_get_var()</a>, <a class="el" href="midas_8c_source.html#l14339">hs_read()</a>, <a class="el" href="midas_8c_source.html#l13244">hs_set_path()</a>, <a class="el" href="mlogger_8c_source.html#l02998">log_system_history()</a>, <a class="el" href="midas_8c_source.html#l10305">rpc_flush_event()</a>, <a class="el" href="midas_8c_source.html#l10122">rpc_send_event()</a>, <a class="el" href="midas_8c_source.html#l12166">rpc_server_thread()</a>, and <a class="el" href="mana_8cpp_source.html#l02462">tr_stop()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09025"></a>09025          : <a class="code" href="group__msectionh.html#ga0090933001e7e1ddd52ed3f321bea957">rpc_is_remote</a>
<a name="l09026"></a>09026 
<a name="l09027"></a>09027   Purpose: Return <span class="keyword">true</span> <span class="keywordflow">if</span> program is <a class="code" href="mhttpd_8c.html#abc82b64a25110404c4a845a5e969b348">connected</a> to a remote server
<a name="l09028"></a>09028 
<a name="l09029"></a>09029   Input:
<a name="l09030"></a>09030    none
<a name="l09031"></a>09031 
<a name="l09032"></a>09032   Output:
<a name="l09033"></a>09033     none
<a name="l09034"></a>09034 
<a name="l09035"></a>09035   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l09036"></a>09036     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>    RPC connection <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>
<a name="l09037"></a>09037 
<a name="l09038"></a>09038 \********************************************************************/
<a name="l09039"></a>09039 {
<a name="l09040"></a>09040    <span class="keywordflow">return</span> <a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a> != 0;
<a name="l09041"></a>09041 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gab042f2574359fb87fb1a897b6d90fbfc"></a><!-- doxytag: member="midas.c::rpc_register_client" ref="gab042f2574359fb87fb1a897b6d90fbfc" args="(char *name, RPC_LIST *list)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_register_client </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structRPC__LIST.html">RPC_LIST</a> *&nbsp;</td>
          <td class="paramname"> <em>list</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox Register RPC client for standalone mode (without standard midas server) </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>list</em>&nbsp;</td><td>Array of <a class="el" href="structRPC__LIST.html">RPC_LIST</a> structures containing function <a class="el" href="namespaceIDs.html">IDs</a> and parameter definitions. The end of the list must be indicated by a function ID of zero. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>Name of this client </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>RPC_SUCCESS </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l08197">8197</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="mrpc_8c_source.html#l01289">rpc_get_internal_list()</a>, <a class="el" href="midas_8c_source.html#l08217">rpc_register_functions()</a>, <a class="el" href="midas_8c_source.html#l09394">rpc_set_name()</a>, and <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>.</p>

<p>Referenced by <a class="el" href="rpc__clnt_8c_source.html#l00070">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08198"></a>08198 {
<a name="l08199"></a>08199    <a class="code" href="group__msectionh.html#gaeeeea2e9156202fc493eef175b54b0f0">rpc_set_name</a>(<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>);
<a name="l08200"></a>08200    <a class="code" href="group__msectionh.html#gace7386854fda7aedbf0bcb25c2191dc5">rpc_register_functions</a>(<a class="code" href="group__msystemincludecode.html#ga3a79f51ccf8079dcd47c698bc8790c7c">rpc_get_internal_list</a>(0), NULL);
<a name="l08201"></a>08201    <a class="code" href="group__msectionh.html#gace7386854fda7aedbf0bcb25c2191dc5">rpc_register_functions</a>(list, NULL);
<a name="l08202"></a>08202 
<a name="l08203"></a>08203    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l08204"></a>08204 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gad79effdbfb43919e9d51a2067b389b13"></a><!-- doxytag: member="midas.c::rpc_register_function" ref="gad79effdbfb43919e9d51a2067b389b13" args="(INT id, INT(*func)(INT, void **))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_register_function </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>(*)(<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>, void **)&nbsp;</td>
          <td class="paramname"> <em>func</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l08300">8300</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="group__midasincludecode.html#gafdeeebdd58f83be10273ff95c6181462">RPC_LIST::dispatch</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="midas_8h_source.html#l01806">RPC_LIST::id</a>, <a class="el" href="midas_8h_source.html#l01074">RPC_INVALID_ID</a>, and <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l04255">cm_register_function()</a>, <a class="el" href="midas_8c_source.html#l03292">cm_register_transition()</a>, <a class="el" href="camacsrv_8c_source.html#l00155">main()</a>, <a class="el" href="crate3_2rpc__master_8cpp_source.html#l00055">rpc_master_init()</a>, and <a class="el" href="crate3_2rpc__slave_8cpp_source.html#l00082">rpc_slave_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08303"></a>08303          : <a class="code" href="group__msectionh.html#gacf172dd0442e5209b973690f0f07e0a1">rpc_register_function</a>
<a name="l08304"></a>08304 
<a name="l08305"></a>08305   Purpose: Replace a dispatch function <span class="keywordflow">for</span> a specific rpc routine
<a name="l08306"></a>08306 
<a name="l08307"></a>08307   Input:
<a name="l08308"></a>08308     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>      <span class="keywordtype">id</span>             RPC <a class="code" href="jorway73a_8h.html#a4bfe115debc7f472dd7dfe4ef9679ca0">ID</a>
<a name="l08309"></a>08309     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>      *func          New dispatch function
<a name="l08310"></a>08310 
<a name="l08311"></a>08311   Output:
<a name="l08312"></a>08312    &lt;implicit: func gets copied to <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>&gt;
<a name="l08313"></a>08313 
<a name="l08314"></a>08314   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l08315"></a>08315    <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>              Successful completion
<a name="l08316"></a>08316    <a class="code" href="group__err25.html#ga3cbff68ac5b5d52f692b8e880f9ef76c">RPC_INVALID_ID</a>           RPC <a class="code" href="jorway73a_8h.html#a4bfe115debc7f472dd7dfe4ef9679ca0">ID</a> not <a class="code" href="patch__mevb_8cpp.html#a408216eef095a35ba3963fc6f4f4d7a8">found</a>
<a name="l08317"></a>08317 
<a name="l08318"></a>08318 \********************************************************************/
<a name="l08319"></a>08319 {
<a name="l08320"></a>08320    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l08321"></a>08321 
<a name="l08322"></a>08322    <span class="keywordflow">for</span> (i = 0; <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a> != NULL &amp;&amp; <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].<a class="code" href="structRPC__LIST.html#a8d1379b84192a73bddbb9ed8e63b257a">id</a> != 0; i++)
<a name="l08323"></a>08323       <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].<span class="keywordtype">id</span> == <span class="keywordtype">id</span>)
<a name="l08324"></a>08324          <span class="keywordflow">break</span>;
<a name="l08325"></a>08325 
<a name="l08326"></a>08326    <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].<span class="keywordtype">id</span> == <span class="keywordtype">id</span>)
<a name="l08327"></a>08327       <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].<a class="code" href="group__midasincludecode.html#gafdeeebdd58f83be10273ff95c6181462">dispatch</a> = func;
<a name="l08328"></a>08328    <span class="keywordflow">else</span>
<a name="l08329"></a>08329       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga3cbff68ac5b5d52f692b8e880f9ef76c">RPC_INVALID_ID</a>;
<a name="l08330"></a>08330 
<a name="l08331"></a>08331    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l08332"></a>08332 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga0a28efa56a72e033207e5cb158740e1e"></a><!-- doxytag: member="midas.c::rpc_register_functions" ref="ga0a28efa56a72e033207e5cb158740e1e" args="(RPC_LIST *new_list, INT(*func)(INT, void **))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_register_functions </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRPC__LIST.html">RPC_LIST</a> *&nbsp;</td>
          <td class="paramname"> <em>new_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>(*)(<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>, void **)&nbsp;</td>
          <td class="paramname"> <em>func</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Register a set of RPC functions (both as clients or servers) </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>new_list</em>&nbsp;</td><td>Array of <a class="el" href="structRPC__LIST.html">RPC_LIST</a> structures containing function <a class="el" href="namespaceIDs.html">IDs</a> and parameter definitions. The end of the list must be indicated by a function ID of zero. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>func</em>&nbsp;</td><td>Default dispatch function</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>RPC_SUCCESS, RPC_NO_MEMORY, RPC_DOUBLE_DEFINED </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l08217">8217</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="group__midasincludecode.html#gafdeeebdd58f83be10273ff95c6181462">RPC_LIST::dispatch</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="midas_8h_source.html#l01806">RPC_LIST::id</a>, <a class="el" href="odbhist_8c_source.html#l00058">j</a>, <a class="el" href="midas_8h_source.html#l01753">M_MALLOC</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l01077">RPC_DOUBLE_DEFINED</a>, <a class="el" href="mrpc_8c_source.html#l01289">rpc_get_internal_list()</a>, <a class="el" href="midas_8h_source.html#l01815">RPC_MAX_ID</a>, <a class="el" href="midas_8h_source.html#l01814">RPC_MIN_ID</a>, <a class="el" href="midas_8h_source.html#l01076">RPC_NO_MEMORY</a>, and <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>.</p>

<p>Referenced by <a class="el" href="camacrpc_8c_source.html#l00073">cam_init_rpc()</a>, <a class="el" href="midas_8c_source.html#l02349">cm_connect_experiment1()</a>, <a class="el" href="midas_8c_source.html#l03186">cm_register_server()</a>, <a class="el" href="camacsrv_8c_source.html#l00155">main()</a>, <a class="el" href="crate3_2rpc__master_8cpp_source.html#l00055">rpc_master_init()</a>, <a class="el" href="midas_8c_source.html#l08197">rpc_register_client()</a>, <a class="el" href="midas_8c_source.html#l10866">rpc_register_server()</a>, <a class="el" href="midas_8c_source.html#l08657">rpc_server_connect()</a>, and <a class="el" href="crate3_2rpc__slave_8cpp_source.html#l00082">rpc_slave_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08218"></a>08218 {
<a name="l08219"></a>08219    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="odbhist_8c.html#a2df6784bd380a288cf2c3e7e2c43a6b8">j</a>, iold, inew;
<a name="l08220"></a>08220 
<a name="l08221"></a>08221    <span class="comment">/* count number of new functions */</span>
<a name="l08222"></a>08222    <span class="keywordflow">for</span> (i = 0; new_list[i].<a class="code" href="structRPC__LIST.html#a8d1379b84192a73bddbb9ed8e63b257a">id</a> != 0; i++) {
<a name="l08223"></a>08223       <span class="comment">/* check double defined functions */</span>
<a name="l08224"></a>08224       <span class="keywordflow">for</span> (j = 0; <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a> != NULL &amp;&amp; <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[j].<a class="code" href="structRPC__LIST.html#a8d1379b84192a73bddbb9ed8e63b257a">id</a> != 0; j++)
<a name="l08225"></a>08225          <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[j].<span class="keywordtype">id</span> == new_list[i].<span class="keywordtype">id</span>)
<a name="l08226"></a>08226             <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga68d214e584f6bcd6e91f25f1b9d79f54">RPC_DOUBLE_DEFINED</a>;
<a name="l08227"></a>08227    }
<a name="l08228"></a>08228    inew = i;
<a name="l08229"></a>08229 
<a name="l08230"></a>08230    <span class="comment">/* count number of existing functions */</span>
<a name="l08231"></a>08231    <span class="keywordflow">for</span> (i = 0; <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a> != NULL &amp;&amp; <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].<a class="code" href="structRPC__LIST.html#a8d1379b84192a73bddbb9ed8e63b257a">id</a> != 0; i++);
<a name="l08232"></a>08232    iold = i;
<a name="l08233"></a>08233 
<a name="l08234"></a>08234    <span class="comment">/* allocate new memory for rpc_list */</span>
<a name="l08235"></a>08235    <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a> == NULL)
<a name="l08236"></a>08236       <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a> = (<a class="code" href="structRPC__LIST.html">RPC_LIST</a> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(<span class="keyword">sizeof</span>(<a class="code" href="structRPC__LIST.html">RPC_LIST</a>) * (inew + 1));
<a name="l08237"></a>08237    <span class="keywordflow">else</span>
<a name="l08238"></a>08238       <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a> = (<a class="code" href="structRPC__LIST.html">RPC_LIST</a> *) realloc(<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>, <span class="keyword">sizeof</span>(<a class="code" href="structRPC__LIST.html">RPC_LIST</a>) * (iold + inew + 1));
<a name="l08239"></a>08239 
<a name="l08240"></a>08240    <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a> == NULL) {
<a name="l08241"></a>08241       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_register_functions&quot;</span>, <span class="stringliteral">&quot;out of memory&quot;</span>);
<a name="l08242"></a>08242       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga810bf4af4a5d29b1d1d1423e8889b35f">RPC_NO_MEMORY</a>;
<a name="l08243"></a>08243    }
<a name="l08244"></a>08244 
<a name="l08245"></a>08245    <span class="comment">/* append new functions */</span>
<a name="l08246"></a>08246    <span class="keywordflow">for</span> (i = iold; i &lt; iold + inew; i++) {
<a name="l08247"></a>08247       memcpy(<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a> + i, new_list + i - iold, <span class="keyword">sizeof</span>(<a class="code" href="structRPC__LIST.html">RPC_LIST</a>));
<a name="l08248"></a>08248 
<a name="l08249"></a>08249       <span class="comment">/* set default dispatcher */</span>
<a name="l08250"></a>08250       <span class="keywordflow">if</span> (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].dispatch == NULL)
<a name="l08251"></a>08251          <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].<a class="code" href="group__midasincludecode.html#gafdeeebdd58f83be10273ff95c6181462">dispatch</a> = func;
<a name="l08252"></a>08252 
<a name="l08253"></a>08253       <span class="comment">/* check valid ID for user functions */</span>
<a name="l08254"></a>08254       <span class="keywordflow">if</span> (new_list != <a class="code" href="group__msystemincludecode.html#ga3a79f51ccf8079dcd47c698bc8790c7c">rpc_get_internal_list</a>(0) &amp;&amp;
<a name="l08255"></a>08255           new_list != <a class="code" href="group__msystemincludecode.html#ga3a79f51ccf8079dcd47c698bc8790c7c">rpc_get_internal_list</a>(1) &amp;&amp;
<a name="l08256"></a>08256           (<a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].<span class="keywordtype">id</span> &lt; <a class="code" href="group__msectionh.html#ga2bec60df76c9b0a55ae6105466b572ea">RPC_MIN_ID</a> || <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].<span class="keywordtype">id</span> &gt; <a class="code" href="group__msectionh.html#ga2eeb6be6df70ae63b03e283b0824adb3">RPC_MAX_ID</a>))
<a name="l08257"></a>08257          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_register_functions&quot;</span>,
<a name="l08258"></a>08258                 <span class="stringliteral">&quot;registered RPC function with invalid ID&quot;</span>);
<a name="l08259"></a>08259    }
<a name="l08260"></a>08260 
<a name="l08261"></a>08261    <span class="comment">/* mark end of list */</span>
<a name="l08262"></a>08262    <a class="code" href="rpc__clnt_8c.html#a4defa2be69416de20c5e49014806bd59">rpc_list</a>[i].<a class="code" href="structRPC__LIST.html#a8d1379b84192a73bddbb9ed8e63b257a">id</a> = 0;
<a name="l08263"></a>08263 
<a name="l08264"></a>08264    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l08265"></a>08265 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga34bf3c9873a46b341ff78ea2328625f3"></a><!-- doxytag: member="midas.c::rpc_register_server" ref="ga34bf3c9873a46b341ff78ea2328625f3" args="(INT server_type, char *name, INT *port, INT(*func)(INT, void **))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_register_server </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>server_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> *&nbsp;</td>
          <td class="paramname"> <em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>(*)(<a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>, void **)&nbsp;</td>
          <td class="paramname"> <em>func</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l10866">10866</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="msystem_8h_source.html#l00652">CH_LISTEN</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="scs__310__ql355p_8c_source.html#l00055">flag</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l00692">MIDAS_TCP_PORT</a>, <a class="el" href="midas_8h_source.html#l00615">PTYPE</a>, <a class="el" href="midas_8c_source.html#l11860">rpc_client_accept()</a>, <a class="el" href="mrpc_8c_source.html#l01289">rpc_get_internal_list()</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8h_source.html#l00773">RPC_OSERVER_NAME</a>, <a class="el" href="midas_8h_source.html#l00772">RPC_OSERVER_TYPE</a>, <a class="el" href="midas_8c_source.html#l08217">rpc_register_functions()</a>, <a class="el" href="midas_8c_source.html#l11616">rpc_server_accept()</a>, <a class="el" href="midas_8c_source.html#l09308">rpc_set_server_option()</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="system_8c_source.html#l03182">ss_suspend_set_dispatch()</a>, <a class="el" href="midas_8h_source.html#l01795">ST_REMOTE</a>, <a class="el" href="midas_8h_source.html#l01794">ST_SUBPROCESS</a>, and <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l03186">cm_register_server()</a>, and <a class="el" href="camacsrv_8c_source.html#l00155">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10870"></a>10870          : <a class="code" href="group__msectionh.html#gac428a89411d42990fd01b1344f67465a">rpc_register_server</a>
<a name="l10871"></a>10871 
<a name="l10872"></a>10872   Purpose: Register the calling process as a MIDAS RPC server. Note
<a name="l10873"></a>10873            that cm_connnect_experiment must be called prior to any <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a> of
<a name="l10874"></a>10874            <a class="code" href="group__msectionh.html#gac428a89411d42990fd01b1344f67465a">rpc_register_server</a>.
<a name="l10875"></a>10875 
<a name="l10876"></a>10876   Input:
<a name="l10877"></a>10877     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   server_type       One of the following constants:
<a name="l10878"></a>10878                             <a class="code" href="group__msectionh.html#gafd1f60d6275582530d610f3a599cb270">ST_SINGLE</a>: <span class="keyword">register</span> a single process server
<a name="l10879"></a>10879                             <a class="code" href="group__msectionh.html#ga88fcaca68212b5824a0b0f6c9507ebcb">ST_MTHREAD</a>: <span class="keywordflow">for each</span> connection, start
<a name="l10880"></a>10880                                         a <span class="keyword">new</span> thread to serve it
<a name="l10881"></a>10881                             <a class="code" href="group__msectionh.html#ga46a8d5e07e003fc4021c7f05371a2a92">ST_MPROCESS</a>: <span class="keywordflow">for each</span> connection, start
<a name="l10882"></a>10882                                          a <span class="keyword">new</span> process to server it
<a name="l10883"></a>10883                             <a class="code" href="group__msectionh.html#gac882709a084d5b60f95fe6fa372d7ea7">ST_SUBPROCESS</a>: the routine was called from
<a name="l10884"></a>10884                                            a multi process server
<a name="l10885"></a>10885                             <a class="code" href="group__msectionh.html#ga9c6b34250ccc696d64a6a0a572947be5">ST_REMOTE</a>: <span class="keyword">register</span> a client program server
<a name="l10886"></a>10886                                        <a class="code" href="mhttpd_8c.html#abc82b64a25110404c4a845a5e969b348">connected</a> to the ODB
<a name="l10887"></a>10887     <span class="keywordtype">char</span>  *<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>             Name of .EXE file to start <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> MPROCESS <a class="code" href="mscbutil_8c.html#a74b654271a172a244c844fb86277cd8a">mode</a>
<a name="l10888"></a>10888     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   *port             TCP port <span class="keywordflow">for</span> listen. NULL <span class="keywordflow">if</span> listen as <a class="code" href="mucap__compress_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>
<a name="l10889"></a>10889                             server (<a class="code" href="group__midasincludecode.html#ga5e0ae79a5bfdb2f6fc9840d149d702a5">MIDAS_TCP_PORT</a> is then used). If *port=0,
<a name="l10890"></a>10890                             the OS chooses a free port <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> returns it. If
<a name="l10891"></a>10891                             *port != 0, <span class="keyword">this</span> port is used.
<a name="l10892"></a>10892     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   *func             Default dispatch function
<a name="l10893"></a>10893 
<a name="l10894"></a>10894   Output:
<a name="l10895"></a>10895     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>   *port             Port under which server is listening.
<a name="l10896"></a>10896 
<a name="l10897"></a>10897   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l10898"></a>10898     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l10899"></a>10899     <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>           Error <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> socket <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a>
<a name="l10900"></a>10900     <a class="code" href="group__err25.html#ga8e46f3de256d0dc247efd6386b5b5a39">RPC_NOT_REGISTERED</a>      <a class="code" href="group__msectionh.html#gae12b15703f10f41044e599520e665f5a">cm_connect_experiment</a> was not called
<a name="l10901"></a>10901 
<a name="l10902"></a>10902 \********************************************************************/
<a name="l10903"></a>10903 {
<a name="l10904"></a>10904    <span class="keyword">struct </span>sockaddr_in bind_addr;
<a name="l10905"></a>10905    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a>;
<a name="l10906"></a>10906    <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l10907"></a>10907 
<a name="l10908"></a>10908 <span class="preprocessor">#ifdef OS_WINNT</span>
<a name="l10909"></a>10909 <span class="preprocessor"></span>   {
<a name="l10910"></a>10910       WSADATA WSAData;
<a name="l10911"></a>10911 
<a name="l10912"></a>10912       <span class="comment">/* Start windows sockets */</span>
<a name="l10913"></a>10913       <span class="keywordflow">if</span> (WSAStartup(MAKEWORD(1, 1), &amp;WSAData) != 0)
<a name="l10914"></a>10914          <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l10915"></a>10915    }
<a name="l10916"></a>10916 <span class="preprocessor">#endif</span>
<a name="l10917"></a>10917 <span class="preprocessor"></span>
<a name="l10918"></a>10918    <a class="code" href="group__msystemincludecode.html#gaec24042a470eec42ec344d7fc552d4f5">rpc_set_server_option</a>(<a class="code" href="group__mdefineh.html#ga7f6354019d48c7beeb8f5bd5c2fac8bb">RPC_OSERVER_TYPE</a>, server_type);
<a name="l10919"></a>10919 
<a name="l10920"></a>10920    <span class="comment">/* register system functions */</span>
<a name="l10921"></a>10921    <a class="code" href="group__msectionh.html#gace7386854fda7aedbf0bcb25c2191dc5">rpc_register_functions</a>(<a class="code" href="group__msystemincludecode.html#ga3a79f51ccf8079dcd47c698bc8790c7c">rpc_get_internal_list</a>(0), func);
<a name="l10922"></a>10922 
<a name="l10923"></a>10923    <span class="keywordflow">if</span> (<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a> != NULL)
<a name="l10924"></a>10924       <a class="code" href="group__msystemincludecode.html#gaec24042a470eec42ec344d7fc552d4f5">rpc_set_server_option</a>(<a class="code" href="group__mdefineh.html#ga1caa8de36fbdd251b67fd4601d0e708f">RPC_OSERVER_NAME</a>, (<a class="code" href="group__midasincludecode.html#ga790216a8e71233fed28657b16a052e36">PTYPE</a>) <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>);
<a name="l10925"></a>10925 
<a name="l10926"></a>10926    <span class="comment">/* in subprocess mode, don&apos;t start listener */</span>
<a name="l10927"></a>10927    <span class="keywordflow">if</span> (server_type == <a class="code" href="group__msectionh.html#gac882709a084d5b60f95fe6fa372d7ea7">ST_SUBPROCESS</a>)
<a name="l10928"></a>10928       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l10929"></a>10929 
<a name="l10930"></a>10930    <span class="comment">/* create a socket for listening */</span>
<a name="l10931"></a>10931    <a class="code" href="group__rpcfunctionc.html#ga697ab24f60fe31109c15eef59cb5546f">_lsock</a> = socket(AF_INET, SOCK_STREAM, 0);
<a name="l10932"></a>10932    <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga697ab24f60fe31109c15eef59cb5546f">_lsock</a> == -1) {
<a name="l10933"></a>10933       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_register_server&quot;</span>, <span class="stringliteral">&quot;socket() failed&quot;</span>);
<a name="l10934"></a>10934       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l10935"></a>10935    }
<a name="l10936"></a>10936 
<a name="l10937"></a>10937    <span class="comment">/* reuse address, needed if previous server stopped (30s timeout!) */</span>
<a name="l10938"></a>10938    flag = 1;
<a name="l10939"></a>10939    status = setsockopt(<a class="code" href="group__rpcfunctionc.html#ga697ab24f60fe31109c15eef59cb5546f">_lsock</a>, SOL_SOCKET, SO_REUSEADDR, (<span class="keywordtype">char</span> *) &amp;flag, <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>));
<a name="l10940"></a>10940    <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l10941"></a>10941       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_register_server&quot;</span>, <span class="stringliteral">&quot;setsockopt() failed&quot;</span>);
<a name="l10942"></a>10942       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l10943"></a>10943    }
<a name="l10944"></a>10944 
<a name="l10945"></a>10945    <span class="comment">/* bind local node name and port to socket */</span>
<a name="l10946"></a>10946    memset(&amp;bind_addr, 0, <span class="keyword">sizeof</span>(bind_addr));
<a name="l10947"></a>10947    bind_addr.sin_family = AF_INET;
<a name="l10948"></a>10948    bind_addr.sin_addr.s_addr = htonl(INADDR_ANY);
<a name="l10949"></a>10949 
<a name="l10950"></a>10950    <span class="keywordflow">if</span> (!port)
<a name="l10951"></a>10951       bind_addr.sin_port = htons(<a class="code" href="group__midasincludecode.html#ga5e0ae79a5bfdb2f6fc9840d149d702a5">MIDAS_TCP_PORT</a>);
<a name="l10952"></a>10952    <span class="keywordflow">else</span>
<a name="l10953"></a>10953       bind_addr.sin_port = htons((<span class="keywordtype">short</span>) (*port));
<a name="l10954"></a>10954 
<a name="l10955"></a>10955    status = bind(<a class="code" href="group__rpcfunctionc.html#ga697ab24f60fe31109c15eef59cb5546f">_lsock</a>, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, <span class="keyword">sizeof</span>(bind_addr));
<a name="l10956"></a>10956    <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l10957"></a>10957       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_register_server&quot;</span>, <span class="stringliteral">&quot;bind() failed: %s&quot;</span>, strerror(errno));
<a name="l10958"></a>10958       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l10959"></a>10959    }
<a name="l10960"></a>10960 
<a name="l10961"></a>10961    <span class="comment">/* listen for connection */</span>
<a name="l10962"></a>10962 <span class="preprocessor">#ifdef OS_MSDOS</span>
<a name="l10963"></a>10963 <span class="preprocessor"></span>   status = listen(<a class="code" href="group__rpcfunctionc.html#ga697ab24f60fe31109c15eef59cb5546f">_lsock</a>, 1);
<a name="l10964"></a>10964 <span class="preprocessor">#else</span>
<a name="l10965"></a>10965 <span class="preprocessor"></span>   status = listen(<a class="code" href="group__rpcfunctionc.html#ga697ab24f60fe31109c15eef59cb5546f">_lsock</a>, SOMAXCONN);
<a name="l10966"></a>10966 <span class="preprocessor">#endif</span>
<a name="l10967"></a>10967 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l10968"></a>10968       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_register_server&quot;</span>, <span class="stringliteral">&quot;listen() failed&quot;</span>);
<a name="l10969"></a>10969       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l10970"></a>10970    }
<a name="l10971"></a>10971 
<a name="l10972"></a>10972    <span class="comment">/* return port wich OS has choosen */</span>
<a name="l10973"></a>10973    <span class="keywordflow">if</span> (port &amp;&amp; *port == 0) {
<a name="l10974"></a>10974       size = <span class="keyword">sizeof</span>(bind_addr);
<a name="l10975"></a>10975       getsockname(<a class="code" href="group__rpcfunctionc.html#ga697ab24f60fe31109c15eef59cb5546f">_lsock</a>, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, (<span class="keywordtype">int</span> *) &amp;size);
<a name="l10976"></a>10976       *port = ntohs(bind_addr.sin_port);
<a name="l10977"></a>10977    }
<a name="l10978"></a>10978 
<a name="l10979"></a>10979    <span class="comment">/* define callbacks for ss_suspend */</span>
<a name="l10980"></a>10980    <span class="keywordflow">if</span> (server_type == <a class="code" href="group__msectionh.html#ga9c6b34250ccc696d64a6a0a572947be5">ST_REMOTE</a>)
<a name="l10981"></a>10981       <a class="code" href="group__msystemincludecode.html#gac1b39a6f689a24e9aaf239ee73a81b15">ss_suspend_set_dispatch</a>(<a class="code" href="group__msystemincludecode.html#gaf03677bed1e21f7cadca7ea1bc294393">CH_LISTEN</a>, &amp;<a class="code" href="group__rpcfunctionc.html#ga697ab24f60fe31109c15eef59cb5546f">_lsock</a>, (<span class="keywordtype">int</span> (*)(<span class="keywordtype">void</span>)) <a class="code" href="group__msystemincludecode.html#ga631be6fb4a9b1560261255f19eb123c0">rpc_client_accept</a>);
<a name="l10982"></a>10982    <span class="keywordflow">else</span>
<a name="l10983"></a>10983       <a class="code" href="group__msystemincludecode.html#gac1b39a6f689a24e9aaf239ee73a81b15">ss_suspend_set_dispatch</a>(<a class="code" href="group__msystemincludecode.html#gaf03677bed1e21f7cadca7ea1bc294393">CH_LISTEN</a>, &amp;<a class="code" href="group__rpcfunctionc.html#ga697ab24f60fe31109c15eef59cb5546f">_lsock</a>, (<span class="keywordtype">int</span> (*)(<span class="keywordtype">void</span>)) <a class="code" href="group__msystemincludecode.html#ga59beafb3b61407fa2c180804756847d7">rpc_server_accept</a>);
<a name="l10984"></a>10984 
<a name="l10985"></a>10985    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l10986"></a>10986 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga7bd9c61bcbc2b20c32d0c6cd73865766"></a><!-- doxytag: member="midas.c::rpc_send_event" ref="ga7bd9c61bcbc2b20c32d0c6cd73865766" args="(INT buffer_handle, void *source, INT buf_size, INT async_flag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_send_event </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>buffer_handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>buf_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>async_flag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox Fast send_event routine which bypasses the RPC layer and sends the event directly at the TCP level. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buffer_handle</em>&nbsp;</td><td>Handle of the buffer to send the event to. Must be obtained via bm_open_buffer. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>source</em>&nbsp;</td><td>Address of the event to send. It must have a proper event header. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buf_size</em>&nbsp;</td><td>Size of event in bytes with header. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>async_flag</em>&nbsp;</td><td>SYNC / ASYNC flag. In ASYNC mode, the function returns immediately if it cannot send the event over the network. In SYNC mode, it waits until the packet is sent (blocking).</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>BM_INVALID_PARAM, BM_ASYNC_RETURN, RPC_SUCCESS, RPC_NET_ERROR, RPC_NO_CONNECTION, RPC_EXCEED_BUFFER </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l10122">10122</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l00827">_tcp_buffer</a>, <a class="el" href="midas_8c_source.html#l00829">_tcp_rp</a>, <a class="el" href="midas_8c_source.html#l00828">_tcp_wp</a>, <a class="el" href="midas_8h_source.html#l00904">ALIGN8</a>, <a class="el" href="midas_8h_source.html#l00756">ASYNC</a>, <a class="el" href="midas_8h_source.html#l00985">BM_ASYNC_RETURN</a>, <a class="el" href="midas_8h_source.html#l00991">BM_INVALID_PARAM</a>, <a class="el" href="midas_8c_source.html#l06057">bm_send_event()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="v1724__module_8c_source.html#l00027">data_size</a>, <a class="el" href="scs__310__ql355p_8c_source.html#l00055">flag</a>, <a class="el" href="msystem_8h_source.html#l00386">NET_COMMAND::header</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="midas_8h_source.html#l01753">M_MALLOC</a>, <a class="el" href="midas_8h_source.html#l00677">MAX_EVENT_SIZE</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l00671">NET_TCP_SIZE</a>, <a class="el" href="msystem_8h_source.html#l00387">NET_COMMAND::param</a>, <a class="el" href="msystem_8h_source.html#l00382">NET_COMMAND_HEADER::param_size</a>, <a class="el" href="msystem_8h_source.html#l00381">NET_COMMAND_HEADER::routine_id</a>, <a class="el" href="mrpc_8h_source.html#l00125">RPC_BM_SEND_EVENT</a>, <a class="el" href="midas_8h_source.html#l01071">RPC_EXCEED_BUFFER</a>, <a class="el" href="midas_8c_source.html#l09022">rpc_is_remote()</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="msystem_8h_source.html#l00436">RPC_SERVER_CONNECTION::send_sock</a>, <a class="el" href="system_8c_source.html#l03606">send_tcp()</a>, and <a class="el" href="msystem_8h_source.html#l00397">TCP_FAST</a>.</p>

<p>Referenced by <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l01263">interrupt_routine()</a>, <a class="el" href="minife_8c_source.html#l00065">main()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l01446">scheduler()</a>, and <a class="el" href="mevb_8cpp_source.html#l00916">source_scan()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10123"></a>10123 {
<a name="l10124"></a>10124    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l10125"></a>10125    <a class="code" href="structNET__COMMAND.html">NET_COMMAND</a> *nc;
<a name="l10126"></a>10126    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a>;
<a name="l10127"></a>10127    <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a> would_block = 0;
<a name="l10128"></a>10128    <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> aligned_buf_size;
<a name="l10129"></a>10129 
<a name="l10130"></a>10130    aligned_buf_size = <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(buf_size);
<a name="l10131"></a>10131 
<a name="l10132"></a>10132    <span class="keywordflow">if</span> (aligned_buf_size !=
<a name="l10133"></a>10133        (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>) <a class="code" href="group__mmacroh.html#ga46bf3ace1698ee72389c30bc61d78686">ALIGN8</a>(((<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *) source)-&gt;<a class="code" href="v1724__module_8c.html#af9bcc453896ea532710141c5a10fd347">data_size</a> + <span class="keyword">sizeof</span>(<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a>))) {
<a name="l10134"></a>10134       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_send_event&quot;</span>, <span class="stringliteral">&quot;event size mismatch&quot;</span>);
<a name="l10135"></a>10135       <span class="keywordflow">return</span> <a class="code" href="group__err22.html#ga09095b8ac6e057d3094c99e485c1a74d">BM_INVALID_PARAM</a>;
<a name="l10136"></a>10136    }
<a name="l10137"></a>10137    <span class="keywordflow">if</span> (((<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *) source)-&gt;<a class="code" href="v1724__module_8c.html#af9bcc453896ea532710141c5a10fd347">data_size</a> &gt; <a class="code" href="group__midasincludecode.html#ga05d5acc365e3342523d84bc4540adc09">MAX_EVENT_SIZE</a>) {
<a name="l10138"></a>10138       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_send_event&quot;</span>,
<a name="l10139"></a>10139              <span class="stringliteral">&quot;event size (%d) larger than maximum event size (%d)&quot;</span>,
<a name="l10140"></a>10140              ((<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *) source)-&gt;<a class="code" href="v1724__module_8c.html#af9bcc453896ea532710141c5a10fd347">data_size</a>, <a class="code" href="group__midasincludecode.html#ga05d5acc365e3342523d84bc4540adc09">MAX_EVENT_SIZE</a>);
<a name="l10141"></a>10141       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga1a35d5e05d16d9040eaad41c4434a20a">RPC_EXCEED_BUFFER</a>;
<a name="l10142"></a>10142    }
<a name="l10143"></a>10143 
<a name="l10144"></a>10144    <span class="keywordflow">if</span> (!<a class="code" href="group__msectionh.html#ga0090933001e7e1ddd52ed3f321bea957">rpc_is_remote</a>())
<a name="l10145"></a>10145       <span class="keywordflow">return</span> <a class="code" href="group__msectionh.html#ga5ebc713e2f1e7f0b6d257f072221321f">bm_send_event</a>(buffer_handle, source, buf_size, async_flag);
<a name="l10146"></a>10146 
<a name="l10147"></a>10147    <span class="comment">/* init network buffer */</span>
<a name="l10148"></a>10148    <span class="keywordflow">if</span> (!<a class="code" href="group__midasincludecode.html#gacd9469118baa2f8ab14235bace996e5a">_tcp_buffer</a>)
<a name="l10149"></a>10149       <a class="code" href="group__midasincludecode.html#gacd9469118baa2f8ab14235bace996e5a">_tcp_buffer</a> = (<span class="keywordtype">char</span> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(<a class="code" href="group__midasincludecode.html#ga31190e25ed33be085ff0af476af2c029">NET_TCP_SIZE</a>);
<a name="l10150"></a>10150    <span class="keywordflow">if</span> (!<a class="code" href="group__midasincludecode.html#gacd9469118baa2f8ab14235bace996e5a">_tcp_buffer</a>) {
<a name="l10151"></a>10151       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_send_event&quot;</span>, <span class="stringliteral">&quot;not enough memory to allocate network buffer&quot;</span>);
<a name="l10152"></a>10152       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga1a35d5e05d16d9040eaad41c4434a20a">RPC_EXCEED_BUFFER</a>;
<a name="l10153"></a>10153    }
<a name="l10154"></a>10154 
<a name="l10155"></a>10155    <span class="comment">/* check if not enough space in TCP buffer */</span>
<a name="l10156"></a>10156    <span class="keywordflow">if</span> (aligned_buf_size + 4 * 8 + <span class="keyword">sizeof</span>(<a class="code" href="structNET__COMMAND__HEADER.html">NET_COMMAND_HEADER</a>) &gt;=
<a name="l10157"></a>10157        (<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>) (<a class="code" href="group__rpcfunctionc.html#ga20e63d0a316b30ec4fbd8766dd04c52d">_opt_tcp_size</a> - <a class="code" href="group__midasincludecode.html#ga9f73f302a0b2c383713fff5762b00145">_tcp_wp</a>) &amp;&amp; <a class="code" href="group__midasincludecode.html#ga9f73f302a0b2c383713fff5762b00145">_tcp_wp</a> != <a class="code" href="group__midasincludecode.html#ga1eceed672fe2ba3756951a772b4ae008">_tcp_rp</a>) {
<a name="l10158"></a>10158       <span class="comment">/* set socket to nonblocking IO */</span>
<a name="l10159"></a>10159       <span class="keywordflow">if</span> (async_flag == <a class="code" href="group__mdefineh.html#gad28b60868b6548c43e7a18f30c9b2022">ASYNC</a>) {
<a name="l10160"></a>10160          flag = 1;
<a name="l10161"></a>10161 <span class="preprocessor">#ifdef OS_VXWORKS</span>
<a name="l10162"></a>10162 <span class="preprocessor"></span>         ioctlsocket(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a>, FIONBIO, (<span class="keywordtype">int</span>) &amp;flag);
<a name="l10163"></a>10163 <span class="preprocessor">#else</span>
<a name="l10164"></a>10164 <span class="preprocessor"></span>         ioctlsocket(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a>, FIONBIO, &amp;flag);
<a name="l10165"></a>10165 <span class="preprocessor">#endif</span>
<a name="l10166"></a>10166 <span class="preprocessor"></span>      }
<a name="l10167"></a>10167 
<a name="l10168"></a>10168       i = <a class="code" href="group__msystemincludecode.html#gae657f73f38c098645aab383053478d59">send_tcp</a>(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a>,
<a name="l10169"></a>10169                    <a class="code" href="group__midasincludecode.html#gacd9469118baa2f8ab14235bace996e5a">_tcp_buffer</a> + <a class="code" href="group__midasincludecode.html#ga1eceed672fe2ba3756951a772b4ae008">_tcp_rp</a>, <a class="code" href="group__midasincludecode.html#ga9f73f302a0b2c383713fff5762b00145">_tcp_wp</a> - <a class="code" href="group__midasincludecode.html#ga1eceed672fe2ba3756951a772b4ae008">_tcp_rp</a>, 0);
<a name="l10170"></a>10170 
<a name="l10171"></a>10171       <span class="keywordflow">if</span> (i &lt; 0)
<a name="l10172"></a>10172 <span class="preprocessor">#ifdef OS_WINNT</span>
<a name="l10173"></a>10173 <span class="preprocessor"></span>         would_block = (WSAGetLastError() == WSAEWOULDBLOCK);
<a name="l10174"></a>10174 <span class="preprocessor">#else</span>
<a name="l10175"></a>10175 <span class="preprocessor"></span>         would_block = (errno == EWOULDBLOCK);
<a name="l10176"></a>10176 <span class="preprocessor">#endif</span>
<a name="l10177"></a>10177 <span class="preprocessor"></span>
<a name="l10178"></a>10178       <span class="comment">/* set socket back to blocking IO */</span>
<a name="l10179"></a>10179       <span class="keywordflow">if</span> (async_flag == <a class="code" href="group__mdefineh.html#gad28b60868b6548c43e7a18f30c9b2022">ASYNC</a>) {
<a name="l10180"></a>10180          flag = 0;
<a name="l10181"></a>10181 <span class="preprocessor">#ifdef OS_VXWORKS</span>
<a name="l10182"></a>10182 <span class="preprocessor"></span>         ioctlsocket(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a>, FIONBIO, (<span class="keywordtype">int</span>) &amp;flag);
<a name="l10183"></a>10183 <span class="preprocessor">#else</span>
<a name="l10184"></a>10184 <span class="preprocessor"></span>         ioctlsocket(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a>, FIONBIO, &amp;flag);
<a name="l10185"></a>10185 <span class="preprocessor">#endif</span>
<a name="l10186"></a>10186 <span class="preprocessor"></span>      }
<a name="l10187"></a>10187 
<a name="l10188"></a>10188       <span class="comment">/* increment read pointer */</span>
<a name="l10189"></a>10189       <span class="keywordflow">if</span> (i &gt; 0)
<a name="l10190"></a>10190          <a class="code" href="group__midasincludecode.html#ga1eceed672fe2ba3756951a772b4ae008">_tcp_rp</a> += i;
<a name="l10191"></a>10191 
<a name="l10192"></a>10192       <span class="comment">/* check if whole buffer is sent */</span>
<a name="l10193"></a>10193       <span class="keywordflow">if</span> (<a class="code" href="group__midasincludecode.html#ga1eceed672fe2ba3756951a772b4ae008">_tcp_rp</a> == <a class="code" href="group__midasincludecode.html#ga9f73f302a0b2c383713fff5762b00145">_tcp_wp</a>)
<a name="l10194"></a>10194          <a class="code" href="group__midasincludecode.html#ga1eceed672fe2ba3756951a772b4ae008">_tcp_rp</a> = <a class="code" href="group__midasincludecode.html#ga9f73f302a0b2c383713fff5762b00145">_tcp_wp</a> = 0;
<a name="l10195"></a>10195 
<a name="l10196"></a>10196       <span class="keywordflow">if</span> (i &lt; 0 &amp;&amp; !would_block) {
<a name="l10197"></a>10197          printf(<span class="stringliteral">&quot;send_tcp() returned %d\n&quot;</span>, i);
<a name="l10198"></a>10198          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_send_event&quot;</span>, <span class="stringliteral">&quot;send_tcp() failed&quot;</span>);
<a name="l10199"></a>10199          <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l10200"></a>10200       }
<a name="l10201"></a>10201 
<a name="l10202"></a>10202       <span class="comment">/* return if buffer is not emptied */</span>
<a name="l10203"></a>10203       <span class="keywordflow">if</span> (<a class="code" href="group__midasincludecode.html#ga9f73f302a0b2c383713fff5762b00145">_tcp_wp</a> &gt; 0)
<a name="l10204"></a>10204          <span class="keywordflow">return</span> <a class="code" href="group__err22.html#ga7fb11aaff606b1785cddd205baddbbff">BM_ASYNC_RETURN</a>;
<a name="l10205"></a>10205    }
<a name="l10206"></a>10206 
<a name="l10207"></a>10207    nc = (<a class="code" href="structNET__COMMAND.html">NET_COMMAND</a> *) (<a class="code" href="group__midasincludecode.html#gacd9469118baa2f8ab14235bace996e5a">_tcp_buffer</a> + <a class="code" href="group__midasincludecode.html#ga9f73f302a0b2c383713fff5762b00145">_tcp_wp</a>);
<a name="l10208"></a>10208    nc-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#a9805c951be630cb91f6cf5e5fd8a34f4">routine_id</a> = <a class="code" href="group__mrpcdefineh.html#ga1e44640630aa4a9a60e344cde968587b">RPC_BM_SEND_EVENT</a> | <a class="code" href="group__msystemincludecode.html#gaf6ab4dadaddd91351342b1e81f73dedb">TCP_FAST</a>;
<a name="l10209"></a>10209    nc-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#ae0c91723d3f4843639e659ccde63dc5a">param_size</a> = 4 * 8 + aligned_buf_size;
<a name="l10210"></a>10210 
<a name="l10211"></a>10211    <span class="comment">/* assemble parameters manually */</span>
<a name="l10212"></a>10212    *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) (&amp;nc-&gt;<a class="code" href="structNET__COMMAND.html#a53f81d5350a50df99246d335dd703c63">param</a>[0])) = buffer_handle;
<a name="l10213"></a>10213    *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) (&amp;nc-&gt;<a class="code" href="structNET__COMMAND.html#a53f81d5350a50df99246d335dd703c63">param</a>[8])) = buf_size;
<a name="l10214"></a>10214 
<a name="l10215"></a>10215    <span class="comment">/* send events larger than optimal buffer size directly */</span>
<a name="l10216"></a>10216    <span class="keywordflow">if</span> (aligned_buf_size + 4 * 8 + <span class="keyword">sizeof</span>(<a class="code" href="structNET__COMMAND__HEADER.html">NET_COMMAND_HEADER</a>) &gt;= (<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>) <a class="code" href="group__rpcfunctionc.html#ga20e63d0a316b30ec4fbd8766dd04c52d">_opt_tcp_size</a>) {
<a name="l10217"></a>10217       <span class="comment">/* send header */</span>
<a name="l10218"></a>10218       <a class="code" href="group__msystemincludecode.html#gae657f73f38c098645aab383053478d59">send_tcp</a>(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a>,
<a name="l10219"></a>10219                <a class="code" href="group__midasincludecode.html#gacd9469118baa2f8ab14235bace996e5a">_tcp_buffer</a> + <a class="code" href="group__midasincludecode.html#ga9f73f302a0b2c383713fff5762b00145">_tcp_wp</a>, <span class="keyword">sizeof</span>(<a class="code" href="structNET__COMMAND__HEADER.html">NET_COMMAND_HEADER</a>) + 16, 0);
<a name="l10220"></a>10220 
<a name="l10221"></a>10221       <span class="comment">/* send data */</span>
<a name="l10222"></a>10222       <a class="code" href="group__msystemincludecode.html#gae657f73f38c098645aab383053478d59">send_tcp</a>(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a>, (<span class="keywordtype">char</span> *) source, aligned_buf_size, 0);
<a name="l10223"></a>10223 
<a name="l10224"></a>10224       <span class="comment">/* send last two parameters */</span>
<a name="l10225"></a>10225       *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) (&amp;nc-&gt;<a class="code" href="structNET__COMMAND.html#a53f81d5350a50df99246d335dd703c63">param</a>[0])) = buf_size;
<a name="l10226"></a>10226       *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) (&amp;nc-&gt;<a class="code" href="structNET__COMMAND.html#a53f81d5350a50df99246d335dd703c63">param</a>[8])) = 0;
<a name="l10227"></a>10227       <a class="code" href="group__msystemincludecode.html#gae657f73f38c098645aab383053478d59">send_tcp</a>(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a>, &amp;nc-&gt;<a class="code" href="structNET__COMMAND.html#a53f81d5350a50df99246d335dd703c63">param</a>[0], 16, 0);
<a name="l10228"></a>10228    } <span class="keywordflow">else</span> {
<a name="l10229"></a>10229       <span class="comment">/* copy event */</span>
<a name="l10230"></a>10230       memcpy(&amp;nc-&gt;<a class="code" href="structNET__COMMAND.html#a53f81d5350a50df99246d335dd703c63">param</a>[16], source, buf_size);
<a name="l10231"></a>10231 
<a name="l10232"></a>10232       <span class="comment">/* last two parameters (buf_size and async_flag */</span>
<a name="l10233"></a>10233       *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) (&amp;nc-&gt;<a class="code" href="structNET__COMMAND.html#a53f81d5350a50df99246d335dd703c63">param</a>[16 + aligned_buf_size])) = buf_size;
<a name="l10234"></a>10234       *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) (&amp;nc-&gt;<a class="code" href="structNET__COMMAND.html#a53f81d5350a50df99246d335dd703c63">param</a>[24 + aligned_buf_size])) = 0;
<a name="l10235"></a>10235 
<a name="l10236"></a>10236       <a class="code" href="group__midasincludecode.html#ga9f73f302a0b2c383713fff5762b00145">_tcp_wp</a> += nc-&gt;<a class="code" href="structNET__COMMAND.html#a4427c9f240aabad9b39e98431ecc6ecf">header</a>.<a class="code" href="structNET__COMMAND__HEADER.html#ae0c91723d3f4843639e659ccde63dc5a">param_size</a> + <span class="keyword">sizeof</span>(<a class="code" href="structNET__COMMAND__HEADER.html">NET_COMMAND_HEADER</a>);
<a name="l10237"></a>10237    }
<a name="l10238"></a>10238 
<a name="l10239"></a>10239    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l10240"></a>10240 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gabe636d94f1b2a43d9dfb726317c39bfa"></a><!-- doxytag: member="midas.c::rpc_server_accept" ref="gabe636d94f1b2a43d9dfb726317c39bfa" args="(int lsock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_server_accept </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>lsock</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l11616">11616</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l00834">_debug_mode</a>, <a class="el" href="melog_8c_source.html#l00085">closesocket</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8c_source.html#l01771">cm_scan_experiments()</a>, <a class="el" href="msystem_8h_source.html#l00413">callback_addr::debug</a>, <a class="el" href="midas_8c_source.html#l01755">experiment_table::directory</a>, <a class="el" href="msystem_8h_source.html#l00415">callback_addr::directory</a>, <a class="el" href="odb_8c_source.html#l01693">equal_ustring()</a>, <a class="el" href="msystem_8h_source.html#l00414">callback_addr::experiment</a>, <a class="el" href="msystem_8h_source.html#l00409">callback_addr::host_name</a>, <a class="el" href="msystem_8h_source.html#l00410">callback_addr::host_port1</a>, <a class="el" href="msystem_8h_source.html#l00411">callback_addr::host_port2</a>, <a class="el" href="msystem_8h_source.html#l00412">callback_addr::host_port3</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="msystem_8h_source.html#l00417">callback_addr::index</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="midas_8h_source.html#l00687">MAX_EXPERIMENT</a>, <a class="el" href="msystem_8h_source.html#l00255">MAX_RPC_CONNECTION</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8c_source.html#l01754">experiment_table::name</a>, <a class="el" href="rpc_8c_source.html#l00293">net_buffer</a>, <a class="el" href="system_8c_source.html#l03660">recv_string()</a>, <a class="el" href="midas_8c_source.html#l09447">rpc_debug_printf()</a>, <a class="el" href="midas_8c_source.html#l09250">rpc_get_server_option()</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8h_source.html#l00773">RPC_OSERVER_NAME</a>, <a class="el" href="midas_8h_source.html#l00772">RPC_OSERVER_TYPE</a>, <a class="el" href="midas_8c_source.html#l11980">rpc_server_callback()</a>, <a class="el" href="midas_8c_source.html#l12166">rpc_server_thread()</a>, <a class="el" href="midas_8h_source.html#l01075">RPC_SHUTDOWN</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="scs__310_8c_source.html#l00266">send()</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="system_8c_source.html#l01232">ss_shell()</a>, <a class="el" href="system_8c_source.html#l01111">ss_spawnv()</a>, <a class="el" href="midas_8h_source.html#l01033">SS_SUCCESS</a>, <a class="el" href="system_8c_source.html#l01705">ss_thread_create()</a>, <a class="el" href="midas_8h_source.html#l01793">ST_MPROCESS</a>, <a class="el" href="midas_8h_source.html#l01792">ST_MTHREAD</a>, <a class="el" href="midas_8h_source.html#l01795">ST_REMOTE</a>, <a class="el" href="midas_8h_source.html#l01791">ST_SINGLE</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="midas_8c_source.html#l01756">experiment_table::user</a>, and <a class="el" href="msystem_8h_source.html#l00416">callback_addr::user</a>.</p>

<p>Referenced by <a class="el" href="mserver_8c_source.html#l00246">main()</a>, and <a class="el" href="midas_8c_source.html#l10866">rpc_register_server()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l11619"></a>11619          : <a class="code" href="group__msystemincludecode.html#ga59beafb3b61407fa2c180804756847d7">rpc_server_accept</a>
<a name="l11620"></a>11620 
<a name="l11621"></a>11621   Purpose: Accept <span class="keyword">new</span> incoming connections
<a name="l11622"></a>11622 
<a name="l11623"></a>11623   Input:
<a name="l11624"></a>11624     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>    lscok            Listen socket
<a name="l11625"></a>11625 
<a name="l11626"></a>11626   Output:
<a name="l11627"></a>11627     none
<a name="l11628"></a>11628 
<a name="l11629"></a>11629   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l11630"></a>11630     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l11631"></a>11631     <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>           Error <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> socket <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a>
<a name="l11632"></a>11632     <a class="code" href="group__err25.html#ga50c5b6ef0ae99ed578f9209fdd961ac1">RPC_CONNCLOSED</a>          Connection was closed
<a name="l11633"></a>11633     <a class="code" href="group__err25.html#ga0406ee07e8c5afbf8e46cb0eed698bcd">RPC_SHUTDOWN</a>            Listener shutdown
<a name="l11634"></a>11634     <a class="code" href="group__err25.html#ga1a35d5e05d16d9040eaad41c4434a20a">RPC_EXCEED_BUFFER</a>       Not enough memory <span class="keywordflow">for</span> network <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l11635"></a>11635 
<a name="l11636"></a>11636 \********************************************************************/
<a name="l11637"></a>11637 {
<a name="l11638"></a>11638    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l11639"></a>11639    <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l11640"></a>11640    <span class="keywordtype">char</span> command, version[32], v1[32];
<a name="l11641"></a>11641    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> sock, port1, port2, port3;
<a name="l11642"></a>11642    <span class="keyword">struct </span>sockaddr_in acc_addr;
<a name="l11643"></a>11643    <span class="keyword">struct </span>hostent *phe;
<a name="l11644"></a>11644    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[100];
<a name="l11645"></a>11645    <span class="keywordtype">char</span> host_port1_str[30], host_port2_str[30], host_port3_str[30];
<a name="l11646"></a>11646    <span class="keywordtype">char</span> debug_str[30];
<a name="l11647"></a>11647    <span class="keywordtype">char</span> *argv[10];
<a name="l11648"></a>11648    <span class="keywordtype">char</span> <a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>[256];
<a name="l11649"></a>11649    <span class="keyword">struct </span>linger ling;
<a name="l11650"></a>11650 
<a name="l11651"></a>11651    <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structcallback__addr.html">callback_addr</a> <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>;
<a name="l11652"></a>11652 
<a name="l11653"></a>11653    <span class="keywordflow">if</span> (lsock &gt; 0) {
<a name="l11654"></a>11654       size = <span class="keyword">sizeof</span>(acc_addr);
<a name="l11655"></a>11655       sock = accept(lsock, (<span class="keyword">struct</span> sockaddr *) &amp;acc_addr, (<span class="keywordtype">int</span> *) &amp;size);
<a name="l11656"></a>11656 
<a name="l11657"></a>11657       <span class="keywordflow">if</span> (sock == -1)
<a name="l11658"></a>11658          <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l11659"></a>11659    } <span class="keywordflow">else</span> {
<a name="l11660"></a>11660       <span class="comment">/* lsock is stdin -&gt; already connected from inetd */</span>
<a name="l11661"></a>11661 
<a name="l11662"></a>11662       size = <span class="keyword">sizeof</span>(acc_addr);
<a name="l11663"></a>11663       sock = lsock;
<a name="l11664"></a>11664       getpeername(sock, (<span class="keyword">struct</span> sockaddr *) &amp;acc_addr, (<span class="keywordtype">int</span> *) &amp;size);
<a name="l11665"></a>11665    }
<a name="l11666"></a>11666 
<a name="l11667"></a>11667    <span class="comment">/* receive string with timeout */</span>
<a name="l11668"></a>11668    i = <a class="code" href="group__msystemincludecode.html#gaf9411818011b3b2bbc02a1db8340c77a">recv_string</a>(sock, net_buffer, 256, 10000);
<a name="l11669"></a>11669    <a class="code" href="group__msectionh.html#ga5122c91743605847f8368e17758dedbf">rpc_debug_printf</a>(<span class="stringliteral">&quot;Received command: %s&quot;</span>, net_buffer);
<a name="l11670"></a>11670  
<a name="l11671"></a>11671    <span class="keywordflow">if</span> (i &gt; 0) {
<a name="l11672"></a>11672       command = (char) toupper(net_buffer[0]);
<a name="l11673"></a>11673 
<a name="l11674"></a>11674       <span class="keywordflow">switch</span> (command) {
<a name="l11675"></a>11675       <span class="keywordflow">case</span> <span class="charliteral">&apos;S&apos;</span>:
<a name="l11676"></a>11676                
<a name="l11677"></a>11677          <span class="comment">/*----------- shutdown listener ----------------------*/</span>
<a name="l11678"></a>11678          <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(sock);
<a name="l11679"></a>11679          <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga0406ee07e8c5afbf8e46cb0eed698bcd">RPC_SHUTDOWN</a>;
<a name="l11680"></a>11680 
<a name="l11681"></a>11681       <span class="keywordflow">case</span> 7:
<a name="l11682"></a>11682          <a class="code" href="group__msystemincludecode.html#ga768c9914f60f39c296dca871e173c869">ss_shell</a>(sock);
<a name="l11683"></a>11683          <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(sock);
<a name="l11684"></a>11684          <span class="keywordflow">break</span>;
<a name="l11685"></a>11685 
<a name="l11686"></a>11686       <span class="keywordflow">case</span> <span class="charliteral">&apos;I&apos;</span>:
<a name="l11687"></a>11687                
<a name="l11688"></a>11688          <span class="comment">/*----------- return available experiments -----------*/</span>
<a name="l11689"></a>11689          <a class="code" href="group__cmfunctionc.html#gacd0316ccf242cd450281c5fd153a985b">cm_scan_experiments</a>();
<a name="l11690"></a>11690          <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__midasincludecode.html#ga96dcd778f7870d9d3a834f63f7e8506e">MAX_EXPERIMENT</a> &amp;&amp; <a class="code" href="group__cmfunctionc.html#gab76a8e706c73f118d45bc26886c36c3d">exptab</a>[i].<a class="code" href="structexperiment__table.html#a244b6dc374d463262536ece3dd310ec5">name</a>[0]; i++) {
<a name="l11691"></a>11691             sprintf(str, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="group__cmfunctionc.html#gab76a8e706c73f118d45bc26886c36c3d">exptab</a>[i].<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>);
<a name="l11692"></a>11692             <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(sock, str, strlen(str) + 1, 0);
<a name="l11693"></a>11693          }
<a name="l11694"></a>11694          <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(sock, <span class="stringliteral">&quot;&quot;</span>, 1, 0);
<a name="l11695"></a>11695          <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(sock);
<a name="l11696"></a>11696          <span class="keywordflow">break</span>;
<a name="l11697"></a>11697 
<a name="l11698"></a>11698       <span class="keywordflow">case</span> <span class="charliteral">&apos;C&apos;</span>:
<a name="l11699"></a>11699                
<a name="l11700"></a>11700          <span class="comment">/*----------- connect to experiment -----------*/</span>
<a name="l11701"></a>11701 
<a name="l11702"></a>11702          <span class="comment">/* get callback information */</span>
<a name="l11703"></a>11703          <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#afaf39ee5e680d208ee6e40abaca2bc56">experiment</a>[0] = 0;
<a name="l11704"></a>11704          port1 = port2 = version[0] = 0;
<a name="l11705"></a>11705          sscanf(net_buffer + 2, <span class="stringliteral">&quot;%d %d %d %s&quot;</span>, &amp;port1, &amp;port2, &amp;port3, version);
<a name="l11706"></a>11706          strcpy(<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#afaf39ee5e680d208ee6e40abaca2bc56">experiment</a>,
<a name="l11707"></a>11707                 strchr(strchr(strchr(strchr(net_buffer + 2, <span class="charliteral">&apos; &apos;</span>) + 1, <span class="charliteral">&apos; &apos;</span>) + 1, <span class="charliteral">&apos; &apos;</span>) + 1,
<a name="l11708"></a>11708                        <span class="charliteral">&apos; &apos;</span>) + 1);
<a name="l11709"></a>11709 
<a name="l11710"></a>11710          <span class="comment">/* print warning if version patch level doesn&apos;t agree */</span>
<a name="l11711"></a>11711          strcpy(v1, version);
<a name="l11712"></a>11712          <span class="keywordflow">if</span> (strchr(v1, <span class="charliteral">&apos;.&apos;</span>))
<a name="l11713"></a>11713             <span class="keywordflow">if</span> (strchr(strchr(v1, <span class="charliteral">&apos;.&apos;</span>) + 1, <span class="charliteral">&apos;.&apos;</span>))
<a name="l11714"></a>11714                *strchr(strchr(v1, <span class="charliteral">&apos;.&apos;</span>) + 1, <span class="charliteral">&apos;.&apos;</span>) = 0;
<a name="l11715"></a>11715 
<a name="l11716"></a>11716          strcpy(str, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l11717"></a>11717          <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;.&apos;</span>))
<a name="l11718"></a>11718             <span class="keywordflow">if</span> (strchr(strchr(str, <span class="charliteral">&apos;.&apos;</span>) + 1, <span class="charliteral">&apos;.&apos;</span>))
<a name="l11719"></a>11719                *strchr(strchr(str, <span class="charliteral">&apos;.&apos;</span>) + 1, <span class="charliteral">&apos;.&apos;</span>) = 0;
<a name="l11720"></a>11720 
<a name="l11721"></a>11721          <span class="keywordflow">if</span> (strcmp(v1, str) != 0) {
<a name="l11722"></a>11722             sprintf(str, <span class="stringliteral">&quot;client MIDAS version %s differs from local version %s&quot;</span>,
<a name="l11723"></a>11723                     version, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l11724"></a>11724             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_accept&quot;</span>, str);
<a name="l11725"></a>11725 
<a name="l11726"></a>11726             sprintf(str, <span class="stringliteral">&quot;received string: %s&quot;</span>, net_buffer + 2);
<a name="l11727"></a>11727             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_accept&quot;</span>, str);
<a name="l11728"></a>11728          }
<a name="l11729"></a>11729 
<a name="l11730"></a>11730          <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#ae0087da860ba044155b451ebd4b534f7">host_port1</a> = (short) port1;
<a name="l11731"></a>11731          <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#a54e765e0fefd275f281ebe901b30766c">host_port2</a> = (short) port2;
<a name="l11732"></a>11732          <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#a1a19d3b2a6ab1551e6fc0def4d60f6bc">host_port3</a> = (short) port3;
<a name="l11733"></a>11733          <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#a814a9b282e4a433134e90d28492086d1">debug</a> = <a class="code" href="group__midasincludecode.html#ga8efe0542b4273b7863a8a4e1f16776fe">_debug_mode</a>;
<a name="l11734"></a>11734 
<a name="l11735"></a>11735          <span class="comment">/* get the name of the remote host */</span>
<a name="l11736"></a>11736 <span class="preprocessor">#ifdef OS_VXWORKS</span>
<a name="l11737"></a>11737 <span class="preprocessor"></span>         {
<a name="l11738"></a>11738             <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> status;
<a name="l11739"></a>11739             status = hostGetByAddr(acc_addr.sin_addr.s_addr, <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#adb68662ac119fc3b0c987296d274ca31">host_name</a>);
<a name="l11740"></a>11740             <span class="keywordflow">if</span> (status != 0) {
<a name="l11741"></a>11741                <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_accept&quot;</span>, <span class="stringliteral">&quot;cannot get host name&quot;</span>);
<a name="l11742"></a>11742                <span class="keywordflow">break</span>;
<a name="l11743"></a>11743             }
<a name="l11744"></a>11744          }
<a name="l11745"></a>11745 <span class="preprocessor">#else</span>
<a name="l11746"></a>11746 <span class="preprocessor"></span>         phe = gethostbyaddr((<span class="keywordtype">char</span> *) &amp;acc_addr.sin_addr, 4, PF_INET);
<a name="l11747"></a>11747          <span class="keywordflow">if</span> (phe == NULL) {
<a name="l11748"></a>11748             <span class="comment">/* use IP number instead */</span>
<a name="l11749"></a>11749             strcpy(<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#adb68662ac119fc3b0c987296d274ca31">host_name</a>, (<span class="keywordtype">char</span> *) inet_ntoa(acc_addr.sin_addr));
<a name="l11750"></a>11750          } <span class="keywordflow">else</span>
<a name="l11751"></a>11751             strcpy(<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#adb68662ac119fc3b0c987296d274ca31">host_name</a>, phe-&gt;h_name);
<a name="l11752"></a>11752 <span class="preprocessor">#endif</span>
<a name="l11753"></a>11753 <span class="preprocessor"></span>
<a name="l11754"></a>11754          <span class="keywordflow">if</span> (<a class="code" href="group__msystemincludecode.html#ga500895b6f1fb39626453b56a20ed52df">rpc_get_server_option</a>(<a class="code" href="group__mdefineh.html#ga7f6354019d48c7beeb8f5bd5c2fac8bb">RPC_OSERVER_TYPE</a>) == <a class="code" href="group__msectionh.html#ga46a8d5e07e003fc4021c7f05371a2a92">ST_MPROCESS</a>) {
<a name="l11755"></a>11755             <span class="comment">/* update experiment definition */</span>
<a name="l11756"></a>11756             <a class="code" href="group__cmfunctionc.html#gacd0316ccf242cd450281c5fd153a985b">cm_scan_experiments</a>();
<a name="l11757"></a>11757 
<a name="l11758"></a>11758             <span class="comment">/* lookup experiment */</span>
<a name="l11759"></a>11759             <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#afaf39ee5e680d208ee6e40abaca2bc56">experiment</a>, <span class="stringliteral">&quot;Default&quot;</span>))
<a name="l11760"></a>11760                index = 0;
<a name="l11761"></a>11761             <span class="keywordflow">else</span>
<a name="l11762"></a>11762                <span class="keywordflow">for</span> (index = 0; index &lt; <a class="code" href="group__midasincludecode.html#ga96dcd778f7870d9d3a834f63f7e8506e">MAX_EXPERIMENT</a> &amp;&amp; <a class="code" href="group__cmfunctionc.html#gab76a8e706c73f118d45bc26886c36c3d">exptab</a>[index].<a class="code" href="structexperiment__table.html#a244b6dc374d463262536ece3dd310ec5">name</a>[0]; index++)
<a name="l11763"></a>11763                   <span class="keywordflow">if</span> (<a class="code" href="group__msectionh.html#ga394539b87025a42608497b31260142c8">equal_ustring</a>(<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#afaf39ee5e680d208ee6e40abaca2bc56">experiment</a>, <a class="code" href="group__cmfunctionc.html#gab76a8e706c73f118d45bc26886c36c3d">exptab</a>[index].<a class="code" href="structexperiment__table.html#a244b6dc374d463262536ece3dd310ec5">name</a>))
<a name="l11764"></a>11764                      <span class="keywordflow">break</span>;
<a name="l11765"></a>11765 
<a name="l11766"></a>11766             <span class="keywordflow">if</span> (index == <a class="code" href="group__midasincludecode.html#ga96dcd778f7870d9d3a834f63f7e8506e">MAX_EXPERIMENT</a> || <a class="code" href="group__cmfunctionc.html#gab76a8e706c73f118d45bc26886c36c3d">exptab</a>[index].<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>[0] == 0) {
<a name="l11767"></a>11767                sprintf(str, <span class="stringliteral">&quot;experiment %s not defined in exptab\r&quot;</span>, <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#afaf39ee5e680d208ee6e40abaca2bc56">experiment</a>);
<a name="l11768"></a>11768                <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_accept&quot;</span>, str);
<a name="l11769"></a>11769 
<a name="l11770"></a>11770                <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(sock, <span class="stringliteral">&quot;2&quot;</span>, 2, 0);   <span class="comment">/* 2 means exp. not found */</span>
<a name="l11771"></a>11771                <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(sock);
<a name="l11772"></a>11772                <span class="keywordflow">break</span>;
<a name="l11773"></a>11773             }
<a name="l11774"></a>11774 
<a name="l11775"></a>11775             strcpy(<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#a6bd87d38a6574f6050eb3f9199118a98">directory</a>, <a class="code" href="group__cmfunctionc.html#gab76a8e706c73f118d45bc26886c36c3d">exptab</a>[index].<a class="code" href="structexperiment__table.html#ad083a8de2778e0be80c30198e2b4b210">directory</a>);
<a name="l11776"></a>11776             strcpy(<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#ac148a716312be01ce57e4ca396bb5cff">user</a>, <a class="code" href="group__cmfunctionc.html#gab76a8e706c73f118d45bc26886c36c3d">exptab</a>[index].<a class="code" href="structexperiment__table.html#abbcb891d7c6f03b2b846da74262f4a27">user</a>);
<a name="l11777"></a>11777 
<a name="l11778"></a>11778             <span class="comment">/* create a new process */</span>
<a name="l11779"></a>11779             sprintf(host_port1_str, <span class="stringliteral">&quot;%d&quot;</span>, <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#ae0087da860ba044155b451ebd4b534f7">host_port1</a>);
<a name="l11780"></a>11780             sprintf(host_port2_str, <span class="stringliteral">&quot;%d&quot;</span>, <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#a54e765e0fefd275f281ebe901b30766c">host_port2</a>);
<a name="l11781"></a>11781             sprintf(host_port3_str, <span class="stringliteral">&quot;%d&quot;</span>, <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#a1a19d3b2a6ab1551e6fc0def4d60f6bc">host_port3</a>);
<a name="l11782"></a>11782             sprintf(debug_str, <span class="stringliteral">&quot;%d&quot;</span>, <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#a814a9b282e4a433134e90d28492086d1">debug</a>);
<a name="l11783"></a>11783 
<a name="l11784"></a>11784             argv[0] = (<span class="keywordtype">char</span> *) <a class="code" href="group__msystemincludecode.html#ga500895b6f1fb39626453b56a20ed52df">rpc_get_server_option</a>(<a class="code" href="group__mdefineh.html#ga1caa8de36fbdd251b67fd4601d0e708f">RPC_OSERVER_NAME</a>);
<a name="l11785"></a>11785             argv[1] = <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#adb68662ac119fc3b0c987296d274ca31">host_name</a>;
<a name="l11786"></a>11786             argv[2] = host_port1_str;
<a name="l11787"></a>11787             argv[3] = host_port2_str;
<a name="l11788"></a>11788             argv[4] = host_port3_str;
<a name="l11789"></a>11789             argv[5] = debug_str;
<a name="l11790"></a>11790             argv[6] = <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#afaf39ee5e680d208ee6e40abaca2bc56">experiment</a>;
<a name="l11791"></a>11791             argv[7] = <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#a6bd87d38a6574f6050eb3f9199118a98">directory</a>;
<a name="l11792"></a>11792             argv[8] = <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#ac148a716312be01ce57e4ca396bb5cff">user</a>;
<a name="l11793"></a>11793             argv[9] = NULL;
<a name="l11794"></a>11794 
<a name="l11795"></a>11795             <a class="code" href="group__msectionh.html#ga5122c91743605847f8368e17758dedbf">rpc_debug_printf</a>(<span class="stringliteral">&quot;Spawn: %s %s %s %s %s %s %s %s %s %s&quot;</span>,
<a name="l11796"></a>11796                argv[0], argv[1], argv[2], argv[3], argv[4],
<a name="l11797"></a>11797                argv[5], argv[6], argv[7], argv[8], argv[9]);
<a name="l11798"></a>11798 
<a name="l11799"></a>11799             status = <a class="code" href="group__msystemincludecode.html#gabd9944a59380e93e130c9960baa5a5e2">ss_spawnv</a>(P_NOWAIT, 
<a name="l11800"></a>11800                           (<span class="keywordtype">char</span> *) <a class="code" href="group__msystemincludecode.html#ga500895b6f1fb39626453b56a20ed52df">rpc_get_server_option</a>(<a class="code" href="group__mdefineh.html#ga1caa8de36fbdd251b67fd4601d0e708f">RPC_OSERVER_NAME</a>),
<a name="l11801"></a>11801                           argv);
<a name="l11802"></a>11802 
<a name="l11803"></a>11803             <span class="keywordflow">if</span> (status != <a class="code" href="group__err24.html#ga0abac6c68d7a79ce83d1a25b2c800321">SS_SUCCESS</a>) {
<a name="l11804"></a>11804                <a class="code" href="group__msectionh.html#ga5122c91743605847f8368e17758dedbf">rpc_debug_printf</a>(<span class="stringliteral">&quot;Cannot spawn subprocess: %s\n&quot;</span>, strerror(errno));
<a name="l11805"></a>11805 
<a name="l11806"></a>11806                sprintf(str, <span class="stringliteral">&quot;3&quot;</span>);       <span class="comment">/* 3 means cannot spawn subprocess */</span>
<a name="l11807"></a>11807                <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(sock, str, strlen(str) + 1, 0);
<a name="l11808"></a>11808                <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(sock);
<a name="l11809"></a>11809                <span class="keywordflow">break</span>;
<a name="l11810"></a>11810             }
<a name="l11811"></a>11811 
<a name="l11812"></a>11812             sprintf(str, <span class="stringliteral">&quot;1 %s&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());     <span class="comment">/* 1 means ok */</span>
<a name="l11813"></a>11813             <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(sock, str, strlen(str) + 1, 0);
<a name="l11814"></a>11814             <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(sock);
<a name="l11815"></a>11815          } <span class="keywordflow">else</span> {
<a name="l11816"></a>11816             sprintf(str, <span class="stringliteral">&quot;1 %s&quot;</span>, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());     <span class="comment">/* 1 means ok */</span>
<a name="l11817"></a>11817             <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(sock, str, strlen(str) + 1, 0);
<a name="l11818"></a>11818             <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(sock);
<a name="l11819"></a>11819          }
<a name="l11820"></a>11820 
<a name="l11821"></a>11821          <span class="comment">/* look for next free entry */</span>
<a name="l11822"></a>11822          <span class="keywordflow">for</span> (index = 0; index &lt; <a class="code" href="group__msystemincludecode.html#gab1e8a2a4c5dc40faf6f7c25b51a4562f">MAX_RPC_CONNECTION</a>; index++)
<a name="l11823"></a>11823             <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].recv_sock == 0)
<a name="l11824"></a>11824                <span class="keywordflow">break</span>;
<a name="l11825"></a>11825          <span class="keywordflow">if</span> (index == MAX_RPC_CONNECTION)
<a name="l11826"></a>11826             <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l11827"></a>11827          <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#a325e404f387f3b2b23eeee73e9fc401d">index</a> = index;
<a name="l11828"></a>11828 
<a name="l11829"></a>11829         <span class="comment">/*----- multi thread server ------------------------*/</span>
<a name="l11830"></a>11830          <span class="keywordflow">if</span> (<a class="code" href="group__msystemincludecode.html#ga500895b6f1fb39626453b56a20ed52df">rpc_get_server_option</a>(<a class="code" href="group__mdefineh.html#ga7f6354019d48c7beeb8f5bd5c2fac8bb">RPC_OSERVER_TYPE</a>) == <a class="code" href="group__msectionh.html#ga88fcaca68212b5824a0b0f6c9507ebcb">ST_MTHREAD</a>)
<a name="l11831"></a>11831             <a class="code" href="group__msystemincludecode.html#gaf5d1e0d2746962f668cd410d4be463ef">ss_thread_create</a>(<a class="code" href="group__msectionh.html#ga6acef00058028cff58b5c1cb94996142">rpc_server_thread</a>, (<span class="keywordtype">void</span> *) (&amp;<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>));
<a name="l11832"></a>11832 
<a name="l11833"></a>11833         <span class="comment">/*----- single thread server -----------------------*/</span>
<a name="l11834"></a>11834          <span class="keywordflow">if</span> (<a class="code" href="group__msystemincludecode.html#ga500895b6f1fb39626453b56a20ed52df">rpc_get_server_option</a>(<a class="code" href="group__mdefineh.html#ga7f6354019d48c7beeb8f5bd5c2fac8bb">RPC_OSERVER_TYPE</a>) == <a class="code" href="group__msectionh.html#gafd1f60d6275582530d610f3a599cb270">ST_SINGLE</a> ||
<a name="l11835"></a>11835              <a class="code" href="group__msystemincludecode.html#ga500895b6f1fb39626453b56a20ed52df">rpc_get_server_option</a>(<a class="code" href="group__mdefineh.html#ga7f6354019d48c7beeb8f5bd5c2fac8bb">RPC_OSERVER_TYPE</a>) == <a class="code" href="group__msectionh.html#ga9c6b34250ccc696d64a6a0a572947be5">ST_REMOTE</a>)
<a name="l11836"></a>11836             <a class="code" href="group__msystemincludecode.html#ga5ebaebf950488abd35459b82de08899c">rpc_server_callback</a>(&amp;<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>);
<a name="l11837"></a>11837 
<a name="l11838"></a>11838          <span class="keywordflow">break</span>;
<a name="l11839"></a>11839 
<a name="l11840"></a>11840       <span class="keywordflow">default</span>:
<a name="l11841"></a>11841          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_accept&quot;</span>, <span class="stringliteral">&quot;received unknown command &apos;%c&apos;&quot;</span>, command);
<a name="l11842"></a>11842          <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(sock);
<a name="l11843"></a>11843          <span class="keywordflow">break</span>;
<a name="l11844"></a>11844 
<a name="l11845"></a>11845       }
<a name="l11846"></a>11846    } <span class="keywordflow">else</span> {                     <span class="comment">/* if i&gt;0 */</span>
<a name="l11847"></a>11847 
<a name="l11848"></a>11848       <span class="comment">/* lingering needed for PCTCP */</span>
<a name="l11849"></a>11849       ling.l_onoff = 1;
<a name="l11850"></a>11850       ling.l_linger = 0;
<a name="l11851"></a>11851       setsockopt(sock, SOL_SOCKET, SO_LINGER, (<span class="keywordtype">char</span> *) &amp;ling, <span class="keyword">sizeof</span>(ling));
<a name="l11852"></a>11852       <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(sock);
<a name="l11853"></a>11853    }
<a name="l11854"></a>11854 
<a name="l11855"></a>11855    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l11856"></a>11856 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga22f1893212e009f54f9085634784b235"></a><!-- doxytag: member="midas.c::rpc_server_callback" ref="ga22f1893212e009f54f9085634784b235" args="(struct callback_addr *pcallback)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_server_callback </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcallback__addr.html">callback_addr</a> *&nbsp;</td>
          <td class="paramname"> <em>pcallback</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l11980">11980</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="msystem_8h_source.html#l00651">CH_SERVER</a>, <a class="el" href="melog_8c_source.html#l00085">closesocket</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="msystem_8h_source.html#l00451">RPC_SERVER_ACCEPTION::event_sock</a>, <a class="el" href="scs__310__ql355p_8c_source.html#l00055">flag</a>, <a class="el" href="msystem_8h_source.html#l00409">callback_addr::host_name</a>, <a class="el" href="midas_8h_source.html#l00682">HOST_NAME_LENGTH</a>, <a class="el" href="msystem_8h_source.html#l00410">callback_addr::host_port1</a>, <a class="el" href="msystem_8h_source.html#l00411">callback_addr::host_port2</a>, <a class="el" href="msystem_8h_source.html#l00412">callback_addr::host_port3</a>, <a class="el" href="msystem_8h_source.html#l00417">callback_addr::index</a>, <a class="el" href="mana_8cpp_source.html#l00677">index</a>, <a class="el" href="msystem_8h_source.html#l00455">RPC_SERVER_ACCEPTION::last_activity</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="rpc_8c_source.html#l00293">net_buffer</a>, <a class="el" href="midas_8h_source.html#l00671">NET_TCP_SIZE</a>, <a class="el" href="msystem_8h_source.html#l00450">RPC_SERVER_ACCEPTION::recv_sock</a>, <a class="el" href="system_8c_source.html#l03660">recv_string()</a>, <a class="el" href="msystem_8h_source.html#l00452">RPC_SERVER_ACCEPTION::remote_hw_type</a>, <a class="el" href="midas_8c_source.html#l07974">rpc_calc_convert_flags()</a>, <a class="el" href="midas_8h_source.html#l00774">RPC_CONVERT_FLAGS</a>, <a class="el" href="midas_8c_source.html#l09447">rpc_debug_printf()</a>, <a class="el" href="midas_8c_source.html#l09092">rpc_get_option()</a>, <a class="el" href="midas_8c_source.html#l09250">rpc_get_server_option()</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8h_source.html#l00771">RPC_OHW_TYPE</a>, <a class="el" href="midas_8h_source.html#l00772">RPC_OSERVER_TYPE</a>, <a class="el" href="midas_8c_source.html#l12223">rpc_server_receive()</a>, <a class="el" href="midas_8c_source.html#l09068">rpc_set_server_acception()</a>, <a class="el" href="midas_8c_source.html#l09308">rpc_set_server_option()</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="scs__310_8c_source.html#l00266">send()</a>, <a class="el" href="msystem_8h_source.html#l00449">RPC_SERVER_ACCEPTION::send_sock</a>, <a class="el" href="system_8c_source.html#l01050">ss_gettid()</a>, <a class="el" href="system_8c_source.html#l02265">ss_millitime()</a>, <a class="el" href="system_8c_source.html#l03182">ss_suspend_set_dispatch()</a>, <a class="el" href="midas_8h_source.html#l01795">ST_REMOTE</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, <a class="el" href="msystem_8h_source.html#l00446">RPC_SERVER_ACCEPTION::tid</a>, and <a class="el" href="msystem_8h_source.html#l00454">RPC_SERVER_ACCEPTION::watchdog_timeout</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l11616">rpc_server_accept()</a>, and <a class="el" href="midas_8c_source.html#l12166">rpc_server_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l11983"></a>11983          : <a class="code" href="group__msystemincludecode.html#ga5ebaebf950488abd35459b82de08899c">rpc_server_callback</a>
<a name="l11984"></a>11984 
<a name="l11985"></a>11985   Purpose: Callback a remote client. Setup <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a> entry
<a name="l11986"></a>11986            with optional conversion flags <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> establish two-way
<a name="l11987"></a>11987            TCP connection.
<a name="l11988"></a>11988 
<a name="l11989"></a>11989   Input:
<a name="l11990"></a>11990     <a class="code" href="structcallback__addr.html">callback_addr</a> pcallback Pointer to a <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a> structure
<a name="l11991"></a>11991 
<a name="l11992"></a>11992   Output:
<a name="l11993"></a>11993     none
<a name="l11994"></a>11994 
<a name="l11995"></a>11995   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l11996"></a>11996     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l11997"></a>11997 
<a name="l11998"></a>11998 \********************************************************************/
<a name="l11999"></a>11999 {
<a name="l12000"></a>12000    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>;
<a name="l12001"></a>12001    <span class="keywordtype">int</span> recv_sock, send_sock, event_sock;
<a name="l12002"></a>12002    <span class="keyword">struct </span>sockaddr_in bind_addr;
<a name="l12003"></a>12003    <span class="keyword">struct </span>hostent *phe;
<a name="l12004"></a>12004    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[100], client_program[<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>];
<a name="l12005"></a>12005    <span class="keywordtype">char</span> <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>[<a class="code" href="group__midasincludecode.html#ga2010c9ed4ef21c3171de778157b9c494">HOST_NAME_LENGTH</a>];
<a name="l12006"></a>12006    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> client_hw_type, hw_type;
<a name="l12007"></a>12007    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> convert_flags;
<a name="l12008"></a>12008    <span class="keywordtype">char</span> <a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>[256];
<a name="l12009"></a>12009    <span class="keyword">struct </span><a class="code" href="structcallback__addr.html">callback_addr</a> <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>;
<a name="l12010"></a>12010    <span class="keywordtype">int</span> <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a>;
<a name="l12011"></a>12011 
<a name="l12012"></a>12012    <span class="comment">/* copy callback information */</span>
<a name="l12013"></a>12013    memcpy(&amp;<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>, pcallback, <span class="keyword">sizeof</span>(<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>));
<a name="l12014"></a>12014    index = <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#a325e404f387f3b2b23eeee73e9fc401d">index</a>;
<a name="l12015"></a>12015 
<a name="l12016"></a>12016    <span class="comment">/* create new sockets for TCP */</span>
<a name="l12017"></a>12017    recv_sock = socket(AF_INET, SOCK_STREAM, 0);
<a name="l12018"></a>12018    send_sock = socket(AF_INET, SOCK_STREAM, 0);
<a name="l12019"></a>12019    event_sock = socket(AF_INET, SOCK_STREAM, 0);
<a name="l12020"></a>12020    <span class="keywordflow">if</span> (event_sock == -1)
<a name="l12021"></a>12021       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l12022"></a>12022 
<a name="l12023"></a>12023    <span class="comment">/* callback to remote node */</span>
<a name="l12024"></a>12024    memset(&amp;bind_addr, 0, <span class="keyword">sizeof</span>(bind_addr));
<a name="l12025"></a>12025    bind_addr.sin_family = AF_INET;
<a name="l12026"></a>12026    bind_addr.sin_port = htons(<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#ae0087da860ba044155b451ebd4b534f7">host_port1</a>);
<a name="l12027"></a>12027 
<a name="l12028"></a>12028 <span class="preprocessor">#ifdef OS_VXWORKS</span>
<a name="l12029"></a>12029 <span class="preprocessor"></span>   {
<a name="l12030"></a>12030       <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> host_addr;
<a name="l12031"></a>12031 
<a name="l12032"></a>12032       host_addr = hostGetByName(<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#adb68662ac119fc3b0c987296d274ca31">host_name</a>);
<a name="l12033"></a>12033       memcpy((<span class="keywordtype">char</span> *) &amp;(bind_addr.sin_addr), &amp;host_addr, 4);
<a name="l12034"></a>12034    }
<a name="l12035"></a>12035 <span class="preprocessor">#else</span>
<a name="l12036"></a>12036 <span class="preprocessor"></span>   phe = gethostbyname(<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#adb68662ac119fc3b0c987296d274ca31">host_name</a>);
<a name="l12037"></a>12037    <span class="keywordflow">if</span> (phe == NULL) {
<a name="l12038"></a>12038       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_callback&quot;</span>, <span class="stringliteral">&quot;cannot get host name&quot;</span>);
<a name="l12039"></a>12039       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l12040"></a>12040    }
<a name="l12041"></a>12041    memcpy((<span class="keywordtype">char</span> *) &amp;(bind_addr.sin_addr), phe-&gt;h_addr, phe-&gt;h_length);
<a name="l12042"></a>12042 <span class="preprocessor">#endif</span>
<a name="l12043"></a>12043 <span class="preprocessor"></span>
<a name="l12044"></a>12044    <span class="comment">/* connect receive socket */</span>
<a name="l12045"></a>12045 <span class="preprocessor">#ifdef OS_UNIX</span>
<a name="l12046"></a>12046 <span class="preprocessor"></span>   <span class="keywordflow">do</span> {
<a name="l12047"></a>12047       status = connect(recv_sock, (<span class="keywordtype">void</span> *) &amp;bind_addr, <span class="keyword">sizeof</span>(bind_addr));
<a name="l12048"></a>12048 
<a name="l12049"></a>12049       <span class="comment">/* don&apos;t return if an alarm signal was cought */</span>
<a name="l12050"></a>12050    } <span class="keywordflow">while</span> (status == -1 &amp;&amp; errno == EINTR);
<a name="l12051"></a>12051 <span class="preprocessor">#else</span>
<a name="l12052"></a>12052 <span class="preprocessor"></span>   status = connect(recv_sock, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, <span class="keyword">sizeof</span>(bind_addr));
<a name="l12053"></a>12053 <span class="preprocessor">#endif</span>
<a name="l12054"></a>12054 <span class="preprocessor"></span>
<a name="l12055"></a>12055    <span class="keywordflow">if</span> (status != 0) {
<a name="l12056"></a>12056       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_callback&quot;</span>, <span class="stringliteral">&quot;cannot connect receive socket&quot;</span>);
<a name="l12057"></a>12057       <span class="keywordflow">goto</span> error;
<a name="l12058"></a>12058    }
<a name="l12059"></a>12059 
<a name="l12060"></a>12060    bind_addr.sin_port = htons(<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#a54e765e0fefd275f281ebe901b30766c">host_port2</a>);
<a name="l12061"></a>12061 
<a name="l12062"></a>12062    <span class="comment">/* connect send socket */</span>
<a name="l12063"></a>12063 <span class="preprocessor">#ifdef OS_UNIX</span>
<a name="l12064"></a>12064 <span class="preprocessor"></span>   <span class="keywordflow">do</span> {
<a name="l12065"></a>12065       status = connect(send_sock, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, <span class="keyword">sizeof</span>(bind_addr));
<a name="l12066"></a>12066 
<a name="l12067"></a>12067       <span class="comment">/* don&apos;t return if an alarm signal was cought */</span>
<a name="l12068"></a>12068    } <span class="keywordflow">while</span> (status == -1 &amp;&amp; errno == EINTR);
<a name="l12069"></a>12069 <span class="preprocessor">#else</span>
<a name="l12070"></a>12070 <span class="preprocessor"></span>   status = connect(send_sock, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, <span class="keyword">sizeof</span>(bind_addr));
<a name="l12071"></a>12071 <span class="preprocessor">#endif</span>
<a name="l12072"></a>12072 <span class="preprocessor"></span>
<a name="l12073"></a>12073    <span class="keywordflow">if</span> (status != 0) {
<a name="l12074"></a>12074       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_callback&quot;</span>, <span class="stringliteral">&quot;cannot connect send socket&quot;</span>);
<a name="l12075"></a>12075       <span class="keywordflow">goto</span> error;
<a name="l12076"></a>12076    }
<a name="l12077"></a>12077 
<a name="l12078"></a>12078    bind_addr.sin_port = htons(<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>.<a class="code" href="structcallback__addr.html#a1a19d3b2a6ab1551e6fc0def4d60f6bc">host_port3</a>);
<a name="l12079"></a>12079 
<a name="l12080"></a>12080    <span class="comment">/* connect event socket */</span>
<a name="l12081"></a>12081 <span class="preprocessor">#ifdef OS_UNIX</span>
<a name="l12082"></a>12082 <span class="preprocessor"></span>   <span class="keywordflow">do</span> {
<a name="l12083"></a>12083       status = connect(event_sock, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, <span class="keyword">sizeof</span>(bind_addr));
<a name="l12084"></a>12084 
<a name="l12085"></a>12085       <span class="comment">/* don&apos;t return if an alarm signal was cought */</span>
<a name="l12086"></a>12086    } <span class="keywordflow">while</span> (status == -1 &amp;&amp; errno == EINTR);
<a name="l12087"></a>12087 <span class="preprocessor">#else</span>
<a name="l12088"></a>12088 <span class="preprocessor"></span>   status = connect(event_sock, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, <span class="keyword">sizeof</span>(bind_addr));
<a name="l12089"></a>12089 <span class="preprocessor">#endif</span>
<a name="l12090"></a>12090 <span class="preprocessor"></span>
<a name="l12091"></a>12091    <span class="keywordflow">if</span> (status != 0) {
<a name="l12092"></a>12092       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_callback&quot;</span>, <span class="stringliteral">&quot;cannot connect event socket&quot;</span>);
<a name="l12093"></a>12093       <span class="keywordflow">goto</span> error;
<a name="l12094"></a>12094    }
<a name="l12095"></a>12095 
<a name="l12096"></a>12096    <span class="comment">/* increase receive buffer size to 64k */</span>
<a name="l12097"></a>12097 <span class="preprocessor">#ifndef OS_ULTRIX               </span><span class="comment">/* crashes ULTRIX... */</span>
<a name="l12098"></a>12098    flag = <a class="code" href="group__midasincludecode.html#ga31190e25ed33be085ff0af476af2c029">NET_TCP_SIZE</a> + 1;
<a name="l12099"></a>12099    setsockopt(event_sock, SOL_SOCKET, SO_RCVBUF, (<span class="keywordtype">char</span> *) &amp;flag, <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>));
<a name="l12100"></a>12100 <span class="preprocessor">#endif</span>
<a name="l12101"></a>12101 <span class="preprocessor"></span>
<a name="l12102"></a>12102    <span class="keywordflow">if</span> (<a class="code" href="group__msystemincludecode.html#gaf9411818011b3b2bbc02a1db8340c77a">recv_string</a>(recv_sock, net_buffer, 256, 10000) &lt;= 0) {
<a name="l12103"></a>12103       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_callback&quot;</span>, <span class="stringliteral">&quot;timeout on receive remote computer info&quot;</span>);
<a name="l12104"></a>12104       <span class="keywordflow">goto</span> error;
<a name="l12105"></a>12105    }
<a name="l12106"></a>12106 
<a name="l12107"></a>12107    <span class="comment">/* get remote computer info */</span>
<a name="l12108"></a>12108    sscanf(net_buffer, <span class="stringliteral">&quot;%d&quot;</span>, &amp;client_hw_type);
<a name="l12109"></a>12109 
<a name="l12110"></a>12110    strcpy(client_program, strchr(net_buffer, <span class="charliteral">&apos; &apos;</span>) + 1);
<a name="l12111"></a>12111 
<a name="l12112"></a>12112    <span class="comment">/* get the name of the remote host */</span>
<a name="l12113"></a>12113 <span class="preprocessor">#ifdef OS_VXWORKS</span>
<a name="l12114"></a>12114 <span class="preprocessor"></span>   status = hostGetByAddr(bind_addr.sin_addr.s_addr, host_name);
<a name="l12115"></a>12115    <span class="keywordflow">if</span> (status != 0)
<a name="l12116"></a>12116       strcpy(host_name, <span class="stringliteral">&quot;unknown&quot;</span>);
<a name="l12117"></a>12117 <span class="preprocessor">#else</span>
<a name="l12118"></a>12118 <span class="preprocessor"></span>   phe = gethostbyaddr((<span class="keywordtype">char</span> *) &amp;bind_addr.sin_addr, 4, PF_INET);
<a name="l12119"></a>12119    <span class="keywordflow">if</span> (phe == NULL)
<a name="l12120"></a>12120       strcpy(host_name, <span class="stringliteral">&quot;unknown&quot;</span>);
<a name="l12121"></a>12121    <span class="keywordflow">else</span>
<a name="l12122"></a>12122       strcpy(host_name, phe-&gt;h_name);
<a name="l12123"></a>12123 <span class="preprocessor">#endif</span>
<a name="l12124"></a>12124 <span class="preprocessor"></span>
<a name="l12125"></a>12125    <span class="comment">/* save information in _server_acception structure */</span>
<a name="l12126"></a>12126    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a160df84318ca2158f9302af6fe95330e">recv_sock</a> = recv_sock;
<a name="l12127"></a>12127    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a24df135a5376a4d0ec7acfc7bfd63bca">send_sock</a> = send_sock;
<a name="l12128"></a>12128    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#ac770d0f286e0392201250d6d8c2f76eb">event_sock</a> = event_sock;
<a name="l12129"></a>12129    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#ae663c27f2ba3f7d61eab16c819ba96c1">remote_hw_type</a> = client_hw_type;
<a name="l12130"></a>12130    strcpy(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].host_name, host_name);
<a name="l12131"></a>12131    strcpy(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].prog_name, client_program);
<a name="l12132"></a>12132    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#afce37f951099d5507a369c860cbcb36e">tid</a> = <a class="code" href="group__msystemincludecode.html#ga47dde62638a1a4e9f49534bff449ebcd">ss_gettid</a>();
<a name="l12133"></a>12133    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#aceb0db33c6b8db04ec595cdb174bd6d2">last_activity</a> = <a class="code" href="group__msectionh.html#gaeb8fc912d50c2360588c50782b9c916d">ss_millitime</a>();
<a name="l12134"></a>12134    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].<a class="code" href="structRPC__SERVER__ACCEPTION.html#ab63d3134ce8331c26bb08d1bf585b617">watchdog_timeout</a> = 0;
<a name="l12135"></a>12135 
<a name="l12136"></a>12136    <span class="comment">/* send my own computer id */</span>
<a name="l12137"></a>12137    hw_type = <a class="code" href="group__msectionh.html#gae3bca206872bae947c6e20c1aedfe4f5">rpc_get_option</a>(0, <a class="code" href="group__mdefineh.html#gaf716b122f115aca08e68391343145cb3">RPC_OHW_TYPE</a>);
<a name="l12138"></a>12138    sprintf(str, <span class="stringliteral">&quot;%d&quot;</span>, hw_type);
<a name="l12139"></a>12139    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(recv_sock, str, strlen(str) + 1, 0);
<a name="l12140"></a>12140 
<a name="l12141"></a>12141    <a class="code" href="group__msystemincludecode.html#ga6990e0eb5b97aeb6667ddd03d69b4065">rpc_set_server_acception</a>(index + 1);
<a name="l12142"></a>12142    <a class="code" href="group__rpcfunctionc.html#ga34b52a482a19eb8abcf8d84d888acbe0">rpc_calc_convert_flags</a>(hw_type, client_hw_type, &amp;convert_flags);
<a name="l12143"></a>12143    <a class="code" href="group__msystemincludecode.html#gaec24042a470eec42ec344d7fc552d4f5">rpc_set_server_option</a>(<a class="code" href="group__mdefineh.html#gaddb075d303a5903df6a7dabdad02defd">RPC_CONVERT_FLAGS</a>, convert_flags);
<a name="l12144"></a>12144 
<a name="l12145"></a>12145    <span class="comment">/* set callback function for ss_suspend */</span>
<a name="l12146"></a>12146    <a class="code" href="group__msystemincludecode.html#gac1b39a6f689a24e9aaf239ee73a81b15">ss_suspend_set_dispatch</a>(<a class="code" href="group__msystemincludecode.html#gad8b8b52bc186079c0cb5689eead00a03">CH_SERVER</a>, <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>,
<a name="l12147"></a>12147                            (<span class="keywordtype">int</span> (*)(<span class="keywordtype">void</span>)) <a class="code" href="group__msystemincludecode.html#ga8bad7cd9b75d3a9879745bbd61742ded">rpc_server_receive</a>);
<a name="l12148"></a>12148 
<a name="l12149"></a>12149    <span class="keywordflow">if</span> (<a class="code" href="group__msystemincludecode.html#ga500895b6f1fb39626453b56a20ed52df">rpc_get_server_option</a>(<a class="code" href="group__mdefineh.html#ga7f6354019d48c7beeb8f5bd5c2fac8bb">RPC_OSERVER_TYPE</a>) != <a class="code" href="group__msectionh.html#ga9c6b34250ccc696d64a6a0a572947be5">ST_REMOTE</a>)
<a name="l12150"></a>12150       <a class="code" href="group__msectionh.html#ga5122c91743605847f8368e17758dedbf">rpc_debug_printf</a>(<span class="stringliteral">&quot;Connection to %s:%s established\n&quot;</span>,
<a name="l12151"></a>12151              <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].host_name, <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[index].prog_name);
<a name="l12152"></a>12152 
<a name="l12153"></a>12153    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l12154"></a>12154 
<a name="l12155"></a>12155  error:
<a name="l12156"></a>12156 
<a name="l12157"></a>12157    <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(recv_sock);
<a name="l12158"></a>12158    <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(send_sock);
<a name="l12159"></a>12159    <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(event_sock);
<a name="l12160"></a>12160 
<a name="l12161"></a>12161    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l12162"></a>12162 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga682dee81e5366fdb8fcee44b480ce1b9"></a><!-- doxytag: member="midas.c::rpc_server_connect" ref="ga682dee81e5366fdb8fcee44b480ce1b9" args="(char *host_name, char *exp_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_server_connect </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>host_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>exp_name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l08657">8657</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="msystem_8h_source.html#l00650">CH_CLIENT</a>, <a class="el" href="melog_8c_source.html#l00085">closesocket</a>, <a class="el" href="midas_8c_source.html#l01704">cm_get_version()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8h_source.html#l00960">CM_UNDEF_EXP</a>, <a class="el" href="midas_8h_source.html#l00696">DEFAULT_RPC_TIMEOUT</a>, <a class="el" href="msystem_8h_source.html#l00438">RPC_SERVER_CONNECTION::event_sock</a>, <a class="el" href="msystem_8h_source.html#l00435">RPC_SERVER_CONNECTION::exp_name</a>, <a class="el" href="scs__310__ql355p_8c_source.html#l00055">flag</a>, <a class="el" href="msystem_8h_source.html#l00433">RPC_SERVER_CONNECTION::host_name</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l00692">MIDAS_TCP_PORT</a>, <a class="el" href="midas_8h_source.html#l00681">NAME_LENGTH</a>, <a class="el" href="midas_8h_source.html#l00671">NET_TCP_SIZE</a>, <a class="el" href="msystem_8h_source.html#l00437">RPC_SERVER_CONNECTION::recv_sock</a>, <a class="el" href="system_8c_source.html#l03660">recv_string()</a>, <a class="el" href="msystem_8h_source.html#l00439">RPC_SERVER_CONNECTION::remote_hw_type</a>, <a class="el" href="midas_8c_source.html#l08336">rpc_client_dispatch()</a>, <a class="el" href="mrpc_8c_source.html#l01289">rpc_get_internal_list()</a>, <a class="el" href="midas_8c_source.html#l09368">rpc_get_name()</a>, <a class="el" href="midas_8c_source.html#l09092">rpc_get_option()</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8h_source.html#l01072">RPC_NOT_REGISTERED</a>, <a class="el" href="midas_8h_source.html#l00771">RPC_OHW_TYPE</a>, <a class="el" href="midas_8c_source.html#l08217">rpc_register_functions()</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l00781">RPC_TCP</a>, <a class="el" href="msystem_8h_source.html#l00441">RPC_SERVER_CONNECTION::rpc_timeout</a>, <a class="el" href="scs__310_8c_source.html#l00266">send()</a>, <a class="el" href="msystem_8h_source.html#l00436">RPC_SERVER_CONNECTION::send_sock</a>, <a class="el" href="ybos_8c_source.html#l00373">size</a>, <a class="el" href="system_8c_source.html#l03182">ss_suspend_set_dispatch()</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, and <a class="el" href="msystem_8h_source.html#l00440">RPC_SERVER_CONNECTION::transport</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l02349">cm_connect_experiment1()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08660"></a>08660          : <a class="code" href="group__msectionh.html#ga2919eee9790556c12812ea97011cb9ca">rpc_server_connect</a>
<a name="l08661"></a>08661 
<a name="l08662"></a>08662   Purpose: Extablish a network connection to a remote MIDAS
<a name="l08663"></a>08663            server <span class="keyword">using</span> a <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a> scheme.
<a name="l08664"></a>08664 
<a name="l08665"></a>08665   Input:
<a name="l08666"></a>08666     <span class="keywordtype">char</span> *<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>         <a class="code" href="c8051F000_8h.html#a75c2c81467f6a78b910f937ffd7841e2">IP</a> <a class="code" href="scs__210__tc600_8c.html#a9ff470cb16fb31f83ca0b9192a33e402">address</a> of host to connect to.
<a name="l08667"></a>08667 
<a name="l08668"></a>08668     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>  port               TPC port to connect to.
<a name="l08669"></a>08669 
<a name="l08670"></a>08670     <span class="keywordtype">char</span> *<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>          Name of <a class="code" href="structcallback__addr.html#afaf39ee5e680d208ee6e40abaca2bc56">experiment</a> to connect to. By <span class="keyword">using</span>
<a name="l08671"></a>08671                             <span class="keyword">this</span> <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>, several experiments (e.g. <a class="code" href="mana_8cpp.html#a7fd54785c88eccf892c6aa8d5f6e78d0">online</a>
<a name="l08672"></a>08672                             DAQ <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> offline analysis) can <a class="code" href="odbhist_8c.html#a369e3b30815f09142abc86f462a501ff">run</a> simultan-
<a name="l08673"></a>08673                             eously on the same host.
<a name="l08674"></a>08674 
<a name="l08675"></a>08675   Output:
<a name="l08676"></a>08676     none
<a name="l08677"></a>08677 
<a name="l08678"></a>08678   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l08679"></a>08679     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>              Successful completion
<a name="l08680"></a>08680     <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>            Error <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> socket <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a>
<a name="l08681"></a>08681     <a class="code" href="group__err25.html#ga8e46f3de256d0dc247efd6386b5b5a39">RPC_NOT_REGISTERED</a>       <a class="code" href="group__msectionh.html#gae12b15703f10f41044e599520e665f5a">cm_connect_experiment</a> was not called properly
<a name="l08682"></a>08682     <a class="code" href="group__err21.html#ga10f9c3f1a23d0f63f86edf36143c849d">CM_UNDEF_EXP</a>             Undefined <a class="code" href="structcallback__addr.html#afaf39ee5e680d208ee6e40abaca2bc56">experiment</a> on server
<a name="l08683"></a>08683 
<a name="l08684"></a>08684 \********************************************************************/
<a name="l08685"></a>08685 {
<a name="l08686"></a>08686    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>, <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, <a class="code" href="scs__310__ql355p_8c.html#a11764cc96bb263d1f257bcc01205a787">flag</a>;
<a name="l08687"></a>08687    <span class="keyword">struct </span>sockaddr_in bind_addr;
<a name="l08688"></a>08688    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> sock, lsock1, lsock2, lsock3;
<a name="l08689"></a>08689    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> listen_port1, listen_port2, listen_port3;
<a name="l08690"></a>08690    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> remote_hw_type, hw_type;
<a name="l08691"></a>08691    <span class="keywordtype">int</span> <a class="code" href="ybos_8c.html#adfdd3a80d1d8ea7918a6d1ebee518102">size</a>;
<a name="l08692"></a>08692    <span class="keywordtype">char</span> <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[200], version[32], v1[32];
<a name="l08693"></a>08693    <span class="keywordtype">char</span> local_prog_name[<a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>];
<a name="l08694"></a>08694    <span class="keyword">struct </span>hostent *phe;
<a name="l08695"></a>08695 
<a name="l08696"></a>08696 <span class="preprocessor">#ifdef OS_WINNT</span>
<a name="l08697"></a>08697 <span class="preprocessor"></span>   {
<a name="l08698"></a>08698       WSADATA WSAData;
<a name="l08699"></a>08699 
<a name="l08700"></a>08700       <span class="comment">/* Start windows sockets */</span>
<a name="l08701"></a>08701       <span class="keywordflow">if</span> (WSAStartup(MAKEWORD(1, 1), &amp;WSAData) != 0)
<a name="l08702"></a>08702          <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l08703"></a>08703    }
<a name="l08704"></a>08704 <span class="preprocessor">#endif</span>
<a name="l08705"></a>08705 <span class="preprocessor"></span>
<a name="l08706"></a>08706    <span class="comment">/* check if local connection */</span>
<a name="l08707"></a>08707    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>[0] == 0)
<a name="l08708"></a>08708       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l08709"></a>08709 
<a name="l08710"></a>08710    <span class="comment">/* register system functions */</span>
<a name="l08711"></a>08711    <a class="code" href="group__msectionh.html#gace7386854fda7aedbf0bcb25c2191dc5">rpc_register_functions</a>(<a class="code" href="group__msystemincludecode.html#ga3a79f51ccf8079dcd47c698bc8790c7c">rpc_get_internal_list</a>(0), NULL);
<a name="l08712"></a>08712 
<a name="l08713"></a>08713    <span class="comment">/* check if cm_connect_experiment was called */</span>
<a name="l08714"></a>08714    <span class="keywordflow">if</span> (<a class="code" href="group__midasincludecode.html#gab7fab72dace85185e6be68b79707a4ab">_client_name</a>[0] == 0) {
<a name="l08715"></a>08715       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_connect&quot;</span>,
<a name="l08716"></a>08716              <span class="stringliteral">&quot;cm_connect_experiment/rpc_set_name not called&quot;</span>);
<a name="l08717"></a>08717       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga8e46f3de256d0dc247efd6386b5b5a39">RPC_NOT_REGISTERED</a>;
<a name="l08718"></a>08718    }
<a name="l08719"></a>08719 
<a name="l08720"></a>08720    <span class="comment">/* check if connection already exists */</span>
<a name="l08721"></a>08721    <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a> != 0)
<a name="l08722"></a>08722       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l08723"></a>08723 
<a name="l08724"></a>08724    strcpy(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a9486ada56024332a23bb5559e0016739">host_name</a>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>);
<a name="l08725"></a>08725    strcpy(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#ad05005880d2d1d2b0884a24eff670c7b">exp_name</a>, <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l08726"></a>08726    <a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#acb5e6cb7a6ec57b9121c438f305217e6">transport</a> = <a class="code" href="group__mdefineh.html#ga9d0de5957c2c776323a0c74e668f544d">RPC_TCP</a>;
<a name="l08727"></a>08727    <a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#aa34f2d90cd5dc1467abcc33b8f8f553e">rpc_timeout</a> = <a class="code" href="group__midasincludecode.html#ga39d21da28bfcbf0caba6bd19ef551f36">DEFAULT_RPC_TIMEOUT</a>;
<a name="l08728"></a>08728 
<a name="l08729"></a>08729    <span class="comment">/* create new TCP sockets for listening */</span>
<a name="l08730"></a>08730    lsock1 = socket(AF_INET, SOCK_STREAM, 0);
<a name="l08731"></a>08731    lsock2 = socket(AF_INET, SOCK_STREAM, 0);
<a name="l08732"></a>08732    lsock3 = socket(AF_INET, SOCK_STREAM, 0);
<a name="l08733"></a>08733    <span class="keywordflow">if</span> (lsock3 == -1) {
<a name="l08734"></a>08734       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_connect&quot;</span>, <span class="stringliteral">&quot;cannot create socket&quot;</span>);
<a name="l08735"></a>08735       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l08736"></a>08736    }
<a name="l08737"></a>08737 
<a name="l08738"></a>08738    flag = 1;
<a name="l08739"></a>08739    setsockopt(lsock1, SOL_SOCKET, SO_REUSEADDR, (<span class="keywordtype">char</span> *) &amp;flag, <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>));
<a name="l08740"></a>08740    setsockopt(lsock2, SOL_SOCKET, SO_REUSEADDR, (<span class="keywordtype">char</span> *) &amp;flag, <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>));
<a name="l08741"></a>08741    setsockopt(lsock3, SOL_SOCKET, SO_REUSEADDR, (<span class="keywordtype">char</span> *) &amp;flag, <span class="keyword">sizeof</span>(<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>));
<a name="l08742"></a>08742 
<a name="l08743"></a>08743    <span class="comment">/* let OS choose any port number */</span>
<a name="l08744"></a>08744    memset(&amp;bind_addr, 0, <span class="keyword">sizeof</span>(bind_addr));
<a name="l08745"></a>08745    bind_addr.sin_family = AF_INET;
<a name="l08746"></a>08746    bind_addr.sin_addr.s_addr = htonl(INADDR_ANY);
<a name="l08747"></a>08747    bind_addr.sin_port = 0;
<a name="l08748"></a>08748 
<a name="l08749"></a>08749    status = bind(lsock1, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, <span class="keyword">sizeof</span>(bind_addr));
<a name="l08750"></a>08750    bind_addr.sin_port = 0;
<a name="l08751"></a>08751    status = bind(lsock2, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, <span class="keyword">sizeof</span>(bind_addr));
<a name="l08752"></a>08752    bind_addr.sin_port = 0;
<a name="l08753"></a>08753    status = bind(lsock3, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, <span class="keyword">sizeof</span>(bind_addr));
<a name="l08754"></a>08754    <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l08755"></a>08755       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_connect&quot;</span>, <span class="stringliteral">&quot;cannot bind&quot;</span>);
<a name="l08756"></a>08756       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l08757"></a>08757    }
<a name="l08758"></a>08758 
<a name="l08759"></a>08759    <span class="comment">/* listen for connection */</span>
<a name="l08760"></a>08760    status = listen(lsock1, 1);
<a name="l08761"></a>08761    status = listen(lsock2, 1);
<a name="l08762"></a>08762    status = listen(lsock3, 1);
<a name="l08763"></a>08763    <span class="keywordflow">if</span> (status &lt; 0) {
<a name="l08764"></a>08764       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_connect&quot;</span>, <span class="stringliteral">&quot;cannot listen&quot;</span>);
<a name="l08765"></a>08765       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l08766"></a>08766    }
<a name="l08767"></a>08767 
<a name="l08768"></a>08768    <span class="comment">/* find out which port OS has chosen */</span>
<a name="l08769"></a>08769    size = <span class="keyword">sizeof</span>(bind_addr);
<a name="l08770"></a>08770    getsockname(lsock1, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, (<span class="keywordtype">int</span> *) &amp;size);
<a name="l08771"></a>08771    listen_port1 = ntohs(bind_addr.sin_port);
<a name="l08772"></a>08772    getsockname(lsock2, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, (<span class="keywordtype">int</span> *) &amp;size);
<a name="l08773"></a>08773    listen_port2 = ntohs(bind_addr.sin_port);
<a name="l08774"></a>08774    getsockname(lsock3, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, (<span class="keywordtype">int</span> *) &amp;size);
<a name="l08775"></a>08775    listen_port3 = ntohs(bind_addr.sin_port);
<a name="l08776"></a>08776 
<a name="l08777"></a>08777    <span class="comment">/* create a new socket for connecting to remote server */</span>
<a name="l08778"></a>08778    sock = socket(AF_INET, SOCK_STREAM, 0);
<a name="l08779"></a>08779    <span class="keywordflow">if</span> (sock == -1) {
<a name="l08780"></a>08780       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_connect&quot;</span>, <span class="stringliteral">&quot;cannot create socket&quot;</span>);
<a name="l08781"></a>08781       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l08782"></a>08782    }
<a name="l08783"></a>08783 
<a name="l08784"></a>08784    <span class="comment">/* connect to remote node */</span>
<a name="l08785"></a>08785    memset(&amp;bind_addr, 0, <span class="keyword">sizeof</span>(bind_addr));
<a name="l08786"></a>08786    bind_addr.sin_family = AF_INET;
<a name="l08787"></a>08787    bind_addr.sin_addr.s_addr = 0;
<a name="l08788"></a>08788    bind_addr.sin_port = htons((<span class="keywordtype">short</span>) <a class="code" href="group__midasincludecode.html#ga5e0ae79a5bfdb2f6fc9840d149d702a5">MIDAS_TCP_PORT</a>);
<a name="l08789"></a>08789 
<a name="l08790"></a>08790 <span class="preprocessor">#ifdef OS_VXWORKS</span>
<a name="l08791"></a>08791 <span class="preprocessor"></span>   {
<a name="l08792"></a>08792       <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> host_addr;
<a name="l08793"></a>08793 
<a name="l08794"></a>08794       host_addr = hostGetByName(<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>);
<a name="l08795"></a>08795       memcpy((<span class="keywordtype">char</span> *) &amp;(bind_addr.sin_addr), &amp;host_addr, 4);
<a name="l08796"></a>08796    }
<a name="l08797"></a>08797 <span class="preprocessor">#else</span>
<a name="l08798"></a>08798 <span class="preprocessor"></span>   phe = gethostbyname(<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>);
<a name="l08799"></a>08799    <span class="keywordflow">if</span> (phe == NULL) {
<a name="l08800"></a>08800       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_connect&quot;</span>, <span class="stringliteral">&quot;cannot get host name&quot;</span>);
<a name="l08801"></a>08801       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l08802"></a>08802    }
<a name="l08803"></a>08803    memcpy((<span class="keywordtype">char</span> *) &amp;(bind_addr.sin_addr), phe-&gt;h_addr, phe-&gt;h_length);
<a name="l08804"></a>08804 <span class="preprocessor">#endif</span>
<a name="l08805"></a>08805 <span class="preprocessor"></span>
<a name="l08806"></a>08806 <span class="preprocessor">#ifdef OS_UNIX</span>
<a name="l08807"></a>08807 <span class="preprocessor"></span>   <span class="keywordflow">do</span> {
<a name="l08808"></a>08808       status = connect(sock, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, <span class="keyword">sizeof</span>(bind_addr));
<a name="l08809"></a>08809 
<a name="l08810"></a>08810       <span class="comment">/* don&apos;t return if an alarm signal was cought */</span>
<a name="l08811"></a>08811    } <span class="keywordflow">while</span> (status == -1 &amp;&amp; errno == EINTR);
<a name="l08812"></a>08812 <span class="preprocessor">#else</span>
<a name="l08813"></a>08813 <span class="preprocessor"></span>   status = connect(sock, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, <span class="keyword">sizeof</span>(bind_addr));
<a name="l08814"></a>08814 <span class="preprocessor">#endif</span>
<a name="l08815"></a>08815 <span class="preprocessor"></span>
<a name="l08816"></a>08816    <span class="keywordflow">if</span> (status != 0) {
<a name="l08817"></a>08817 <span class="comment">/*    cm_msg(MERROR, &quot;rpc_server_connect&quot;, &quot;cannot connect&quot;); message should be displayed by application */</span>
<a name="l08818"></a>08818       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l08819"></a>08819    }
<a name="l08820"></a>08820 
<a name="l08821"></a>08821    <span class="comment">/* connect to experiment */</span>
<a name="l08822"></a>08822    <span class="keywordflow">if</span> (<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>[0] == 0)
<a name="l08823"></a>08823       sprintf(str, <span class="stringliteral">&quot;C %d %d %d %s Default&quot;</span>,
<a name="l08824"></a>08824               listen_port1, listen_port2, listen_port3, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l08825"></a>08825    <span class="keywordflow">else</span>
<a name="l08826"></a>08826       sprintf(str, <span class="stringliteral">&quot;C %d %d %d %s %s&quot;</span>,
<a name="l08827"></a>08827               listen_port1, listen_port2, listen_port3, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>(), <a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#a11eee1a5e2cef985b90bdfe0bfc8cf76">exp_name</a>);
<a name="l08828"></a>08828 
<a name="l08829"></a>08829    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(sock, str, strlen(str) + 1, 0);
<a name="l08830"></a>08830    i = <a class="code" href="group__msystemincludecode.html#gaf9411818011b3b2bbc02a1db8340c77a">recv_string</a>(sock, str, <span class="keyword">sizeof</span>(str), 10000);
<a name="l08831"></a>08831    <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(sock);
<a name="l08832"></a>08832    <span class="keywordflow">if</span> (i &lt;= 0) {
<a name="l08833"></a>08833       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_connect&quot;</span>, <span class="stringliteral">&quot;timeout on receive status from server&quot;</span>);
<a name="l08834"></a>08834       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l08835"></a>08835    }
<a name="l08836"></a>08836 
<a name="l08837"></a>08837    status = version[0] = 0;
<a name="l08838"></a>08838    sscanf(str, <span class="stringliteral">&quot;%d %s&quot;</span>, &amp;status, version);
<a name="l08839"></a>08839 
<a name="l08840"></a>08840    <span class="keywordflow">if</span> (status == 2) {
<a name="l08841"></a>08841 <span class="comment">/*  message &quot;undefined experiment&quot; should be displayed by application */</span>
<a name="l08842"></a>08842       <span class="keywordflow">return</span> <a class="code" href="group__err21.html#ga10f9c3f1a23d0f63f86edf36143c849d">CM_UNDEF_EXP</a>;
<a name="l08843"></a>08843    }
<a name="l08844"></a>08844 
<a name="l08845"></a>08845    <span class="comment">/* print warning if version patch level doesn&apos;t agree */</span>
<a name="l08846"></a>08846    strcpy(v1, version);
<a name="l08847"></a>08847    <span class="keywordflow">if</span> (strchr(v1, <span class="charliteral">&apos;.&apos;</span>))
<a name="l08848"></a>08848       <span class="keywordflow">if</span> (strchr(strchr(v1, <span class="charliteral">&apos;.&apos;</span>) + 1, <span class="charliteral">&apos;.&apos;</span>))
<a name="l08849"></a>08849          *strchr(strchr(v1, <span class="charliteral">&apos;.&apos;</span>) + 1, <span class="charliteral">&apos;.&apos;</span>) = 0;
<a name="l08850"></a>08850 
<a name="l08851"></a>08851    strcpy(str, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l08852"></a>08852    <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;.&apos;</span>))
<a name="l08853"></a>08853       <span class="keywordflow">if</span> (strchr(strchr(str, <span class="charliteral">&apos;.&apos;</span>) + 1, <span class="charliteral">&apos;.&apos;</span>))
<a name="l08854"></a>08854          *strchr(strchr(str, <span class="charliteral">&apos;.&apos;</span>) + 1, <span class="charliteral">&apos;.&apos;</span>) = 0;
<a name="l08855"></a>08855 
<a name="l08856"></a>08856    <span class="keywordflow">if</span> (strcmp(v1, str) != 0) {
<a name="l08857"></a>08857       sprintf(str, <span class="stringliteral">&quot;remote MIDAS version %s differs from local version %s&quot;</span>,
<a name="l08858"></a>08858               version, <a class="code" href="group__msectionh.html#ga8bac34abaea6f63d66b617487451b00b">cm_get_version</a>());
<a name="l08859"></a>08859       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_connect&quot;</span>, str);
<a name="l08860"></a>08860    }
<a name="l08861"></a>08861 
<a name="l08862"></a>08862    <span class="comment">/* wait for callback on send and recv socket */</span>
<a name="l08863"></a>08863    size = <span class="keyword">sizeof</span>(bind_addr);
<a name="l08864"></a>08864    <a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a> =
<a name="l08865"></a>08865        accept(lsock1, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, (<span class="keywordtype">int</span> *) &amp;size);
<a name="l08866"></a>08866 
<a name="l08867"></a>08867    <a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a9e4ddffb84154f59ab44da29b17ae9b3">recv_sock</a> =
<a name="l08868"></a>08868        accept(lsock2, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, (<span class="keywordtype">int</span> *) &amp;size);
<a name="l08869"></a>08869 
<a name="l08870"></a>08870    <a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a2e03618197a1b05eed9d7d470ae62362">event_sock</a> =
<a name="l08871"></a>08871        accept(lsock3, (<span class="keyword">struct</span> sockaddr *) &amp;bind_addr, (<span class="keywordtype">int</span> *) &amp;size);
<a name="l08872"></a>08872 
<a name="l08873"></a>08873    <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a> == -1 ||
<a name="l08874"></a>08874        <a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a9e4ddffb84154f59ab44da29b17ae9b3">recv_sock</a> == -1 || <a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a2e03618197a1b05eed9d7d470ae62362">event_sock</a> == -1) {
<a name="l08875"></a>08875       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_connect&quot;</span>, <span class="stringliteral">&quot;accept() failed&quot;</span>);
<a name="l08876"></a>08876       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l08877"></a>08877    }
<a name="l08878"></a>08878 
<a name="l08879"></a>08879    <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(lsock1);
<a name="l08880"></a>08880    <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(lsock2);
<a name="l08881"></a>08881    <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(lsock3);
<a name="l08882"></a>08882 
<a name="l08883"></a>08883    <span class="comment">/* set TCP_NODELAY option for better performance */</span>
<a name="l08884"></a>08884 <span class="preprocessor">#ifdef OS_VXWORKS</span>
<a name="l08885"></a>08885 <span class="preprocessor"></span>   flag = 1;
<a name="l08886"></a>08886    setsockopt(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a>,
<a name="l08887"></a>08887               IPPROTO_TCP, TCP_NODELAY, (<span class="keywordtype">char</span> *) &amp;flag, <span class="keyword">sizeof</span>(flag));
<a name="l08888"></a>08888    setsockopt(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a2e03618197a1b05eed9d7d470ae62362">event_sock</a>,
<a name="l08889"></a>08889               IPPROTO_TCP, TCP_NODELAY, (<span class="keywordtype">char</span> *) &amp;flag, <span class="keyword">sizeof</span>(flag));
<a name="l08890"></a>08890 <span class="preprocessor">#endif</span>
<a name="l08891"></a>08891 <span class="preprocessor"></span>
<a name="l08892"></a>08892    <span class="comment">/* increase send buffer size to 64kB */</span>
<a name="l08893"></a>08893    flag = <a class="code" href="group__midasincludecode.html#ga31190e25ed33be085ff0af476af2c029">NET_TCP_SIZE</a> + 1;
<a name="l08894"></a>08894    setsockopt(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a2e03618197a1b05eed9d7d470ae62362">event_sock</a>, SOL_SOCKET, SO_SNDBUF,
<a name="l08895"></a>08895               (<span class="keywordtype">char</span> *) &amp;flag, <span class="keyword">sizeof</span>(flag));
<a name="l08896"></a>08896 
<a name="l08897"></a>08897    <span class="comment">/* send local computer info */</span>
<a name="l08898"></a>08898    <a class="code" href="group__msectionh.html#ga0fe26d0eebb34139d77a455e50246b26">rpc_get_name</a>(local_prog_name);
<a name="l08899"></a>08899    hw_type = <a class="code" href="group__msectionh.html#gae3bca206872bae947c6e20c1aedfe4f5">rpc_get_option</a>(0, <a class="code" href="group__mdefineh.html#gaf716b122f115aca08e68391343145cb3">RPC_OHW_TYPE</a>);
<a name="l08900"></a>08900    sprintf(str, <span class="stringliteral">&quot;%d %s&quot;</span>, hw_type, local_prog_name);
<a name="l08901"></a>08901 
<a name="l08902"></a>08902    <a class="code" href="scs__310_8c.html#a99ab5360db3bfaf51fa24c1a44ad6436">send</a>(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a>, str, strlen(str) + 1, 0);
<a name="l08903"></a>08903 
<a name="l08904"></a>08904    <span class="comment">/* receive remote computer info */</span>
<a name="l08905"></a>08905    i = <a class="code" href="group__msystemincludecode.html#gaf9411818011b3b2bbc02a1db8340c77a">recv_string</a>(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a>, str, <span class="keyword">sizeof</span>(str), 10000);
<a name="l08906"></a>08906    <span class="keywordflow">if</span> (i &lt;= 0) {
<a name="l08907"></a>08907       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_connect&quot;</span>, <span class="stringliteral">&quot;timeout on receive remote computer info&quot;</span>);
<a name="l08908"></a>08908       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>;
<a name="l08909"></a>08909    }
<a name="l08910"></a>08910 
<a name="l08911"></a>08911    sscanf(str, <span class="stringliteral">&quot;%d&quot;</span>, &amp;remote_hw_type);
<a name="l08912"></a>08912    <a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a89249bd9355ce7f1342458c9805ad3b8">remote_hw_type</a> = remote_hw_type;
<a name="l08913"></a>08913 
<a name="l08914"></a>08914    <span class="comment">/* set dispatcher which receives database updates */</span>
<a name="l08915"></a>08915    <a class="code" href="group__msystemincludecode.html#gac1b39a6f689a24e9aaf239ee73a81b15">ss_suspend_set_dispatch</a>(<a class="code" href="group__msystemincludecode.html#ga60eec4e9fe61ed440483e362f9786be1">CH_CLIENT</a>, &amp;<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>,
<a name="l08916"></a>08916                            (<span class="keywordtype">int</span> (*)(<span class="keywordtype">void</span>)) <a class="code" href="group__rpcfunctionc.html#gaddfad24a27898f83c9d51e41dd208bc6">rpc_client_dispatch</a>);
<a name="l08917"></a>08917 
<a name="l08918"></a>08918    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l08919"></a>08919 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaa174e89a3826f4387d4d02469e51bd1b"></a><!-- doxytag: member="midas.c::rpc_server_disconnect" ref="gaa174e89a3826f4387d4d02469e51bd1b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_server_disconnect </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l08975">8975</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="melog_8c_source.html#l00085">closesocket</a>, <a class="el" href="msystem_8h_source.html#l00438">RPC_SERVER_CONNECTION::event_sock</a>, <a class="el" href="msystem_8h_source.html#l00437">RPC_SERVER_CONNECTION::recv_sock</a>, <a class="el" href="midas_8c_source.html#l09810">rpc_call()</a>, <a class="el" href="midas_8c_source.html#l10305">rpc_flush_event()</a>, <a class="el" href="mrpc_8h_source.html#l00203">RPC_ID_EXIT</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, and <a class="el" href="msystem_8h_source.html#l00436">RPC_SERVER_CONNECTION::send_sock</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l02349">cm_connect_experiment1()</a>, <a class="el" href="midas_8c_source.html#l02768">cm_disconnect_experiment()</a>, and <a class="el" href="midas_8c_source.html#l09810">rpc_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08978"></a>08978          : <a class="code" href="group__msystemincludecode.html#ga9dc3c2bbdd9fda3156e6cd8c3e470963">rpc_server_disconnect</a>
<a name="l08979"></a>08979 
<a name="l08980"></a>08980   Purpose: Close a rpc connection to a MIDAS server <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> close all
<a name="l08981"></a>08981            server connections from other clients
<a name="l08982"></a>08982 
<a name="l08983"></a>08983   Input:
<a name="l08984"></a>08984     none
<a name="l08985"></a>08985 
<a name="l08986"></a>08986   Output:
<a name="l08987"></a>08987     none
<a name="l08988"></a>08988 
<a name="l08989"></a>08989   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l08990"></a>08990    <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l08991"></a>08991    <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>           Error <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a> socket <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a>
<a name="l08992"></a>08992    <a class="code" href="group__err25.html#gad3a9f2a6b26ce5b987f6b2088fbb627c">RPC_NO_CONNECTION</a>       Maximum number of connections reached
<a name="l08993"></a>08993 
<a name="l08994"></a>08994 \********************************************************************/
<a name="l08995"></a>08995 {
<a name="l08996"></a>08996    <span class="keyword">static</span> <span class="keywordtype">int</span> rpc_server_disconnect_recursion_level = 0;
<a name="l08997"></a>08997 
<a name="l08998"></a>08998    <span class="keywordflow">if</span> (rpc_server_disconnect_recursion_level)
<a name="l08999"></a>08999       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l09000"></a>09000 
<a name="l09001"></a>09001    rpc_server_disconnect_recursion_level = 1;
<a name="l09002"></a>09002 
<a name="l09003"></a>09003    <span class="comment">/* flush remaining events */</span>
<a name="l09004"></a>09004    <a class="code" href="group__msectionh.html#ga0f78b1f2d6558798873b49801c9291e0">rpc_flush_event</a>();
<a name="l09005"></a>09005 
<a name="l09006"></a>09006    <span class="comment">/* notify server about exit */</span>
<a name="l09007"></a>09007    <a class="code" href="group__msectionh.html#ga6bf1d13a0c49a3f7a02650885937b5e7">rpc_call</a>(<a class="code" href="group__mrpcdefineh.html#ga4fecef60778fda08ca026eaad345eca2">RPC_ID_EXIT</a>);
<a name="l09008"></a>09008 
<a name="l09009"></a>09009    <span class="comment">/* close sockets */</span>
<a name="l09010"></a>09010    <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a>);
<a name="l09011"></a>09011    <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a9e4ddffb84154f59ab44da29b17ae9b3">recv_sock</a>);
<a name="l09012"></a>09012    <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a2e03618197a1b05eed9d7d470ae62362">event_sock</a>);
<a name="l09013"></a>09013 
<a name="l09014"></a>09014    memset(&amp;<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="structRPC__SERVER__CONNECTION.html">RPC_SERVER_CONNECTION</a>));
<a name="l09015"></a>09015 
<a name="l09016"></a>09016    rpc_server_disconnect_recursion_level = 0;
<a name="l09017"></a>09017    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l09018"></a>09018 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga8bad7cd9b75d3a9879745bbd61742ded"></a><!-- doxytag: member="midas.c::rpc_server_receive" ref="ga8bad7cd9b75d3a9879745bbd61742ded" args="(INT index, int sock, BOOL check)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_server_receive </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a>&nbsp;</td>
          <td class="paramname"> <em>check</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l12223">12223</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l00812">_msg_buffer</a>, <a class="el" href="midas_8c_source.html#l00821">_net_recv_buffer</a>, <a class="el" href="midas_8c_source.html#l00822">_net_recv_buffer_size</a>, <a class="el" href="midas_8c_source.html#l04722">bm_close_all_buffers()</a>, <a class="el" href="midas_8c_source.html#l06057">bm_send_event()</a>, <a class="el" href="midas_8h_source.html#l00977">BM_SUCCESS</a>, <a class="el" href="melog_8c_source.html#l00085">closesocket</a>, <a class="el" href="midas_8c_source.html#l01863">cm_delete_client_info()</a>, <a class="el" href="midas_8c_source.html#l02913">cm_get_experiment_database()</a>, <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="midas_8c_source.html#l02850">cm_set_experiment_database()</a>, <a class="el" href="midas_8c_source.html#l04756">cm_watchdog()</a>, <a class="el" href="midas_8h_source.html#l01195">EVENT_HEADER::data_size</a>, <a class="el" href="odb_8c_source.html#l01498">db_close_all_databases()</a>, <a class="el" href="msystem_8h_source.html#l00201">DR_ASCII</a>, <a class="el" href="mucap__compress_8cpp_source.html#l00011">hDB</a>, <a class="el" href="mevb_8cpp_source.html#l00100">hKey</a>, <a class="el" href="midas_8h_source.html#l01755">M_FREE</a>, <a class="el" href="midas_8h_source.html#l01753">M_MALLOC</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l00938">MTALK</a>, <a class="el" href="msystem_8h_source.html#l00457">RPC_SERVER_ACCEPTION::net_buffer</a>, <a class="el" href="rpc_8c_source.html#l00293">net_buffer</a>, <a class="el" href="msystem_8h_source.html#l00257">NET_BUFFER_SIZE</a>, <a class="el" href="midas_8c_source.html#l10655">recv_event_server()</a>, <a class="el" href="system_8c_source.html#l03660">recv_string()</a>, <a class="el" href="midas_8c_source.html#l10454">recv_tcp_server()</a>, <a class="el" href="midas_8c_source.html#l09447">rpc_debug_printf()</a>, <a class="el" href="midas_8c_source.html#l08273">rpc_deregister_functions()</a>, <a class="el" href="midas_8h_source.html#l01071">RPC_EXCEED_BUFFER</a>, <a class="el" href="midas_8c_source.html#l10990">rpc_execute()</a>, <a class="el" href="midas_8c_source.html#l11292">rpc_execute_ascii()</a>, <a class="el" href="midas_8c_source.html#l09250">rpc_get_server_option()</a>, <a class="el" href="midas_8h_source.html#l00772">RPC_OSERVER_TYPE</a>, <a class="el" href="midas_8c_source.html#l09068">rpc_set_server_acception()</a>, <a class="el" href="midas_8h_source.html#l01075">RPC_SHUTDOWN</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l01047">SS_ABORT</a>, <a class="el" href="system_8c_source.html#l02703">ss_alarm()</a>, <a class="el" href="midas_8h_source.html#l01048">SS_EXIT</a>, <a class="el" href="system_8c_source.html#l02265">ss_millitime()</a>, <a class="el" href="midas_8h_source.html#l01033">SS_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l01795">ST_REMOTE</a>, <a class="el" href="old__mevb_8cpp_source.html#l00065">start_time</a>, <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>, and <a class="el" href="midas_8h_source.html#l00755">SYNC</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l11860">rpc_client_accept()</a>, and <a class="el" href="midas_8c_source.html#l11980">rpc_server_callback()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l12226"></a>12226          : <a class="code" href="group__msystemincludecode.html#ga8bad7cd9b75d3a9879745bbd61742ded">rpc_server_receive</a>
<a name="l12227"></a>12227 
<a name="l12228"></a>12228   Purpose: Receive rpc commands <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> <a class="code" href="subm__250_8c.html#a61af3e60b94ae3e748f6fbac1e794af7">execute</a> them. Close the connection
<a name="l12229"></a>12229            <span class="keywordflow">if</span> client has broken TCP pipe.
<a name="l12230"></a>12230 
<a name="l12231"></a>12231   Input:
<a name="l12232"></a>12232     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>    <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>            Index to <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a> structure <a class="code" href="scs__600__p1_8c.html#af8480819a437c1eaeaa5b28b890613fa">in</a>-
<a name="l12233"></a>12233                             dicating which connection got <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>.
<a name="l12234"></a>12234     <span class="keywordtype">int</span>    sock             Socket which got <a class="code" href="lrs1821_8c.html#a7c3d85e54927f04c38e110e849168bb9">data</a>
<a name="l12235"></a>12235     <a class="code" href="group__midasincludecode.html#ga239c7f0d40651c3e419c5b9651507d14">BOOL</a>   check            If <a class="code" href="p30_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, only check <span class="keywordflow">if</span> connection is
<a name="l12236"></a>12236                             broken. This may be called via
<a name="l12237"></a>12237                             <a class="code" href="group__msectionh.html#ga0f5bcc113e8cb6023e1f3a61f6c78c48">bm_receive_event</a>/<a class="code" href="group__msystemincludecode.html#ga057bcc23c79e804679785d98b1223bd1">ss_suspend</a>(..,<a class="code" href="group__msystemincludecode.html#ga6e9a9a9996cea71191a21fd2009efcd1">MSG_BM</a>)
<a name="l12238"></a>12238 
<a name="l12239"></a>12239   Output:
<a name="l12240"></a>12240     none
<a name="l12241"></a>12241 
<a name="l12242"></a>12242   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l12243"></a>12243     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l12244"></a>12244     <a class="code" href="group__err25.html#ga1a35d5e05d16d9040eaad41c4434a20a">RPC_EXCEED_BUFFER</a>       Not enough memeory to allocate <a class="code" href="fal_8c.html#a368f7094dc38acca20612bbb392552f4">buffer</a>
<a name="l12245"></a>12245     <a class="code" href="group__err24.html#ga8bdfd6ab89f9628d57174f8a4287bf9f">SS_EXIT</a>                 Server connection was closed
<a name="l12246"></a>12246     <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a>                Server connection was broken
<a name="l12247"></a>12247 
<a name="l12248"></a>12248 \********************************************************************/
<a name="l12249"></a>12249 {
<a name="l12250"></a>12250    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, n_received;
<a name="l12251"></a>12251    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> remaining, *pbh, <a class="code" href="old__mevb_8cpp.html#af4211e1ba0e676018599e88cfae3537a">start_time</a>;
<a name="l12252"></a>12252    <span class="keywordtype">char</span> test_buffer[256], <a class="code" href="odbhist_8c.html#a45bb529d5408fcb730eeccb339110d3f">str</a>[80];
<a name="l12253"></a>12253    <a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *pevent;
<a name="l12254"></a>12254 
<a name="l12255"></a>12255    <span class="comment">/* init network buffer */</span>
<a name="l12256"></a>12256    <span class="keywordflow">if</span> (<a class="code" href="group__midasincludecode.html#ga8f8bb92aff8896e9750dbed9cf46f5bb">_net_recv_buffer_size</a> == 0) {
<a name="l12257"></a>12257       <a class="code" href="group__midasincludecode.html#gac2786c85fc784e54933ad3a3bc387da4">_net_recv_buffer</a> = (<span class="keywordtype">char</span> *) <a class="code" href="group__msectionh.html#ga130728d73c8c9b46e0b9bd2e34557c3d">M_MALLOC</a>(<a class="code" href="group__msystemincludecode.html#ga7554d698d310e57e1c933a8f952a4bf8">NET_BUFFER_SIZE</a>);
<a name="l12258"></a>12258       <span class="keywordflow">if</span> (<a class="code" href="group__midasincludecode.html#gac2786c85fc784e54933ad3a3bc387da4">_net_recv_buffer</a> == NULL) {
<a name="l12259"></a>12259          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_receive&quot;</span>,
<a name="l12260"></a>12260                 <span class="stringliteral">&quot;not enough memory to allocate network buffer&quot;</span>);
<a name="l12261"></a>12261          <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga1a35d5e05d16d9040eaad41c4434a20a">RPC_EXCEED_BUFFER</a>;
<a name="l12262"></a>12262       }
<a name="l12263"></a>12263       <a class="code" href="group__midasincludecode.html#ga8f8bb92aff8896e9750dbed9cf46f5bb">_net_recv_buffer_size</a> = <a class="code" href="group__msystemincludecode.html#ga7554d698d310e57e1c933a8f952a4bf8">NET_BUFFER_SIZE</a>;
<a name="l12264"></a>12264    }
<a name="l12265"></a>12265 
<a name="l12266"></a>12266    <span class="comment">/* only check if TCP connection is broken */</span>
<a name="l12267"></a>12267    <span class="keywordflow">if</span> (check) {
<a name="l12268"></a>12268       n_received = recv(sock, test_buffer, <span class="keyword">sizeof</span>(test_buffer), MSG_PEEK);
<a name="l12269"></a>12269 
<a name="l12270"></a>12270       <span class="keywordflow">if</span> (n_received == -1)
<a name="l12271"></a>12271          <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_receive&quot;</span>,
<a name="l12272"></a>12272                 <span class="stringliteral">&quot;recv(%d,MSG_PEEK) returned %d, errno: %d (%s)&quot;</span>, <span class="keyword">sizeof</span>(test_buffer),
<a name="l12273"></a>12273                 n_received, errno, strerror(errno));
<a name="l12274"></a>12274 
<a name="l12275"></a>12275       <span class="keywordflow">if</span> (n_received &lt;= 0)
<a name="l12276"></a>12276          <span class="keywordflow">return</span> <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a>;
<a name="l12277"></a>12277 
<a name="l12278"></a>12278       <span class="keywordflow">return</span> <a class="code" href="group__err24.html#ga0abac6c68d7a79ce83d1a25b2c800321">SS_SUCCESS</a>;
<a name="l12279"></a>12279    }
<a name="l12280"></a>12280 
<a name="l12281"></a>12281    remaining = 0;
<a name="l12282"></a>12282 
<a name="l12283"></a>12283    <span class="comment">/* receive command */</span>
<a name="l12284"></a>12284    <span class="keywordflow">if</span> (sock == <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].recv_sock) {
<a name="l12285"></a>12285       <span class="keywordflow">do</span> {
<a name="l12286"></a>12286          <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].remote_hw_type == <a class="code" href="group__msdefineh.html#ga0fd6c5fc5e2431d0fc11fc9ca12c6baa">DR_ASCII</a>)
<a name="l12287"></a>12287             n_received = <a class="code" href="group__msystemincludecode.html#gaf9411818011b3b2bbc02a1db8340c77a">recv_string</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].recv_sock, <a class="code" href="group__midasincludecode.html#gac2786c85fc784e54933ad3a3bc387da4">_net_recv_buffer</a>,
<a name="l12288"></a>12288                                      <a class="code" href="group__msystemincludecode.html#ga7554d698d310e57e1c933a8f952a4bf8">NET_BUFFER_SIZE</a>, 10000);
<a name="l12289"></a>12289          <span class="keywordflow">else</span>
<a name="l12290"></a>12290             n_received =
<a name="l12291"></a>12291                 <a class="code" href="group__rpcfunctionc.html#ga328db10bbb615c2e1ac895cf6e94d31c">recv_tcp_server</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="group__midasincludecode.html#gac2786c85fc784e54933ad3a3bc387da4">_net_recv_buffer</a>, <a class="code" href="group__msystemincludecode.html#ga7554d698d310e57e1c933a8f952a4bf8">NET_BUFFER_SIZE</a>, 0, &amp;remaining);
<a name="l12292"></a>12292 
<a name="l12293"></a>12293          <span class="keywordflow">if</span> (n_received &lt;= 0) {
<a name="l12294"></a>12294             status = <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a>;
<a name="l12295"></a>12295             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_receive&quot;</span>, <span class="stringliteral">&quot;recv_tcp_server() returned %d, abort&quot;</span>,
<a name="l12296"></a>12296                    n_received);
<a name="l12297"></a>12297             <span class="keywordflow">goto</span> error;
<a name="l12298"></a>12298          }
<a name="l12299"></a>12299 
<a name="l12300"></a>12300          <a class="code" href="group__msystemincludecode.html#ga6990e0eb5b97aeb6667ddd03d69b4065">rpc_set_server_acception</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a> + 1);
<a name="l12301"></a>12301 
<a name="l12302"></a>12302          <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].remote_hw_type == <a class="code" href="group__msdefineh.html#ga0fd6c5fc5e2431d0fc11fc9ca12c6baa">DR_ASCII</a>)
<a name="l12303"></a>12303             status = <a class="code" href="group__rpcfunctionc.html#ga30e35c5ffd03eb5084e63e04b50e3d60">rpc_execute_ascii</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].recv_sock,
<a name="l12304"></a>12304                                        <a class="code" href="group__midasincludecode.html#gac2786c85fc784e54933ad3a3bc387da4">_net_recv_buffer</a>);
<a name="l12305"></a>12305          <span class="keywordflow">else</span>
<a name="l12306"></a>12306             status = <a class="code" href="group__rpcfunctionc.html#gaaececfb5cc7b4e302cc4f31dae7f773b">rpc_execute</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].recv_sock,
<a name="l12307"></a>12307                                  <a class="code" href="group__midasincludecode.html#gac2786c85fc784e54933ad3a3bc387da4">_net_recv_buffer</a>,
<a name="l12308"></a>12308                                  <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].convert_flags);
<a name="l12309"></a>12309 
<a name="l12310"></a>12310          <span class="keywordflow">if</span> (status == <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a>) {
<a name="l12311"></a>12311             <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_receive&quot;</span>, <span class="stringliteral">&quot;rpc_execute() returned %d, abort&quot;</span>,
<a name="l12312"></a>12312                    status);
<a name="l12313"></a>12313             <span class="keywordflow">goto</span> error;
<a name="l12314"></a>12314          }
<a name="l12315"></a>12315 
<a name="l12316"></a>12316          <span class="keywordflow">if</span> (status == <a class="code" href="group__err24.html#ga8bdfd6ab89f9628d57174f8a4287bf9f">SS_EXIT</a> || status == <a class="code" href="group__err25.html#ga0406ee07e8c5afbf8e46cb0eed698bcd">RPC_SHUTDOWN</a>) {
<a name="l12317"></a>12317             <span class="keywordflow">if</span> (<a class="code" href="group__msystemincludecode.html#ga500895b6f1fb39626453b56a20ed52df">rpc_get_server_option</a>(<a class="code" href="group__mdefineh.html#ga7f6354019d48c7beeb8f5bd5c2fac8bb">RPC_OSERVER_TYPE</a>) != <a class="code" href="group__msectionh.html#ga9c6b34250ccc696d64a6a0a572947be5">ST_REMOTE</a>)
<a name="l12318"></a>12318                <a class="code" href="group__msectionh.html#ga5122c91743605847f8368e17758dedbf">rpc_debug_printf</a>(<span class="stringliteral">&quot;Connection to %s:%s closed\n&quot;</span>,
<a name="l12319"></a>12319                       <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>,
<a name="l12320"></a>12320                       <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].prog_name);
<a name="l12321"></a>12321             <span class="keywordflow">goto</span> exit;
<a name="l12322"></a>12322          }
<a name="l12323"></a>12323 
<a name="l12324"></a>12324       } <span class="keywordflow">while</span> (remaining);
<a name="l12325"></a>12325    } <span class="keywordflow">else</span> {
<a name="l12326"></a>12326       <span class="comment">/* receive event */</span>
<a name="l12327"></a>12327       <span class="keywordflow">if</span> (sock == <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].event_sock) {
<a name="l12328"></a>12328          start_time = <a class="code" href="group__msectionh.html#gaeb8fc912d50c2360588c50782b9c916d">ss_millitime</a>();
<a name="l12329"></a>12329 
<a name="l12330"></a>12330          <span class="keywordflow">do</span> {
<a name="l12331"></a>12331             n_received =
<a name="l12332"></a>12332                 <a class="code" href="group__rpcfunctionc.html#gacbce72f1a2b5db72b1fe517b06493282">recv_event_server</a>(<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>, <a class="code" href="group__midasincludecode.html#gac2786c85fc784e54933ad3a3bc387da4">_net_recv_buffer</a>, <a class="code" href="group__msystemincludecode.html#ga7554d698d310e57e1c933a8f952a4bf8">NET_BUFFER_SIZE</a>, 0,
<a name="l12333"></a>12333                                   &amp;remaining);
<a name="l12334"></a>12334 
<a name="l12335"></a>12335             <span class="keywordflow">if</span> (n_received &lt;= 0) {
<a name="l12336"></a>12336                status = <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a>;
<a name="l12337"></a>12337                <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_receive&quot;</span>,
<a name="l12338"></a>12338                       <span class="stringliteral">&quot;recv_event_server() returned %d, abort&quot;</span>, n_received);
<a name="l12339"></a>12339                <span class="keywordflow">goto</span> error;
<a name="l12340"></a>12340             }
<a name="l12341"></a>12341 
<a name="l12342"></a>12342             <span class="comment">/* send event to buffer */</span>
<a name="l12343"></a>12343             pbh = (<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) <a class="code" href="group__midasincludecode.html#gac2786c85fc784e54933ad3a3bc387da4">_net_recv_buffer</a>;
<a name="l12344"></a>12344             pevent = (<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *) (pbh + 1);
<a name="l12345"></a>12345 
<a name="l12346"></a>12346             status =
<a name="l12347"></a>12347                 <a class="code" href="group__msectionh.html#ga5ebc713e2f1e7f0b6d257f072221321f">bm_send_event</a>(*pbh, pevent, pevent-&gt;<a class="code" href="group__midasincludecode.html#ga194220c29419e01ef4cab6d3dd8daedb">data_size</a> + <span class="keyword">sizeof</span>(<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a>),
<a name="l12348"></a>12348                               <a class="code" href="group__mdefineh.html#ga9ac82e856c7683e23553431e5224d5f4">SYNC</a>);
<a name="l12349"></a>12349             <span class="keywordflow">if</span> (status != <a class="code" href="group__err22.html#gadccfb762fd84f9e33940f3d1204042b0">BM_SUCCESS</a>)
<a name="l12350"></a>12350                <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_server_receive&quot;</span>, <span class="stringliteral">&quot;bm_send_event() returned %d&quot;</span>,
<a name="l12351"></a>12351                       status);
<a name="l12352"></a>12352 
<a name="l12353"></a>12353             <span class="comment">/* repeat for maximum 0.5 sec */</span>
<a name="l12354"></a>12354          } <span class="keywordflow">while</span> (<a class="code" href="group__msectionh.html#gaeb8fc912d50c2360588c50782b9c916d">ss_millitime</a>() - start_time &lt; 500 &amp;&amp; remaining);
<a name="l12355"></a>12355       }
<a name="l12356"></a>12356    }
<a name="l12357"></a>12357 
<a name="l12358"></a>12358    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l12359"></a>12359 
<a name="l12360"></a>12360  error:
<a name="l12361"></a>12361 
<a name="l12362"></a>12362    strcpy(str, <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="crate6__CAEN__TDC_2mfe__mucap_8c.html#af65cc3664520b7cd0817adc7106f9624">host_name</a>);
<a name="l12363"></a>12363    <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;.&apos;</span>))
<a name="l12364"></a>12364       *strchr(str, <span class="charliteral">&apos;.&apos;</span>) = 0;
<a name="l12365"></a>12365    <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="group__mdefineh.html#gad6a8d32f94873258d0eebcbe5b24a78e">MTALK</a>, <span class="stringliteral">&quot;rpc_server_receive&quot;</span>, <span class="stringliteral">&quot;Program %s on host %s aborted&quot;</span>,
<a name="l12366"></a>12366           <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].prog_name, str);
<a name="l12367"></a>12367 
<a name="l12368"></a>12368  exit:
<a name="l12369"></a>12369 
<a name="l12370"></a>12370    <span class="comment">/* disconnect from experiment as MIDAS server */</span>
<a name="l12371"></a>12371    <span class="keywordflow">if</span> (<a class="code" href="group__msystemincludecode.html#ga500895b6f1fb39626453b56a20ed52df">rpc_get_server_option</a>(<a class="code" href="group__mdefineh.html#ga7f6354019d48c7beeb8f5bd5c2fac8bb">RPC_OSERVER_TYPE</a>) != <a class="code" href="group__msectionh.html#ga9c6b34250ccc696d64a6a0a572947be5">ST_REMOTE</a>) {
<a name="l12372"></a>12372       <a class="code" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a> <a class="code" href="mucap__compress_8cpp.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, <a class="code" href="mevb_8cpp.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>;
<a name="l12373"></a>12373 
<a name="l12374"></a>12374       <a class="code" href="group__msectionh.html#ga1932e7947b0a024a845c5b8c19c3dda0">cm_get_experiment_database</a>(&amp;hDB, &amp;hKey);
<a name="l12375"></a>12375 
<a name="l12376"></a>12376       <span class="comment">/* only disconnect from experiment if previously connected.</span>
<a name="l12377"></a>12377 <span class="comment">         Necessary for pure RPC servers (RPC_SRVR) */</span>
<a name="l12378"></a>12378       <span class="keywordflow">if</span> (hDB) {
<a name="l12379"></a>12379 <span class="preprocessor">#ifdef LOCAL_ROUTINES</span>
<a name="l12380"></a>12380 <span class="preprocessor"></span>         <a class="code" href="group__msystemincludecode.html#ga966add828f64f4449ccb34a871c0ca5d">ss_alarm</a>(0, <a class="code" href="group__msectionh.html#ga1678d1fb6719e38c6d038bda0c1354d4">cm_watchdog</a>);
<a name="l12381"></a>12381 <span class="preprocessor">#endif</span>
<a name="l12382"></a>12382 <span class="preprocessor"></span>
<a name="l12383"></a>12383          <a class="code" href="group__cmfunctionc.html#gace4f91b59217b2dc6216065cc41377a1">cm_delete_client_info</a>(hDB, 0);
<a name="l12384"></a>12384 
<a name="l12385"></a>12385          <a class="code" href="group__msectionh.html#gaac9a1b7ba597848cb3b99ccc76509878">bm_close_all_buffers</a>();
<a name="l12386"></a>12386          <a class="code" href="group__msectionh.html#ga9a5094a26773a7fc25ade95e6339268e">db_close_all_databases</a>();
<a name="l12387"></a>12387 
<a name="l12388"></a>12388          <a class="code" href="group__msystemincludecode.html#ga4e6777649b4a4f2a75ac419bdffa27b2">rpc_deregister_functions</a>();
<a name="l12389"></a>12389 
<a name="l12390"></a>12390          <a class="code" href="group__msectionh.html#gaa41954bb2f11576eecc3ea7a7e9eff83">cm_set_experiment_database</a>(0, 0);
<a name="l12391"></a>12391 
<a name="l12392"></a>12392          <a class="code" href="group__midasincludecode.html#gaf391f6438dbb6d734dfee78f0a3b6c59">_msg_buffer</a> = 0;
<a name="l12393"></a>12393       }
<a name="l12394"></a>12394    }
<a name="l12395"></a>12395 
<a name="l12396"></a>12396    <span class="comment">/* close server connection */</span>
<a name="l12397"></a>12397    <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].recv_sock)
<a name="l12398"></a>12398       <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].recv_sock);
<a name="l12399"></a>12399    <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].send_sock)
<a name="l12400"></a>12400       <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].send_sock);
<a name="l12401"></a>12401    <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].event_sock)
<a name="l12402"></a>12402       <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].event_sock);
<a name="l12403"></a>12403 
<a name="l12404"></a>12404    <span class="comment">/* free TCP cache */</span>
<a name="l12405"></a>12405    <a class="code" href="group__msectionh.html#ga95c0d83820c28cf52ea13271b034fcb2">M_FREE</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="rpc_8c.html#ae6ae865fae68267535e16f3a36033155">net_buffer</a>);
<a name="l12406"></a>12406    <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a6400b37f1e31eb4bbaab7785f72497e4">net_buffer</a> = NULL;
<a name="l12407"></a>12407 
<a name="l12408"></a>12408    <span class="comment">/* mark this entry as invalid */</span>
<a name="l12409"></a>12409    memset(&amp;<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[<a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>], 0, <span class="keyword">sizeof</span>(<a class="code" href="structRPC__SERVER__ACCEPTION.html">RPC_SERVER_ACCEPTION</a>));
<a name="l12410"></a>12410 
<a name="l12411"></a>12411    <span class="comment">/* signal caller a shutdonw */</span>
<a name="l12412"></a>12412    <span class="keywordflow">if</span> (status == <a class="code" href="group__err25.html#ga0406ee07e8c5afbf8e46cb0eed698bcd">RPC_SHUTDOWN</a>)
<a name="l12413"></a>12413       <span class="keywordflow">return</span> status;
<a name="l12414"></a>12414 
<a name="l12415"></a>12415    <span class="comment">/* don&apos;t abort if other than main connection is broken */</span>
<a name="l12416"></a>12416    <span class="keywordflow">if</span> (<a class="code" href="group__msystemincludecode.html#ga500895b6f1fb39626453b56a20ed52df">rpc_get_server_option</a>(<a class="code" href="group__mdefineh.html#ga7f6354019d48c7beeb8f5bd5c2fac8bb">RPC_OSERVER_TYPE</a>) == <a class="code" href="group__msectionh.html#ga9c6b34250ccc696d64a6a0a572947be5">ST_REMOTE</a>)
<a name="l12417"></a>12417       <span class="keywordflow">return</span> <a class="code" href="group__err24.html#ga0abac6c68d7a79ce83d1a25b2c800321">SS_SUCCESS</a>;
<a name="l12418"></a>12418 
<a name="l12419"></a>12419    <span class="keywordflow">return</span> status;
<a name="l12420"></a>12420 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga8db992c1518cf2e01bd9c4590babd8f1"></a><!-- doxytag: member="midas.c::rpc_server_shutdown" ref="ga8db992c1518cf2e01bd9c4590babd8f1" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_server_shutdown </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l12424">12424</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l00858">_server_registered</a>, <a class="el" href="melog_8c_source.html#l00085">closesocket</a>, <a class="el" href="msystem_8h_source.html#l00451">RPC_SERVER_ACCEPTION::event_sock</a>, <a class="el" href="p30_8h_source.html#l00042">FALSE</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="msystem_8h_source.html#l00255">MAX_RPC_CONNECTION</a>, <a class="el" href="msystem_8h_source.html#l00450">RPC_SERVER_ACCEPTION::recv_sock</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="msystem_8h_source.html#l00449">RPC_SERVER_ACCEPTION::send_sock</a>, and <a class="el" href="system_8c_source.html#l03133">ss_suspend_exit()</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l02768">cm_disconnect_experiment()</a>, and <a class="el" href="camacsrv_8c_source.html#l00155">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l12427"></a>12427          : <a class="code" href="group__msectionh.html#gaa86de5637b6d3f535bfe2d751fe1bd34">rpc_server_shutdown</a>
<a name="l12428"></a>12428 
<a name="l12429"></a>12429   Purpose: Shutdown RPC server, abort all connections
<a name="l12430"></a>12430 
<a name="l12431"></a>12431   Input:
<a name="l12432"></a>12432     none
<a name="l12433"></a>12433 
<a name="l12434"></a>12434   Output:
<a name="l12435"></a>12435     none
<a name="l12436"></a>12436 
<a name="l12437"></a>12437   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l12438"></a>12438     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l12439"></a>12439 
<a name="l12440"></a>12440 \********************************************************************/
<a name="l12441"></a>12441 {
<a name="l12442"></a>12442    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l12443"></a>12443    <span class="keyword">struct </span>linger ling;
<a name="l12444"></a>12444 
<a name="l12445"></a>12445    <span class="comment">/* close all open connections */</span>
<a name="l12446"></a>12446    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__msystemincludecode.html#gab1e8a2a4c5dc40faf6f7c25b51a4562f">MAX_RPC_CONNECTION</a>; i++)
<a name="l12447"></a>12447       <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].recv_sock != 0) {
<a name="l12448"></a>12448          <span class="comment">/* lingering needed for PCTCP */</span>
<a name="l12449"></a>12449          ling.l_onoff = 1;
<a name="l12450"></a>12450          ling.l_linger = 0;
<a name="l12451"></a>12451          setsockopt(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].recv_sock,
<a name="l12452"></a>12452                     SOL_SOCKET, SO_LINGER, (<span class="keywordtype">char</span> *) &amp;ling, <span class="keyword">sizeof</span>(ling));
<a name="l12453"></a>12453          <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].recv_sock);
<a name="l12454"></a>12454 
<a name="l12455"></a>12455          <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].send_sock) {
<a name="l12456"></a>12456             setsockopt(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].send_sock,
<a name="l12457"></a>12457                        SOL_SOCKET, SO_LINGER, (<span class="keywordtype">char</span> *) &amp;ling, <span class="keyword">sizeof</span>(ling));
<a name="l12458"></a>12458             <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].send_sock);
<a name="l12459"></a>12459          }
<a name="l12460"></a>12460 
<a name="l12461"></a>12461          <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].event_sock) {
<a name="l12462"></a>12462             setsockopt(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].event_sock,
<a name="l12463"></a>12463                        SOL_SOCKET, SO_LINGER, (<span class="keywordtype">char</span> *) &amp;ling, <span class="keyword">sizeof</span>(ling));
<a name="l12464"></a>12464             <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].event_sock);
<a name="l12465"></a>12465          }
<a name="l12466"></a>12466 
<a name="l12467"></a>12467          <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a160df84318ca2158f9302af6fe95330e">recv_sock</a> = 0;
<a name="l12468"></a>12468          <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a24df135a5376a4d0ec7acfc7bfd63bca">send_sock</a> = 0;
<a name="l12469"></a>12469          <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].<a class="code" href="structRPC__SERVER__ACCEPTION.html#ac770d0f286e0392201250d6d8c2f76eb">event_sock</a> = 0;
<a name="l12470"></a>12470       }
<a name="l12471"></a>12471 
<a name="l12472"></a>12472    <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga697ab24f60fe31109c15eef59cb5546f">_lsock</a>) {
<a name="l12473"></a>12473       <a class="code" href="melog_8c.html#a5a3eb971b466278ada4f7f87399a537c">closesocket</a>(<a class="code" href="group__rpcfunctionc.html#ga697ab24f60fe31109c15eef59cb5546f">_lsock</a>);
<a name="l12474"></a>12474       <a class="code" href="group__rpcfunctionc.html#ga697ab24f60fe31109c15eef59cb5546f">_lsock</a> = 0;
<a name="l12475"></a>12475       <a class="code" href="group__midasincludecode.html#ga1faa9de415887abb7e24a895712e8061">_server_registered</a> = <a class="code" href="p30_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l12476"></a>12476    }
<a name="l12477"></a>12477 
<a name="l12478"></a>12478    <span class="comment">/* free suspend structures */</span>
<a name="l12479"></a>12479    <a class="code" href="group__msystemincludecode.html#ga2e0e4eceba5ed8eb192ece6ebe3a916e">ss_suspend_exit</a>();
<a name="l12480"></a>12480 
<a name="l12481"></a>12481    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l12482"></a>12482 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaab67c95f34e6244dea904f852b37ffce"></a><!-- doxytag: member="midas.c::rpc_server_thread" ref="gaab67c95f34e6244dea904f852b37ffce" args="(void *pointer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_server_thread </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>pointer</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l12166">12166</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l16417">al_check()</a>, <a class="el" href="midas_8c_source.html#l02864">cm_set_experiment_mutex()</a>, <a class="el" href="midas_8c_source.html#l12486">rpc_check_channels()</a>, <a class="el" href="midas_8c_source.html#l09022">rpc_is_remote()</a>, <a class="el" href="midas_8h_source.html#l01069">RPC_NET_ERROR</a>, <a class="el" href="midas_8c_source.html#l11980">rpc_server_callback()</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l01047">SS_ABORT</a>, <a class="el" href="midas_8h_source.html#l01048">SS_EXIT</a>, <a class="el" href="system_8c_source.html#l01818">ss_mutex_create()</a>, <a class="el" href="system_8c_source.html#l03283">ss_suspend()</a>, <a class="el" href="system_8c_source.html#l03133">ss_suspend_exit()</a>, <a class="el" href="system_8c_source.html#l02332">ss_time()</a>, and <a class="el" href="patch__mevb_8cpp_source.html#l00079">status</a>.</p>

<p>Referenced by <a class="el" href="mserver_8c_source.html#l00246">main()</a>, and <a class="el" href="midas_8c_source.html#l11616">rpc_server_accept()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l12169"></a>12169          : <a class="code" href="group__msectionh.html#ga6acef00058028cff58b5c1cb94996142">rpc_server_thread</a>
<a name="l12170"></a>12170 
<a name="l12171"></a>12171   Purpose: New thread <span class="keywordflow">for</span> a multi-threaded server. Callback to the
<a name="l12172"></a>12172            client <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> process RPC requests.
<a name="l12173"></a>12173 
<a name="l12174"></a>12174   Input:
<a name="l12175"></a>12175     vcoid  pointer          pointer to <a class="code" href="structcallback__addr.html">callback_addr</a> structure.
<a name="l12176"></a>12176 
<a name="l12177"></a>12177   Output:
<a name="l12178"></a>12178     none
<a name="l12179"></a>12179 
<a name="l12180"></a>12180   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l12181"></a>12181     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l12182"></a>12182 
<a name="l12183"></a>12183 \********************************************************************/
<a name="l12184"></a>12184 {
<a name="l12185"></a>12185    <span class="keyword">struct </span><a class="code" href="structcallback__addr.html">callback_addr</a> <a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>;
<a name="l12186"></a>12186    <span class="keywordtype">int</span> <a class="code" href="patch__mevb_8cpp.html#a015eb90e0de9f16e87bd149d4b9ce959">status</a>, mutex_alarm, mutex_elog;
<a name="l12187"></a>12187    <span class="keyword">static</span> <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> last_checked = 0;
<a name="l12188"></a>12188 
<a name="l12189"></a>12189    memcpy(&amp;<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>, pointer, <span class="keyword">sizeof</span>(<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>));
<a name="l12190"></a>12190 
<a name="l12191"></a>12191    status = <a class="code" href="group__msystemincludecode.html#ga5ebaebf950488abd35459b82de08899c">rpc_server_callback</a>(&amp;<a class="code" href="mserver_8c.html#a847e3001e4ea9147cfab3529da5b8c36">callback</a>);
<a name="l12192"></a>12192 
<a name="l12193"></a>12193    <span class="keywordflow">if</span> (status != <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>)
<a name="l12194"></a>12194       <span class="keywordflow">return</span> status;
<a name="l12195"></a>12195 
<a name="l12196"></a>12196    <span class="comment">/* create alarm and elog mutexes */</span>
<a name="l12197"></a>12197    <a class="code" href="group__msystemincludecode.html#ga518ac9986c25e4f472f7d731a98ca2f3">ss_mutex_create</a>(<span class="stringliteral">&quot;ALARM&quot;</span>, &amp;mutex_alarm);
<a name="l12198"></a>12198    <a class="code" href="group__msystemincludecode.html#ga518ac9986c25e4f472f7d731a98ca2f3">ss_mutex_create</a>(<span class="stringliteral">&quot;ELOG&quot;</span>, &amp;mutex_elog);
<a name="l12199"></a>12199    <a class="code" href="group__msectionh.html#gabbf4fc4b84347f4b44726e3309f83d86">cm_set_experiment_mutex</a>(mutex_alarm, mutex_elog);
<a name="l12200"></a>12200 
<a name="l12201"></a>12201    <span class="keywordflow">do</span> {
<a name="l12202"></a>12202       status = <a class="code" href="group__msystemincludecode.html#ga057bcc23c79e804679785d98b1223bd1">ss_suspend</a>(5000, 0);
<a name="l12203"></a>12203 
<a name="l12204"></a>12204       <span class="keywordflow">if</span> (<a class="code" href="group__msystemincludecode.html#gae04dcc2753aa274bcfe09835be8ddfb9">rpc_check_channels</a>() == <a class="code" href="group__err25.html#gae7db91aa77eeed4371ba30dfc122ded6">RPC_NET_ERROR</a>)
<a name="l12205"></a>12205          <span class="keywordflow">break</span>;
<a name="l12206"></a>12206 
<a name="l12207"></a>12207       <span class="comment">/* check alarms every 10 seconds */</span>
<a name="l12208"></a>12208       <span class="keywordflow">if</span> (!<a class="code" href="group__msectionh.html#ga0090933001e7e1ddd52ed3f321bea957">rpc_is_remote</a>() &amp;&amp; <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>() - last_checked &gt; 10) {
<a name="l12209"></a>12209          <a class="code" href="group__msectionh.html#ga111e1947ecc6a4d5c52728d888168762">al_check</a>();
<a name="l12210"></a>12210          last_checked = <a class="code" href="group__msectionh.html#ga910c0323866ee0d55ea786b90f594b49">ss_time</a>();
<a name="l12211"></a>12211       }
<a name="l12212"></a>12212 
<a name="l12213"></a>12213    } <span class="keywordflow">while</span> (status != <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a> &amp;&amp; status != <a class="code" href="group__err24.html#ga8bdfd6ab89f9628d57174f8a4287bf9f">SS_EXIT</a>);
<a name="l12214"></a>12214 
<a name="l12215"></a>12215    <span class="comment">/* delete entry in suspend table for this thread */</span>
<a name="l12216"></a>12216    <a class="code" href="group__msystemincludecode.html#ga2e0e4eceba5ed8eb192ece6ebe3a916e">ss_suspend_exit</a>();
<a name="l12217"></a>12217 
<a name="l12218"></a>12218    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l12219"></a>12219 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga9c3732bc3b6cbe75ddbbc7f5e2c78509"></a><!-- doxytag: member="midas.c::rpc_set_debug" ref="ga9c3732bc3b6cbe75ddbbc7f5e2c78509" args="(void(*func)(char *), INT mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_set_debug </td>
          <td>(</td>
          <td class="paramtype">void(*)(char *)&nbsp;</td>
          <td class="paramname"> <em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>mode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l09420">9420</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8c_source.html#l00834">_debug_mode</a>, <a class="el" href="group__midasincludecode.html#ga61a5bec512ad6edef8384e4853a0eded">_debug_print</a>, and <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>.</p>

<p>Referenced by <a class="el" href="rpc__srvr_8c_source.html#l00100">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09423"></a>09423          : <a class="code" href="group__msectionh.html#gace4f55535524757cfb1a0ace8ed264e6">rpc_set_debug</a>
<a name="l09424"></a>09424 
<a name="l09425"></a>09425   Purpose: Set a function which is called on every RPC <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a> to
<a name="l09426"></a>09426            <a class="code" href="examples_2macro_2midas__macro_8h.html#aa088095d2fabc6972c25ad622744cfd1">display</a> the function <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a> <a class="code" href="examples_2macro_2midas__macro_8h.html#aa3d7d535cf450b91b9cb6d9cee2edbb9">and</a> parameters of the RPC
<a name="l09427"></a>09427            <a class="code" href="examples_2macro_2midas__macro_8h.html#a01f23030e8f35ef3c830e0bbb53e91bc">call</a>.
<a name="l09428"></a>09428 
<a name="l09429"></a>09429   Input:
<a name="l09430"></a>09430    <span class="keywordtype">void</span> *func(<span class="keywordtype">char</span>*)        Pointer to function.
<a name="l09431"></a>09431    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>  <a class="code" href="mscbutil_8c.html#a74b654271a172a244c844fb86277cd8a">mode</a>                Debug <a class="code" href="mscbutil_8c.html#a74b654271a172a244c844fb86277cd8a">mode</a>
<a name="l09432"></a>09432 
<a name="l09433"></a>09433   Output:
<a name="l09434"></a>09434     none
<a name="l09435"></a>09435 
<a name="l09436"></a>09436   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l09437"></a>09437     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l09438"></a>09438 
<a name="l09439"></a>09439 \********************************************************************/
<a name="l09440"></a>09440 {
<a name="l09441"></a>09441    <a class="code" href="group__midasincludecode.html#ga61a5bec512ad6edef8384e4853a0eded">_debug_print</a> = func;
<a name="l09442"></a>09442    <a class="code" href="group__midasincludecode.html#ga8efe0542b4273b7863a8a4e1f16776fe">_debug_mode</a> = <a class="code" href="mscbutil_8c.html#a74b654271a172a244c844fb86277cd8a">mode</a>;
<a name="l09443"></a>09443    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l09444"></a>09444 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gad8aeb762e203073e37c6c14c2a5e9567"></a><!-- doxytag: member="midas.c::rpc_set_name" ref="gad8aeb762e203073e37c6c14c2a5e9567" args="(char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_set_name </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l09394">9394</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>.</p>

<p>Referenced by <a class="el" href="camacrpc_8c_source.html#l00073">cam_init_rpc()</a>, <a class="el" href="midas_8c_source.html#l02349">cm_connect_experiment1()</a>, <a class="el" href="midas_8c_source.html#l01976">cm_set_client_info()</a>, and <a class="el" href="midas_8c_source.html#l08197">rpc_register_client()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09397"></a>09397          : <a class="code" href="group__msectionh.html#gaeeeea2e9156202fc493eef175b54b0f0">rpc_set_name</a>
<a name="l09398"></a>09398 
<a name="l09399"></a>09399   Purpose: Set <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a> of actual program <span class="keywordflow">for</span> further rpc connections
<a name="l09400"></a>09400 
<a name="l09401"></a>09401   Input:
<a name="l09402"></a>09402    <span class="keywordtype">char</span> *<a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>               Program <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>, up to <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a> chars,
<a name="l09403"></a>09403                             no blanks
<a name="l09404"></a>09404 
<a name="l09405"></a>09405   Output:
<a name="l09406"></a>09406     none
<a name="l09407"></a>09407 
<a name="l09408"></a>09408   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l09409"></a>09409     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l09410"></a>09410 
<a name="l09411"></a>09411 \********************************************************************/
<a name="l09412"></a>09412 {
<a name="l09413"></a>09413    strcpy(<a class="code" href="group__midasincludecode.html#gab7fab72dace85185e6be68b79707a4ab">_client_name</a>, <a class="code" href="examples_2macro_2midas__macro_8h.html#ab53d3e6e6144dcb27935cc71c57bc508">name</a>);
<a name="l09414"></a>09414 
<a name="l09415"></a>09415    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l09416"></a>09416 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gab28fefb4196d9ae55f6010b683a59745"></a><!-- doxytag: member="midas.c::rpc_set_opt_tcp_size" ref="gab28fefb4196d9ae55f6010b683a59745" args="(INT tcp_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_set_opt_tcp_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>tcp_size</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l10087">10087</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l01446">scheduler()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10088"></a>10088 {
<a name="l10089"></a>10089    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> old;
<a name="l10090"></a>10090 
<a name="l10091"></a>10091    old = <a class="code" href="group__rpcfunctionc.html#ga20e63d0a316b30ec4fbd8766dd04c52d">_opt_tcp_size</a>;
<a name="l10092"></a>10092    <a class="code" href="group__rpcfunctionc.html#ga20e63d0a316b30ec4fbd8766dd04c52d">_opt_tcp_size</a> = tcp_size;
<a name="l10093"></a>10093    <span class="keywordflow">return</span> old;
<a name="l10094"></a>10094 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaab360e4fd185439b0913c723581115ea"></a><!-- doxytag: member="midas.c::rpc_set_option" ref="gaab360e4fd185439b0913c723581115ea" args="(HNDLE hConn, INT item, INT value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_set_option </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__midasincludecode.html#ga0e1bcf128ad8422667adffd1dea59791">HNDLE</a>&nbsp;</td>
          <td class="paramname"> <em>hConn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>item</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox Set RPC option </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hConn</em>&nbsp;</td><td>RPC connection handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>item</em>&nbsp;</td><td>One of RPC_Oxxx </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>value</em>&nbsp;</td><td>Value to set </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>RPC_SUCCESS </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l09211">9211</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="lrs1821_8h_source.html#l00218">cm_msg</a>, <a class="el" href="lrs1821_8h_source.html#l00220">MERROR</a>, <a class="el" href="midas_8h_source.html#l00779">RPC_NODELAY</a>, <a class="el" href="midas_8h_source.html#l00768">RPC_OTIMEOUT</a>, <a class="el" href="midas_8h_source.html#l00769">RPC_OTRANSPORT</a>, <a class="el" href="msystem_8h_source.html#l00428">RPC_CLIENT_CONNECTION::rpc_timeout</a>, <a class="el" href="msystem_8h_source.html#l00441">RPC_SERVER_CONNECTION::rpc_timeout</a>, <a class="el" href="msystem_8h_source.html#l00436">RPC_SERVER_CONNECTION::send_sock</a>, <a class="el" href="msystem_8h_source.html#l00427">RPC_CLIENT_CONNECTION::transport</a>, and <a class="el" href="msystem_8h_source.html#l00440">RPC_SERVER_CONNECTION::transport</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l03579">cm_transition()</a>, <a class="el" href="odbedit_8c_source.html#l01415">command_loop()</a>, <a class="el" href="odb_8c_source.html#l08155">db_send_changed_records()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l02042">main()</a>, <a class="el" href="midas_8c_source.html#l08923">rpc_client_disconnect()</a>, <a class="el" href="crate3_2rpc__master_8cpp_source.html#l00091">rpc_master_bor()</a>, <a class="el" href="crate3_2rpc__slave_8cpp_source.html#l00092">rpc_slave_bor()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l01446">scheduler()</a>, and <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00842">update_odb()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09212"></a>09212 {
<a name="l09213"></a>09213    <span class="keywordflow">switch</span> (item) {
<a name="l09214"></a>09214    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga9d274f0e5944be5b429d6c1bacfe1db0">RPC_OTIMEOUT</a>:
<a name="l09215"></a>09215       <span class="keywordflow">if</span> (<a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a> == -1)
<a name="l09216"></a>09216          <a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#aa34f2d90cd5dc1467abcc33b8f8f553e">rpc_timeout</a> = <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;
<a name="l09217"></a>09217       <span class="keywordflow">else</span>
<a name="l09218"></a>09218          <a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[<a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a> - 1].<a class="code" href="structRPC__CLIENT__CONNECTION.html#a63051393eedd1fca0e91c42c34f4441f">rpc_timeout</a> = <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;
<a name="l09219"></a>09219       <span class="keywordflow">break</span>;
<a name="l09220"></a>09220 
<a name="l09221"></a>09221    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga42ebe781b990fe561db5759b1ce9b633">RPC_OTRANSPORT</a>:
<a name="l09222"></a>09222       <span class="keywordflow">if</span> (<a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a> == -1)
<a name="l09223"></a>09223          <a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#acb5e6cb7a6ec57b9121c438f305217e6">transport</a> = <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;
<a name="l09224"></a>09224       <span class="keywordflow">else</span>
<a name="l09225"></a>09225          <a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[<a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a> - 1].<a class="code" href="structRPC__CLIENT__CONNECTION.html#a526ef7cf39ae237154b4725aafb2fd0b">transport</a> = <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;
<a name="l09226"></a>09226       <span class="keywordflow">break</span>;
<a name="l09227"></a>09227 
<a name="l09228"></a>09228    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#gabc81b907fb096f57766487d3ae18a732">RPC_NODELAY</a>:
<a name="l09229"></a>09229       <span class="keywordflow">if</span> (<a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a> == -1)
<a name="l09230"></a>09230          setsockopt(<a class="code" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a>.<a class="code" href="structRPC__SERVER__CONNECTION.html#a5ac023d16d40e5dd70f8820065681c9c">send_sock</a>, IPPROTO_TCP,
<a name="l09231"></a>09231                     TCP_NODELAY, (<span class="keywordtype">char</span> *) &amp;<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <span class="keyword">sizeof</span>(value));
<a name="l09232"></a>09232       <span class="keywordflow">else</span>
<a name="l09233"></a>09233          setsockopt(<a class="code" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[<a class="code" href="camacrpc_8c.html#a42c1b988d32310a2f5db9535276a8af0">hConn</a> - 1].send_sock, IPPROTO_TCP,
<a name="l09234"></a>09234                     TCP_NODELAY, (<span class="keywordtype">char</span> *) &amp;<a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <span class="keyword">sizeof</span>(value));
<a name="l09235"></a>09235       <span class="keywordflow">break</span>;
<a name="l09236"></a>09236 
<a name="l09237"></a>09237    <span class="keywordflow">default</span>:
<a name="l09238"></a>09238       <a class="code" href="lrs1821_8h.html#aa6f8a5999f0a072ce20ab87bae8a9eb5">cm_msg</a>(<a class="code" href="lrs1821_8h.html#ac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;rpc_set_option&quot;</span>, <span class="stringliteral">&quot;invalid argument&quot;</span>);
<a name="l09239"></a>09239       <span class="keywordflow">break</span>;
<a name="l09240"></a>09240    }
<a name="l09241"></a>09241 
<a name="l09242"></a>09242    <span class="keywordflow">return</span> 0;
<a name="l09243"></a>09243 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga6990e0eb5b97aeb6667ddd03d69b4065"></a><!-- doxytag: member="midas.c::rpc_set_server_acception" ref="ga6990e0eb5b97aeb6667ddd03d69b4065" args="(INT index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_set_server_acception </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>index</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l09068">9068</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l11860">rpc_client_accept()</a>, <a class="el" href="midas_8c_source.html#l11980">rpc_server_callback()</a>, and <a class="el" href="midas_8c_source.html#l12223">rpc_server_receive()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09071"></a>09071          : <a class="code" href="group__msystemincludecode.html#ga6990e0eb5b97aeb6667ddd03d69b4065">rpc_set_server_acception</a>
<a name="l09072"></a>09072 
<a name="l09073"></a>09073   Purpose: Set actual RPC server connection <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>
<a name="l09074"></a>09074 
<a name="l09075"></a>09075   Input:
<a name="l09076"></a>09076     <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>  <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>              Server <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>
<a name="l09077"></a>09077 
<a name="l09078"></a>09078   Output:
<a name="l09079"></a>09079     none
<a name="l09080"></a>09080 
<a name="l09081"></a>09081   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l09082"></a>09082     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l09083"></a>09083 
<a name="l09084"></a>09084 \********************************************************************/
<a name="l09085"></a>09085 {
<a name="l09086"></a>09086    <a class="code" href="group__rpcfunctionc.html#ga9ac2420c00b7dfb59718e71077d29568">_server_acception_index</a> = <a class="code" href="mana_8cpp.html#a312c2cad451d6bb0536fb9ec2863be59">index</a>;
<a name="l09087"></a>09087    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l09088"></a>09088 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga7c05b913a74075409ae5054feba51338"></a><!-- doxytag: member="midas.c::rpc_set_server_option" ref="ga7c05b913a74075409ae5054feba51338" args="(INT item, PTYPE value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_set_server_option </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>item</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PTYPE&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l09308">9308</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="msystem_8h_source.html#l00463">RPC_SERVER_ACCEPTION::client_handle</a>, <a class="el" href="msystem_8h_source.html#l00456">RPC_SERVER_ACCEPTION::convert_flags</a>, <a class="el" href="mdump_8c_source.html#l00115">i</a>, <a class="el" href="Mql_8h_source.html#l00011">MAX</a>, <a class="el" href="msystem_8h_source.html#l00255">MAX_RPC_CONNECTION</a>, <a class="el" href="msystem_8h_source.html#l00462">RPC_SERVER_ACCEPTION::odb_handle</a>, <a class="el" href="midas_8h_source.html#l00776">RPC_CLIENT_HANDLE</a>, <a class="el" href="midas_8h_source.html#l00774">RPC_CONVERT_FLAGS</a>, <a class="el" href="midas_8h_source.html#l00775">RPC_ODB_HANDLE</a>, <a class="el" href="midas_8h_source.html#l00773">RPC_OSERVER_NAME</a>, <a class="el" href="midas_8h_source.html#l00772">RPC_OSERVER_TYPE</a>, <a class="el" href="midas_8h_source.html#l01066">RPC_SUCCESS</a>, <a class="el" href="midas_8h_source.html#l00778">RPC_WATCHDOG_TIMEOUT</a>, <a class="el" href="system_8c_source.html#l01050">ss_gettid()</a>, <a class="el" href="midas_8h_source.html#l01792">ST_MTHREAD</a>, <a class="el" href="midas_8h_source.html#l01795">ST_REMOTE</a>, <a class="el" href="midas_8h_source.html#l01791">ST_SINGLE</a>, and <a class="el" href="msystem_8h_source.html#l00454">RPC_SERVER_ACCEPTION::watchdog_timeout</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l01976">cm_set_client_info()</a>, <a class="el" href="midas_8c_source.html#l03000">cm_set_watchdog_params()</a>, <a class="el" href="mserver_8c_source.html#l00246">main()</a>, <a class="el" href="midas_8c_source.html#l11860">rpc_client_accept()</a>, <a class="el" href="midas_8c_source.html#l10866">rpc_register_server()</a>, and <a class="el" href="midas_8c_source.html#l11980">rpc_server_callback()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09311"></a>09311          : <a class="code" href="group__msystemincludecode.html#gaec24042a470eec42ec344d7fc552d4f5">rpc_set_server_option</a>
<a name="l09312"></a>09312 
<a name="l09313"></a>09313   Purpose: Set RPC option <span class="keywordflow">for</span> server connection
<a name="l09314"></a>09314 
<a name="l09315"></a>09315   Input:
<a name="l09316"></a>09316    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>  item               One of RPC_Oxxx
<a name="l09317"></a>09317    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>  <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>              Value to <span class="keyword">set</span>
<a name="l09318"></a>09318 
<a name="l09319"></a>09319   Output:
<a name="l09320"></a>09320     none
<a name="l09321"></a>09321 
<a name="l09322"></a>09322   Function <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>:
<a name="l09323"></a>09323     <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>             Successful completion
<a name="l09324"></a>09324 
<a name="l09325"></a>09325 \********************************************************************/
<a name="l09326"></a>09326 {
<a name="l09327"></a>09327    <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> <a class="code" href="mdump_8c.html#a65a8886d814fb9bf73f9d4f0fd64d162">i</a>;
<a name="l09328"></a>09328 
<a name="l09329"></a>09329    <span class="keywordflow">if</span> (item == <a class="code" href="group__mdefineh.html#ga7f6354019d48c7beeb8f5bd5c2fac8bb">RPC_OSERVER_TYPE</a>) {
<a name="l09330"></a>09330       <a class="code" href="group__rpcfunctionc.html#ga71a7c9d97df5dbe0a62770034ae6757f">_server_type</a> = <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;
<a name="l09331"></a>09331       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l09332"></a>09332    }
<a name="l09333"></a>09333    <span class="keywordflow">if</span> (item == <a class="code" href="group__mdefineh.html#ga1caa8de36fbdd251b67fd4601d0e708f">RPC_OSERVER_NAME</a>) {
<a name="l09334"></a>09334       strcpy(<a class="code" href="group__rpcfunctionc.html#gaa16848418d977932c5cdf9e61f660e13">_server_name</a>, (<span class="keywordtype">char</span> *) <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);
<a name="l09335"></a>09335       <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l09336"></a>09336    }
<a name="l09337"></a>09337 
<a name="l09338"></a>09338    <span class="comment">/* check which connections belongs to caller */</span>
<a name="l09339"></a>09339    <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a7c9d97df5dbe0a62770034ae6757f">_server_type</a> == <a class="code" href="group__msectionh.html#ga88fcaca68212b5824a0b0f6c9507ebcb">ST_MTHREAD</a>) {
<a name="l09340"></a>09340       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__msystemincludecode.html#gab1e8a2a4c5dc40faf6f7c25b51a4562f">MAX_RPC_CONNECTION</a>; i++)
<a name="l09341"></a>09341          <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].tid == <a class="code" href="group__msystemincludecode.html#ga47dde62638a1a4e9f49534bff449ebcd">ss_gettid</a>())
<a name="l09342"></a>09342             <span class="keywordflow">break</span>;
<a name="l09343"></a>09343    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__rpcfunctionc.html#ga71a7c9d97df5dbe0a62770034ae6757f">_server_type</a> == <a class="code" href="group__msectionh.html#gafd1f60d6275582530d610f3a599cb270">ST_SINGLE</a> || <a class="code" href="group__rpcfunctionc.html#ga71a7c9d97df5dbe0a62770034ae6757f">_server_type</a> == <a class="code" href="group__msectionh.html#ga9c6b34250ccc696d64a6a0a572947be5">ST_REMOTE</a>)
<a name="l09344"></a>09344       i = <a class="code" href="Mql_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(0, <a class="code" href="group__rpcfunctionc.html#ga9ac2420c00b7dfb59718e71077d29568">_server_acception_index</a> - 1);
<a name="l09345"></a>09345    <span class="keywordflow">else</span>
<a name="l09346"></a>09346       i = 0;
<a name="l09347"></a>09347 
<a name="l09348"></a>09348    <span class="keywordflow">switch</span> (item) {
<a name="l09349"></a>09349    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#gaddb075d303a5903df6a7dabdad02defd">RPC_CONVERT_FLAGS</a>:
<a name="l09350"></a>09350       <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a9f2d73aafabf6b3ef45298739b8d2400">convert_flags</a> = <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;
<a name="l09351"></a>09351       <span class="keywordflow">break</span>;
<a name="l09352"></a>09352    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga26df61334e35fe4bba4ba7353dcbb66b">RPC_ODB_HANDLE</a>:
<a name="l09353"></a>09353       <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].<a class="code" href="structRPC__SERVER__ACCEPTION.html#a95b7eaf4dc40c0c1ae8970d16807f33c">odb_handle</a> = <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;
<a name="l09354"></a>09354       <span class="keywordflow">break</span>;
<a name="l09355"></a>09355    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga2ef5ce0b2c01e38ea5152abfc357dbad">RPC_CLIENT_HANDLE</a>:
<a name="l09356"></a>09356       <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].<a class="code" href="structRPC__SERVER__ACCEPTION.html#ac8d274baf533bead5daf48cf2de73501">client_handle</a> = <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;
<a name="l09357"></a>09357       <span class="keywordflow">break</span>;
<a name="l09358"></a>09358    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#gabc2142bbf1d961c3702ddcc8791388c0">RPC_WATCHDOG_TIMEOUT</a>:
<a name="l09359"></a>09359       <a class="code" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[i].<a class="code" href="structRPC__SERVER__ACCEPTION.html#ab63d3134ce8331c26bb08d1bf585b617">watchdog_timeout</a> = <a class="code" href="ADCS_8h.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;
<a name="l09360"></a>09360       <span class="keywordflow">break</span>;
<a name="l09361"></a>09361    }
<a name="l09362"></a>09362 
<a name="l09363"></a>09363    <span class="keywordflow">return</span> <a class="code" href="group__err25.html#ga19b06966ce058cda8e5dca8d682b2bd3">RPC_SUCCESS</a>;
<a name="l09364"></a>09364 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga7a677a606e7764e1f234c9f01ad6d9a0"></a><!-- doxytag: member="midas.c::rpc_tid_name" ref="ga7a677a606e7764e1f234c9f01ad6d9a0" args="(INT id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* rpc_tid_name </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>id</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l08170">8170</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l00751">TID_LAST</a>, and <a class="el" href="midas_8c_source.html#l00770">tid_name</a>.</p>

<p>Referenced by <a class="el" href="fal_8c_source.html#l01113">ascii_write()</a>, <a class="el" href="odbedit_8c_source.html#l01415">command_loop()</a>, <a class="el" href="odb_8c_source.html#l04150">db_get_data()</a>, <a class="el" href="odb_8c_source.html#l04244">db_get_data1()</a>, <a class="el" href="odb_8c_source.html#l04376">db_get_data_index()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="odb_8c_source.html#l05976">db_save_xml_key()</a>, <a class="el" href="odb_8c_source.html#l04503">db_set_data()</a>, <a class="el" href="odb_8c_source.html#l04727">db_set_data_index()</a>, <a class="el" href="odb_8c_source.html#l04836">db_set_data_index2()</a>, <a class="el" href="odb_8c_source.html#l03128">db_set_value()</a>, <a class="el" href="fal_8c_source.html#l00863">dump_write()</a>, <a class="el" href="odbedit_8c_source.html#l00463">print_key()</a>, <a class="el" href="odbedit_8c_source.html#l00651">scan_tree()</a>, <a class="el" href="mhttpd_8c_source.html#l05983">show_set_page()</a>, and <a class="el" href="mana_8cpp_source.html#l02526">write_event_ascii()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08171"></a>08171 {
<a name="l08172"></a>08172    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &lt; <a class="code" href="group__mdefineh.html#gaedf8b3d53db358c7f8b92514815ab3d7">TID_LAST</a>)
<a name="l08173"></a>08173       <span class="keywordflow">return</span> <a class="code" href="group__midasincludecode.html#ga56817fd0e397d2cb86d14a899d00750d">tid_name</a>[id];
<a name="l08174"></a>08174    <span class="keywordflow">else</span>
<a name="l08175"></a>08175       <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>;
<a name="l08176"></a>08176 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gafa95bfc034f148c327429236c1dbc9d5"></a><!-- doxytag: member="midas.c::rpc_tid_size" ref="gafa95bfc034f148c327429236c1dbc9d5" args="(INT id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> rpc_tid_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>id</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l08162">8162</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l00751">TID_LAST</a>, and <a class="el" href="midas_8c_source.html#l00749">tid_size</a>.</p>

<p>Referenced by <a class="el" href="fal_8c_source.html#l01113">ascii_write()</a>, <a class="el" href="odb_8c_source.html#l01721">db_create_key()</a>, <a class="el" href="odb_8c_source.html#l03261">db_get_value()</a>, <a class="el" href="odb_8c_source.html#l05473">db_paste()</a>, <a class="el" href="odb_8c_source.html#l06532">db_recurse_record_tree()</a>, <a class="el" href="odb_8c_source.html#l03128">db_set_value()</a>, <a class="el" href="odb_8c_source.html#l06435">db_sscanf()</a>, <a class="el" href="mhist_8c_source.html#l00341">display_range_hist()</a>, <a class="el" href="mhist_8c_source.html#l00296">display_single_hist()</a>, <a class="el" href="fal_8c_source.html#l00863">dump_write()</a>, <a class="el" href="midas_8c_source.html#l14695">hs_dump()</a>, <a class="el" href="midas_8c_source.html#l14339">hs_read()</a>, <a class="el" href="fal_8c_source.html#l03313">mana_init()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00554">register_equipment()</a>, <a class="el" href="mserver_8c_source.html#l00534">rpc_server_dispatch()</a>, <a class="el" href="odbedit_8c_source.html#l00615">set_key()</a>, <a class="el" href="mhttpd_8c_source.html#l05983">show_set_page()</a>, <a class="el" href="crate6__CAEN__TDC_2mfe__mucap_8c_source.html#l00842">update_odb()</a>, <a class="el" href="mana_8cpp_source.html#l02526">write_event_ascii()</a>, <a class="el" href="fal_8c_source.html#l03085">write_event_hbook()</a>, and <a class="el" href="fal_8c_source.html#l02785">write_event_odb()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08163"></a>08163 {
<a name="l08164"></a>08164    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &lt; <a class="code" href="group__mdefineh.html#gaedf8b3d53db358c7f8b92514815ab3d7">TID_LAST</a>)
<a name="l08165"></a>08165       <span class="keywordflow">return</span> <a class="code" href="group__midasincludecode.html#ga97cc1898bd6240261b5418bcab5a6d35">tid_size</a>[id];
<a name="l08166"></a>08166 
<a name="l08167"></a>08167    <span class="keywordflow">return</span> 0;
<a name="l08168"></a>08168 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga4c54bf7646af19000ed7892e294ad71f"></a><!-- doxytag: member="midas.c::rpc_va_arg" ref="ga4c54bf7646af19000ed7892e294ad71f" args="(va_list *arg_ptr, INT arg_type, void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rpc_va_arg </td>
          <td>(</td>
          <td class="paramtype">va_list *&nbsp;</td>
          <td class="paramname"> <em>arg_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>arg_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l09479">9479</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>References <a class="el" href="midas_8h_source.html#l00747">TID_ARRAY</a>, <a class="el" href="midas_8h_source.html#l00742">TID_BOOL</a>, <a class="el" href="midas_8h_source.html#l00735">TID_BYTE</a>, <a class="el" href="midas_8h_source.html#l00737">TID_CHAR</a>, <a class="el" href="midas_8h_source.html#l00744">TID_DOUBLE</a>, <a class="el" href="midas_8h_source.html#l00740">TID_DWORD</a>, <a class="el" href="midas_8h_source.html#l00743">TID_FLOAT</a>, <a class="el" href="midas_8h_source.html#l00741">TID_INT</a>, <a class="el" href="midas_8h_source.html#l00736">TID_SBYTE</a>, <a class="el" href="midas_8h_source.html#l00739">TID_SHORT</a>, and <a class="el" href="midas_8h_source.html#l00738">TID_WORD</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l09810">rpc_call()</a>, and <a class="el" href="midas_8c_source.html#l09519">rpc_client_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09480"></a>09480 {
<a name="l09481"></a>09481    <span class="keywordflow">switch</span> (arg_type) {
<a name="l09482"></a>09482       <span class="comment">/* On the stack, the minimum parameter size is sizeof(int).</span>
<a name="l09483"></a>09483 <span class="comment">         To avoid problems on little endian systems, treat all</span>
<a name="l09484"></a>09484 <span class="comment">         smaller parameters as int&apos;s */</span>
<a name="l09485"></a>09485    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga7499d3aa0ca98d255f5147494ab4f572">TID_BYTE</a>:
<a name="l09486"></a>09486    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga150e3437f490b1e7c0e11046a9ead174">TID_SBYTE</a>:
<a name="l09487"></a>09487    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#gad4af77af5f2910e73596592030e37ab7">TID_CHAR</a>:
<a name="l09488"></a>09488    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga681cbe2c114c62cecccb882544d2debb">TID_WORD</a>:
<a name="l09489"></a>09489    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga4281dafac4285eae3e3c9be0a1d93c5a">TID_SHORT</a>:
<a name="l09490"></a>09490       *((<span class="keywordtype">int</span> *) arg) = va_arg(*arg_ptr, <span class="keywordtype">int</span>);
<a name="l09491"></a>09491       <span class="keywordflow">break</span>;
<a name="l09492"></a>09492 
<a name="l09493"></a>09493    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>:
<a name="l09494"></a>09494    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga252eb84661dfaa5959b5cb316117d696">TID_BOOL</a>:
<a name="l09495"></a>09495       *((<a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a> *) arg) = va_arg(*arg_ptr, <a class="code" href="lrs1190_8c.html#a6877c9d7ac317ac3415ee1a1f92302a0">INT</a>);
<a name="l09496"></a>09496       <span class="keywordflow">break</span>;
<a name="l09497"></a>09497 
<a name="l09498"></a>09498    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#gafed9e8d519719d7347f9fdb3031201d1">TID_DWORD</a>:
<a name="l09499"></a>09499       *((<a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a> *) arg) = va_arg(*arg_ptr, <a class="code" href="group__mvmestdinclude.html#ga798af1e30bc65f319c1a246cecf59e39">DWORD</a>);
<a name="l09500"></a>09500       <span class="keywordflow">break</span>;
<a name="l09501"></a>09501 
<a name="l09502"></a>09502       <span class="comment">/* float variables are passed as double by the compiler */</span>
<a name="l09503"></a>09503    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>:
<a name="l09504"></a>09504       *((<span class="keywordtype">float</span> *) arg) = (float) va_arg(*arg_ptr, <span class="keywordtype">double</span>);
<a name="l09505"></a>09505       <span class="keywordflow">break</span>;
<a name="l09506"></a>09506 
<a name="l09507"></a>09507    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#ga13378fa303cf601b4b491866a6688362">TID_DOUBLE</a>:
<a name="l09508"></a>09508       *((<span class="keywordtype">double</span> *) arg) = va_arg(*arg_ptr, <span class="keywordtype">double</span>);
<a name="l09509"></a>09509       <span class="keywordflow">break</span>;
<a name="l09510"></a>09510 
<a name="l09511"></a>09511    <span class="keywordflow">case</span> <a class="code" href="group__mdefineh.html#gace0b097869238969f28899be5be86e42">TID_ARRAY</a>:
<a name="l09512"></a>09512       *((<span class="keywordtype">char</span> **) arg) = va_arg(*arg_ptr, <span class="keywordtype">char</span> *);
<a name="l09513"></a>09513       <span class="keywordflow">break</span>;
<a name="l09514"></a>09514    }
<a name="l09515"></a>09515 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaf4231327adba822d2395cf45be5d92d1"></a><!-- doxytag: member="midas.c::rpc_vax2ieee_double" ref="gaf4231327adba822d2395cf45be5d92d1" args="(double *var)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rpc_vax2ieee_double </td>
          <td>(</td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>var</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l08038">8038</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l08079">rpc_convert_single()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08039"></a>08039 {
<a name="l08040"></a>08040    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> i1, i2, i3, i4;
<a name="l08041"></a>08041 
<a name="l08042"></a>08042    <span class="comment">/* swap words */</span>
<a name="l08043"></a>08043    i1 = *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var) + 3);
<a name="l08044"></a>08044    i2 = *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var) + 2);
<a name="l08045"></a>08045    i3 = *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var) + 1);
<a name="l08046"></a>08046    i4 = *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var));
<a name="l08047"></a>08047 
<a name="l08048"></a>08048    <span class="comment">/* correct exponent */</span>
<a name="l08049"></a>08049    <span class="keywordflow">if</span> (i4 != 0)
<a name="l08050"></a>08050       i4 -= 0x20;
<a name="l08051"></a>08051 
<a name="l08052"></a>08052    *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var) + 3) = i4;
<a name="l08053"></a>08053    *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var) + 2) = i3;
<a name="l08054"></a>08054    *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var) + 1) = i2;
<a name="l08055"></a>08055    *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var)) = i1;
<a name="l08056"></a>08056 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gaab3294efcbd42ae403a917e2adc78864"></a><!-- doxytag: member="midas.c::rpc_vax2ieee_float" ref="gaab3294efcbd42ae403a917e2adc78864" args="(float *var)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rpc_vax2ieee_float </td>
          <td>(</td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>var</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l08021">8021</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l08079">rpc_convert_single()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08022"></a>08022 {
<a name="l08023"></a>08023    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> lo, hi;
<a name="l08024"></a>08024 
<a name="l08025"></a>08025    <span class="comment">/* swap hi and lo word */</span>
<a name="l08026"></a>08026    lo = *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var) + 1);
<a name="l08027"></a>08027    hi = *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var));
<a name="l08028"></a>08028 
<a name="l08029"></a>08029    <span class="comment">/* correct exponent */</span>
<a name="l08030"></a>08030    <span class="keywordflow">if</span> (hi != 0)
<a name="l08031"></a>08031       hi -= 0x100;
<a name="l08032"></a>08032 
<a name="l08033"></a>08033    *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var) + 1) = hi;
<a name="l08034"></a>08034    *((<span class="keywordtype">short</span> <span class="keywordtype">int</span> *) (var)) = lo;
<a name="l08035"></a>08035 
<a name="l08036"></a>08036 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ga0de9d14b8a7fe987e5919ca17e38c5fb"></a><!-- doxytag: member="midas.c::_client_connection" ref="ga0de9d14b8a7fe987e5919ca17e38c5fb" args="[MAX_RPC_CONNECTION]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structRPC__CLIENT__CONNECTION.html">RPC_CLIENT_CONNECTION</a> <a class="el" href="group__rpcfunctionc.html#ga0de9d14b8a7fe987e5919ca17e38c5fb">_client_connection</a>[MAX_RPC_CONNECTION]</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox </p>

<p>Definition at line <a class="el" href="midas_8c_source.html#l07956">7956</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga697ab24f60fe31109c15eef59cb5546f"></a><!-- doxytag: member="midas.c::_lsock" ref="ga697ab24f60fe31109c15eef59cb5546f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="group__rpcfunctionc.html#ga697ab24f60fe31109c15eef59cb5546f">_lsock</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l07959">7959</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga20e63d0a316b30ec4fbd8766dd04c52d"></a><!-- doxytag: member="midas.c::_opt_tcp_size" ref="ga20e63d0a316b30ec4fbd8766dd04c52d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="group__rpcfunctionc.html#ga20e63d0a316b30ec4fbd8766dd04c52d">_opt_tcp_size</a> = OPT_TCP_SIZE</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l07967">7967</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga71a27b6c4806f33ac723e1d78b028ebf"></a><!-- doxytag: member="midas.c::_server_acception" ref="ga71a27b6c4806f33ac723e1d78b028ebf" args="[MAX_RPC_CONNECTION]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structRPC__SERVER__ACCEPTION.html">RPC_SERVER_ACCEPTION</a> <a class="el" href="group__rpcfunctionc.html#ga71a27b6c4806f33ac723e1d78b028ebf">_server_acception</a>[MAX_RPC_CONNECTION]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l07960">7960</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga9ac2420c00b7dfb59718e71077d29568"></a><!-- doxytag: member="midas.c::_server_acception_index" ref="ga9ac2420c00b7dfb59718e71077d29568" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="group__rpcfunctionc.html#ga9ac2420c00b7dfb59718e71077d29568">_server_acception_index</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l07961">7961</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<a class="anchor" id="gadef5584a9a877cb26fd9df1b11320f55"></a><!-- doxytag: member="midas.c::_server_connection" ref="gadef5584a9a877cb26fd9df1b11320f55" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structRPC__SERVER__CONNECTION.html">RPC_SERVER_CONNECTION</a> <a class="el" href="group__rpcfunctionc.html#gadef5584a9a877cb26fd9df1b11320f55">_server_connection</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l07957">7957</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<a class="anchor" id="gaa16848418d977932c5cdf9e61f660e13"></a><!-- doxytag: member="midas.c::_server_name" ref="gaa16848418d977932c5cdf9e61f660e13" args="[256]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="group__rpcfunctionc.html#gaa16848418d977932c5cdf9e61f660e13">_server_name</a>[256]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l07963">7963</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga71a7c9d97df5dbe0a62770034ae6757f"></a><!-- doxytag: member="midas.c::_server_type" ref="ga71a7c9d97df5dbe0a62770034ae6757f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="odbhist_8c.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> <a class="el" href="group__rpcfunctionc.html#ga71a7c9d97df5dbe0a62770034ae6757f">_server_type</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l07962">7962</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga9938652e216f0f66f1eab2f26228089b"></a><!-- doxytag: member="midas.c::rpc_list" ref="ga9938652e216f0f66f1eab2f26228089b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structRPC__LIST.html">RPC_LIST</a>* <a class="el" href="group__rpcfunctionc.html#ga9938652e216f0f66f1eab2f26228089b">rpc_list</a> = NULL<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l07965">7965</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<a class="anchor" id="gad86eec219c3508ceb4474d780a00a104"></a><!-- doxytag: member="midas.c::tr_fifo" ref="gad86eec219c3508ceb4474d780a00a104" args="[10]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structTR__FIFO.html">TR_FIFO</a> <a class="el" href="group__rpcfunctionc.html#gad86eec219c3508ceb4474d780a00a104">tr_fifo</a>[10]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l10344">10344</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga38daa8c1581b7ae1460e02712cc63ff2"></a><!-- doxytag: member="midas.c::trf_rp" ref="ga38daa8c1581b7ae1460e02712cc63ff2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="group__rpcfunctionc.html#ga38daa8c1581b7ae1460e02712cc63ff2">trf_rp</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l10345">10345</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<a class="anchor" id="gafd6bbb4ef7f8d3e1a9e05d0a84601641"></a><!-- doxytag: member="midas.c::trf_wp" ref="gafd6bbb4ef7f8d3e1a9e05d0a84601641" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="group__rpcfunctionc.html#gafd6bbb4ef7f8d3e1a9e05d0a84601641">trf_wp</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l10345">10345</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 6 Jun 2014 for AlcapDAQ:Rootana by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
