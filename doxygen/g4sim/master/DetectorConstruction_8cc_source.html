<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>g4sim: src/DetectorConstruction.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>src/DetectorConstruction.cc</h1><a href="DetectorConstruction_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//---------------------------------------------------------------------------//</span>
<a name="l00002"></a>00002 <span class="comment">//Description: Geant4 Class</span>
<a name="l00003"></a>00003 <span class="comment">//Author: Wu Chen(wuchen@mail.ihep.ac.cn)</span>
<a name="l00004"></a>00004 <span class="comment">//Created: 17 Oct, 2012</span>
<a name="l00005"></a>00005 <span class="comment">//Comment:</span>
<a name="l00006"></a>00006 <span class="comment">//---------------------------------------------------------------------------//</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;<a class="code" href="DetectorConstruction_8hh.html">DetectorConstruction.hh</a>&quot;</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;G4GeometryManager.hh&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;G4PhysicalVolumeStore.hh&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;G4LogicalVolumeStore.hh&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;G4SolidStore.hh&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;G4UserLimits.hh&quot;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="DetectorMessenger_8hh.html">DetectorMessenger.hh</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="MaterialSvc_8hh.html">MaterialSvc.hh</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="MyFieldSvc_8hh.html">MyFieldSvc.hh</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="MyDetectorManager_8hh.html">MyDetectorManager.hh</a>&quot;</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a><a class="code" href="classDetectorConstruction.html#a1533c4308baddd0b2dcdf40f61dea1ef">00023</a> <a class="code" href="classDetectorConstruction.html#a1533c4308baddd0b2dcdf40f61dea1ef">DetectorConstruction::DetectorConstruction</a>(){
<a name="l00024"></a>00024   <a class="code" href="classDetectorConstruction.html#af9cbe54f01d9eafcd9aa7a8bf6932505">detectorMessenger</a> = <span class="keyword">new</span> <a class="code" href="classDetectorMessenger.html">DetectorMessenger</a>(<span class="keyword">this</span>);
<a name="l00025"></a>00025         <a class="code" href="classDetectorConstruction.html#a88ef5030782858cf917c68e7f5a55839">pMyFieldSvc</a> = <a class="code" href="classMyFieldSvc.html#a743a2b1e6f689061a975d6604e7559eb">MyFieldSvc::GetMyFieldSvc</a>();
<a name="l00026"></a>00026         <a class="code" href="classDetectorConstruction.html#aed3ded9851a04bb38a191b82e7d54f63">pMyDetectorManager</a> = <a class="code" href="classMyDetectorManager.html#a3024f4d5ff43ddb939c76d719f01f799">MyDetectorManager::GetMyDetectorManager</a>();
<a name="l00027"></a>00027 }
<a name="l00028"></a>00028 
<a name="l00029"></a><a class="code" href="classDetectorConstruction.html#a73013cab35a2b470338da2e4686edea3">00029</a> <a class="code" href="classDetectorConstruction.html#a73013cab35a2b470338da2e4686edea3">DetectorConstruction::~DetectorConstruction</a>(){
<a name="l00030"></a>00030   <span class="keyword">delete</span> <a class="code" href="classDetectorConstruction.html#af9cbe54f01d9eafcd9aa7a8bf6932505">detectorMessenger</a>;
<a name="l00031"></a>00031 }
<a name="l00032"></a>00032 
<a name="l00033"></a><a class="code" href="classDetectorConstruction.html#a662c618480b345a747f014b845d5ffdf">00033</a> G4VPhysicalVolume* <a class="code" href="classDetectorConstruction.html#a662c618480b345a747f014b845d5ffdf">DetectorConstruction::Construct</a>(){
<a name="l00034"></a>00034         G4String CardName;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036         <span class="comment">//=&gt;Material</span>
<a name="l00037"></a>00037         CardName = getenv(<span class="stringliteral">&quot;MATERIALLISTROOT&quot;</span>);
<a name="l00038"></a>00038         <a class="code" href="classMaterialSvc.html">MaterialSvc</a>* materialSvc = <a class="code" href="classMaterialSvc.html#a6a8dc9f1be8a2446c032ef168a350f4a">MaterialSvc::GetMaterialSvc</a>();
<a name="l00039"></a>00039         materialSvc-&gt;<a class="code" href="classMaterialSvc.html#a6e3d588ee53f209f433b4288ea1413aa">SetMaterial</a>(CardName);
<a name="l00040"></a>00040 
<a name="l00041"></a>00041         <span class="comment">//=&gt;MagField</span>
<a name="l00042"></a>00042         CardName = getenv(<span class="stringliteral">&quot;MAGFIELDCARDROOT&quot;</span>);
<a name="l00043"></a>00043         <a class="code" href="classDetectorConstruction.html#a88ef5030782858cf917c68e7f5a55839">pMyFieldSvc</a>-&gt;<a class="code" href="classMyFieldSvc.html#a6c3b56986ffd9bd82a04dbf6fadc5ac5">ReadCard</a>( CardName );
<a name="l00044"></a>00044 
<a name="l00045"></a>00045         <span class="comment">//=&gt;Geometry</span>
<a name="l00046"></a>00046         CardName = getenv(<span class="stringliteral">&quot;GEOCARDROOT&quot;</span>);
<a name="l00047"></a>00047         <a class="code" href="classDetectorConstruction.html#aed3ded9851a04bb38a191b82e7d54f63">pMyDetectorManager</a>-&gt;<a class="code" href="classMyDetectorManager.html#aa84753913bb8f22614a8d74bcf70ce5b">ReadCard</a>( CardName );
<a name="l00048"></a>00048 
<a name="l00049"></a>00049         <span class="comment">//=&gt;ConstructDetector</span>
<a name="l00050"></a>00050   <span class="keywordflow">return</span> <a class="code" href="classDetectorConstruction.html#ab1ae2e0fde6e46638309eefaa1ddc6b3">ConstructDetector</a>();
<a name="l00051"></a>00051 }
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="classDetectorConstruction.html#ab1ae2e0fde6e46638309eefaa1ddc6b3">00053</a> G4VPhysicalVolume* <a class="code" href="classDetectorConstruction.html#ab1ae2e0fde6e46638309eefaa1ddc6b3">DetectorConstruction::ConstructDetector</a>()
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055         <span class="comment">// Clean old geometry, if any</span>
<a name="l00056"></a>00056         G4GeometryManager::GetInstance()-&gt;OpenGeometry();
<a name="l00057"></a>00057         G4PhysicalVolumeStore::GetInstance()-&gt;Clean();
<a name="l00058"></a>00058         G4LogicalVolumeStore::GetInstance()-&gt;Clean();
<a name="l00059"></a>00059         G4SolidStore::GetInstance()-&gt;Clean();
<a name="l00060"></a>00060 
<a name="l00061"></a>00061         <span class="comment">// Geometry</span>
<a name="l00062"></a>00062         <a class="code" href="classDetectorConstruction.html#ad4c18894fc9b6bb6b3da74212075cdce">world_pvol</a> = <a class="code" href="classDetectorConstruction.html#aed3ded9851a04bb38a191b82e7d54f63">pMyDetectorManager</a>-&gt;<a class="code" href="classMyDetectorManager.html#afd7ff371c9c88547bf3312e61f47d33c">SetGeometry</a>();
<a name="l00063"></a>00063 
<a name="l00064"></a>00064         <span class="comment">//MagField</span>
<a name="l00065"></a>00065         G4LogicalVolume* world_lvol = <a class="code" href="classDetectorConstruction.html#ad4c18894fc9b6bb6b3da74212075cdce">world_pvol</a>-&gt;GetLogicalVolume();
<a name="l00066"></a>00066         <a class="code" href="classDetectorConstruction.html#a88ef5030782858cf917c68e7f5a55839">pMyFieldSvc</a>-&gt;<a class="code" href="classMyFieldSvc.html#a7a2c03fdf6c4c6485aa545a64a7de556">SetField</a>(world_lvol);
<a name="l00067"></a>00067 
<a name="l00068"></a>00068         <span class="comment">// reset userlimit</span>
<a name="l00069"></a>00069         <a class="code" href="classDetectorConstruction.html#ad4c18894fc9b6bb6b3da74212075cdce">world_pvol</a>-&gt;GetLogicalVolume()-&gt;SetUserLimits(<span class="keyword">new</span> G4UserLimits());
<a name="l00070"></a>00070 
<a name="l00071"></a>00071         <span class="comment">//always return the physical world</span>
<a name="l00072"></a>00072         <span class="keywordflow">return</span> <a class="code" href="classDetectorConstruction.html#ad4c18894fc9b6bb6b3da74212075cdce">world_pvol</a>;
<a name="l00073"></a>00073 }
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;G4RunManager.hh&quot;</span>
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="classDetectorConstruction.html#ad6dce38f7417b31180d9e14e9f196fda">00077</a> <span class="keywordtype">void</span> <a class="code" href="classDetectorConstruction.html#ad6dce38f7417b31180d9e14e9f196fda">DetectorConstruction::ReloadGeo</a>(G4String file_name){
<a name="l00078"></a>00078         <a class="code" href="classDetectorConstruction.html#aed3ded9851a04bb38a191b82e7d54f63">pMyDetectorManager</a>-&gt;<a class="code" href="classMyDetectorManager.html#a70f515977dfbeea931e2fff1a0554158">ClearGeo</a>();
<a name="l00079"></a>00079         <a class="code" href="classDetectorConstruction.html#aed3ded9851a04bb38a191b82e7d54f63">pMyDetectorManager</a>-&gt;<a class="code" href="classMyDetectorManager.html#aa84753913bb8f22614a8d74bcf70ce5b">ReadCard</a>(file_name);
<a name="l00080"></a>00080         <a class="code" href="classDetectorConstruction.html#a2742ef0ae83433992902a56693f2c6e5">UpdateGeometry</a>();
<a name="l00081"></a>00081 }
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="classDetectorConstruction.html#a17bc235a4059a698524abb97b2a115ee">00083</a> <span class="keywordtype">void</span> <a class="code" href="classDetectorConstruction.html#a17bc235a4059a698524abb97b2a115ee">DetectorConstruction::ResetMag</a>(G4String file_name){
<a name="l00084"></a>00084         <a class="code" href="classDetectorConstruction.html#a88ef5030782858cf917c68e7f5a55839">pMyFieldSvc</a>-&gt;<a class="code" href="classMyFieldSvc.html#a6c3b56986ffd9bd82a04dbf6fadc5ac5">ReadCard</a>(file_name);
<a name="l00085"></a>00085         <a class="code" href="classDetectorConstruction.html#a88ef5030782858cf917c68e7f5a55839">pMyFieldSvc</a>-&gt;<a class="code" href="classMyFieldSvc.html#a7a2c03fdf6c4c6485aa545a64a7de556">SetField</a>(<a class="code" href="classDetectorConstruction.html#ad4c18894fc9b6bb6b3da74212075cdce">world_pvol</a>-&gt;GetLogicalVolume());
<a name="l00086"></a>00086 }
<a name="l00087"></a>00087 
<a name="l00088"></a><a class="code" href="classDetectorConstruction.html#a2742ef0ae83433992902a56693f2c6e5">00088</a> <span class="keywordtype">void</span> <a class="code" href="classDetectorConstruction.html#a2742ef0ae83433992902a56693f2c6e5">DetectorConstruction::UpdateGeometry</a>()
<a name="l00089"></a>00089 {
<a name="l00090"></a>00090         G4RunManager::GetRunManager()-&gt;DefineWorldVolume(<a class="code" href="classDetectorConstruction.html#ab1ae2e0fde6e46638309eefaa1ddc6b3">ConstructDetector</a>());
<a name="l00091"></a>00091 }
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 9 Apr 2015 for g4sim by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
